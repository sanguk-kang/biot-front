define("devicesettings/controller/sac-sac/sac-sac",["devicesettings/core"],function(){return function(){function D(n){Ee=[],b.open(),$.ajax({url:"/shvacRegistrations"}).done(function(e){var t;for(t=0;t<e.length;t++){var a=e[t];"Deleted"!=a.dms_devices_registrationStatus&&Ee.push(a)}0<Ee.length?(r.dataSource.data(Ee),Ce.hide()):Ce.show(),Oe.data("kendoPopupSingleWindow").options.visible&&(b.open(Oe),$.ajax({url:"/dms/devices?parentId="+n+"&attributes=id,name,type,mappedType,description,controlPoint-tagName&registrationStatuses=Registered,NotRegistered"}).done(function(e){for(t=0;t<e.length;t++)e[t].orderingValue=Se[h][x.getDetailDisplayType(e[t].type)],void 0===e[t].controlPoint||void 0===e[t].controlPoint.tagName?e[t].tagName="-":e[t].tagName=e[t].controlPoint.tagName;Me=e,we.data("kendoGrid").dataSource.data(Me),we.data("kendoGrid").dataSource.sort([{field:"orderingValue",dir:"asc"},{field:"id",dir:"asc"}]),b.close(Oe)}).fail(function(){b.close(Oe),M.message(e.responseText),M.open()})),Ie.find("[data-event=devicecheckall]").prop("checked",!1),De.kendoButton().data("kendoButton").enable(!1),he.kendoButton().data("kendoButton").enable(!1),Ae.kendoButton().data("kendoButton").enable(!1)}).fail(function(e){M.message(e.responseText),M.open()}).always(function(){b.close()})}function t(e){for(var a=e.find("[data-event=devicecheckall]"),n=e.find("[data-event=devicecheck]"),t=e.find("[data-event=devicedetail]"),o=0;o<n.length;o++)n.eq(o).attr("id","sac-sac-device-check"+o),n.eq(o).siblings("label").attr("for","sac-sac-device-check"+o);a.on("click",function(){var e=$(this);ke=[],e.is(":checked")?n.each(function(e,t){t.checked=!0,ke.push(e),Je()}):n.each(function(e,t){t.checked=!1,ke=[],Je()}),tt(ke)}),n.on("click",function(){var e=$(this),t=n.index(this);e.is(":checked")?(i=t,ke.push(i)):(a.checked=!1,ke=$.grep(ke,function(e){return e!=t})),tt(ke),ke.length<Ee.length?a.prop("checked",!1):ke.length==Ee.length&&a.prop("checked",!0),Je()}),t.on("click",function(e){var t,a,n=$(e.target),o=n.closest("tbody").find("tr").index(n.closest("tr"));t=Oe,a=i=o,Pe=[],Ve=[],A.validate(!0),G.validate(!0),O.validate(!0),t.data("kendoPopupSingleWindow").openWindowPopup(),Ye(a)})}var c,a,d,n,r,i,h,p,A,G,O,y,w,o,M,u,_,v,s=window.CommonLoadingPanel,b=new s,x=window.Util,l=window.moment,f=window.CommonWebSocket,S=window.I18N,m=window.MAIN_WINDOW,T=window.GlobalSettings.getModel(),E=S.prop("SETTINGS_DEVICE_TYPE"),g=S.prop("SETTINGS_NETWORK_ID"),I=S.prop("SETTINGS_IP_ADDRESS"),C=S.prop("SETTINGS_DEVICE_NAME"),k=S.prop("SETTINGS_DEVICE_TIME"),N=S.prop("SETTINGS_TRACKING_TIME"),L=S.prop("SETTINGS_CONNECT"),R=S.prop("SETTINGS_STATE_CONNECTED"),P=S.prop("SETTINGS_STATE_DISCONNECTED"),V=S.prop("SETTINGS_BTN_DETAIL"),U=S.prop("SETTINGS_DEVICE_TAG_NAME"),F=S.prop("SETTINGS_DEVICE_ID"),B=S.prop("SETTINGS_TYPE"),W=S.prop("SETTINGS_DEVICE_DESCRIPTION"),e=S.prop("COMMON_BTN_DETAIL"),j=S.prop("SETTINGS_MESSAGE_CONFIRM_DELETE_SELECTED_DEVICE_LIST"),q=S.prop("SETTINGS_MESSAGE_NOTI_DELETED_SELECTED_DEVICE_LIST"),H=S.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL"),Y=S.prop("SETTINGS_MESSAGE_NOTI_FAILED_CHANGE_SAVE"),K=S.prop("SETTINGS_MESSAGE_NOTI_FAILED_ADD_DEVICE"),X=S.prop("SETTINGS_MESSAGE_INFO_NOT_CONNECTED"),z=S.prop("SETTINGS_MESSAGE_INFO_TRACKING"),J=S.prop("SETTINGS_MESSAE_NOTI_ALREADY_EXIST_NETWORK_ID"),Q=S.prop("SETTINGS_MESSAE_NOTI_ALREADY_EXIST_NETWORK_IP"),Z=S.prop("SETTINGS_MESSAE_NOTI_ALREADY_EXIST_DEVICE_NAME"),ee=S.prop("SETTINGS_MESSAGE_NOTI_ALREADY_RUN_UPDATE_INSTALLATION"),te=S.prop("SETTINGS_MESSAGE_NOTI_FAILED_UPDATE_INSTALLATION_INFO_DEVICE"),ae=S.prop("SETTINGS_MESSAGE_NOTI_COMPLETE_UPDATE_INSTALLATION_INFO"),ne=S.prop("SETTINGS_MESSAGE_NOTI_FAILED_COMPLETE_UPDATE_INSTALLATION_INFO"),oe=S.prop("SETTINGS_MESSAGE_NOTI_COMPLETE_UPDATE_TIME_INFO"),ie=S.prop("SETTINGS_MESSAGE_NOTI_FAILED_COMPLETE_UPDATE_TIME_INFO"),de=S.prop("SETTINGS_MESSAGE_INFO_ADDRESSING"),re=S.prop("SETTINGS_MESSAGE_INFO_DOWNLOADING"),se=S.prop("SETTINGS_MESSAGE_INFO_EMERGENCYSTOP"),le=["S-Net SMART Controller","DMS"],ce=[],pe=[{text:S.prop("SETTINGS_MENUCONFIGURE_DEVICE_ALL"),value:"All"},{text:S.prop("SETTINGS_AI"),value:"AI"},{text:S.prop("SETTINGS_AO"),value:"AO"},{text:S.prop("SETTINGS_DI"),value:"DI"},{text:S.prop("SETTINGS_DO"),value:"DO"},{text:S.prop("SETTINGS_MENUCONFIGURE_SAC_INDOOR"),value:"SAC Indoor"},{text:S.prop("SETTINGS_MENUCONFIGURE_SAC_OUTDOOR"),value:"SAC Outdoor"}],ue=[{text:S.prop("SETTINGS_MENUCONFIGURE_DEVICE_ALL"),value:"All"},{text:S.prop("SETTINGS_MENUCONFIGURE_SAC_INDOOR"),value:"SAC Indoor"},{text:S.prop("SETTINGS_MENUCONFIGURE_SAC_OUTDOOR"),value:"SAC Outdoor"},{text:S.prop("SETTINGS_ENERGY_METER"),value:"Energy Meter"},{text:S.prop("SETTINGS_DI"),value:"DI"},{text:S.prop("SETTINGS_DO"),value:"DO"}],_e={"SAC Indoor":S.prop("SETTINGS_MENUCONFIGURE_SAC_INDOOR"),"SAC Outdoor":S.prop("SETTINGS_MENUCONFIGURE_SAC_OUTDOOR"),"Energy Meter":S.prop("SETTINGS_ENERGY_METER"),DI:S.prop("SETTINGS_DI"),DO:S.prop("SETTINGS_DO"),AI:S.prop("SETTINGS_AI"),AO:S.prop("SETTINGS_AO")},ve=[{text:S.prop("SETTINGS_MENUCONFIGURE_POINT"),value:"Point"},{text:S.prop("SETTINGS_MENUCONFIGURE_LIGHT"),value:"Light"},{text:S.prop("SETTINGS_TEMPERATURE_SENSOR"),value:"Temperature Sensor"},{text:S.prop("SETTINGS_HUMIDITY_SENSOR"),value:"Humidity Sensor"},{text:S.prop("SETTINGS_MENUCONFIGURE_MOTION"),value:"Motion Sensor"},{text:S.prop("SETTINGS_ENERGY_METER"),value:"Energy Meter"}],fe=[{text:S.prop("SETTINGS_MENUCONFIGURE_POINT"),value:"Point"},{text:S.prop("SETTINGS_MENUCONFIGURE_LIGHT"),value:"Light"},{text:S.prop("SETTINGS_MENUCONFIGURE_MOTION"),value:"Motion Sensor"}],Se={"AirConditionerController.DMS":{"SAC Indoor":0,"SAC Outdoor":1,"Energy Meter":2,DI:3,DO:4},"AirConditionerController.WirelessDDC":{AI:0,AO:1,DI:2,DO:3,"SAC Indoor":4,"SAC Outdoor":5}},me=$("#setting-sac-tab").find(".tabbtn-sac-sac"),Te=$(".sac-sac-device-type-selector"),Ee=[],ge="DMS",Ie=$(".sac-sac-device-grid"),Ce=$(".sac-sac-device-grid").find(".no-device-list").text("No device. Please add device"),ke=[],Ne=$(".sac-sac-content [data-event=adddevice]"),De=$(".sac-content-box-btn [data-event=updatetime]"),he=$(".sac-content-box-btn [data-event=updateinstall]"),Ae=$(".sac-content-box-btn [data-event=deletedevice]"),Ge=$(".sac-sac-content.adddevice input[data-role=inputnetwork]"),Oe=$("#popup-sac-sac-device"),ye=$(".popup-header-info"),we=$("#popup-sac-sac-device").find(".popup-detail-device-grid"),Me=[],be=$("#popup-sac-sac-device .device-type-selector"),xe=$("#popup-sac-sac-device").find(".popup-container").find("input[data-role=networkid]"),Le=$("#popup-sac-sac-device").find(".popup-container").find("span[data-role=ipaddress]"),Re=$("#popup-sac-sac-device").find(".popup-container").find("input[data-role=ipaddressinput]"),$e=$("#popup-sac-sac-device").find(".popup-container").find("input[data-role=name]"),Pe=[],Ve=[],Ue=$("#popup-sac-sac-device").find(".popup-footer").find("button[data-event=close]"),Fe=$("#popup-sac-sac-device").find(".popup-footer").find("button[data-event=save]"),Be=$("#popup-sac-sac-device-confirm"),We=$("#popup-sac-sac-device-message"),je=$("#popup-sac-sac-device-update-message"),qe=!1,He=function(){Oe.kendoPopupSingleWindow({title:e,width:1500,height:800}),Ue.unbind("click"),A=xe.kendoCommonValidator({type:"networkId"}).data("kendoCommonValidator"),G=Re.kendoCommonValidator({type:"ipAddress"}).data("kendoCommonValidator"),O=$e.kendoCommonValidator({type:"name"}).data("kendoCommonValidator"),Oe.find(".popup-container").find(".popup-detail-row input.k-input").on("keyup",function(e){Fe.kendoButton().data("kendoButton").enable(!0)}),be.kendoDropDownList({dataSource:[],value:S.prop("SETTINGS_MENUCONFIGURE_DEVICE_ALL"),dataTextField:"text",dataValueField:"value",change:function(){if(!(we.data("kendoGrid").dataSource.data().length<1)){var e=this.value();!function(e,t){var a,n=e.data("kendoGrid"),o=[];for(var i in t)"SAC Indoor"==t[i]?(a=d("AirConditioner",i),o.push({logic:"or",filters:a})):"Energy Meter"==t[i]?(a=d("Meter",i),o.push({logic:"or",filters:a})):""!==t[i]&&"All"!==t[i]&&o.push({field:i,operator:"eq",value:x.getOriginalType(t[i])});function d(e,t){for(var a=x.getDeviceTypeList(e),n=[],o=0;o<a.length;o++){var i=a[o].type;n.push({field:t,operator:"eq",value:i})}return n}n.dataSource.filter({logic:"and",filters:o})}(we,{type:e})}}}),we.kendoGrid({scrollable:!0,sortable:!0,height:450,columns:[],dataSource:[]})},Ye=function(e){var o=r.dataSource.data().at(e);h=o.dms_devices_type,Oe.attr("device-type",h),b.open(Oe),$.ajax({url:"/dms/devices?parentId="+o.dms_devices_id+"&attributes=id,name,type,mappedType,description,controlPoint-tagName&registrationStatuses=Registered,NotRegistered"}).done(function(e){var t,i,a,n;for(t=0;t<e.length;t++)e[t].orderingValue=Se[h][x.getDetailDisplayType(e[t].type)];for(we.data("kendoGrid").setOptions({columns:(i=o.dms_devices_type,n=[{field:"type",title:E,sortable:!0},{field:"tagName",title:U,sortable:!0},{field:"id",title:F,sortable:!0},{field:"name",title:C,sortable:!0},{field:"mappedType",title:B,sortable:!0},{field:"description",title:W,sortable:!(a=[])}],$.each(n,function(e,t){a.push({field:t.field,title:t.title,template:function(e){return function(e,t){var a,n,o=t.field;return"type"==o?(n=x.getDetailDisplayType(e[o]),a="<div class='popup-grid-device-"+o+"'>"+_e[n]+"</div>"):"tagName"==o?a=void 0===e[o]||void 0===e[o]||"AirConditionerController.DMS"==i||"-"==e[o]?"<div class='popup-grid-device-"+o+"'>-</div>":"<div class='popup-grid-device-"+o+"'>"+e[o]+"</div>":"name"==o?"AirConditionerController.WirelessDDC"==i?a=void 0===e[o]||"-"==e[o]?"<input class='k-input' data-role='devicetagname' value='"+e.tagName+"' required/>":"<input class='k-input' data-role='devicetagname' value='"+e[o]+"' required/>":"AirConditionerController.DMS"==i&&(a=void 0===e[o]||"-"==e[o]?"<input class='k-input' data-role='devicetagname' value='"+e.id+"' required/>":"<input class='k-input' data-role='devicetagname' value='"+e[o]+"' required/>"):"mappedType"==o?void 0!==e[o]&&"-"!=e[o]?a="<input data-role='point-type-selector' hasData='true' data-value='"+e[o]+"'/>":void 0!==e[o]&&"-"!=e[o]||(a="<span data-role='point-type-selector' hasData='false' data-value='"+e[o]+"'>-</span>"):a="description"==o?(void 0===e[o]&&(e[o]=""),"<input class='k-input' data-role='devicedescription' value='"+e[o]+"'/>"):"<div class='popup-grid-device-"+o+"'>"+e[o]+"</div>",a}(e,t)},sortable:t.sortable})}),a)}),ye.find("span.device-name").text(x.getDetailDisplayType(o.dms_devices_type)),"AirConditionerController.WirelessDDC"==o.dms_devices_type&&ye.find("span.device-name").text("S-Net SMART Controller"),ye.find("span.device-count").text(" ("+e.length+")"),xe.val(o.dms_devices_id),xe.data("data-origin",o.dms_devices_id),"AirConditionerController.WirelessDDC"==o.dms_devices_type?(Re.hide(),Le.show(),null===o.dms_devices_networks_ethernet_ipAddress?Le.text("-"):Le.text(o.dms_devices_networks_ethernet_ipAddress),Le.data("data-origin",o.dms_devices_networks_ethernet_ipAddress)):"AirConditionerController.DMS"==o.dms_devices_type&&(Le.hide(),Re.show(),Re.val(o.dms_devices_networks_ethernet_ipAddress),Re.data("data-origin",o.dms_devices_networks_ethernet_ipAddress)),$e.val(o.dms_devices_name),$e.data("data-origin",o.dms_devices_name),ce=[],"AirConditionerController.WirelessDDC"==o.dms_devices_type?ce=pe:"AirConditionerController.DMS"==o.dms_devices_type&&(ce=ue),be.data("kendoDropDownList").dataSource.data(ce),be.data("kendoDropDownList").value("All"),be.data("kendoDropDownList").trigger("change"),t=0;t<e.length;t++)void 0===e[t].controlPoint||void 0===e[t].controlPoint.tagName?e[t].tagName="-":e[t].tagName=e[t].controlPoint.tagName;Me=e,we.data("kendoGrid").dataSource.data(Me),we.data("kendoGrid").dataSource.sort([{field:"orderingValue",dir:"asc"},{field:"id",dir:"asc"}]),y=we.find("input[data-role=devicetagname]").kendoCommonValidator({type:"name"}).data("kendoCommonValidator"),w=we.find("input[data-role=devicedescription]").kendoCommonValidator({type:"description"}).data("kendoCommonValidator"),b.close(Oe)}).fail(function(e){M.message("<p class='pop-confirm-message'>"+e.responseText+"</p>"),M.open()}).always(function(){b.close(Oe)}),Fe.data("kendoButton").enable(!1)};function Ke(e,t,a){for(var n,o="",i=0;i<t.length;i++){if(412==t[i].code){var d=t[i].body[a],r=e[i].dms_devices_id;"NotConnected"==d?n="<li><span class='device-name'>"+r+"</span><span class='device-detail'>"+X+"</span></li>":"Tracking"==d?n="<li><span class='device-name'>"+r+"</span><span class='device-detail'>"+z+"</span></li>":"Addressing"==d?n="<li><span class='device-name'>"+r+"</span><span class='device-detail'>"+de+"</span></li>":"Downloading"==d?n="<li><span class='device-name'>"+r+"</span><span class='device-detail'>"+re+"</span></li>":"EmergencyStop"==d&&(n="<li><span class='device-name'>"+r+"</span><span class='device-detail'>"+se+"</span></li>"),o+=n}}return o="<div class='device-update-info-fail'>"+te+":</div><ul class='device-update-info'>"+o+"</ul>"}function Xe(e,t){var a=!1,n=$(t).closest("tr").attr("data-uid");if(0==Pe.length)Pe.push(n);else{for(var o=0;o<Pe.length;o++){if(Pe[o]==n){a=!0;break}a=!1}a||Pe.push(n)}}function ze(){b.open(),$.ajax({url:"/shvacRegistrations"}).done(function(e){var t=Ie.find("[data-event=devicecheckall]");Ee=[],ke=[];for(var a=0;a<e.length;a++){var n=e[a];"Deleted"!=n.dms_devices_registrationStatus&&Ee.push(n)}0<Ee.length?(r.dataSource.data(Ee),Ce.hide()):Ce.show(),Je(),t.prop("checked",!1)}).fail(function(e){M.message("<p class='pop-confirm-message'>"+e.responseText+"</p>"),M.open()}).always(function(){b.close()})}function Je(){0===ke.length?(De.data("kendoButton").enable(!1),he.data("kendoButton").enable(!1),Ae.data("kendoButton").enable(!1)):(De.data("kendoButton").enable(!0),he.data("kendoButton").enable(!0),Ae.data("kendoButton").enable(!0))}function Qe(e){var t;"S-Net SMART Controller"===ge?t=e.kendoCommonValidator({type:"networkId",minLength:1,maxLength:32}).data("kendoCommonValidator"):"DMS"===ge&&(t=e.kendoCommonValidator({type:"ipAddress"}).data("kendoCommonValidator")),t.validate()?Ne.data("kendoButton").enable(!0):Ne.data("kendoButton").enable(!1),e.on("keyup",function(e){t.validate()?Ne.data("kendoButton").enable(!0):Ne.data("kendoButton").enable(!1)})}function Ze(e){return l(e).format("LLL").replace(/\./g,"-")}function et(e){var t;t="change"==e?Y:"add"==e?K:e.responseText,M.message(t),M.open()}function tt(e){e.sort(function(e,t){return e-t})}(function(){var a,e;me.on("click",function(){m.disableFloorNav(!0)}),"Lite"===T&&le.splice(0,1),Te.kendoDropDownList({dataSource:le,value:"DMS",change:function(e){""!=(ge=this.value())&&Qe(Ge)}}),n=Te.data("kendoDropDownList"),Ne.kendoButton().data("kendoButton").enable(!1),De.kendoButton().data("kendoButton").enable(!1),he.kendoButton().data("kendoButton").enable(!1),Ae.kendoButton().data("kendoButton").enable(!1),Ge.on("focusin",function(){Qe($(this))}),Ie.kendoGrid({scrollable:!0,columns:(e=[{field:"dms_devices_type",title:E},{field:"dms_devices_id",title:g},{field:"dms_devices_networks_ethernet_ipAddress",title:I},{field:"dms_devices_name",title:C},{field:"connected",title:L},{field:"dms_devices_configuration_time_currentTime",title:k},{field:"trackingTime",title:N}],(a=[]).push({headerTemplate:"<input type='checkbox' data-event='devicecheckall' id='sac-sac-device-checkall' class='k-checkbox'/><label class='k-checkbox-label' for='sac-sac-device-checkall'></label>",template:"<input type='checkbox' data-event='devicecheck' class='k-checkbox'/><label class='k-checkbox-label'></label>",width:100}),$.each(e,function(e,t){a.push({field:t.field,title:t.title,template:function(e){return function(e,t){return e[t]=x.getValueFilteredForXSS(e[t]),null===e[t]||"null"===e[t]||void 0===e[t]||""===e[t]?"<span class='sac-sac-"+t+"'>-</span>":"dms_devices_type"==t?"<span class='sac-sac-"+t+"'>"+function(e){var t;return"AirConditionerController.WirelessDDC"==e?t="S-Net SMART Controller":"AirConditionerController.DMS"==e&&(t="DMS"),t}(e[t])+"</span>":"dms_devices_configuration_time_currentTime"==t?0==e.currentTimeSynchronized?"<span class='sac-sac-"+t+" highlighted'>"+Ze(e[t])+"</span>":"<span class='sac-sac-"+t+"'>"+Ze(e[t])+"</span>":"trackingTime"==t?1==e.trackingTimeOutdated?"<span class='sac-sac-"+t+" highlighted'>"+Ze(e[t])+"</span>":"<span class='sac-sac-"+t+"'>"+Ze(e[t])+"</span>":"connected"==t?e[t]?"<span class='sac-sac-"+t+"'>"+R+"</span>":"<span class='highlighted sac-sac-"+t+"'>"+P+"</span>":e[t]}(e,t.field)}})}),a.push({field:"",title:V,template:"<span class='ic ic-info' data-event='devicedetail'></span>"}),a)}),r=Ie.data("kendoGrid"),Be.kendoCommonDialog({type:"confirm"}),o=Be.data("kendoCommonDialog"),We.kendoCommonDialog(),M=We.data("kendoCommonDialog"),je.kendoCommonDialog({timeout:!1}),u=je.data("kendoCommonDialog"),f.on("receive",function(e){qe&&c(e)})})(),He(),D(),n.bind("change",function(e){var t=this.value(),a=$(".sac-sac-content.adddevice input[data-role=inputnetwork]");"DMS"==t?a.attr("placeholder","IP Address"):"S-Net SMART Controller"==t&&a.attr("placeholder","Network ID")}),Ne.on("click",function(){""!==ge&&function(e){var n=x.getOriginalType(ge),t=e,o={};"S-Net SMART Controller"==ge&&(n="AirConditionerController.WirelessDDC");o="AirConditionerController.WirelessDDC"==n?{dms_devices_type:n,dms_devices_id:t,dms_devices_networks_ethernet_ipAddress:"-"}:{dms_devices_type:n,dms_devices_networks_ethernet_ipAddress:t,dms_devices_id:function(){function e(){return String.fromCharCode(26*Math.random()+65)}function t(e,t){return Math.floor(Math.random()*(t-e+1)+e)}return"S"+e()+e()+e()+t(1e3,9999)+"-"+t(100,999)+e()+"-"+t(10,99)}()};b.open(),$.ajax({url:"/shvacRegistrations"}).done(function(e){for(var t=0;t<e.length;t++){var a=e[t];if("AirConditionerController.WirelessDDC"==n){if(a.dms_devices_id==o.dms_devices_id)return M.message(K),M.open(),b.close(),!1}else if("AirConditionerController.DMS"==n&&a.dms_devices_networks_ethernet_ipAddress==o.dms_devices_networks_ethernet_ipAddress)return M.message(K),M.open(),b.close(),!1}$.ajax({url:"/shvacRegistrations",method:"POST",data:o}).done(function(){Ge.val(""),b.close(),ze()}).fail(function(e){b.close(),M.message(e.responseText),M.open()}).always(function(){})}).fail(function(e){b.close(),M.message(e.responseText),M.open()}).always(function(){Ne.data("kendoButton").enable(!1)})}(Ge.val())}),De.on("click",function(){b.open();var i,d=[];for(i=0;i<ke.length;i++){var e={dms_devices_id:r.dataSource.data().at(ke[i]).dms_devices_id,synchronizeCurrentTime:!0};d.push(e)}$.ajax({url:"/shvacRegistrations",method:"PATCH",data:d}).done(function(e){var t,a=e,n=!1,o=!1;for(i=0;i<a.length;i++)204==a[i].code?n=!0:412==a[i].code&&(o=!0);b.close(),t=o?(t=Ke(d,a,"synchronizeCurrentTime"),n?"<div class='device-update-info-message'>"+oe+"</div>"+t:"<div class='device-update-info-message'>"+ie+"</div>"+t):oe,u.message(t),u.open(),ze()}).fail(function(e){b.close(),M.message(e.responseText),M.open()}).always(function(){})}),he.on("click",function(){(b=new s).open();for(var t=[],e=0;e<ke.length;e++){var a={dms_devices_id:r.dataSource.data().at(ke[e]).dms_devices_id,updateInstallationInformation:!0};t.push(a)}qe=!0,$.ajax({url:"/shvacRegistrations",method:"PATCH",data:t}).done(function(e){!function(t,e,a){for(var n,o=a,i=e,d=!1,r=!1,s=0;s<o.length;s++)204==o[s].code?d=!0:412==o[s].code&&(r=!0);if(d){var l=setTimeout(function(){b.close()},18e4);c=function(e){e.name==t&&(clearTimeout(l),b.close(),r?(n=Ke(i,o,"updateInstallationInformation"),u.message("<div class='device-update-info-message'>"+ae+"</div>"+n)):(n=ae,u.message(n)),u.open(),ze(),qe=!1)}}else b.close(),n=Ke(i,o,"updateInstallationInformation"),u.message("<div class='device-update-info-message'>"+ne+"</div>"+n),u.open(),ze()}("CompleteUpdateInstallationInfo",t,e)}).fail(function(e){b.close(),423==e.status?M.message(ee):M.message(e.responseText),M.open()}).always(function(){})}),Ae.on("click",function(){var e,i=ke.length;a=S.prop("SETTINGS_MESSAGE_CONFIRM_DELETE_SELECTED_MULTI_DEVICE_LIST",i),d=S.prop("SETTINGS_MESSAGE_NOTI_DELETED_SELECTED_MULTI_DEVICE_LIST",i),1===i?e=j:1<i&&(e=a),o.message(e),o.setConfirmActions({yes:function(e){b.open();var t,a,n=[];for(t=0;t<ke.length;t++){var o={dms_devices_id:(a=r.dataSource.data().at(ke[t])).dms_devices_id,dms_devices_registrationStatus:"Deleted"};n.push(o)}$.ajax({url:"/shvacRegistrations",method:"PATCH",data:n}).done(function(){for(t=i-1;0<=t;t--)a=r.dataSource.at(ke[t]),r.dataSource.remove(a);0==r.dataSource.data().length&&$(".sac-sac-device-grid").find("[data-event=devicecheckall]").prop("checked",!1);ke=[],1==i?M.message(q):M.message(d),M.open()}).fail(function(e){M.message(e.responseText),M.open()}).always(function(){b.close()})}}),o.open()}),_=Oe.find(".popup-footer button[data-event=save]").data("kendoButton"),v=Oe.find(".popup-detail-device-grid").data("kendoGrid"),Oe.on("keyup",".k-input.common-validator",function(e){var t=$(e.target),a=t.data("kendoCommonValidator"),n=0<t.closest("tr").length,o=Oe.attr("device-type"),i=Oe.find(".k-input.common-validator"),d=0,r=i.length,s=null,l=null,c=!0,p="";for(n&&a&&a.validate()&&Xe(v,t[0]),d=0;d<r;d++)if(p=(s=i.eq(d)).data("role"),l=s.data("kendoCommonValidator"),-1<o.indexOf("WirelessDDC")){if("ipaddressinput"!=p&&!l.validate()){c=!1;break}}else if(!l.validate()){c=!1;break}_.enable(c)}),Oe.data("kendoPopupSingleWindow").addEventToFactory("#popup-sac-sac-device .popup-footer button[data-event=save]","sacDetailPopupSave",function(e){var n,o,i,d,r,s,a=$(e.target),t=!0,l=$("#popup-sac-sac-device"),c=x.getOriginalType(l.find(".popup-header-info").find("span.device-name").text()),p=we.data("kendoGrid").tbody.find("tr"),u=p.find("input[data-role=devicetagname]"),_=p.find("input[data-role=devicedescription]"),v={};if(Me=we.data("kendoGrid").dataSource,"AirConditionerController.WirelessDDC"==c)0!=A.validate()&&0!=O.validate()||(t=!1),y&&w&&(0!=y.validate()&&0!=w.validate()||(t=!1));else if("AirConditionerController.DMS"==c&&(0!=A.validate()&&0!=G.validate()&&0!=O.validate()||(t=!1),y&&w))for(var f=0;f<p.length;f++){var S=u.eq(f).data("kendoCommonValidator").validate(),m=_.eq(f).data("kendoCommonValidator").validate();0!=S&&0!=m||(t=!1)}if(0==t)return!1;if(0<Pe.length){for(var T=0;T<Pe.length;T++){var E,g,I=Pe[T],C=we.data("kendoGrid").table.find("tr[data-uid="+I+"]"),k=we.data("kendoGrid").dataSource.getByUid(I);s=C.find("td input[data-role=devicetagname]").val(),E=C.find("[data-role=point-type-selector]").data("kendoDropDownList")?C.find("[data-role=point-type-selector]").data("kendoDropDownList").value():null,g=C.find("td input[data-role=devicedescription]").val(),k.name=s,"Energy Meter"==E&&(E="WattHour"),k.mappedType=x.getOriginalType(E),k.description=g;var N={id:k.id,name:k.name,mappedType:k.mappedType,description:k.description};void 0===N.mappedType&&delete N.mappedType,Ve.push(N)}t&&(b.open(l),$.ajax({url:"/dms/devices",method:"PATCH",data:Ve}).done(function(){b.close(l),Me.data(Me.data());for(var e=0;e<Me.data().length;e++){var t=Me.data()[e];t.orderingValue=Se[h][x.getDetailDisplayType(t.type)]}a.data("kendoButton").enable(!1),o=l.find("input[data-role=networkid]").val(),n=l.find("input[data-role=networkid]").data("data-origin"),s=l.find("input[data-role=name]").val(),r=l.find("input[data-role=name]").data("data-origin"),"AirConditionerController.WirelessDDC"==c?(d=l.find("span[data-role=ipaddress]").text(),i=l.find("span[data-role=ipaddress]").data("data-origin")):"AirConditionerController.DMS"==c&&(d=l.find("input[data-role=ipaddressinput]").val(),i=l.find("input[data-role=ipaddressinput]").data("data-origin")),o!=n&&(v.dms_devices_id=o),s!=r&&(v.dms_devices_name=s),d!=i&&(v.dms_devices_networks_ethernet_ipAddress=d),"AirConditionerController.WirelessDDC"==c&&delete v.dms_devices_networks_ethernet_ipAddress,b.open(l),$.ajax({url:"/shvacRegistrations"}).done(function(e){for(var t=0;t<e.length;t++){var a=e[t];if(o!=n&&o==a.dms_devices_id)return b.close(l),M.message(J),M.open(),!1;if(d!=i&&d==a.dms_devices_networks_ethernet_ipAddress)return b.close(l),M.message(Q),M.open(),!1;if(s!=r&&s==a.dms_devices_name)return b.close(l),M.message(Z),M.open(),!1}$.ajax({url:"/shvacRegistrations/"+n,method:"PATCH",data:v}).done(function(){l.find("input[data-role=networkid]").data("data-origin",v.dms_devices_id),l.find("input[data-role=name]").data("data-origin",v.dms_devices_name),"AirConditionerController.WirelessDDC"==c?l.find("span[data-role=ipaddress]").data("data-origin",v.dms_devices_networks_ethernet_ipAddress):"AirConditionerController.DMS"==c&&l.find("input[data-role=ipaddressinput]").data("data-origin",v.dms_devices_networks_ethernet_ipAddress),D(o)}).fail(function(){b.close(l),et(e)}).always(function(){})}).fail(function(e){b.close(l),et(e)}).always(function(){})}).fail(function(e){et(e),b.close(l)}).always(function(){a.data("kendoButton").enable(!1),Pe=[],Ve=[]}))}else o=l.find("input[data-role=networkid]").val(),n=l.find("input[data-role=networkid]").data("data-origin"),s=l.find("input[data-role=name]").val(),r=l.find("input[data-role=name]").data("data-origin"),"AirConditionerController.WirelessDDC"==c?(d=l.find("span[data-role=ipaddress]").text(),i=l.find("span[data-role=ipaddress]").data("data-origin")):"AirConditionerController.DMS"==c&&(d=l.find("input[data-role=ipaddressinput]").val(),i=l.find("input[data-role=ipaddressinput]").data("data-origin")),o!=n&&(v.dms_devices_id=o),s!=r&&(v.dms_devices_name=s),d!=i&&(v.dms_devices_networks_ethernet_ipAddress=d),"AirConditionerController.WirelessDDC"==c&&delete v.dms_devices_networks_ethernet_ipAddress,b.open(l),$.ajax({url:"/shvacRegistrations"}).done(function(e){var t;for(t=0;t<e.length;t++){var a=e[t];if(o!=n&&o==a.dms_devices_id)return b.close(l),M.message(J),M.open(),!1;if(d!=i&&d==a.dms_devices_networks_ethernet_ipAddress)return b.close(l),M.message(Q),M.open(),!1;if(s!=r&&s==a.dms_devices_name)return b.close(l),M.message(Z),M.open(),!1}$.ajax({url:"/shvacRegistrations/"+n,method:"PATCH",data:v}).done(function(){l.find("input[data-role=networkid]").data("data-origin",v.dms_devices_id),l.find("input[data-role=name]").data("data-origin",v.dms_devices_name),"AirConditionerController.WirelessDDC"==c?l.find("span[data-role=ipaddress]").data("data-origin",v.dms_devices_networks_ethernet_ipAddress):"AirConditionerController.DMS"==c&&l.find("input[data-role=ipaddressinput]").data("data-origin",v.dms_devices_networks_ethernet_ipAddress),D(o)}).fail(function(e){b.close(l),et(e)}).always(function(){})}).fail(function(e){b.close(l),M.message(e.responseText),M.open()}).always(function(){}),a.data("kendoButton").enable(!1)}),Oe.data("kendoPopupSingleWindow").addEventToFactory("#popup-sac-sac-device .popup-footer button[data-event=sacclose]","sacDetailPopupClose",function(e){var t=$("#popup-sac-sac-device"),a=Fe.data("kendoButton").options.enable;o.message(H),o.setConfirmActions({yes:function(e){t.data("kendoPopupSingleWindow").close()},no:function(e){}}),1==a?o.open():t.data("kendoPopupSingleWindow").close()}),Oe.closest(".k-window").find(".pop-window-btn-close.ic-close").off("click"),Oe.closest(".k-window").find(".pop-window-btn-close.ic-close").on("click",function(){var t=$("#popup-sac-sac-device"),e=Fe.data("kendoButton").options.enable;o.message(H),o.setConfirmActions({yes:function(e){t.data("kendoPopupSingleWindow").close()},no:function(e){}}),1==e?o.open():t.data("kendoPopupSingleWindow").close()}),r.dataSource.bind("change",function(e){t(Ie)}),we.data("kendoGrid").bind("dataBound",function(e){p=we.find("[data-role=point-type-selector][hasData=true]");var t=$("body").find(".mappedtype-dropdownlist-list"),a=t.closest(".k-animation-container"),n=t.length,o=a.length;0<n&&t.remove(),0<o&&a.remove();for(var i=0;i<p.length;i++){var d=p.eq(i),r=d.closest("tr").find("td").eq(0).find(".popup-grid-device-type").text(),s=[];"DI"==r||"DO"==r||"AO"==r?s=fe:"AI"==r&&(s=ve),d.kendoDropDownList({dataSource:s,dataTextField:"text",dataValueField:"value",change:function(e){Xe(0,$(this.element[0].parentElement)),Fe.data("kendoButton").enable(!0)}}),d.data("kendoDropDownList").list.addClass("mappedtype-dropdownlist-list")}!function(){for(var e=we.find(".k-grid-content").find("tbody").find("tr"),t=0;t<we.data("kendoGrid").dataSource.view().length;t++){var a=we.data("kendoGrid").dataSource.view()[t],n=a.type,o=x.getDisplayClassType(n),i=a.mappedType,d=e.eq(t),r=d.find("[data-role=point-type-selector]").data("kendoDropDownList");"Indoor"!==o&&"Outdoor"!==o&&"Meter"!==o||"true"==d.find("[data-role=point-type-selector]").attr("hasData")&&d.find("[data-role=point-type-selector]").data("kendoDropDownList").enable(!1),void 0!==r&&("-"==i||(-1<i.indexOf("Meter.")&&(i="Meter"),r.value(x.getDisplayType(i))))}}(),y=we.find("input[data-role=devicetagname]").kendoCommonValidator({type:"name"}).data("kendoCommonValidator"),w=we.find("input[data-role=devicedescription]").kendoCommonValidator({type:"description"}).data("kendoCommonValidator");for(var l=0;l<we.data("kendoGrid").dataSource.data().length;l++){var c=we.data("kendoGrid").dataSource.data()[l];c.orderingValue=Se[h][x.getDetailDisplayType(c.type)]}}),we.data("kendoGrid").dataSource.bind("change",function(e){})}}),define("devicesettings/controller/controller",["devicesettings/core","devicesettings/controller/sac-sac/sac-sac"],function(e,t){window.MAIN_WINDOW.disableFloorNav(!0);var a=$("#setting-sac-tab");a.kendoCommonTabStrip(),0<a.find(".tabbtn-sac-sac").length&&t()});