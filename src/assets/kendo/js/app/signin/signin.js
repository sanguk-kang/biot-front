window.GlobalSettings.loadSettings(!0).always(function(){$(document).ready(function(){"use strict";var t=window.I18N,a=new window.CommonLoadingPanel,r=window.Session,s=window.Cookies,d=window.Util;window.localStorage.clear();function c(e){e?s.set("isRemember",!0,{expires:730}):(s.remove("isRemember"),s.remove("rememberId"))}var l,u=$("#main"),i=$(".signin-contents-formfieldset"),f=i.find(".signin-form-block").find("input"),o=$("#signin-login"),m=$("<div/>"),p={},w={id:null,password:null,remember:null},v=!1,e=function(){var e=s.get("rememberId");e?(s.get("isRemember")&&w.remember.prop("checked",!0),w.id.val(e),w.password.focus()):w.id.focus()},n=function(){var e,n;for(e in i.on("click",".signin-form-block .signin-input-remove",g),p)"text"!=(n=w[e].attr("type"))&&"password"!=n||(w[e].on("keyup",k),"password"==n&&(w[e].on("keypress",b),w[e].on("keydown",h)));o.on("click",O),w.remember.on("click",N),w.id.on("blur",function(e){var n=e.relatedTarget;n&&"signin-signup-link"===$(n).attr("id")||setTimeout(function(){p.id.validate()},100)}),w.password.on("blur",function(e){var n=e.relatedTarget;n&&"signin-signup-link"===$(n).attr("id")||setTimeout(function(){p.password.validate()},100)})},g=function(){var e=$(this),n=e.data("target"),i=$("#"+n);return i.val(""),i.data("kendoCommonValidator").validate(),e.hide(),!1},k=function(e){var n=$(this),i=n.parent().find(".signin-input-remove");n.val()?i.is(":visible")||i.show():i.hide(),13==e.keyCode&&o.trigger("click")},h=function(e){null!==v&&20===e.keyCode&&(v=!v,y())},b=function(e){var n,i=0;i=e.keyCode,0==e.keyCode&&(i=e.which),n=e.shiftKey,65<=i&&i<=90&&!n||97<=i&&i<=122&&n?v=!0:(65<=i&&i<=90&&n||97<=i&&i<=122&&!n)&&(v=!1),y()},y=function(){v?$(".signin-capslock-on").show():$(".signin-capslock-on").hide(),$("#signin-password").css("padding-right",34+$(".signin-password-right-block").width()-28+"px")},O=function(){var e,n=!0;for(e in p)if(!p[e].validate()){n=!1;break}if(n){var o=p.id.element.val(),i=p.password.element.val();a.open(u),_(o,i).done(function(e){var n,i=e.access_token;r.setAuthToken(i,e.expire_in),w.remember.prop("checked")&&(c(!0),(n=o)?s.set("rememberId",n,{expires:730}):s.remove("rememberId")),$.ajax({url:"/ums/users/"+o,headers:{Authorization:"Bearer "+i}}).done(function(e){r.setUserId(e.id),r.setUserRole(e.role),r.setUserName(e.name),C()}).fail(function(e){var n=d.parseFailResponse(e);l.message(n),l.open()}).always(function(){})}).fail(function(e){var n=d.parseFailResponse(e);400==e.status&&-1!=n.indexOf("invalid_grant")&&-1!=n.indexOf("could not be authenticated")?n=t.prop("COMMON_INCORRECT_USERNAME_AND_PASSWORD"):400==e.status&&-1!=n.indexOf("access_denied")&&-1!=n.indexOf("is currently locked out for")?n=t.prop("COMMON_SIGNIN_LOCKED",o):n&&-1!=n.indexOf("unauthorized_client")&&-1!=n.indexOf("is not yet approved.")&&(n=t.prop("COMMON_SIGN_IN_NOTI_WATING_SIGN_UP")),l.message(n),l.open(),a.close()}).always(function(){})}},C=function(){var e=window.location.protocol+"//"+window.location.host+"/front/dashboard";window.location.href=e},_=function(e,n){var i=e+":"+n,o=window.btoa(i);return $.ajax({method:"POST",url:"/api/login",headers:{Accept:"application/json",Authorization:"Basic "+o}})},N=function(){var e=$(this);if(w.id.val())e.is(":checked")?c(!0):c(!1);else if(w.id.focus(),e.is(":checked"))return!1};(function(){var e,n,i,o;f.each(function(){e=$(this),n=e.data("key"),w[n]=e,"text"!=(i=e.attr("type"))&&"password"!=i||(o={validateOnBlur:!1},"id"!=n&&"password"!=n||(o.type=n),p[n]=e.kendoCommonValidator(o).data("kendoCommonValidator"))}),l=m.kendoCommonDialog().data("kendoCommonDialog")})(),e(),n()})});