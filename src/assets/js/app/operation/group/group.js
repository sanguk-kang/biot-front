define("device/common/device-model",[],function(){"use strict";var e=window.kendo;return{Device:e.data.Model.define({id:"id",fields:{alarms:{type:"object",editType:null},networks:{type:"object"},parentId:{type:"string"},winds:{type:"object"},registrationStatus:{type:"string",options:[{text:"NotRegistered",value:"0"},{text:"Registered",value:"1"},{text:"Deleted",value:"1"}]},name:{type:"string"},information:{type:"object"},subordinateIds:{type:"object"},operations:{type:"object"},mappedType:{type:"string",options:[{text:"ControlPoint",value:"0"},{text:"Light",value:"1"},{text:"Meter.WattHour",value:"2"},{text:"Sensor.Humidity",value:"3"},{text:"Sensor.Motion",value:"4"},{text:"Sensor.Temperature",value:"5"}]},representativeStatus:{type:"string",options:[{text:"Normal.On",value:"0"},{text:"Normal.Off",value:"1"},{text:"Alarm.Critical",value:"2"},{text:"Alarm.Warning",value:"3"},{text:"Alarm.NetworkError",value:"4"},{text:"Disconnected",value:"5"},{text:"LowBattery",value:"6"},{text:"OutOfBounds",value:"7"}]},modes:{type:"object"},controlPoint:{type:"object"},groups:{type:"object"},configuration:{type:"object"},light:{type:"object"},type:{type:"string"},id:{type:"string"},schedules:{type:"object"},description:{type:"string"},locations:{type:"object"},airConditioner:{type:"object"},temperatures:{type:"object"}}}),DevicePopup:e.data.Model.define({id:"id",fields:{id:{name:"Device ID",type:"string",editType:null},name:{name:"Device NAME",type:"string",editType:"input"},representativeStatus:{name:"Status",type:"string",editType:null},modes:{name:"Operation Mode",type:"string",editType:null},temperatureS:{name:"Set Temperature",type:"string",editType:null},temperatureC:{name:"Current Temperature",type:"string",editType:null},locations:{name:"Location",type:"string",editType:"select"},groups:{name:"Group",type:"string",editType:null},"control-point":{name:"Remote Control",type:"string",editType:"input"},model:{name:"Model",type:"string",editType:null},type:{name:"Type",type:"string",editType:null},version:{name:"Firmware Version",type:"string",editType:null},description:{name:"Description",type:"string",editType:"input"}}})}}),define("device/common/device-api",["device/common/device-model"],function(e){"use strict";function n(e){var t="/dms/devices/"+e;return $.ajax({url:t,method:"DELETE"})}function r(e){return $.ajax({url:"/dms/devices",method:"PATCH",data:e})}var B=window.MAIN_WINDOW,F=e.Device,P={"AirConditioner.Indoor":["AirConditioner.*"],AirConditionerOutdoor:["AirConditionerOutdoor"],ControlPoint:["ControlPoint.*"],Meter:["Meter*"],"Sensor.Temperature_Humidity":["Sensor.Temperature_Humidity","Sensor.Temperature","Sensor.Humidity"],Light:["Light"],SmartPlug:["SmartPlug"],"Sensor.Motion":["Sensor.Motion"],Gateway:["Gateway"],Beacon:["Beacon"],CCTV:["CCTV"]},k={ControlPoint:{mappedTypes:"ControlPoint"},Meter:{types:"ControlPoint.*"},"Sensor.Temperature_Humidity":{types:"ControlPoint.*"}},G={"ControlPoint.*":{mappedTypes:["ControlPoint"]},Light:{types:["ControlPoint.*"],mappedTypes:["Light"]},"Meter*":{types:["ControlPoint.*"],mappedTypes:["Meter*"]},"Sensor.Temperature_Humidity":{types:["ControlPoint.*"],mappedTypes:["Sensor.Humidity","Sensor.Temperature","Sensor.Temperature_Humidity"]},"Sensor.Motion":{types:["ControlPoint.*"],mappedTypes:["Sensor.Motion"]}},V={On:{representativeStatuses:"Normal.On"},Off:{representativeStatuses:"Normal.Off"},Critical:{representativeStatuses:"Alarm.Critical"},Warning:{representativeStatuses:"Alarm.Warning"},Normal:{representativeStatuses:"Normal"},"Alarm.Critical":{representativeStatuses:"Alarm.Critical"},"Alarm.Warning":{representativeStatuses:"Alarm.Warning"}};return{getStatisticByKey:function(e){var t;switch(e){case"AirConditioner.Indoor":t="/dms/devices/statisticView/AirConditioner";break;case"Meter":t="/dms/devices/statisticView/Meter";break;case"Sensor.Temperature_Humidity":t="/dms/devices/statisticView/Sensor.Temperature_Humidity";break;case"Light":t="/dms/devices/statisticView/Light";break;case"Sensor.Motion":t="/dms/devices/statisticView/Sensor.Motion";break;case"Gateway":t="/dms/devices/statisticView/Gateway";break;case"CCTV":t="/dms/devices/statisticView/CCTV";break;case"Beacon":t="/dms/devices/statisticView/Beacon";break;case"Asset":t="/dms/devices/statisticView/Asset";break;case"SmartPlug":t="/dms/devices/statisticView/SmartPlug"}return B.getCurrentFloor().building.id==B.FLOOR_NAV_BUILDING_TOTAL_ID&&(t+="?exposeFloors=false"),$.ajax({url:t}).then(function(e){return e=e||[]})},getDeviceWithType:function(e,t,i,a,n){var o;o=$.isArray(e)?e:P[e]?P[e]:[];var r,s,d,l,p,c,u,v,f=new $.Deferred,m="/dms/devices",g="",_={},b={},T=!1,y="",C="",h=(n=n||{}).type,w=n.mode||{},I=n.statuses||[],O=n.zones||[],A=n.name&&n.name.replace(/\s/g,"+")||null;if(h&&"Beacon"!=o[0])s=k[e]&&k[e].types,d=k[e]&&k[e].mappedTypes,_.types=h,d&&(_.mappedTypes=d),s&&(b.types=s,b.mappedTypes=h);else if(o){for(p=0,c=o.length;p<c;p++)r=o[p],!T&&G[r]&&(T=!0,s=G[r].types,d=G[r].mappedTypes,s?(y=m+"?types="+(s=s.join(","))+"&mappedTypes="+(d=d.join(",")),b.types=s,b.mappedTypes=d):d=d.join(",")),g+=r,g+=",";_.types=g.substr(0,g.length-1)}if(0<I.length){for(p=0,c=I.length;p<c;p++)(l=V[l=I[p]]).representativeStatuses&&-1==C.indexOf(l.representativeStatuses)&&(C+=l.representativeStatuses+",");C&&C.lastIndexOf(",")===C.length-1&&(C=C.substr(0,C.length-1)),_.representativeStatuses=C}w.value&&w.id&&(_.equals=w.value,_.equalsAttribute="modes-"+w.id+"-mode"),0<O.length&&(_.foundation_space_zones_id=O.join(",")),A&&(_.contains=A,_.containsAttributes="id,name,controlPoint-tagName");var E=B.getCurrentFloor(),D=E.building,L=E.floor;D.id&&D.id!=B.FLOOR_NAV_BUILDING_TOTAL_ID&&(u=D.id),L.id&&L.id!=B.FLOOR_NAV_FLOOR_ALL_ID&&(v=L.id),t?t=t.join(","):(t="Registered,NotRegistered",-1==m.indexOf("Beacon")||a||(t+=",Blocked")),-1!=t.indexOf("NotRegistered")&&(v=u=null),u&&(_.foundation_space_buildings_id=u),v&&(_.foundation_space_floors_id=v),_.registrationStatuses=t,$.isEmptyObject(b)||(b.registrationStatuses=t,b.foundation_space_buildings_id=u,b.foundation_space_floors_id=v,C&&(b.representativeStatuses=C),w.value&&w.id&&(b.equals=w.value,b.equalsAttribute="modes-"+w.id+"-mode"),0<O.length&&(b.foundation_space_zones_id=O.join(",")),A&&(b.contains=A,b.containsAttributes="id,name,controlPoint-tagName")),T&&!y&&(_.mappedTypes=d),i&&(i.typeQuery&&(_=$.extend(_,i.typeQuery)),i.mappedTypeQuery&&(b=$.extend(b,i.mappedTypeQuery)));var S,N,x=[],R=[],M=[];return b.registrationStatuses&&(m="/dms/devices",b.types&&(m+="?types="+b.types,delete b.types),b.mappedTypes&&(m+=-1!=m.indexOf("?")?"&":"?",m+="mappedTypes="+b.mappedTypes,delete b.mappedTypes),b.representativeStatuses&&(m+=-1!=m.indexOf("?")?"&":"?",m+="representativeStatuses="+b.representativeStatuses,delete b.representativeStatuses),b.foundation_space_zones_id&&(m+=-1!=m.indexOf("?")?"&":"?",m+="foundation_space_zones_id="+b.foundation_space_zones_id,delete b.foundation_space_zones_id),x.push($.ajax({url:m,data:b}).then(function(e){e.page?(R=e.data,S=e.page):R=e}).fail(function(e){f.reject(e)}))),m="/dms/devices",_.types&&(m+="?types="+_.types,"Beacon"==_.types&&h&&(m+="&equals="+h+"&equalsAttribute=configuration-mobilityType"),delete _.types),_.mappedTypes&&(m+=-1!=m.indexOf("?")?"&":"?",m+="mappedTypes="+_.mappedTypes,delete _.mappedTypes),1<_.registrationStatuses.split(",").length&&(m+=-1!=m.indexOf("?")?"&":"?",m+="registrationStatuses="+_.registrationStatuses,delete _.registrationStatuses),_.representativeStatuses&&(m+=-1!=m.indexOf("?")?"&":"?",m+="representativeStatuses="+_.representativeStatuses,delete _.representativeStatuses),_.foundation_space_zones_id&&(m+=-1!=m.indexOf("?")?"&":"?",m+="foundation_space_zones_id="+_.foundation_space_zones_id,delete _.foundation_space_zones_id),x.push($.ajax({url:m,data:_}).then(function(e){M=e.page?(N=e.page,e.data):e}).fail(function(e){f.reject(e)})),$.when.apply(this,x).always(function(){var e,t,i,a,n,o,r=!1;for(i=M.length,a=R.length,e=0;e<a;e++){for(o=R[e],r=!1,t=0;t<i;t++)if(n=M[t],o.id==n.id){r=!0;break}r||M.push(o)}i=M.length;var s=[];for(e=0;e<i;e++)(n=M[e]).locations&&!n.locations[0]&&(n.locations[0]={}),n.assets||(n.assets=[]),n.selected=!1,n=new F(n),s.push(n);if(N||S){var d={data:s,total:0};N&&(d.typePage=N,d.total+=N.totalElements),S&&(d.mappedTypePage=S,d.total+=S.totalElements),f.resolve(d)}else f.resolve(s)}),f.promise()},getDeviceWithID:function(e){var t="/dms/devices/"+e;return $.ajax({url:t})},getDeviceWithMultipleID:function(e){var t="/dms/devices";if(e){for(var i="",a=0,n=e.length;a<n;a++)i+=e[a],i+=",";t+="?ids="+i.substr(0,i.length-1)}return $.ajax({url:t})},patchDevice:function(e,t){var i="/dms/devices/"+e;return $.ajax({url:i,method:"PATCH",data:t})},patchDevices:r,deleteDevice:n,multiControl:function(e){return $.ajax({url:"/dms/devices/multiControl",method:"PUT",data:e})},patchGroupAttr:function(e,t,i){var a="/dms/devices/"+e+"/"+t+"/";return $.ajax({url:a,method:"PATCH",data:i})},deleteDevices:function(e){var t,i=e.length,a=[];for(t=0;t<i;t++)a.push(n(e[t]));return $.when.apply(this,a)},patchOutdoorCurrentLimit:function(e){var t=e.value,i=e.item;return $.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{electricCurrentControl:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.electricCurrentControl&&(i.airConditioner.outdoorUnit.electricCurrentControl=t)})},patchOutdoorHeatingCapacityCalibration:function(e){var t=e.value,i=e.item;$.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{heatingCapacityCalibration:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.heatingCapacityCalibration&&(i.airConditioner.outdoorUnit.heatingCapacityCalibration=t)})},patchOutdoorCoolingCapacityCalibration:function(e){var t=e.value,i=e.item;$.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{coolingCapacityCalibration:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.coolingCapacityCalibration&&(i.airConditioner.outdoorUnit.coolingCapacityCalibration=t)})},getZone:function(e,t){return $.ajax({url:"/foundation/space/zones?foundation_space_floors_id="+e}).then(function(e){return(e=e||[]).sort(function(e,t){return e.sortOrder-t.sortOrder}),t&&e.unshift({id:void 0,name:"No Zone"}),e})},patchRegistrationStatus:function(e,t){var i,a,n=[],o=e.length;for(a=0;a<o;a++)(i={id:e[a].id}).registrationStatus=t,n.push(i);return r(n)},patchControlPointValue:function(e,t){return"number"==typeof t&&(t=t.toString()),$.ajax({url:"/dms/devices/"+e+"/controlPoint",method:"PATCH",data:{value:t}})}}}),define("device/common/device-constants",[],function(){"use strict";var e=window.I18N;return{TIME_OUT:1500,ALL_TIME_INTERVAL:4e4,PANEL_REFRESH_TIME:1e3,BEACON_TIME_INTERVAL:5e3,DISPLAY_NAME_MAX:6,INDOOR_TYPE:["AirConditioner.Indoor","AirConditioner.AHU","AirConditioner.Chiller","AirConditioner.EHS","AirConditioner.ERV","AirConditioner.ERVPlus",["AirConditioner.FCU","AirConditioner.SFCU"],"AirConditioner.DuctFresh"],OUTDOOR_TYPE:["AirConditioneromOutdoor"],POINT_TYPE:["ControlPoint.AI","ControlPoint.AO","ControlPoint.DI","ControlPoint.DO","ControlPoint.AV","ControlPoint.DV"],ENERGY_TYPE:["Meter.WattHour","Meter.Gas","Meter.Water","Meter.Calorimeter"],SENSOR_TEMP_HUM_TYPE:["Sensor.Temperature_Humidity","Sensor.Humidity","Sensor.Temperature"],STATUS:["Normal.On","Normal.Off","Alarm.Critical","Alarm.Warning"],BEACON_STATUS:["Normal","Disconnected","WrongLocation","LowBattery"],BEACON_ACTION:{BLOCK:1,DELETE:2,REGISTER:3,DETAIL:4},BEACON_LOCATION_TYPE:["Fixed","Movable"],ASSET_FILTER:{TYPE:0,LOCATION:1,STATUS:2,ZONE:3,SELECTALL:4},ASSET_ACTION:{ASSET_TYPE:1,EXPORT:2,IMPORT:3,REGISTER:4,DELETE:5,DETAIL:6},ONOFF:["On","Off"],MODE:[{mode:"Auto",id:"AirConditioner.Indoor.General"},{mode:"Cool",id:"AirConditioner.Indoor.General"},{mode:"Heat",id:"AirConditioner.Indoor.General"},{mode:"Dry",id:"AirConditioner.Indoor.General"},{mode:"Fan",id:"AirConditioner.Indoor.General"},{mode:"CoolStorage",id:"AirConditioner.Indoor.General"},{mode:"HeatStorage",id:"AirConditioner.Indoor.General"},{mode:"vAuto",id:"AirConditioner.Indoor.Ventilator"},{mode:"HeatExchange",id:"AirConditioner.Indoor.Ventilator"},{mode:"ByPass",id:"AirConditioner.Indoor.Ventilator"},{mode:"Sleep",id:"AirConditioner.Indoor.Ventilator"},{mode:"Eco",id:"AirConditioner.Indoor.DHW"},{mode:"Standard",id:"AirConditioner.Indoor.DHW"},{mode:"Power",id:"AirConditioner.Indoor.DHW"},{mode:"Force",id:"AirConditioner.Indoor.DHW"}],TEXT:{SELECTALL:e.prop("COMMON_BTN_SELECT_ALL"),DESELECTALL:e.prop("COMMON_BTN_DESELECT_ALL"),REGISTER:e.prop("COMMON_BTN_REGISTER"),DEREGISTER:e.prop("COMMON_BTN_DEREGISTER"),VIEW:e.prop("COMMON_BTN_VIEW"),DELETE:e.prop("COMMON_BTN_DELETE")},FILTER:{TYPE:0,STATUS:1,MODE:2,ZONE:3,SELECTALL:4,REGEND:5},ACTION:{REGISTER:1,DETAIL:2},NW_ACTION:{DELETE:1,REGISTER:2,DETAIL:3,VIEW:4},VIEW:{STATISTIC:0,MAP:1,LIST:2,GRID:3},SEARCH:{EDIT:0,BUTTON:1},displayShort:[{value:"CoolStorage",display:"CoolSt"},{value:"HeatStorage",display:"HeatSt"},{value:"HeatExchange",display:"HeatEx"}],controlSet:[[{apiName:"operations",id:"AirConditioner.Indoor.General",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.Ventilator",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.DHW",parameter:"power"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.General.Speed",parameter:"wind"},{},{apiName:"modes",id:"AirConditioner.Indoor.ModeLimit",parameter:"mode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"}],[{apiName:"configuration",parameter:"remoteControl"},{apiName:"airConditioner",parameter:"filterResetRequired"},{apiName:"airConditioner",parameter:"spi"},{apiName:"airConditioner",parameter:"stillAir"}],{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.Ventilator",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.Ventilator.Speed",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.DHW",parameter:"mode"},[{apiName:"airConditioner",parameter:"chiller",underParameter:"waterLaw"},{apiName:"airConditioner",parameter:"chiller",underParameter:"quiet"},{apiName:"airConditioner",parameter:"chiller",underParameter:"forcedFan"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demand"}],{apiName:"airConditioner",parameter:"chiller",underParameter:"mccMode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"desired"}],[{apiName:"temperatures",id:"AirConditioner.Indoor.Room",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"desired",Heat:"AirConditioner.Indoor.DischargeAir.Heat",Cool:"AirConditioner.Indoor.DischargeAir.Cool"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"enabled"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demandLevel"}],outdoorControlConfig:{electricCurrentControl:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:50,text:"50%"},{value:55,text:"55%"},{value:60,text:"60%"},{value:65,text:"65%"},{value:70,text:"70%"},{value:75,text:"75%"},{value:80,text:"80%"},{value:85,text:"85%"},{value:90,text:"90%"},{value:95,text:"95%"},{value:100,text:"100%"}],coolingCapacityCalibration:{Celsius:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"5~7\xb0C"},{value:"7~9",text:"7~9\xb0C"},{value:"9~11",text:"9~11\xb0C"},{value:"10~12",text:"10~12\xb0C"},{value:"11~13",text:"11~13\xb0C"},{value:"12~14",text:"12~14\xb0C"},{value:"13~15",text:"13~15\xb0C"}],Fahrenheit:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"41~45\xb0F"},{value:"7~9",text:"45~48\xb0F"},{value:"9~11",text:"48~52\xb0F"},{value:"10~12",text:"50~54\xb0F"},{value:"11~13",text:"52~55\xb0F"},{value:"12~14",text:"54~57\xb0F"},{value:"13~15",text:"55~59\xb0F"}]},heatingCapacityCalibration:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:25,text:"25kg/cm\xb2"},{value:26,text:"26kg/cm\xb2"},{value:27,text:"27kg/cm\xb2"},{value:28,text:"28kg/cm\xb2"},{value:29,text:"29kg/cm\xb2"},{value:30,text:"30kg/cm\xb2"},{value:31,text:"31kg/cm\xb2"},{value:32,text:"32kg/cm\xb2"},{value:33,text:"33kg/cm\xb2"}]},INNER_LAYOUT:{MONITORING:0,REGISTRATION:1},FILTER_NAME:{SELECTALL:"selectAll",ZONE:"zone",STATUS:"status",TYPE:"type",MODE:"mode",ASSET_TYPE:"assetType"},ACTION_NAME:{DETAIL:"detail",REGISTER:"register",DELETE:"delete",BLOCK:"block",SELECTEDTEXT:"selectedText",VIEW:"view",ASSET_TYPE:"assetType"},REGISTRATION_STATUS_BUTTONS:{REGISTER:0,UNREGISTER:1},LIGHT_CONTROL:{POWER:0,DIMMING:1}}}),define("device/common/device-util",["device/common/device-constants"],function(s){"use strict";function d(){for(var e=I.getDefaultViewType(),t=e.length,i="statistic",a=0;a<t;a++)if("Facility.Device"==e[a].menu){i=(i=e[a].view).toLowerCase();break}return i}function i(e){var t=e.locations,i="-";if(void 0!==e.assets_types_id)return D(e);if(t&&0<t.length){i="";var a=t[0];if(a.description)return a.description;a.foundation_space_buildings_id&&(i+=a.foundation_space_buildings_id+" "),a.foundation_space_floors_id&&(i+=a.foundation_space_floors_id)}return i}function a(e){var t=e.groups,i="-";if(t){var a=t.length;0<a&&(i="",(i=t[0].dms_groups_name)&&1<a&&(i+="(+"+(a-1)+")"))}return O.decodeHtml(i)}function n(e,t){var i,a,n,o,r=e.temperatures,s=e.airConditioner,d="-",l="-",p=!1;s&&s.temperatureReference&&-1<s.temperatureReference.indexOf("WaterOutlet")&&(p=!0),!r||0<r.length&&(p&&(o=$.grep(r,function(e){return"AirConditioner.Indoor.WaterOutlet"==e.id}))&&o.length&&void 0!==(o=o[0]).desired&&(l=o.desired.toFixed(1)),(o=$.grep(r,function(e){return"AirConditioner.Indoor.Room"==e.id}))&&o.length&&(o=o[0],p||void 0!==o.desired&&(l=o.desired.toFixed(1)),void 0!==o.current&&(d=o.current.toFixed(1))),(o=$.grep(r,function(e){return"AirConditioner.Indoor.DHW"==e.id}))&&o.length&&(void 0!==(o=o[0]).desired&&(i=o.desired.toFixed(1)),void 0!==o.current&&(a=o.current.toFixed(1))),(o=$.grep(r,function(e){return"AirConditioner.Outdoor"==e.id}))&&o.length&&(void 0!==(o=o[0]).desired&&(l=o.desired.toFixed(1)),void 0!==o.current&&(d=o.current.toFixed(1))));var c=e.modes;return c&&(o=$.grep(c,function(e){return"AirConditioner.Indoor.General"==e.id&&"Fan"==e.mode}))&&o.length&&(l="-"),n="Celsius"===I.getTemperature().unit?"\xb0C":"\u2109","-"!==l&&t&&(l+=n),"-"!==d&&t&&(d+=n),i&&t&&(i+=n),a&&t&&(a+=n),{isWaterout:p,desired:l,current:d,unit:n,dhwDesired:i,dhwCurrent:a}}function o(e,n,t){var o;return"vAuto"===t&&(o="AirConditioner.Indoor.Ventilator",t="Auto"),{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){var i,a=e.length;if("undefined"==t){for(i=0;i<a;i++)if(void 0===e[i][n])return!0}else for(i=0;i<a;i++)if(e[i][n]==t)return!o||(o===e[i].id||void 0)}},value:t}}function r(e,n,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){for(var i=e.length,a=0;a<i;a++)if(e[a][n]!=t)return;return!0}},value:t}}function l(e){return{field:e,operator:function(e){if(e)return 0===e.length||void 0}}}function p(e){var t,i,a,n,o="-";if(i=e.meters){for(o="",a=i.length,t=0;t<a;t++)(n=i[t].category)&&("AirConditionerAll"==n&&(n="SAC"),o+=n,t!=a-1&&(o+=", "));o=(o=o||"Others").toUpperCase(),o=A.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_"+o)}return o}function c(e){var t="-",i=e.type;return i&&(-1!=i.indexOf("ControlPoint")&&(i=e.mappedType),t=(t=(t=O.getDisplayType(i))||"WattHour").toUpperCase(),t=(t=A.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_"+t))||A.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATTHOUR")),t}function u(e){var t,i,a,n,o="",r=e.type;if(r&&-1!=r.indexOf("ControlPoint")){var s=e.controlPoint;s&&void 0!==s.value&&(o=O.convertNumberFormat(s.value))}else if(i=e.meters)for(a=i.length,t=0;t<a;t++)null!=(n=O.convertNumberFormat(i[t].reading))&&(o+=n,t!=a-1&&(o+=", "));return o=""!=o?o:"-"}function v(e){var t,i="-",a=e.networks;return a&&a[0]&&(a=a[0],e.type,a[t="ethernet"]&&(i=(i=a[t].ipAddress)||"-")),i}function f(e){var t,i="-",a=e.networks;return a&&a[0]&&(a=a[0],e.type,a[t="ethernet"]&&(i=(i=a[t].macAddress)||"-")),i}function m(e){var t,i,a="-",n=e.networks;return n&&n[1]&&((n=n[1]).connected?(t=e.alarms)&&0<t.length?(t.sort(function(e,t){return e=e.alarms_event?e.alarms_event:"-",(t=t.alarms_event?t.alarms_event:"-").localeCompare(e)}),"Critical"==(i=t[0].alarms_type)?a="Connected (Poor)":"Warning"==i&&(a="Connected (Fair)")):a="Connected (Good)":a="Disconnected",a=a||"-"),a}function g(e,t,i,a){var n,o,r,s=0;if((n=e.networks)&&n[0])for(r=n.length,o=0;o<r;o++)if(n[o].type==t){if(!i)return n[o];if(n[o].ble&&n[o].ble.role==i){if(void 0===a)return n[o];if(a==s)return n[o];s++}}return{}}function _(e,t){var i,a,n,o="-",r=e.networks;if(r&&r[0]){for(a=r.length,i=0;i<a;i++)if(r[i].ble){n=r[i].ble;break}n&&(o=(o=n[t])||"-")}return o}function b(e){return _(e,"macAddress")}function T(e){return _(e,"uuid")}function y(e){var t="-",i=e.rules;return i&&(t=0<i.length?"O":"X"),t}function C(e){var t="-",i=e.schedules;return i&&(t=0<i.length?"O":"X"),t}function t(e,t){var i,a="-",n=e.information;if(n&&n.versions){var o,r=(i=n.versions).length;for(o=0;o<r;o++)if(i[o].type==t){a=i[o].number?i[o].number:a;break}}return a}function h(e){var t="-";return e.controlPoint&&e.controlPoint.tagName&&(t=e.controlPoint.tagName),t}var w=window.MAIN_WINDOW,I=window.GlobalSettings,O=window.Util,A=window.I18N,E=window.kendo,D=function(e){var t="-",i=e.location;if(i){if(i.description)return i.description;t="",i.foundation_space_buildings_id&&(t+=i.foundation_space_buildings_id+" "),i.foundation_space_floors_id&&(t+=i.foundation_space_floors_id)}return t};return{isAllFloorCheck:function(){var e=!1,t=w.getCurrentFloor();return t&&t.floor&&"ALL"==t.floor.value&&(e=!0),e},getDefaultView:d,goClick:function(e,t,i,a){var n,o={};if(void 0===a){var r=window.localStorage.getItem("deviceViewType");r?(n=s.VIEW[r],window.localStorage.removeItem("deviceViewType")):n=s.VIEW[d().toUpperCase()]}else n=a;return e?t?i==w.FLOOR_NAV_BUILDING_TOTAL_ID||i==w.FLOOR_NAV_FLOOR_ALL_ID?n===s.VIEW.MAP&&(n=s.VIEW.STATISTIC):n===s.VIEW.STATISTIC&&(n=s.VIEW.MAP):n===s.VIEW.MAP?i==w.FLOOR_NAV_BUILDING_TOTAL_ID?o.building=!0:i==w.FLOOR_NAV_FLOOR_ALL_ID&&(o.floor=!0):n===s.VIEW.STATISTIC&&i!=w.FLOOR_NAV_BUILDING_TOTAL_ID&&i!=w.FLOOR_NAV_FLOOR_ALL_ID&&(o.floor=!1):(i==w.FLOOR_NAV_BUILDING_TOTAL_ID?o.building=!0:i==w.FLOOR_NAV_FLOOR_ALL_ID&&(o.floor=!0),n=s.VIEW.MAP),o.floor&&!w.getCurrentFloorList().length&&(o.floor=!1,o.noFloor=!0),o.view=n,o},getStatus:function(e){return O.getStatus(e)},getLocation:i,getCurrentLocation:function(e){var t,i,a=e.locations,n="-";if(a)for(i=a.length,t=0;t<i;t++)if("Measured"==a[t].id){n="";var o=a[t];if(o.description)return o.description;o.foundation_space_buildings_id&&(n+=o.foundation_space_buildings_id+" "),o.foundation_space_floors_id&&(n+=o.foundation_space_floors_id);break}return n},locations:i,getGroup:a,group:a,getGridIcon:function(e){var t=0,i=[],a=e.airConditioner;if(a){var n=a.peakPowerControl;n&&"On"===n&&t<5&&(i[t++]="ic-peak")}var o=e.configuration;if(o){var r=o.remoteControl;r&&"NotAllowed"===r&&t<5&&(i[t++]="ic-rc-disable")}var s=e.modes;if(s){var d=$.grep(s,function(e){return"AirConditioner.Indoor.ModeLimit"==e.id}),l=d[0]?d[0].mode:void 0;l&&("HeatOnly"===l||"CoolOnly"===l)&&t<5&&(i[t++]="ic-rock")}var p=e.temperatures;if(p){var c=[];c.push($.grep(p,function(e){return"AirConditioner.Indoor.Room.Cool.Limit"==e.id})),c.push($.grep(p,function(e){return"AirConditioner.Indoor.Room.Heat.Limit"==e.id})),c.push($.grep(p,function(e){return"AirConditioner.Indoor.WaterOutlet.Cool.Limit"==e.id})),c.push($.grep(p,function(e){return"AirConditioner.Indoor.WaterOutlet.Heat.Limit"==e.id})),c.push($.grep(p,function(e){return"AirConditioner.Indoor.DHW.Limit"==e.id}));for(var u=!1,v=c.length,f=0;f<v;f++){var m=c[f][0];if(m&&m.enabled){u=!0;break}}u&&t<5&&(i[t++]="ic-thurmo")}if(a){var g=a.defrost;g&&"On"===g&&t<5&&(i[t++]="ic-deforest"),a.filterResetRequired&&t<5&&(i[t++]="ic-filter")}var _=e.schedules;if(_&&0<_.length&&t<5&&(i[t++]="ic-schedule"),a){var b=a.spi;b&&"On"===b&&t<5&&(i[t++]="ic-spi");var T=a.chiller;if(T){var y=T.freezeProtection;y&&"On"===y&&t<5&&(i[t++]="ic-antifreeze")}}return i},getTemperatures:n,curTemperatures:function(e){var t=n(e,!0),i=t.dhwCurrent;return i?t.current+", "+i:t.current},setTemperatures:function(e){var t=n(e,!0),i=t.dhwDesired;return i?t.desired+", "+i:t.desired},curOutdoorTemperature:function(e){return n(e,!0).current},columnMode:function(e){var t=$("<div/>"),i=$("<span/>"),a=e.modes;return a=a&&a.length?a[0].mode:"-",i.text(a).appendTo(t),t.html()},filter0Depth:function(e,t,i){return{field:e,operator:t,value:i}},filter0DepthEmptyList:function(e){return{field:e,operator:function(e){if(e&&e.length)return!0}}},filter1Depth:o,filter1DepthNone:r,filter1DepthNull:l,filter1DepthObj:function(e,i,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e)if("undefined"==t){if(void 0===e[i])return!0}else if(e[i]==t)return!0},value:t}},filterStatusNoAlarm:function(e,t,i,a){var n=[];return"On"===i?n.push(o(e,t,i)):n.push(r(e,t,i)),n.push(l(a)),{logic:"and",filters:n}},filter2Depth:function(e,d,l,p){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){p="undefined"==p?void 0:p;var i,a,n,o,r,s=e.length;for(i=0;i<s;i++){if(!(o=e[i][d])||!o.length)return;for(n=o.length,a=0;a<n;a++)if(void 0!==(r=o[a][l])&&($.isFunction(t)&&(t=t(r)),r==t))return!0}}},value:p}},convertStatistic:function(e,t,i){var a,n,o,r=[];if(e==w.FLOOR_NAV_BUILDING_TOTAL_ID)for(a=0,n=t.length;a<n;a++)o={},$.each(t[a],function(e,t){"foundation_space_buildings_id"===e?e="id":"foundation_space_buildings_name"===e&&(e="name"),o[e]=t}),r.push(o);else for(a=0,n=t.length;a<n;a++)if(e==t[a].foundation_space_buildings_id){for(var s=t[a].floors,d=0,l=s.length;d<l;d++)if(o={},$.each(s[d],function(e,t){if("foundation_space_floors_id"===e)e="id";else if("foundation_space_floors_name"===e){e="name";var i=o.type;"B"===i?t=i+t:"F"==i&&(t+=i)}else"foundation_space_floors_type"===e&&(e="type");o[e]=t}),r.push(o),i){var p,c=s[d].assetTypes;if(c){var u,v,f,m,g,_=c.length;for(u=0;u<_;u++)for(p=c[u].assets_types_name,f=(m=c[u].subAssetTypes).length,v=0;v<f;v++)(g=$.extend({},o,m[v])).isSubAsset=!0,g.assets_types_name=p,r.push(g)}}var b=$.extend({},t[a]);b.id=b.foundation_space_buildings_id,b.name="All",r.push(b);break}return r},convertDisplayName:function(e){return e&&e.length>s.DISPLAY_NAME_MAX?e.substr(0,s.DISPLAY_NAME_MAX):e},getAccureFilter:function(e,t,i,a,n){var o;if(o=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length){var r={logic:"and",filters:t};o.filters.push(r)}if(i&&i.length){var s={logic:"or",filters:i};o.filters.push(s)}if(a&&a.length){var d={logic:"or",filters:a};o.filters.push(d)}if(n&&n.length){var l={logic:"or",filters:n};o.filters.push(l)}return o},getAccureFilterOlder:function(e,t,i,a,n){var o;o=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length&&(o={logic:"and",filters:[o,{logic:"and",filters:t}]});i&&i.length&&(o={logic:"and",filters:[o,{logic:"or",filters:i}]});a&&a.length&&(o={logic:"and",filters:[o,{logic:"or",filters:a}]});n&&n.length&&(o={logic:"and",filters:[o,{logic:"or",filters:n}]});return o},calcScreenBySelect:function(e,t,i){var a=e.length;return 0<a?A.prop("FACILITY_DEVICE_SELECTED",a):void 0===t||void 0===i?"":A.prop("FACILITY_DEVICE_NO_SELECTED_TOTAL",t,i)},calcScreenByOnlySelect:function(e){var t=e.length;return 0<t?A.prop("FACILITY_DEVICE_SELECTED",t):A.prop("FACILITY_DEVICE_NO_SELECTED")},getTempHumiTemperature:function(e,t){var i="-",a=e.temperatures,n=e.type;if(n&&-1!=n.indexOf("ControlPoint")){var o=e.mappedType;if(o&&-1!=o.indexOf("Temperature")){var r=e.controlPoint;r&&void 0!==r.value&&(i=r.value)}}else a&&a[0]&&(i=(a=a[0]).current);"-"==(i=O.convertNumberFormat(i))||t||(i+="Celsius"===I.getTemperature().unit?"\xb0C":"\u2109");return i},getTempHumiHumidity:function(e,t){var i="-",a=e.humidities,n=e.type;if(n&&-1!=n.indexOf("ControlPoint")){var o=e.mappedType;if(o&&-1!=o.indexOf("Humidity")){var r=e.controlPoint;r&&void 0!==r.value&&(i=r.value)}}else a&&a[0]&&(i=(a=a[0]).current);return"-"==(i=O.convertNumberFormat(i))||t||(i+="%"),i},getMotionPresence:function(e){var t="-",i=e.presences;return i&&i[0]&&(t=(t=(i=i[0]).detected)?A.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"):A.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE")),t},getMacAddress:f,getIpAddress:v,getWifiIpAddress:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.ipAddress)||"-"),t},getWifiMacAddress:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.macAddress)||"-"),t},getWifiChannel:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.channel)||"-"),t},getWifiRssi:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.rssi)||"-"),t},getCCTVWifiStatus:m,getCCTVDataStatus:function(e){var t="Off",i=e.cctvs;return i&&i[0]&&"On"==(i=i[0]).dataStatus&&(t="On"),t},getCCTVWifiTxPower:function(e){var t="-",i=e.wifi;return i&&(t=(t=i.txPower)||"-"),t},getCCTVWifiType:function(e){var t="-",i=e.networks;return i&&i[1]&&("WiFi2.4GHz"==(i=i[1]).type?t="2.4GHz":"WiFi5GHz"==i.type&&(t="5GHz"),t=t||"-"),t},getCCTVWifiTotal:function(e){var t="-",i=e.wifi;return(i=i&&i.statistics)&&i.channelUtilization&&(t=(t=i.channelUtilization.total)||"-"),t},getCCTVWifiNoneWifi:function(e){var t="-",i=e.wifi;return(i=i&&i.statistics)&&i.channelUtilization&&(t=(t=i.channelUtilization["non802.11"])||"-"),t},getCCTVWifiInterfererDataSource:function(e){var t=[],i=e.wifi;return(i=i&&i.statistics)&&i.interferers&&(t=i.interferers),t},getBleObject:_,getBleMacAddress:b,getBleUUID:T,getBleMajor:function(e){return _(e,"major")},getBleMinor:function(e){return _(e,"minor")},getBleTxPower:function(e){var t=_(e,"txPower");return"999"!=t&&999!=t||(t="-"),t},getBle1mRssi:function(e){return _(e,"calibratedTxPower")},getBleSignalLevel:function(e){var t=_(e,"rssi");return"-"!=t&&(t+=" dBm"),t},getBleBatteryLevel:function(e){var t,i="-",a=e.information;return a&&a.power&&(t=a.power.batteryLevel)&&(i=t||"-"),i},getBleWritable:function(e){var t=_(e,"writable");return t="-"==t?"READ Only":"READ / WRITE"},getBleAdvertisingName:function(e){return _(e,"advertisingName")},getBleAdvertisingInterval:function(e){return _(e,"advertisingInterval")},getNetworkInterface:g,getNetworkInterfaceIndex:function(e,t,i,a,n){var o,r,s,d=0;if((o=e.networks)&&o[0])for(s=o.length,r=0;r<s;r++)if(o[r].type==t){if(!i)return r;if(o[r].ble&&o[r].ble.role==i){if(null==a)return r;if(a==d)return r;d++}}return n?-1:0},getBleObjectFromNetwork:function(e,t){var i="-";return e&&e.ble&&(i=void 0!==(i=e.ble[t])?i:"-"),i},getWifiObjectFromNetwork:function(e,t){var i="-";return e&&e.wifi&&(i=void 0!==(i=e.wifi[t])?i:"-"),i},getZigbeeStatus:function(e){return g(e,"Zigbee").enabled?"Normal.On":"Normal.Off"},getBleStatus:function(e){return g(e,"BLE","Scanner").enabled?"Normal.On":"Normal.Off"},getBleInterfaceStatus:function(e,t){return g(e,"BLE","Advertiser",t).enabled?"Normal.On":"Normal.Off"},getHasSchedule:C,getHasRule:y,getDescription:function(e){var t="-",i=e.description;return i&&(t=i),O.decodeHtml(t)},getFirmwareVersion:function(e){return t(e,"Firmware")},getZigbeeFirmwareVersion:function(e){return t(e,"Firmware.Zigbee")},getBleFirmwareVersion:function(e){return t(e,"Firmware.BLE")},getBleAppVersion:function(e){return t(e,"Application.BLE")},getHardwareVersion:function(e){return t(e,"Hardware")},getSoftwareVersion:function(e){return t(e,"Software")},getApiVersion:function(e){return t(e,"API")},getPowerAvailableSource:function(e){var t="-",i=e.information;return i&&i.power&&((t=i.power.availableSources||"-")instanceof E.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},getPowerCurrentSource:function(e){var t="-",i=e.information;return i&&i.power&&((t=i.power.currentSource||"-")instanceof E.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},sortableLocation:function(e,t){return e=(e=i(e))||"-",t=(t=i(t))||"-",e.localeCompare(t)},sortableGroup:function(e,t){return e=(e=a(e))||"-",t=(t=a(t))||"-",e.localeCompare(t)},getLocationSort:function(){var e=w.getCurrentFloor(),t=!0;return e.building.id!=w.FLOOR_NAV_BUILDING_TOTAL_ID&&e.floor.id!=w.FLOOR_NAV_FLOOR_TOTAL_ID||(t=!1),t?[{field:"locations",dir:"asc",compare:function(e,t){var i,a;i=e.locations,a=t.locations;var n="-",o="-";return i=i&&i[0]?i[0]:"-",a=a&&a[0]?a[0]:"-","-"!=i&&(i.foundation_space_zones_id||(n="\u03a9"+(n=e.name))),"-"!=a&&(a.foundation_space_zones_id||(o="\u03a9"+(o=t.name))),n.localeCompare(o)}}]:[]},getPointTagName:h,sortablePointTagName:function(e,t){return e=h(e),t=h(t),e.localeCompare(t)},sortablePointValue:function(e,t){var i,a;return e.controlPoint&&(i=e.controlPoint.value),t.controlPoint&&(a=t.controlPoint.value),i-a},sortableMeterType:function(e,t){var i,a;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return i=c(e),a=c(t),i.localeCompare(a)},sortableMeterCategoryType:function(e,t){var i,a;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return i=p(e),a=p(t),i.localeCompare(a)},sortableMacAddress:function(e,t){return e=(e=f(e))||"-",t=(t=f(t))||"-",e.localeCompare(t)},sortableBleMacAddress:function(e,t){return e=b(e),t=b(t),e.localeCompare(t)},sortableIpAddress:function(e,t){return e=(e=v(e))||"-",t=(t=v(t))||"-",e.localeCompare(t)},sortableHasSchedule:function(e,t){return e=C(e),t=C(t),e.localeCompare(t)},sortableHasRule:function(e,t){return e=y(e),t=y(t),e.localeCompare(t)},sortableBeaconUUID:function(e,t){return e=T(e),t=T(t),e.localeCompare(t)},sortableCCTVWifiStatus:function(e,t){return e=m(e),t=m(t),e.localeCompare(t)},getIndoorMode:function(e){var t="-",i=O.getRecentAlarm(e);return t=i?(t=i.type,A.prop("FACILITY_DEVICE_STATUS_"+t.toUpperCase())||t):O.getDisplayModeI18N(e.modes,e.operations,!0," / ")},getAssetType:function(e){return(e.assets_types_name?e.assets_types_name:"-")+" / "+(e.subAssetType?e.subAssetType:"-")},getAssetLocation:D,getAssetUsers:function(e){var t="-",i=e.users;if(i&&i[0]){t="";var a,n=i.length;for(a=0;a<n;a++)t+=i[a].ums_users_name,a!=n-1&&(t+=", ")}return t},getMeterCategoryType:p,getMeterType:c,getMeterCurrentConsumption:u,getMeterCurrentConsumptionUnit:function(e){var t=e.type,i=e.mappedType,a="",n=window.Util;return a="Meter.Gas"==t||"Meter.Gas"==i?n.CHAR.Gas:"Meter.WattHour"==t||"Meter.WattHour"==i?n.CHAR.WattHour:"Meter.Water"==t||"Meter.Water"==i?n.CHAR.Water:"",u(e)+a},getDimmingLevel:function(e){var t,i="-",a=e.lights||e.light;return a&&a[0]&&(i=void 0===(t=(a=a[0]).dimmingLevel)?"-":Math.round(t)+"%"),i},getTempWeatherStation:function(e){var t="-",i=e.configuration;return i&&i.locationType&&(t=i.locationType),t},getTempWeatherStationOx:function(e){var t="-",i=e.configuration;return i&&i.locationType&&(t="Outdoor"==(t=i.locationType)?"O":"X"),t},getPointValue:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.value&&(t=i.value),t},getAssetUserName:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_name),t},getAssetUserID:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_id),t},getAssetUserEmail:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_email),t},getAssetUserOrganization:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_organization?i[0].ums_users_organization:"-"),t},getAssetUserWorkPhoneNumber:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_workPhoneNumber?i[0].ums_users_workPhoneNumber:"-"),t},getAssetUserMobilePhoneNumber:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_mobilePhoneNumber?i[0].ums_users_mobilePhoneNumber:"-"),t},getAssetDeviceID:function(e){var t="-",i=e.devices;return i&&i[0]&&(t=i[0].dms_devices_id),t},getAssetDeviceName:function(e){var t="-",i=e.devices;return i&&i[0]&&(t=i[0].dms_devices_name),t},getEnergyMappingOutdoorList:function(p){var c,u=new $.Deferred,v=w.getCurrentBuildingList();return $.ajax({url:"/foundation/space/floors"}).done(function(e){c=e,$.ajax({url:"/dms/devices?types=AirConditionerOutdoor&registrationStatuses=Registered&attributes=id,name,locations"}).done(function(e){var t,i,a,n,o,r,s,d,l=e.length;for(r=0;r<l;r++){if((t=e[r]).locations&&t.locations[0]){for(n=t.locations[0].foundation_space_buildings_id,o=t.locations[0].foundation_space_floors_id,d=v.length,s=0;s<d;s++)if(n==(i=v[s]).id){t.building_group_value=E.toString(i.sortOrder,"0000")+"_"+i.id+"_"+i.name;break}for(d=c.length,s=0;s<d;s++)if(o==(a=c[s]).id){t.floor_group_value=E.toString(a.sortOrder,"0000")+"_"+a.id+"_"+O.getFloorName(a);break}}for(t.assigned=!1,d=p.length,s=0;s<d;s++)if(t.id==p[s].dms_devices_id){t.assigned=!0;break}}u.resolve(e)}).fail(function(e){u.reject(e)})}).fail(function(e){u.reject(e)}),u.promise()},isEnableEnergyMappingType:function(e){var t,i,a=e.mappedType||e.type,n=e.meters;if(!n)return!1;var o,r=n.length;for(o=0;o<r;o++)"AirConditionerAll"==n[o].category&&(t=n[o].category),"AirConditionerOutdoor"==n[o].connectedDeviceType&&(i=n[o].connectedDeviceType);return!("Meter.WattHour"!=a||!t||!i)},getEnergyMappingFieldName:function(e){var t=0,i=e.meters;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("AirConditionerAll"==i[a].category&&"AirConditionerOutdoor"==i[a].connectedDeviceType){t=a;break}}return"meters["+t+"].connectedDevices"},getMeterConnectedDevices:function(e){var t=0,i=e.meters;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("AirConditionerAll"==i[a].category&&"AirConditionerOutdoor"==i[a].connectedDeviceType){t=a;break}}return i[t]&&i[t].connectedDevices?i[t].connectedDevices:null},getDeviceRegistrationFailMsg:function(e){return 406==e.status&&-1!=e.responseText.indexOf("Count")?A.prop("FACILITY_DEVICE_COUNT_EXCEEDED"):O.parseFailResponse(e)},getConnectedDevicesConsumptionTypeList:function(e){var t={AirConditionerAll:{name:A.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_SAC"),id:"AirConditionerAll"},Light:{name:A.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_LIGHT"),id:"Light"},Others:{name:A.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_OTHERS"),id:"Others"}},i=[];return i.push(t.AirConditionerAll),"Meter.WattHour"===e&&i.push(t.Light),i.push(t.Others),i},getConnectedDevicesConnectionTypeList:function(e,t){var i={None:{name:"None",id:"None"},AirConditioner:{name:O.getDetailDisplayTypeDeviceI18N("SAC Indoor"),id:"AirConditioner"},AirConditionerOutdoor:{name:O.getDetailDisplayTypeDeviceI18N("SAC Outdoor"),id:"AirConditionerOutdoor"},Boiler:{name:O.getDetailDisplayTypeDeviceI18N("Boiler"),id:"Boiler"},CoolingTower:{name:O.getDetailDisplayTypeDeviceI18N("CoolingTower"),id:"CoolingTower"},Pump:{name:O.getDetailDisplayTypeDeviceI18N("Pump"),id:"Pump"},WaterTank:{name:O.getDetailDisplayTypeDeviceI18N("WaterTank"),id:"WaterTank"}},a=[];return"AirConditionerAll"===t&&("Meter.WattHour"===e?a.push(i.AirConditioner,i.AirConditionerOutdoor,i.Pump,i.CoolingTower,i.Boiler):"Meter.Gas"===e?a.push(i.Boiler):"Meter.Water"===e&&a.push(i.WaterTank)),a.push(i.None),a},filterHasListAttrItem:function(e,t){return{field:e,operator:function(e){return e&&e.length?t:!t}}}}}),define("device/common/device-template",["device/common/device-util","device/common/device-constants"],function(S,p){"use strict";function t(e,t,i){var a=e.sender,n=a.dataSource.view(),o=$.grep(n,function(e){return"all"==e.name.toLowerCase()});if(o&&o.length){var r=a.element;r.find(".customStatisticRowStyles").remove();var s=a.items().first().clone();s.attr("data-uid",""),s.data("uid","");var d=s.find("td[role='gridcell']");if(!d.length)return;var l;if(o=o[0],a.dataSource.remove(o),l=o.name,$(d.get(0)).html(l),t){var p=void 0!==o.numberOfSubAssetTypes?o.numberOfSubAssetTypes:"-",c=void 0!==o.numberOfRegisteredAssets?o.numberOfRegisteredAssets:"-",u=void 0!==o.numberOfNormalDevices?o.numberOfNormalDevices:"-",v=void 0!==o.numberOfDisconnectedDevices?o.numberOfDisconnectedDevices:"-",f=void 0!==o.numberOfLowBatteryDevices?o.numberOfLowBatteryDevices:"-",m=void 0!==o.numberOfOutOfBoundsDevices?o.numberOfOutOfBoundsDevices:"-";$(d.get(1)).html(p),$(d.get(2)).html(c),$(d.get(3)).html(u),$(d.get(4)).html(v),$(d.get(5)).html(f).addClass("text-err"),$(d.get(6)).html(m).addClass("text-err")}else if(i)$(d.get(1)).html(V(o)),$(d.get(2)).html(U(o)),$(d.get(3)).html(Y(o)),$(d.get(4)).html(W(o)),$(d.get(5)).html(H(o)),$(d.get(6)).html(j(o)),$(d.get(7)).html(z(o)),$(d.get(8)).html(Z(o));else{var g=F(o),_=B(o),b=M(o),T=k(o),y=G(o);$(d.get(1)).html(g);var C,h,w,I,O,A,E,D=d.length;if(7==D)C=void 0!==o.numberOfOnIndoorDevices?o.numberOfOnIndoorDevices:"-",h=void 0!==o.numberOfOnVentilatorDevices?o.numberOfOnVentilatorDevices:"-",w=void 0!==o.numberOfOnDHWDevices?o.numberOfOnDHWDevices:"-",I=void 0!==o.numberOfOffIndoorDevices?o.numberOfOffIndoorDevices:"-",O=void 0!==o.numberOfOffVentilatorDevices?o.numberOfOffVentilatorDevices:"-",A=void 0!==o.numberOfOffDHWDevices?o.numberOfOffDHWDevices:"-",E=void 0!==o.numberOfSchedules?o.numberOfSchedules:"-",$(d.get(2)).html(C+"/"+h+"/"+w),$(d.get(3)).html(I+"/"+O+"/"+A),$(d.get(4)).html(_).addClass("text-err"),$(d.get(5)).html(b).addClass("text-err"),$(d.get(6)).html(E);else if(6==D)$(d.get(2)).html(T),$(d.get(3)).html(y),$(d.get(4)).html(_).addClass("text-err"),$(d.get(5)).html(b).addClass("text-err");else if(5==D){var L;L=P(o),$(d.get(2)).html(L),$(d.get(3)).html(_).addClass("text-err"),$(d.get(4)).html(b).addClass("text-err")}}s.addClass("customStatisticRowStyles"),r.find(".k-grid-header table thead").append(s)}}var e=window.kendo,N=window.Util,x=window.I18N,I=window.GlobalSettings,R=I.getLocale(),c=I.getTemperature().unit,M=function(e){return'<span class="text-err">'+(void 0!==e.numberOfWarningDevices?e.numberOfWarningDevices:"-")+"</span>"},B=function(e){return'<span class="text-err">'+(void 0!==e.numberOfCriticalDevices?e.numberOfCriticalDevices:"-")+"</span>"},F=function(e){return void 0!==e.numberOfRegisteredDevices?e.numberOfRegisteredDevices:"-"},P=function(e){return void 0!==e.numberOfNormalDevices?e.numberOfNormalDevices:"-"},k=function(e){return void 0!==e.numberOfOnDevices?e.numberOfOnDevices:"-"},G=function(e){return void 0!==e.numberOfOffDevices?e.numberOfOffDevices:"-"},V=function(e){return"<div class='tb beacon'><span class='tbc col-1'>"+F(e)+"</span></div>"},U=function(e){var t=void 0!==e.numberOfFixedDevices?e.numberOfFixedDevices:"-",i=void 0!==e.numberOfMovableDevices?e.numberOfMovableDevices:"-";return"<div class='tb beacon'><span class='tbc col-2'>"+x.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED_TYPE")+"</span><span class='tbc col-3'>"+t+"</span></div><div class='tb beacon'><span class='tbc col-2'>"+x.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE_TYPE")+"</span><span class='tbc col-3'>"+i+"</span></div>"},Y=function(e){return"<div class='tb beacon'><span class='tbc col-4'>"+(void 0!==e.numberOfFixedNormalDevices?e.numberOfFixedNormalDevices:"-")+"</span></div><div class='tb beacon'><span class='tbc col-4'>"+(void 0!==e.numberOfMovableNormalDevices?e.numberOfMovableNormalDevices:"-")+"</span></div>"},W=function(e){return"<div class='tb beacon'><span class='tbc col-5'>"+(void 0!==e.numberOfFixedCriticalDevices?e.numberOfFixedCriticalDevices:"-")+"</span></div><div class='tb beacon'><span class='tbc col-5'>"+(void 0!==e.numberOfMovableCriticalDevices?e.numberOfMovableCriticalDevices:"-")+"</span></div>"},H=function(e){return"<div class='tb text-err beacon'><span class='tbc col-6'>"+(void 0!==e.numberOfFixedWarningDevices?e.numberOfFixedWarningDevices:"-")+"</span></div><div class='tb text-err beacon'><span class='tbc col-6'>"+(void 0!==e.numberOfMovableWarningDevices?e.numberOfMovableWarningDevices:"-")+"</span></div>"},j=function(e){return"<div class='tb text-err beacon'><span class='tbc col-7'>"+(void 0!==e.numberOfFixedLowBatteryDevices?e.numberOfFixedLowBatteryDevices:"-")+"</span></div><div class='tb text-err beacon'><span class='tbc col-7'>"+(void 0!==e.numberOfMovableLowBatteryDevices?e.numberOfMovableLowBatteryDevices:"-")+"</span></div>"},z=function(e){return"<div class='tb beacon'><span class='tbc col-8'>"+(void 0!==e.numberOfFixedSchedules?e.numberOfFixedSchedules:"-")+"</span></div><div class='tb beacon'><span class='tbc col-8'>"+(void 0!==e.numberOfMovableSchedules?e.numberOfMovableSchedules:"-")+"</span></div>"},Z=function(e){return"<div class='tb beacon'><span class='tbc col-9'>"+(void 0!==e.numberOfFixedRules?e.numberOfFixedRules:"-")+"</span></div><div class='tb beacon'><span class='tbc col-9'>"+(void 0!==e.numberOfMovableRules?e.numberOfMovableRules:"-")+"</span></div>"},i='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+x.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+x.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</li><li><span class="disc r"></span>'+x.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+x.prop("FACILITY_DEVICE_STATUS_WARNING")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-peak"></Label>'+x.prop("FACILITY_INDOOR_STATUS_PEAK")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-deforest"></Label>'+x.prop("FACILITY_INDOOR_STATUS_DEFROST")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-filter" ></Label>'+x.prop("FACILITY_INDOOR_STATUS_FILTER_WARNING")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-rc-disable"></Label>'+x.prop("FACILITY_INDOOR_STATUS_RC_OFF")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-rock"></Label>'+x.prop("FACILITY_INDOOR_STATUS_OPERATION_LIMIT")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-thurmo"></Label>'+x.prop("FACILITY_INDOOR_TEMPERATURE_LIMIT")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-schedule"></Label>'+x.prop("FACILITY_DEVICE_SAC_INDOOR_SCHEDULE")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-spi"></Label>'+x.prop("FACILITY_INDOOR_CONTROL_SPI")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-antifreeze"></Label>'+x.prop("FACILITY_INDOOR_STATUS_FREEZE_PROTECTION")+"</li></ul></div>",a='<div class="flyoutBox lg"><ul class="legendList"><li><span class="disc g"></span>'+x.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</li><li class="no-block"><span class="disc r"></span>'+x.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li class="no-block"><span class="disc y"></span>'+x.prop("FACILITY_DEVICE_STATUS_WARNING")+'</li></ul><ul class="legendList"><li><span class="disc gr"></span>'+x.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED")+'</li><li><span class="disc measured gr"></span>'+x.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE")+"</li></ul></div>",n='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+x.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+x.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+"</li></ul></div>",o='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+x.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</li><li><span class="disc r"></span>'+x.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+x.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li></ul></div></div>",r='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+x.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+x.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</li><li><span class="disc r"></span>'+x.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+x.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li></ul></div></div>",u=e.template('<span title="" class="k-widget k-dropdown k-header common-grid-dropdown sac-indoor-dropdownlist"unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-busy="false"aria-activedescendant="80142285-e564-4717-88fa-3dd3d64ad025" data-field="#=field#"><span unselectable="on" class="k-dropdown-wrap #if(disabled){#k-state-disabled#}else{#k-state-default#}#"><span unselectable="on" class="k-input">#=text#</span><span unselectable="on" class="k-select" aria-label="select"><span class="k-icon k-i-arrow-60-down"></span></span></span><input class="sac-indoor-dropdownlist current-limit" data-value="#=value#" style="display: none;"></span>');return{mapListTemplate:function(e){var t=!1,i=e.operations,a=e.type,n=e.modes,o=e.mappedType,r=e.name,s=e.id,d=N.getStatus(e);d&&"Alarm"==(d=1<(d=d.split(".")).length?(N.isOnlyNormalType(e)&&d[0],d[1]):"Off")[0]&&(t=!0);var l=e.modes;t?l=d[0]:l&&0<l.length&&(l=N.getDisplayMode(n,i));return'<div class="device-map-panel-list-item">'+("<span class='detail-img "+d+" "+l+"' data-status='"+d+"' data-mode='"+l+"' data-type='"+a+"' data-mapped-type='"+o+"'></span>")+("<div class='detail-text'><span class='id'>"+s+"</span><span class='name'>"+N.decodeHtml(r)+"</span></div>")+("<span class='ic ic-info' data-id='"+s+"'></span>")+"</div>"},multiDetailListTemplate:function(e,t){var i="",a="",n="",o="",r=e.operations,s=e.modes;n=e.name;var d=!1;(a=N.getStatus(e))&&"Alarm"==(a=1<(a=a.split(".")).length?(o=a[0],N.isOnlyNormalType(e)&&"Alarm"!=a[0]||(o+="("+a[1]+")"),a[1]):(o=a[0],"Off"))[0]&&(d=!0),i=e.modes,d?i=a[0]:i&&0<i.length&&(i=N.getDisplayMode(s,r));var l="",p=e.type;return t&&p&&-1==p.indexOf("AirConditioner.")&&(l=N.getDisplayClassType(e)),"<span class='detail-img "+a+" "+i+" "+l+"'></span>"+(n="<span data-bind='text: name'>"+N.decodeHtml(n)+"</span>")+(a="<span class='panel-item-temp'><span>"+N.getStatusI18N(o)+"</span></span>")},detailPopupGroupListTemplate:function(e){var t=e.dms_devices_name,i=e.dms_devices_id,a=e.dms_devices_type,n=e.dms_devices_mappedType;return"ControlPoint"!=n&&(a=n||a),'<div class="device-detail-popup-group-list-item">'+("<span class='detail-img reg selected "+(a=N.getDisplayClassType(a))+"'></span>")+("<div class='detail-text'><span class='id'>"+i+"</span><span class='name'>"+N.decodeHtml(t)+"</span></div>")+"</div>"},multiDetailRegisterListTemplate:function(e){var t="",i="",a="",n="",o=e.operations,r=e.modes;e.type;a=e.name;var s=!1,d="unreg";return"Registered"==e.registrationStatus&&(d="reg"),(i=N.getStatus(e))&&"Alarm"==(i=1<(i=i.split(".")).length?(n=i[0],N.isOnlyNormalType(e)&&"Alarm"!=i[0]||(n+="("+i[1]+")"),i[1]):(n=i[0],"Off"))[0]&&(s=!0),"Alarm"==i[0]&&(s=!0),s?t=i[0]:t&&0<t.length&&(t=N.getDisplayMode(r,o)),"<span class='detail-img "+d+" "+N.getDisplayClassType(e)+"'></span>"+(a="<span data-bind='text: name'>"+N.decodeHtml(a)+"</span>")+(i="<span class='panel-item-temp'><span>"+n+"</span></span>")},multiDetailListDualTemplate:function(e,t,i){var a="",n="",o="",r="",s=e.operations,d=e.modes,l=void 0!==e.assets_types_id,p="name";l?void 0!==e.number&&null!==e.number&&""!==e.number?(o=e.number,p="number"):e.devices&&e.devices[0]&&(o=e.devices[0].dms_devices_name,p="devices[0].dms_devices_name"):o=e.name;var c=!1;(n=N.getStatus(e))&&"Alarm"==(n=1<(n=n.split(".")).length?(r=n[0],N.isOnlyNormalType(e)&&"Alarm"!=n[0]||(r+="("+n[1]+")"),n[1]):(r=n[0],"Off"))[0]&&(c=!0),a=e.modes,c?a=n[0]:a&&0<a.length&&(a=N.getDisplayMode(d,s));var u=e.type,v="",f=N.getPositionType(e);return v=l?t?"-"!=f&&"Movable"==f?"asset "+e.assets_types_name.toLowerCase()+" movable-reg":"asset "+e.assets_types_name.toLowerCase()+" reg":("-"!=f&&"Movable"==f&&(v="asset "+e.assets_types_name.toLowerCase()+" "+n+" movable"),"asset "+e.assets_types_name.toLowerCase()+" "+n):t?"-"!=f&&"Movable"==f?N.getDisplayClassType(e)+" movable-reg":N.getDisplayClassType(e)+" reg":-1!=u.indexOf("AirConditioner.")?n+" "+a:"-"!=f&&"Movable"==f?n+" "+a+" "+N.getDisplayClassType(e)+" movable":n+" "+a+" "+N.getDisplayClassType(e),i&&(v+=" selected"),"<span class='detail-img "+v+"'></span>"+(o="<span data-bind='text: "+p+"'>"+N.decodeHtml(o)+"</span>")+(n="<span class='panel-item-temp'><span>"+N.getStatusI18N(r)+"</span></span>")},mapListRegTemplate:function(e){var t=!1,i=e.operations,a=e.type,n=e.modes,o=e.mappedType,r=e.name,s=e.id,d=N.getStatus(e);d&&"Alarm"==(d=1<(d=d.split(".")).length?(N.isOnlyNormalType(e)&&d[0],d[1]):"Off")[0]&&(t=!0);var l=e.modes;t?l=d[0]:l&&0<l.length&&(l=N.getDisplayMode(n,i)),a=e.type;return'<div class="device-map-panel-list-item">'+("<span class='detail-img reg "+N.getDisplayClassType(e)+"' data-status='"+d+"' data-mode='"+l+"' data-type='"+a+"' data-mapped-type='"+o+"'></span>")+("<div class='detail-text'><span class='id'>"+s+"</span><span class='name'>"+N.decodeHtml(r)+"</span></div>")+("<span class='ic ic-info' data-id='"+s+"'></span>")+"</div>"},mapListDualTemplate:function(e,t){var i=!1,a=e.operations,n=e.type,o=e.modes,r=e.mappedType,s=e.name,d=e.id,l=N.getStatus(e);l&&"Alarm"==(l=1<(l=l.split(".")).length?(N.isOnlyNormalType(e)&&l[0],l[1]):"Off")[0]&&(i=!0);var p=e.modes;i?p=l[0]:p&&0<p.length&&(p=N.getDisplayMode(o,a)),n=e.type;var c=N.getPositionType(e);return'<div class="device-map-panel-list-item">'+("<span class='detail-img "+(t?"-"!=c&&"Movable"==c?N.getDisplayClassType(e)+" movable-reg":N.getDisplayClassType(e)+" reg":-1!=n.indexOf("AirConditioner.")?l+" "+p:"-"!=c&&"Movable"==c?l+" "+p+" "+N.getDisplayClassType(e)+" movable":l+" "+p+" "+N.getDisplayClassType(e))+"' data-status='"+l+"' data-mode='"+p+"' data-type='"+n+"' data-mapped-type='"+r+"'></span>")+("<div class='detail-text'><span class='id'>"+d+"</span><span class='name'>"+N.decodeHtml(s)+"</span></div>")+("<span class='ic ic-info' data-id='"+d+"'></span>")+"</div>"},getDeviceCardTemplate:function(e){var t=N.getStatus(e);t=t.replace(".","-");var i=S.getLocation(e),a=$("<div/>"),n=$("<div/>").addClass("engCardWrap").attr("data-uid",e.uid).attr("data-id",e.id);e.selected&&n.addClass("k-state-selected");var o=$("<div/>").addClass("engCard "+t),r=$("<div/>").addClass("tb icon"),s=$("<div/>").addClass("bound"),d=e.type,l=e.mappedType,p=void 0!==e.assets_types_id,c="ic-energy";d?-1!=d.indexOf("Light")||l&&-1!=l.indexOf("Light")?c="ic-light":-1!=d.indexOf("SmartPlug")?c="ic-smartplug":-1!=d.indexOf("Temperature")||-1!=d.indexOf("Humidity")||l&&-1!=l.indexOf("Temperature")||l&&-1!=l.indexOf("Humidity")?c="ic-temperature":-1!=d.indexOf("Gateway")?c="ic-gateway":-1!=d.indexOf("Beacon")?c="ic-beacon":-1!=d.indexOf("CCTV")?c="ic-cctv":(-1!=d.indexOf("Motion")||l&&-1!=l.indexOf("Motion"))&&(c="ic-motion"):p&&(c="asset "+e.assets_types_name.toLowerCase());var u=$("<span/>").addClass("dvcic "+c);s.append(u),r.append(s),o.append(r);var v=$("<div/>").addClass("txtwrap"),f=t.split("-"),m="";if("Normal"==f[0]){var g;d&&-1!=d.indexOf("Meter")||l&&-1!=l.indexOf("Meter")?(g="Meter.Gas"==d||"Meter.Gas"==l?N.CHAR.Gas:"Meter.WattHour"==d||"Meter.WattHour"==l?N.CHAR.WattHour:"Meter.Water"==d||"Meter.Water"==l?N.CHAR.Water:"",t=S.getMeterCurrentConsumption(e),t+="<span class='unit'>"+g+"</span>"):d&&-1!=d.indexOf("Temperature")||l&&-1!=l.indexOf("Temperature")?(t=S.getTempHumiTemperature(e,!0),t+="<span class='unit'>"+(g=N.CHAR[I.getTemperature().unit])+"</span>"):d&&-1!=d.indexOf("Humidity")||l&&-1!=l.indexOf("Humidity")?(g=N.CHAR.Humidity,t=S.getTempHumiHumidity(e,!0),t+="<span class='unit'>"+g+"</span>"):d&&-1!=d.indexOf("Motion")||l&&-1!=l.indexOf("Motion")?t=S.getMotionPresence(e):(t=f[0],N.isOnlyNormalType(e)&&"Alarm"!=t[0]||(t+="("+f[1]+")"))}else{t=f[1];var _=N.getRecentAlarm(e);_&&(m=p||d&&("Beacon"==d||"Gateway"==d||"CCTV"==d)?N.getAlarmDescription(_.name):"Code "+_.name)}var b=$("<p/>").addClass("cardName ellp").html(N.getStatusI18N(t)),T=$("<p/>").addClass("cardDesc ellp").text(m),y=$("<p/>").addClass("loc ellp").text(i),C="";C=p?e.number:e.name;var h=$("<p/>").addClass("dvc ellp").text(C),w=$("<i/>").addClass("ic ic-info").attr("data-id",e.id);return v.append(b),v.append(T),v.append(y),v.append(h),v.append(w),o.append(v),n.append(o),a.append(n),a.html()},statisticNumberOfCritical:B,statisticNumberOfWarning:M,statisticNumberOfRegisteredDevice:F,statisticNumberOfNormalDevices:P,statisticNumberOfOnDevices:k,statisticNumberOfOnIndoorDevices:function(e){return(void 0!==e.numberOfOnIndoorDevices?e.numberOfOnIndoorDevices:"-")+"/"+(void 0!==e.numberOfOnVentilatorDevices?e.numberOfOnVentilatorDevices:"-")+"/"+(void 0!==e.numberOfOnDHWDevices?e.numberOfOnDHWDevices:"-")},statisticNumberOfOffDevices:G,statisticNumberOfOffIndoorDevices:function(e){return(void 0!==e.numberOfOffIndoorDevices?e.numberOfOffIndoorDevices:"-")+"/"+(void 0!==e.numberOfOffVentilatorDevices?e.numberOfOffVentilatorDevices:"-")+"/"+(void 0!==e.numberOfOffDHWDevices?e.numberOfOffDHWDevices:"-")},getStatusTemplate:function(e){var t=N.getStatus(e);return"<div><span class='circle-icon "+(t=t.replace(".","-"))+"'></span></div>"},getStatisticRow:t,getAssetStatusTemplate:function(e){var t=N.getAssetStatus(e);return"<div><span class='circle-icon "+(t=t.replace(".","-"))+"'></span></div>"},assetMapListRegTemplate:function(e){var t=e.assets_types_name,i=e.number,a=e.id,n=e.subAssetType;n&&(t+=" / "+n);var o=N.getStatus(e);o&&(o=1<(o=o.split(".")).length?(N.isOnlyNormalType(e)&&o[0],o[1]):"Off")[0];var r=N.getPositionType(e);return'<div class="device-map-panel-list-item">'+("<span class='detail-img asset "+o+" "+("-"!=r&&"Movable"==r?N.getDisplayClassType(e)+" movable":N.getDisplayClassType(e))+"' data-status='"+o+"'></span>")+("<div class='detail-text'><span class='id'>"+i+"</span><span class='name'>"+N.decodeHtml(t)+"</span></div>")+("<span class='ic ic-info' data-id='"+a+"'></span>")+"</div>"},getStatisticRowAsset:function(e){t(e,!0)},getStatisticRowBeacon:function(e){t(e,!1,!0)},statisticAssetFloor:function(e){return e.isSubAsset?"":e.name?e.name:"-"},statisticAssetTypes:function(e){var t="-";e.isSubAsset?t=(void 0!==e.assets_types_name?e.assets_types_name:"-")+(void 0!==e.assets_subAssetType?" / "+e.assets_subAssetType:""):t=void 0!==e.numberOfSubAssetTypes?e.numberOfSubAssetTypes:"-";return t},statisticAssetRegisteredAssets:function(e){return void 0!==e.numberOfRegisteredAssets?e.numberOfRegisteredAssets:"-"},statisticAssetNormalDevices:function(e){return void 0!==e.numberOfNormalDevices?e.numberOfNormalDevices:"-"},statisticAssetCriticalDevices:function(e){return void 0!==e.numberOfCriticalDevices?e.numberOfCriticalDevices:"-"},statisticAssetWarningDevices:function(e){return void 0!==e.numberOfWarningDevices?e.numberOfWarningDevices:"-"},statisticAssetDisconnectedDevices:function(e){return void 0!==e.numberOfDisconnectedDevices?e.numberOfDisconnectedDevices:"-"},statisticAssetLowBatteryDevices:function(e){return"<span class='text-err'>"+(void 0!==e.numberOfLowBatteryDevices?e.numberOfLowBatteryDevices:"-")+"</span>"},statisticAssetOutOfBoundsDevices:function(e){return"<span class='text-err'>"+(void 0!==e.numberOfOutOfBoundsDevices?e.numberOfOutOfBoundsDevices:"-")+"</span>"},assetTypeListTemplate:function(e){var t=e.name;return"<span class='detail-img asset "+t.toLowerCase()+"'></span>"+("<span data-bind='text: name'>"+N.decodeHtml(t)+"</span>")+"<span class='panel-item-temp'><span></span></span>"},statisticBeaconRegister:V,statisticBeaconPositionType:U,statisticBeaconNormal:Y,statisticBeaconDisconnected:W,statisticBeaconWrongLocation:H,statisticBeaconLowBattery:j,statisticBeaconSchdules:z,statisticBeaconRules:Z,detailStatusIconTemplate:function(e){var t=N.getStatus(e),i=t.split("."),a="<span class='circle-icon detail-popup "+i[0]+"-"+i[1]+"'></span>";if(-1<t.indexOf("Alarm")){var n=$("<div/>");t=t.replace(".","-");var o=N.getRecentAlarm(e),r=o.type,s=x.prop("FACILITY_DEVICE_STATUS_POPUP_"+r.toUpperCase());r=s||r;var d=$("<span/>").addClass(t).text(r+" "+x.prop("COMMON_CODE")+" "+o.name),l=$("<span/>").text(N.getAlarmDescription(o.name));return n.append(a),n.append(d),n.append("<br>"),n.append(l),n.html()}var p=i[0];return N.isOnlyNormalType(e)&&"Alarm"!=t[0]||(p+="("+i[1]+")"),a+N.getStatusI18N(p)},detailIconTemplateById:function(e){return'<span class="ic ic-info" data-num="detail" data-id='+e.id+' data-event="devicedetail"></span>'},indoorLegendTemplate:i,beaconLegendTemplate:a,pointLegendTemplate:n,baseLegendTemplate:o,legendTemplate:r,indoorTemperatureListTemplate:function(e){var t,i=$("<div/>"),a=$("<div/>"),n=N.getRecentAlarm(e),o=N.getStatus(e).replace(".","-");if(n){var r=x.prop("COMMON_CODE")+" "+n.name;t=$("<span/>").addClass(o).text(r),a.append(t),i.append(a)}else{var s,d,l=S.getTemperatures(e,!0);s=l.current,d=l.desired,t=$("<span/>").addClass(o).addClass("current").text(s);var p=$("<span/>").addClass(o).addClass("set").text(d);if(a.append(p),a.append(" / "),a.append(t),i.append(a),l.dhwDesired||l.dhwCurrent){var c=$("<div/>"),u=$("<span/>").addClass(o).addClass("current").text(l.dhwCurrent),v=$("<span/>").addClass(o).addClass("set").text(l.dhwDesired);c.append(v),c.append(" / "),c.append(u),i.append(c)}}return i.html()},indoorCardTemplate:function(e){var t,i=N.getDisplayMode(e.modes,e.operations),a=N.getStatus(e);a=a.replace(".","-"),e.information&&e.information.modelName&&(t="I"+e.information.modelName.toUpperCase().replace(/\s/gi,"").replace("+","PLUS"));var n=$("<div/>"),o=$("<div/>").addClass("card-item").attr("data-uid",e.uid).attr("data-id",e.id);e.selected&&o.addClass("k-state-selected");var r=$("<div/>"),s=$("<div/>").addClass("icon-line"),d=$("<div/>").addClass("card-info"),l=$("<div/>").addClass("left"),p=$("<div/>").addClass("right"),c=$("<span/>").addClass("type").addClass(a),u=$("<div/>").addClass("item-bottom"),v=e.name;v&&10<v.length&&(v=v.substring(0,10),v+="...");var f,m=$("<span/>").addClass("device-type-img "+t).text(v),g=N.getRecentAlarm(e);if(g){f="error",r.addClass("card-back "+a),c.text(" "),s.append("<div class='icon empty'/>");var _=a.split("-")[1];_="<span class='error'>"+(_=x.prop("FACILITY_INDOOR_MODE_"+_.toUpperCase()))+"</p><p>"+x.prop("COMMON_CODE")+" "+g.name+"</p>";var b=$("<span/>").addClass("error "+a).html(_);p.append(b),u.addClass("error")}else{var T;"HotWater"===i&&(i="HeatStorage"),f=S.convertDisplayName(i),"HeatStorage"===(T="ko"==R?N.getModeToI18N(i):f)?c.text("H.Water"):c.text(T);var y,C,h,w=S.getGridIcon(e),I=S.getTemperatures(e);if(y=I.current,C=I.desired,h=I.unit,w.length)for(var O=0,A=w.length;O<A;O++)s.append('<div class="icon '+w[O]+'"/>');else s.append("<div class='icon empty'/>");var E=$("<span/>").addClass(a).addClass("set");I.isWaterout&&$("<div/>").addClass("icon ic-dhwtemp-card").appendTo(E),$("<em/>").text(x.prop("FACILITY_INDOOR_SET")).appendTo(E),E.append(C),E.attr("data-content",h);var D=$("<span/>").addClass(a).addClass("current");$("<em/>").text(x.prop("FACILITY_INDOOR_CURRENT")).appendTo(D),D.append(y),D.attr("data-content",h),p.append(E),p.append(D)}var L=$("<span/>").addClass("device-img "+f+" "+a);return l.append(c),l.append(L),d.append(l),d.append(p),u.append(m),u.append('<i class="ic ic-info" data-id='+e.id+">"),r.append(s),r.append(d),r.append(u),o.append(r),n.append(o),n.html()},outdoorDropDownListTemplate:u,outdoorCurrentLimitTemplate:function(e){var t,i,a="-",n=e.airConditioner;n&&(i=n.outdoorUnit)&&(t=a=(a=i.electricCurrentControl)||"-",isNaN(a)?t=x.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"):t+="%");var o=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").text(x.prop("FACILITY_INDOOR_CURRENT")+": "+t).appendTo(o);var r=e.airConditioner,s=!1;return r&&(i=r.outdoorUnit),i&&(s=!i.electricCurrentControlSupported),"-"==a&&(a=p.outdoorControlConfig.electricCurrentControl[0].value),$(u({value:a,text:t,disabled:s,field:"electricCurrentControl"})).addClass("outdoor-dropdownlist").appendTo(o),o.html()},outdoorHeatingCapacityCalibrationTemplate:function(e){var t,i,a="-",n=e.airConditioner;n&&(i=n.outdoorUnit)&&(t=a=(a=i.heatingCapacityCalibration)||"-",isNaN(a)?t=x.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"):t+="kg/cm\xb2");var o=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").text(x.prop("FACILITY_INDOOR_CURRENT")+": "+t).appendTo(o);var r=e.airConditioner,s=!1;return r&&(i=r.outdoorUnit),i&&(s=!i.heatingCapacityCalibrationSupported),"-"==a&&(a=p.outdoorControlConfig.heatingCapacityCalibration[0].value),$(u({value:a,text:t,disabled:s,field:"heatingCapacityCalibration"})).addClass("outdoor-dropdownlist").appendTo(o),o.html()},outdoorCoolingCapacityCalibrationTemplate:function(e){var t,i,a="-",n=e.airConditioner;if(n&&(i=n.outdoorUnit))if("SelfControl"!=(a=(a=i.coolingCapacityCalibration)||"-")){var o=p.outdoorControlConfig.coolingCapacityCalibration[c],r=$.grep(o,function(e){return e.value==a});t=r[0]?r[0].text:"-"}else t=x.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL");var s=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").appendTo(s).text(x.prop("FACILITY_INDOOR_CURRENT")+": "+t);var d=e.airConditioner,l=!1;return d&&(i=d.outdoorUnit),i&&(l=!i.coolingCapacityCalibrationSupported),"-"==a&&(a=p.outdoorControlConfig.coolingCapacityCalibration[c][0].value),$(u({value:a,text:t,disabled:l,field:"coolingCapacityCalibration"})).addClass("cooling-capacity-calibaration-dropdownlist").addClass("outdoor-dropdownlist").appendTo(s),s.html()},pointTypeTemplate:function(e){return e.type.replace("ControlPoint.","")},pointValueTemplate:function(e){if(!e.controlPoint)return"-";var t=e.controlPoint.value,i=e.type;return-1!=i.indexOf("AO")||-1!=i.indexOf("AV")?'<input class="device-point-numeric" data-type="aoav" value="'+t+'" style="width:50%; text-align:center;"/><button class="device-point-sendbtn">'+x.prop("COMMON_BTN_SEND")+"</button>":-1!=i.indexOf("DO")||-1!=i.indexOf("DV")?'<input class="device-point-numeric" data-type="dodv" value="'+t+'" style="width:50%; text-align:center;"/><button class="device-point-sendbtn">'+x.prop("COMMON_BTN_SEND")+"</button>":t},gatewayListZigbeeTemplate:function(e){var t=S.getZigbeeStatus(e).split(".");return"<span class='circle-icon detail-popup "+t[0]+"-"+t[1]+"'></span>"},gatewayListBleTemplate:function(e){var t=S.getBleStatus(e).split(".");return"<span class='circle-icon detail-popup "+t[0]+"-"+t[1]+"'></span>"},gatewayListBleInterfaceTemplate:function(e){var t,i,a="";for(t=0;t<3;t++)a+="<span class='beacon-status'><span class='circle-icon detail-popup "+(i=S.getBleInterfaceStatus(e,t).split("."))[0]+"-"+i[1]+"'></span></span>";return a},bleMacAddressTemplate:function(e){return"<span class='ellipse'>"+S.getBleMacAddress(e)+"</span>"},bleUUIDTemplate:function(e){return"<span class='ellipse'>"+S.getBleUUID(e)+"</span>"}}}),define("operation/group/config/group-create-vm",["operation/core","operation/group/config/group-common"],function(e,t){var i=window.Util,a=window.I18N,n=window.kendo,o=i.getTotalDeviceTypeDataSource(),r={AirConditioner:a.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR"),AirConditionerOutdoor:a.prop("FACILITY_DEVICE_TYPE_SAC_OUTDOOR"),ControlPoint:a.prop("FACILITY_DEVICE_TYPE_POINT"),Meter:a.prop("FACILITY_DEVICE_TYPE_ENERGY_METER"),Beacon:a.prop("FACILITY_DEVICE_TYPE_BLE_BEACON"),"IoT Gateway":a.prop("FACILITY_DEVICE_TYPE_IOT_GATEWAY"),Light:a.prop("FACILITY_DEVICE_TYPE_LIGHT"),CCTV:a.prop("FACILITY_DEVICE_TYPE_CCTV"),Printer:a.prop("FACILITY_DEVICE_TYPE_PRINTER")};return{MainViewModel:n.observable({mapBtn:{active:!1,disabled:!1,click:function(){}},listBtn:{active:!1,disabled:!1,click:function(){}},filters:[{type:"noneLabelDropdowncheckbox",id:"device-type-list",invisible:!1,disabled:!1,options:{optionLabel:a.prop("FACILITY_DEVICE_TYPE_ALL"),selectAllText:a.prop("FACILITY_DEVICE_TYPE_ALL"),emptyText:a.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY"),dataTextField:"text",dataValueField:"value",animation:!1,autoBind:!1,showSelectAll:!0,dataSource:o,select:function(){},click:function(){}}},{type:"dropdownlist",id:"device-sub-type-list",disabled:!0,invisible:!1,options:{optionLabel:a.prop("FACILITY_DEVICE_TYPE_SUB"),dataTextField:"displayType",dataValueField:"type",animation:!1,dataSource:[],open:function(){},close:function(){},change:function(){},select:function(){}}},{type:"button",id:"device-select-all",text:t.MSG.TXT_SELECT_ALL,invisible:!1,disabled:!1,options:{click:function(){}}}],actions:[{type:"template",id:"spanSelectedCount",template:"<span class='text-view'><span data-bind='text: options.selectedText'></span></span>",options:{selectedText:a.prop("FACILITY_DEVICE_NO_SELECTED")}},{type:"button",id:"group-prev",text:a.prop("COMMON_BTN_SAVE"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"group-cancel",text:a.prop("COMMON_BTN_CANCEL"),invisible:!1,disabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}}],category:{invisible:!0,selected:{num:0,active:!1,click:function(){}},floor:{num:0,text:a.prop("COMMON_ALL"),active:!1,click:function(){}}},hideMapPanel:!1,hidePanel:!1}),Views:{map:{view:null,widget:null,routeUrl:"/map",show:null},list:{selected:{routeUrl:"/list/selected",view:null,widget:null},floor:{routeUrl:"/list/floor",view:null,widget:null}}},typeFilterDataSource:o,typeFilterText:r,typeQuery:["AirConditioner.*","AirConditionerOutdoor","ControlPoint.AO","ControlPoint.AI","ControlPoint.DO","ControlPoint.DI","Meter.*","Beacon","Gateway","Light","CCTV","Printer","Sensor.*","Etc"]}}),define("operation/group/config/group-common",function(){"use strict";var e=window.I18N;return{MSG:{TXT_SELECT_ALL:e.prop("COMMON_BTN_SELECT_ALL"),TXT_UNSELECT_ALL:e.prop("COMMON_BTN_DESELECT_ALL"),DELETE_CONFIRM:e.prop("FACILITY_GROUP_MESSAGE_CONFIRM_DELETE_SELECTED_GROUP"),DELETE_RESULT:e.prop("FACILITY_GROUP_MESSAGE_NOTI_DELETED_SELECTED_GROUP"),DELETE_MULTI_RESULT:e.prop("FACILITY_GROUP_MESSAGE_NOTI_DELETED_SELECTED_MULTI_GROUP"),TXT_EDIT_GROUP:e.prop("FACILITY_GROUP_EDIT_GROUP"),TXT_CREATE_GROUP:e.prop("FACILITY_GROUP_CREATE_NEW_GROUP"),TXT_CREATE_GROUP_CANCEL_CONFIRM:e.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL"),TXT_CREATE_GROUP_CLOSE_CONFIRM:e.prop("COMMON_CLOSE_WINDOW_CONFIRM"),TXT_CANCEL_GROUP_CONFIRM:e.prop("COMMON_MESSAGE_CONFIRM_CANCEL"),TXT_CREATE_GROUP_RESULT:e.prop("FACILITY_GROUP_MESSAGE_NOTI_NEW_GROUP_CREATED"),TXT_EDIT_GROUP_RESULT:e.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED"),TXT_MAXIMUM_NUMBER_OF_GROUP:e.prop("FACILITY_GROUP_MAXIMUM_NUMBER_OF_GROUP")},createNewWidget:function(e,t,i){return new t($("<div/>").attr("id",e),i)}}}),define("operation/group/config/group-model",function(){"use strict";var s=window.kendo.data.Model.define({id:"id",fields:{name:{name:"Name"},type:{name:"Type"},description:{name:"Description"},dms_devices_ids:{name:"Devices",type:"object",defaultValue:[]}}});return{MockData:[{foundation_space_buildings_id:1,foundation_space_buildings_name:"A Tower",floors:[{foundation_space_floors_id:23,foundation_space_floors_type:"F",foundation_space_floors_name:"15",groups:[{dms_groups_id:11,dms_groups_name:"Marketing Department",dms_groups_description:"A collection of all devices belonging to the marketing department.",deviceTypes:[{dms_devices_type:"AirConditionerOutdoor",numberOfDevices:1},{dms_devices_type:"AirConditioner.Indoor",numberOfDevices:3},{dms_devices_type:"Beacon",numberOfDevices:2}]},{dms_groups_id:12,dms_groups_name:"Sales Department",dms_groups_description:"A collection of all devices belonging to the sales department.",deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",numberOfDevices:4},{dms_devices_type:"Beacon",numberOfDevices:3}]}]}]}],createDataSource:function(e,t,i){var a,n,o,r,s,d,l=e.length;for(a=0;a<l;a++){if((r=e[a]).deviceTypes)for(o=r.deviceTypes.length,n=0;n<o;n++)s=r.deviceTypes[n].dms_devices_type,d=r.deviceTypes[n].numberOfDevices,r[s]=d;i&&(r.selected=!1)}return e},createModel:function(e){var t=new s(e);return e||t.set("dms_devices_ids",[]),t},createModelByGroupIdData:function(e){var t,i,a,n=new s;if(n.set("id",e.id),n.set("name",e.name),n.set("type",e.type),i=e.devices){a=i.length;var o,r=[];for(t=0;t<a;t++)o=i[t].dms_devices_id,r.push(o);n.set("dms_devices_ids",r)}return n}}}),define("operation/group/config/group-template",[],function(){var e=window.I18N;return{groupControlTemplate:'<div class="group-control-dialog-control groupControl"><div class="controllerList noarr"><div data-bind="invisible:indoorControlPanel.invisible"><div class="control-panel"></div></div><div data-bind="invisible:light.invisible"><div class="horzline"></div><div class="typename">'+e.prop("FACILITY_DEVICE_TYPE_LIGHT")+'</div><div class="innerBox"><div class="innerSet"><button type="button" class="controlBtn" data-bind="events:{click:light.power.click}, css:{selected:light.power.active}, invisible:light.power.invisible"><span class="icwrap"><i class="ic power"></i><span data-bind="visible:light.power.active">ON</span><span data-bind="visible:light.power.mixed">/ OFF</span><span data-bind="invisible:light.power.active">OFF</span></span></button><div data-bind="invisible:light.dimming.invisible"><p class="bluetit">'+e.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS")+' (0 ~ 100 %)</p><div class="tb slider"><div class="tbc"><div class="customSlider"><input style="width:160px;" data-bind="value:light.value,events:{slide:light.slide}" data-role="slider" data-show-buttons="false" data-tooltip="{enabled:false}" data-tick-placement="none" data-min="0" data-max="100" data-small-step="1" data-large-step="1"/><span class="valTxt"><span data-bind="text:light.value"></span>%</span></div></div></div></div></div></div></div><div data-bind="invisible:point.invisible"><div class="horzline"></div><div class="typename">'+e.prop("FACILITY_POINT_DDC_FACILITY_POINT_CONTROL")+'</div><div class="innerBox"><div class="innerSet"><div data-bind="invisible:point.aoav.invisible"><p class="bluetit lowtop">AO</p><div class="tb frmAddBtn"><div class="tbc"><input style="width:145px;margin-right:2px;" id="point-value" data-role="numerictextbox"data-min="#=point.aoav.min#"data-max="#=point.aoav.max#"data-decimals="#=point.aoav.decimals#"data-decimals="#=point.aoav.format#"data-round="false"data-spinners="false"data-bind="value: point.aoav.value"/></div><div class="tbc bt"><button type="button" class="commonBtn" data-bind="events:{click:point.aoav.send}">'+e.prop("COMMON_BTN_SEND")+'</button></div></div></div><div data-bind="invisible:point.dodv.invisible"><p class="bluetit">DO</p><button type="button" class="controlBtn" data-bind="events:{click : point.dodv.click}, css:{selected : point.dodv.active}"><span class="icwrap"><i class="ic power"></i><span data-bind="visible:point.dodv.active">ON</span><span data-bind="visible:point.dodv.mixed">/OFF</span><span data-bind="invisible:point.dodv.active">OFF</span></span></button></div></div></div></div><div data-bind="invisible:gateway.invisible"><div class="horzline"></div><div class="typename">ZigBee Interface</div><div class="innerBox"><div class="innerSet"><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_POWER")+'</p><div class="tb frmAddBtn"><div class="tbc"><div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="zigbee-power" id="zigbee-power-on" checked="" value="true" data-bind="checked:gateway.gatewayZigbeePower, click:gateway.clickGatewayZigbeePower"><label class="k-radio-label" for="zigbee-power-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="zigbee-power" id="zigbee-power-off" checked="" value="false" data-bind="checked:gateway.gatewayZigbeePower, click:gateway.clickGatewayZigbeePower"><label class="k-radio-label" for="zigbee-power-off">Off</label></div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_WIFI_CHANNEL")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><input data-role="dropdownlist" data-bind="source : gateway.gatewayZigbeeChannelList, value : gateway.gatewayZigbeeChannel, events:{change:gateway.changeGatewayZigbeeChannel}" /></div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_TX_POWER")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><input data-role="dropdownlist" data-bind="source : gateway.gatewayZigbeeTxPowerList, value : gateway.gatewayZigbeeTxPower, events:{change:gateway.changeGatewayZigbeeTxPower}" /></div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_PAIRING_MODE")+'</p><div class="tb frmAddBtn"><div class="tbc"><div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="zigbee-pairing" id="zigbee-pairing-on" value="true" data-bind="checked:gateway.gatewayZigbeePairingMode, click:gateway.clickGatewayZigbeePairingMode"><label class="k-radio-label" for="zigbee-pairing-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="zigbee-pairing" id="zigbee-pairing-off" value="false" data-bind="checked:gateway.gatewayZigbeePairingMode, click:gateway.clickGatewayZigbeePairingMode"><label class="k-radio-label" for="zigbee-pairing-off">Off</label></div></div></div></div></div><div class="typename">BLE Interface</div><div class="innerBox"><div class="innerSet"><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_POWER")+'</p><div class="tb frmAddBtn"><div class="tbc"><div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power" id="ble-power-on" checked="" value="true" data-bind="checked:gateway.gatewayBlePower, click:gateway.clickGatewayBlePower"><label class="k-radio-label" for="ble-power-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power" id="ble-power-off" checked="" value="false" data-bind="checked:gateway.gatewayBlePower, click:gateway.clickGatewayBlePower"><label class="k-radio-label" for="ble-power-off">Off</label></div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_SCAN_REPORT")+'</p><div class="tb frmAddBtn"><div class="tbc"><div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-scan-report" id="ble-scan-report-on" checked="" value="true" data-bind="checked:gateway.gatewayBleScanReport, click:gateway.clickGatewayBleScanReport"><label class="k-radio-label" for="ble-scan-report-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-scan-report" id="ble-scan-report-off" checked="" value="false" data-bind="checked:gateway.gatewayBleScanReport, click:gateway.clickGatewayBleScanReport"><label class="k-radio-label" for="ble-scan-report-off">Off</label></div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_SCAN_REPORT_INTERVAL")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="100" data-max="30000" data-spinners="false" data-bind="value : gateway.gatewayBleScanReportInterval, events:{change:gateway.changeGatewayBleScanReportInterval}" /></span><span style="margin-left:10px;">(100 ~ 30,000)</div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_SCAN_WINDOW")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="10240" data-spinners="false" data-bind="value : gateway.gatewayBleScanWindow, events:{change:gateway.changeGatewayBleScanWindow}" /></span><span style="margin-left:10px;">(0 ~ 10,240)</div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_SCAN_INTERVAL")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="10240" data-spinners="false" data-bind="value : gateway.gatewayBleScanInterval, events:{change:gateway.changeGatewayBleScanInterval}" /></span><span style="margin-left:10px;">(<span class="scan-interval-min">0</span> ~ 10,240)</div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_SCAN_TYPE")+'</p><div class="tb frmAddBtn"><div class="tbc"><div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-scan-type" id="ble-scan-type-on" checked="" value="Passive" data-bind="checked:gateway.gatewayBleScanType, click:gateway.clickGatewayBleScanType"><label class="k-radio-label" for="ble-scan-type-on" style="margin-right:51px;">Passive</label><input type="radio" class="k-radio" name="ble-scan-type" id="ble-scan-type-off" checked="" value="Active" data-bind="checked:gateway.gatewayBleScanType, click:gateway.clickGatewayBleScanType"><label class="k-radio-label" for="ble-scan-type-off">Active</label></div></div></div></div></div><div class="typename">Built-in Beacon Setup</div><div class="innerBox"><div class="innerSet"><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_INTERVAL")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="100" data-max="5000" data-spinners="false" data-bind="value : gateway.gatewayBleAdvertisementInterval, events:{change:gateway.changeGatewayBleAdvertisementInterval}" /></span><span style="margin-left:10px;">(100 ~ 5,000)</div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_TX_POWER")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="-100" data-max="20" data-spinners="false" data-bind="value : gateway.gatewayBleTxPower, events:{change:gateway.changeGatewayBleTxPower}" /></span><span style="margin-left:10px;">(-100 ~ 20)</div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_CALIBRATION")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="-128" data-max="127" data-spinners="false" data-bind="value : gateway.gatewayBleCalibration, events:{change:gateway.changeGatewayBleCalibration}" /></span><span style="margin-left:10px;">(-128 ~ 127)</div></div></div></div></div><div class="typename">Built-in Beacon \\#1</div><div class="innerBox"><div class="innerSet"><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_POWER")+'</p><div class="tb frmAddBtn"><div class="tbc"><div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power-1" id="ble-power-on-1" checked="" value="true" data-bind="checked:gateway.gatewayBleFirstPower, click:gateway.clickGatewayBleFirstPower"><label class="k-radio-label" for="ble-power-on-1" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power-1" id="ble-power-off-1" checked="" value="false" data-bind="checked:gateway.gatewayBleFirstPower, click:gateway.clickGatewayBleFirstPower"><label class="k-radio-label" for="ble-power-off-1">Off</label></div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><form data-role="commonvalidator" data-type="name"><input class="k-input" type="text" style="width: 100%;" data-bind="value : gateway.gatewayBleFirstAdvertiseName, events:{change:gateway.changeGatewayBleFirstAdvertiseName}" /></form></div></div></div><p class="bluetit lowtop">UUID</p><div class="tb frmAddBtn"><div class="tbc"><div><form><input class="k-input" type="text" style="width: 100%;" data-bind="value : gateway.gatewayBleFirstUUID, events:{change:gateway.changeGatewayBleFirstUUID}" /></form></div></div></div><p class="bluetit lowtop">Major</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : gateway.gatewayBleFirstMajor, events:{change:gateway.changeGatewayBleFirstMajor}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div></div></div><p class="bluetit lowtop">Minor</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : gateway.gatewayBleFirstMinor, events:{change:gateway.changeGatewayBleFirstMinor}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div></div></div></div></div><div class="typename">Built-in Beacon \\#2</div><div class="innerBox"><div class="innerSet"><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_POWER")+'</p><div class="tb frmAddBtn"><div class="tbc"><div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power-2" id="ble-power-on-2" checked="" value="true" data-bind="checked:gateway.gatewayBleSecondPower, click:gateway.clickGatewayBleSecondPower"><label class="k-radio-label" for="ble-power-on-2" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power-2" id="ble-power-off-2" checked="" value="false" data-bind="checked:gateway.gatewayBleSecondPower, click:gateway.clickGatewayBleSecondPower"><label class="k-radio-label" for="ble-power-off-2">Off</label></div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><form data-role="commonvalidator" data-type="name"><input class="k-input" type="text" style="width: 100%;" data-bind="value : gateway.gatewayBleSecondAdvertiseName, events:{change:gateway.changeGatewayBleSecondAdvertiseName}" /></form></div></div></div><p class="bluetit lowtop">UUID</p><div class="tb frmAddBtn"><div class="tbc"><div><form><input class="k-input" type="text" style="width: 100%;" data-bind="value : gateway.gatewayBleSecondUUID, events:{change:gateway.changeGatewayBleSecondUUID}" /></form></div></div></div><p class="bluetit lowtop">Major</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : gateway.gatewayBleSecondMajor, events:{change:gateway.changeGatewayBleSecondMajor}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div></div></div><p class="bluetit lowtop">Minor</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : gateway.gatewayBleSecondMinor, events:{change:gateway.changeGatewayBleSecondMinor}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div></div></div></div></div><div class="typename">Built-in Beacon \\#3</div><div class="innerBox"><div class="innerSet"><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_NETWORK_POWER")+'</p><div class="tb frmAddBtn"><div class="tbc"><div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power-3" id="ble-power-on-3" checked="" value="true" data-bind="checked:gateway.gatewayBleThirdPower, click:gateway.clickGatewayBleThirdPower"><label class="k-radio-label" for="ble-power-on-3" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power-3" id="ble-power-off-3" checked="" value="false" data-bind="checked:gateway.gatewayBleThirdPower, click:gateway.clickGatewayBleThirdPower"><label class="k-radio-label" for="ble-power-off-3">Off</label></div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><form data-role="commonvalidator" data-type="name"><input class="k-input" type="text" style="width: 100%;" data-bind="value : gateway.gatewayBleThirdAdvertiseName, events:{change:gateway.changeGatewayBleThirdAdvertiseName}" /></form></div></div></div><p class="bluetit lowtop">UUID</p><div class="tb frmAddBtn"><div class="tbc"><div><form><input class="k-input" type="text" style="width: 100%;" data-bind="value : gateway.gatewayBleThirdUUID, events:{change:gateway.changeGatewayBleThirdUUID}" /></form></div></div></div><p class="bluetit lowtop">Major</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : gateway.gatewayBleThirdMajor, events:{change:gateway.changeGatewayBleThirdMajor}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div></div></div><p class="bluetit lowtop">Minor</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : gateway.gatewayBleThirdMinor, events:{change:gateway.changeGatewayBleThirdMinor}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div></div></div></div></div></div><div data-bind="invisible:beacon.invisible"><div class="horzline"></div><div class="typename">Advertisement</div><div class="innerBox"><div class="innerSet"><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><form><input class="k-input" type="text" style="width: 100%;" data-bind="value : beacon.advertisingName, events:{change:beacon.changeAdvertisingName}" /></form></div></div></div><p class="bluetit lowtop">'+e.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_INTERVAL")+'</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="100" data-max="10240" data-spinners="false" data-bind="value : beacon.advertisingInterval, events:{change:beacon.changeAdvertisingInterval}" /></span><span style="margin-left:10px;">(100 ~ 10,240)</div></div></div><p class="bluetit lowtop">UUID</p><div class="tb frmAddBtn"><div class="tbc"><div><form><input class="k-input" type="text" style="width: 100%;" data-bind="value : beacon.uuid, events:{change:beacon.changeUuid}" /></form></div></div></div><p class="bluetit lowtop">Major</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : beacon.major, events:{change:beacon.changeMajor}" /></span><span style="margin-left:10px;">(0 ~ 65,535)</div></div></div><p class="bluetit lowtop">Minor</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : beacon.minor, events:{change:beacon.changeMinor}" /></span><span style="margin-left:10px;">(0 ~ 65,535)</div></div></div><p class="bluetit lowtop">Tx Power</p><div class="tb frmAddBtn"><div class="tbc"><div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="-100" data-max="20" data-spinners="false" data-bind="value : beacon.txPower, events:{change:beacon.changeTxPower}" /></span><span style="margin-left:10px;">(-100 ~ 20)</div></div></div></div></div></div>'}}),define("operation/group/config/group-vm",[],function(){var e=window.kendo,t=window.I18N,i=[{text:t.prop("FACILITY_GROUP_ENERGY_DISTRIBUTION_ALL_TYPES"),value:""},{text:t.prop("FACILITY_GROUP_ENERGY_DISTRIBUTION_NONE"),value:"General"},{text:t.prop("FACILITY_GROUP_ENERGY_DISTRIBUTION"),value:"EnergyDistribution"}];return{MainViewModel:e.observable({filters:[{type:"dropdownlist",id:"group-type-list",disabled:!1,invisible:!1,options:{optionLabel:"",dataTextField:"text",dataValueField:"value",animation:!1,dataSource:i,open:function(){},close:function(){},change:function(){},select:function(){}}}],actions:[{type:"template",id:"spanSelectedCount",template:"<span class='text-view'><span data-bind='text: options.selectedText'></span></span>",options:{selectedText:t.prop("FACILITY_GROUP_MESSAGE_NOTI_GROUP_NOT_SELECTED")}},{type:"button",id:"group-create-btn",text:t.prop("COMMON_BTN_CREATE"),invisible:!1,disabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"group-edit-btn",text:t.prop("COMMON_BTN_EDIT"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"group-delete-btn",text:t.prop("COMMON_BTN_DELETE"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}}]})}}),define("operation/group/config/group-control-vm",["operation/core","device/common/device-constants","device/common/device-api"],function(e,c,u){var i,d=window.kendo,l=window.Util,a=window.CommonLoadingPanel,t=$("<div/>");i=t.kendoCommonDialog().data("kendoCommonDialog");function v(e){var t,i,a=(t=e.dataSource.data(),new d.data.Query(t).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray()),n=a.length,o=[],r=[];for(i=0;i<n;i++)o.push(a[i].id),r.push(a[i].type);return{ids:o,types:r}}function f(e){var t=l.parseFailResponse(e);i.message(t),i.open()}function m(e,r){var s=new $.Deferred;if(!e||e.length<1)return s.reject(),s.promise();var d=r.dataSource;return setTimeout(function(){$.ajax({url:"/dms/devices?ids="+e.join(",")}).then(function(e){var t,i,a,n,o=e.length;for(t=0;t<o;t++)if(i=e[t],n=d.get(i.id))for(a in i)n[a]=i[a];d.fetch(),r.groupList.setDataSource(d,!1,!0,!0),s.resolve(e)}).fail(function(){s.reject()})},2*c.TIME_OUT),s.promise()}var o={indoor:"AirConditioner.Indoor.General",ventilator:"AirConditioner.Indoor.Ventilator",dhw:"AirConditioner.Indoor.DHW",point:"ControlPoint",light:"General"};function r(e,t,i){var a=i.Loading;return $.ajax({url:"/dms/devices/multiControl",method:"PUT",data:e}).done(function(){m(t,i).always(function(){a.close()})}).fail(function(e){a.close(),f(e)})}var g=[];function n(e,t,i){e.Loading.open();var a,n=v(e);return n=n.ids,"aoav"==i?a=t.get("value"):"dodv"==i&&(t.get("mixed")?(a=1,t.set("mixed",!1)):a=t.get("active")?1:0),"number"==typeof a&&(a=a.toString()),r({dms_devices_ids:n,control:{controlPoint:{value:a}}},n,e)}function s(e,t){e.Loading.open();var i=v(e);i=i.ids;var a=[];if($.isArray(t)){var n,o=t.length;for(n=0;n<o;n++)a.push(t[n])}else a.push(t);return r({dms_devices_ids:i,control:{networks:a}},i,e)}return{viewModel:d.observable({init:function(e,t){this.remoteControl.init(),this.light.init(),this.point.init(),this.popup=e,this.popup.Loading=new a(this.popup.element),this.groupId=t},groupId:null,popup:null,remoteControl:{init:function(){this.set("invisible",!1),this.control[0].set("active",!1),this.control[1].set("active",!1)},invisible:!1,control:[{name:"Allowed",active:!1,click:function(e){var t=this.remoteControl.control,i=t[0].get("active");t[0].set("active",!i),t[1].set("active",!1)}},{name:"NotAllowed",active:!1,click:function(e){var t=this.remoteControl.control,i=t[1].get("active");t[1].set("active",!i),t[0].set("active",!1)}}]},light:{init:function(){var e=this;e.power.set("active",!1),e.power.set("mixed",!1),e.set("invisible",!1),e.set("value",50),e.power.set("invisible",!1),e.dimming.set("invisible",!1)},timeout:null,invisible:!1,dimming:{invisible:!1},value:50,power:{mixed:!1,insivible:!1,active:!1,click:function(e){var t=this.light,i=t.power.get("active");t.power.get("mixed")||t.power.set("active",!i),function(e,t,i){e.Loading.open();var a=v(e);a=a.ids;var n={id:o[i]};t.power.get("mixed")?(n.power="On",t.power.set("mixed",!1)):n.power=t.power.get("active")?"On":"Off",r({dms_devices_ids:a,control:{operations:[n]}},a,e)}(this.popup,this.light,"light")}},slide:function(e){var t=this.light,i=this.popup;t.set("value",e.value),t.timeout&&(clearTimeout(t.timeout),t.timeout=null),t.timeout=setTimeout(function(){!function(e,t){e.Loading.open();var i=v(e);i=i.ids;var a=t.get("value"),n=[];n.push({id:1,dimmingLevel:a}),r({dms_devices_ids:i,control:{lights:n}},i,e)}(i,t)},500)}},point:{init:function(){this.set("invisible",!1);var e=this.dodv;e.set("invisible",!1),e.set("active",!1),e.set("mixed",!1);var t=this.aoav;t.set("invisible",!1),t.set("value","0.00")},invisible:!1,aoav:{invisible:!1,value:"0.00",min:-179e306,max:179e306,decimals:2,send:function(e){n(this.popup,this.point.aoav,"aoav")}},dodv:{invisible:!1,active:!1,mixed:!1,click:function(){var e=this.point.dodv,t=e.get("active");e.get("mixed")||e.set("active",!t),n(this.popup,this.point.dodv,"dodv")},init:function(){this.set("invisible",!1),this.set("active",!1)}}},indoorControlPanel:{invisible:!0},gateway:{init:function(){this.set("invisible",!1),this.set("gatewayZigbeePower",!1),this.set("gatewayZigbeeChannel","26"),this.set("gatewayZigbeeTxPower","9"),this.set("gatewayZigbeeParingMode",!1),this.set("gatewayBlePower",!1),this.set("gatewayBleScanReport",!1),this.set("gatewayBleScanReportInterval",100),this.set("gatewayBleScanWindow",100),this.set("gatewayBleScanInterval",100),this.set("gatewayBleScanType","Passive"),this.set("gatewayBleAdvertisementInterval",100),this.set("gatewayBleCalibration",-128),this.set("gatewayBleFirstPower",!1),this.set("gatewayBleFirstAdvertiseName",""),this.set("gatewayBleFirstUUID",""),this.set("gatewayBleFirstMajor",0),this.set("gatewayBleFirstMinor",0),this.set("gatewayBleSecondPower",!1),this.set("gatewayBleSecondAdvertiseName",""),this.set("gatewayBleSecondUUID",""),this.set("gatewayBleSecondMajor",0),this.set("gatewayBleSecondMinor",0),this.set("gatewayBleThirdPower",!1),this.set("gatewayBleThirdAdvertiseName",""),this.set("gatewayBleThirdUUID",""),this.set("gatewayBleThirdMajor",0),this.set("gatewayBleThirdMinor",0)},invisible:!1,gatewayZigbeePower:!1,clickGatewayZigbeePower:function(e){var t=$(e.target).prop("value");s(this.popup,{id:4,enabled:t})},gatewayZigbeeChannel:"26",gatewayZigbeeChannelList:["26","25","24","23","22","21","20","19","18","17","16","15","14","13","12","11"],changeGatewayZigbeeChannel:function(e){var t=this.gateway.get("gatewayZigbeeChannel");s(this.popup,{id:4,zigbee:{channel:t}})},gatewayZigbeeTxPower:"9",gatewayZigbeeTxPowerList:["9","-3","-15","-25"],changeGatewayZigbeeTxPower:function(e){var t=this.gateway.get("gatewayZigbeeTxPower");s(this.popup,{id:4,zigbee:{txPower:t}})},gatewayZigbeePairingMode:!1,clickGatewayZigbeePairingMode:function(e){var t=$(e.target).prop("value");s(this.popup,{id:4,zigbee:{pairing:t}})},gatewayBlePower:!1,clickGatewayBlePower:function(e){var t=$(e.target).prop("value");s(this.popup,{id:5,enabled:t})},gatewayBleScanReport:!1,clickGatewayBleScanReport:function(e){var t=$(e.target).prop("value");s(this.popup,{id:5,ble:{scanlistReportEnabled:t}})},gatewayBleScanReportInterval:100,changeGatewayBleScanReportInterval:function(e){var t=this.gateway.get("gatewayBleScanReportInterval");s(this.popup,{id:5,ble:{scanlistReportInterval:t}})},gatewayBleScanWindow:100,changeGatewayBleScanWindow:function(e){var t=this.gateway.get("gatewayBleScanWindow");s(this.popup,{id:5,ble:{scanWindow:t}})},gatewayBleScanInterval:0,changeGatewayBleScanInterval:function(e){var t=this.gateway.get("gatewayBleScanInterval");s(this.popup,{id:5,ble:{scanInterval:t}})},gatewayBleScanType:"Passive",clickGatewayBleScanType:function(e){var t=$(e.target).prop("value");s(this.popup,{id:5,ble:{scanType:t}})},gatewayBleAdvertisementInterval:100,changeGatewayBleAdvertisementInterval:function(e){var t=this.gateway.get("gatewayBleAdvertisementInterval");s(this.popup,[{id:6,ble:{advertisingInterval:t}},{id:7,ble:{advertisingInterval:t}},{id:8,ble:{advertisingInterval:t}}])},gatewayBleTxPower:0,changeGatewayBleTxPower:function(e){var t=this.gateway.get("gatewayBleTxPower");s(this.popup,[{id:6,ble:{txPower:t}},{id:7,ble:{txPower:t}},{id:8,ble:{txPower:t}}])},gatewayBleCalibration:-128,changeGatewayBleCalibration:function(e){var t=this.gateway.get("gatewayBleCalibration");s(this.popup,[{id:6,ble:{txPowerAttenuation:t}},{id:7,ble:{txPowerAttenuation:t}},{id:8,ble:{txPowerAttenuation:t}}])},gatewayBleFirstPower:!1,clickGatewayBleFirstPower:function(e){var t=$(e.target).prop("value");s(this.popup,{id:6,enabled:t})},gatewayBleFirstAdvertiseName:"",changeGatewayBleFirstAdvertiseName:function(e){var t=this.gateway.get("gatewayBleFirstAdvertiseName");s(this.popup,{id:6,ble:{advertisingName:t}})},gatewayBleFirstUUID:"",changeGatewayBleFirstUUID:function(e){var t=this.gateway.get("gatewayBleFirstUUID");s(this.popup,{id:6,ble:{uuid:t}})},gatewayBleFirstMajor:0,changeGatewayBleFirstMajor:function(e){var t=this.gateway.get("gatewayBleFirstMajor");s(this.popup,{id:6,ble:{major:t}})},gatewayBleFirstMinor:0,changeGatewayBleFirstMinor:function(e){var t=this.gateway.get("gatewayBleFirstMinor");s(this.popup,{id:6,ble:{minor:t}})},gatewayBleSecondPower:!1,clickGatewayBleSecondPower:function(e){var t=$(e.target).prop("value");s(this.popup,{id:7,enabled:t})},gatewayBleSecondAdvertiseName:"",changeGatewayBleSecondAdvertiseName:function(e){var t=this.gateway.get("gatewayBleSecondAdvertiseName");s(this.popup,{id:7,ble:{advertisingName:t}})},gatewayBleSecondUUID:"",changeGatewayBleSecondUUID:function(e){var t=this.gateway.get("gatewayBleSecondUUID");s(this.popup,{id:7,ble:{uuid:t}})},gatewayBleSecondMajor:0,changeGatewayBleSecondMajor:function(e){var t=this.gateway.get("gatewayBleSecondMajor");s(this.popup,{id:7,ble:{major:t}})},gatewayBleSecondMinor:0,changeGatewayBleSecondMinor:function(e){var t=this.gateway.get("gatewayBleSecondMinor");s(this.popup,{id:7,ble:{minor:t}})},gatewayBleThirdPower:!1,clickGatewayBleThirdPower:function(e){var t=$(e.target).prop("value");s(this.popup,{id:8,enabled:t})},gatewayBleThirdAdvertiseName:"",changeGatewayBleThirdAdvertiseName:function(e){var t=this.gateway.get("gatewayBleThirdAdvertiseName");s(this.popup,{id:8,ble:{advertisingName:t}})},gatewayBleThirdUUID:"",changeGatewayBleThirdUUID:function(e){var t=this.gateway.get("gatewayBleThirdUUID");s(this.popup,{id:8,ble:{uuid:t}})},gatewayBleThirdMajor:0,changeGatewayBleThirdMajor:function(e){var t=this.gateway.get("gatewayBleThirdMajor");s(this.popup,{id:8,ble:{major:t}})},gatewayBleThirdMinor:0,changeGatewayBleThirdMinor:function(e){var t=this.gateway.get("gatewayBleThirdMinor");s(this.popup,{id:8,ble:{minor:t}})}},beacon:{init:function(){this.set("invisible",!1),this.set("advertisingName",""),this.set("advertisingInterval",0),this.set("uuid",""),this.set("minor",0),this.set("major",0)},invisible:!1,advertisingName:"",changeAdvertisingName:function(e){var t=this.beacon.get("advertisingName");s(this.popup,{id:1,ble:{advertisingName:t}})},advertisingInterval:100,changeAdvertisingInterval:function(e){var t=this.beacon.get("advertisingInterval");s(this.popup,{id:1,ble:{advertisingInterval:t}})},uuid:"",changeUuid:function(e){var t=this.beacon.get("uuid");s(this.popup,{id:1,ble:{uuid:t}})},major:0,changeMajor:function(e){var t=this.beacon.get("major");s(this.popup,{id:1,ble:{major:t}})},minor:0,changeMinor:function(e){var t=this.beacon.get("minor");s(this.popup,{id:1,ble:{minor:t}})},txPower:0,changeTxPower:function(e){var t=this.beacon.get("txPower");s(this.popup,{id:1,ble:{txPower:t}})}}}),indoorControl:function(e){var t=e.item,i=e.index,a=e.subIndex,n=e.mode,o=e.sender.element.closest("#group-control-popup").data("kendoDetailDialog"),r=v(o).ids,s=c.controlSet[i];void 0!==a&&(s=s[a],i=10*i+a),g[i]&&(clearTimeout(g[i]),g[i]=void 0);var d,l,p={};s.id?(p.id=s.id,n&&(p.id=s[n]),p[s.parameter]=t.value,(d=[]).push(p)):(s.underParameter?(p[s.parameter]={},p[s.parameter][s.underParameter]=t.value):p[s.parameter]=t.value,d=p),g[i]=setTimeout(function(){var e=r.length,t={dms_devices_ids:[],control:{}};t.control[s.apiName]=d;for(var i=0;i<e;i++)t.dms_devices_ids.push(r[i]);l=u.multiControl(t);var a=o.Loading;a.open(),l.done(function(){m(r,o).always(function(){a.close()})}).fail(function(e){a.close(),f(e)})},2*c.TIME_OUT)},indoorControlPanelInvisible:function(e){var i,t=e.element,a=t.find(".indoor-mode-title");a.find(".radiogroup .buttonbound").each(function(){var e=$(this).css("display");if(i="none"!=e)return!1}),i?a.show():a.hide(),(a=t.find(".chiller-mode-title")).find(".buttonbound").each(function(){var e=$(this).css("display");if(i="none"!=e)return!1}),i?a.show():a.hide(),(a=t.find(".indoor-temperature-title")).find(".blank10, .k-widget").each(function(){var e=$(this).css("display");if(i="none"!=e)return!1}),i?a.show():a.hide(),t.find(".k-item").each(function(){var e=$(this),t=e.find(".innerBox");i=!1,t.find(" > div:not(.indoor-mode-title)").each(function(){var e=$(this).css("display");if(i="none"!=e)return!1}),i?e.show():e.hide()})},refreshIndoorDevices:function(){var e,t=this.element.find(".control-panel").data("kendoControlTab"),i=this.dataSource,a=i.data(),n=new d.data.Query(a).filter({logic:"and",filters:[{field:"displayType",operator:"eq",value:l.getDetailDisplayTypeDeviceI18N("SAC Indoor")}]}).toArray(),o=n.length,r=[];for(e=0;e<o;e++)r.push(n[e].id);var s=this.Loading;s.open(),m(r,this).done(function(){o=r.length,a=i.data();var e=new d.data.Query(a).filter({logic:"and",filters:[{field:"displayType",operator:"eq",value:l.getDetailDisplayTypeDeviceI18N("SAC Indoor")},{field:"selected",operator:"eq",value:!0}]}).toArray();t.setDataSource(e)}).always(function(){s.close()})}}}),define("operation/group/config/group-widget",["operation/core","device/common/device-util","device/common/device-template","operation/group/config/group-template","operation/group/config/group-control-vm"],function(e,t,i,a,c){var n,o,r,s=window.I18N,d=window.Util,l=window.moment,u=window.kendo,p=$("#device-detail-popup"),v=$("#group-control-popup");o=$("<div/>").kendoCommonDialog().data("kendoCommonDialog"),r=$("<div/>").kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog");var f=[{controlledTime:"2016-08-27 16:30",location:{building:"A Building",floor:"30F",zone:"Meeting Room A"},devices:{Indoor:[{icon:"",deviceId:"Device01",deviceName:"Device01"},{icon:"",deviceId:"Device02",deviceName:"DeviceName02"}]},group:["Group A","Group B"],controlBy:"Quaduron",controlType:"Manual control",operation:"\u2022 SAC Indoor : On - Cool (18 \xb0C)"},{controlledTime:"2016-08-27 16:30",location:{building:"A Building",floor:"30F",zone:"Meeting Room A"},devices:{Indoor:[{icon:"",deviceId:"Device01",deviceName:"Device01"},{icon:"",deviceId:"Device02",deviceName:"DeviceName02"}]},group:["Group A","Group B"],controlBy:"Quaduron",controlType:"Manual control",operation:"\u2022 SAC Indoor : On - Cool (18 \xb0C)"}],m=$("#popup-history").kendoPopupSingleWindow({title:"History",width:"1296px"});m.closest(".popup-window").addClass("popup-device-history");var g=$(".popup-device-history .device-history-grid").kendoGrid({dataSource:[],scrollable:!0,sortable:!0,height:"100%",columns:[{field:"controlledTime",title:"Controlled Time"},{field:"location",title:"Location",sortable:!1,template:"#: location.building #, #: location.floor #, #: location.zone #"},{field:"devices",title:"Devices",sortable:!1,template:"Indoor #: devices.Indoor.length #"},{field:"controlBy",title:"Control By",sortable:!1},{field:"controlType",title:"Control Type",sortable:!1},{field:"operation",title:"Operation",sortable:!1}]}),_=new Date,b=new Date(_.getFullYear(),_.getMonth(),1),T=_;m.find(".toolbar").find(".item.start").find("input[data-role=startDate]").val(O(b)),m.find(".toolbar").find(".item.end").find("input[data-role=endDate]").val(O(T)),m.find("li.start .device-history-calendar").kendoPopupSingleWindow({title:"Date Picker",width:"365px",height:"460px",modal:!1,resizable:!1,scrollable:!1,visible:!1,draggable:!1}).closest(".popup-window").addClass("dateStart"),m.find("li.end .device-history-calendar").kendoPopupSingleWindow({title:"Date Picker",width:"365px",height:"460px",modal:!1,resizable:!1,scrollable:!1,visible:!1,draggable:!1}).closest(".popup-window").addClass("dateEnd");var y=$("#popup-timepicker-start").kendoPopupSingleWindow({title:"Time Picker",width:"500px",height:"320px",modal:!1,resizable:!1,scrollable:!1,visible:!1,draggable:!1}),C=$("#popup-history").find(".toolbar-content.date").find(".item.start").find("[data-role=startTime]");C.val("00:00");var h=$("#popup-timepicker-end").kendoPopupSingleWindow({title:"Time Picker",width:"500px",height:"320px",modal:!1,resizable:!1,scrollable:!1,visible:!1,draggable:!1}),w=$("#popup-history").find(".toolbar-content.date").find(".item.end").find("[data-role=endTime]");function I(e,t){for(var i=e.find(".timepicker"),a=e.find(".popup-footer").find("button[data-event=ok]"),n=e.find(".popup-footer").find("button[data-event=cancel]"),o=[],r=0;r<60;r++){var s;s=r<10?"0"+r:""+r,o.push(s)}e.css({backgroundColor:"#f7f7f7"}),e.find(".popup-header").css({borderBottom:0}),e.find(".popup-container").css({height:"200px"}),i.css({textAlign:"center",marginTop:"80px"}),i.find(".k-dropdown").css({width:"150px"}),i.find(".k-dropdown-wrap").css({top:"-7px",left:"-11px",width:"109px"}),i.find(".k-icon").css({top:"16px",right:"5px"}),a.on("click",function(){t.val("00:00"),e.data("kendoPopupSingleWindow").close()}),n.on("click",function(){e.data("kendoPopupSingleWindow").close()})}function O(e){return l(e).format("L").replace(/\./g,"-")}w.val("00:00"),I(y,C),I(h,w),m.kendoPopupSingleWindow("addEventToFactory","#popup-history .item.start [data-event=calendar]","singleDeviceHistoryCalendarStartOpen",function(e){var t=$(".popup-window.dateStart").find(".device-history-calendar");t.kendoPopupSingleWindow("openWindowPopup"),t.closest(".popup-window").css({top:"212px",left:"759px"})}),m.kendoPopupSingleWindow("addEventToFactory","#popup-history .item.end [data-event=calendar]","singleDeviceHistoryCalendarEndOpen",function(e){var t=$(".popup-window.dateEnd").find(".device-history-calendar");t.kendoPopupSingleWindow("openWindowPopup"),t.closest(".popup-window").css({top:"212px",left:"1188px"})}),m.kendoPopupSingleWindow("addEventToFactory",".device-history-calendar .popup-footer [data-event=ok]","singleDeviceHistoryCalendarOk",function(e){var t=$(e.target).closest(".popup-window"),i=m.find(".toolbar");365<(T.getTime()-b.getTime())/864e5&&(b=new Date(T.getFullYear(),T.getMonth(),T.getDate())).setYear(T.getFullYear()-1),0<T-_&&(T=new Date),T<b&&(b=new Date(_.getFullYear(),_.getMonth(),1)),i.find(".item.start").find("input[data-role=startDate]").val(O(b)),i.find(".item.end").find("input[data-role=endDate]").val(O(T)),t.hasClass("dateStart")?$(".popup-window.dateStart .device-history-calendar").data("kendoPopupSingleWindow").close():t.hasClass("dateEnd")&&$(".popup-window.dateEnd .device-history-calendar").data("kendoPopupSingleWindow").close()}),m.kendoPopupSingleWindow("addEventToFactory","#popup-history .item.start [data-event=timepicker]","singleDeviceHistoryTimePickerStartOpen",function(e){y.kendoPopupSingleWindow("openWindowPopup"),y.closest(".popup-window").css({top:"212px",left:"890px"})}),m.kendoPopupSingleWindow("addEventToFactory","#popup-history .item.end [data-event=timepicker]","singleDeviceHistoryTimePickerEndOpen",function(e){h.kendoPopupSingleWindow("openWindowPopup"),h.closest(".popup-window").css({top:"212px",left:"1320px"})});var A={title:s.prop("COMMON_BTN_DETAIL"),width:652,height:830,buttonsIndex:{CLOSE:0,EDIT:1,CANCEL:2,SAVE:3,REGISTER:4,DEREGISTER:5,DELETE:6},contentViewModel:{clickHistoryBtn:function(){g.data("kendoGrid").dataSource.data(f),m.kendoPopupSingleWindow("openWindowPopup")},detailType:s.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',listTemplate:i.multiDetailListDualTemplate,headerTemplate:"<span>"+s.prop("FACILITY_DEVICE_SELECTED_DEVICE")+": <span>#:count #</span></span>",isCustomActions:!0,actions:[{text:s.prop("COMMON_BTN_CLOSE"),visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}}],scheme:{id:"id",fields:{type:{type:"text",name:s.prop("FACILITY_DEVICE_TYPE"),template:d.getDetailDisplayTypeDeviceI18N},id:{type:"text",name:s.prop("FACILITY_DEVICE_DEVICE_ID")},name:{type:"text",name:s.prop("FACILITY_DEVICE_DEVICE_NAME")},representativeStatus:{type:"text",name:s.prop("COMMON_STATUS"),template:i.detailStatusIconTemplate},modes:{type:"text",name:s.prop("FACILITY_INDOOR_CONTROL_OPERATION_MODE"),template:function(e){var t=e.modes;return t&&0<t.length?d.getDisplayModeI18N(t,e.operations,!0):"-"}},setTemperature:{type:"text",name:s.prop("FACILITY_INDOOR_SET_TEMPERATURE"),template:t.setTemperatures},currentTemperature:{type:"text",name:s.prop("FACILITY_INDOOR_CURRENT_TEMPERATURE"),template:t.curTemperatures},configuration:{type:"text",name:s.prop("FACILITY_INDOOR_REMOTE_CONTROL"),template:function(e){var t=e.configuration;return t&&t.remoteControl?"Allowed"===t.remoteControl?s.prop("FACILITY_INDOOR_REMOTE_CONTROL_ENABLE"):"NotAllowed"===t.remoteControl?s.prop("FACILITY_INDOOR_REMOTE_CONTROL_DISABLE"):s.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_CONDITIONAL"):"-"}},locations:{type:"text",name:s.prop("COMMON_LOCATION"),template:t.getLocation},groups:{type:"text",name:s.prop("FACILITY_GROUP_GROUP"),template:t.getGroup},information:{type:"text",name:s.prop("FACILITY_DEVICE_MODEL"),template:function(e){var t="-",i=e.information;if(i&&i.modelName){t=i.modelName;var a=s.prop("FACILITY_DEVICE_STATUS_POPUP_MODEL_"+t.toUpperCase());t=a||t}return t}},firmwareVersion:{type:"text",name:s.prop("FACILITY_DEVICE_FIRMWARE_VERSION"),template:t.getFirmwareVersion},description:{type:"text",name:s.prop("COMMON_DESCRIPTION")}}}},E=u.template(a.groupControlTemplate);E=E(c.viewModel);var D={title:s.prop("FACILITY_GROUP_CONTROL"),width:932,height:888,buttonsIndex:{CLOSE:0},groupListOptions:{dataSource:[],hasNewDataSource:!1,hasSelectedModel:!0,hideTab:!0,type:"hybrid",filterTab:[{hideHeader:!0,listStyle:"treeList",widgetOptions:{expand:function(e){var t=n.dataSource,i=e.model;return n.groupList.setDataSourceExpand(i,t),!1}},listOptions:{column:{template:function(e){return e.treeGroup&&e.field&&-1!=e.field.indexOf("displayType")?function(e){var t=e.value,i="-";t&&(t=t.split("_"),i=d.getDetailDisplayTypeDeviceI18N(t[1]));var a=e.aggregates;return a&&a.displayType&&a.displayType.count&&(i+=" ("+a.displayType.count+")"),i}(e):"<div class='detail-dialog-header detail-multi-dialog-header'>"+i.multiDetailListTemplate(e,!0)+"</div>"}},group:[{field:"displayType",aggregates:[{field:"displayType",aggregate:"count"}]}]}}]},gridOptions:{hasSelectedModel:!0,setSelectedAttribute:!0,selectable:"row multiple",columns:[{field:"displayType",hidden:!0,groupHeaderTemplate:function(e){var t=e.value,i="-";return t&&(t=t.split("_"),i=d.getDetailDisplayTypeDeviceI18N(t[1])),"<span>"+i+"<span> (<span>"+(e.count?e.count:"-")+"</span>)"}},{headerTemplate:"",template:function(e){return i.multiDetailListTemplate(e,!0)}}],scrollable:{virtual:!0}},headerViewModel:{deviceNum:0,selectedNum:0,groupName:""},detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',headerTemplate:'<span><span data-bind="text: groupName"></span> (<span data-bind="text:deviceNum"></span>)</span><span class="selected-num"><span>'+s.prop("FACILITY_DEVICE_SELECTED_DEVICE")+' : <span data-bind="text:selectedNum"></span></span></span>',contentTemplate:'<div class="group-control-dialog detail-dialog-content device-dialog-content" style="width:592px;"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div>'+E+"</div>",listTemplate:function(e){return i.multiDetailListTemplate(e,!0)},isCustomActions:!0,hasDetail:!1,isOnlyMulti:!0,actions:[{text:s.prop("COMMON_BTN_CLOSE"),visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}}],onTypeChange:function(e){var t=e.sender,i=e.type,a=i.groupId,n=c.viewModel;n.init(t,a);var o=t.contentElem.find(".group-control-dialog-control");console.info(o),u.unbind(o),u.bind(o,n);var r,s=i.invisible;if(s)for(r in s)n.get(r).set("invisible",s[r]);var d=i.currentValue;n.light.set("value",d.dimmingLevel),n.light.power.set("active",d.light),n.light.power.set("mixed",d.mixed),n.point.aoav.set("value",d.aoav),n.point.dodv.set("active",d.dodv),n.point.dodv.set("mixed",d.dodvMixed);var l=i.indoorList,p=t.contentElem.find(".control-panel").kendoControlTab({groupMode:!0,change:c.indoorControl}).data("kendoControlTab");p.setDataSource(l),c.indoorControlPanelInvisible(p)}};return{msgDialog:o,confirmDialog:r,getDetailPopup:function(){return p.kendoDetailDialog(A).data("kendoDetailDialog")},getGroupControlPopup:function(){return n=v.kendoDetailDialog(D).data("kendoDetailDialog")}}}),define("operation/group/create",["operation/core","operation/group/config/group-create-vm","operation/group/config/group-model","device/common/device-model","device/common/device-template","device/common/device-util","operation/group/config/group-common","operation/group/config/group-widget"],function(t,v,o,e,n,x,R,r){"use strict";function s(e){var t=G.parseFailResponse(e);w.message(t),w.open()}function d(e){var t,i,a=Q.length;for(t=0;t<a;t++)if(-1!=(i=Q[t]).indexOf(e))return i}var l,p,M,c,B,F,u,f=e.Device,P=window.kendo,k=window.MAIN_WINDOW,G=window.Util,m=window.I18N,g=window.GlobalSettings,_=new window.CommonLoadingPanel,b=$("#group-create-tab"),T=$("#group-common-tab"),V=$("#group-create-energy-distribution-checkbox"),i=$("#group-view"),y=$("#group-create-name"),C=new P.Router,a=new P.Layout("<div id='group-view-content' class='group-view-content'></div>"),h=r.confirmDialog,w=r.msgDialog,I=$("#map-panel"),U="",O=0,A=1,Y=2,E=0,D=1,L=2,S=0,N=1,W=!1,H=!1,j=!1,z=!1,Z=!1,X=[],q=[],Q=[],K=v.Views,J=v.MainViewModel,ee=function(){var e=[];C.bind("init",ae);var t={zoneDataSource:e,dataSource:e,isRegisterView:!0,canDragDeviceIcon:!1,showDeviceValue:!1};K.map.widget=R.createNewWidget("create-group-map",P.ui.CommonMapView,t),K.map.view=new P.View(K.map.widget.element),C.route(K.map.routeUrl,ne.bind(C,K.map.view));var i={columns:[{field:"type",title:m.prop("FACILITY_DEVICE_TYPE"),width:100,template:G.getDetailDisplayTypeDeviceI18N},{field:"id",title:m.prop("FACILITY_DEVICE_DEVICE_ID"),width:100},{field:"name",title:m.prop("FACILITY_DEVICE_DEVICE_NAME"),width:100},{field:"locations",title:m.prop("FACILITY_HISTORY_LOCATION"),width:100,template:x.getLocation,sortable:{compare:x.sortableLocation}},{field:"group",title:m.prop("FACILITY_GROUP_GROUP"),width:100,template:x.getGroup,sortable:{compare:x.sortableGroup}},{field:"detail",title:m.prop("FACILITY_HISTORY_DETAIL"),width:80,sortable:!1,template:'<span class="ic ic-info" data-id="#: id #"></span>'}],dataSource:[],height:"100%",sortable:!0,filterable:!1,pageable:!1,hasSelectedModel:!0,selectable:"multiple row",scrollable:{virtual:!0}};K.list.selected.widget=R.createNewWidget("group-create-selected-list",P.ui.Grid,i),K.list.selected.view=new P.View(K.list.selected.widget.wrapper),C.route(K.list.selected.routeUrl,ne.bind(C,K.list.selected.view)),K.list.floor.widget=R.createNewWidget("group-create-floor-list",P.ui.Grid,i),K.list.floor.view=new P.View(K.list.floor.widget.wrapper),C.route(K.list.floor.routeUrl,ne.bind(C,K.list.floor.view));var a=k.getCurrentFloorName();M=I.kendoDeviceTabGroupGrid({dataSource:[],hasNewDataSource:!1,hasSelectedModel:!0,type:"hybrid",filterTab:[{hideHeader:!0,template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",listStyle:"treeList",widgetOptions:{expand:function(e){var t=K.list.selected.widget.dataSource,i=e.model;return-1!=i.field.indexOf("displayType")&&M.setDataSourceExpand(i,t),!1}},listOptions:{column:{template:function(e){if(e.treeGroup&&e.field){if(-1!=e.field.indexOf("buildings_id"))return Le(e);if(-1!=e.field.indexOf("floors_id"))return Se(e);if(-1!=e.field.indexOf("displayType"))return Ne(e)}return n.mapListRegTemplate(e)}},group:[{field:"locations[0].foundation_space_buildings_id",dir:"desc",aggregates:[{field:"locations[0].foundation_space_buildings_id",aggregate:"count"}]},{field:"locations[0].foundation_space_floors_id",dir:"desc",aggregates:[{field:"locations[0].foundation_space_floors_id",aggregate:"count"}]},{field:"displayType",aggregates:[{field:"displayType",aggregate:"count"}]}]}},{template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",listStyle:"treeList",hideHeader:!0,widgetOptions:{expand:function(e){var t=K.list.floor.widget.dataSource,i=e.model;return-1!=i.field.indexOf("displayType")&&M.setDataSourceExpand(i,t),!1}},listOptions:{column:{template:function(e){if(e.treeGroup&&e.field){if(-1!=e.field.indexOf("buildings_id"))return Le(e);if(-1!=e.field.indexOf("floors_id"))return Se(e);if(-1!=e.field.indexOf("displayType"))return Ne(e)}return n.mapListRegTemplate(e)}},group:[{field:"locations[0].foundation_space_buildings_id",dir:"desc",aggregates:[{field:"locations[0].foundation_space_buildings_id",aggregate:"count"}]},{field:"locations[0].foundation_space_floors_id",dir:"desc",aggregates:[{field:"locations[0].foundation_space_floors_id",aggregate:"count"}]},{field:"displayType",aggregates:[{field:"displayType",aggregate:"count"}]}]}}],tabViewModel:[{name:m.prop("COMMON_SELECTED"),click:function(){},count:0},{name:a,click:function(){},count:0}],activateTab:function(e){var t;B&&F&&se(),t=0==e.index?K.list.selected.widget.dataSource:K.list.floor.widget.dataSource,e.sender.setDataSource(t,!0,!0)},change:he}).data("kendoDeviceTabGroupGrid"),c=r.getDetailPopup(),C.start()},te=function(){var e=l.contentElement(0);(e=$(e)).on("keyup",".group-create-name-wrapper input",function(e){var t=$(this).siblings(".ic-bt-input-remove");0<t.length&&($(this).val()?t.is(":visible")||t.show():t.hide())}),e.on("click",".group-create-name-wrapper .ic.ic-bt-input-remove",function(e){var t=$(this),i=t.siblings("input");i.val(""),i.data("kendoCommonValidator")&&i.data("kendoCommonValidator").validate(),t.hide()}),B=$("#"+J.filters[O].id).data("kendoDropDownCheckBox"),F=$("#"+J.filters[A].id).data("kendoDropDownList"),B.selectAll(),B.bind("selectionChanged",function(e){var t,i,a,n=e.newValue.length;if(n==v.typeFilterDataSource.length)re(),e.newValue="All";else if(1<n||0==n)re();else{t=(t=e.newValue[0]).replace(".","");var o=G.getDeviceTypeList(t,!0);if("Meter"==t){a=o.length;var r,s,d,l=[];for(i=0;i<a;i++)r=o[i].type,s=o[i].displayType,d=r.replace(".","_").toUpperCase(),s=(d=m.prop("FACILITY_DEVICE_TYPE_FILTER_"+d.toUpperCase()))||s,l.push({type:r,displayType:s});o=l}if("AirConditioner"==t)for(a=o.length,o=$.extend(!0,[],o),i=a-1;0<=i;i--)"AirConditioner.SFCU"==o[i].type&&o.splice(i,1),"AirConditioner.FCU"==o[i].type&&(o[i].type="AirConditioner.FCU,AirConditioner.SFCU");if(1==o.length&&o[0].type==t||o.length<1)re();else{var p=v.typeFilterText[t],c=m.prop("COMMON_ALL")+" "+p+" "+m.prop("FACILITY_DEVICE_TYPE"),u=new P.data.DataSource({data:o});u.read(),re(),J.filters[A].set("disabled",!1),F.setOptions({optionLabel:{displayType:c,type:"All"}}),F.setDataSource(u)}}se(null,e.newValue)}),J.filters[A].options.set("select",function(e){e.dataItem&&se(null,null,e.dataItem.type)}),J.filters[Y].options.set("click",we),J.mapBtn.set("click",function(){1!=J.mapBtn.get("active")&&(U="map",J.category.set("invisible",!0),C.navigate(K.map.routeUrl),Te(U))}),J.listBtn.set("click",function(){1!=J.listBtn.get("active")&&(U="list",J.category.set("invisible",!1),J.category.selected.click(!0),Te(U))}),K.list.selected.widget.bind("change",he),K.list.floor.widget.bind("change",he),K.map.widget.bind("change",he),J.category.selected.set("click",function(e){if(1!=J.category.selected.get("active")||e){J.category.selected.set("active",!0),J.category.floor.set("active",!1),C.navigate(K.list.selected.routeUrl);var t=K.list.selected.widget.dataSource;W=!1,J.filters[O].set("disabled",!0),F.value()&&J.filters[A].set("disabled",!0),t.group([]),se()}}),J.category.floor.set("click",function(){if(1!=J.category.floor.get("active")){J.category.floor.set("active",!0),J.category.selected.set("active",!1),C.navigate(K.list.floor.routeUrl);var e=K.list.floor.widget.dataSource;W=!0,V.prop("checked")?(J.filters[O].set("disabled",!0),J.filters[A].set("disabled",!0)):(J.filters[O].set("disabled",!1),F.value()&&J.filters[A].set("disabled",!1)),e.group([]),se()}}),J.actions[D].options.set("click",function(){if(y.data("kendoCommonValidator").validate()){_.open(),le(u);var e=u.toJSON();e.description||delete e.description,H?$.ajax({url:"/dms/groups/"+e.id,method:"PATCH",data:e}).done(function(){require(["operation/group/group"],function(e){e.closeCreateBtnEvt()}),w.message(R.MSG.TXT_EDIT_GROUP_RESULT),w.open()}).fail(function(e){var t=G.parseFailResponse(e);w.message(t),w.open()}).always(function(){_.close()}):(delete e.id,$.ajax({url:"/dms/groups",method:"POST",data:e}).done(function(){require(["operation/group/group"],function(e){e.closeCreateBtnEvt()}),w.message(R.MSG.TXT_CREATE_GROUP_RESULT),w.open()}).fail(function(e){var t=G.parseFailResponse(e);e.responseJSON&&41321===e.responseJSON.code&&(t=R.MSG.TXT_MAXIMUM_NUMBER_OF_GROUP),w.message(t),w.open()}).always(function(){_.close()}))}}),J.actions[L].options.set("click",function(){h.message(R.MSG.TXT_CANCEL_GROUP_CONFIRM),h.setConfirmActions({yes:function(){l.hide(),p.show()}}),h.open()}),K.list.selected.widget.element.on("click","tbody tr td .ic-info",Ae),K.list.floor.widget.element.on("click","tbody tr td .ic-info",Ae),M.element.on("click","tbody tr td .ic-info",Ae),t.on("onfloorchange",oe),V.on("change",ie)},ie=function(e){e.target.checked?(B.selectAll(),re(),J.filters[O].set("disabled",!0),J.filters[A].set("disabled",!0),Oe()):J.listBtn.active&&J.category.selected.active||(J.filters[O].set("disabled",!1),F.value()&&J.filters[A].set("disabled",!1)),se()},ae=function(){C.replace("/create",!0),a.render(i)},ne=function(t){try{a.showIn("#group-view-content",t)}catch(e){a.showIn("#group-view-content",t)}},oe=function(e){var t=k.getCurrentFloorName();M.tabViewModel[N].set("name",t),J.category.floor.set("text",t),de(e,u)},re=function(){J.filters[A].set("disabled",!0),F.setOptions({optionLabel:m.prop("FACILITY_DEVICE_TYPE_SUB")});var e=new P.data.DataSource({data:[]});F.setDataSource(e)},se=function(e,t,i){var a,n,o,r=(e=e||k.getCurrentFloor()).floor,s=e.building;t&&"All"!=t||(t=(t=B.value())?t.split(","):t),i=i||F.value();var d,l,p={logic:"and",filters:[]},c={logic:"and",filters:[]},u=!1,v=!1;("map"==U&&1==M.selectedIndex||"list"==U&&W)&&(v=u=!0);var f=!1;("map"==U&&0==M.selectedIndex||"list"==U&&!W)&&(f=!0),s&&s.id!=k.FLOOR_NAV_BUILDING_TOTAL_ID&&(d=x.filter1Depth("locations","foundation_space_buildings_id",s.id),u&&p.filters.push(d),c.filters.push(d)),r&&r.id!=k.FLOOR_NAV_FLOOR_ALL_ID&&(l=x.filter1Depth("locations","foundation_space_floors_id",r.id),u&&p.filters.push(l),c.filters.push(l));var m={logic:"or",filters:[]};if(t&&0<t.length){for(o=t.length,n=0;n<o;n++)(a=t[n])&&("ControlPoint"!=a&&m.filters.push({field:"type",operator:"contains",value:a}),m.filters.push({field:"mappedType",operator:"contains",value:a}));f||p.filters.push(m),c.filters.push(m)}var g={logic:"and",filters:[]};if(i&&"All"!=i){var _=i.split(",");if(1<_.length){o=_.length;var b={logic:"or",filters:[]};for(n=0;n<o;n++)b.filters.push({field:"type",operator:"eq",value:_[n]});g.filters.push(b)}else g.filters.push({field:"type",operator:"eq",value:i});f||p.filters.push(g),c.filters.push(g)}var T={logic:"and",filters:[{field:"airConditioner",operator:function(e){return void 0!==e&&G.isSupportEnergyDistributionType(e.indoorUnitType)}}]};V.prop("checked")&&(p.filters.push(T),c.filters.push(T));var y=K.list.floor.widget.dataSource,C=K.map.widget.dataSource,h={logic:"and",filters:[{field:"selected",operator:"eq",value:!1}]};f&&p.filters.push({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}),v&&p.filters.push(h);var w,I,O=K.list.floor.widget,A=K.list.selected.widget;O.virtualScrollable&&(w=O.virtualScrollable.verticalScrollbar.scrollTop()),A.virtualScrollable&&(I=A.virtualScrollable.verticalScrollbar.scrollTop()),y.filter(p),O.virtualScrollable&&O.virtualScrollable.verticalScrollbar.scrollTop(w),A.virtualScrollable&&A.virtualScrollable.verticalScrollbar.scrollTop(I),"map"==U&&(M.setDataSource(y,!1,!0,!0),M.tabGrids[M.selectedIndex].dataSource.filter(p),C.filter(c));var E=y.data(),D=new P.data.Query(E).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray();Ee(D.length);var L,S=[];s.id!=k.FLOOR_NAV_BUILDING_TOTAL_ID&&(L={logic:"and",filters:[d]},S.push(L)),r.id!=k.FLOOR_NAV_FLOOR_ALL_ID&&(L={logic:"and",filters:[l]},S.push(L)),0<m.filters.length&&S.push(m),0<g.filters.length&&S.push(g),V.prop("checked")&&S.push(T),S.push(h);var N=new P.data.Query(E).filter(S).toArray();De(N.length),J.filters[Y].get("text")==R.MSG.TXT_SELECT_ALL&&(0!=N.length?J.filters[Y].set("disabled",!1):J.filters[Y].set("disabled",!0))},de=function(o,r){_.open(),me(o).done(function(e){K.map.widget.setFloor(o.floor),K.map.widget.setZoneDataSource(e),K.map.widget.setDataSource([])}).fail(s).always(function(){ge(o).done(function(e){q=e,X=k.getCurrentBuildingList()}).fail(s).always(function(){_e(o).done(function(e){var n=new P.data.DataSource({data:e,pageSize:50});n.read(),ce(n,r).done(function(){z||pe(r);var e=o.floor,t=o.building,i=[];if(t&&t.id!=k.FLOOR_NAV_BUILDING_TOTAL_ID&&i.push(x.filter1Depth("locations","foundation_space_buildings_id",t.id)),e&&e.id!=k.FLOOR_NAV_FLOOR_ALL_ID&&i.push(x.filter1Depth("locations","foundation_space_floors_id",e.id)),n.filter(i),K.list.floor.widget.setDataSource(n),K.list.selected.widget.setDataSource(n),t&&t.id!=k.FLOOR_NAV_BUILDING_TOTAL_ID&&e&&e.id!=k.FLOOR_NAV_FLOOR_ALL_ID){var a=n.data();a=a.toJSON(),(a=new P.data.DataSource({data:a})).read(),K.map.widget.setDataSource(a)}else K.map.widget.setDataSource(new P.data.DataSource({data:[]}));"map"==U?(M.selectTab(M.selectedIndex,!0),J.filters[O].set("disabled",!(""==r.type||"General"==r.type))):"list"==U&&(n.group([]),J.category.floor.get("active")&&J.filters[O].set("disabled",!(""==r.type||"General"==r.type)))}).fail(s).always(function(){o.floor.id==k.FLOOR_NAV_FLOOR_ALL_ID||o.building.id==k.FLOOR_NAV_BUILDING_TOTAL_ID?(J.mapBtn.set("disabled",!0),J.listBtn.click()):(J.mapBtn.set("disabled",!1),"list"==U?J.listBtn.click():J.mapBtn.click()),se(),_.close()})}).fail(s)})})},le=function(e){var t=y.val(),i=0==V.prop("checked")?"General":"EnergyDistribution";e.set("name",t),e.set("type",i);var a,n=K.list.floor.widget.dataSource.data(),o=n.length,r=[];for(a=0;a<o;a++)n[a].selected&&r.push(n[a].id);e.set("dms_devices_ids",r)},pe=function(e){var t=e.name?e.name:"",i=void 0!==e.type?e.type:"General";y.val(t),V.prop("checked","EnergyDistribution"==i),z=!0},ce=function(r,e){var t=new $.Deferred,i=K.list.floor.widget.dataSource.data(),a=new P.data.Query(i).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray(),n=e.dms_devices_ids?e.dms_devices_ids:[];return 0<n.length&&!Z?($.ajax({url:"/dms/devices?ids="+n.join(",")}).done(function(e){var t,i,a,n,o=e.length;for(e=fe(e),t=0;t<o;t++)i=(a=e[t]).id,(n=r.get(i))?n.set("selected",!0):(a.selected=!0,r.add(a))}).fail(s).always(function(){ue(r,a),t.resolve()}),Z=!0):(ue(r,a),t.resolve()),t.promise()},ue=function(e,t){var i,a,n,o,r=t.length;for(o=0;o<r;o++)a=t[o],(n=e.get(a.id))?n.set("selected",!0):e.add(a);i=e.data(),t=new P.data.Query(i).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray(),Ee(t.length)},ve=function(){var e,t,i,a=g.getDeviceTypeOrdering(),n=[],o=a.length;for(i=0;i<o;i++)e=a[i],t=G.getDetailDisplayType(e,!0),n.push(i+"_"+t),"Sensor.Temperature_Humidity"==e&&(n.push(i+"_"+G.getDetailDisplayType("Sensor.Temperature",!0)),n.push(i+"_"+G.getDetailDisplayType("Sensor.Humidity",!0)));return n},fe=function(e){if(!e)return[];var t,i,a,n=[],o=e.length;for(a=0;a<o;a++)(t=e[a]).locations&&!t.locations[0]&&(t.locations[0]={}),t.selected=!1,i=G.getDetailDisplayType(t.mappedType||t.type,!0),i=d(i),t.displayType=i,t=new f(t),n.push(t);return n},me=function(e){var t=new $.Deferred,i=e.floor,a=e.building;if(!i||!i.id||i.id==k.FLOOR_NAV_FLOOR_ALL_ID)return t.resolve([]),t.promise();if(!a||!a.id||a.id==k.FLOOR_NAV_BUILDING_TOTAL_ID)return t.resolve([]),t.promise();var n=be(e);return $.ajax({url:"/foundation/space/zones"+n})},ge=function(e){var t=new $.Deferred,i=e.building;if(!i||!i.id||i.id==k.FLOOR_NAV_BUILDING_TOTAL_ID)return t.resolve([]),t.promise();var a=be(null,!0,["id, name, type"]);return $.ajax({url:"/foundation/space/floors"+a})},_e=function(e){var t=be(e);return-1!=t.indexOf("&")&&(t+="&"),t+="registrationStatuses=Registered&",t+="attributes=id,name,type,mappedType,registrationStatus,locations,groups,airConditioner&",t+="types="+v.typeQuery.join(","),$.ajax({url:"/dms/devices"+t}).then(fe)},be=function(e,t,i){var a="?";if(e){var n=e.building.id,o=e.floor.id;n&&n!=k.FLOOR_NAV_BUILDING_TOTAL_ID&&(a+="foundation_space_buildings_id="+n+"&"),t||o&&o!=k.FLOOR_NAV_FLOOR_ALL_ID&&(a+="foundation_space_floors_id="+o+"&")}return i&&0<i.length&&(a+="attributes="+i.join(",")),a},Te=function(e){k.disableFloorNav(!1);var t=k.getCurrentFloor();t.floor.id==k.FLOOR_NAV_FLOOR_ALL_ID||t.building.id==k.FLOOR_NAV_BUILDING_TOTAL_ID?J.mapBtn.set("disabled",!0):J.mapBtn.set("disabled",!1),"map"==e?ye():"list"==e&&Ce()},ye=function(){F=$("#"+J.filters[A].id).data("kendoDropDownList"),M.selectTab(0,!0),J.mapBtn.set("active",!0),J.listBtn.set("active",!1),J.set("hidePanel",!1),J.set("hideMapPanel",!1),V.prop("checked")?(J.filters[O].set("disabled",!0),J.filters[A].set("disable",!1)):(J.filters[O].set("disabled",!1),F.value()&&J.filters[A].set("disabled",!1))},Ce=function(){J.listBtn.set("active",!0),J.mapBtn.set("active",!1),J.set("hidePanel",!0),J.set("hideMapPanel",!1)},he=function(e){var t=e.sender,i=e.item?[e.item]:e.devices;if(i){var a,n,o,r=t instanceof P.ui.CommonMapView&&"map"==U,s=i.length,d=K.list.floor.widget.dataSource;for(n=0;n<s;n++)a=i[n],r||K.map.widget.selectDevice(a.id,a.selected),(o=d.get(a.id))&&(o.selected=a.selected);se()}},we=function(e){this.get("text")==R.MSG.TXT_SELECT_ALL?(Ie(),this.set("text",R.MSG.TXT_UNSELECT_ALL)):(Oe(),this.set("text",R.MSG.TXT_SELECT_ALL))},Ie=function(){var e,t,i=K.list.floor.widget.dataSource.data(),a=k.getCurrentFloor(),n=a.building,o=a.floor,r={logic:"and",filters:[]};n&&n.id!=k.FLOOR_NAV_BUILDING_TOTAL_ID&&(e=x.filter1Depth("locations","foundation_space_buildings_id",n.id),r.filters.push(e)),o&&o.id!=k.FLOOR_NAV_FLOOR_ALL_ID&&(t=x.filter1Depth("locations","foundation_space_floors_id",o.id),r.filters.push(t));var s=B.value();s=s?s.split(","):s;var d,l,p,c=F.value(),u={logic:"or",filters:[]};if(s&&"All"!=s&&0<s.length){for(l=s.length,d=0;d<l;d++)(p=s[d])&&("ControlPoint"!=p&&u.filters.push({field:"type",operator:"contains",value:p}),u.filters.push({field:"mappedType",operator:"contains",value:p}));r.filters.push(u)}var v={logic:"and",filters:[]};if(c&&"All"!=c){var f=c.split(",");if(1<f.length){l=f.length;var m={logic:"or",filters:[]};for(d=0;d<l;d++)m.filters.push({field:"type",operator:"eq",value:f[d]});v.filters.push(m)}else v.filters.push({field:"type",operator:"eq",value:c});r.filters.push(v)}var g={logic:"and",filters:[{field:"airConditioner",operator:function(e){return void 0!==e&&G.isSupportEnergyDistributionType(e.indoorUnitType)}}]};V.prop("checked")&&r.filters.push(g);var _=new P.data.Query(i).filter(r).toArray();for(l=_.length,d=0;d<l;d++)_[d].selected=!0;K.map.widget.selectAll(),se()},Oe=function(){K.list.floor.widget.clearSelection(),K.map.widget.unselectAll(),se()},Ae=function(e){var t=$(this).data("id");_.open(),$.ajax({url:"/dms/devices/"+t}).done(function(e){c.setDataSource([e]),c.open()}).fail(s).always(function(){_.close()}),c.open()},Ee=function(e){var t=J.category.floor.get("num");"string"==typeof t&&(t=t.replace("+","")),0!=e&&t==e&&J.filters[Y].set("text",R.MSG.TXT_UNSELECT_ALL),e<1?(J.actions[E].options.set("selectedText",m.prop("FACILITY_DEVICE_NO_SELECTED")),J.filters[Y].set("text",R.MSG.TXT_SELECT_ALL),J.actions[D].set("disabled",!0)):(J.actions[E].options.set("selectedText",m.prop("FACILITY_DEVICE_SELECTED",e)),J.filters[Y].set("text",R.MSG.TXT_UNSELECT_ALL),J.actions[D].set("disabled",!1)),M.tabViewModel[S].set("count",e),J.category.selected.set("num",e)},De=function(e){J.category.floor.set("num",e),M.tabViewModel[N].set("count",e)},Le=function(e){var t=e.value,i="-";if(t){var a,n,o=X.length;for(a=0;a<o;a++)if((n=X[a]).id==t){i=n.name;break}}var r=e.aggregates;return r&&r["locations[0].foundation_space_buildings_id"]&&r["locations[0].foundation_space_buildings_id"].count&&(i+=" ("+r["locations[0].foundation_space_buildings_id"].count+")"),i},Se=function(e){var t=e.value,i="-";if(t){var a,n,o=q.length;for(a=0;a<o;a++)if((n=q[a]).id==t){i="F"==n.type?n.name+n.type:"B"==n.type?n.type+n.name:n.name;break}}var r=e.aggregates;return r&&r["locations[0].foundation_space_floors_id"]&&r["locations[0].foundation_space_floors_id"].count&&(i+=" ("+r["locations[0].foundation_space_floors_id"].count+")"),i},Ne=function(e){var t=e.value,i="-";t&&(t=t.split("_"),i=G.getDetailDisplayTypeDeviceI18N(t[1]));var a=e.aggregates;return a&&a.displayType&&a.displayType.count&&(i+=" ("+a.displayType.count+")"),i};return{init:function(e){_.open(),l=b.data("kendoCommonTabStrip"),p=T.data("kendoCommonTabStrip");var t=l.select();y.val(""),y.siblings(".ic-bt-input-remove").hide(),y.data("kendoCommonValidator")&&y.data("kendoCommonValidator").hideMessages(),B&&(B.selectAll(),re()),e?(H=!0,u=e,t.find("a.text").text(R.MSG.TXT_EDIT_GROUP)):(H=!1,u=o.createModel(),t.find("a.text").text(R.MSG.TXT_CREATE_GROUP));var i=k.getCurrentFloor();if(Z=z=!1,j){var a=K.list.selected.widget.dataSource;a.data([]),(a=K.list.floor.widget.dataSource).data([]),(a=K.map.widget.dataSource).data([]),oe(i)}else{var n=l.contentElement(0);P.bind($(n),J),ee(),te(),j=!0,Q=ve(),oe(i)}}}}),define("operation/group/group",["operation/core","operation/group/config/group-model","operation/group/config/group-widget","operation/group/config/group-vm","operation/group/config/group-template","operation/group/config/group-common","operation/group/create","operation/group/config/group-control-vm","device/common/device-util","device/common/device-constants"],function(a,n,e,t,i,r,o,N,x,h){function w(e){var t,i,a=C.length;for(t=0;t<a;t++)if(-1!=(i=C[t]).indexOf(e))return i}function s(e,t){1==t&&e?g.actions[2].set("disabled",!e):g.actions[2].set("disabled",!0),g.actions[3].set("disabled",!e)}var R,d,l,p,c,M=window.kendo,u=window.GlobalSettings,v=new window.CommonLoadingPanel,B=window.Util,f=window.MAIN_WINDOW,m=window.I18N,g=t.MainViewModel,I=e.msgDialog,_=e.confirmDialog,b=$("#group-common-tab"),T=$("#group-create-tab"),y=$("#group-list"),C=[],O=function(){return $.ajax({url:"/dms/groups/summary/statisticView"}).then(function(e){var t,i,a,n,o,r=0,s=e.length;for(t=0;t<s;t++)if((a=e[t]).floors)for(o=a.floors.length,i=0;i<o;i++)if(0==(n=a.floors[i]).foundation_space_floors_id){r=n.numberOfGroups;break}console.info("Group Size : "+r),300<=r?g.actions[1].set("disabled",!0):g.actions[1].set("disabled",!1)})},A=function(e){var t="?",i=$("#"+g.filters[0].id).data("kendoDropDownList");e.building.id!=f.FLOOR_NAV_BUILDING_TOTAL_ID&&e.floor.id==f.FLOOR_NAV_FLOOR_ALL_ID&&(t+="foundation_space_buildings_id="+e.building.id+"&"),e.floor.id!=f.FLOOR_NAV_FLOOR_ALL_ID&&(t+="foundation_space_floors_id="+e.floor.id),v.open(),O().always(function(){$.ajax({url:"/dms/groups/summary/listView"+t}).done(function(e){var t=n.createDataSource(e),i=new M.data.DataSource({data:t});i.read(),p.setDataSource(i)}).fail(function(){var e=n.createDataSource(n.MockData),t=new M.data.DataSource({data:e});t.read(),p.setDataSource(t)}).always(function(){Z(0),S(i.value()),v.close()})})},E=function(){d=b.kendoCommonTabStrip().data("kendoCommonTabStrip"),l=T.kendoCommonTabStrip().data("kendoCommonTabStrip"),c=$("#group-close-create"),R=e.getGroupControlPopup(),$(l.wrapper[0].parentElement).css({display:"none"})},D=function(){p.bind("checked",F),y.on("click",".k-grid-content tr td button.control-btn",k),g.actions[1].options.set("click",U),g.actions[2].options.set("click",Y),g.actions[3].options.set("click",W),c.on("click",function(){_.message(r.MSG.TXT_CREATE_GROUP_CLOSE_CONFIRM),_.setConfirmActions({yes:function(){H()}}),_.open()}),R.bind("onClosed",G),g.filters[0].options.set("select",L)},L=function(e){e.dataItem&&S(e.dataItem.value)},S=function(e){var t=p.dataSource;if(t.filter({}),""!=e){var i={logic:"and",filters:[{field:"dms_groups_type",operator:"eq",value:e}]};t.filter(i)}},F=function(e){var t=p.getCheckedData();Z(t.length)},P=function(){var e,t,i,a=u.getDeviceTypeOrdering(),n=[],o=a.length;for(i=0;i<o;i++)e=a[i],t=B.getDetailDisplayType(e,!0),n.push(i+"_"+t),"Sensor.Temperature_Humidity"==e&&(n.push(i+"_"+B.getDetailDisplayType("Sensor.Temperature",!0)),n.push(i+"_"+B.getDetailDisplayType("Sensor.Humidity",!0)));return n},k=function(e){var C=$(this).data("id");v.open(),$.ajax({url:"/dms/groups/"+C+"/listView"}).done(function(e){var _,b,T,t,y=e.name?e.name:"-",i=e.devices,a=[];if(i)for(T=i.length,a=[],_=0;_<T;_++)(t=(b=i[_]).dms_devices_id)&&a.push(t);$.ajax({url:"/dms/devices?ids="+a.join(",")}).done(function(e){var t,i;console.info(e),T=e.length;var a,n,o,r,s={remoteControl:!0,point:!0,light:!0,gateway:!0,beacon:!0,"point.aoav":!0,"point.dodv":!0,"light.power":!0,"light.dimming":!0},d={aoav:0,dodv:!1,dimmingLevel:0,light:!1,mixed:!1,dodvMixed:!1},l=[],p=0,c=0,u=!1,v=!1,f=!1,m=!1;for(_=0;_<T;_++)(b=e[_]).selected=!0,t=b.type,i=b.mappedType,-1!=t.indexOf("AirConditioner.")?(s.indoorControlPanel=!1,l.push(b)):-1!=t.indexOf("Light")||i&&-1!=i.indexOf("Light")?(-1!=t.indexOf("AO")?s["light.dimming"]=!1:-1!=t.indexOf("DO")?s["light.power"]=!1:"Light"==t&&(s["light.dimming"]=!1,s["light.power"]=!1),s.light=s["light.dimming"]&&s["light.power"],-1==t.indexOf("AI")&&-1==t.indexOf("DI")&&("-"!=(p=x.getDimmingLevel(b))&&(p=p.replace("%",""),p=Number(p),d.dimmingLevel+=p,c++),"Normal.On"==(a=B.getNormalStatus(b))?u=!0:v=!0,a="Normal.On"==a,d.light=a||d.light),t="Light"):-1!=t.indexOf("AO")||-1!=t.indexOf("AV")?(s["point.aoav"]=!1,"-"!=(n=x.getPointValue(b))&&d.aoav<n&&(d.aoav=n)):-1!=t.indexOf("DO")||-1!=t.indexOf("DV")?(s["point.dodv"]=!1,"-"!=(o=x.getPointValue(b))&&(o=1==o,d.dodv=d.dodv||o,o?f=!0:m=!0)):-1!=t.indexOf("Gateway")?s.gateway=!1:-1!=t.indexOf("Beacon")&&(s.beacon=!1),r=B.getDetailDisplayType(b.mappedType||b.type,!0),r=w(r),b.displayType=r;u&&v&&(d.mixed=!0,d.light=!0),f&&m&&(d.dodv=!0,d.dodvMixed=!0),0!=c&&(d.dimmingLevel=Math.round(d.dimmingLevel/c)),s.point=s["point.aoav"]&&s["point.dodv"];var g=new M.data.DataSource({data:e});g.read(),g.sort([{field:"name",dir:"asc"}]),R.setDataSource(g),R.headerViewModel&&(R.headerViewModel.set("groupName",y),R.headerViewModel.set("deviceNum",e.length),R.headerViewModel.set("selectedNum",e.length)),R.open({invisible:s,groupId:C,indoorList:l,currentValue:d}),R.groupList.bind("change",V),R.interval=setInterval(N.refreshIndoorDevices.bind(R),h.ALL_TIME_INTERVAL)}).fail(function(e){var t=B.parseFailResponse(e);I.message(t),I.open()}).always(function(){v.close()})}).fail(function(e){v.close();var t=B.parseFailResponse(e);I.message(t),I.open()}).always(function(){})},G=function(e){clearInterval(e.sender.interval);var t=e.sender.element.find(".control-panel"),i=t.parent();t.remove(),i.append("<div class='control-panel'></div>")},V=function(e){console.info("change");var t,i=R.dataSource;e.item&&(t=i.get(e.item.id))&&t.set("selected",e.item.selected);var a=i.data(),n=new M.data.Query(a).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray();R.headerViewModel.set("selectedNum",n.length);var o,r,s,d,l,p,c=N.viewModel,u=new M.data.Query(n).filter({logic:"or",filters:[{field:"type",operator:"eq",value:"Light"},{field:"mappedType",operator:"eq",value:"Light"}]}).toArray(),v=0,f=0,m=u.length;if(0<m){var g=!1,_=!1,b=!1,T=!1;for(l=0;l<m;l++)(p=(o=u[l]).type)&&(-1!=p.indexOf("AO")?_=!0:-1!=p.indexOf("DO")?g=!0:"Light"==p&&(g=_=!0)),-1==p.indexOf("AI")&&-1==p.indexOf("DI")&&("-"!=(r=x.getDimmingLevel(o))&&(r=r.replace("%",""),v+=r=Number(r),f++),"Normal.On"==(d=B.getNormalStatus(o))?b=!0:T=!0,d="Normal.On"==d,void 0===s&&(s=d),s=d||s);0!=f&&(v=Math.round(v/f)),c.light.set("value",v),c.light.dimming.set("invisible",!_),c.light.power.set("invisible",!g);var y=g||_;c.light.set("invisible",!y),b&&T?(c.light.power.set("mixed",!0),c.light.power.set("active",!0)):(c.light.power.set("active",s),c.light.power.set("mixed",!1))}else c.light.set("invisible",!0);var C,h,w,I,O=new M.data.Query(n).filter({logic:"and",filters:[{field:"type",operator:"eq",value:"ControlPoint.AO"},{field:"mappedType",operator:"eq",value:"ControlPoint"}]}).toArray();if(0<(m=O.length)){for(l=0;l<m;l++)p=(o=O[l]).type,"-"!=(C=x.getPointValue(o))&&(w=w||C)<C&&(w=C);c.point.aoav.set("value",w),c.point.aoav.set("invisible",!1)}else c.point.aoav.set("invisible",!0);var A=new M.data.Query(n).filter({logic:"and",filters:[{field:"type",operator:"eq",value:"ControlPoint.DO"},{field:"mappedType",operator:"eq",value:"ControlPoint"}]}).toArray(),E=!1,D=!1;if(0<(m=A.length)){for(l=0;l<m;l++)o=A[l],"-"!=(h=x.getPointValue(o))&&(h=1==h,(I=I||h)<h&&(I=h),h?E=!0:D=!0);c.point.dodv.set("invisible",!1),E&&D?(c.point.dodv.set("active",!0),c.point.dodv.set("mixed",!0)):(c.point.dodv.set("active",I),c.point.dodv.set("mixed",!1))}else c.point.dodv.set("invisible",!0);c.point.dodv.get("invisible")&&c.point.aoav.get("invisible")?c.point.set("invisible",!0):c.point.set("invisible",!1);var L=R.element.find(".control-panel").data("kendoControlTab"),S=new M.data.Query(n).filter({logic:"and",filters:[{field:"type",operator:"contains",value:"AirConditioner."}]}).toArray();L.setDataSource(S),N.indoorControlPanelInvisible(L),0<(m=new M.data.Query(n).filter({logic:"or",filters:[{field:"type",operator:"eq",value:"Gateway"}]}).toArray().length)?c.gateway.set("invisible",!1):c.gateway.set("invisible",!0),0<(m=new M.data.Query(n).filter({logic:"or",filters:[{field:"type",operator:"eq",value:"Beacon"}]}).toArray().length)?c.beacon.set("invisible",!1):c.beacon.set("invisible",!0)},U=function(e){j()},Y=function(e){var t=p.getCheckedData();if(0<t.length){var i=(t=t[0]).dms_groups_id;v.open(),$.ajax({url:"/dms/groups/"+i+"/listView"}).done(function(e){var t=n.createModelByGroupIdData(e);j(t)}).fail(function(e){var t=B.parseFailResponse(e);I.message(t),I.open()}).always(function(){v.close()})}},W=function(e){var n=p.getCheckedData(),o=r.MSG.DELETE_CONFIRM;_.message(o),_.setConfirmActions({yes:function(){var t,i,a=n.length,e=[];for(v.open(),t=0;t<a;t++)i=n[t],e.push($.ajax({url:"/dms/groups/"+i.dms_groups_id,method:"DELETE"}));$.when.apply(this,e).done(function(){O().always(function(){Z(0),o=r.MSG.DELETE_RESULT,1<n.length&&(o=m.prop("FACILITY_GROUP_MESSAGE_NOTI_DELETED_SELECTED_MULTI_GROUP",n.length)),I.message(o),I.open()})}).fail(function(e){o=B.parseFailResponse(e),I.message(o),I.open()}).always(function(){var e=p.dataSource;for(a=n.length,t=0;t<a;t++)i=n[t],e.remove(i);v.close()})}}),_.open()},H=function(){z();var e=f.getCurrentFloor();A(e)},j=function(e){d.hide(),l.show(),o.init(e)},z=function(){l.hide(),d.show()},Z=function(e){0==e?(g.actions[0].options.set("selectedText",m.prop("FACILITY_GROUP_MESSAGE_NOTI_GROUP_NOT_SELECTED")),s(!1,e)):(g.actions[0].options.set("selectedText",m.prop("FACILITY_GROUP_MESSAGE_NOTI_GROUP_SELECTED",e)),s(!0,e))},X=function(e){var t,i=n.createDataSource(e),a={"AirConditioner.":!0,AirConditionerOutdoor:!0,"Sensor.Temperature_Humidity":!0,Light:!0,"Sensor.Motion":!0,ControlPoint:!0,"Meter.WattHour":!0,Gateway:!0,Beacon:!0,CCTV:!0,Etc:!0};for(t in a)B.isInstalledType(t,!0)&&(a[t]=!1);console.info(e),p=y.kendoGrid({columns:[{field:"dms_groups_type",title:m.prop("FACILITY_GROUP_ENERGY_DISTRIBUTION_TYPE"),width:120,template:function(e){var t=e.dms_groups_type,i="-";return void 0!==t&&("General"===t?i=m.prop("FACILITY_GROUP_ENERGY_DISTRIBUTION_NONE"):"EnergyDistribution"===t&&(i=m.prop("FACILITY_GROUP_ENERGY_DISTRIBUTION"))),i}},{field:"dms_groups_name",title:m.prop("FACILITY_GROUP_GROUP_NAME"),width:120,resizable:!0},{field:"total",title:m.prop("COMMON_TOTAL"),sortable:!1,resizable:!1,template:function(e){var t,i,a=e.deviceTypes;i=a.length;var n=0;for(t=0;t<i;t++)a[t].numberOfDevices&&(n+=a[t].numberOfDevices);return n}},{title:m.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR"),field:"AirConditioner",sortable:!1,resizable:!1,hidden:a["AirConditioner."],template:function(e){var t,i,a,n=e.deviceTypes;i=n.length;var o=0;for(t=0;t<i;t++)(a=n[t].dms_devices_type)&&-1!=a.indexOf("AirConditioner.")&&n[t].numberOfDevices&&(o+=n[t].numberOfDevices);return o}},{title:m.prop("FACILITY_DEVICE_TYPE_SAC_OUTDOOR"),field:"AirConditionerOutdoor",sortable:!1,resizable:!1,hidden:a.AirConditionerOutdoor,template:function(e){var t=0;return void 0!==e.AirConditionerOutdoor&&(t=e.AirConditionerOutdoor),t}},{title:m.prop("FACILITY_DEVICE_TYPE_TEMP_AND_HUMIDITY_SENSOR"),field:"Sensor.Temperature_Humidity",sortable:!1,resizable:!1,hidden:a["Sensor.Temperature_Humidity"],template:function(e){var t=0;return void 0!==e["Sensor.Temperature_Humidity"]&&(t=e["Sensor.Temperature_Humidity"]),void 0!==e["Sensor.Temperature"]&&(t+=e["Sensor.Temperature"]),void 0!==e["Sensor.Humidity"]&&(t+=e["Sensor.Humidity"]),t}},{title:m.prop("FACILITY_DEVICE_TYPE_LIGHT"),field:"Light",sortable:!1,resizable:!1,hidden:a.Light,template:function(e){var t=0;return void 0!==e.Light&&(t=e.Light),t}},{title:m.prop("FACILITY_DEVICE_TYPE_MOTION_SENSOR"),field:"Sensor.Motion",sortable:!1,resizable:!1,hidden:a["Sensor.Motion"],template:function(e){var t=0;return void 0!==e["Sensor.Motion"]&&(t=e["Sensor.Motion"]),t}},{title:m.prop("FACILITY_DEVICE_TYPE_POINT"),field:"ControlPoint",sortable:!1,resizable:!1,hidden:a.ControlPoint,template:function(e){var t,i,a,n=e.deviceTypes;i=n.length;var o=0;for(t=0;t<i;t++)(a=n[t].dms_devices_type)&&-1!=a.indexOf("ControlPoint")&&n[t].numberOfDevices&&(o+=n[t].numberOfDevices);return o}},{title:m.prop("FACILITY_DEVICE_TYPE_ENERGY_METER"),field:"Meter.WattHour",sortable:!1,resizable:!1,hidden:a["Meter.WattHour"],template:function(e){var t,i,a,n=e.deviceTypes;i=n.length;var o=0;for(t=0;t<i;t++)(a=n[t].dms_devices_type)&&-1!=a.indexOf("Meter")&&n[t].numberOfDevices&&(o+=n[t].numberOfDevices);return o}},{title:m.prop("FACILITY_DEVICE_TYPE_IOT_GATEWAY"),field:"Gateway",sortable:!1,resizable:!1,hidden:a.Gateway,template:function(e){var t=0;return void 0!==e.Gateway&&(t=e.Gateway),t}},{title:m.prop("FACILITY_DEVICE_TYPE_BLE_BEACON"),field:"Beacon",sortable:!1,resizable:!1,hidden:a.Beacon,template:function(e){var t=0;return void 0!==e.Beacon&&(t=e.Beacon),t}},{title:m.prop("FACILITY_DEVICE_TYPE_CCTV"),field:"CCTV",sortable:!1,resizable:!1,hidden:a.CCTV,template:function(e){var t=0;return void 0!==e.CCTV&&(t=e.CCTV),t}},{title:m.prop("FACILITY_DEVICE_TYPE_ETC"),field:"Etc",sortable:!1,resizable:!1,hidden:a.Etc,template:function(e){var t=0;return void 0!==e.Etc&&(t=e.Etc),t}},{title:m.prop("FACILITY_GROUP_CONTROL"),field:"control",sortable:!1,resizable:!1,template:function(e){return"<button class='k-button control-btn' data-id='"+e.dms_groups_id+"'>"+m.prop("FACILITY_GROUP_CONTROL")+"</button>"}}],dataSource:i,height:"100%",scrollable:!0,groupable:!1,sortable:!0,filterable:!1,resizable:!0,pageable:!1,hasCheckedModel:!0,setCheckedAttribute:!0}).data("kendoGrid")};return function(){E();var i=d.contentElement(0);v.open();var e=f.getCurrentFloor(),t="?";e.building.id!=f.FLOOR_NAV_BUILDING_TOTAL_ID&&e.floor.id==f.FLOOR_NAV_FLOOR_ALL_ID&&(t+="foundation_space_buildings_id="+e.building.id+"&"),e.floor.id!=f.FLOOR_NAV_FLOOR_ALL_ID&&(t+="foundation_space_floors_id="+e.floor.id),O().always(function(){$.ajax({url:"/dms/groups/summary/listView"+t}).done(function(e){M.bind($(i),g),X(e),D()}).fail(function(e){var t=B.parseFailResponse(e);I.message(t),I.open(),M.bind($(i),g),X(n.MockData),D()}).always(function(){v.close(),a.on("onfloorchange",A)})}),C=P()}(),{closeCreateBtnEvt:H}});