define("device/common/device-model",[],function(){"use strict";var e=window.kendo;return{Device:e.data.Model.define({id:"id",fields:{alarms:{type:"object",editType:null},networks:{type:"object"},parentId:{type:"string"},winds:{type:"object"},registrationStatus:{type:"string",options:[{text:"NotRegistered",value:"0"},{text:"Registered",value:"1"},{text:"Deleted",value:"1"}]},name:{type:"string"},information:{type:"object"},subordinateIds:{type:"object"},operations:{type:"object"},mappedType:{type:"string",options:[{text:"ControlPoint",value:"0"},{text:"Light",value:"1"},{text:"Meter.WattHour",value:"2"},{text:"Sensor.Humidity",value:"3"},{text:"Sensor.Motion",value:"4"},{text:"Sensor.Temperature",value:"5"}]},representativeStatus:{type:"string",options:[{text:"Normal.On",value:"0"},{text:"Normal.Off",value:"1"},{text:"Alarm.Critical",value:"2"},{text:"Alarm.Warning",value:"3"},{text:"Alarm.NetworkError",value:"4"},{text:"Disconnected",value:"5"},{text:"LowBattery",value:"6"},{text:"OutOfBounds",value:"7"}]},modes:{type:"object"},controlPoint:{type:"object"},groups:{type:"object"},configuration:{type:"object"},light:{type:"object"},type:{type:"string"},id:{type:"string"},schedules:{type:"object"},description:{type:"string"},locations:{type:"object"},airConditioner:{type:"object"},temperatures:{type:"object"}}}),DevicePopup:e.data.Model.define({id:"id",fields:{id:{name:"Device ID",type:"string",editType:null},name:{name:"Device NAME",type:"string",editType:"input"},representativeStatus:{name:"Status",type:"string",editType:null},modes:{name:"Operation Mode",type:"string",editType:null},temperatureS:{name:"Set Temperature",type:"string",editType:null},temperatureC:{name:"Current Temperature",type:"string",editType:null},locations:{name:"Location",type:"string",editType:"select"},groups:{name:"Group",type:"string",editType:null},"control-point":{name:"Remote Control",type:"string",editType:"input"},model:{name:"Model",type:"string",editType:null},type:{name:"Type",type:"string",editType:null},version:{name:"Firmware Version",type:"string",editType:null},description:{name:"Description",type:"string",editType:"input"}}})}}),define("operation/group/config/group-model",function(){"use strict";var s=window.kendo.data.Model.define({id:"id",fields:{name:{name:"Name"},type:{name:"Type"},description:{name:"Description"},dms_devices_ids:{name:"Devices",type:"object",defaultValue:[]}}});return{MockData:[{foundation_space_buildings_id:1,foundation_space_buildings_name:"A Tower",floors:[{foundation_space_floors_id:23,foundation_space_floors_type:"F",foundation_space_floors_name:"15",groups:[{dms_groups_id:11,dms_groups_name:"Marketing Department",dms_groups_description:"A collection of all devices belonging to the marketing department.",deviceTypes:[{dms_devices_type:"AirConditionerOutdoor",numberOfDevices:1},{dms_devices_type:"AirConditioner.Indoor",numberOfDevices:3},{dms_devices_type:"Beacon",numberOfDevices:2}]},{dms_groups_id:12,dms_groups_name:"Sales Department",dms_groups_description:"A collection of all devices belonging to the sales department.",deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",numberOfDevices:4},{dms_devices_type:"Beacon",numberOfDevices:3}]}]}]}],createDataSource:function(e,t,i){var a,o,n,r,s,l,d=e.length;for(a=0;a<d;a++){if((r=e[a]).deviceTypes)for(n=r.deviceTypes.length,o=0;o<n;o++)s=r.deviceTypes[o].dms_devices_type,l=r.deviceTypes[o].numberOfDevices,r[s]=l;i&&(r.selected=!1)}return e},createModel:function(e){var t=new s(e);return e||t.set("dms_devices_ids",[]),t},createModelByGroupIdData:function(e){var t,i,a,o=new s;if(o.set("id",e.id),o.set("name",e.name),o.set("type",e.type),i=e.devices){a=i.length;var n,r=[];for(t=0;t<a;t++)n=i[t].dms_devices_id,r.push(n);o.set("dms_devices_ids",r)}return o}}}),define("device/common/device-constants",[],function(){"use strict";var e=window.I18N;return{TIME_OUT:1500,ALL_TIME_INTERVAL:4e4,PANEL_REFRESH_TIME:1e3,BEACON_TIME_INTERVAL:5e3,DISPLAY_NAME_MAX:6,INDOOR_TYPE:["AirConditioner.Indoor","AirConditioner.AHU","AirConditioner.Chiller","AirConditioner.EHS","AirConditioner.ERV","AirConditioner.ERVPlus",["AirConditioner.FCU","AirConditioner.SFCU"],"AirConditioner.DuctFresh"],OUTDOOR_TYPE:["AirConditioneromOutdoor"],POINT_TYPE:["ControlPoint.AI","ControlPoint.AO","ControlPoint.DI","ControlPoint.DO","ControlPoint.AV","ControlPoint.DV"],ENERGY_TYPE:["Meter.WattHour","Meter.Gas","Meter.Water","Meter.Calorimeter"],SENSOR_TEMP_HUM_TYPE:["Sensor.Temperature_Humidity","Sensor.Humidity","Sensor.Temperature"],STATUS:["Normal.On","Normal.Off","Alarm.Critical","Alarm.Warning"],BEACON_STATUS:["Normal","Disconnected","WrongLocation","LowBattery"],BEACON_ACTION:{BLOCK:1,DELETE:2,REGISTER:3,DETAIL:4},BEACON_LOCATION_TYPE:["Fixed","Movable"],ASSET_FILTER:{TYPE:0,LOCATION:1,STATUS:2,ZONE:3,SELECTALL:4},ASSET_ACTION:{ASSET_TYPE:1,EXPORT:2,IMPORT:3,REGISTER:4,DELETE:5,DETAIL:6},ONOFF:["On","Off"],MODE:[{mode:"Auto",id:"AirConditioner.Indoor.General"},{mode:"Cool",id:"AirConditioner.Indoor.General"},{mode:"Heat",id:"AirConditioner.Indoor.General"},{mode:"Dry",id:"AirConditioner.Indoor.General"},{mode:"Fan",id:"AirConditioner.Indoor.General"},{mode:"CoolStorage",id:"AirConditioner.Indoor.General"},{mode:"HeatStorage",id:"AirConditioner.Indoor.General"},{mode:"vAuto",id:"AirConditioner.Indoor.Ventilator"},{mode:"HeatExchange",id:"AirConditioner.Indoor.Ventilator"},{mode:"ByPass",id:"AirConditioner.Indoor.Ventilator"},{mode:"Sleep",id:"AirConditioner.Indoor.Ventilator"},{mode:"Eco",id:"AirConditioner.Indoor.DHW"},{mode:"Standard",id:"AirConditioner.Indoor.DHW"},{mode:"Power",id:"AirConditioner.Indoor.DHW"},{mode:"Force",id:"AirConditioner.Indoor.DHW"}],TEXT:{SELECTALL:e.prop("COMMON_BTN_SELECT_ALL"),DESELECTALL:e.prop("COMMON_BTN_DESELECT_ALL"),REGISTER:e.prop("COMMON_BTN_REGISTER"),DEREGISTER:e.prop("COMMON_BTN_DEREGISTER"),VIEW:e.prop("COMMON_BTN_VIEW"),DELETE:e.prop("COMMON_BTN_DELETE")},FILTER:{TYPE:0,STATUS:1,MODE:2,ZONE:3,SELECTALL:4,REGEND:5},ACTION:{REGISTER:1,DETAIL:2},NW_ACTION:{DELETE:1,REGISTER:2,DETAIL:3,VIEW:4},VIEW:{STATISTIC:0,MAP:1,LIST:2,GRID:3},SEARCH:{EDIT:0,BUTTON:1},displayShort:[{value:"CoolStorage",display:"CoolSt"},{value:"HeatStorage",display:"HeatSt"},{value:"HeatExchange",display:"HeatEx"}],controlSet:[[{apiName:"operations",id:"AirConditioner.Indoor.General",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.Ventilator",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.DHW",parameter:"power"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.General.Speed",parameter:"wind"},{},{apiName:"modes",id:"AirConditioner.Indoor.ModeLimit",parameter:"mode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"}],[{apiName:"configuration",parameter:"remoteControl"},{apiName:"airConditioner",parameter:"filterResetRequired"},{apiName:"airConditioner",parameter:"spi"},{apiName:"airConditioner",parameter:"stillAir"}],{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.Ventilator",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.Ventilator.Speed",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.DHW",parameter:"mode"},[{apiName:"airConditioner",parameter:"chiller",underParameter:"waterLaw"},{apiName:"airConditioner",parameter:"chiller",underParameter:"quiet"},{apiName:"airConditioner",parameter:"chiller",underParameter:"forcedFan"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demand"}],{apiName:"airConditioner",parameter:"chiller",underParameter:"mccMode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"desired"}],[{apiName:"temperatures",id:"AirConditioner.Indoor.Room",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"desired",Heat:"AirConditioner.Indoor.DischargeAir.Heat",Cool:"AirConditioner.Indoor.DischargeAir.Cool"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"enabled"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demandLevel"}],outdoorControlConfig:{electricCurrentControl:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:50,text:"50%"},{value:55,text:"55%"},{value:60,text:"60%"},{value:65,text:"65%"},{value:70,text:"70%"},{value:75,text:"75%"},{value:80,text:"80%"},{value:85,text:"85%"},{value:90,text:"90%"},{value:95,text:"95%"},{value:100,text:"100%"}],coolingCapacityCalibration:{Celsius:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"5~7\xb0C"},{value:"7~9",text:"7~9\xb0C"},{value:"9~11",text:"9~11\xb0C"},{value:"10~12",text:"10~12\xb0C"},{value:"11~13",text:"11~13\xb0C"},{value:"12~14",text:"12~14\xb0C"},{value:"13~15",text:"13~15\xb0C"}],Fahrenheit:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"41~45\xb0F"},{value:"7~9",text:"45~48\xb0F"},{value:"9~11",text:"48~52\xb0F"},{value:"10~12",text:"50~54\xb0F"},{value:"11~13",text:"52~55\xb0F"},{value:"12~14",text:"54~57\xb0F"},{value:"13~15",text:"55~59\xb0F"}]},heatingCapacityCalibration:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:25,text:"25kg/cm\xb2"},{value:26,text:"26kg/cm\xb2"},{value:27,text:"27kg/cm\xb2"},{value:28,text:"28kg/cm\xb2"},{value:29,text:"29kg/cm\xb2"},{value:30,text:"30kg/cm\xb2"},{value:31,text:"31kg/cm\xb2"},{value:32,text:"32kg/cm\xb2"},{value:33,text:"33kg/cm\xb2"}]},INNER_LAYOUT:{MONITORING:0,REGISTRATION:1},FILTER_NAME:{SELECTALL:"selectAll",ZONE:"zone",STATUS:"status",TYPE:"type",MODE:"mode",ASSET_TYPE:"assetType"},ACTION_NAME:{DETAIL:"detail",REGISTER:"register",DELETE:"delete",BLOCK:"block",SELECTEDTEXT:"selectedText",VIEW:"view",ASSET_TYPE:"assetType"},REGISTRATION_STATUS_BUTTONS:{REGISTER:0,UNREGISTER:1},LIGHT_CONTROL:{POWER:0,DIMMING:1}}}),define("device/common/device-util",["device/common/device-constants"],function(s){"use strict";function l(){for(var e=A.getDefaultViewType(),t=e.length,i="statistic",a=0;a<t;a++)if("Facility.Device"==e[a].menu){i=(i=e[a].view).toLowerCase();break}return i}function i(e){var t=e.locations,i="-";if(void 0!==e.assets_types_id)return y(e);if(t&&0<t.length){i="";var a=t[0];if(a.description)return a.description;a.foundation_space_buildings_id&&(i+=a.foundation_space_buildings_id+" "),a.foundation_space_floors_id&&(i+=a.foundation_space_floors_id)}return i}function a(e){var t=e.groups,i="-";if(t){var a=t.length;0<a&&(i="",(i=t[0].dms_groups_name)&&1<a&&(i+="(+"+(a-1)+")"))}return L.decodeHtml(i)}function o(e,t){var i,a,o,n,r=e.temperatures,s=e.airConditioner,l="-",d="-",c=!1;s&&s.temperatureReference&&-1<s.temperatureReference.indexOf("WaterOutlet")&&(c=!0),!r||0<r.length&&(c&&(n=$.grep(r,function(e){return"AirConditioner.Indoor.WaterOutlet"==e.id}))&&n.length&&void 0!==(n=n[0]).desired&&(d=n.desired.toFixed(1)),(n=$.grep(r,function(e){return"AirConditioner.Indoor.Room"==e.id}))&&n.length&&(n=n[0],c||void 0!==n.desired&&(d=n.desired.toFixed(1)),void 0!==n.current&&(l=n.current.toFixed(1))),(n=$.grep(r,function(e){return"AirConditioner.Indoor.DHW"==e.id}))&&n.length&&(void 0!==(n=n[0]).desired&&(i=n.desired.toFixed(1)),void 0!==n.current&&(a=n.current.toFixed(1))),(n=$.grep(r,function(e){return"AirConditioner.Outdoor"==e.id}))&&n.length&&(void 0!==(n=n[0]).desired&&(d=n.desired.toFixed(1)),void 0!==n.current&&(l=n.current.toFixed(1))));var p=e.modes;return p&&(n=$.grep(p,function(e){return"AirConditioner.Indoor.General"==e.id&&"Fan"==e.mode}))&&n.length&&(d="-"),o="Celsius"===A.getTemperature().unit?"\xb0C":"\u2109","-"!==d&&t&&(d+=o),"-"!==l&&t&&(l+=o),i&&t&&(i+=o),a&&t&&(a+=o),{isWaterout:c,desired:d,current:l,unit:o,dhwDesired:i,dhwCurrent:a}}function n(e,o,t){var n;return"vAuto"===t&&(n="AirConditioner.Indoor.Ventilator",t="Auto"),{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){var i,a=e.length;if("undefined"==t){for(i=0;i<a;i++)if(void 0===e[i][o])return!0}else for(i=0;i<a;i++)if(e[i][o]==t)return!n||(n===e[i].id||void 0)}},value:t}}function r(e,o,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){for(var i=e.length,a=0;a<i;a++)if(e[a][o]!=t)return;return!0}},value:t}}function d(e){return{field:e,operator:function(e){if(e)return 0===e.length||void 0}}}function c(e){var t,i,a,o,n="-";if(i=e.meters){for(n="",a=i.length,t=0;t<a;t++)(o=i[t].category)&&("AirConditionerAll"==o&&(o="SAC"),n+=o,t!=a-1&&(n+=", "));n=(n=n||"Others").toUpperCase(),n=D.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_"+n)}return n}function p(e){var t="-",i=e.type;return i&&(-1!=i.indexOf("ControlPoint")&&(i=e.mappedType),t=(t=(t=L.getDisplayType(i))||"WattHour").toUpperCase(),t=(t=D.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_"+t))||D.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATTHOUR")),t}function u(e){var t,i,a,o,n="",r=e.type;if(r&&-1!=r.indexOf("ControlPoint")){var s=e.controlPoint;s&&void 0!==s.value&&(n=L.convertNumberFormat(s.value))}else if(i=e.meters)for(a=i.length,t=0;t<a;t++)null!=(o=L.convertNumberFormat(i[t].reading))&&(n+=o,t!=a-1&&(n+=", "));return n=""!=n?n:"-"}function v(e){var t,i="-",a=e.networks;return a&&a[0]&&(a=a[0],e.type,a[t="ethernet"]&&(i=(i=a[t].ipAddress)||"-")),i}function m(e){var t,i="-",a=e.networks;return a&&a[0]&&(a=a[0],e.type,a[t="ethernet"]&&(i=(i=a[t].macAddress)||"-")),i}function _(e){var t,i,a="-",o=e.networks;return o&&o[1]&&((o=o[1]).connected?(t=e.alarms)&&0<t.length?(t.sort(function(e,t){return e=e.alarms_event?e.alarms_event:"-",(t=t.alarms_event?t.alarms_event:"-").localeCompare(e)}),"Critical"==(i=t[0].alarms_type)?a="Connected (Poor)":"Warning"==i&&(a="Connected (Fair)")):a="Connected (Good)":a="Disconnected",a=a||"-"),a}function f(e,t,i,a){var o,n,r,s=0;if((o=e.networks)&&o[0])for(r=o.length,n=0;n<r;n++)if(o[n].type==t){if(!i)return o[n];if(o[n].ble&&o[n].ble.role==i){if(void 0===a)return o[n];if(a==s)return o[n];s++}}return{}}function T(e,t){var i,a,o,n="-",r=e.networks;if(r&&r[0]){for(a=r.length,i=0;i<a;i++)if(r[i].ble){o=r[i].ble;break}o&&(n=(n=o[t])||"-")}return n}function C(e){return T(e,"macAddress")}function g(e){return T(e,"uuid")}function O(e){var t="-",i=e.rules;return i&&(t=0<i.length?"O":"X"),t}function I(e){var t="-",i=e.schedules;return i&&(t=0<i.length?"O":"X"),t}function t(e,t){var i,a="-",o=e.information;if(o&&o.versions){var n,r=(i=o.versions).length;for(n=0;n<r;n++)if(i[n].type==t){a=i[n].number?i[n].number:a;break}}return a}function E(e){var t="-";return e.controlPoint&&e.controlPoint.tagName&&(t=e.controlPoint.tagName),t}var h=window.MAIN_WINDOW,A=window.GlobalSettings,L=window.Util,D=window.I18N,b=window.kendo,y=function(e){var t="-",i=e.location;if(i){if(i.description)return i.description;t="",i.foundation_space_buildings_id&&(t+=i.foundation_space_buildings_id+" "),i.foundation_space_floors_id&&(t+=i.foundation_space_floors_id)}return t};return{isAllFloorCheck:function(){var e=!1,t=h.getCurrentFloor();return t&&t.floor&&"ALL"==t.floor.value&&(e=!0),e},getDefaultView:l,goClick:function(e,t,i,a){var o,n={};if(void 0===a){var r=window.localStorage.getItem("deviceViewType");r?(o=s.VIEW[r],window.localStorage.removeItem("deviceViewType")):o=s.VIEW[l().toUpperCase()]}else o=a;return e?t?i==h.FLOOR_NAV_BUILDING_TOTAL_ID||i==h.FLOOR_NAV_FLOOR_ALL_ID?o===s.VIEW.MAP&&(o=s.VIEW.STATISTIC):o===s.VIEW.STATISTIC&&(o=s.VIEW.MAP):o===s.VIEW.MAP?i==h.FLOOR_NAV_BUILDING_TOTAL_ID?n.building=!0:i==h.FLOOR_NAV_FLOOR_ALL_ID&&(n.floor=!0):o===s.VIEW.STATISTIC&&i!=h.FLOOR_NAV_BUILDING_TOTAL_ID&&i!=h.FLOOR_NAV_FLOOR_ALL_ID&&(n.floor=!1):(i==h.FLOOR_NAV_BUILDING_TOTAL_ID?n.building=!0:i==h.FLOOR_NAV_FLOOR_ALL_ID&&(n.floor=!0),o=s.VIEW.MAP),n.floor&&!h.getCurrentFloorList().length&&(n.floor=!1,n.noFloor=!0),n.view=o,n},getStatus:function(e){return L.getStatus(e)},getLocation:i,getCurrentLocation:function(e){var t,i,a=e.locations,o="-";if(a)for(i=a.length,t=0;t<i;t++)if("Measured"==a[t].id){o="";var n=a[t];if(n.description)return n.description;n.foundation_space_buildings_id&&(o+=n.foundation_space_buildings_id+" "),n.foundation_space_floors_id&&(o+=n.foundation_space_floors_id);break}return o},locations:i,getGroup:a,group:a,getGridIcon:function(e){var t=0,i=[],a=e.airConditioner;if(a){var o=a.peakPowerControl;o&&"On"===o&&t<5&&(i[t++]="ic-peak")}var n=e.configuration;if(n){var r=n.remoteControl;r&&"NotAllowed"===r&&t<5&&(i[t++]="ic-rc-disable")}var s=e.modes;if(s){var l=$.grep(s,function(e){return"AirConditioner.Indoor.ModeLimit"==e.id}),d=l[0]?l[0].mode:void 0;d&&("HeatOnly"===d||"CoolOnly"===d)&&t<5&&(i[t++]="ic-rock")}var c=e.temperatures;if(c){var p=[];p.push($.grep(c,function(e){return"AirConditioner.Indoor.Room.Cool.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.Room.Heat.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.WaterOutlet.Cool.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.WaterOutlet.Heat.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.DHW.Limit"==e.id}));for(var u=!1,v=p.length,m=0;m<v;m++){var _=p[m][0];if(_&&_.enabled){u=!0;break}}u&&t<5&&(i[t++]="ic-thurmo")}if(a){var f=a.defrost;f&&"On"===f&&t<5&&(i[t++]="ic-deforest"),a.filterResetRequired&&t<5&&(i[t++]="ic-filter")}var T=e.schedules;if(T&&0<T.length&&t<5&&(i[t++]="ic-schedule"),a){var C=a.spi;C&&"On"===C&&t<5&&(i[t++]="ic-spi");var g=a.chiller;if(g){var O=g.freezeProtection;O&&"On"===O&&t<5&&(i[t++]="ic-antifreeze")}}return i},getTemperatures:o,curTemperatures:function(e){var t=o(e,!0),i=t.dhwCurrent;return i?t.current+", "+i:t.current},setTemperatures:function(e){var t=o(e,!0),i=t.dhwDesired;return i?t.desired+", "+i:t.desired},curOutdoorTemperature:function(e){return o(e,!0).current},columnMode:function(e){var t=$("<div/>"),i=$("<span/>"),a=e.modes;return a=a&&a.length?a[0].mode:"-",i.text(a).appendTo(t),t.html()},filter0Depth:function(e,t,i){return{field:e,operator:t,value:i}},filter0DepthEmptyList:function(e){return{field:e,operator:function(e){if(e&&e.length)return!0}}},filter1Depth:n,filter1DepthNone:r,filter1DepthNull:d,filter1DepthObj:function(e,i,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e)if("undefined"==t){if(void 0===e[i])return!0}else if(e[i]==t)return!0},value:t}},filterStatusNoAlarm:function(e,t,i,a){var o=[];return"On"===i?o.push(n(e,t,i)):o.push(r(e,t,i)),o.push(d(a)),{logic:"and",filters:o}},filter2Depth:function(e,l,d,c){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){c="undefined"==c?void 0:c;var i,a,o,n,r,s=e.length;for(i=0;i<s;i++){if(!(n=e[i][l])||!n.length)return;for(o=n.length,a=0;a<o;a++)if(void 0!==(r=n[a][d])&&($.isFunction(t)&&(t=t(r)),r==t))return!0}}},value:c}},convertStatistic:function(e,t,i){var a,o,n,r=[];if(e==h.FLOOR_NAV_BUILDING_TOTAL_ID)for(a=0,o=t.length;a<o;a++)n={},$.each(t[a],function(e,t){"foundation_space_buildings_id"===e?e="id":"foundation_space_buildings_name"===e&&(e="name"),n[e]=t}),r.push(n);else for(a=0,o=t.length;a<o;a++)if(e==t[a].foundation_space_buildings_id){for(var s=t[a].floors,l=0,d=s.length;l<d;l++)if(n={},$.each(s[l],function(e,t){if("foundation_space_floors_id"===e)e="id";else if("foundation_space_floors_name"===e){e="name";var i=n.type;"B"===i?t=i+t:"F"==i&&(t+=i)}else"foundation_space_floors_type"===e&&(e="type");n[e]=t}),r.push(n),i){var c,p=s[l].assetTypes;if(p){var u,v,m,_,f,T=p.length;for(u=0;u<T;u++)for(c=p[u].assets_types_name,m=(_=p[u].subAssetTypes).length,v=0;v<m;v++)(f=$.extend({},n,_[v])).isSubAsset=!0,f.assets_types_name=c,r.push(f)}}var C=$.extend({},t[a]);C.id=C.foundation_space_buildings_id,C.name="All",r.push(C);break}return r},convertDisplayName:function(e){return e&&e.length>s.DISPLAY_NAME_MAX?e.substr(0,s.DISPLAY_NAME_MAX):e},getAccureFilter:function(e,t,i,a,o){var n;if(n=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length){var r={logic:"and",filters:t};n.filters.push(r)}if(i&&i.length){var s={logic:"or",filters:i};n.filters.push(s)}if(a&&a.length){var l={logic:"or",filters:a};n.filters.push(l)}if(o&&o.length){var d={logic:"or",filters:o};n.filters.push(d)}return n},getAccureFilterOlder:function(e,t,i,a,o){var n;n=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length&&(n={logic:"and",filters:[n,{logic:"and",filters:t}]});i&&i.length&&(n={logic:"and",filters:[n,{logic:"or",filters:i}]});a&&a.length&&(n={logic:"and",filters:[n,{logic:"or",filters:a}]});o&&o.length&&(n={logic:"and",filters:[n,{logic:"or",filters:o}]});return n},calcScreenBySelect:function(e,t,i){var a=e.length;return 0<a?D.prop("FACILITY_DEVICE_SELECTED",a):void 0===t||void 0===i?"":D.prop("FACILITY_DEVICE_NO_SELECTED_TOTAL",t,i)},calcScreenByOnlySelect:function(e){var t=e.length;return 0<t?D.prop("FACILITY_DEVICE_SELECTED",t):D.prop("FACILITY_DEVICE_NO_SELECTED")},getTempHumiTemperature:function(e,t){var i="-",a=e.temperatures,o=e.type;if(o&&-1!=o.indexOf("ControlPoint")){var n=e.mappedType;if(n&&-1!=n.indexOf("Temperature")){var r=e.controlPoint;r&&void 0!==r.value&&(i=r.value)}}else a&&a[0]&&(i=(a=a[0]).current);"-"==(i=L.convertNumberFormat(i))||t||(i+="Celsius"===A.getTemperature().unit?"\xb0C":"\u2109");return i},getTempHumiHumidity:function(e,t){var i="-",a=e.humidities,o=e.type;if(o&&-1!=o.indexOf("ControlPoint")){var n=e.mappedType;if(n&&-1!=n.indexOf("Humidity")){var r=e.controlPoint;r&&void 0!==r.value&&(i=r.value)}}else a&&a[0]&&(i=(a=a[0]).current);return"-"==(i=L.convertNumberFormat(i))||t||(i+="%"),i},getMotionPresence:function(e){var t="-",i=e.presences;return i&&i[0]&&(t=(t=(i=i[0]).detected)?D.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"):D.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE")),t},getMacAddress:m,getIpAddress:v,getWifiIpAddress:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.ipAddress)||"-"),t},getWifiMacAddress:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.macAddress)||"-"),t},getWifiChannel:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.channel)||"-"),t},getWifiRssi:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.rssi)||"-"),t},getCCTVWifiStatus:_,getCCTVDataStatus:function(e){var t="Off",i=e.cctvs;return i&&i[0]&&"On"==(i=i[0]).dataStatus&&(t="On"),t},getCCTVWifiTxPower:function(e){var t="-",i=e.wifi;return i&&(t=(t=i.txPower)||"-"),t},getCCTVWifiType:function(e){var t="-",i=e.networks;return i&&i[1]&&("WiFi2.4GHz"==(i=i[1]).type?t="2.4GHz":"WiFi5GHz"==i.type&&(t="5GHz"),t=t||"-"),t},getCCTVWifiTotal:function(e){var t="-",i=e.wifi;return(i=i&&i.statistics)&&i.channelUtilization&&(t=(t=i.channelUtilization.total)||"-"),t},getCCTVWifiNoneWifi:function(e){var t="-",i=e.wifi;return(i=i&&i.statistics)&&i.channelUtilization&&(t=(t=i.channelUtilization["non802.11"])||"-"),t},getCCTVWifiInterfererDataSource:function(e){var t=[],i=e.wifi;return(i=i&&i.statistics)&&i.interferers&&(t=i.interferers),t},getBleObject:T,getBleMacAddress:C,getBleUUID:g,getBleMajor:function(e){return T(e,"major")},getBleMinor:function(e){return T(e,"minor")},getBleTxPower:function(e){var t=T(e,"txPower");return"999"!=t&&999!=t||(t="-"),t},getBle1mRssi:function(e){return T(e,"calibratedTxPower")},getBleSignalLevel:function(e){var t=T(e,"rssi");return"-"!=t&&(t+=" dBm"),t},getBleBatteryLevel:function(e){var t,i="-",a=e.information;return a&&a.power&&(t=a.power.batteryLevel)&&(i=t||"-"),i},getBleWritable:function(e){var t=T(e,"writable");return t="-"==t?"READ Only":"READ / WRITE"},getBleAdvertisingName:function(e){return T(e,"advertisingName")},getBleAdvertisingInterval:function(e){return T(e,"advertisingInterval")},getNetworkInterface:f,getNetworkInterfaceIndex:function(e,t,i,a,o){var n,r,s,l=0;if((n=e.networks)&&n[0])for(s=n.length,r=0;r<s;r++)if(n[r].type==t){if(!i)return r;if(n[r].ble&&n[r].ble.role==i){if(null==a)return r;if(a==l)return r;l++}}return o?-1:0},getBleObjectFromNetwork:function(e,t){var i="-";return e&&e.ble&&(i=void 0!==(i=e.ble[t])?i:"-"),i},getWifiObjectFromNetwork:function(e,t){var i="-";return e&&e.wifi&&(i=void 0!==(i=e.wifi[t])?i:"-"),i},getZigbeeStatus:function(e){return f(e,"Zigbee").enabled?"Normal.On":"Normal.Off"},getBleStatus:function(e){return f(e,"BLE","Scanner").enabled?"Normal.On":"Normal.Off"},getBleInterfaceStatus:function(e,t){return f(e,"BLE","Advertiser",t).enabled?"Normal.On":"Normal.Off"},getHasSchedule:I,getHasRule:O,getDescription:function(e){var t="-",i=e.description;return i&&(t=i),L.decodeHtml(t)},getFirmwareVersion:function(e){return t(e,"Firmware")},getZigbeeFirmwareVersion:function(e){return t(e,"Firmware.Zigbee")},getBleFirmwareVersion:function(e){return t(e,"Firmware.BLE")},getBleAppVersion:function(e){return t(e,"Application.BLE")},getHardwareVersion:function(e){return t(e,"Hardware")},getSoftwareVersion:function(e){return t(e,"Software")},getApiVersion:function(e){return t(e,"API")},getPowerAvailableSource:function(e){var t="-",i=e.information;return i&&i.power&&((t=i.power.availableSources||"-")instanceof b.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},getPowerCurrentSource:function(e){var t="-",i=e.information;return i&&i.power&&((t=i.power.currentSource||"-")instanceof b.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},sortableLocation:function(e,t){return e=(e=i(e))||"-",t=(t=i(t))||"-",e.localeCompare(t)},sortableGroup:function(e,t){return e=(e=a(e))||"-",t=(t=a(t))||"-",e.localeCompare(t)},getLocationSort:function(){var e=h.getCurrentFloor(),t=!0;return e.building.id!=h.FLOOR_NAV_BUILDING_TOTAL_ID&&e.floor.id!=h.FLOOR_NAV_FLOOR_TOTAL_ID||(t=!1),t?[{field:"locations",dir:"asc",compare:function(e,t){var i,a;i=e.locations,a=t.locations;var o="-",n="-";return i=i&&i[0]?i[0]:"-",a=a&&a[0]?a[0]:"-","-"!=i&&(i.foundation_space_zones_id||(o="\u03a9"+(o=e.name))),"-"!=a&&(a.foundation_space_zones_id||(n="\u03a9"+(n=t.name))),o.localeCompare(n)}}]:[]},getPointTagName:E,sortablePointTagName:function(e,t){return e=E(e),t=E(t),e.localeCompare(t)},sortablePointValue:function(e,t){var i,a;return e.controlPoint&&(i=e.controlPoint.value),t.controlPoint&&(a=t.controlPoint.value),i-a},sortableMeterType:function(e,t){var i,a;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return i=p(e),a=p(t),i.localeCompare(a)},sortableMeterCategoryType:function(e,t){var i,a;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return i=c(e),a=c(t),i.localeCompare(a)},sortableMacAddress:function(e,t){return e=(e=m(e))||"-",t=(t=m(t))||"-",e.localeCompare(t)},sortableBleMacAddress:function(e,t){return e=C(e),t=C(t),e.localeCompare(t)},sortableIpAddress:function(e,t){return e=(e=v(e))||"-",t=(t=v(t))||"-",e.localeCompare(t)},sortableHasSchedule:function(e,t){return e=I(e),t=I(t),e.localeCompare(t)},sortableHasRule:function(e,t){return e=O(e),t=O(t),e.localeCompare(t)},sortableBeaconUUID:function(e,t){return e=g(e),t=g(t),e.localeCompare(t)},sortableCCTVWifiStatus:function(e,t){return e=_(e),t=_(t),e.localeCompare(t)},getIndoorMode:function(e){var t="-",i=L.getRecentAlarm(e);return t=i?(t=i.type,D.prop("FACILITY_DEVICE_STATUS_"+t.toUpperCase())||t):L.getDisplayModeI18N(e.modes,e.operations,!0," / ")},getAssetType:function(e){return(e.assets_types_name?e.assets_types_name:"-")+" / "+(e.subAssetType?e.subAssetType:"-")},getAssetLocation:y,getAssetUsers:function(e){var t="-",i=e.users;if(i&&i[0]){t="";var a,o=i.length;for(a=0;a<o;a++)t+=i[a].ums_users_name,a!=o-1&&(t+=", ")}return t},getMeterCategoryType:c,getMeterType:p,getMeterCurrentConsumption:u,getMeterCurrentConsumptionUnit:function(e){var t=e.type,i=e.mappedType,a="",o=window.Util;return a="Meter.Gas"==t||"Meter.Gas"==i?o.CHAR.Gas:"Meter.WattHour"==t||"Meter.WattHour"==i?o.CHAR.WattHour:"Meter.Water"==t||"Meter.Water"==i?o.CHAR.Water:"",u(e)+a},getDimmingLevel:function(e){var t,i="-",a=e.lights||e.light;return a&&a[0]&&(i=void 0===(t=(a=a[0]).dimmingLevel)?"-":Math.round(t)+"%"),i},getTempWeatherStation:function(e){var t="-",i=e.configuration;return i&&i.locationType&&(t=i.locationType),t},getTempWeatherStationOx:function(e){var t="-",i=e.configuration;return i&&i.locationType&&(t="Outdoor"==(t=i.locationType)?"O":"X"),t},getPointValue:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.value&&(t=i.value),t},getAssetUserName:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_name),t},getAssetUserID:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_id),t},getAssetUserEmail:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_email),t},getAssetUserOrganization:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_organization?i[0].ums_users_organization:"-"),t},getAssetUserWorkPhoneNumber:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_workPhoneNumber?i[0].ums_users_workPhoneNumber:"-"),t},getAssetUserMobilePhoneNumber:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_mobilePhoneNumber?i[0].ums_users_mobilePhoneNumber:"-"),t},getAssetDeviceID:function(e){var t="-",i=e.devices;return i&&i[0]&&(t=i[0].dms_devices_id),t},getAssetDeviceName:function(e){var t="-",i=e.devices;return i&&i[0]&&(t=i[0].dms_devices_name),t},getEnergyMappingOutdoorList:function(c){var p,u=new $.Deferred,v=h.getCurrentBuildingList();return $.ajax({url:"/foundation/space/floors"}).done(function(e){p=e,$.ajax({url:"/dms/devices?types=AirConditionerOutdoor&registrationStatuses=Registered&attributes=id,name,locations"}).done(function(e){var t,i,a,o,n,r,s,l,d=e.length;for(r=0;r<d;r++){if((t=e[r]).locations&&t.locations[0]){for(o=t.locations[0].foundation_space_buildings_id,n=t.locations[0].foundation_space_floors_id,l=v.length,s=0;s<l;s++)if(o==(i=v[s]).id){t.building_group_value=b.toString(i.sortOrder,"0000")+"_"+i.id+"_"+i.name;break}for(l=p.length,s=0;s<l;s++)if(n==(a=p[s]).id){t.floor_group_value=b.toString(a.sortOrder,"0000")+"_"+a.id+"_"+L.getFloorName(a);break}}for(t.assigned=!1,l=c.length,s=0;s<l;s++)if(t.id==c[s].dms_devices_id){t.assigned=!0;break}}u.resolve(e)}).fail(function(e){u.reject(e)})}).fail(function(e){u.reject(e)}),u.promise()},isEnableEnergyMappingType:function(e){var t,i,a=e.mappedType||e.type,o=e.meters;if(!o)return!1;var n,r=o.length;for(n=0;n<r;n++)"AirConditionerAll"==o[n].category&&(t=o[n].category),"AirConditionerOutdoor"==o[n].connectedDeviceType&&(i=o[n].connectedDeviceType);return!("Meter.WattHour"!=a||!t||!i)},getEnergyMappingFieldName:function(e){var t=0,i=e.meters;if(i&&i[0]){var a,o=i.length;for(a=0;a<o;a++)if("AirConditionerAll"==i[a].category&&"AirConditionerOutdoor"==i[a].connectedDeviceType){t=a;break}}return"meters["+t+"].connectedDevices"},getMeterConnectedDevices:function(e){var t=0,i=e.meters;if(i&&i[0]){var a,o=i.length;for(a=0;a<o;a++)if("AirConditionerAll"==i[a].category&&"AirConditionerOutdoor"==i[a].connectedDeviceType){t=a;break}}return i[t]&&i[t].connectedDevices?i[t].connectedDevices:null},getDeviceRegistrationFailMsg:function(e){return 406==e.status&&-1!=e.responseText.indexOf("Count")?D.prop("FACILITY_DEVICE_COUNT_EXCEEDED"):L.parseFailResponse(e)},getConnectedDevicesConsumptionTypeList:function(e){var t={AirConditionerAll:{name:D.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_SAC"),id:"AirConditionerAll"},Light:{name:D.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_LIGHT"),id:"Light"},Others:{name:D.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_OTHERS"),id:"Others"}},i=[];return i.push(t.AirConditionerAll),"Meter.WattHour"===e&&i.push(t.Light),i.push(t.Others),i},getConnectedDevicesConnectionTypeList:function(e,t){var i={None:{name:"None",id:"None"},AirConditioner:{name:L.getDetailDisplayTypeDeviceI18N("SAC Indoor"),id:"AirConditioner"},AirConditionerOutdoor:{name:L.getDetailDisplayTypeDeviceI18N("SAC Outdoor"),id:"AirConditionerOutdoor"},Boiler:{name:L.getDetailDisplayTypeDeviceI18N("Boiler"),id:"Boiler"},CoolingTower:{name:L.getDetailDisplayTypeDeviceI18N("CoolingTower"),id:"CoolingTower"},Pump:{name:L.getDetailDisplayTypeDeviceI18N("Pump"),id:"Pump"},WaterTank:{name:L.getDetailDisplayTypeDeviceI18N("WaterTank"),id:"WaterTank"}},a=[];return"AirConditionerAll"===t&&("Meter.WattHour"===e?a.push(i.AirConditioner,i.AirConditionerOutdoor,i.Pump,i.CoolingTower,i.Boiler):"Meter.Gas"===e?a.push(i.Boiler):"Meter.Water"===e&&a.push(i.WaterTank)),a.push(i.None),a},filterHasListAttrItem:function(e,t){return{field:e,operator:function(e){return e&&e.length?t:!t}}}}}),define("device/common/device-template",["device/common/device-util","device/common/device-constants"],function(R,c){"use strict";function t(e,t,i){var a=e.sender,o=a.dataSource.view(),n=$.grep(o,function(e){return"all"==e.name.toLowerCase()});if(n&&n.length){var r=a.element;r.find(".customStatisticRowStyles").remove();var s=a.items().first().clone();s.attr("data-uid",""),s.data("uid","");var l=s.find("td[role='gridcell']");if(!l.length)return;var d;if(n=n[0],a.dataSource.remove(n),d=n.name,$(l.get(0)).html(d),t){var c=void 0!==n.numberOfSubAssetTypes?n.numberOfSubAssetTypes:"-",p=void 0!==n.numberOfRegisteredAssets?n.numberOfRegisteredAssets:"-",u=void 0!==n.numberOfNormalDevices?n.numberOfNormalDevices:"-",v=void 0!==n.numberOfDisconnectedDevices?n.numberOfDisconnectedDevices:"-",m=void 0!==n.numberOfLowBatteryDevices?n.numberOfLowBatteryDevices:"-",_=void 0!==n.numberOfOutOfBoundsDevices?n.numberOfOutOfBoundsDevices:"-";$(l.get(1)).html(c),$(l.get(2)).html(p),$(l.get(3)).html(u),$(l.get(4)).html(v),$(l.get(5)).html(m).addClass("text-err"),$(l.get(6)).html(_).addClass("text-err")}else if(i)$(l.get(1)).html(V(n)),$(l.get(2)).html(H(n)),$(l.get(3)).html(W(n)),$(l.get(4)).html(G(n)),$(l.get(5)).html(B(n)),$(l.get(6)).html(j(n)),$(l.get(7)).html(X(n)),$(l.get(8)).html(z(n));else{var f=M(n),T=F(n),C=x(n),g=Y(n),O=P(n);$(l.get(1)).html(f);var I,E,h,A,L,D,b,y=l.length;if(7==y)I=void 0!==n.numberOfOnIndoorDevices?n.numberOfOnIndoorDevices:"-",E=void 0!==n.numberOfOnVentilatorDevices?n.numberOfOnVentilatorDevices:"-",h=void 0!==n.numberOfOnDHWDevices?n.numberOfOnDHWDevices:"-",A=void 0!==n.numberOfOffIndoorDevices?n.numberOfOffIndoorDevices:"-",L=void 0!==n.numberOfOffVentilatorDevices?n.numberOfOffVentilatorDevices:"-",D=void 0!==n.numberOfOffDHWDevices?n.numberOfOffDHWDevices:"-",b=void 0!==n.numberOfSchedules?n.numberOfSchedules:"-",$(l.get(2)).html(I+"/"+E+"/"+h),$(l.get(3)).html(A+"/"+L+"/"+D),$(l.get(4)).html(T).addClass("text-err"),$(l.get(5)).html(C).addClass("text-err"),$(l.get(6)).html(b);else if(6==y)$(l.get(2)).html(g),$(l.get(3)).html(O),$(l.get(4)).html(T).addClass("text-err"),$(l.get(5)).html(C).addClass("text-err");else if(5==y){var N;N=U(n),$(l.get(2)).html(N),$(l.get(3)).html(T).addClass("text-err"),$(l.get(4)).html(C).addClass("text-err")}}s.addClass("customStatisticRowStyles"),r.find(".k-grid-header table thead").append(s)}}var e=window.kendo,S=window.Util,w=window.I18N,A=window.GlobalSettings,k=A.getLocale(),p=A.getTemperature().unit,x=function(e){return'<span class="text-err">'+(void 0!==e.numberOfWarningDevices?e.numberOfWarningDevices:"-")+"</span>"},F=function(e){return'<span class="text-err">'+(void 0!==e.numberOfCriticalDevices?e.numberOfCriticalDevices:"-")+"</span>"},M=function(e){return void 0!==e.numberOfRegisteredDevices?e.numberOfRegisteredDevices:"-"},U=function(e){return void 0!==e.numberOfNormalDevices?e.numberOfNormalDevices:"-"},Y=function(e){return void 0!==e.numberOfOnDevices?e.numberOfOnDevices:"-"},P=function(e){return void 0!==e.numberOfOffDevices?e.numberOfOffDevices:"-"},V=function(e){return"<div class='tb beacon'><span class='tbc col-1'>"+M(e)+"</span></div>"},H=function(e){var t=void 0!==e.numberOfFixedDevices?e.numberOfFixedDevices:"-",i=void 0!==e.numberOfMovableDevices?e.numberOfMovableDevices:"-";return"<div class='tb beacon'><span class='tbc col-2'>"+w.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED_TYPE")+"</span><span class='tbc col-3'>"+t+"</span></div><div class='tb beacon'><span class='tbc col-2'>"+w.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE_TYPE")+"</span><span class='tbc col-3'>"+i+"</span></div>"},W=function(e){return"<div class='tb beacon'><span class='tbc col-4'>"+(void 0!==e.numberOfFixedNormalDevices?e.numberOfFixedNormalDevices:"-")+"</span></div><div class='tb beacon'><span class='tbc col-4'>"+(void 0!==e.numberOfMovableNormalDevices?e.numberOfMovableNormalDevices:"-")+"</span></div>"},G=function(e){return"<div class='tb beacon'><span class='tbc col-5'>"+(void 0!==e.numberOfFixedCriticalDevices?e.numberOfFixedCriticalDevices:"-")+"</span></div><div class='tb beacon'><span class='tbc col-5'>"+(void 0!==e.numberOfMovableCriticalDevices?e.numberOfMovableCriticalDevices:"-")+"</span></div>"},B=function(e){return"<div class='tb text-err beacon'><span class='tbc col-6'>"+(void 0!==e.numberOfFixedWarningDevices?e.numberOfFixedWarningDevices:"-")+"</span></div><div class='tb text-err beacon'><span class='tbc col-6'>"+(void 0!==e.numberOfMovableWarningDevices?e.numberOfMovableWarningDevices:"-")+"</span></div>"},j=function(e){return"<div class='tb text-err beacon'><span class='tbc col-7'>"+(void 0!==e.numberOfFixedLowBatteryDevices?e.numberOfFixedLowBatteryDevices:"-")+"</span></div><div class='tb text-err beacon'><span class='tbc col-7'>"+(void 0!==e.numberOfMovableLowBatteryDevices?e.numberOfMovableLowBatteryDevices:"-")+"</span></div>"},X=function(e){return"<div class='tb beacon'><span class='tbc col-8'>"+(void 0!==e.numberOfFixedSchedules?e.numberOfFixedSchedules:"-")+"</span></div><div class='tb beacon'><span class='tbc col-8'>"+(void 0!==e.numberOfMovableSchedules?e.numberOfMovableSchedules:"-")+"</span></div>"},z=function(e){return"<div class='tb beacon'><span class='tbc col-9'>"+(void 0!==e.numberOfFixedRules?e.numberOfFixedRules:"-")+"</span></div><div class='tb beacon'><span class='tbc col-9'>"+(void 0!==e.numberOfMovableRules?e.numberOfMovableRules:"-")+"</span></div>"},i='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+w.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+w.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</li><li><span class="disc r"></span>'+w.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+w.prop("FACILITY_DEVICE_STATUS_WARNING")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-peak"></Label>'+w.prop("FACILITY_INDOOR_STATUS_PEAK")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-deforest"></Label>'+w.prop("FACILITY_INDOOR_STATUS_DEFROST")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-filter" ></Label>'+w.prop("FACILITY_INDOOR_STATUS_FILTER_WARNING")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-rc-disable"></Label>'+w.prop("FACILITY_INDOOR_STATUS_RC_OFF")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-rock"></Label>'+w.prop("FACILITY_INDOOR_STATUS_OPERATION_LIMIT")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-thurmo"></Label>'+w.prop("FACILITY_INDOOR_TEMPERATURE_LIMIT")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-schedule"></Label>'+w.prop("FACILITY_DEVICE_SAC_INDOOR_SCHEDULE")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-spi"></Label>'+w.prop("FACILITY_INDOOR_CONTROL_SPI")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-antifreeze"></Label>'+w.prop("FACILITY_INDOOR_STATUS_FREEZE_PROTECTION")+"</li></ul></div>",a='<div class="flyoutBox lg"><ul class="legendList"><li><span class="disc g"></span>'+w.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</li><li class="no-block"><span class="disc r"></span>'+w.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li class="no-block"><span class="disc y"></span>'+w.prop("FACILITY_DEVICE_STATUS_WARNING")+'</li></ul><ul class="legendList"><li><span class="disc gr"></span>'+w.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED")+'</li><li><span class="disc measured gr"></span>'+w.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE")+"</li></ul></div>",o='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+w.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+w.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+"</li></ul></div>",n='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+w.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</li><li><span class="disc r"></span>'+w.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+w.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li></ul></div></div>",r='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+w.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+w.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</li><li><span class="disc r"></span>'+w.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+w.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li></ul></div></div>",u=e.template('<span title="" class="k-widget k-dropdown k-header common-grid-dropdown sac-indoor-dropdownlist"unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-busy="false"aria-activedescendant="80142285-e564-4717-88fa-3dd3d64ad025" data-field="#=field#"><span unselectable="on" class="k-dropdown-wrap #if(disabled){#k-state-disabled#}else{#k-state-default#}#"><span unselectable="on" class="k-input">#=text#</span><span unselectable="on" class="k-select" aria-label="select"><span class="k-icon k-i-arrow-60-down"></span></span></span><input class="sac-indoor-dropdownlist current-limit" data-value="#=value#" style="display: none;"></span>');return{mapListTemplate:function(e){var t=!1,i=e.operations,a=e.type,o=e.modes,n=e.mappedType,r=e.name,s=e.id,l=S.getStatus(e);l&&"Alarm"==(l=1<(l=l.split(".")).length?(S.isOnlyNormalType(e)&&l[0],l[1]):"Off")[0]&&(t=!0);var d=e.modes;t?d=l[0]:d&&0<d.length&&(d=S.getDisplayMode(o,i));return'<div class="device-map-panel-list-item">'+("<span class='detail-img "+l+" "+d+"' data-status='"+l+"' data-mode='"+d+"' data-type='"+a+"' data-mapped-type='"+n+"'></span>")+("<div class='detail-text'><span class='id'>"+s+"</span><span class='name'>"+S.decodeHtml(r)+"</span></div>")+("<span class='ic ic-info' data-id='"+s+"'></span>")+"</div>"},multiDetailListTemplate:function(e,t){var i="",a="",o="",n="",r=e.operations,s=e.modes;o=e.name;var l=!1;(a=S.getStatus(e))&&"Alarm"==(a=1<(a=a.split(".")).length?(n=a[0],S.isOnlyNormalType(e)&&"Alarm"!=a[0]||(n+="("+a[1]+")"),a[1]):(n=a[0],"Off"))[0]&&(l=!0),i=e.modes,l?i=a[0]:i&&0<i.length&&(i=S.getDisplayMode(s,r));var d="",c=e.type;return t&&c&&-1==c.indexOf("AirConditioner.")&&(d=S.getDisplayClassType(e)),"<span class='detail-img "+a+" "+i+" "+d+"'></span>"+(o="<span data-bind='text: name'>"+S.decodeHtml(o)+"</span>")+(a="<span class='panel-item-temp'><span>"+S.getStatusI18N(n)+"</span></span>")},detailPopupGroupListTemplate:function(e){var t=e.dms_devices_name,i=e.dms_devices_id,a=e.dms_devices_type,o=e.dms_devices_mappedType;return"ControlPoint"!=o&&(a=o||a),'<div class="device-detail-popup-group-list-item">'+("<span class='detail-img reg selected "+(a=S.getDisplayClassType(a))+"'></span>")+("<div class='detail-text'><span class='id'>"+i+"</span><span class='name'>"+S.decodeHtml(t)+"</span></div>")+"</div>"},multiDetailRegisterListTemplate:function(e){var t="",i="",a="",o="",n=e.operations,r=e.modes;e.type;a=e.name;var s=!1,l="unreg";return"Registered"==e.registrationStatus&&(l="reg"),(i=S.getStatus(e))&&"Alarm"==(i=1<(i=i.split(".")).length?(o=i[0],S.isOnlyNormalType(e)&&"Alarm"!=i[0]||(o+="("+i[1]+")"),i[1]):(o=i[0],"Off"))[0]&&(s=!0),"Alarm"==i[0]&&(s=!0),s?t=i[0]:t&&0<t.length&&(t=S.getDisplayMode(r,n)),"<span class='detail-img "+l+" "+S.getDisplayClassType(e)+"'></span>"+(a="<span data-bind='text: name'>"+S.decodeHtml(a)+"</span>")+(i="<span class='panel-item-temp'><span>"+o+"</span></span>")},multiDetailListDualTemplate:function(e,t,i){var a="",o="",n="",r="",s=e.operations,l=e.modes,d=void 0!==e.assets_types_id,c="name";d?void 0!==e.number&&null!==e.number&&""!==e.number?(n=e.number,c="number"):e.devices&&e.devices[0]&&(n=e.devices[0].dms_devices_name,c="devices[0].dms_devices_name"):n=e.name;var p=!1;(o=S.getStatus(e))&&"Alarm"==(o=1<(o=o.split(".")).length?(r=o[0],S.isOnlyNormalType(e)&&"Alarm"!=o[0]||(r+="("+o[1]+")"),o[1]):(r=o[0],"Off"))[0]&&(p=!0),a=e.modes,p?a=o[0]:a&&0<a.length&&(a=S.getDisplayMode(l,s));var u=e.type,v="",m=S.getPositionType(e);return v=d?t?"-"!=m&&"Movable"==m?"asset "+e.assets_types_name.toLowerCase()+" movable-reg":"asset "+e.assets_types_name.toLowerCase()+" reg":("-"!=m&&"Movable"==m&&(v="asset "+e.assets_types_name.toLowerCase()+" "+o+" movable"),"asset "+e.assets_types_name.toLowerCase()+" "+o):t?"-"!=m&&"Movable"==m?S.getDisplayClassType(e)+" movable-reg":S.getDisplayClassType(e)+" reg":-1!=u.indexOf("AirConditioner.")?o+" "+a:"-"!=m&&"Movable"==m?o+" "+a+" "+S.getDisplayClassType(e)+" movable":o+" "+a+" "+S.getDisplayClassType(e),i&&(v+=" selected"),"<span class='detail-img "+v+"'></span>"+(n="<span data-bind='text: "+c+"'>"+S.decodeHtml(n)+"</span>")+(o="<span class='panel-item-temp'><span>"+S.getStatusI18N(r)+"</span></span>")},mapListRegTemplate:function(e){var t=!1,i=e.operations,a=e.type,o=e.modes,n=e.mappedType,r=e.name,s=e.id,l=S.getStatus(e);l&&"Alarm"==(l=1<(l=l.split(".")).length?(S.isOnlyNormalType(e)&&l[0],l[1]):"Off")[0]&&(t=!0);var d=e.modes;t?d=l[0]:d&&0<d.length&&(d=S.getDisplayMode(o,i)),a=e.type;return'<div class="device-map-panel-list-item">'+("<span class='detail-img reg "+S.getDisplayClassType(e)+"' data-status='"+l+"' data-mode='"+d+"' data-type='"+a+"' data-mapped-type='"+n+"'></span>")+("<div class='detail-text'><span class='id'>"+s+"</span><span class='name'>"+S.decodeHtml(r)+"</span></div>")+("<span class='ic ic-info' data-id='"+s+"'></span>")+"</div>"},mapListDualTemplate:function(e,t){var i=!1,a=e.operations,o=e.type,n=e.modes,r=e.mappedType,s=e.name,l=e.id,d=S.getStatus(e);d&&"Alarm"==(d=1<(d=d.split(".")).length?(S.isOnlyNormalType(e)&&d[0],d[1]):"Off")[0]&&(i=!0);var c=e.modes;i?c=d[0]:c&&0<c.length&&(c=S.getDisplayMode(n,a)),o=e.type;var p=S.getPositionType(e);return'<div class="device-map-panel-list-item">'+("<span class='detail-img "+(t?"-"!=p&&"Movable"==p?S.getDisplayClassType(e)+" movable-reg":S.getDisplayClassType(e)+" reg":-1!=o.indexOf("AirConditioner.")?d+" "+c:"-"!=p&&"Movable"==p?d+" "+c+" "+S.getDisplayClassType(e)+" movable":d+" "+c+" "+S.getDisplayClassType(e))+"' data-status='"+d+"' data-mode='"+c+"' data-type='"+o+"' data-mapped-type='"+r+"'></span>")+("<div class='detail-text'><span class='id'>"+l+"</span><span class='name'>"+S.decodeHtml(s)+"</span></div>")+("<span class='ic ic-info' data-id='"+l+"'></span>")+"</div>"},getDeviceCardTemplate:function(e){var t=S.getStatus(e);t=t.replace(".","-");var i=R.getLocation(e),a=$("<div/>"),o=$("<div/>").addClass("engCardWrap").attr("data-uid",e.uid).attr("data-id",e.id);e.selected&&o.addClass("k-state-selected");var n=$("<div/>").addClass("engCard "+t),r=$("<div/>").addClass("tb icon"),s=$("<div/>").addClass("bound"),l=e.type,d=e.mappedType,c=void 0!==e.assets_types_id,p="ic-energy";l?-1!=l.indexOf("Light")||d&&-1!=d.indexOf("Light")?p="ic-light":-1!=l.indexOf("SmartPlug")?p="ic-smartplug":-1!=l.indexOf("Temperature")||-1!=l.indexOf("Humidity")||d&&-1!=d.indexOf("Temperature")||d&&-1!=d.indexOf("Humidity")?p="ic-temperature":-1!=l.indexOf("Gateway")?p="ic-gateway":-1!=l.indexOf("Beacon")?p="ic-beacon":-1!=l.indexOf("CCTV")?p="ic-cctv":(-1!=l.indexOf("Motion")||d&&-1!=d.indexOf("Motion"))&&(p="ic-motion"):c&&(p="asset "+e.assets_types_name.toLowerCase());var u=$("<span/>").addClass("dvcic "+p);s.append(u),r.append(s),n.append(r);var v=$("<div/>").addClass("txtwrap"),m=t.split("-"),_="";if("Normal"==m[0]){var f;l&&-1!=l.indexOf("Meter")||d&&-1!=d.indexOf("Meter")?(f="Meter.Gas"==l||"Meter.Gas"==d?S.CHAR.Gas:"Meter.WattHour"==l||"Meter.WattHour"==d?S.CHAR.WattHour:"Meter.Water"==l||"Meter.Water"==d?S.CHAR.Water:"",t=R.getMeterCurrentConsumption(e),t+="<span class='unit'>"+f+"</span>"):l&&-1!=l.indexOf("Temperature")||d&&-1!=d.indexOf("Temperature")?(t=R.getTempHumiTemperature(e,!0),t+="<span class='unit'>"+(f=S.CHAR[A.getTemperature().unit])+"</span>"):l&&-1!=l.indexOf("Humidity")||d&&-1!=d.indexOf("Humidity")?(f=S.CHAR.Humidity,t=R.getTempHumiHumidity(e,!0),t+="<span class='unit'>"+f+"</span>"):l&&-1!=l.indexOf("Motion")||d&&-1!=d.indexOf("Motion")?t=R.getMotionPresence(e):(t=m[0],S.isOnlyNormalType(e)&&"Alarm"!=t[0]||(t+="("+m[1]+")"))}else{t=m[1];var T=S.getRecentAlarm(e);T&&(_=c||l&&("Beacon"==l||"Gateway"==l||"CCTV"==l)?S.getAlarmDescription(T.name):"Code "+T.name)}var C=$("<p/>").addClass("cardName ellp").html(S.getStatusI18N(t)),g=$("<p/>").addClass("cardDesc ellp").text(_),O=$("<p/>").addClass("loc ellp").text(i),I="";I=c?e.number:e.name;var E=$("<p/>").addClass("dvc ellp").text(I),h=$("<i/>").addClass("ic ic-info").attr("data-id",e.id);return v.append(C),v.append(g),v.append(O),v.append(E),v.append(h),n.append(v),o.append(n),a.append(o),a.html()},statisticNumberOfCritical:F,statisticNumberOfWarning:x,statisticNumberOfRegisteredDevice:M,statisticNumberOfNormalDevices:U,statisticNumberOfOnDevices:Y,statisticNumberOfOnIndoorDevices:function(e){return(void 0!==e.numberOfOnIndoorDevices?e.numberOfOnIndoorDevices:"-")+"/"+(void 0!==e.numberOfOnVentilatorDevices?e.numberOfOnVentilatorDevices:"-")+"/"+(void 0!==e.numberOfOnDHWDevices?e.numberOfOnDHWDevices:"-")},statisticNumberOfOffDevices:P,statisticNumberOfOffIndoorDevices:function(e){return(void 0!==e.numberOfOffIndoorDevices?e.numberOfOffIndoorDevices:"-")+"/"+(void 0!==e.numberOfOffVentilatorDevices?e.numberOfOffVentilatorDevices:"-")+"/"+(void 0!==e.numberOfOffDHWDevices?e.numberOfOffDHWDevices:"-")},getStatusTemplate:function(e){var t=S.getStatus(e);return"<div><span class='circle-icon "+(t=t.replace(".","-"))+"'></span></div>"},getStatisticRow:t,getAssetStatusTemplate:function(e){var t=S.getAssetStatus(e);return"<div><span class='circle-icon "+(t=t.replace(".","-"))+"'></span></div>"},assetMapListRegTemplate:function(e){var t=e.assets_types_name,i=e.number,a=e.id,o=e.subAssetType;o&&(t+=" / "+o);var n=S.getStatus(e);n&&(n=1<(n=n.split(".")).length?(S.isOnlyNormalType(e)&&n[0],n[1]):"Off")[0];var r=S.getPositionType(e);return'<div class="device-map-panel-list-item">'+("<span class='detail-img asset "+n+" "+("-"!=r&&"Movable"==r?S.getDisplayClassType(e)+" movable":S.getDisplayClassType(e))+"' data-status='"+n+"'></span>")+("<div class='detail-text'><span class='id'>"+i+"</span><span class='name'>"+S.decodeHtml(t)+"</span></div>")+("<span class='ic ic-info' data-id='"+a+"'></span>")+"</div>"},getStatisticRowAsset:function(e){t(e,!0)},getStatisticRowBeacon:function(e){t(e,!1,!0)},statisticAssetFloor:function(e){return e.isSubAsset?"":e.name?e.name:"-"},statisticAssetTypes:function(e){var t="-";e.isSubAsset?t=(void 0!==e.assets_types_name?e.assets_types_name:"-")+(void 0!==e.assets_subAssetType?" / "+e.assets_subAssetType:""):t=void 0!==e.numberOfSubAssetTypes?e.numberOfSubAssetTypes:"-";return t},statisticAssetRegisteredAssets:function(e){return void 0!==e.numberOfRegisteredAssets?e.numberOfRegisteredAssets:"-"},statisticAssetNormalDevices:function(e){return void 0!==e.numberOfNormalDevices?e.numberOfNormalDevices:"-"},statisticAssetCriticalDevices:function(e){return void 0!==e.numberOfCriticalDevices?e.numberOfCriticalDevices:"-"},statisticAssetWarningDevices:function(e){return void 0!==e.numberOfWarningDevices?e.numberOfWarningDevices:"-"},statisticAssetDisconnectedDevices:function(e){return void 0!==e.numberOfDisconnectedDevices?e.numberOfDisconnectedDevices:"-"},statisticAssetLowBatteryDevices:function(e){return"<span class='text-err'>"+(void 0!==e.numberOfLowBatteryDevices?e.numberOfLowBatteryDevices:"-")+"</span>"},statisticAssetOutOfBoundsDevices:function(e){return"<span class='text-err'>"+(void 0!==e.numberOfOutOfBoundsDevices?e.numberOfOutOfBoundsDevices:"-")+"</span>"},assetTypeListTemplate:function(e){var t=e.name;return"<span class='detail-img asset "+t.toLowerCase()+"'></span>"+("<span data-bind='text: name'>"+S.decodeHtml(t)+"</span>")+"<span class='panel-item-temp'><span></span></span>"},statisticBeaconRegister:V,statisticBeaconPositionType:H,statisticBeaconNormal:W,statisticBeaconDisconnected:G,statisticBeaconWrongLocation:B,statisticBeaconLowBattery:j,statisticBeaconSchdules:X,statisticBeaconRules:z,detailStatusIconTemplate:function(e){var t=S.getStatus(e),i=t.split("."),a="<span class='circle-icon detail-popup "+i[0]+"-"+i[1]+"'></span>";if(-1<t.indexOf("Alarm")){var o=$("<div/>");t=t.replace(".","-");var n=S.getRecentAlarm(e),r=n.type,s=w.prop("FACILITY_DEVICE_STATUS_POPUP_"+r.toUpperCase());r=s||r;var l=$("<span/>").addClass(t).text(r+" "+w.prop("COMMON_CODE")+" "+n.name),d=$("<span/>").text(S.getAlarmDescription(n.name));return o.append(a),o.append(l),o.append("<br>"),o.append(d),o.html()}var c=i[0];return S.isOnlyNormalType(e)&&"Alarm"!=t[0]||(c+="("+i[1]+")"),a+S.getStatusI18N(c)},detailIconTemplateById:function(e){return'<span class="ic ic-info" data-num="detail" data-id='+e.id+' data-event="devicedetail"></span>'},indoorLegendTemplate:i,beaconLegendTemplate:a,pointLegendTemplate:o,baseLegendTemplate:n,legendTemplate:r,indoorTemperatureListTemplate:function(e){var t,i=$("<div/>"),a=$("<div/>"),o=S.getRecentAlarm(e),n=S.getStatus(e).replace(".","-");if(o){var r=w.prop("COMMON_CODE")+" "+o.name;t=$("<span/>").addClass(n).text(r),a.append(t),i.append(a)}else{var s,l,d=R.getTemperatures(e,!0);s=d.current,l=d.desired,t=$("<span/>").addClass(n).addClass("current").text(s);var c=$("<span/>").addClass(n).addClass("set").text(l);if(a.append(c),a.append(" / "),a.append(t),i.append(a),d.dhwDesired||d.dhwCurrent){var p=$("<div/>"),u=$("<span/>").addClass(n).addClass("current").text(d.dhwCurrent),v=$("<span/>").addClass(n).addClass("set").text(d.dhwDesired);p.append(v),p.append(" / "),p.append(u),i.append(p)}}return i.html()},indoorCardTemplate:function(e){var t,i=S.getDisplayMode(e.modes,e.operations),a=S.getStatus(e);a=a.replace(".","-"),e.information&&e.information.modelName&&(t="I"+e.information.modelName.toUpperCase().replace(/\s/gi,"").replace("+","PLUS"));var o=$("<div/>"),n=$("<div/>").addClass("card-item").attr("data-uid",e.uid).attr("data-id",e.id);e.selected&&n.addClass("k-state-selected");var r=$("<div/>"),s=$("<div/>").addClass("icon-line"),l=$("<div/>").addClass("card-info"),d=$("<div/>").addClass("left"),c=$("<div/>").addClass("right"),p=$("<span/>").addClass("type").addClass(a),u=$("<div/>").addClass("item-bottom"),v=e.name;v&&10<v.length&&(v=v.substring(0,10),v+="...");var m,_=$("<span/>").addClass("device-type-img "+t).text(v),f=S.getRecentAlarm(e);if(f){m="error",r.addClass("card-back "+a),p.text(" "),s.append("<div class='icon empty'/>");var T=a.split("-")[1];T="<span class='error'>"+(T=w.prop("FACILITY_INDOOR_MODE_"+T.toUpperCase()))+"</p><p>"+w.prop("COMMON_CODE")+" "+f.name+"</p>";var C=$("<span/>").addClass("error "+a).html(T);c.append(C),u.addClass("error")}else{var g;"HotWater"===i&&(i="HeatStorage"),m=R.convertDisplayName(i),"HeatStorage"===(g="ko"==k?S.getModeToI18N(i):m)?p.text("H.Water"):p.text(g);var O,I,E,h=R.getGridIcon(e),A=R.getTemperatures(e);if(O=A.current,I=A.desired,E=A.unit,h.length)for(var L=0,D=h.length;L<D;L++)s.append('<div class="icon '+h[L]+'"/>');else s.append("<div class='icon empty'/>");var b=$("<span/>").addClass(a).addClass("set");A.isWaterout&&$("<div/>").addClass("icon ic-dhwtemp-card").appendTo(b),$("<em/>").text(w.prop("FACILITY_INDOOR_SET")).appendTo(b),b.append(I),b.attr("data-content",E);var y=$("<span/>").addClass(a).addClass("current");$("<em/>").text(w.prop("FACILITY_INDOOR_CURRENT")).appendTo(y),y.append(O),y.attr("data-content",E),c.append(b),c.append(y)}var N=$("<span/>").addClass("device-img "+m+" "+a);return d.append(p),d.append(N),l.append(d),l.append(c),u.append(_),u.append('<i class="ic ic-info" data-id='+e.id+">"),r.append(s),r.append(l),r.append(u),n.append(r),o.append(n),o.html()},outdoorDropDownListTemplate:u,outdoorCurrentLimitTemplate:function(e){var t,i,a="-",o=e.airConditioner;o&&(i=o.outdoorUnit)&&(t=a=(a=i.electricCurrentControl)||"-",isNaN(a)?t=w.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"):t+="%");var n=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").text(w.prop("FACILITY_INDOOR_CURRENT")+": "+t).appendTo(n);var r=e.airConditioner,s=!1;return r&&(i=r.outdoorUnit),i&&(s=!i.electricCurrentControlSupported),"-"==a&&(a=c.outdoorControlConfig.electricCurrentControl[0].value),$(u({value:a,text:t,disabled:s,field:"electricCurrentControl"})).addClass("outdoor-dropdownlist").appendTo(n),n.html()},outdoorHeatingCapacityCalibrationTemplate:function(e){var t,i,a="-",o=e.airConditioner;o&&(i=o.outdoorUnit)&&(t=a=(a=i.heatingCapacityCalibration)||"-",isNaN(a)?t=w.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"):t+="kg/cm\xb2");var n=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").text(w.prop("FACILITY_INDOOR_CURRENT")+": "+t).appendTo(n);var r=e.airConditioner,s=!1;return r&&(i=r.outdoorUnit),i&&(s=!i.heatingCapacityCalibrationSupported),"-"==a&&(a=c.outdoorControlConfig.heatingCapacityCalibration[0].value),$(u({value:a,text:t,disabled:s,field:"heatingCapacityCalibration"})).addClass("outdoor-dropdownlist").appendTo(n),n.html()},outdoorCoolingCapacityCalibrationTemplate:function(e){var t,i,a="-",o=e.airConditioner;if(o&&(i=o.outdoorUnit))if("SelfControl"!=(a=(a=i.coolingCapacityCalibration)||"-")){var n=c.outdoorControlConfig.coolingCapacityCalibration[p],r=$.grep(n,function(e){return e.value==a});t=r[0]?r[0].text:"-"}else t=w.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL");var s=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").appendTo(s).text(w.prop("FACILITY_INDOOR_CURRENT")+": "+t);var l=e.airConditioner,d=!1;return l&&(i=l.outdoorUnit),i&&(d=!i.coolingCapacityCalibrationSupported),"-"==a&&(a=c.outdoorControlConfig.coolingCapacityCalibration[p][0].value),$(u({value:a,text:t,disabled:d,field:"coolingCapacityCalibration"})).addClass("cooling-capacity-calibaration-dropdownlist").addClass("outdoor-dropdownlist").appendTo(s),s.html()},pointTypeTemplate:function(e){return e.type.replace("ControlPoint.","")},pointValueTemplate:function(e){if(!e.controlPoint)return"-";var t=e.controlPoint.value,i=e.type;return-1!=i.indexOf("AO")||-1!=i.indexOf("AV")?'<input class="device-point-numeric" data-type="aoav" value="'+t+'" style="width:50%; text-align:center;"/><button class="device-point-sendbtn">'+w.prop("COMMON_BTN_SEND")+"</button>":-1!=i.indexOf("DO")||-1!=i.indexOf("DV")?'<input class="device-point-numeric" data-type="dodv" value="'+t+'" style="width:50%; text-align:center;"/><button class="device-point-sendbtn">'+w.prop("COMMON_BTN_SEND")+"</button>":t},gatewayListZigbeeTemplate:function(e){var t=R.getZigbeeStatus(e).split(".");return"<span class='circle-icon detail-popup "+t[0]+"-"+t[1]+"'></span>"},gatewayListBleTemplate:function(e){var t=R.getBleStatus(e).split(".");return"<span class='circle-icon detail-popup "+t[0]+"-"+t[1]+"'></span>"},gatewayListBleInterfaceTemplate:function(e){var t,i,a="";for(t=0;t<3;t++)a+="<span class='beacon-status'><span class='circle-icon detail-popup "+(i=R.getBleInterfaceStatus(e,t).split("."))[0]+"-"+i[1]+"'></span></span>";return a},bleMacAddressTemplate:function(e){return"<span class='ellipse'>"+R.getBleMacAddress(e)+"</span>"},bleUUIDTemplate:function(e){return"<span class='ellipse'>"+R.getBleUUID(e)+"</span>"}}}),define("operation/schedule/config/schedule-common",[],function(){var e,t=window.I18N,i={TXT_SELECT_ALL:t.prop("COMMON_BTN_SELECT_ALL"),TXT_UNSELECT_ALL:t.prop("COMMON_BTN_DESELECT_ALL"),TXT_CREATE_SCHEDULE:t.prop("FACILITY_SCHEDULE_CREATE_NEW_SCHEDULE"),TXT_EDIT_SCHEDULE:t.prop("FACILITY_SCHEDULE_EDIT_SCHEDULE"),TXT_DELETE_SCHEDULE:t.prop("FACILITY_SCHEDULE_DELETE_SCHEDULE_CONFIRM"),TXT_DELETE_EXCEPTIONAL_DAY:t.prop("FACILITY_SCHEDULE_DELETE_EXCEPTIONAL_DAY_CONFIRM"),TXT_DELETE_MULTI_EXCEPTIONAL_DAY:t.prop("FACILITY_SCHEDULE_DELETE_MULTI_EXCEPTIONAL_DAY_CONFIRM"),TXT_DELETE_SCHEDULE_RESULT:t.prop("FACILITY_SCHEDULE_DELETE_SCHEDULE_RESULT"),TXT_DELETE_SCHEDULE_MULTI_RESULT:t.prop("FACILITY_SCHEDULE_DELETE_SCHEDULE_MULTI_RESULT"),TXT_DELETE_EXCEPTIONAL_DAY_RESULT:t.prop("FACILITY_SCHEDULE_DELETE_EXCEPTIONAL_DAY_RESULT"),TXT_DELETE_EXCEPTIONAL_DAY_MULTI_RESULT:t.prop("FACILITY_SCHEDULE_DELETE_EXCEPTIONAL_DAY_MULTI_RESULT"),TXT_CREATE_SCHEDULE_CONFIRM:t.prop("FACILITY_SCHEDULE_CREATE_SCHEDULE_CONFIRM"),TXT_CREATE_SCHEDULE_CLOSE_CONFIRM:t.prop("COMMON_CLOSE_WINDOW_CONFIRM"),TXT_EDIT_SCHEDULE_CONFIRM:t.prop("FACILITY_SCHEDULE_EDIT_SCHEDULE_CONFIRM"),TXT_CANCEL_SCHEDULE_CONFIRM:t.prop("COMMON_MESSAGE_CONFIRM_CANCEL"),TXT_CREATE_SCHEDULE_RESULT:t.prop("COMMON_MESSAGE_NOTI_SAVED")},a='<div class="k-floatwrap k-header k-scheduler-toolbar grid-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-views k-scheduler-navigation"><li class="k-current-view-dropdownlist"><input id="toolbar-dropdownlist-btn" data-role="dropdownlist" data-text-field="text" data-value-field="value" data-option-label="'+t.prop("FACILITY_DEVICE_TYPE_ALL")+'" data-bind="source: dateTypeFilter.options.dataSource, events: {select: dateTypeFilter.options.select }"></input></li><li class="k-state-default k-header k-nav-today" data-action="today"><button data-role="button" class="k-button" data-bind="disabled: todayButton.disabled, events: {click: todayButton.options.click}"><span data-bind="text:todayButton.text"></span></button></li></ul><ul class="k-reset k-scheduler-navigation" data-bind="invisible: navigation.isInvisible"><li class="k-state-default k-header k-nav-prev" data-action="previous"><a role="button" class="k-link"><span class="ic ic-date-prev"></span></a></li><li class="k-state-default k-nav-current" data-action="nav-current"><a role="button" class="k-link"><span class="k-icon k-i-calendar"></span><span class="k-sm-date-format" data-bind="text: formattedShortDate" style="display:block;">2017-04-23 ~ 2017-04-29</span></a><i class="ic ic-error-calendar" style="display:none;"></i></li><li class="k-state-default k-header k-nav-next" data-action="next"><a role="button" class="k-link"><span class="ic ic-date-next"></span></a></li></ul><ul class="k-reset k-header k-scheduler-views legend"><li class="k-current-view" data-name="week"><a role="button" class="k-link">Week</a></li><li class="selected-text"><span data-bind="text: selectedText"></span></li></ul></div>',o='<div class="k-floatwrap k-header k-scheduler-toolbar grid-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-views k-scheduler-navigation"><li class="k-state-default k-view-month" data-name="month"><a role="button" class="k-button">'+t.prop("COMMON_MONTH")+'</a></li><li class="k-state-default k-view-year" data-name="year"><a role="button" class="k-button">'+t.prop("COMMON_YEAR")+'</a></li></ul><ul class="k-reset k-scheduler-navigation"><li class="k-state-default k-header k-nav-prev" data-action="previous"><a role="button" class="k-link"><span class="k-icon k-i-arrow-60-left"></span></a></li><li class="k-state-default k-nav-current"><a role="button" class="k-link"><span class="k-icon k-i-calendar"></span><span class="k-sm-date-format" data-bind="text: formattedShortDate" style="display:block;">2017-04-23 ~ 2017-04-29</span></a></li><li class="k-state-default k-header k-nav-next" data-action="next"><a role="button" class="k-link"><span class="k-icon k-i-arrow-60-right"></span></a></li></ul></div>',n=$("<div/>"),r=$("<div/>");return e=n.kendoCommonDialog().data("kendoCommonDialog"),{MSG:i,createNewWidget:function(e,t,i){return new t($("<div/>").attr("id",e),i)},schedulerHeaderTemplate:'<div class="k-floatwrap k-header k-scheduler-toolbar grid-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-views k-scheduler-navigation"><li class="k-current-view-dropdownlist"><input id="toolbar-dropdownlist-btn" data-role="dropdownlist" data-text-field="text" data-value-field="value" data-bind="source: dateTypeFilter.options.dataSource, events: {select: dateTypeFilter.options.select }"></input></li><li class="k-state-default k-header k-nav-today" data-action="today"><button data-role="button" class="k-button" data-bind="disabled: todayButton.disabled, events: {click: todayButton.options.click}"><span data-bind="text:todayButton.text"></span></button></li></ul><ul class="k-reset k-scheduler-navigation" data-bind="invisible: navigation.isInvisible"><li class="k-state-default k-header k-nav-prev" data-action="previous"><a role="button" class="k-link"><span class="ic ic-date-prev"></span></a></li><li class="k-state-default k-nav-current" data-action="nav-current"><a role="button" class="k-link"><span class="k-icon k-i-calendar"></span><span class="k-sm-date-format" data-bind="text: formattedShortDate" style="display:block;">2017-04-23 ~ 2017-04-29</span></a><i class="ic ic-error-calendar" style="display:none;"></i></li><li class="k-state-default k-header k-nav-next" data-action="next"><a role="button" class="k-link"><span class="ic ic-date-next"></span></a></li></ul><ul class="k-reset k-header k-scheduler-views legend"><li class="k-current-view" data-name="week"><a role="button" class="k-link">Week</a></li><li class="selected-text"><span data-bind="text: selectedText"></span></li></ul></div>',schedulerSearchHeaderTemplate:a,exceptionalDaysHeaderTemplate:o,confirmDialog:r.kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog"),msgDialog:e}}),define("operation/schedule/config/schedule-template",[],function(){function a(e){var t=e.devices,i=3;if(e.activated){var a,o,n,r;if(t&&0<t.length){var s,l=t.length;for(r=n=!1,s=0;s<l;s++)a=t[s].dms_devices_type,o=t[s].dms_devices_mappedType,-1!=a.indexOf("AirConditioner")&&(n=!0),(-1!=a.indexOf("Light")||o&&-1!=o.indexOf("Light"))&&(r=!0)}i=n&&r?2:n?0:r?1:3}else i=4;e.type=i;var d=p[i],c={type:i};return d&&(c.text=d.displayText,c.className=d.className),c}function o(e){var t="",i=a(e);return i.className&&(t=i.className),t}function t(e){return"<span class='panel-item-temp schedule-status'><span>"+(e.activated?w.prop("FACILITY_SCHEDULE_ACTIVATED"):w.prop("FACILITY_SCHEDULE_NOT_ACTIVATED"))+"</span></span>"}function i(e){return"<span class='action-button-wrapper'><button class='k-button action-button "+(e.activated?"ic ic-action-pause":"ic ic-action-play")+"'></button></span>"+t(e)}function n(e){e.name=e.name||e.title,e.title=e.name;var t=e.name;return"<span class='td-padding-left'>"+S.decodeHtml(t)+"</span>"}function r(e){if("scheduleDay"!==e.field){var t,i,a,o,n,r,s="",l="<span>",d=void 0!==e.deviceTypes?e.deviceTypes:[],c={operations:[],temperatures:[],modes:[],configuration:{},aoControlPoint:{},doControlPoint:{},lights:[]},p=e.algorithm;for(i=d.length,t=0;t<i;t++)(n=(o=d[t]).control)&&(n.operations&&((r=n.operations)instanceof R.data.ObservableArray&&(r=r.toJSON()),c.operations=c.operations.concat(r)),n.temperatures&&((r=n.temperatures)instanceof R.data.ObservableArray&&(r=r.toJSON()),c.temperatures=c.temperatures.concat(r)),n.modes&&((r=n.modes)instanceof R.data.ObservableArray&&(r=r.toJSON()),c.modes=c.modes.concat(r)),n.configuration&&(c.configuration=n.configuration),-1!=o.dms_devices_type.indexOf("AO")&&n.controlPoint&&(c.aoControlPoint=n.controlPoint),-1!=o.dms_devices_type.indexOf("DO")&&n.controlPoint&&(c.doControlPoint=n.controlPoint),n.lights&&(c.lights=n.lights));if(c){var u=c.modes,v=c.temperatures,m=c.configuration,_=c.aoControlPoint,f=c.doControlPoint,T=c.lights;a=c.operations;var C,g,O=0,I=!1,E="";if(u&&0<u.length&&(O+=u.length,I||(C=u[0].id,g=u[0].mode,-1!=C.indexOf("Ventilator")?E="("+w.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=C.indexOf("DHW")&&(E="("+w.prop("FACILITY_DEVICE_TYPE_DHW")+")"),s=(C=S.getDetailDisplayTypeDeviceI18N(C)+E+" "+w.prop("FACILITY_DEVICE_SAC_INDOOR_MODE"))+" : "+(g=w.prop("FACILITY_INDOOR_MODE_"+g.toUpperCase())),I=!0)),E="",a&&0<a.length&&(O+=a.length,I||(C=a[0].id,g=a[0].power,s=(C=(C="General"==C?S.getDetailDisplayTypeDeviceI18N("Light"):(-1!=C.indexOf("Ventilator")?E="("+w.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=C.indexOf("DHW")&&(E="("+w.prop("FACILITY_DEVICE_TYPE_DHW")+")"),S.getDetailDisplayTypeDeviceI18N(C)))+E+" "+w.prop("FACILITY_INDOOR_CONTROL_POWER"))+" : "+(g=w.prop("FACILITY_DEVICE_STATUS_"+g.toUpperCase())),I=!0)),E="",v&&0<v.length&&(O+=v.length,I||(C=v[0].id,g=v[0].desired,-1!=C.indexOf("Room")?E="("+w.prop("FACILITY_INDOOR_SET_TEMPERATURE")+")":-1!=C.indexOf("DHW")?E="("+w.prop("FACILITY_INDOOR_DHW_SET_TEMPERATURE")+")":-1!=C.indexOf("WaterOutlet")&&(E="("+w.prop("FACILITY_INDOOR_WATER_OUT_SET_TEMP")+")"),s=(C=S.getDetailDisplayTypeDeviceI18N(C)+E)+":"+g+S.CHAR.Celsius,I=!0)),m&&m.remoteControl&&(O+=1,!I)){var h="Allowed"===m.remoteControl?w.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_PERMIT"):w.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_PROHIBIT");s=w.prop("FACILITY_INDOOR_REMOTE_CONTROL")+" : "+h}T&&0<T.length&&(O+=T.length,I||(s=w.prop("FACILITY_DEVICE_TYPE_LIGHT")+" "+w.prop("LIGHT_BRIGHTNESS")+" : "+T[0].dimmingLevel));var A=_;if(A&&void 0!==A.value&&(O+=1,I||(s="AO "+w.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+" : "+A.value)),(A=f)&&void 0!==A.value&&(O+=1,I||(s="DO "+w.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+" : "+A.value)),void 0!==p){var L,D=p.mode,b=k.getTemperature().unit;g="PreCooling"==D?p.preCoolingTemperature:p.preHeatingTemperature,L="PreCooling"==D?"PRECOOLING":"PREHEATING",O+=1,I||(g=S.convertNumberFormat(Number(g).toFixed(1)),s=w.prop("FACILITY_INDOOR_"+L)+" : "+g+S.CHAR[b],I=!0)}0<O&&--O,0<O&&(s+=" (+"+O+")")}return l=l+s+"</span>"}}var R=window.kendo,S=window.Util,w=window.I18N,k=window.GlobalSettings,p=[{className:"indoor",displayText:w.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR")},{className:"light",displayText:w.prop("FACILITY_DEVICE_TYPE_LIGHT")},{className:"indoorlight",displayText:w.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR")+" + "+w.prop("FACILITY_DEVICE_TYPE_LIGHT")},{className:"others",displayText:w.prop("FACILITY_DEVICE_OTHERS")},{className:"pause",displayText:w.prop("COMMON_PAUSE")}];return{detailPopupGroupListTemplate:function(e){var t=e.dms_devices_name,i=e.dms_devices_id,a=void 0===e.location||null===e.location?"":e.location,o=a.split(", "),n=o.length<=2?a:o[0]+", "+o[1],r=o.length<3?"":o[2];return'<div class="device-detail-popup-group-list-item">'+("<div class='detail-text'><div class='name-and-id'><div class='name'>"+S.decodeHtml(t)+"</div><div class='id'>"+i+"</div></div><div class='location-wrapper'><div class='location-building'>"+n+"</div><div class='location-zone'>"+r+"</div></div></div>")+"</div>"},scheduleDetailListTemplate:function(e){return n(e)+i(e)},scheduleDetailNameTemplate:n,operationListTemplate:r,scheduleActivatedTemplate:t,scheduleUpdatedDateTemplate:function(e){var t=e.updated.date;return(0,window.moment)(t).format("YYYY-MM-DD")},moreOperationListTemplate:function(e){return r(e)+i(e)},executionTimeListTemplate:function(e){if("scheduleDay"!==e.field){var t,i="-",a=e.executionTimes,o=a.length;return 0<o&&(i=t=(t=(t=a[0]).split(":"))[0]+":"+t[1],1<o&&(i+=" (+"+(o-1)+")")),e.times=i}},getEventTemplateClass:o,checkboxCellTemplate:function(e){var t=o(e),i=e.uid;return'<div class="schedule-checkbox-cell '+t+'"><span class="checkbox-wrapper"><input type="checkbox" id="check_'+i+'" class="k-checkbox" '+(e.checked?"checked":"")+'/><label for="check_'+i+'" class="k-checkbox-label"></label></span></div>'},radioCellTemplate:function(e){var t=o(e),i=e.uid;return'<div class="schedule-checkbox-cell '+t+'"><span class="checkbox-wrapper"><input type="radio" id="check_'+i+'" class="k-radio" '+(e.checked?"checked":"")+'/><label for="check_'+i+'" class="k-radio-label"></label></span></div>'},getEventTemplateType:a,daysOfWeekTemplate:function(e){if("folder.groupName"!==e.field){var i={Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6},t="-",a=e.configurations,o=a[0].daysOfWeek;if(o&&0<o.length){var n=$.extend(!0,[],o);n.sort(function(e,t){return i[e]-i[t]});var r,s=n.length;for(r=0;r<s;r++)n[r]=w.prop("FACILITY_SCHEDULE_"+n[r].toUpperCase());t=n.join(", ")}var l=a.length;return 0<l-1&&(t+=" (+"+(l-1)+")"),t}},configuOperationListTemplate:function(e,t){var i,a,o,n,r,s,l,d,c="",p="<span>",u=e.configurations,v=0,m=!1;if("folder.groupName"!==e.field){if(!u)return p+="-</span>";for(var _={},f=0;f<u.length;f++){for(n=u[f].deviceTypes,d=u[f].algorithm,_={operations:[],temperatures:[],modes:[],configuration:{},aoControlPoint:{},doControlPoint:{},lights:[]},void 0===n&&(n=[]),a=n.length,i=0;i<a;i++)(s=(r=n[i]).control)&&(s.operations&&((l=s.operations)instanceof R.data.ObservableArray&&(l=l.toJSON()),_.operations=_.operations.concat(l)),s.temperatures&&((l=s.temperatures)instanceof R.data.ObservableArray&&(l=l.toJSON()),_.temperatures=_.temperatures.concat(l)),s.modes&&((l=s.modes)instanceof R.data.ObservableArray&&(l=l.toJSON()),_.modes=_.modes.concat(l)),s.configuration&&(_.configuration=s.configuration),-1!=r.dms_devices_type.indexOf("AO")&&s.controlPoint&&(_.aoControlPoint=s.controlPoint),-1!=r.dms_devices_type.indexOf("DO")&&s.controlPoint&&(_.doControlPoint=s.controlPoint),s.lights&&(_.lights=s.lights));if(_){var T=_.modes,C=_.temperatures,g=_.configuration,O=_.aoControlPoint,I=_.doControlPoint,E=_.lights;o=_.operations;var h,A,L="";if(T&&0<T.length&&(v+=T.length,m||(h=T[0].id,A=T[0].mode,-1!=h.indexOf("Ventilator")?L="("+w.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=h.indexOf("DHW")&&(L="("+w.prop("FACILITY_DEVICE_TYPE_DHW")+")"),c=(h=S.getDetailDisplayTypeDeviceI18N(h)+L+" "+w.prop("FACILITY_DEVICE_SAC_INDOOR_MODE"))+" : "+(A=w.prop("FACILITY_INDOOR_MODE_"+A.toUpperCase())),m=!0)),L="",o&&0<o.length&&(v+=o.length,m||(h=o[0].id,A=o[0].power,c=(h=(h="General"==h?S.getDetailDisplayTypeDeviceI18N("Light"):(-1!=h.indexOf("Ventilator")?L="("+w.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=h.indexOf("DHW")&&(L="("+w.prop("FACILITY_DEVICE_TYPE_DHW")+")"),S.getDetailDisplayTypeDeviceI18N(h)))+L+" "+w.prop("FACILITY_INDOOR_CONTROL_POWER"))+" : "+(A=w.prop("FACILITY_DEVICE_STATUS_"+A.toUpperCase())),m=!0)),L="",C&&0<C.length&&(v+=C.length,m||(h=C[0].id,A=C[0].desired,-1!=h.indexOf("Room")?L="("+w.prop("FACILITY_INDOOR_SET_TEMPERATURE")+")":-1!=h.indexOf("DHW")?L="("+w.prop("FACILITY_INDOOR_DHW_SET_TEMPERATURE")+")":-1!=h.indexOf("WaterOutlet")&&(L="("+w.prop("FACILITY_INDOOR_WATER_OUT_SET_TEMP")+")"),c=(h=S.getDetailDisplayTypeDeviceI18N(h)+L)+":"+A+S.CHAR.Celsius,m=!0)),g&&g.remoteControl&&(v+=1,!m)){var D="Allowed"===g.remoteControl?w.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_PERMIT"):w.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_PROHIBIT");c=w.prop("FACILITY_INDOOR_REMOTE_CONTROL")+" : "+D,m=!0}E&&0<E.length&&(v+=E.length,m||(c=w.prop("FACILITY_DEVICE_TYPE_LIGHT")+" "+w.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS")+" : "+E[0].dimmingLevel,m=!0));var b=O;if(b&&void 0!==b.value&&(v+=1,m||(c="AO "+w.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+" : "+b.value,m=!0)),(b=I)&&void 0!==b.value&&(v+=1,m||(c="DO "+w.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+" : "+b.value,m=!0)),void 0!==d){var y=d.mode,N=k.getTemperature().unit;y="PreCooling"==y?(A=d.preCoolingTemperature,"PRECOOLING"):(A=d.preHeatingTemperature,"PREHEATING"),v+=1,m||(A=S.convertNumberFormat(Number(A).toFixed(1)),c=w.prop("FACILITY_INDOOR_"+y)+" : "+A+S.CHAR[N],m=!0)}}}return 0<v&&--v,0<v&&(c+=" (+"+v+")"),t?c:p=p+c+"</span>"}},configuExecutionTimeListTemplate:function(e){if("folder.groupName"!==e.field){var t,i="-",a=e.configurations[0].executionTimes,o=a.length;return 0<o&&(i=t=(t=(t=a[0]).split(":"))[0]+":"+t[1],1<o&&(i+=" (+"+(o-1)+")")),e.times=i}},scheduleLoadDetailNameTemplate:function(e){e.name=e.name||e.title,e.title=e.name;var t=e.name;return"<span class='grid-cell-two-line-ellipsis'>"+S.decodeHtml(t)+"</span>"}}}),define("operation/rule/common/common",[],function(){var e=window.I18N;return{MSG:{TXT_SELECT_ALL:e.prop("COMMON_BTN_SELECT_ALL"),TXT_UNSELECT_ALL:e.prop("COMMON_BTN_DESELECT_ALL"),TXT_EDIT_SCHEDULE:e.prop("FACILITY_SCHEDULE_EDIT_SCHEDULE"),TXT_CREATE_SCHEDULE_CLOSE_CONFIRM:e.prop("COMMON_CLOSE_WINDOW_CONFIRM"),TXT_CANCEL_SCHEDULE_CONFIRM:e.prop("COMMON_MESSAGE_CONFIRM_CANCEL"),TXT_CREATE_SCHEDULE_RESULT:e.prop("COMMON_MESSAGE_NOTI_SAVED")}}}),define("operation/rule/template/rule-template",[],function(){function a(e){var t,i,a=e.devices,o=3;if(e.activated){if(a&&0<a.length){var n,r=a.length;for(i=t=!1,n=0;n<r;n++)-1!=a[n].dms_devices_type.indexOf("AirConditioner")&&(t=!0),-1!=a[n].dms_devices_type.indexOf("Light")&&(i=!0)}o=t&&i?2:t?0:i?1:3}else o=4;e.type=o;var s=d[o],l={type:o};return s&&(l.text=s.displayText,l.className=s.className),l}function o(e){var t="",i=a(e);return i.className&&(t=i.className),t}function t(e){return"<span class='panel-item-temp schedule-status'><span>"+(e.activated?A.prop("COMMON_OPERATING"):A.prop("COMMON_PAUSE"))+"</span></span>"}function i(e){return"<span class='action-button-wrapper'><button class='k-button action-button "+(e.activated?"ic ic-action-pause":"ic ic-action-play")+"'></button></span>"+t(e)}function n(e){e.name=e.name||e.title,e.title=e.name;var t=e.name;return"<span class='td-padding-left'>"+h.decodeHtml(t)+"</span>"}function r(e){var t,i,a,o,n,r,s="",l="<span>",d=e.deviceTypes;if(!d)return l+="-</span>";var c={operations:[],temperatures:[],modes:[],configuration:{},aoControlPoint:{},doControlPoint:{},lights:[]};for(i=d.length,t=0;t<i;t++)(n=(o=d[t]).control)&&(n.operations&&((r=n.operations)instanceof L.data.ObservableArray&&(r=r.toJSON()),c.operations=c.operations.concat(r)),n.temperatures&&((r=n.temperatures)instanceof L.data.ObservableArray&&(r=r.toJSON()),c.temperatures=c.temperatures.concat(r)),n.modes&&((r=n.modes)instanceof L.data.ObservableArray&&(r=r.toJSON()),c.modes=c.modes.concat(r)),n.configuration&&(c.configuration=n.configuration),-1!=o.dms_devices_type.indexOf("AO")&&n.controlPoint&&(c.aoControlPoint=n.controlPoint),-1!=o.dms_devices_type.indexOf("DO")&&n.controlPoint&&(c.doControlPoint=n.controlPoint),n.lights&&(c.lights=n.lights));if(c){var p=c.modes;a=c.operations;var u,v,m=c.temperatures,_=c.configuration,f=c.aoControlPoint,T=c.doControlPoint,C=c.lights,g=0,O=!1,I="";p&&0<p.length&&(g+=p.length,O||(u=p[0].id,v=p[0].mode,-1!=u.indexOf("Ventilator")?I="("+A.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=u.indexOf("DHW")&&(I="("+A.prop("FACILITY_DEVICE_TYPE_DHW")+")"),s=(u=h.getDetailDisplayTypeDeviceI18N(u)+I+" "+A.prop("FACILITY_DEVICE_SAC_INDOOR_MODE"))+" : "+(v=A.prop("FACILITY_INDOOR_MODE_"+v.toUpperCase())),O=!0)),I="",a&&0<a.length&&(g+=a.length,O||(u=a[0].id,v=a[0].power,s=(u=(u="General"==u?h.getDetailDisplayTypeDeviceI18N("Light"):(-1!=u.indexOf("Ventilator")?I="("+A.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=u.indexOf("DHW")&&(I="("+A.prop("FACILITY_DEVICE_TYPE_DHW")+")"),h.getDetailDisplayTypeDeviceI18N(u)))+I+" "+A.prop("FACILITY_INDOOR_CONTROL_POWER"))+" : "+(v=A.prop("FACILITY_DEVICE_STATUS_"+v.toUpperCase())),O=!0)),I="",m&&0<m.length&&(g+=m.length,O||(u=m[0].id,v=m[0].desired,-1!=u.indexOf("Room")?I="("+A.prop("FACILITY_INDOOR_SET_TEMPERATURE")+")":-1!=u.indexOf("DHW")?I="("+A.prop("FACILITY_INDOOR_DHW_SET_TEMPERATURE")+")":-1!=u.indexOf("WaterOutlet")&&(I="("+A.prop("FACILITY_INDOOR_WATER_OUT_SET_TEMP")+")"),s=(u=h.getDetailDisplayTypeDeviceI18N(u)+I)+":"+v+h.CHAR.Celsius,O=!0)),_&&_.remoteControl&&(g+=1,O||(s=A.prop("FACILITY_INDOOR_REMOTE_CONTROL")+" : "+_.remoteControl)),C&&0<C.length&&(g+=C.length,O||(s=A.prop("FACILITY_DEVICE_TYPE_LIGHT")+" "+A.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS")+" : "+C[0].dimmingLevel));var E=f;E&&void 0!==E.value&&(g+=1,O||(s="AO "+A.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+" : "+E.value)),(E=T)&&void 0!==E.value&&(g+=1,O||(s="DO "+A.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+" : "+E.value)),0<g&&--g,0<g&&(s+=" (+"+g+")")}return l=l+s+"</span>"}function s(e){var t=e.operator;t="=="===t?"=":t;var i=e.monitor?e.monitor:"-",a=e.value?e.value:"-";return(i=l[i]?l[i]:i)+" : "+t+" : "+(a=c[a]?c[a]:a)}var h=window.Util,A=window.I18N,L=window.kendo,d=[{className:"indoor",displayText:A.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR")},{className:"light",displayText:A.prop("FACILITY_DEVICE_TYPE_LIGHT")},{className:"indoorlight",displayText:A.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR")+" + "+A.prop("FACILITY_DEVICE_TYPE_LIGHT")},{className:"others",displayText:A.prop("FACILITY_DEVICE_OTHERS")},{className:"pause",displayText:A.prop("COMMON_PAUSE")}],l={"operations-AirConditioner.Indoor.General-power":A.prop("FACILITY_RULE_STATUS_INDOOR_POWER"),"operations-AirConditioner.Indoor.Ventilator-power":A.prop("FACILITY_RULE_STATUS_VENTILATOR_POWER"),"operations-AirConditioner.Indoor.DHW-power":A.prop("FACILITY_RULE_STATUS_DHW_POWER"),"modes-AirConditioner.Indoor.General-mode":A.prop("FACILITY_RULE_STATUS_INDOOR_MODE"),"modes-AirConditioner.Indoor.Ventilator-mode":A.prop("FACILITY_RULE_STATUS_VENTILATOR_MODE"),"modes-AirConditioner.Indoor.DHW-mode":A.prop("FACILITY_RULE_STATUS_DHW_MODE"),"temperatures-AirConditioner.Indoor.Room-current":A.prop("FACILITY_RULE_STATUS_INDOOR_CURRENT_TEMPERATURE"),"temperatures-AirConditioner.Indoor.DHW-current":A.prop("FACILITY_RULE_STATUS_DHW_CURRENT_TEMPERATURE"),"temperatures-AirConditioner.Indoor.Room-desired":A.prop("FACILITY_RULE_STATUS_INDOOR_SET_TEMPERATURE"),"temperatures-AirConditioner.Indoor.DHW-desired":A.prop("FACILITY_RULE_STATUS_DHW_SET_TEMPERATURE"),"temperatures-AirConditioner.Indoor.WaterOutlet-desired":A.prop("FACILITY_RULE_STATUS_WATER_OUT_SET_TEMPERATURE"),"temperatures-AirConditioner.DischargeAir-current":A.prop("FACILITY_RULE_STATUS_DISCHARGE_CURRENT_TEMPERATURE"),"temperatures-AirConditioner.DischargeAir.Heat-desired":A.prop("FACILITY_RULE_STATUS_DISCHARGE_HEAT_TEMPERATURE"),"temperatures-AirConditioner.DischargeAir.Cool-desired":A.prop("FACILITY_RULE_STATUS_DISCHARGE_COOL_TEMPERATURE"),"winds-AirConditioner.Indoor.General.Speed-wind":A.prop("FACILITY_RULE_STATUS_FAN_SPEED"),"winds-AirConditioner.Indoor.Ventilator.Speed-wind":A.prop("FACILITY_RULE_STATUS_VENTILATOR_FAN_SPEED"),"alarms-alarms_name":A.prop("FACILITY_RULE_STATUS_ERROR_CODE"),"airConditioner-outdoorUnit-electricCurrentControl":A.prop("FACILITY_RULE_STATUS_CURRENT_LIMIT"),"airConditioner-outdoorUnit-coolingCapacityCalibration":A.prop("FACILITY_RULE_STATUS_COOLING_CAPACITY_CALIBRATION"),"airConditioner-outdoorUnit-heatingCapacityCalibration":A.prop("FACILITY_RULE_STATUS_HEATING_CAPACITY_CALIBRATION"),"temperatures-AirConditioner.Outdoor-current":A.prop("FACILITY_DEVICE_OUTDOOR_TEMPERATURE"),"controlPoint-value":A.prop("FACILITY_POINT_VALUE"),"operations-General-power":A.prop("FACILITY_INDOOR_CONTROL_POWER"),"lights-1-dimmingLevel":A.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS"),"temperatures-General-current":A.prop("COMMON_TEMPERATURE"),"humidities-1-current":A.prop("COMMON_HUMIDITY"),"presences-1-detected":A.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE"),"meters-1-reading":A.prop("FACILITY_DEVICE_CURRENT_CONSUMPTION_UPPER")},c={On:A.prop("FACILITY_DEVICE_STATUS_ON"),Off:A.prop("FACILITY_DEVICE_STATUS_OFF"),Auto:A.prop("FACILITY_INDOOR_MODE_AUTO"),Cool:A.prop("FACILITY_INDOOR_MODE_COOL"),Heat:A.prop("FACILITY_INDOOR_MODE_HEAT"),Dry:A.prop("FACILITY_INDOOR_MODE_DRY"),Fan:A.prop("FACILITY_INDOOR_MODE_FAN"),CoolStorage:A.prop("FACILITY_INDOOR_MODE_COOLSTORAGE"),HeatStorage:A.prop("FACILITY_INDOOR_MODE_HOTWATER"),HeatExchange:A.prop("FACILITY_INDOOR_MODE_HEATEX"),ByPass:A.prop("FACILITY_INDOOR_MODE_BYPASS"),Sleep:A.prop("FACILITY_INDOOR_MODE_SLEEP"),Eco:A.prop("FACILITY_INDOOR_MODE_ECO"),Standard:A.prop("FACILITY_INDOOR_MODE_STANDARD"),Power:A.prop("FACILITY_INDOOR_MODE_POWER"),Force:A.prop("FACILITY_INDOOR_MODE_FORCE"),Low:A.prop("FACILITY_INDOOR_CONTROL_LOW"),Mid:A.prop("FACILITY_INDOOR_CONTROL_MID"),High:A.prop("FACILITY_INDOOR_CONTROL_HIGH"),Turbo:A.prop("FACILITY_INDOOR_CONTROL_TURBO"),SelfControl:A.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"),true:A.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"),false:A.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE")};return{scheduleDetailListTemplate:function(e){return n(e)+i(e)},scheduleDetailNameTemplate:n,operationListTemplate:r,conditionListTemplate:function(e){var t,i="-",a=e.condition;if(a&&(t=a.rules)&&0<t.length){var o=t.length,n=t[0];i=s(n),1<o&&(i+=" (+"+(o-1)+")")}return i},conditionTemplate:s,detailConditionTemplate:function(e){var t=e.operator;t="=="===t?"=":t;var i=e.monitor?e.monitor:"-",a=e.value?e.value:"-";if(i=l[i]?l[i]:i,a=c[a]?c[a]:a,e.devices){var o,n=e.devices.length,r="";for(o=0;o<n;o++)r+=e.devices[o].dms_devices_name||"-",o!=n-1&&(r+=", ");return"<div>"+i+" : "+t+" : "+a+"</div><div>"+r+"</div>"}},moreOperationListTemplate:function(e){return r(e)+i(e)},loadOperationListTemplate:function(e){return r(e)+t(e)},executionTimeListTemplate:function(e){var t,i="-",a=e.executionTimes;if(a){var o=a.length;0<o&&(i=t=(t=(t=a[0]).split(":"))[0]+":"+t[1],1<o&&(i+=" (+"+(o-1)+")")),e.times=i}return i},getEventTemplateClass:o,checkboxCellTemplate:function(e){var t=o(e),i=e.uid;return'<div class="schedule-checkbox-cell '+t+'"><span class="checkbox-wrapper"><input type="checkbox" id="check_'+i+'" class="k-checkbox" '+(e.checked?"checked":"")+'/><label for="check_'+i+'" class="k-checkbox-label"></label></span></div>'},radioCellTemplate:function(e){var t=o(e),i=e.uid;return'<div class="schedule-checkbox-cell '+t+'"><span class="checkbox-wrapper"><input type="radio" id="check_'+i+'" class="k-radio" '+(e.checked?"checked":"")+'/><label for="check_'+i+'" class="k-radio-label"></label></span></div>'},getEventTemplateType:a}}),define("operation/rule/model/rule-model",function(){"use strict";var r=window.moment,s=window.kendo.data.Model.define({id:"id",fields:{name:{name:"Name"},description:{name:"Description"},activated:{name:"Activation",type:"boolean"},startDate:{name:"Start Date",type:"date"},endDate:{name:"End Date",type:"date"},daysOfWeek:{name:"DaysOfWeek",type:"object",defaultValue:[]},times:{name:"Execution Time",type:"object",defaultValue:[]},condition:{name:"Condition",type:"object",defaultValue:{}},devices:{name:"Devices",type:"object",defaultValue:[]},control:{name:"Operations",type:"object",defaultValue:{}},alarmType:{name:"AlarmType"}}}),o=function(e,t){var i=new Date(e);return t?(i.setHours(23),i.setSeconds(59),i.setMinutes(59)):(i.setHours(0),i.setSeconds(0),i.setMinutes(0)),i};return{MockData:[{id:1,name:"Rule Control #1",description:"This rule is good in Freeze-up season",activated:!1,startDate:"2017-06-01",endDate:"2017-06-30",daysOfWeek:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],times:[{startTime:"00:00:00",endTime:"06:00:00"},{startTime:"08:00:00",endTime:"10:00:00"}],condition:{rules:[{order:1,calculation:"SingleStatus",devices:[{dms_devices_id:"d112001",dms_devices_type:"AirConditioner.Indoor"}],operator:"==",monitor:"operations-AirConditioner.Indoor.General-power",value:"On",duration:"P10M",logicOpr:"OR"}]},created:{date:"2017-02-27T13:00:00",ums_users_name:"Julia"},updated:{date:"2017-02-27T18:00:00",ums_users_name:"James"},devices:[{dms_devices_id:"d112002",dms_devices_name:"sac_indoor112002",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"},{dms_devices_id:"d112003",dms_devices_name:"sac_indoor112003",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"},{dms_devices_id:"d112004",dms_devices_name:"sac_indoor112004",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"}],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{operations:[{id:"AirConditioner.Indoor.General",power:"On"}],temperatures:[{id:"AirConditioner.Indoor",desired:30}],modes:[{id:"AirConditioner.Indoor.General",mode:"Cool"}],configuration:{remoteControl:"Allowed"}}}]},{id:2,name:"Alarm & Log #1",description:"This rule is good in Freeze-up season",activated:!1,startDate:"2017-06-15",endDate:"2017-07-15",daysOfWeek:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],times:[{startTime:"00:00:00",endTime:"06:00:00"},{startTime:"08:00:00",endTime:"10:00:00"}],condition:{rules:[{order:1,calculation:"SingleStatus",devices:[{dms_devices_id:"d112001",dms_devices_type:"AirConditioner.Indoor"}],operator:"==",monitor:"operations-AirConditioner.Indoor.General-power",value:"On",duration:"P10M",logicOpr:"OR"}]},created:{date:"2017-02-27T13:00:00",ums_users_name:"Julia"},updated:{date:"2017-02-27T18:00:00",ums_users_name:"James"},devices:[{dms_devices_id:"d112002",dms_devices_name:"sac_indoor112002",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"},{dms_devices_id:"d112003",dms_devices_name:"sac_indoor112003",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"},{dms_devices_id:"d112004",dms_devices_name:"sac_indoor112004",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"}],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{operations:[{id:"AirConditioner.Indoor.General",power:"On"}],temperatures:[{id:"AirConditioner.Indoor",desired:24.4}],modes:[{id:"AirConditioner.Indoor.General",mode:"Cool"}],configuration:{remoteControl:"Allowed"}}}],alarm:{logType:"Critical"}}],createDataSource:function(e){var t,i;for(i=e.length-1;0<=i;i--)if((t=e[i]).alarmType&&"None"!==t.alarmType)e.splice(i,1);else if(t.startDate=o(t.startDate),t.endDate)t.endDate=o(t.endDate,!0);else{var a=new Date;a.setFullYear(2099),t.endDate=a}return e},createModel:function(e){var t=new s(e);if(e)return t;var i=new Date,a=new Date((new Date).getFullYear(),(new Date).getMonth()+1,(new Date).getDate());t.set("startDate",i),t.set("endDate",a);var o=new Date,n=new Date;return o=r(o).set({hour:0,minute:0,second:0}).format("HH:mm:ss"),n=r(n).set({hour:23,minute:59,second:59}).format("HH:mm:ss"),t.set("times",[{startTime:o,endTime:n}]),t.set("condition",{}),t.set("control",{}),t.set("deviceTypes",[]),t.control.set("operation",[]),t.control.set("temperatures",[]),t.control.set("modes",[]),t.control.set("configuration",{}),t},MAX_END_DATE_YEAR:2099,MAX_END_DATE_MONTH:12,MAX_END_DATE_DAY:31,MAX_END_DATE:"2099-12-31"}}),define("operation/rule/model/rule-alarm-model",function(){"use strict";var o=function(e,t){var i=new Date(e);return t?(i.setHours(23),i.setSeconds(59),i.setMinutes(59)):(i.setHours(0),i.setSeconds(0),i.setMinutes(0)),i};return{MockData:[{id:1,name:"Alarm Log #1",description:"This rule is good in Freeze-up season",activated:!1,startDate:"2017-06-01",endDate:"2017-06-30",daysOfWeek:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],times:[{startTime:"00:00:00",endTime:"06:00:00"},{startTime:"08:00:00",endTime:"10:00:00"}],condition:{rules:[{order:1,calculation:"SingleStatus",devices:[{dms_devices_id:"d112001",dms_devices_type:"AirConditioner.Indoor"}],operator:"==",monitor:"operations-AirConditioner.Indoor.General-power",value:"On",duration:"P10M",logicOpr:"OR"}]},created:{date:"2017-02-27T13:00:00",ums_users_name:"Julia"},updated:{date:"2017-02-27T18:00:00",ums_users_name:"James"},devices:[{dms_devices_id:"d112002",dms_devices_name:"sac_indoor112002",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"},{dms_devices_id:"d112003",dms_devices_name:"sac_indoor112003",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"},{dms_devices_id:"d112004",dms_devices_name:"sac_indoor112004",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"}],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{operations:[{id:"AirConditioner.Indoor.General",power:"On"}],temperatures:[{id:"AirConditioner.Indoor",desired:24.4}],modes:[{id:"AirConditioner.Indoor.General",mode:"Cool"}],configuration:{remoteControl:"Allowed"}}}],alarm:{logType:"Critical"}},{id:2,name:"Rule Control #1",description:"This rule is good in Freeze-up season",activated:!1,startDate:"2017-06-15",endDate:"2017-07-15",daysOfWeek:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],times:[{startTime:"00:00:00",endTime:"06:00:00"},{startTime:"08:00:00",endTime:"10:00:00"}],condition:{rules:[{order:1,calculation:"SingleStatus",devices:[{dms_devices_id:"d112001",dms_devices_type:"AirConditioner.Indoor"}],operator:"==",monitor:"operations-AirConditioner.Indoor.General-power",value:"On",duration:"P10M",logicOpr:"OR"}]},created:{date:"2017-02-27T13:00:00",ums_users_name:"Julia"},updated:{date:"2017-02-27T18:00:00",ums_users_name:"James"},devices:[{dms_devices_id:"d112002",dms_devices_name:"sac_indoor112002",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"},{dms_devices_id:"d112003",dms_devices_name:"sac_indoor112003",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"},{dms_devices_id:"d112004",dms_devices_name:"sac_indoor112004",dms_devices_type:"AirConditioner.Indoor",location:"A Zone #2"}],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{operations:[{id:"AirConditioner.Indoor.General",power:"On"}],temperatures:[{id:"AirConditioner.Indoor",desired:24.4}],modes:[{id:"AirConditioner.Indoor.General",mode:"Cool"}],configuration:{remoteControl:"Allowed"}}}]}],createDataSource:function(e){var t,i;for(i=e.length-1;0<=i;i--)if((t=e[i]).alarmType&&"None"!==t.alarmType)if(t.startDate=o(t.startDate),t.endDate)t.endDate=o(t.endDate,!0);else{var a=new Date;a.setFullYear(2099),t.endDate=a}else e.splice(i,1);return e}}}),define("operation/rule/common/widget",["device/common/device-template","operation/rule/template/rule-template","operation/schedule/config/schedule-template","device/common/device-util","operation/rule/model/rule-model"],function(e,l,t,i,o){var a,n,r=window.moment,L=window.I18N,D=window.Util,b=window.GlobalSettings,y=window.kendo,s=$("<div/>"),d=$("<div/>");a=s.kendoCommonDialog().data("kendoCommonDialog"),n=d.kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog");function c(e){var t=e.alarmType;return t&&"None"!==t?["operation","devices","locations"]:["alarmType"]}var p=$("#rule-detail-popup"),u=$("#rule-alarm-detail-popup"),v=$("#device-detail-popup"),m=$("#rule-load-popup"),_=$("#rule-alarm-load-popup"),f={height:"100%",scrollable:!0,sortable:!1,filterable:!1,pageable:!1},T={Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6},C={id:"id",groupName:{updated:{template:"<div class='group blue'>"+L.prop("COMMON_LAST_UPDATE")+"</div>"},created:{template:"<div class='group blue'>"+L.prop("FACILITY_SCHEDULE_CREATE_CREATION_TITLE")+"</div>"},dateTime:{template:"<div class='group'>"+L.prop("FACILITY_SCHEDULE_CREATE_DATE_AND_TIME_TITLE")+"</div>"}},fields:{updatedDate:{groupName:"updated",type:"text",name:L.prop("COMMON_DATE"),template:function(e){var t="-";return e.updated&&e.updated.date&&(t=r(e.updated.date).format("LLL").replace(/\./g,"-")),t}},updatedUser:{groupName:"updated",type:"text",name:L.prop("COMMON_MANAGER"),template:function(e){var t="-";return e.updated&&e.updated.ums_users_name&&(t=e.updated.ums_users_name),D.decodeHtml(t)}},createdDate:{groupName:"created",type:"text",name:L.prop("COMMON_DATE"),template:function(e){var t="-";return e.created&&e.created.date&&(t=r(e.created.date).format("LLL").replace(/\./g,"-")),t}},createdUser:{groupName:"created",type:"text",name:L.prop("COMMON_MANAGER"),template:function(e){var t="-";return e.created&&e.created.ums_users_name&&(t=e.created.ums_users_name),D.decodeHtml(t)}},devices:{type:"grid",name:L.prop("FACILITY_DEVICE_DEVICE"),gridDataSource:function(e){var t=e.devices;if(t){var i,a,o=t.length;for(i=0;i<o;i++)a=t[i].dms_devices_mappedType||t[i].dms_devices_type,t[i].displayType=D.getDetailDisplayTypeDeviceI18N(a,!0)}return t},gridOptions:$.extend({},f,{hideHeader:!0,columns:[{template:e.detailPopupGroupListTemplate,field:"displayType",groupHeaderTemplate:function(e){var t=e.value,i="-";return t&&(i=D.getDisplayType(t)),e.count&&(i+=" ("+e.count+")"),i}}],group:[{field:"displayType",aggregates:[{field:"displayType",aggregate:"count"}]}]})},locations:{type:"grid",name:L.prop("COMMON_LOCATION"),gridDataSource:function(e){var t,i,a=e.devices,o=[],n=a.length,r=[];for(t=0;t<n;t++)i=a[t].location,-1==r.indexOf(i)&&(r.push(i),o.push({locationGroup:"1",location:i}));return o},gridOptions:$.extend({},f,{hideHeader:!0,columns:[{field:"locationGroup",template:function(e){return e.location},groupHeaderTemplate:function(e){var t="-";return e.value&&(t=L.prop("FACILITY_SCHEDULE_LOCATION_SETTING")),e.count&&(t+=" ("+e.count+")"),t}}],group:[{field:"locationGroup",aggregates:[{field:"locationGroup",aggregate:"count"}]}]})},condition:{type:"grid",name:L.prop("FACILITY_RULE_CONDITION"),gridDataSource:function(e){var t,i=e.condition,a=[];if(i&&i.rules){var o,n,r=(t=i.rules).length,s=[];for(o=0;o<r;o++)n=t[o],n=l.detailConditionTemplate(n),-1==s.indexOf(n)&&(s.push(n),a.push({conditionGroup:"1",condition:n}))}return a},gridOptions:$.extend({},f,{hideHeader:!0,columns:[{field:"conditionGroup",template:function(e){return e.condition},groupHeaderTemplate:function(e){var t="-";return e.value&&(t=L.prop("FACILITY_RULE_CONDITION_SETTING")),e.count&&(t+=" ("+e.count+")"),t}}],group:[{field:"conditionGroup",aggregates:[{field:"conditionGroup",aggregate:"count"}]}]})},date:{groupName:"dateTime",type:"text",name:L.prop("COMMON_DATE"),template:function(e){var t="-",i="-",a=e.startDate||e.start;a&&(t=r(a).format("L").replace(/\./g,"-")),a=e.endDate||e.end,(a=new Date(a))&&(i=a.getFullYear()==o.MAX_END_DATE_YEAR?L.prop("FACILITY_SCHEDULE_ENDLESS"):r(a).format("L").replace(/\./g,"-"));return t+" ~ "+i}},daysOfWeek:{groupName:"dateTime",type:"text",name:L.prop("FACILITY_SCHEDULE_REPEAT"),template:function(e){var t="None";if(e.daysOfWeek&&0<e.daysOfWeek.length){var i=$.extend(!0,[],e.daysOfWeek);i.sort(function(e,t){return T[e]-T[t]});var a,o=i.length;for(a=0;a<o;a++)i[a]=L.prop("FACILITY_SCHEDULE_"+i[a].toUpperCase());t=i.join(", ")}return t}},excecutionTimes:{groupName:"dateTime",type:"grid",name:L.prop("COMMON_TIME"),gridDataSource:function(e){var t,i,a,o=e.times,n=[];if(o){var r,s=o.length,l=b.getTimeDisplay();for(r=0;r<s;r++)i=(t=o[r]).startTime,a=t.endTime,i=(i=i.split(":"))[0]+":"+i[1],a=(a=a.split(":"))[0]+":"+a[1],"12Hour"==l&&(i=D.convertAmPm(i),a=D.convertAmPm(a)),t=i+" - "+a,n.push({executionGroup:"1",executionTimes:t})}else n.push({executionGroup:"1",executionTimes:L.prop("FACILITY_RULE_ALL_DAY")});return n},gridOptions:$.extend({},f,{hideHeader:!0,columns:[{field:"executionGroup",template:function(e){return e.executionTimes},groupHeaderTemplate:function(e){var t="-";return e.value&&(t=L.prop("FACILITY_SCHEDULE_TIME_SETTING")),e.count&&(t+=" ("+e.count+")"),t}}],group:[{field:"executionGroup",aggregates:[{field:"executionGroup",aggregate:"count"}]}]})},operation:{type:"text",name:L.prop("FACILITY_SCHEDULE_CREATE_OPERATION_TITLE"),template:function(e){var t,i,a,o,n,r,s,l,d,c,p,u,v=e.algorithm,m=b.getTemperature().unit,_="-",f=e.deviceTypes;if(!f)return _;var T={operations:[],temperatures:[],modes:[],configuration:{},aoControlPoint:{},doControlPoint:{},lights:[]};for(l=f.length,s=0;s<l;s++)(p=(c=f[s]).control)&&(p.operations&&((u=p.operations)instanceof y.data.ObservableArray&&(u=u.toJSON()),T.operations=T.operations.concat(u)),p.temperatures&&((u=p.temperatures)instanceof y.data.ObservableArray&&(u=u.toJSON()),T.temperatures=T.temperatures.concat(u)),p.modes&&((u=p.modes)instanceof y.data.ObservableArray&&(u=u.toJSON()),T.modes=T.modes.concat(u)),p.configuration&&(T.configuration=p.configuration),-1!=c.dms_devices_type.indexOf("AO")&&p.controlPoint&&(T.aoControlPoint=p.controlPoint),-1!=c.dms_devices_type.indexOf("DO")&&p.controlPoint&&(T.doControlPoint=p.controlPoint),p.lights&&(T.lights=p.lights));if(T){var C,g,O,I,E=_="";if(t=T.modes)for(E="",l=t.length,s=0;s<l;s++)C=t[s].id,g=t[s].mode,-1!=C.indexOf("Ventilator")?E="("+L.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=C.indexOf("DHW")&&(E="("+L.prop("FACILITY_DEVICE_TYPE_DHW")+")"),_+='<dd class="dotText"><div class="tb"><div class="tbc"><span>'+(C=D.getDetailDisplayTypeDeviceI18N(C)+E+" "+L.prop("FACILITY_DEVICE_SAC_INDOOR_MODE"))+'</span> :&nbsp;</div><div class="tbc">'+(g=L.prop("FACILITY_INDOOR_MODE_"+g.toUpperCase()))+"</div></div></dd>";if(i=T.operations)for(E="",l=i.length,s=0;s<l;s++)C=i[s].id,O=i[s].power,_+='<dd class="dotText"><div class="tb"><div class="tbc"><span>'+(C=(C="General"==C?D.getDetailDisplayTypeDeviceI18N("Light"):(-1!=C.indexOf("Ventilator")?E="("+L.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=C.indexOf("DHW")&&(E="("+L.prop("FACILITY_DEVICE_TYPE_DHW")+")"),D.getDetailDisplayTypeDeviceI18N(C)))+E+" "+L.prop("FACILITY_INDOOR_CONTROL_POWER"))+'</span> :&nbsp;</div><div class="tbc">'+(O=L.prop("FACILITY_DEVICE_STATUS_"+O.toUpperCase()))+"</div></div></dd>";if(r=T.lights)for(l=r.length,s=0;s<l;s++)d=r[s].dimmingLevel,_+='<dd class="dotText"><div class="tb"><div class="tbc"><span>'+L.prop("FACILITY_DEVICE_TYPE_LIGHT")+" "+L.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS")+'</span> :&nbsp;</div><div class="tbc">'+d+"</div></div></dd>";if(a=T.temperatures)for(E="",l=a.length,s=0;s<l;s++)-1!=(C=a[s].id).indexOf("Room")?E="("+L.prop("FACILITY_INDOOR_SET_TEMPERATURE")+")":-1!=C.indexOf("DHW")?E="("+L.prop("FACILITY_INDOOR_DHW_SET_TEMPERATURE")+")":-1!=C.indexOf("WaterOutlet")&&(E="("+L.prop("FACILITY_INDOOR_WATER_OUT_SET_TEMP")+")"),I=a[s].desired,_+='<dd class="dotText"><div class="tb"><div class="tbc"><span>'+(C=D.getDetailDisplayTypeDeviceI18N(C)+E)+'</span> :&nbsp;</div><div class="tbc">'+I+"<span>"+D.CHAR[m]+"</span></div></div></dd>";if((o=T.configuration)&&o.remoteControl){var h=o.remoteControl;h="Allowed"==h?L.prop("FACILITY_INDOOR_REMOTE_CONTROL_ENABLE"):L.prop("FACILITY_INDOOR_REMOTE_CONTROL_DISABLE"),_+='<dd class="dotText"><div class="tb"><div class="tbc"><span>'+L.prop("FACILITY_INDOOR_REMOTE_CONTROL")+'</span> :&nbsp;</div><div class="tbc">'+h+"</div></div></dd>"}if((n=T.aoControlPoint)&&n.value&&(_+='<dd class="dotText"><div class="tb"><div class="tbc"><span>AO '+L.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+'</span> :&nbsp;</div><div class="tbc">'+n.value+"</div></div></dd>"),(n=T.doControlPoint)&&n.value&&(_+='<dd class="dotText"><div class="tb"><div class="tbc"><span>DO '+L.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+'</span> :&nbsp;</div><div class="tbc">'+n.value+"</div></div></dd>"),v){var A=v.mode;A="PreCooling"==A?(d=v.preCoolingTemperature,"PRE_COOLING"):(d=v.preHeatingTemperature,"PRE_HEATING"),_+='<dd class="dotText"><div class="tb"><div class="tbc"><span>'+L.prop("FACILITY_INDOOR_"+A)+'</span> :&nbsp;</div><div class="tbc">'+d+"<span>"+D.CHAR[m]+"</span></div></div></dd>"}}return _}},alarmType:{type:"text",name:L.prop("FACILITY_RULE_ALARM_LOG_TYPE"),template:function(e){var t="-",i=e.alarmType;if(i){var a=L.prop("FACILITY_DEVICE_STATUS_"+i.toUpperCase());t=a||i}return t}},description:{type:"text",name:L.prop("COMMON_DESCRIPTION"),template:function(e){var t=e.description?e.description:"-";return D.decodeHtml(t)}}}},g={title:L.prop("COMMON_BTN_DETAIL"),width:652,height:830,buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2},contentViewModel:{detailType:L.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',listTemplate:l.scheduleDetailListTemplate,isCustomActions:!0,actions:[{text:L.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}},{text:L.prop("COMMON_BTN_DELETE"),visible:!0,action:function(e){var t,i;return t=e.sender.getSelectedData(),1<e.sender.dataSource.total()&&(i=e.sender.dataSource.data()),e.sender.trigger("onDelete",{result:t,results:i}),!1}},{text:L.prop("COMMON_BTN_EDIT"),visible:!0,action:function(e){var t,i;return t=e.sender.getSelectedData(),1<e.sender.dataSource.total()&&(i=e.sender.dataSource.data()),e.sender.trigger("onEdit",{result:t,results:i}),!1}}],onTypeChange:function(e){var t=e.type,i=e.sender.BTN,a=e.sender;a.setActions(i.CLOSE,{disabled:!1}),"single"==t?(a.setActions(i.EDIT,{visible:!0}),a.setActions(i.DELETE,{visible:!0})):"multi"==t&&(a.setActions(i.EDIT,{visible:!1}),a.setActions(i.DELETE,{visible:!1}))},scheme:C,selectedDetailFilter:c},O={title:L.prop("COMMON_BTN_DETAIL"),width:652,height:830,buttonsIndex:{CLOSE:0,EDIT:1,CANCEL:2,SAVE:3,REGISTER:4,DEREGISTER:5,DELETE:6},contentViewModel:{detailType:L.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',listTemplate:e.multiDetailListDualTemplate,headerTemplate:"<span>"+L.prop("FACILITY_DEVICE_SELECTED_DEVICE")+": <span>#:count #</span></span>",isCustomActions:!0,actions:[{text:L.prop("COMMON_BTN_CLOSE"),visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}}],scheme:{id:"id",fields:{type:{type:"text",name:L.prop("FACILITY_DEVICE_TYPE"),template:D.getDetailDisplayTypeDeviceI18N},id:{type:"text",name:L.prop("FACILITY_DEVICE_DEVICE_ID")},name:{type:"text",name:L.prop("FACILITY_DEVICE_DEVICE_NAME")},representativeStatus:{type:"text",name:L.prop("COMMON_STATUS"),template:e.detailStatusIconTemplate},modes:{type:"text",name:L.prop("FACILITY_INDOOR_CONTROL_OPERATION_MODE"),template:function(e){var t=e.modes;return t&&0<t.length?D.getDisplayModeI18N(t,e.operations,!0):"-"}},setTemperature:{type:"text",name:L.prop("FACILITY_INDOOR_SET_TEMPERATURE"),template:i.setTemperatures},currentTemperature:{type:"text",name:L.prop("FACILITY_INDOOR_CURRENT_TEMPERATURE"),template:i.curTemperatures},configuration:{type:"text",name:L.prop("FACILITY_INDOOR_REMOTE_CONTROL"),template:function(e){var t=e.configuration;return t&&t.remoteControl?"Allowed"===t.remoteControl?L.prop("FACILITY_INDOOR_REMOTE_CONTROL_ENABLE"):"NotAllowed"===t.remoteControl?L.prop("FACILITY_INDOOR_REMOTE_CONTROL_DISABLE"):L.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_CONDITIONAL"):"-"}},locations:{type:"text",name:L.prop("COMMON_LOCATION"),template:i.getLocation},groups:{type:"text",name:L.prop("FACILITY_GROUP_GROUP"),template:i.getGroup},information:{type:"text",name:L.prop("FACILITY_DEVICE_MODEL"),template:function(e){var t="-",i=e.information;if(i&&i.modelName){t=i.modelName;var a=L.prop("FACILITY_DEVICE_STATUS_POPUP_MODEL_"+t.toUpperCase());t=a||t}return t}},firmwareVersion:{type:"text",name:L.prop("FACILITY_DEVICE_FIRMWARE_VERSION"),template:i.getFirmwareVersion},description:{type:"text",name:L.prop("COMMON_DESCRIPTION")}}}},I={title:L.prop("FACILITY_SCHEDULE_LOAD_RULE"),width:884,height:830,isOnlyMulti:!0,gridOptions:{columns:[{field:"checked",width:37,sortable:!1},{field:"name",title:L.prop("FACILITY_RULE_RULE_CONTROL_NAME"),sortable:!0,width:180,template:l.scheduleDetailNameTemplate},{field:"condition",title:L.prop("FACILITY_RULE_CONDITION"),sortable:!0,width:200,template:l.conditionListTemplate},{field:"operations",title:L.prop("FACILITY_SCHEDULE_CREATE_OPERATION_TITLE"),width:400,template:l.loadOperationListTemplate,sortable:!1}],sortable:!0,hasRadioModel:!0},buttonsIndex:{CANCEL:0,SELECT:1},onTypeChange:function(e){var t=e.sender.BTN;e.sender.setActions(t.CANCEL,{disabled:!1}),e.sender.setActions(t.SELECT,{disabled:!0})},contentViewModel:{detailType:L.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',headerTemplate:"<span>"+L.prop("COMMON_TOTAL")+" "+L.prop("FACILITY_RULE_RULE_CONTROL")+": <span>#=count#</span></span>",isCustomActions:!0,actions:[{text:L.prop("COMMON_BTN_CANCEL"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}},{text:L.prop("COMMON_BTN_SELECT"),visible:!0,disabled:!0,action:function(e){var t,i;return 0<(i=e.sender.grid.getCheckedData()).length&&(t=i[0],e.sender.trigger("onSelect",{result:t,results:i})),!1}}],scheme:C,selectedDetailFilter:c},E={title:L.prop("FACILITY_SCHEDULE_LOAD_RULE_ALARM_LOG"),width:884,height:830,isOnlyMulti:!0,gridOptions:{columns:[{field:"checked",width:37,sortable:!1},{field:"name",title:L.prop("FACILITY_RULE_RULE_ALARM_LOG_NAME"),sortable:!0,width:200,template:l.scheduleDetailNameTemplate},{field:"condition",title:L.prop("FACILITY_RULE_CONDITION"),sortable:!0,width:200,template:l.conditionListTemplate},{field:"alarmType",title:L.prop("FACILITY_RULE_ALARM_LOG_TYPE"),width:200,template:function(e){var t={Warning:L.prop("FACILITY_DEVICE_STATUS_POPUP_WARNING"),Critical:L.prop("FACILITY_DEVICE_STATUS_POPUP_CRITICAL")},i="-",a=e.alarmType;return a&&(i=t[a]?t[a]:"-"),i},sortable:!1}],sortable:!0,hasRadioModel:!0},buttonsIndex:{CANCEL:0,SELECT:1},onTypeChange:function(e){var t=e.sender.BTN;e.sender.setActions(t.CANCEL,{disabled:!1}),e.sender.setActions(t.SELECT,{disabled:!0})},contentViewModel:{detailType:L.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',headerTemplate:"<span>"+L.prop("COMMON_TOTAL")+" "+L.prop("FACILITY_RULE_RULE_ALARM_LOG")+": <span>#=count#</span></span>",isCustomActions:!0,actions:[{text:L.prop("COMMON_BTN_CANCEL"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}},{text:L.prop("COMMON_BTN_SELECT"),visible:!0,disabled:!0,action:function(e){var t,i;return 0<(i=e.sender.grid.getCheckedData()).length&&(t=i[0],e.sender.trigger("onSelect",{result:t,results:i})),!1}}],scheme:C,selectedDetailFilter:c};return{createNewWidget:function(e,t,i){return new t($("<div/>").attr("id",e),i)},confirmDialog:n,msgDialog:a,getRuleDetailPopup:function(){return g.headerTemplate="<span>"+L.prop("FACILITY_RULE_SELECTED_RULE")+": <span>#:count #</span></span>",p.kendoDetailDialog(g).data("kendoDetailDialog")},getRuleAlarmDetailPopup:function(){return g.headerTemplate="<span>"+L.prop("FACILITY_RULE_SELECTED_RULE_ALARM")+": <span>#:count #</span></span>",u.kendoDetailDialog(g).data("kendoDetailDialog")},getDeviceDetailPopup:function(){return v.kendoDetailDialog(O).data("kendoDetailDialog")},getRuleLoadPopup:function(){return m.kendoDetailDialog(I).data("kendoDetailDialog")},getRuleAlarmLogLoadPopup:function(){return _.kendoDetailDialog(E).data("kendoDetailDialog")}}}),define("operation/rule/view-model/rule-alarm-vm",[],function(){var e=window.kendo,t=window.I18N;return{MainViewModel:e.observable({searchField:{invisible:!1,value:"",click:function(){},keydown:function(){}},actions:[{type:"template",id:"spanSelectedCount",template:"<span class='text-view'><span data-bind='text: options.selectedText'></span></span>",options:{selectedText:t.prop("FACILITY_RULE_MESSAGE_INFO_NONE_SELECT_RULE_ALARM_LOG")}},{type:"button",id:"rule-alarm-create-btn",text:t.prop("COMMON_BTN_CREATE"),invisible:!1,disabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"rule-alarm-edit-btn",text:t.prop("COMMON_BTN_EDIT"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"rule-alarm-delete-btn",text:t.prop("COMMON_BTN_DELETE"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"rule-alarm-detail-btn",text:t.prop("COMMON_BTN_DETAIL"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}}]})}}),define("operation/rule/view-model/rule-create-vm",["operation/core","operation/schedule/config/schedule-common","operation/schedule/config/schedule-template"],function(e,t,o){var v=window.kendo,E=window.moment,u=window.Util,i=window.GlobalSettings,h=window.I18N,p=window.MAIN_WINDOW,m=new window.CommonLoadingPanel,a=i.getTemperature(),n=a.unit,r=u.CHAR[n],s=a.increment,l="Fahrenheit"==n,_=i.getDeviceTypeOrdering(),d=_.indexOf("Sensor.Temperature_Humidity");-1!=d&&(_.splice(d,0,"Sensor.Humidity"),_.splice(d,0,"Sensor.Temperature"));var c,f=u.getControllableDeviceTypeDataSource(),T={AirConditioner:h.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR"),AirConditionerOutdoor:h.prop("FACILITY_DEVICE_TYPE_SAC_OUTDOOR"),ControlPoint:h.prop("FACILITY_DEVICE_TYPE_POINT"),Meter:h.prop("FACILITY_DEVICE_TYPE_ENERGY_METER"),Beacon:h.prop("FACILITY_DEVICE_TYPE_BLE_BEACON"),"IoT Gateway":h.prop("FACILITY_DEVICE_TYPE_IOT_GATEWAY"),Light:h.prop("FACILITY_DEVICE_TYPE_LIGHT"),CCTV:h.prop("FACILITY_DEVICE_TYPE_CCTV"),Printer:h.prop("FACILITY_DEVICE_TYPE_PRINTER")},C=$(".schedule-create-step-list"),A=v.observable({mapBtn:{active:!1,disabled:!1,click:function(){}},listBtn:{active:!1,disabled:!1,click:function(){}},filters:[{type:"noneLabelDropdowncheckbox",id:"device-type-list",invisible:!1,disabled:!1,options:{selectAllText:h.prop("FACILITY_DEVICE_TYPE_ALL"),emptyText:h.prop("FACILITY_RULE_CREATE_RULE_CHECK_DROPDOWNLIST_EMPTYTEXT"),dataTextField:"text",dataValueField:"value",animation:!1,autoBind:!1,showSelectAll:!0,dataSource:f,select:function(){},click:function(){}}},{type:"dropdownlist",id:"device-sub-type-list",disabled:!0,invisible:!1,options:{optionLabel:h.prop("FACILITY_DEVICE_TYPE_SUB"),dataTextField:"displayType",dataValueField:"type",animation:!1,dataSource:[],open:function(){},close:function(){},change:function(){},select:function(){}}},{type:"button",id:"device-select-all",text:t.MSG.TXT_SELECT_ALL,invisible:!1,disabled:!1,options:{click:function(){}}},{type:"template",invisible:!0,id:"schedule-step-title",template:"<span class='schedule-step-title' data-bind='invisible: invisible ,attr: { id : id }'></span>",options:{stepTitle:h.prop("FACILITY_SCHEDULE_DATETIME_SETTING")}}],actions:[{type:"template",id:"spanSelectedCount",template:"<span class='text-view'><span data-bind='text: options.selectedText'></span></span>",options:{selectedText:h.prop("FACILITY_DEVICE_NO_SELECTED")}},{type:"button",id:"create-prev",text:h.prop("COMMON_BTN_PREV"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"create-load",text:h.prop("COMMON_BTN_LOAD"),invisible:!1,disabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"create-next",text:h.prop("COMMON_BTN_NEXT"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"create-btn",text:h.prop("COMMON_BTN_CREATE"),invisible:!0,disabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}}],category:{invisible:!0,selected:{num:0,active:!1,click:function(){}},all:{num:0,text:h.prop("COMMON_ALL"),active:!1,click:function(){}},group:{num:0,active:!1,click:function(){}}},hideMapPanel:!1,hideSchedulePanel:!0,hidePanel:!1,isAlarmLog:!1,isEdit:!1,editLoadReady:!1,notRegistered:!1}),g=-1e6,O=1e6,I=[];for(c=0;c<=999;c++)I.push({text:c,value:"Dev_"+c});var L={};L["AirConditioner.Indoor.General"]=[{text:h.prop("FACILITY_RULE_STATUS_INDOOR_POWER"),value:"operations-AirConditioner.Indoor.General-power",comparison:"boolean",valueList:[{text:h.prop("FACILITY_DEVICE_STATUS_ON"),value:"On"},{text:h.prop("FACILITY_DEVICE_STATUS_OFF"),value:"Off"}]},{text:h.prop("FACILITY_RULE_STATUS_VENTILATOR_POWER"),value:"operations-AirConditioner.Indoor.Ventilator-power",comparison:"boolean",valueList:[{text:h.prop("FACILITY_DEVICE_STATUS_ON"),value:"On"},{text:h.prop("FACILITY_DEVICE_STATUS_OFF"),value:"Off"}]},{text:h.prop("FACILITY_RULE_STATUS_DHW_POWER"),value:"operations-AirConditioner.Indoor.DHW-power",comparison:"boolean",valueList:[{text:h.prop("FACILITY_DEVICE_STATUS_ON"),value:"On"},{text:h.prop("FACILITY_DEVICE_STATUS_OFF"),value:"Off"}]},{text:h.prop("FACILITY_RULE_STATUS_INDOOR_MODE"),value:"modes-AirConditioner.Indoor.General-mode",comparison:"string",valueList:[{text:h.prop("FACILITY_INDOOR_MODE_AUTO"),value:"Auto"},{text:h.prop("FACILITY_INDOOR_MODE_COOL"),value:"Cool"},{text:h.prop("FACILITY_INDOOR_MODE_HEAT"),value:"Heat"},{text:h.prop("FACILITY_INDOOR_MODE_DRY"),value:"Dry"},{text:h.prop("FACILITY_INDOOR_MODE_FAN"),value:"Fan"},{text:h.prop("FACILITY_INDOOR_MODE_COOLSTORAGE"),value:"CoolStorage"},{text:h.prop("FACILITY_INDOOR_MODE_HOTWATER"),value:"HeatStorage"}]},{text:h.prop("FACILITY_RULE_STATUS_VENTILATOR_MODE"),value:"modes-AirConditioner.Indoor.Ventilator-mode",comparison:"string",valueList:[{text:h.prop("FACILITY_INDOOR_MODE_AUTO"),value:"Auto"},{text:h.prop("FACILITY_INDOOR_MODE_HEATEX"),value:"HeatExchange"},{text:h.prop("FACILITY_INDOOR_MODE_BYPASS"),value:"ByPass"},{text:h.prop("FACILITY_INDOOR_MODE_SLEEP"),value:"Sleep"}]},{text:h.prop("FACILITY_RULE_STATUS_DHW_MODE"),value:"modes-AirConditioner.Indoor.DHW-mode",comparison:"string",valueList:[{text:h.prop("FACILITY_INDOOR_MODE_ECO"),value:"Eco"},{text:h.prop("FACILITY_INDOOR_MODE_STANDARD"),value:"Standard"},{text:h.prop("FACILITY_INDOOR_MODE_POWER"),value:"Power"},{text:h.prop("FACILITY_INDOOR_MODE_FORCE"),value:"Force"}]},{text:h.prop("FACILITY_RULE_STATUS_INDOOR_CURRENT_TEMPERATURE"),value:"temperatures-AirConditioner.Indoor.Room-current",comparison:"int",min:g,max:O,point:null,format:"n0"},{text:h.prop("FACILITY_RULE_STATUS_DHW_CURRENT_TEMPERATURE"),value:"temperatures-AirConditioner.Indoor.DHW-current",comparison:"int",min:g,max:O,point:null,format:"n0"},{text:h.prop("FACILITY_RULE_STATUS_INDOOR_SET_TEMPERATURE"),value:"temperatures-AirConditioner.Indoor.Room-desired",comparison:"int",min:g,max:O,point:null,format:"n0"},{text:h.prop("FACILITY_RULE_STATUS_DHW_SET_TEMPERATURE"),value:"temperatures-AirConditioner.Indoor.DHW-desired",comparison:"int",min:g,max:O,point:null,format:"n0"},{text:h.prop("FACILITY_RULE_STATUS_WATER_OUT_SET_TEMPERATURE"),value:"temperatures-AirConditioner.Indoor.WaterOutlet-desired",comparison:"int",min:g,max:O,point:null,format:"n0"},{text:h.prop("FACILITY_RULE_STATUS_DISCHARGE_CURRENT_TEMPERATURE"),value:"temperatures-AirConditioner.DischargeAir-current",comparison:"int",min:g,max:O,point:null,format:"n0"},{text:h.prop("FACILITY_RULE_STATUS_DISCHARGE_HEAT_TEMPERATURE"),value:"temperatures-AirConditioner.DischargeAir.Heat-desired",comparison:"int",min:g,max:O,point:null,format:"n0"},{text:h.prop("FACILITY_RULE_STATUS_DISCHARGE_COOL_TEMPERATURE"),value:"temperatures-AirConditioner.DischargeAir.Cool-desired",comparison:"int",min:g,max:O,point:null,format:"n0"},{text:h.prop("FACILITY_RULE_STATUS_FAN_SPEED"),comparison:"string",value:"winds-AirConditioner.Indoor.General.Speed-wind",valueList:[{text:h.prop("FACILITY_CONTROL_INDOOR_FAN_SPEED_AUTO"),value:"Auto"},{text:h.prop("FACILITY_INDOOR_CONTROL_LOW"),value:"Low"},{text:h.prop("FACILITY_INDOOR_CONTROL_MID"),value:"Mid"},{text:h.prop("FACILITY_INDOOR_CONTROL_HIGH"),value:"High"},{text:h.prop("FACILITY_INDOOR_CONTROL_TURBO"),value:"Turbo"}]},{text:h.prop("FACILITY_RULE_STATUS_VENTILATOR_FAN_SPEED"),comparison:"string",value:"winds-AirConditioner.Indoor.Ventilator.Speed-wind",valueList:[{text:h.prop("FACILITY_INDOOR_CONTROL_LOW_MID"),value:"Mid"},{text:h.prop("FACILITY_INDOOR_CONTROL_HIGH"),value:"High"},{text:h.prop("FACILITY_INDOOR_CONTROL_TURBO"),value:"Turbo"}]},{text:h.prop("FACILITY_RULE_STATUS_ERROR_CODE"),comparison:"string",value:"alarms-alarms_name",valueList:I}];var D={electricCurrentControl:[{value:"SelfControl",text:h.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:50,text:"50%"},{value:55,text:"55%"},{value:60,text:"60%"},{value:65,text:"65%"},{value:70,text:"70%"},{value:75,text:"75%"},{value:80,text:"80%"},{value:85,text:"85%"},{value:90,text:"90%"},{value:95,text:"95%"},{value:100,text:"100%"}],coolingCapacityCalibration:{Celsius:[{value:"SelfControl",text:h.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"5~7\xb0C"},{value:"7~9",text:"7~9\xb0C"},{value:"9~11",text:"9~11\xb0C"},{value:"10~12",text:"10~12\xb0C"},{value:"11~13",text:"11~13\xb0C"},{value:"12~14",text:"12~14\xb0C"},{value:"13~15",text:"13~15\xb0C"}],Fahrenheit:[{value:"SelfControl",text:h.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"41~45\xb0F"},{value:"7~9",text:"45~48\xb0F"},{value:"9~11",text:"48~52\xb0F"},{value:"10~12",text:"50~54\xb0F"},{value:"11~13",text:"52~55\xb0F"},{value:"12~14",text:"54~57\xb0F"},{value:"13~15",text:"55~59\xb0F"}]},heatingCapacityCalibration:[{value:"SelfControl",text:h.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:25,text:"25kg/cm\xb2"},{value:26,text:"26kg/cm\xb2"},{value:27,text:"27kg/cm\xb2"},{value:28,text:"28kg/cm\xb2"},{value:29,text:"29kg/cm\xb2"},{value:30,text:"30kg/cm\xb2"},{value:31,text:"31kg/cm\xb2"},{value:32,text:"32kg/cm\xb2"},{value:33,text:"33kg/cm\xb2"}]};function b(e){var t=$("<div/>").kendoCommonDialog({isCustomActions:!0,actions:[{text:h.prop("COMMON_BTN_OK"),action:function(e){e.sender.close(),e.sender.destroy(),e.sender.element.remove()}}]}).data("kendoCommonDialog");t.message(e),t.open()}function y(){var e,t,i=$(this),a=i.val(),o=i.data("kendoNumericTextBox"),n=o.options.min<0,r=o.options.format;if(t=""!=(r=r.replace("n",""))&&"0"!=r?n?/^[0-9.-]+$/:/^[0-9.]+$/:n?/^[0-9-]+$/:/^[0-9]+$/,""!=a&&!a.match(t)&&(void 0!==(e=o.beforeValue)||null!==e))return e=Number(e),i.val(e),void b(h.prop("COMMON_INVALID_CHARACTER"));var s=o.min(),l=o.max();if(s&&l&&""!=a&&(a=Number(a),s=Number(s),l=Number(l),a<s||l<a))return e=o.beforeValue,o.value(e),void b(h.prop("COMMON_INVALID_MIN_MAX",s,l));U.trigger("change",{keyUpValue:a})}function N(e){var t=$(this),i=t.val();t.data("kendoNumericTextBox").beforeValue=i}L.AirConditionerOutdoor=[{text:h.prop("FACILITY_RULE_STATUS_CURRENT_LIMIT"),value:"airConditioner-outdoorUnit-electricCurrentControl",comparison:"string",valueList:D.electricCurrentControl},{text:h.prop("FACILITY_RULE_STATUS_COOLING_CAPACITY_CALIBRATION"),comparison:"string",value:"airConditioner-outdoorUnit-coolingCapacityCalibration",valueList:D.coolingCapacityCalibration[n]},{text:h.prop("FACILITY_RULE_STATUS_HEATING_CAPACITY_CALIBRATION"),comparison:"string",value:"airConditioner-outdoorUnit-heatingCapacityCalibration",valueList:D.heatingCapacityCalibration},{text:h.prop("FACILITY_DEVICE_OUTDOOR_TEMPERATURE"),value:"temperatures-AirConditioner.Outdoor-current",comparison:"int",min:g,max:O,point:null,format:"n0"}],L.ControlPoint=[{text:"DI/DO",comparison:"string",value:"controlPoint-value_DIDO",format:"n0",min:0,max:1,point:null},{text:"AI/AO",comparison:"int",value:"controlPoint-value_AIAO",format:"n1",min:-179e306,max:179e306,point:null}],L.Light=[{text:h.prop("FACILITY_INDOOR_CONTROL_POWER"),value:"operations-General-power",comparison:"boolean",valueList:[{text:h.prop("FACILITY_DEVICE_STATUS_ON"),value:"On"},{text:h.prop("FACILITY_DEVICE_STATUS_OFF"),value:"Off"}]},{text:h.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS"),value:"lights-1-dimmingLevel",comparison:"int",min:g,max:O,point:null,format:"n0"}],L["Sensor.Temperature"]=[{text:h.prop("COMMON_TEMPERATURE"),value:"temperatures-General-current",comparison:"int",format:"n1",min:g,max:O,point:null}],L["Sensor.Humidity"]=[{text:h.prop("COMMON_HUMIDITY"),value:"humidities-1-current",comparison:"int",format:"n1",min:g,max:O,point:null}],L["Sensor.Motion"]=[{text:h.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE"),value:"presences-1-detected",comparison:"boolean",valueList:[{text:h.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"),value:!0},{text:h.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE"),value:!1}]}],L.Meter=[{text:h.prop("FACILITY_DEVICE_CURRENT_CONSUMPTION_UPPER"),value:"meters-1-reading",comparison:"int",format:"n1",min:-179e306,max:179e306,point:null}];var R=["=",">=","<=",">","<","!="],S=["=","!="];function w(e){var t=e.sender.value(),i=this.parent(),a=(i=i.parent()).indexOf(this),o=this.devices;if("Average"==t)this.set("showAddDeviceBtn",!0),1<o.length&&o[1].set("showRemoveBtn",!0);else{if("Addition"==t||"Subtraction"==t){var n=this.calculation.isUpdate;this.devices.length<2&&!n?i.addDevice(a):2<this.devices.length&&o.splice(2,o.length-1),1<o.length&&o[1].set("showRemoveBtn",!1)}else"SingleStatus"!=t&&""!=t||1<this.devices.length&&o.splice(1,o.length-1);this.set("showAddDeviceBtn",!1)}}function k(e){var t=e.sender.dataItem();console.info(t);var i,a,o,n=e.sender.element.closest(".status-list-wrapper").siblings(".value-list-wrapper");if("string"==t.comparison||"boolean"==t.comparison?this.comparison.options.set("dataSource",S):this.comparison.options.set("dataSource",R),t.valueList)this.valueTemperature.set("invisible",!0),this.valueTemperature.set("disabled",!0),this.valueInput.set("invisible",!0),this.valueInput.set("disabled",!0),this.valueList.set("invisible",!1),this.valueList.set("disabled",!1),this.valueList.options.set("dataSource",t.valueList);else if(void 0!==t.desired){this.valueList.set("invisible",!0),this.valueList.set("disabled",!0),this.valueInput.set("invisible",!0),this.valueInput.set("disabled",!0);var r=n.find("input.value-temperature[data-role='customnumericbox']");a=t.min,i=t.max;var s=t.desired,l=r.data("kendoCustomNumericBox");l.min(a),l.max(i),this.valueTemperature.set("invisible",!1),o=this.valueTemperature.get("value"),this.valueTemperature.set("disabled",!0),this.valueTemperature.set("disabled",!1),null==o||""===o?this.valueTemperature.set("value",s):("string"==typeof o&&(o=Number(o)),this.valueTemperature.set("value",o))}else if(void 0!==t.point){this.valueList.set("invisible",!0),this.valueList.set("disabled",!0),this.valueTemperature.set("invisible",!0),this.valueTemperature.set("disabled",!0);var d=n.find("input.value-input[data-role='numerictextbox']");a=t.min,i=t.max;var c=t.format,p=t.point;d.off("keyup").on("keyup",y),d.off("change").on("change",N);var u=d.data("kendoNumericTextBox");u.min(a),u.max(i),u.setOptions({format:c}),null==(o=this.valueInput.get("value"))||""===o?(this.valueInput.set("value",p),u.beforeValue=p):((o<a||i<o)&&(o=p,this.valueInput.set("value",p)),u.beforeValue=o),this.valueInput.set("invisible",!1),this.valueInput.set("disabled",!0),this.valueInput.set("disabled",!1)}else this.valueList.set("invisible",!0),this.valueList.set("disabled",!0),this.valueTemperature.set("invisible",!0),this.valueTemperature.set("disabled",!0),this.valueInput.set("invisible",!0),this.valueInput.set("disabled",!0)}function x(){if(A.editLoadReady){var e=this.parent();(e=e.parent()).status.options.set("value",null),e.comparison.options.set("value",null),e.valueInput.set("value",null),e.valueList.set("value",null)}}var F={calculation:{isUpdate:!1,disabled:!1,invisible:!1,options:{dataTextField:"text",dataValueField:"value",value:"SingleStatus",dataSource:[{text:h.prop("FACILITY_RULE_SINGLE_STATUS"),value:"SingleStatus"},{text:h.prop("FACILITY_RULE_ADDITION"),value:"Addition"},{text:h.prop("FACILITY_RULE_SUBTRACTION"),value:"Subtraction"},{text:h.prop("FACILITY_RULE_AVERAGE"),value:"Average"}],select:function(){},change:w,cascade:w}},showAddDeviceBtn:!1,devices:[],status:{disabled:!1,invisible:!1,options:{optionLabel:h.prop("COMMON_STATUS"),dataTextField:"text",dataValueField:"value",value:null,dataSource:[],select:function(){},change:k,cascade:k,dataBound:function(e){var t=this.parent();(t=t.parent()).get("isUpdate")||(this.status.options.set("value",null),this.valueList.set("invisible",!0),this.valueList.set("disabled",!0),this.valueTemperature.set("invisible",!0),this.valueTemperature.set("disabled",!0),this.valueInput.set("invisible",!0),this.valueInput.set("disabled",!0))}}},comparison:{disabled:!1,invisible:!1,options:{optionLabel:h.prop("FACILITY_RULE_COMPARISON"),value:null,dataSource:[],select:function(e){}}},valueList:{disabled:!1,invisible:!0,value:null,options:{optionLabel:h.prop("FACILITY_RULE_SELECT_VALUE"),dataTextField:"text",dataValueField:"value",dataSource:[],select:function(e){}}},valueTemperature:{disabled:!1,invisible:!0,unit:r,step:s,value:null},valueInput:{disabled:!1,invisible:!0,value:null},duration:{disabled:!1,invisible:!1,options:{optionLabel:h.prop("FACILITY_RULE_NO_DURATION"),value:null,dataTextField:"text",dataValueField:"value",dataSource:[{text:h.prop("FACILITY_RULE_1_MIN"),value:"P1M"},{text:h.prop("FACILITY_RULE_2_MIN"),value:"P2M"},{text:h.prop("FACILITY_RULE_3_MIN"),value:"P3M"},{text:h.prop("FACILITY_RULE_5_MIN"),value:"P5M"},{text:h.prop("FACILITY_RULE_7_MIN"),value:"P7M"},{text:h.prop("FACILITY_RULE_10_MIN"),value:"P10M"},{text:h.prop("FACILITY_RULE_15_MIN"),value:"P15M"},{text:h.prop("FACILITY_RULE_1_HOUR"),value:"P1H"}],select:function(e){}}},isAnd:!0,isOr:!1,clickAndBtn:function(e){this.set("isAnd",!0),this.set("isOr",!1)},clickOrBtn:function(e){this.set("isAnd",!1),this.set("isOr",!0)},showRemoveBtn:!1,showOperator:!1,showAddBtn:!0},M={building:{invisible:!1,disabled:!1,optionLabel:h.prop("SPACE_BUILDING"),dataTextField:"name",dataValueField:"id",value:null,dataSource:[],select:function(){},change:function(){},cascade:function(e){var i,t=e.sender.value(),a=this;t?(m.open(),$.ajax({url:"/foundation/space/floors?foundation_space_buildings_id="+t}).done(function(e){x.bind(a)(),e.sort(function(e,t){return e.sortOrder-t.sortOrder}),i=e.length;for(var t=0;t<i;t++)e[t].name=u.getFloorName(e[t]);a.floor.set("dataSource",e),a.floor.set("disabled",!1),A.editLoadReady&&(a.zone.set("value",""),a.type.set("value",""),a.id.set("value",""))}).fail(function(){}).always(function(){m.close()})):(a.floor.set("disabled",!0),a.zone.set("disabled",!0),a.type.set("disabled",!0),a.id.set("disabled",!0))}},floor:{invisible:!1,disabled:!0,value:null,optionLabel:h.prop("SPACE_FLOOR"),dataTextField:"name",dataValueField:"id",dataSource:[],select:function(){},change:function(){},cascade:function(e){var t=e.sender.value(),i=this;t?(m.open(),$.ajax({url:"/foundation/space/zones?foundation_space_floors_id="+t}).done(function(e){e.sort(function(e,t){return e.sortOrder-t.sortOrder}),e&&$.isArray&&(e.unshift({name:h.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY_ZONE"),id:"none"}),e.unshift({name:h.prop("FACILITY_DEVICE_ALL_ZONE"),id:"all"})),function(e,t){var i=e,a=i.building.get("value");a instanceof v.data.ObservableObject&&(a=a.id);var o=i.floor.get("value");o instanceof v.data.ObservableObject&&(o=o.id);var n=i.zone.get("value");n instanceof v.data.ObservableObject&&(n=n.id);var r=i.type.get("value");r instanceof v.data.ObservableObject&&(r=r.type);var s=i.building.disabled,l=i.floor.disabled,d=i.zone.disabled,c=i.type.disabled,p=i.id.disabled;(s||l||d||c||p||""===a||null==a||""===o||null==o||""===n||null==n||""===r||null==r)&&(i.zone.set("dataSource",t),i.zone.set("disabled",!1))}(i,e),x.bind(i)(),A.editLoadReady&&(i.zone.set("value",""),i.type.set("value",""),i.id.set("value",""))}).fail(function(){}).always(function(){m.close()})):(i.zone.set("disabled",!0),i.type.set("disabled",!0),i.id.set("disabled",!0))}},zone:{invisible:!1,disabled:!0,value:null,optionLabel:h.prop("SPACE_ZONE"),dataTextField:"name",dataValueField:"id",dataSource:[],select:function(e){},change:function(){},cascade:function(e){x.bind(this)();var t=e.sender.value();if(t){this.type.set("disabled",!1);var i=this.type.get("value");i&&(i instanceof v.data.ObservableObject&&(i=i.type,e.type=i),e.zoneId=t,e.data.type.cascade.call(this,e))}else this.type.set("disabled",!0),this.id.set("disabled",!0)}},type:{invisible:!1,disabled:!0,value:null,optionLabel:h.prop("FACILITY_DEVICE_TYPE"),dataTextField:"displayType",dataValueField:"type",dataSource:[],select:function(){},change:function(){},cascade:function(e,t){var i,s=this;x.bind(this)(),s===window?(s=e,e=t):i=e.sender.value();var a=s.building.get("value");a instanceof v.data.ObservableObject&&(a=a.id);var o=s.floor.get("value");o instanceof v.data.ObservableObject&&(o=o.id);var n=s.zone.get("value");n instanceof v.data.ObservableObject&&(n=n.id);var r,l="?",d="";(n=e.zoneId||n)&&"none"!==n&&"all"!==n&&(l+="foundation_space_zones_ids="+n+"&"),"none"===n&&(l+="foundation_space_floors_id="+o+"&",l+="foundation_space_zones_ids=0&"),"all"===n&&(l+="foundation_space_floors_id="+o+"&"),e.sender.options.optionLabel!==h.prop("FACILITY_DEVICE_TYPE")&&void 0!==s.type.value&&null!==s.type.value&&("string"==typeof s.type.value&&(i=s.type.value),void 0!==s.type.value.type&&null!==s.type.value.type&&""!==s.type.value.type&&(i=s.type.value.type)),"Sensor.Temperature"!=i&&"Sensor.Humidity"!=i&&-1==i.indexOf("Meter")&&"Light"!=i&&"Sensor.Motion"!=i||("Meter"==(r=i)&&(r="Meter.*"),d=l+"types=ControlPoint.*&",d+="registrationStatuses=Registered&"),l+="types="+i+"&",-1!=i.indexOf("ControlPoint")&&(l+="mappedTypes=ControlPoint&"),l+="registrationStatuses=Registered";var c=[];if(i){m.open();var p=[],u=[];c.push($.ajax({url:"/dms/devices"+l}).done(function(e){p=e})),r&&(d+="mappedTypes="+r,c.push($.ajax({url:"/dms/devices"+d}).done(function(e){u=e}))),$.when.apply(s,c).fail(function(){}).always(function(){var e,t,i,a,o,n,r=!1;for(i=p.length,a=u.length,e=0;e<a;e++){for(n=u[e],r=!1,t=0;t<i;t++)if(o=p[t],n.id==o.id){r=!0;break}r||p.push(n)}p.sort(function(e,t){return e.name.localeCompare(t.name)}),s.id.set("dataSource",p),s.id.set("disabled",!1),A.get("notRegistered")&&(C.find("li:not(li:eq(0),li:eq(1))").removeClass("enabled"),C.find("li:eq(1)").click(),A.actions[3].set("disabled",!0),b(h.prop("FACILITY_RULE_CONDITION_LOSE_ERROR")),A.set("notRegistered",!1)),m.close()})}else s.id.set("disabled",!0)}},id:{invisible:!1,disabled:!0,value:null,optionLabel:h.prop("FACILITY_DEVICE_DEVICE_NAME"),dataTextField:"name",dataValueField:"id",dataSource:[],select:function(){},change:function(){},cascade:function(e){var t=e.sender.dataItem();x.bind(this)(),t&&(t.type&&this.id.set("type",t.type),t.mappedType&&this.id.set("mappedType",t.mappedType),t.name&&this.id.set("name",t.name));var i=this.type.get("value");i instanceof v.data.ObservableObject&&(i=i.type);var a,o=this.parent();if(o=o.parent(),-1!=i.indexOf("AirConditioner.")?a=L["AirConditioner.Indoor.General"]:-1!=i.indexOf("Outdoor")?a=L.AirConditionerOutdoor:-1!=i.indexOf("ControlPoint")?(a=$.extend([],L.ControlPoint),void 0!==t.type&&(-1!==t.type.indexOf("AO")||-1!==t.type.indexOf("AI")?a.splice(0,1):a.splice(1,1))):a=-1!=i.indexOf("Light")?L.Light:"Sensor.Humidity"==i?L["Sensor.Humidity"]:"Sensor.Temperature"==i?L["Sensor.Temperature"]:-1!=i.indexOf("Motion")?L["Sensor.Motion"]:-1!=i.indexOf("Meter")?L.Meter:[],o.status.options.set("dataSource",a),null!==o.status.options.value){for(var n=!1,r=0,s=a.length;r<s;r++)if(-1!==a[r].value.indexOf(o.status.options.value)){n=!0;break}!1===n&&(C.find("li:not(li:eq(0),li:eq(1))").removeClass("enabled"),C.find("li:eq(1)").click(),A.actions[3].set("disabled",!0),b(h.prop("FACILITY_RULE_CONDITION_MISS_MATCH_ERROR")))}!1===A.get("editLoadReady")&&!0===U.get("isUpdate")&&setTimeout(function(){U.set("isUpdate",!1),A.set("editLoadReady",!0)},1e3)},dataBound:function(e){var t=this.parent(),i=(t=t.parent()).parent();(i=i.parent()).get("isUpdate")||(t.status.options.set("value",null),t.valueList.set("invisible",!0),t.valueList.set("disabled",!0),t.valueTemperature.set("invisible",!0),t.valueTemperature.set("disabled",!0),t.valueInput.set("invisible",!0),t.valueInput.set("disabled",!0))}},showRemoveBtn:!1},U=v.observable({init:function(){this.set("isUpdate",!1),this.set("rules",[])},default:function(){this.init(),this.addRule()},isUpdate:!1,isValid:function(e){var t,i,a,o,n,r,s=this.rules,l=s.length,d=!1;for(i=0;i<l;i++){if(d=!1,!(d=!(t=s[i]).calculation.get("disabled")&&!t.calculation.get("invisible")&&null!==t.calculation.options.get("value")&&void 0!==t.calculation.options.get("value")&&""!==t.calculation.options.get("value")))return!1;if(!(d=!t.comparison.get("disabled")&&!t.comparison.get("invisible")&&null!==t.comparison.options.get("value")&&void 0!==t.comparison.options.get("value")&&""!==t.comparison.options.get("value")))return!1;if(!(n=t.devices))return!1;for(o=n.length,a=0;a<o;a++)if(!(d=null!==(r=n[a]).id.get("value")&&void 0!==r.id.get("value")&&""!==r.id.get("value")))return!1;if(d=!t.valueList.get("disabled")&&!t.valueList.get("invisible")&&null!==t.valueList.get("value")&&void 0!==t.valueList.get("value")&&""!==t.valueList.get("value")||!t.valueTemperature.get("disabled")&&!t.valueTemperature.get("invisible")&&null!==t.valueTemperature.get("value")&&void 0!==t.valueTemperature.get("value")&&""!==t.valueTemperature.get("value")||!t.valueInput.get("disabled")&&!t.valueInput.get("invisible")&&null!==t.valueInput.get("value")&&void 0!==t.valueInput.get("value")&&""!==t.valueInput.get("value"),void 0!==e.keyUpValue&&(d=null!==e.keyUpValue&&""!==e.keyUpValue),!d)return!1}return d},rules:[],addRule:function(e){var t=$.extend({},F,!0);this.rules.push(t);var i=this.rules.length-1;e||this.addDevice(i),0<i&&(this.rules[i].set("showRemoveBtn",!0),this.rules[i-1].set("showOperator",!0)),24<=this.rules.length&&this.rules[i].set("showAddBtn",!1)},removeRule:function(e){var t=this.rules;t[e]&&(t.splice(e,1),0<e&&t[t.length-1].set("showOperator",!1))},updateRule:function(e,t){U.addRule(!0);var i,a,o=U.rules,n=o.length-1,r=o[n];r.calculation.isUpdate=!0,r.calculation.options.set("value",e.calculation);var s,l,d,c,p,u,v,m,_,f,T,C=e.devices,g=C.length;for(T=0;T<g;T++)v=(_=C[T]).dms_devices_id,c=_.dms_devices_type,p=_.dms_devices_mappedType,u=(_=t.get(v)).name,U.addDevice(n),a=r.devices.length-1,i=r.devices[a],_?((m=_.locations)&&m[0]&&(s=(m=m[0]).foundation_space_buildings_id,l=m.foundation_space_floors_id,d=m.foundation_space_zones_id,i.building.set("value",s),i.floor.set("value",l),d?i.zone.set("value",d):i.zone.set("value","none")),f=c,"ControlPoint"!=p&&(f=p||c),-1!=f.indexOf("AirConditioner.")?i.type.set("value","AirConditioner.*"):-1!=f.indexOf("AirConditionerOutdoor")?i.type.set("value","AirConditionerOutdoor"):-1!=f.indexOf("ControlPoint")?i.type.set("value","ControlPoint.*"):-1!=f.indexOf("Meter")?i.type.set("value","Meter.*"):-1!=f.indexOf("Light")?i.type.set("value","Light"):"Sensor.Humidity"==f?i.type.set("value","Sensor.Humidity"):"Sensor.Temperature"==f?i.type.set("value","Sensor.Temperature"):-1!=f.indexOf("Motion")&&i.type.set("value","Sensor.Motion"),i.id.set("type",c),i.id.set("mappedType",p),i.id.set("value",v),i.id.set("name",u)):console.error("there is no device id is "+v);var O=e.monitor;-1!=f.indexOf("ControlPoint")&&(-1!=f.indexOf("DI")||-1!=f.indexOf("DO")?O+="_DIDO":-1==f.indexOf("AI")&&-1==f.indexOf("AO")||(O+="_AIAO")),r.status.options.set("value",O);var I=e.operator;"=="==I&&(I="="),r.comparison.options.set("value",I),r.duration.options.set("value",e.duration),r.valueList.set("value",e.value),r.valueTemperature.set("value",e.value),r.valueInput.set("value",e.value),"OR"==e.logicOpr?(r.set("isOr",!0),r.set("isAnd",!1)):"AND"==e.logicOpr&&(r.set("isAnd",!0),r.set("isOr",!1))},indexOf:function(e){var t,i=this.rules,a=i.length;for(t=0;t<a;t++)if(e===i[t])return t;return-1},addDevice:function(e){var t=$.extend({},M,!0),i=this.rules,a=p.getCurrentBuildingList();t.building.dataSource=a;var o,n,r,s=[],l=u.getInstalledTypeList().length;for(l=_.length,r=0;r<l;r++)n=_[r],u.isInstalledType(n,!0)&&(o=u.getDetailDisplayTypeDeviceI18N(n,!0),-1!=n.indexOf("Indoor")?s.push({displayType:o,type:"AirConditioner.*"}):-1!=n.indexOf("Outdoor")?s.push({displayType:o,type:"AirConditionerOutdoor"}):-1!=n.indexOf("Point")?s.push({displayType:o,type:"ControlPoint.*"}):-1!=n.indexOf("Light")?s.push({displayType:o,type:"Light"}):"Sensor.Humidity"==n?s.push({displayType:o,type:"Sensor.Humidity"}):"Sensor.Temperature"==n?s.push({displayType:o,type:"Sensor.Temperature"}):-1!=n.indexOf("Motion")?s.push({displayType:o,type:"Sensor.Motion"}):-1!=n.indexOf("Meter")&&s.push({displayType:o,type:"Meter.*"}));t.type.dataSource=s;var d=i[e];d&&d.devices.push(t);var c=d.devices.length-1;console.info("device index : "+c),"Average"==d.calculation.options.get("value")&&(0<c&&d.devices[c].set("showRemoveBtn",!0),5==d.devices.length?d.set("showAddDeviceBtn",!1):d.set("showAddDeviceBtn",!0))},removeDevice:function(e,t){var i=this.rules;i[e]&&i[e].devices[t]&&(i[e].devices.splice(t,1),5==i[e].devices.length?i[e].set("showAddDeviceBtn",!1):i[e].set("showAddDeviceBtn",!0))}}),Y=l?u.getFahrenheit(24):24,P=l?64:18,V=l?86:30,H=l?u.getFahrenheit(24):24,W=l?u.getFahrenheit(40):40,G=l?u.getFahrenheit(5):5,B=l?u.getFahrenheit(85):85,j=l?u.getFahrenheit(24):24,X=l?u.getFahrenheit(18):18,z=l?u.getFahrenheit(30):30,J=v.observable({startDate:new Date,endDate:new Date((new Date).getFullYear(),(new Date).getMonth()+1,(new Date).getDate()),startDateDisplay:E(new Date).format("L").replace(/\./g,"-"),endDateDisplay:E(new Date((new Date).getFullYear(),(new Date).getMonth()+1,(new Date).getDate())).format("L").replace(/\./g,"-"),times:[],isEndless:!1,isAllDay:!0,isAllDayValue:!1,daysOfWeekJoin:"",daysOfWeek:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},daysOfWeekDisabled:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},timesDisplay:"",converDateFormat:function(e){return E(e).format("L").replace(/\./g,"-")},convertDateFormatForURL:function(e){return E(e).format("YYYY-MM-DDTHH:mm:ss")},dateTimeInit:function(){var e=new Date;this.set("startDate",e);var t=new Date((new Date).getFullYear(),(new Date).getMonth()+1,(new Date).getDate());this.set("endDate",t),e=E(e).format("L").replace(/\./g,"-"),this.set("startDateDisplay",e),t=E(t).format("L").replace(/\./g,"-"),this.set("endDateDisplay",t),this.set("timesDisplay",""),this.set("times",[]),this.set("isEndless",!1),this.set("isAllDay",!0),this.set("isAllDayValue",!1),this.daysOfWeek.set("mon",!1),this.daysOfWeek.set("tue",!1),this.daysOfWeek.set("wed",!1),this.daysOfWeek.set("thu",!1),this.daysOfWeek.set("fri",!1),this.daysOfWeek.set("sat",!1),this.daysOfWeek.set("sun",!1)},dateTimeDefault:function(){this.init(),this.daysOfWeek.set("mon",!0),this.daysOfWeek.set("tue",!0),this.daysOfWeek.set("wed",!0),this.daysOfWeek.set("thu",!0),this.daysOfWeek.set("fri",!0),this.daysOfWeek.set("sat",!0),this.daysOfWeek.set("sun",!0)},clickAllDay:function(e){var t=$(e.target).prop("checked");this.set("isAllDayValue",t)},isTimePickerValid:function(e){var t,i=this.get("times"),a=i.length,o=$(".datetime-pickers-list");if(0<a){var n,r,s=[],l=!1;for(t=0;t<a;t++){n=Number(E(i[t].startTime).format("YYMMDDHHmmss")),Number(E(i[t].endTime).format("YYMMDDHHmmss"))<=n&&(s.push({startOver:i[t].startTime}),l=!0);for(var d=0;d<a;d++)if(t!=d){var c=Number(E(i[d].startTime).format("YYMMDDHHmmss")),p=Number(E(i[d].endTime).format("YYMMDDHHmmss"));c<=n&&n<=p&&(s.push({DuplicateTime:{startTime:i[d].startTime,endTime:i[d].endTime}}),s.push({DuplicateTime:{startTime:i[t].startTime,endTime:i[t].endTime}}))}}var u="ko"===window.GlobalSettings.getLocale()?"width: 25.5vh":"width: 27.5vh";return a=s.length,o.find("input[data-role='commontimepicker']").each(function(){for((r=$(this).data("kendoCommonTimePicker")).hideMessage(),t=0;t<a;t++){if(void 0!==s[t].startOver&&r.value()===s[t].startOver)return r.showInvalidMesage(h.prop("FACILITY_RULE_CREATE_START_TIME_OVER")),r.element.parent().parent().parent().find(".k-widget.k-tooltip.k-tooltip-validation.k-invalid-msg.common-time-picker-invalid-msg")[0].setAttribute("style",u),s;l||void 0===s[t].DuplicateTime||s[t].DuplicateTime.startTime!==r.value()&&s[t].DuplicateTime.endTime!==r.value()||(r.showInvalidMesage(h.prop("FACILITY_RULE_CREATE_EXISTING_START_END_TIME_OVER")),r.element.parent().parent().parent().find(".k-widget.k-tooltip.k-tooltip-validation.k-invalid-msg.common-time-picker-invalid-msg")[0].setAttribute("style",u))}}),s}},isDateTimeValid:function(e){var t,i;if(e.field&&("startDate"==e.field||"endDate"==e.field)){var a=this.get("startDate"),o=this.get("endDate"),n=E(a),r=E(o);if(r.isBefore(n)&&(this.set("endDate",a),o=a,r=n),!A.get("isEdit")){var s=new Date,l=E(s);n.isBefore(l)&&(this.set("startDate",new Date(l.add(1,"seconds"))),a=s,n=l)}var d=r.diff(n,"week"),c=this.get("isEndless");if(c||0!=d){if(c)for(i=7,t=0;t<i;t++)this.disableDaysOfWeek(t,!1)}else{var p=E(n);for(i=p.day()+7,t=p.day();t<i;t++)E(p).day(t).isBetween(n,r,"day","[]")?this.disableDaysOfWeek(t,!1):this.disableDaysOfWeek(t,!0)}}var u=this.get("times");i=u.length;var v="";u[0]&&(v+=E(u[0].startTime).format("HH:mm"),v+="~",v+=E(u[0].endTime).format("HH:mm")),0<i-1&&(v+=" (+"+(i-1)+")"),v&&this.set("timesDisplay",v);var m=$(".datetime-pickers-list"),_=this.get("isAllDay");if(m.find("input[data-role='commontimepicker']").each(function(){$(this).data("kendoCommonTimePicker").enable(!_)}),_){if(0<u.length){var f=new Date(E().startOf("day")),T=new Date(E().endOf("day")),C=u[0];A.editLoadReady&&(!E(f).isSame(E(C.startTime),"time")&&!E(T).isSame(E(C.endTime),"time")||2<=u.length)&&(C.startTime=f,C.endTime=T,J.set("times",[C]))}m.find(".datetime-timepickers .bt.minus").hasClass("disabled")||m.find(".datetime-timepickers .bt.minus").addClass("disabled")}else m.find(".datetime-timepickers .bt.minus").removeClass("disabled");1==u.length?m.find(".datetime-timepickers .bt.minus").addClass("disabled"):_||m.find(".datetime-timepickers .bt.minus").removeClass("disabled");var g=this.get("daysOfWeek"),O=[],I=g.mon?"Mon":"";for(I&&O.push(I),(I=g.tue?"Tue":"")&&O.push(I),(I=g.wed?"Wed":"")&&O.push(I),(I=g.thu?"Thu":"")&&O.push(I),(I=g.fri?"Fri":"")&&O.push(I),(I=g.sat?"Sat":"")&&O.push(I),(I=g.sun?"Sun":"")&&O.push(I),i=O.length,t=0;t<i;t++)O[t]=h.prop("FACILITY_SCHEDULE_"+O[t].toUpperCase());this.set("daysOfWeekJoin",O.join(", "));return this.daysOfWeek.get("mon")||this.daysOfWeek.get("tue")||this.daysOfWeek.get("wed")||this.daysOfWeek.get("thu")||this.daysOfWeek.get("fri")||this.daysOfWeek.get("sat")||this.daysOfWeek.get("sun")},daysOfWeeksArr:["sun","mon","tue","wed","thu","fri","sat"],disableDaysOfWeek:function(e,t){6<e&&(e%=7);var i=this.daysOfWeeksArr[e];this.daysOfWeekDisabled.set(i,t),t&&this.daysOfWeek.get(i)?this.daysOfWeek.set(i,!1):t||this.daysOfWeek.get(i)||this.daysOfWeek.set(i,!0)},isAlarmLog:!1,alarmRadioChecked:"Warning",operation:{indoor:{init:function(){var e=this;e.power.set("disabled",!1),e.power.set("checked",!1),e.power.set("active",!1),e.operation.set("checked",!1);var t,i,a=e.operation.mode,o=a.length;for(t=0;t<o;t++)a[t].set("active",!1);e.temperature.set("checked",!1),e.temperature.set("desired",Y),e.temperature.set("unit",r),e.temperature.set("step",s),e.waterTemp.set("checked",!1),e.waterTemp.set("desired",H),e.waterTemp.set("unit",r),e.waterTemp.set("step",s);var n=e.power.beforeValue;for(i in n)n[i]=null},setDisabled:function(){this.init(),this.power.set("disabled",!0)},power:{disabled:!1,checked:!1,active:!1,text:function(){return Z.call(this)},click:function(){var e=this.operation.indoor,t=e.power.get("active");e.power.set("active",!t)},beforeValue:{powerActive:null,operationChecked:null,auto:null,cool:null,heat:null,dry:null,fan:null,coolSt:null,hotWater:null,waterChecked:null,temperChecked:null},checkClick:function(e){var t=this.operation.indoor,i=t.power.beforeValue;if($(e.target).prop("checked")){null!==i.powerActive?(t.power.set("active",i.powerActive),i.powerActive=null):t.power.set("active",!0),null!==i.operationChecked?(t.operation.set("checked",i.operationChecked),i.operationChecked=null):t.operation.set("checked",!0);var a=!1;null!==i.auto&&(t.operation.mode[0].set("active",i.auto),a=!0,i.auto=null),null!==i.cool&&(t.operation.mode[1].set("active",i.cool),a=!0,i.cool=null),null!==i.heat&&(t.operation.mode[2].set("active",i.heat),a=!0,i.heat=null),null!==i.dry&&(t.operation.mode[3].set("active",i.dry),a=!0,i.dry=null),null!==i.fan&&(t.operation.mode[4].set("active",i.fan),a=!0,i.fan=null),null!==i.coolSt&&(t.operation.mode[5].set("active",i.coolSt),a=!0,i.coolSt=null),null!==i.hotWater&&(t.operation.mode[6].set("active",i.hotWater),a=!0,i.hotWater=null),a||t.operation.mode[0].set("active",!0),null!==i.temperChecked?(t.temperature.set("checked",i.temperChecked),i.temperChecked=null):t.temperature.set("checked",!0),null!==i.waterChecked?(t.waterTemp.set("checked",i.waterChecked),i.waterChecked=null):t.waterTemp.set("checked",!0)}else i.powerActive=t.power.get("active"),t.power.get("active")&&t.power.set("active",!1),i.operationChecked=t.operation.get("checked"),i.auto=t.operation.mode[0].get("active"),i.cool=t.operation.mode[1].get("active"),i.heat=t.operation.mode[2].get("active"),i.dry=t.operation.mode[3].get("active"),i.fan=t.operation.mode[4].get("active"),i.coolSt=t.operation.mode[5].get("active"),i.hotWater=t.operation.mode[6].get("active"),t.operation.get("checked")&&(t.operation.set("checked",!1),t.operation.mode[0].set("active",!1),t.operation.mode[1].set("active",!1),t.operation.mode[2].set("active",!1),t.operation.mode[4].set("active",!1),t.operation.mode[5].set("active",!1),t.operation.mode[6].set("active",!1)),i.temperChecked=t.temperature.get("checked"),t.temperature.get("checked")&&t.temperature.set("checked",!1),i.waterChecked=t.waterTemp.get("checked"),t.waterTemp.get("checked")&&t.waterTemp.set("checked",!1)}},operation:{checked:!1,active:!1,checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.indoor,a=i.power.beforeValue,o=i.operation.mode;t?(null!==a.auto&&(i.operation.mode[0].set("active",a.auto),a.auto=null),null!==a.cool&&(i.operation.mode[1].set("active",a.cool),a.cool=null),null!==a.heat&&(i.operation.mode[2].set("active",a.heat),a.heat=null),null!==a.dry&&(i.operation.mode[3].set("active",a.dry),a.dry=null),null!==a.fan&&(i.operation.mode[4].set("active",a.fan),a.fan=null),null!==a.coolSt&&(i.operation.mode[5].set("active",a.coolSt),a.coolSt=null),null!==a.hotWater&&(i.operation.mode[6].set("active",a.hotWater),a.hotWater=null)):(a.auto=o[0].get("active"),a.cool=o[1].get("active"),a.heat=o[2].get("active"),a.dry=o[3].get("active"),a.fan=o[4].get("active"),a.coolSt=o[5].get("active"),a.hotWater=o[6].get("active"),o[0].get("active")&&o[0].set("active",!1),o[1].get("active")&&o[1].set("active",!1),o[2].get("active")&&o[2].set("active",!1),o[3].get("active")&&o[3].set("active",!1),o[4].get("active")&&o[4].set("active",!1),o[5].get("active")&&o[5].set("active",!1),o[6].get("active")&&o[6].set("active",!1),i.temperature.get("checked")&&i.temperature.set("checked",!1),i.waterTemp.get("checked")&&i.waterTemp.set("checked",!1))},mode:[{active:!1,name:"Auto",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[0].get("active");if(t[0].set("active",!i),t[1].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),t[4].set("active",!1),t[5].set("active",!1),t[6].set("active",!1),e.checkTempActive(i),!i){var a=l?64:18,o=l?86:30;e.temperature.set("min",a),e.temperature.set("max",o),a=l?59:15,o=l?176:80,e.waterTemp.set("min",a),e.waterTemp.set("max",o)}}},{active:!1,name:"Cool",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[1].get("active");if(t[1].set("active",!i),t[0].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),t[4].set("active",!1),t[5].set("active",!1),t[6].set("active",!1),e.checkTempActive(i),!i){var a=l?64:18,o=l?86:30;e.temperature.set("min",a),e.temperature.set("max",o),a=l?14:-10,o=l?77:25,e.waterTemp.set("min",a),e.waterTemp.set("max",o)}}},{active:!1,name:"Heat",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[2].get("active");if(t[2].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[3].set("active",!1),t[4].set("active",!1),t[5].set("active",!1),t[6].set("active",!1),e.checkTempActive(i),!i){var a=l?61:16,o=l?86:30;e.temperature.set("min",a),e.temperature.set("max",o),a=l?59:15,o=l?176:80,e.waterTemp.set("min",a),e.waterTemp.set("max",o)}}},{active:!1,name:"Dry",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[3].get("active");if(t[3].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[2].set("active",!1),t[4].set("active",!1),t[5].set("active",!1),t[6].set("active",!1),e.checkTempActive(i),!i){var a=l?64:18,o=l?86:30;e.temperature.set("min",a),e.temperature.set("max",o),a=l?59:15,o=l?176:80,e.waterTemp.set("min",a),e.waterTemp.set("max",o)}}},{active:!1,name:"Fan",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[4].get("active");t[4].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),t[5].set("active",!1),t[6].set("active",!1),e.checkTempActive(!i)}},{active:!1,name:"CoolStorage",click:function(){var e=this.operation.indoor,t=this.operation.indoor.operation.mode,i=t[5].get("active");if(t[5].set("active",!i),t[0].set("active",!1),t[2].set("active",!1),t[1].set("active",!1),t[3].set("active",!1),t[4].set("active",!1),t[6].set("active",!1),e.checkTempActive(i),!i){var a=l?64:18,o=l?86:30;e.temperature.set("min",a),e.temperature.set("max",o),a=l?14:-10,o=l?77:25,e.waterTemp.set("min",a),e.waterTemp.set("max",o)}}},{active:!1,name:"HeatStorage",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[6].get("active");if(t[6].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),t[4].set("active",!1),t[5].set("active",!1),e.checkTempActive(i),!i){var a=l?64:18,o=l?86:30;e.temperature.set("min",a),e.temperature.set("max",o),a=l?59:15,o=l?176:80,e.waterTemp.set("min",a),e.waterTemp.set("max",o)}}}]},checkTempActive:function(e){e&&(this.temperature.get("checked")&&this.temperature.set("checked",!1),this.waterTemp.get("checked")&&this.waterTemp.set("checked",!1))},temperature:{checked:!1,desired:Y,min:P,max:V,unit:r,step:s},waterTemp:{checked:!1,desired:Y,min:P,max:V,unit:r,step:s}},ventilator:{init:function(){var e,t=this;t.power.set("disabled",!1),t.power.set("checked",!1),t.power.set("active",!1),t.operation.set("checked",!1),t.operation.mode[0].set("active",!1),t.operation.mode[1].set("active",!1),t.operation.mode[2].set("active",!1),t.operation.mode[3].set("active",!1);var i=t.power.beforeValue;for(e in i)i[e]=null},setDisabled:function(){this.init(),this.power.set("disabled",!0)},power:{disabled:!1,checked:!1,active:!1,text:function(){return Z.call(this)},click:function(){var e=this.operation.ventilator.power.get("active");this.operation.ventilator.power.set("active",!e)},beforeValue:{powerActive:null,operationChecked:null,auto:null,heatex:null,bypass:null,sleep:null},checkClick:function(e){var t=this.operation.ventilator,i=t.power.beforeValue;if($(e.target).prop("checked")){null!==i.powerActive?(t.power.set("active",i.powerActive),i.powerActive=null):t.power.set("active",!0),null!==i.operationChecked?(t.operation.set("checked",i.operationChecked),i.operationChecked=null):t.operation.set("checked",!0);var a=!1;null!==i.auto&&(t.operation.mode[0].set("active",i.auto),a=!0,i.auto=null),null!==i.heatex&&(t.operation.mode[1].set("active",i.heatex),a=!0,i.heatex=null),null!==i.bypass&&(t.operation.mode[2].set("active",i.bypass),a=!0,i.bypass=null),null!==i.sleep&&(t.operation.mode[3].set("active",i.sleep),a=!0,i.sleep=null),a||t.operation.mode[0].set("active",!0)}else i.powerActive=t.power.get("active"),t.power.get("active")&&t.power.set("active",!1),i.operationChecked=t.operation.get("checked"),i.auto=t.operation.mode[0].get("active"),i.heatex=t.operation.mode[1].get("active"),i.bypass=t.operation.mode[2].get("active"),i.sleep=t.operation.mode[3].get("active"),t.operation.get("checked")&&(t.operation.set("checked",!1),t.operation.mode[0].set("active",!1),t.operation.mode[1].set("active",!1),t.operation.mode[2].set("active",!1),t.operation.mode[3].set("active",!1))}},operation:{active:!1,checked:!1,checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.ventilator,a=i.power.beforeValue;if(t)null!==a.auto&&(i.operation.mode[0].set("active",a.auto),a.auto=null),null!==a.heatex&&(i.operation.mode[1].set("active",a.heatex),a.heatex=null),null!==a.bypass&&(i.operation.mode[2].set("active",a.bypass),a.bypass=null),null!==a.sleep&&(i.operation.mode[3].set("active",a.sleep),a.sleep=null);else{var o=i.operation.mode;a.auto=o[0].get("active"),a.heatex=o[1].get("active"),a.bypass=o[2].get("active"),a.sleep=o[3].get("active"),o[0].get("active")&&o[0].set("active",!1),o[1].get("active")&&o[1].set("active",!1),o[2].get("active")&&o[2].set("active",!1),o[3].get("active")&&o[3].set("active",!1)}},mode:[{active:!1,name:"Auto",click:function(){var e=this.operation.ventilator.operation.mode,t=e[0].get("active");e[0].set("active",!t),e[1].set("active",!1),e[2].set("active",!1),e[3].set("active",!1)}},{active:!1,name:"HeatEx",click:function(){var e=this.operation.ventilator.operation.mode,t=e[1].get("active");e[1].set("active",!t),e[0].set("active",!1),e[2].set("active",!1),e[3].set("active",!1)}},{active:!1,name:"Bypass",click:function(){var e=this.operation.ventilator.operation.mode,t=e[2].get("active");e[2].set("active",!t),e[0].set("active",!1),e[1].set("active",!1),e[3].set("active",!1)}},{active:!1,name:"Sleep",click:function(){var e=this.operation.ventilator.operation.mode,t=e[3].get("active");e[3].set("active",!t),e[0].set("active",!1),e[1].set("active",!1),e[2].set("active",!1)}}]}},dhw:{init:function(){var e,t=this;t.power.set("disabled",!1),t.power.set("checked",!1),t.power.set("active",!1),t.operation.set("checked",!1),t.operation.mode[0].set("active",!1),t.operation.mode[1].set("active",!1),t.operation.mode[2].set("active",!1),t.operation.mode[3].set("active",!1),t.temperature.set("checked",!1),t.temperature.set("desired",W),t.temperature.set("unit",r),t.temperature.set("step",s);var i=t.power.beforeValue;for(e in i)i[e]=null},setDisabled:function(){this.init(),this.power.set("disabled",!0)},power:{disabled:!1,checked:!1,active:!1,text:function(){return Z.call(this)},click:function(){var e=this.operation.dhw.power.get("active");this.operation.dhw.power.set("active",!e)},beforeValue:{powerActive:null,operationChecked:null,eco:null,standard:null,power:null,force:null,temperChecked:null},checkClick:function(e){var t=this.operation.dhw,i=t.power.beforeValue;if($(e.target).prop("checked")){null!==i.powerActive?(t.power.set("active",i.powerActive),i.powerActive=null):t.power.set("active",!0),null!==i.operationChecked?(t.operation.set("checked",i.operationChecked),i.operationChecked=null):t.operation.set("checked",!0);var a=!1;null!==i.eco&&(t.operation.mode[0].set("active",i.eco),a=!0,i.eco=null),null!==i.standard&&(t.operation.mode[1].set("active",i.standard),a=!0,i.standard=null),null!==i.power&&(t.operation.mode[2].set("active",i.power),a=!0,i.power=null),null!==i.force&&(t.operation.mode[3].set("active",i.force),a=!0,i.force=null),a||t.operation.mode[1].set("active",!0),null!==i.temperChecked?(t.temperature.set("checked",i.temperChecked),i.temperChecked=null):t.temperature.set("checked",!0)}else i.powerActive=t.power.get("active"),t.power.get("active")&&t.power.set("active",!1),i.operationChecked=t.operation.get("checked"),i.eco=t.operation.mode[0].get("active"),i.standard=t.operation.mode[1].get("active"),i.power=t.operation.mode[2].get("active"),i.force=t.operation.mode[3].get("active"),t.operation.get("checked")&&(t.operation.set("checked",!1),t.operation.mode[0].set("active",!1),t.operation.mode[1].set("active",!1),t.operation.mode[2].set("active",!1),t.operation.mode[3].set("active",!1)),i.temperChecked=t.temperature.get("checked"),t.temperature.get("checked")&&t.temperature.set("checked",!1)}},operation:{active:!1,checked:!1,checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.dhw,a=i.power.beforeValue;if(t)null!==a.eco&&(i.operation.mode[0].set("active",a.eco),a.eco=null),null!==a.standard&&(i.operation.mode[1].set("active",a.standard),a.standard=null),null!==a.power&&(i.operation.mode[2].set("active",a.power),a.power=null),null!==a.force&&(i.operation.mode[3].set("active",a.force),a.force=null);else{var o=i.operation.mode;a.operationChecked=i.operation.get("checked"),a.eco=i.operation.mode[0].get("active"),a.standard=i.operation.mode[1].get("active"),a.power=i.operation.mode[2].get("active"),a.force=i.operation.mode[3].get("active"),o[0].get("active")&&o[0].set("active",!1),o[1].get("active")&&o[1].set("active",!1),o[2].get("active")&&o[2].set("active",!1),o[3].get("active")&&o[3].set("active",!1),i.temperature.get("checked")&&i.temperature.set("checked",!1)}},mode:[{active:!1,name:"Eco",click:function(){var e=this.operation.dhw,t=e.operation.mode,i=t[0].get("active");t[0].set("active",!i),t[1].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),e.checkTempActive(i)}},{active:!1,name:"Standard",click:function(){var e=this.operation.dhw,t=e.operation.mode,i=t[1].get("active");t[1].set("active",!i),t[0].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),e.checkTempActive(i)}},{active:!1,name:"Power",click:function(){var e=this.operation.dhw,t=e.operation.mode,i=t[2].get("active");t[2].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[3].set("active",!1),e.checkTempActive(i)}},{active:!1,name:"Force",click:function(){var e=this.operation.dhw,t=e.operation.mode,i=t[3].get("active");t[3].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[2].set("active",!1),e.checkTempActive(i)}}]},checkTempActive:function(e){e&&this.temperature.get("checked")&&this.temperature.set("checked",!1)},temperature:{checked:!1,desired:W,min:G,max:B,unit:r,step:s}},remoteControl:{disabled:!1,checked:!1,init:function(){var e=this;e.set("disabled",!1),e.set("checked",!1),e.control[0].set("active",!1),e.control[1].set("active",!1),e.control[2].set("active",!1)},setDisabled:function(){this.init(),this.set("disabled",!0)},checkClick:function(){var e=this.operation.remoteControl.control,t=this.operation.remoteControl.get("checked");e[0].set("active",!t),e[1].get("active")&&e[1].set("active",!1),e[2].get("active")&&e[2].set("active",!1)},control:[{active:!1,name:"Allowed",click:function(){var e=this.operation.remoteControl.control,t=e[0].get("active");e[0].set("active",!t),e[1].set("active",!1),e[2].set("active",!1)}},{active:!1,name:"NotAllowed",click:function(){var e=this.operation.remoteControl.control,t=e[1].get("active");e[1].set("active",!t),e[0].set("active",!1),e[2].set("active",!1)}},{active:!1,name:"ConditionallyAllowed",click:function(){var e=this.operation.remoteControl.control,t=e[2].get("active");e[2].set("active",!t),e[1].set("active",!1),e[0].set("active",!1)}}]},point:{aoav:{disable:!1,checked:!1,value:"0.0",min:0,max:100,decimals:1,init:function(){this.set("disabled",!1),this.set("checked",!1),this.set("value","0.0")},setDisabled:function(){this.init(),this.set("disabled",!0)}},dodv:{disable:!1,checked:!1,active:!1,beforeValue:{active:null},text:function(){return Z.call(this)},click:function(){var e=this.operation.point.dodv,t=e.get("active");e.set("active",!t)},checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.point.dodv,a=i.beforeValue;t?null!==a.active?(i.set("active",a.active),a.active=null):i.set("active",!0):(a.active=i.get("active"),i.get("active")&&i.set("active",!1))},init:function(){var e;this.set("disabled",!1),this.set("checked",!1),this.set("active",!1);var t=this.beforeValue;for(e in t)t[e]=null},setDisabled:function(){this.init(),this.set("disabled",!0)}}},light:{disabled:!1,power:{beforeValue:{active:null},disabled:!1,checked:!1,active:!1,text:function(){return Z.call(this)},click:function(){var e=this.operation.light,t=e.power.get("active");e.power.set("active",!t)},checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.light,a=i.power.beforeValue;t?null!==a.active?(i.power.set("active",a.active),a.active=null):i.power.set("active",!0):(a.active=i.power.get("active"),i.power.get("active")&&i.power.set("active",!1))}},checked:!1,value:50,slide:function(e){this.operation.light.set("value",e.value)},init:function(){var e,t=this;t.power.set("active",!1),t.power.set("checked",!1),t.set("checked",!1),t.set("disabled",!1),t.set("value",50);var i=t.power.beforeValue;for(e in i)i[e]=null},setDisabled:function(){this.init(),this.set("disabled",!0)}},pre:{disable:!1,checked:!1,init:function(){var e,t=this;t.set("checked",!1),t.set("disabled",!1),t.set("radioChecked",!1),t.cool.set("value",j),t.cool.set("disabled",!0),t.cool.set("unit",r),t.cool.set("step",s),t.heat.set("value",j),t.heat.set("disabled",!0),t.heat.set("unit",r),t.heat.set("step",s);var i=this.beforeValue;for(e in i)i[e]=null},setDisabled:function(){this.init(),this.set("disabled",!0),this.cool.set("disabled",!0),this.heat.set("disabled",!0)},radioChecked:"PreCooling",beforeValue:{radioChecked:null},checkClick:function(e){var t=this.operation.pre,i=t.beforeValue;if(t.get("checked"))i.radioChecked=t.get("radioChecked"),t.set("radioChecked",!1),t.cool.set("disabled",!0),t.heat.set("disabled",!0);else if(null!==i.radioChecked){t.set("radioChecked",i.radioChecked);var a="PreCooling"==i.radioChecked;t.cool.set("disabled",!a),t.heat.set("disabled",a),i.radioChecked=null}else t.set("radioChecked","PreCooling"),t.cool.set("disabled",!1),t.heat.set("disabled",!0)},change:function(){var e=this.operation.pre;"PreCooling"==e.get("radioChecked")?(e.cool.set("disabled",!1),e.heat.set("disabled",!0)):"PreHeating"==e.get("radioChecked")&&(e.heat.set("disabled",!1),e.cool.set("disabled",!0))},cool:{disabled:!0,value:j,min:X,max:z,unit:r,step:s},heat:{disabled:!0,value:j,min:X,max:z,unit:r,step:s}}},setTempMinMax:function(e,t,i){if(!(t.length<1||i.length<1)){var a,o,n,r,s=t.data("kendoCustomNumericBox"),l=i.data("kendoCustomNumericBox"),d=this.operation.indoor,c=e.field;"operation.indoor.temperature.min"==c?(r=d.temperature.get("checked"),n=d.temperature.get("desired"),a=d.temperature.get("min"),s.min(a),n<a?d.temperature.set("desired",a):r&&(s.enable(!1),s.enable(!0))):"operation.indoor.temperature.max"==c?(r=d.temperature.get("checked"),n=d.temperature.get("desired"),o=d.temperature.get("max"),s.max(o),o<n?d.temperature.set("desired",o):r&&(s.enable(!1),s.enable(!0))):"operation.indoor.waterTemp.min"==c?(r=d.waterTemp.get("checked"),n=d.waterTemp.get("desired"),a=d.waterTemp.get("min"),l.min(a),n<a?d.waterTemp.set("desired",a):r&&(l.enable(!1),l.enable(!0))):"operation.indoor.waterTemp.max"==c&&(r=d.waterTemp.get("checked"),n=d.waterTemp.get("desired"),o=d.waterTemp.get("max"),l.max(o),o<n?d.waterTemp.set("desired",o):r&&(l.enable(!1),l.enable(!0)))}},checkActive:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[0].get("active")||t[1].get("active")||t[2].get("active")||t[3].get("active")||t[5].get("active")||t[6].get("active");e.operation.set("active",i);var a=this.operation.dhw,o=a.operation.mode;i=o[0].get("active")||o[1].get("active")||o[2].get("active")||o[3].get("active"),a.operation.set("active",i)},init:function(){this.set("alarmRadioChecked","Warning"),this.dateTimeInit();var e=this.operation;e.indoor.init(),e.ventilator.init(),e.dhw.init(),e.remoteControl.init();var t=e.point;t.aoav.init(),t.dodv.init(),e.light.init(),e.pre.init()},defaultIndoor:function(){var e=this.operation.indoor;e.power.set("checked",!0),e.power.set("active",!0),e.operation.set("checked",!0),e.operation.mode[0].set("active",!0),e.temperature.set("checked",!0),e.temperature.set("desired",Y)},defaultVentilator:function(){var e=this.operation.ventilator;e.power.set("checked",!0),e.power.set("active",!0),e.operation.set("checked",!0),e.operation.mode[0].set("active",!0)},defaultDhw:function(){var e=this.operation.dhw;e.power.set("checked",!0),e.power.set("active",!0),e.operation.set("checked",!0),e.operation.mode[1].set("active",!0),e.temperature.set("checked",!0),e.temperature.set("desired",W)},defaultRemoteControl:function(){var e=this.operation.remoteControl;e.set("checked",!0),e.control[0].set("active",!0)},defaultControlPoint:function(){var e=this.operation.point;e.aoav.set("checked",!0),e.aoav.set("value","0.0"),e.dodv.set("checked",!0),e.dodv.set("active",!0)},defaultAoav:function(){var e=this.operation.point;e.aoav.set("checked",!0),e.aoav.set("value","0.0")},defaultDodv:function(){var e=this.operation.point;e.dodv.set("checked",!0),e.dodv.set("active",!0)},defaultLight:function(){var e=this.operation.light;e.power.set("checked",!0),e.power.set("active",!0),e.set("checked",!0),e.set("value",50)},defaultPre:function(){var e=this.operation.pre;e.set("checked",!0),e.set("radioChecked","PreCooling"),e.cool.set("value",j),e.cool.set("disabled",!1)},default:function(){this.init(),this.dateTimeDefault()},checkDeviceType:function(e,t){var i,a,o,n,r,s,l,d,c,p=e.length;for(o=0;o<p&&(-1!=(i=(a=e[o]).type).indexOf("AirConditioner.")?-1!=(i=u.getIndoorType(a)).indexOf("General")?n=!0:-1!=i.indexOf("Ventilator")?r=!0:-1!=i.indexOf("DHW")&&(s=!0):-1!=i.indexOf("Light")?l=!0:-1!=i.indexOf("AO")||-1!=i.indexOf("AV")?d=!0:-1==i.indexOf("DO")&&-1==i.indexOf("DV")||(c=!0),!(n&&r&&s&&l&&d&&c));o++);n?(this.operation.indoor.init(),this.operation.pre.init(),this.operation.remoteControl.init(),t||(this.defaultIndoor(),this.defaultPre(),this.defaultRemoteControl())):(this.operation.indoor.setDisabled(),this.operation.pre.setDisabled(),this.operation.remoteControl.setDisabled()),r?(this.operation.ventilator.init(),t||this.defaultVentilator()):this.operation.ventilator.setDisabled(),s?(this.operation.dhw.init(),t||this.defaultDhw()):this.operation.dhw.setDisabled(),d?(this.operation.point.aoav.init(),t||this.defaultAoav()):this.operation.point.aoav.setDisabled(),c?(this.operation.point.dodv.init(),t||this.defaultDodv()):this.operation.point.dodv.setDisabled(),l?(this.operation.light.init(),t||this.defaultLight()):this.operation.light.setDisabled()},isValid:function(e){var t=!1,i=this.isDateTimeValid(e);if(this.get("isAlarmLog"))return i;var a=this.operation,o=a.indoor;if((t=o.power.get("checked"))&&i)return t;if((t=o.operation.get("checked")&&(o.operation.mode[0].get("active")||o.operation.mode[1].get("active")||o.operation.mode[2].get("active")||o.operation.mode[3].get("active")||o.operation.mode[4].get("active")||o.operation.mode[5].get("active")||o.operation.mode[6].get("active")))&&i)return t;if((t=o.temperature.get("checked"))&&i)return t;var n=a.ventilator;if((t=n.power.get("checked"))&&i)return t;if((t=n.operation.get("checked")&&(n.operation.mode[0].get("active")||n.operation.mode[1].get("active")||n.operation.mode[2].get("active")||n.operation.mode[3].get("active")))&&i)return t;var r=a.dhw;if((t=r.power.get("checked"))&&i)return t;if((t=r.operation.get("checked")&&(r.operation.mode[0].get("active")||r.operation.mode[1].get("active")||r.operation.mode[2].get("active")||r.operation.mode[3].get("active")))&&i)return t;if((t=r.temperature.get("checked"))&&i)return t;var s=a.remoteControl;if((t=s.get("checked")&&(s.control[0].get("active")||s.control[1].get("active")||s.control[2].get("active")))&&i)return t;var l=a.point;if((t=l.aoav.get("checked")||this.operation.point.dodv.get("checked"))&&i)return t;if((t=l.aoav.get("checked")||this.operation.point.dodv.get("checked"))&&i)return t;var d=a.pre;if((t=d.get("checked")&&(!d.cool.get("disabled")||!d.heat.get("disabled")))&&i)return t;var c=a.light;return t=c.power.get("checked")||c.get("checked")},validation:function(){}}),q=v.observable({isAlarmLog:!1,alarmType:"",alarmTypeText:"",name:"",description:"",remoteControl:"",startDate:"",endDate:"",selectedNum:0,exceptionalDays:[],daysOfWeek:[],daysOfWeekJoin:"",executionTimes:[],rules:[],control:{operations:[],modes:[],temperatures:[],configuration:{remoteControl:""}},hasRemoteControl:!1,hasAoPoint:!1,hasDoPoint:!1,isAllDay:!0,legendType:[!1,!1,!1,!1,!1],legendTypeText:"SAC Indoor",remoteControlText:"",init:function(){this.set("name",""),this.set("description",""),this.set("remoteControl",""),this.set("alarmType",""),this.set("startDate",""),this.set("endDate",""),this.set("selectedNum",0),this.set("exceptionalDays",[]),this.set("rules",[]),this.set("daysOfWeek",[]),this.set("daysOfWeekJoin",""),this.set("executionTimes",[]),this.control.set("operations",[]),this.control.set("modes",[]),this.control.set("temperatures",[]),this.control.configuration.set("remoteControl",""),this.set("hasRemoteControl",!1),this.set("hasAoControl",!1),this.set("hasDoControl",!1),this.set("isAllDay",!0)},setLegendType:function(e){var t,i=o.getEventTemplateType(e),a=this.legendType.length;for(t=0;t<a;t++)this.set("legendType["+t+"]",!1);void 0!==i.type&&null!==i.type&&this.set("legendType["+i.type+"]",!0),i.text&&this.set("legendTypeText",i.text)},setRemoteControlText:function(){var e=this.control.configuration.get("remoteControl");e&&(e="Allowed"==e?h.prop("FACILITY_INDOOR_REMOTE_CONTROL_ENABLE"):h.prop("FACILITY_INDOOR_REMOTE_CONTROL_DISABLE"),this.set("remoteControlText",e))}}),Z=function(){var e=this.get("active"),t=this.get("checked"),i="";return i=e?h.prop("FACILITY_ON"):h.prop("FACILITY_OFF"),t||(i=h.prop("FACILITY_ON_OFF")),i};return{Views:{map:{view:null,widget:null,routeUrl:"/map",show:null},list:{selected:{routeUrl:"/list/selected",view:null,widget:null},floor:{routeUrl:"/list/floor",view:null,widget:null},group:{routeUrl:"/list/group",view:null,widget:null},show:null},condition:{routeUrl:"/condition",view:null,widget:null,show:null,name:h.prop("FACILITY_RULE_CONDITION_SETTING")},operation:{routeUrl:"/operation",view:null,widget:null,show:null,name:h.prop("FACILITY_SCHEDULE_OPERATION_SETTING")},creation:{routeUrl:"/creation",view:null,widget:null,show:null,name:h.prop("FACILITY_SCHEDULE_CREATION_SETTING")}},MainViewModel:A,ConditionViewModel:U,OperationViewModel:J,CreationViewModel:q,typeFilterDataSource:f,typeFilterText:T,typeQuery:["AirConditioner.*","ControlPoint.AO","ControlPoint.DO","Beacon","Gateway","Light","CCTV"],statusDataSource:L}}),define("operation/rule/view-model/rule-vm",[],function(){var e=window.kendo,t=window.I18N;return{MainViewModel:e.observable({searchField:{invisible:!1,value:"",click:function(){},keydown:function(){}},actions:[{type:"template",id:"spanSelectedCount",template:"<span class='text-view'><span data-bind='text: options.selectedText'></span></span>",options:{selectedText:t.prop("FACILITY_RULE_MESSAGE_INFO_NONE_SELECT_RULE")}},{type:"button",id:"rule-create-btn",text:t.prop("COMMON_BTN_CREATE"),invisible:!1,disabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"rule-edit-btn",text:t.prop("COMMON_BTN_EDIT"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"rule-delete-btn",text:t.prop("COMMON_BTN_DELETE"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"rule-detail-btn",text:t.prop("COMMON_BTN_DETAIL"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}}]})}}),define("operation/rule/rule-create",["operation/core","operation/rule/view-model/rule-create-vm","operation/rule/model/rule-model","device/common/device-template","device/common/device-util","operation/rule/common/common","operation/rule/common/widget","operation/group/config/group-model","device/common/device-model","operation/rule/model/rule-alarm-model"],function(e,p,j,d,S,i,n,t,a,o){"use strict";function r(e,t,i){Le=!0,(Ae=i)?F.disableFloorNav(!0):F.disableFloorNav(!1),Ee=t,M.open();var a=(f=P.data("kendoCommonTabStrip")).select();Te.actions[de].options.click(),Te.actions[de].options.click(),Te.actions[de].options.click(),B.find("li").removeClass("enabled"),Ce.init(),ge.init(),Oe.init(),Te.set("isAlarmLog",i),ge.set("isAlarmLog",i),Oe.set("isAlarmLog",i),k&&k.selectAll(),e&&!t?(Ie=!0,Te.actions[ue].set("text",R.prop("COMMON_BTN_SAVE")),A=e,i?a.find("a.text").text(R.prop("FACILITY_RULE_EDIT_RULE_ALARM_LOG")):a.find("a.text").text(R.prop("FACILITY_RULE_EDIT_RULE_CONTROL"))):(Ie=!1,Te.actions[ue].set("text",R.prop("COMMON_BTN_CREATE")),i?a.find("a.text").text(R.prop("FACILITY_RULE_CREATE_NEW_RULE_ALARM_LOG")):a.find("a.text").text(R.prop("FACILITY_RULE_CREATE_NEW_RULE_CONTROL")),t?(he=!0,A=e):(he=!1,A=j.createModel(),Ce.default(),ge.default(),Te.set("editLoadReady",!0))),Te.set("isEdit",Ie);var o=F.getCurrentFloor();if(ee){var n=fe.list.selected.widget.dataSource;return n.data([]),(n=fe.list.floor.widget.dataSource).data([]),(n=fe.list.group.widget.dataSource).data([]),(n=fe.map.widget.dataSource).data([]),Pe(o)}var r=f.contentElement(0);return X.bind($(r),Te),Ye(),T=$(r).find(".schedule-create-content .schedule-content-block"),De(),ee=!0,q=Ne(),Pe(o)}function c(){Te.filters[ne].set("disabled",!0),x.setOptions({optionLabel:R.prop("FACILITY_DEVICE_TYPE_SUB")});var e=new X.data.DataSource({data:[]});x.setDataSource(e)}function s(e){return t.createDataSource(e,null,!0)}function l(e){var t,i,a=q.length;for(t=0;t<a;t++)if(-1!=(i=q[t]).indexOf(e))return i}function u(e){if(!e)return[];var t,i,a,o=[],n=e.length;for(a=0;a<n;a++)(t=e[a]).locations&&!t.locations[0]&&(t.locations[0]={}),t.selected=!1,i=z.getDetailDisplayType(t.mappedType||t.type,!0),i=l(i),t.displayType=i,t=new b(t),o.push(t);return o}function v(e){var d=new $.Deferred,t="/dms/groups/"+e+"/listView";return $.ajax({url:t}).done(function(e){var i,a,t=e.devices,o=t.length,n=[];for(i=0;i<o;i++)-1==(a=t[i].dms_devices_type).indexOf("AirConditioner.")&&-1==a.indexOf("ControlPoint")&&-1==_e.indexOf(a)||n.push(t[i].dms_devices_id);var r=F.getCurrentFloor(),s=Ue(r);if(s+="ids="+n.join(","),0<n.length)$.ajax({url:"/dms/devices"+s}).done(function(e){var t;for(o=e.length,i=o-1;0<=i;i--)a=e[i].type,"ControlPoint"!=(t=e[i].mappedType)&&(a=t||a),-1==a.indexOf("AirConditioner.")&&-1==_e.indexOf(a)&&e.splice(i,1);d.resolve(e)}).fail(function(e){d.reject(e)});else{var l=R.prop("FACILITY_RULE_CREATE_GROUP_SELECT_NONE_ERROR");Y.message(l),Y.open(),d.reject("")}}).fail(function(e){d.reject(e)}),d.promise()}function m(){F.disableFloorNav(!1),Te.filters[oe].set("invisible",!1),Te.filters[ne].set("invisible",!1),Te.filters[re].set("invisible",!1),Te.filters[se].set("invisible",!0);var e=F.getCurrentFloor();e.floor.id==F.FLOOR_NAV_FLOOR_ALL_ID||e.building.id==F.FLOOR_NAV_BUILDING_TOTAL_ID?Te.mapBtn.set("disabled",!0):Te.mapBtn.set("disabled",!1),Te.listBtn.set("disabled",!1)}function _(){F.disableFloorNav(!0),Te.mapBtn.set("disabled",!0),Te.mapBtn.set("active",!1),Te.listBtn.set("disabled",!0),Te.listBtn.set("active",!1),Te.category.set("invisible",!0),Te.filters[oe].set("invisible",!0),Te.filters[ne].set("invisible",!0),Te.filters[re].set("invisible",!0),Te.filters[se].set("invisible",!1)}function h(e,t){var i,a,o,n,r,s,l,d=p.statusDataSource,c=t;for(i in d)for(o=(n=d[i]).length,a=0;a<o;a++)if(e==n[a].value){if(e=n[a].text,r=n[a].valueList){for(l=r.length,s=0;s<l;s++)r[s].value==t&&(c=r[s].text);return{statusText:e,valueText:c}}return{statusText:e,valueText:t}}return{statusText:e,valueText:t}}function I(e){var t=Ce.rules;e.condition||(e.condition={}),e.condition.rules||(e.condition.rules=[]);var i,a,o,n,r,s,l,d,c,p,u,v,m,_,f,T,C,g=t.length,O=[];for(i=0;i<g;i++){if((n={devices:[]}).order=i+1,(v=(r=t[i]).calculation.options.get("value"))instanceof X.data.ObservableObject&&(v=v.value),n.calculation=v,(m=r.comparison.options.get("value"))instanceof X.data.ObservableObject&&(m=m.value),"="==m&&(m="=="),n.operator=m,(_=r.status.options.get("value"))instanceof X.data.ObservableObject&&(n.statusText=_.text,_=_.value),"alarms-alarms_name"!==_&&1<(C=_.split("_")).length&&(_=C[0]),n.monitor=_,r.valueList.get("invisible"))if(r.valueTemperature.get("invisible"))if(r.valueInput.get("invisible"))Ee&&te&&(f=r.valueList.get("value")||r.valueTemperature.get("value")||r.valueInput.get("value"));else{var I=r.valueInput.get("value");-1!==String(I).indexOf(".")&&(I=z.convertNumberFormat(I)),f="controlPoint-value"===_?String(I):I}else f=r.valueTemperature.get("value");else f=r.valueList.get("value");if(f instanceof X.data.ObservableObject&&(n.valueText=f.text,f=f.value),n.value=f,!n.statusText||!n.valueText){var E=h(_,f);n.statusText=n.statusText?n.statusText:E.statusText,n.valueText=n.valueText?n.valueText:E.valueText}for((T=r.duration.options.get("value"))instanceof X.data.ObservableObject&&(T=T.value),n.duration=T,p=r.get("isAnd"),u=r.get("isOr"),i!=g-1&&(p?n.logicOpr="AND":u&&(n.logicOpr="OR")),o=r.devices.length,a=0;a<o;a++)(s=(c=r.devices[a]).id.get("value"))instanceof X.data.ObservableObject?(d=s.name,l=s.type,s=s.id):(l=c.id.get("type"),d=c.id.get("name")),l=z.getGeneralType(l),n.devices.push({dms_devices_id:s,dms_devices_type:l,dms_devices_name:d});O.push(n)}e.condition.rules=O}function E(e){nt(e);var t,i,a,o,n,r=ge.get("daysOfWeek"),s=ge.get("times"),l=[],d=r.mon?"Mon":"";d&&l.push(d),(d=r.tue?"Tue":"")&&l.push(d),(d=r.wed?"Wed":"")&&l.push(d),(d=r.thu?"Thu":"")&&l.push(d),(d=r.fri?"Fri":"")&&l.push(d),(d=r.sat?"Sat":"")&&l.push(d),(d=r.sun?"Sun":"")&&l.push(d),e.daysOfWeek=l;var c=[];if(s)for(i=s.length,t=0;t<i;t++)o=s[t].startTime,n=s[t].endTime,o instanceof Date&&(o=J(o).format("HH:mm")),n instanceof Date&&(n=J(n).format("HH:mm")),c.push({startTime:o,endTime:n});e.set("times",c);var p,u,v=fe.list.floor.widget.dataSource.data(),m=new X.data.Query(v).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray();i=m.length;var _=[];for(t=0;t<i;t++)a={},u=m[t],a.dms_devices_id=u.id,a.dms_devices_name=u.name,p=u.type,p=z.getGeneralType(p),a.dms_devices_type=p,u.locations&&u.locations[0]&&(a.location=u.locations[0].description),_.push(a);e.devices=_,Ae&&(e.alarmType||(e.alarmType={}),e.alarmType=ge.get("alarmRadioChecked")),e.control||(e.control={});var f,T=ge.operation,C=T.indoor,g=T.ventilator,O=T.dhw,I=T.light,E=[];C.power.checked&&(a={id:rt.indoor},C.power.active?a.power="On":a.power="Off",E.push(a)),g.power.checked&&(a={id:rt.ventilator},g.power.active?a.power="On":a.power="Off",E.push(a)),O.power.checked&&(a={id:rt.dhw},O.power.active?a.power="On":a.power="Off",E.push(a));var h={dms_devices_type:"AirConditioner.Indoor",control:{}};0<E.length&&(h.control.operations=E);var A={dms_devices_type:"Light",control:{}},L=[];I.power.checked&&((a={id:"General"}).power=I.power.active?"On":"Off",L.push(a),A.control.operations=L,E=E.concat(L)),0<E.length?e.control.operations=E:delete e.control.operations;var D,b=[];if(C.operation.checked)for(i=(f=C.operation.mode).length,t=0;t<i;t++)f[t].active&&(a={id:rt.indoor,mode:f[t].name},b.push(a));if(g.operation.checked)for(i=(f=g.operation.mode).length,t=0;t<i;t++)f[t].active&&(a={id:rt.ventilator,mode:f[t].name},b.push(a));if(O.operation.checked)for(i=(f=O.operation.mode).length,t=0;t<i;t++)f[t].active&&(a={id:rt.dhw,mode:f[t].name},b.push(a));0<b.length?(e.control.modes=b,h.control.modes=b):delete e.control.modes;var y,N=[];C.temperature.checked&&(D=C.temperature,a={id:rt.indoor.replace(".General",".Room"),desired:D.get("desired")},N.push(a)),C.waterTemp.checked&&(y=C.waterTemp,a={id:rt.indoor.replace(".General",".WaterOutlet"),desired:y.get("desired")},N.push(a)),O.temperature.checked&&(D=O.temperature,a={id:rt.dhw,desired:D.get("desired")},N.push(a)),0<N.length?(e.control.temperatures=N,h.control.temperatures=N):delete e.control.temperatures;var R,S={};if(T.remoteControl.checked)for(i=(R=T.remoteControl.control).length,t=0;t<i;t++)R[t].active&&(S={remoteControl:R[t].name});$.isEmptyObject(S)?delete e.control.configuration:(e.control.configuration=S,h.control.configuration=S);var w,k={dms_devices_type:"ControlPoint.AO",control:{}},x={dms_devices_type:"ControlPoint.DO",control:{}},F={};T.point.aoav.checked&&("number"==typeof(w=T.point.aoav.get("value"))&&(w=w.toString()),F.value=w,k.control.controlPoint=F);var M={};T.point.dodv.checked&&("number"==typeof(w=T.point.dodv.get("active")?1:0)&&(w=w.toString()),M.value=w,x.control.controlPoint=M),$.isEmptyObject(F)?delete e.control.aoControlPoint:e.control.aoControlPoint=F,$.isEmptyObject(M)?delete e.control.doControlPoint:e.control.doControlPoint=M;var U=[];T.light.checked?(w=T.light.get("value"),U.push({id:1,dimmingLevel:w}),e.control.lights=U,A.control.lights=U):delete e.control.lights;var Y=T.pre.cool.get("disabled")&&T.pre.heat.get("disabled");if(T.pre.checked&&!Y){e.algorithm||(e.algorithm={}),e.algorithm.enabled=!0;var P=T.pre.get("radioChecked");"PreCooling"==P?(e.algorithm.mode=P,w=T.pre.cool.get("value"),e.algorithm.preCoolingTemperature=w):"PreHeating"==P&&(e.algorithm.mode=P,w=T.pre.heat.get("value"),e.algorithm.preHeatingTemperature=w)}var V,H=e.deviceTypes;if(H){if(i=H.length,$.isEmptyObject(h.control))for(t=i-1;0<=t;t--)-1!=H[t].dms_devices_type.indexOf("AirConditioner.Indoor")&&H.splice(t,1);else{for(V=null,t=0;t<i;t++)if(-1!=H[t].dms_devices_type.indexOf("AirConditioner.Indoor")){H[t].control=h.control,V=H[t].control;break}V||e.deviceTypes.push(h)}if(i=H.length,$.isEmptyObject(A.control))for(t=i-1;0<=t;t--)-1!=H[t].dms_devices_type.indexOf("Light")&&H.splice(t,1);else{for(V=null,t=0;t<i;t++)if(-1!=H[t].dms_devices_type.indexOf("Light")){H[t].control=A.control,V=H[t].control;break}V||e.deviceTypes.push(A)}if(i=H.length,$.isEmptyObject(k.control))for(t=i-1;0<=t;t--)-1!=H[t].dms_devices_type.indexOf("ControlPoint.AO")&&H.splice(t,1);else{for(V=null,t=0;t<i;t++)if(-1!=H[t].dms_devices_type.indexOf("ControlPoint.AO")){H[t].control=k.control,V=H[t].control;break}V||e.deviceTypes.push(k)}if(i=H.length,$.isEmptyObject(x.control))for(t=i-1;0<=t;t--)-1!=H[t].dms_devices_type.indexOf("ControlPoint.DO")&&H.splice(t,1);else{for(V=null,t=0;t<i;t++)if(-1!=H[t].dms_devices_type.indexOf("ControlPoint.DO")){H[t].control=x.control,V=H[t].control;break}V||e.deviceTypes.push(x)}}}var f,A,T,w,C,g,O,L,D,k,x,b=a.Device,X=window.kendo,F=window.MAIN_WINDOW,z=window.Util,y=window.CommonLoadingPanel,N=window.GlobalSettings,J=window.moment,R=window.I18N,M=new y,U=n.confirmDialog,Y=n.msgDialog,P=$("#rule-create-tab"),V=$("#rule-create-view"),H=new X.Router,W=new X.Layout("<div id='rule-view-content' class='schedule-view-content'></div>"),G=$("#map-panel"),B=$(".schedule-create-step-list"),q=[],Z=[],Q=[],K=[],ee=!1,te=!1,ie=!1,ae="",oe=0,ne=1,re=2,se=3,le=0,de=1,ce=2,pe=3,ue=4,ve=0,me=1,_e=["Light","ControlPoint.AO","ControlPoint.DO"],fe=p.Views,Te=p.MainViewModel,Ce=p.ConditionViewModel,ge=p.OperationViewModel,Oe=p.CreationViewModel,Ie=!1,Ee=!1,he=!1,Ae=!1,Le=!1,De=function(){k=$("#"+Te.filters[oe].id).data("kendoDropDownCheckBox"),x=$("#"+Te.filters[ne].id).data("kendoDropDownList"),k.selectAll(),k.bind("selectionChanged",function(e){var t,i,a,o=e.newValue.length;if(o==p.typeFilterDataSource.length)c(),e.newValue="All";else if(1<o||0==o)c();else{t=(t=e.newValue[0]).replace(".","");var n=z.getDeviceTypeList(t,!0);if("ControlPoint"==t){for(i=(a=n.length)-1;0<=i;i--)"AV"==n[i].displayType?n.splice(i,1):"DV"==n[i].displayType&&n.splice(i,1);n.reverse()}if("AirConditioner"==t)for(a=n.length,n=$.extend(!0,[],n),i=a-1;0<=i;i--)"AirConditioner.SFCU"==n[i].type&&n.splice(i,1),"AirConditioner.FCU"==n[i].type&&(n[i].type="AirConditioner.FCU,AirConditioner.SFCU");if(1==n.length&&n[0].type==t||n.length<1)c();else{var r=p.typeFilterText[t],s=R.prop("COMMON_ALL")+" "+r+" "+R.prop("FACILITY_DEVICE_TYPE"),l=new X.data.DataSource({data:n});l.read(),c(),Te.filters[ne].set("disabled",!1),x.setOptions({optionLabel:{displayType:s,type:"All"}}),x.setDataSource(l)}}ye(null,e.newValue)}),Te.filters[ne].options.set("select",function(e){console.info(e),e.dataItem&&ye(null,null,e.dataItem.type)}),Te.filters[re].options.set("click",Qe),Te.mapBtn.set("click",function(){1!=Te.mapBtn.get("active")&&(ae="map",Te.category.set("invisible",!0),H.navigate(fe.map.routeUrl),Ve(ae),Te.filters[oe].get("disabled")&&(Te.filters[oe].set("disabled",!1),x.value()&&Te.filters[ne].set("disabled",!1)))}),Te.listBtn.set("click",function(){1!=Te.listBtn.get("active")&&(ae="list",Te.category.set("invisible",!1),Te.category.selected.click(!0),Ve(ae))}),B.on("click","li",function(){var e=$(this);if(e.hasClass("enabled")){var t=e.data("view");e.siblings("li").removeClass("active"),e.addClass("active");var i=e.prev(),a=e.next();if(i.length<1?Te.actions[de].set("disabled",!0):Te.actions[de].set("disabled",!1),a.length<1?(Te.actions[pe].set("invisible",!0),Te.actions[ue].set("invisible",!1)):(Te.actions[ue].set("invisible",!0),Te.actions[pe].set("invisible",!1),Te.actions[pe].set("disabled",!1)),"map"==t){var o=F.getCurrentFloor();o.floor.id==F.FLOOR_NAV_FLOOR_ALL_ID||o.building.id==F.FLOOR_NAV_BUILDING_TOTAL_ID?(Te.mapBtn.set("disabled",!0),Te.listBtn.click()):(Te.mapBtn.set("disabled",!1),Te.mapBtn.click())}else if(H.navigate(fe[t].routeUrl),Ve(t),"operation"===t&&!Ie){var n=$("#exceptionalList");n.removeClass("active"),n.slideUp()}}}),Te.actions[de].options.set("click",function(){var e=B.find("li.active"),t=e.prev();if(0<t.length){var i=t.data("view");if(e.removeClass("active"),t.addClass("active"),t.prev().length<1?Te.actions[de].set("disabled",!0):Te.actions[de].set("disabled",!1),Te.actions[ue].set("invisible",!0),Te.actions[pe].set("invisible",!1),"map"==i){var a=F.getCurrentFloor();a.floor.id==F.FLOOR_NAV_FLOOR_ALL_ID||a.building.id==F.FLOOR_NAV_BUILDING_TOTAL_ID?(Te.mapBtn.set("disabled",!0),Te.listBtn.click()):(Te.mapBtn.set("disabled",!1),Te.mapBtn.click())}else H.navigate(fe[i].routeUrl),Ve(i)}}),Te.actions[pe].options.set("click",function(){var e=B.find("li.active"),t=e.next();if(0<t.length){var i=t.data("view");if(e.removeClass("active"),t.addClass("active"),t.addClass("enabled"),t.next().length<1?(Te.actions[pe].set("invisible",!0),Te.actions[ue].set("invisible",!1)):Te.actions[pe].set("disabled",!1),Te.actions[de].set("disabled",!1),H.navigate(fe[i].routeUrl),"operation"===i&&!Ie){var a=$("#exceptionalList");a.removeClass("active"),a.slideUp()}Ve(i)}}),Te.actions[ce].options.set("click",function(){M.open(),$.ajax({url:"/rules"}).done(function(e){var t;Ae?(t=o.createDataSource(e,j.Model),O.setDataSource(t),O.open()):(t=j.createDataSource(e,j.Model),g.setDataSource(t),g.open())}).fail(function(){var e=j.createDataSource(j.MockData,j.Model);g.setDataSource(e),g.open()}).always(function(){M.close()})}),g.bind("onChecked",function(e){var t=e.sender.BTN;e.sender.setActions(t.SELECT,{disabled:!1})}),O.bind("onChecked",function(e){var t=e.sender.BTN;e.sender.setActions(t.SELECT,{disabled:!1})}),g.bind("onSelect",function(e){var t=e.result;g.close(),et(),r(t,!0,Ae).always(function(){te=!0,Te.actions[pe].options.click(),Te.actions[pe].options.click(),Te.actions[pe].options.click(),Te.actions[de].options.click(),Te.actions[de].options.click(),Te.actions[de].options.click(),te=!1})}),O.bind("onSelect",function(e){var t=e.result;O.close(),et(),r(t,!0,Ae).always(function(){te=!0,Te.actions[pe].options.click(),Te.actions[pe].options.click(),Te.actions[pe].options.click(),Te.actions[de].options.click(),Te.actions[de].options.click(),te=!1})}),fe.list.selected.widget.bind("change",Ze),fe.list.floor.widget.bind("change",Ze),fe.list.group.widget.bind("change",qe),fe.map.widget.bind("change",Ze),Te.category.selected.set("click",function(e){if(1!=Te.category.selected.get("active")||e){Te.category.selected.set("active",!0),Te.category.all.set("active",!1),Te.category.group.set("active",!1),F.disableFloorNav(!1),H.navigate(fe.list.selected.routeUrl);var t=fe.list.selected.widget.dataSource;ie=!1,Te.filters[oe].set("disabled",!0),x.value()&&Te.filters[ne].set("disabled",!0),t.group([]),ye()}}),Te.category.all.set("click",function(){if(1!=Te.category.all.get("active")){Te.category.all.set("active",!0),Te.category.selected.set("active",!1),Te.category.group.set("active",!1),F.disableFloorNav(!1),H.navigate(fe.list.floor.routeUrl);var e=fe.list.floor.widget.dataSource;ie=!0,Te.filters[oe].set("disabled",!1),x.value()&&Te.filters[ne].set("disabled",!1),e.group([]),ye()}}),Te.category.group.set("click",function(){if(1!=Te.category.group.get("active")){Te.category.all.set("active",!1),Te.category.selected.set("active",!1),Te.category.group.set("active",!0),F.disableFloorNav(!0),H.navigate(fe.list.group.routeUrl);var e=fe.list.group.widget.dataSource;ie=!1,Te.filters[oe].set("disabled",!0),x.value()&&Te.filters[ne].set("disabled",!0),e.group([]),ye()}}),Te.actions[ue].options.set("click",function(){if($("#schedule-create-name").data("kendoCommonValidator").validate()&&$("#schedule-create-description").data("kendoCommonValidator").validate()){var r="";r=Ie?Ae?R.prop("FACILITY_RULE_MESSAGE_CONFIRM_EDIT_RULE_ALARM_LOG"):R.prop("FACILITY_RULE_MESSAGE_CONFIRM_EDIT_RULE"):Ae?R.prop("FACILITY_RULE_MESSAGE_CONFIRM_CREATE_RULE_ALARM_LOG"):R.prop("FACILITY_RULE_MESSAGE_CONFIRM_CREATE_RULE"),U.message(r),U.setConfirmActions({yes:function(){M.open(),lt(A);for(var e=A.toJSON(),t=0;t<e.times.length;t++)e.times[t].startTime=e.times[t].startTime+":00",e.times[t].endTime=e.times[t].endTime+":00";if(e.control&&delete e.control,e.description||delete e.description,nt(e,!0),Ae?(delete e.control,delete e.devices,delete e.deviceTypes):e.alarmType="None",Ie){for(var i=e.condition.rules.length,a=0;a<i;a++)for(var o=e.condition.rules[a].devices.length,n=0;n<o;n++)void 0!==e.condition.rules[a].devices[n].dms_devices_name&&delete e.condition.rules[a].devices[n].dms_devices_name,void 0!==e.condition.rules[a].devices[n].dms_devices_type&&delete e.condition.rules[a].devices[n].dms_devices_type,void 0!==e.condition.rules[a].devices[n].location&&delete e.condition.rules[a].devices[n].location;void 0!==e.title&&delete e.title,void 0!==e.checked&&delete e.checked,void 0!==e.created&&delete e.created,void 0!==e.updated&&delete e.updated,void 0!==e.alarmType&&delete e.alarmType,$.ajax({url:"/rules/"+e.id,method:"PATCH",data:e}).done(function(){r="";var e="operation/rule/rule";Ae?(r=R.prop("FACILITY_RULE_MESSAGE_CONFIRM_RULE_ALARM_LOG_CREATION_EDIT"),e="operation/rule/rule-alarm"):r=R.prop("FACILITY_RULE_MESSAGE_CONFIRM_RULE_CONTROL_CREATION_EDIT"),Y.message(r),Y.open(),require([e],function(e){e.closeCreateBtnEvt()})}).fail(function(e){r=400==e.status||500==e.status?R.prop("FACILITY_RULE_CALCULATION_ERROR"):z.parseFailResponse(e),Y.message(r),Y.open()}).always(function(){M.close()})}else void 0!==e.id&&delete e.id,ut(e),$.ajax({url:"/rules",method:"POST",data:e}).done(function(){r="";var e="operation/rule/rule";Ae?(r=R.prop("FACILITY_RULE_MESSAGE_CONFIRM_RULE_ALARM_LOG_CREATION"),e="operation/rule/rule-alarm"):r=R.prop("FACILITY_RULE_MESSAGE_CONFIRM_RULE_CONTROL_CREATION"),Y.message(r),Y.open(),require([e],function(e){e.closeCreateBtnEvt()})}).fail(function(e){r=400==e.status||500==e.status?R.prop("FACILITY_RULE_CALCULATION_ERROR"):z.parseFailResponse(e),Y.message(r),Y.open()}).always(function(){M.close()})}}),U.open()}}),fe.list.selected.widget.element.on("click","tbody tr td .ic-info",tt),fe.list.floor.widget.element.on("click","tbody tr td .ic-info",tt),fe.list.group.widget.element.on("click","tbody tr td .ic-info",it),w.element.on("click","tbody tr td .ic-info",tt),e.on("onfloorchange",Pe),T.on("click",".rule-condition .add-rule-btn",function(){Ce.addRule(),console.info("add rule"),console.info(Ce.rules)}),T.on("click",".rule-condition .remove-rule-btn",function(){var e=$(this).closest(".rule-condition").index();Ce.removeRule(e)}),T.on("click",".rule-condition .add-device-btn",function(){var e=$(this).closest(".rule-condition").index();Ce.addDevice(e)}),T.on("click",".rule-condition .remove-device-btn",function(){var e=$(this).closest(".rule-condition-device"),t=e.index(),i=e.closest(".rule-condition").index();Ce.removeDevice(i,t)}),T.on("keyup","#schedule-create-name",function(){var e,t,i=$(this),a=(i.val(),$("#schedule-create-description"));a.val();e=i.data("kendoCommonValidator").validate(),t=a.data("kendoCommonValidator").validate(),e=e&&t,Te.actions[ue].set("disabled",!e)}),T.on("keyup","#schedule-create-description",function(){var e,t,i=$(this),a=(i.val(),$("#schedule-create-name"));a.val();e=a.data("kendoCommonValidator").validate(),t=i.data("kendoCommonValidator").validate(),e=e&&t,Te.actions[ue].set("disabled",!e)}),T.on("click",".schedule-datetime .createFrm .tb .arr",function(){var e=$(this).data("target"),t=$("#"+e);t.hasClass("active")?(t.slideUp(),t.removeClass("active")):(t.slideDown(),t.addClass("active"))}),T.on("click",".datetime-pickers-wrapper .bt.minus",function(){var e=$(this);if(!e.hasClass("disabled")){var t=e.closest(".datetime-timepickers").index(),i=ge.get("times");i.splice(t,1),ge.set("executionTime",i)}}),T.on("click",".datetime-pickers-wrapper .bt.plus",function(){if(!$(this).hasClass("disabled")){var e=ge.get("times"),t={startTime:new Date(J().startOf("day")),endTime:new Date(J().endOf("day"))};e.push(t),ge.set("times",e),1==e.length&&T.find(".schedule-datetime .datetime-pickers-wrapper .bt.minus").addClass("disabled")}}),Ce.bind("change",function(e){if(!Ce.get("isUpdate")&&"isUpdate"!=e.field){var t=this.isValid(e);Te.actions[pe].set("disabled",!t),be(t)}}),ge.bind("change",function(e){!e.field||"operation.indoor.temperature.min"!=e.field&&"operation.indoor.temperature.max"!=e.field&&"operation.indoor.waterTemp.min"!=e.field&&"operation.indoor.waterTemp.max"!=e.field||this.setTempMinMax(e,$("#indoor-temp"),$("#indoor-water-temp")),this.checkActive();var t=this.isValid(e),i=!1,a=ge.get("times");!a||a.length<1?i=t&&!1:(i=t&&!0,1==a.length?T.find(".schedule-datetime .datetime-pickers-wrapper .bt.minus").addClass("disabled"):T.find(".schedule-datetime .datetime-pickers-wrapper .bt.minus").removeClass("disabled")),t=t&&i;var o=this.isTimePickerValid(e);void 0!==o&&0<o.length&&(t=!1),Te.actions[pe].set("disabled",!t),be(t)})},be=function(e){if(!te){var t=B.find("li.active"),i=t.nextAll("li"),a=t.next("li");0<a.length&&(e?(t.addClass("enabled"),a.addClass("enabled")):(t.removeClass("enabled"),i.removeClass("enabled")))}},ye=function(e,t,i){var a,o,n,r=(e=e||F.getCurrentFloor()).floor,s=e.building;t&&"All"!=t||(t=(t=k.value())?t.split(","):t),i=i||x.value();var l,d,c={logic:"and",filters:[]},p={logic:"and",filters:[]},u=!1,v=!1;("map"==ae&&1==w.selectedIndex||"list"==ae&&ie)&&(v=u=!0);var m=!1;("map"==ae&&0==w.selectedIndex||"list"==ae&&!ie)&&(m=!0),s&&s.id!=F.FLOOR_NAV_BUILDING_TOTAL_ID&&(l=S.filter1Depth("locations","foundation_space_buildings_id",s.id),u&&c.filters.push(l),p.filters.push(l)),r&&r.id!=F.FLOOR_NAV_FLOOR_ALL_ID&&(d=S.filter1Depth("locations","foundation_space_floors_id",r.id),u&&c.filters.push(d),p.filters.push(d));var _={logic:"or",filters:[]};if(t&&0<t.length){for(n=t.length,o=0;o<n;o++)(a=t[o])&&("ControlPoint"!=a&&_.filters.push({field:"type",operator:"contains",value:a}),_.filters.push({field:"mappedType",operator:"contains",value:a}));m||c.filters.push(_),p.filters.push(_)}var f={logic:"and",filters:[]};if(i&&"All"!=i){var T=i.split(",");if(1<T.length){n=T.length;var C={logic:"or",filters:[]};for(o=0;o<n;o++)C.filters.push({field:"type",operator:"eq",value:T[o]});f.filters.push(C)}else f.filters.push({field:"type",operator:"eq",value:i});m||c.filters.push(f),p.filters.push(f)}var g=fe.list.floor.widget.dataSource,O=fe.map.widget.dataSource,I={logic:"and",filters:[{field:"selected",operator:"eq",value:!1}]};m&&c.filters.push({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}),v&&c.filters.push(I);var E,h,A=fe.list.floor.widget,L=fe.list.selected.widget;A.virtualScrollable&&(E=A.virtualScrollable.verticalScrollbar.scrollTop()),L.virtualScrollable&&(h=L.virtualScrollable.verticalScrollbar.scrollTop()),g.filter(c),A.virtualScrollable&&A.virtualScrollable.verticalScrollbar.scrollTop(E),L.virtualScrollable&&L.virtualScrollable.verticalScrollbar.scrollTop(h),"map"==ae&&(w.setDataSource(g,!1,!0,!0),w.tabGrids[w.selectedIndex].dataSource.filter(c),O.filter(p));var D=g.data(),b=new X.data.Query(D).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray();ze(b.length);var y,N=[];s.id!=F.FLOOR_NAV_BUILDING_TOTAL_ID&&(y={logic:"and",filters:[l]},N.push(y)),r.id!=F.FLOOR_NAV_FLOOR_ALL_ID&&(y={logic:"and",filters:[d]},N.push(y)),0<_.filters.length&&N.push(_),0<f.filters.length&&N.push(f),N.push(I);var R=new X.data.Query(D).filter(N).toArray();Je(R.length)},Ne=function(){var e,t,i,a=N.getDeviceTypeOrdering(),o=[],n=a.length;for(i=0;i<n;i++)e=a[i],t=z.getDetailDisplayType(e,!0),o.push(i+"_"+t),"Sensor.Temperature_Humidity"==e&&(o.push(i+"_"+z.getDetailDisplayType("Sensor.Temperature",!0)),o.push(i+"_"+z.getDetailDisplayType("Sensor.Humidity",!0)));return o},Re=function(e){var t=z.parseFailResponse(e);Y.message(t),Y.open()},Se=function(e){var t=new $.Deferred,i=e.floor,a=e.building;if(!i||!i.id||i.id==F.FLOOR_NAV_FLOOR_ALL_ID)return t.resolve([]),t.promise();if(!a||!a.id||a.id==F.FLOOR_NAV_BUILDING_TOTAL_ID)return t.resolve([]),t.promise();var o=Ue(e);return $.ajax({url:"/foundation/space/zones"+o})},we=function(e){var t=new $.Deferred,i=e.building;if(!i||!i.id||i.id==F.FLOOR_NAV_BUILDING_TOTAL_ID)return t.resolve([]),t.promise();var a=Ue(null,!0,["id, name, type"]);return $.ajax({url:"/foundation/space/floors"+a})},ke=function(r,e){var t=new $.Deferred,s=fe.list.floor.widget.dataSource.data(),i=new X.data.Query(s).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray(),a=function(e){var t=[],i=e.devices;if(!i)return[];var a,o,n=i.length;for(a=0;a<n;a++)o=i[a],t.push(o.dms_devices_id);return t}(e);return 0<a.length?$.ajax({url:"/dms/devices?ids="+a.join(",")}).done(function(e){var t,i,a,o,n=e.length;for(s=u(e),t=0;t<n;t++)i=(a=s[t]).id,(o=r.get(i))?o.set("selected",!0):(a.selected=!0,r.add(a))}).fail(Re).always(function(){xe(r,i),t.resolve()}):(xe(r,i),t.resolve()),t.promise()},xe=function(e,t){var i,a,o,n,r=t.length;for(n=0;n<r;n++)a=t[n],(o=e.get(a.id))?o.set("selected",!0):e.add(a);i=e.data(),t=new X.data.Query(i).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray(),ze(t.length)},Fe=function(e){var t=Ue(e);return-1!=t.indexOf("&")&&(t+="&"),t+="registrationStatuses=Registered&",t+="attributes=id,name,type,mappedType,registrationStatus,locations,groups&",t+="types="+p.typeQuery.join(","),$.ajax({url:"/dms/devices"+t}).then(u)},Me=function(e){var t=Ue(e,null,null,!0);return $.ajax({url:"/dms/groups/summary/listView"+t}).then(s)},Ue=function(e,t,i,a){var o="?";if(e){var n=e.building.id,r=e.floor.id;a?n&&n!=F.FLOOR_NAV_BUILDING_TOTAL_ID&&r&&r==F.FLOOR_NAV_FLOOR_ALL_ID&&(o+="foundation_space_buildings_id="+n+"&"):n&&n!=F.FLOOR_NAV_BUILDING_TOTAL_ID&&(o+="foundation_space_buildings_id="+n+"&"),t||r&&r!=F.FLOOR_NAV_FLOOR_ALL_ID&&(o+="foundation_space_floors_id="+r+"&")}return i&&0<i.length&&(o+="attributes="+i.join(",")),o},Ye=function(){var e=[];H.bind("init",je);var t={zoneDataSource:e,dataSource:e,isRegisterView:!0,canDragDeviceIcon:!1,showDeviceValue:!1,showDeviceInfoCheckbox:!1};fe.map.widget=n.createNewWidget("schedule-create-map",X.ui.CommonMapView,t),fe.map.view=new X.View(fe.map.widget.wrapper),H.route(fe.map.routeUrl,Xe.bind(H,fe.map.view));var i={columns:[{field:"id",title:R.prop("FACILITY_DEVICE_DEVICE_ID"),width:100},{field:"name",title:R.prop("FACILITY_DEVICE_DEVICE_NAME"),width:100},{field:"locations",title:R.prop("COMMON_LOCATION"),width:100,template:S.getLocation,sortable:{compare:S.sortableLocation}},{field:"group",title:R.prop("FACILITY_SCHEDULE_CREATE_GROUP"),width:100,template:S.getGroup,sortable:{compare:S.sortableGroup}},{field:"detail",title:R.prop("COMMON_BTN_DETAIL"),width:80,sortable:!1,template:'<span class="ic ic-info" data-id="#: id #"></span>'}],dataSource:[],height:"100%",sortable:!0,filterable:!1,pageable:!1,hasSelectedModel:!0,selectable:"multiple row",scrollable:{virtual:!0}},a={columns:[{field:"dms_groups_name",title:R.prop("FACILITY_GROUP_GROUP_NAME"),width:150},{field:"total",title:R.prop("COMMON_TOTAL"),sortable:!1,resizable:!1,template:function(e){var t,i,a,o=e.deviceTypes;i=o.length;var n=0;for(t=0;t<i;t++)(a=o[t].dms_devices_type)&&-1!=a.indexOf("AirConditioner.")&&o[t].numberOfDevices&&(n+=o[t].numberOfDevices);for(i=_e.length,t=0;t<i;t++)void 0!==e[_e[t]]&&(n+=e[_e[t]]);return n}},{title:R.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR"),field:"AirConditioner",sortable:!1,resizable:!1,template:function(e){var t,i,a,o=e.deviceTypes;i=o.length;var n=0;for(t=0;t<i;t++)(a=o[t].dms_devices_type)&&-1!=a.indexOf("AirConditioner.")&&o[t].numberOfDevices&&(n+=o[t].numberOfDevices);return n}},{title:R.prop("FACILITY_DEVICE_TYPE_LIGHT"),field:"Light",sortable:!1,resizable:!1,template:function(e){var t=0;return void 0!==e.Light&&(t=e.Light),t}},{title:R.prop("FACILITY_DEVICE_TYPE_POINT"),field:"ControlPoint",sortable:!1,resizable:!1,template:function(e){var t=0;return void 0!==e["ControlPoint.AO"]&&(t+=e["ControlPoint.AO"]),void 0!==e["ControlPoint.DO"]&&(t+=e["ControlPoint.DO"]),t}},{field:"detail",title:R.prop("COMMON_BTN_DETAIL"),width:80,sortable:!1,template:'<span class="ic ic-info" data-id="#: dms_groups_id #"></span>'}],dataSource:[],height:"100%",scrollable:!0,groupable:!1,sortable:!0,filterable:!1,resizable:!0,pageable:!1,hasSelectedModel:!0,selectable:"multiple row"};fe.list.selected.widget=n.createNewWidget("schedule-create-selected-list",X.ui.Grid,i),fe.list.selected.view=new X.View(fe.list.selected.widget.wrapper),H.route(fe.list.selected.routeUrl,Xe.bind(H,fe.list.selected.view)),fe.list.floor.widget=n.createNewWidget("rule-create-floor-list",X.ui.Grid,i),fe.list.floor.view=new X.View(fe.list.floor.widget.wrapper),H.route(fe.list.floor.routeUrl,Xe.bind(H,fe.list.floor.view)),fe.list.group.widget=n.createNewWidget("rule-create-group-list",X.ui.Grid,a),fe.list.group.view=new X.View(fe.list.group.widget.wrapper),H.route(fe.list.group.routeUrl,Xe.bind(H,fe.list.group.view)),fe.condition.view=new X.View($("#rule-condition-template"),{model:Ce,evalTemplate:!0}),H.route(fe.condition.routeUrl,Xe.bind(H,fe.condition.view)),fe.operation.view=new X.View($("#schedule-operation-template"),{model:ge,evalTemplate:!0}),H.route(fe.operation.routeUrl,Xe.bind(H,fe.operation.view)),fe.creation.view=new X.View($("#schedule-creation-template"),{model:Oe,evalTemplate:!0}),H.route(fe.creation.routeUrl,Xe.bind(H,fe.creation.view));var o=F.getCurrentFloorName();w=G.kendoDeviceTabGroupGrid({dataSource:[],hasNewDataSource:!1,hasSelectedModel:!0,type:"hybrid",filterTab:[{hideHeader:!0,template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",listStyle:"treeList",widgetOptions:{expand:function(e){var t=fe.list.selected.widget.dataSource,i=e.model;return-1!=i.field.indexOf("displayType")&&w.setDataSourceExpand(i,t,!0),!1}},listOptions:{column:{template:function(e){if(e.treeGroup&&e.field){if(-1!=e.field.indexOf("buildings_id"))return dt(e);if(-1!=e.field.indexOf("floors_id"))return ct(e);if(-1!=e.field.indexOf("displayType"))return pt(e)}return d.mapListRegTemplate(e)}},group:[{field:"locations[0].foundation_space_buildings_id",dir:"desc",aggregates:[{field:"locations[0].foundation_space_buildings_id",aggregate:"count"}]},{field:"locations[0].foundation_space_floors_id",dir:"desc",aggregates:[{field:"locations[0].foundation_space_floors_id",aggregate:"count"}]},{field:"displayType",aggregates:[{field:"displayType",aggregate:"count"}]}]}},{template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",hideHeader:!0,listStyle:"treeList",widgetOptions:{expand:function(e){var t=fe.list.floor.widget.dataSource,i=e.model;return-1!=i.field.indexOf("displayType")&&w.setDataSourceExpand(i,t,!0),!1}},listOptions:{column:{template:function(e){if(e.treeGroup&&e.field){if(-1!=e.field.indexOf("buildings_id"))return dt(e);if(-1!=e.field.indexOf("floors_id"))return ct(e);if(-1!=e.field.indexOf("displayType"))return pt(e)}return d.mapListRegTemplate(e)}},group:[{field:"locations[0].foundation_space_buildings_id",dir:"desc",aggregates:[{field:"locations[0].foundation_space_buildings_id",aggregate:"count"}]},{field:"locations[0].foundation_space_floors_id",dir:"desc",aggregates:[{field:"locations[0].foundation_space_floors_id",aggregate:"count"}]},{field:"displayType",aggregates:[{field:"displayType",aggregate:"count"}]}]}}],tabViewModel:[{name:R.prop("COMMON_SELECTED"),click:function(){},count:0},{name:o,click:function(){},count:0}],activateTab:function(e){var t;k&&x&&ye(),t=0==e.index?fe.list.selected.widget.dataSource:fe.list.floor.widget.dataSource,e.sender.setDataSource(t,!0,!0)},change:Ze}).data("kendoDeviceTabGroupGrid"),C=n.getDeviceDetailPopup(),g=n.getRuleLoadPopup(),O=n.getRuleAlarmLogLoadPopup(),H.start()},Pe=function(e){var n,t,r,i=F.getCurrentFloorName();if(w.tabViewModel[me].set("name",i),Te.category.all.set("text",i),Le)return n=e,t=A,r=new $.Deferred,M.open(),Se(n).done(function(e){fe.map.widget.setFloor(n.floor),fe.map.widget.setZoneDataSource(e),fe.map.widget.setDataSource([])}).fail(Re).always(function(){we(n).done(function(e){Z=e,K=F.getCurrentBuildingList()}).fail(Re).always(function(){Me(n).done(function(e){console.info("group"),console.info(e),Q=e,Te.category.group.set("num",Q.length);var t=new X.data.DataSource({data:Q});t.read(),fe.list.group.widget.setDataSource(t)}).fail(Re).always(function(){Fe(n).done(function(e){var o=new X.data.DataSource({data:e,pageSize:50});o.read(),ke(o,t).done(function(){ot(t).always(function(){var e=n.floor,t=n.building,i=[];if(t&&t.id!=F.FLOOR_NAV_BUILDING_TOTAL_ID&&i.push(S.filter1Depth("locations","foundation_space_buildings_id",t.id)),e&&e.id!=F.FLOOR_NAV_FLOOR_ALL_ID&&i.push(S.filter1Depth("locations","foundation_space_floors_id",e.id)),o.filter(i),fe.list.floor.widget.setDataSource(o),fe.list.selected.widget.setDataSource(o),L&&L.setDataSource(o),t&&t.id!=F.FLOOR_NAV_BUILDING_TOTAL_ID&&e&&e.id!=F.FLOOR_NAV_FLOOR_ALL_ID){var a=o.data();a=a.toJSON(),(a=new X.data.DataSource({data:a})).read(),fe.map.widget.setDataSource(a)}else fe.map.widget.setDataSource(new X.data.DataSource({data:[]}));"map"==ae?w.selectTab(w.selectedIndex,!0):"list"==ae?o.group([]):L&&L.selectTab(L.selectedIndex,!0),n.floor.id==F.FLOOR_NAV_FLOOR_ALL_ID||n.building.id==F.FLOOR_NAV_BUILDING_TOTAL_ID?(Te.mapBtn.set("disabled",!0),Te.listBtn.click()):(Te.mapBtn.set("disabled",!1),"list"==ae?Te.listBtn.click():Te.mapBtn.click()),ye(),Ie?(te=!0,Te.actions[pe].options.click(),Te.actions[pe].options.click(),Te.actions[pe].options.click(),te=!1,Ae?B.find("li:eq(1)").click():B.find("li:eq(0)").click()):Ae&&(te=!0,Te.actions[pe].options.click(),te=!1,B.find("li:eq(1)").click()),M.close(),r.resolve()})}).fail(Re)}).fail(Re)})})}),r.promise()},Ve=function(e){"map"==e?(Te.actions[de].set("disabled",!0),He()):"list"==e?(Te.actions[de].set("disabled",!0),We()):"operation"==e?Be():"condition"==e?Ge():"creation"==e&&$e()},He=function(){m(),w.selectTab(0,!0),Te.mapBtn.set("active",!0),Te.listBtn.set("active",!1),Te.set("hidePanel",!1),Te.set("hideMapPanel",!1),Te.set("hideSchedulePanel",!0),fe.map.widget.invalidateSize(!1)},We=function(){m(),Te.listBtn.set("active",!0),Te.mapBtn.set("active",!1),Te.set("hidePanel",!0),Te.set("hideMapPanel",!1),Te.set("hideSchedulePanel",!1)},Ge=function(){_(),Te.set("hidePanel",!0),Te.set("hideMapPanel",!0),Te.set("hideSchedulePanel",!1),Ce.trigger("change"),Ae?(Te.actions[de].set("disabled",!0),T.closest(".schedule-create-content").find(".text-view").hide()):(Te.actions[de].set("disabled",!1),T.closest(".schedule-create-content").find(".text-view").show())},Be=function(){_(),Te.set("hidePanel",!0),Te.set("hideMapPanel",!0),Te.set("hideSchedulePanel",!1),at(A),ge.trigger("change")},$e=function(){st(A),_(),Te.set("hidePanel",!0),Te.set("hideMapPanel",!0),Te.set("hideSchedulePanel",!0);var a=fe.list.selected.widget.dataSource,o=a.data(),n=new X.data.Query(o).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray();D?L.selectTab(0,!0):((D=$("#schedule-creation-table-grid")).on("click","tbody tr td .ic-info",tt),L=D.kendoDeviceTabGroupGrid({dataSource:a,hasNewDataSource:!1,hideTab:!0,selectable:!1,type:"hybrid",filterTab:[{hideHeader:!0,template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",listStyle:"treeList",widgetOptions:{expand:function(e){var t=e.model;if(-1!=t.field.indexOf("displayType")){a=fe.list.selected.widget.dataSource,o=a.data(),n=new X.data.Query(o).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray();var i=new X.data.DataSource({data:n});i.read(),L.setDataSourceExpand(t,i)}return!1}},listOptions:{column:{template:function(e){if(e.treeGroup&&e.field){if(-1!=e.field.indexOf("buildings_id"))return dt(e);if(-1!=e.field.indexOf("floors_id"))return ct(e);if(-1!=e.field.indexOf("displayType"))return pt(e)}return d.mapListRegTemplate(e)}},filter:{logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]},group:[{field:"displayType",aggregates:[{field:"displayType",aggregate:"count"}]}]}}],tabViewModel:[{name:"",click:function(){},count:0}]}).data("kendoDeviceTabGroupGrid"));var e=new X.data.DataSource({data:n});e.read(),L.setDataSource(e);var t=n.length;Oe.set("selectedNum",t);var i=$("#schedule-create-description"),r=$("#schedule-create-name"),s=r.val(),l=i.val();r.data("kendoCommonValidator").hideMessages(),i.data("kendoCommonValidator").hideMessages(),Ae?(i.prop("required",!0),s&&l?Te.actions[ue].set("disabled",!1):Te.actions[ue].set("disabled",!0)):(i.prop("required",!1),i.data("kendoCommonValidator").validate(),i.data("kendoCommonValidator").hideMessages(),s?Te.actions[ue].set("disabled",!1):Te.actions[ue].set("disabled",!0))},je=function(){H.replace("/create",!0),W.render(V)},Xe=function(t){try{vt(),W.showIn("#rule-view-content",t)}catch(e){W.showIn("#rule-view-content",t)}},ze=function(e){var t=Te.category.all.get("num");"string"==typeof t&&(t=t.replace("+","")),0!=e&&t==e&&Te.filters[re].set("text",i.MSG.TXT_UNSELECT_ALL),e<1?(Te.actions[le].options.set("selectedText",R.prop("FACILITY_DEVICE_NO_SELECTED")),Te.filters[re].set("text",R.prop("COMMON_BTN_SELECT_ALL")),Te.actions[pe].set("disabled",!0),be(!1)):(Te.actions[le].options.set("selectedText",R.prop("FACILITY_DEVICE_SELECTED",e)),Te.filters[re].set("text",R.prop("COMMON_BTN_DESELECT_ALL")),Te.actions[pe].set("disabled",!1),be(!0)),Te.category.selected.set("num",e),w.tabViewModel[ve].set("count",e)},Je=function(e){Te.category.all.set("num",e),w.tabViewModel[me].set("count",e)},qe=function(e){var t=e.item,s=t.dms_groups_id,l=e.item.selected;M.open(),v(s).done(function(e){var t,i,a,o=u(e),n=fe.list.floor.widget.dataSource,r=o.length;for(t=0;t<r;t++)a=o[t],s=a.id,(i=n.get(s))&&(i.selected=l,fe.map.widget.selectDevice(i.id,i.selected));ye()}).fail(function(){t.set("selected",!1)}).always(function(){M.close()})},Ze=function(e){var t=e.sender,i=e.item?[e.item]:e.devices;if(i){var a,o,n,r=t instanceof X.ui.CommonMapView&&"map"==ae,s=i.length,l=fe.list.floor.widget.dataSource;for(o=0;o<s;o++)a=i[o],r||fe.map.widget.selectDevice(a.id,a.selected),(n=l.get(a.id))&&(n.selected=a.selected);ye()}},Qe=function(e){this.get("text")==R.prop("COMMON_BTN_SELECT_ALL")?(Ke(),this.set("text",R.prop("COMMON_BTN_DESELECT_ALL"))):(et(),this.set("text",R.prop("COMMON_BTN_SELECT_ALL")))},Ke=function(){var e,t,i=fe.list.floor.widget.dataSource.data(),a=F.getCurrentFloor(),o=a.building,n=a.floor,r={logic:"and",filters:[]};o&&o.id!=F.FLOOR_NAV_BUILDING_TOTAL_ID&&(e=S.filter1Depth("locations","foundation_space_buildings_id",o.id),r.filters.push(e)),n&&n.id!=F.FLOOR_NAV_FLOOR_ALL_ID&&(t=S.filter1Depth("locations","foundation_space_floors_id",n.id),r.filters.push(t));var s=k.value();s=s?s.split(","):s;var l,d,c,p=x.value(),u={logic:"or",filters:[]};if(s&&"All"!=s&&0<s.length){for(d=s.length,l=0;l<d;l++)(c=s[l])&&("ControlPoint"!=c&&u.filters.push({field:"type",operator:"contains",value:c}),u.filters.push({field:"mappedType",operator:"contains",value:c}));r.filters.push(u)}var v={logic:"and",filters:[]};if(p&&"All"!=p){var m=p.split(",");if(1<m.length){d=m.length;var _={logic:"or",filters:[]};for(l=0;l<d;l++)_.filters.push({field:"type",operator:"eq",value:m[l]});v.filters.push(_)}else v.filters.push({field:"type",operator:"eq",value:p});r.filters.push(v)}var f=new X.data.Query(i).filter(r).toArray();for(d=f.length,l=0;l<d;l++)f[l].selected=!0;fe.map.widget.selectAll(),ye()},et=function(){fe.list.floor.widget.clearSelection(),fe.map.widget.unselectAll(),ye()},tt=function(e){var t=$(this).data("id");M.open(),$.ajax({url:"/dms/devices/"+t}).done(function(e){C.setDataSource([e]),C.open()}).fail(Re).always(function(){M.close()}),C.open()},it=function(e){var t=$(this).data("id");M.open(),v(t).done(function(e){C.setDataSource(e),C.open()}).fail(Re).always(function(){M.close()})},at=function(e){var t,i,a,o,n,r=e.startDate,s=e.endDate,l=e.daysOfWeek,d=e.times;if(l)for(o=l.length,a=0;a<o;a++)n=l[a].toLowerCase(),ge.daysOfWeek.set(n,!0);if(r&&(t=new Date(r),ge.startDate=t,ge.set("startDateDisplay",z.convertDateFormat(t)),ge.set("startDate",r)),s){(i=new Date(s)).getFullYear()==j.MAX_END_DATE_YEAR&&(i=new Date(t.getFullYear(),t.getMonth()+1,t.getDate()),ge.set("isEndless",!0));var c=z.convertDateFormat(i);ge.endDate=i,ge.set("endDateDisplay",c),ge.set("endDate",c)}if(d){var p=d.toJSON();o=p.length;var u,v,m,_,f=[];for(a=0;a<o;a++)u=p[a].startTime,v=p[a].endTime,m=new Date,_=u.split(":"),console.info(_),m.setHours(_[0]),m.setMinutes(_[1]),m.setSeconds(0),u=m,_=v.split(":"),(m=new Date).setHours(_[0]),m.setMinutes(_[1]),m.setSeconds(0),console.info(_),v=m,f.push({startTime:u,endTime:v});ge.set("times",f),Ie&&!ge.get("isAllDayValue")&&ge.set("isAllDay",!1)}else{t=new Date,i=new Date,t=J(t).set({hour:0,minute:0,second:0}).format("HH:mm:ss"),i=J(i).set({hour:23,minute:59,second:59}).format("HH:mm:ss"),ge.get("times").push({startTime:t,endTime:i}),ge.set("isAllDay",!0),ge.set("isAllDayValue",!0)}if(Ae){var T=e.alarmType;T&&ge.set("alarmRadioChecked",T)}else{var C,g,O,I=e.deviceTypes,E={operations:[],temperatures:[],modes:[],configuration:{},aoControlPoint:{},doControlPoint:{},lights:[]};if(I)for(o=I.length,a=0;a<o;a++)(g=(C=I[a]).control)&&(g.operations&&((O=g.operations)instanceof X.data.ObservableArray&&(O=O.toJSON()),E.operations=E.operations.concat(O)),g.temperatures&&((O=g.temperatures)instanceof X.data.ObservableArray&&(O=O.toJSON()),E.temperatures=E.temperatures.concat(O)),g.modes&&((O=g.modes)instanceof X.data.ObservableArray&&(O=O.toJSON()),E.modes=E.modes.concat(O)),g.configuration&&(E.configuration=g.configuration),-1!=C.dms_devices_type.indexOf("AO")&&g.controlPoint&&(E.aoControlPoint=g.controlPoint),-1!=C.dms_devices_type.indexOf("DO")&&g.controlPoint&&(E.doControlPoint=g.controlPoint),g.lights&&(E.lights=g.lights));e.control=E;var h,A,L,D,b,y,N,R,S,w,k=e.control,x=e.algorithm,F=k.operations,M=k.temperatures,U=k.modes,Y=k.configuration,P=k.aoControlPoint,V=k.doControlPoint,H=k.lights,W={"AirConditioner.Indoor":"indoor","AirConditioner.Indoor.Room":"indoor","AirConditioner.Indoor.Room.Auto":"indoor","AirConditioner.Indoor.Room.Heat":"indoor","AirConditioner.Indoor.Room.Cool":"indoor","AirConditioner.Indoor.General":"indoor","AirConditioner.Indoor.WaterOutlet":"indoor","AirConditioner.Indoor.DHW":"dhw","AirConditioner.DHW":"dhw","AirConditioner.Indoor.Ventilator":"ventilator",ControlPoint:"point","ControlPoint.AO":"point.aoav","ControlPoint.AV":"point.aoav","ControlPoint.DO":"point.dodv","ControlPoint.DV":"point.dodv",General:"light"},G=ge.operation;if(F)for(o=F.length,a=0;a<o;a++)n=W[L=(A=F[a]).id],h=A.power,G[n]&&!G[n].power.get("disabled")&&(h&&G[n].power.set("checked",h),"On"==h&&G[n].power.set("active",h));if(U)for(o=U.length,a=0;a<o;a++)if(n=W[L=(A=U[a]).id],D=A.mode,G[n]&&(N=G[n].operation),N&&!G[n].power.get("disabled")&&("light"!=n||!G[n].get("disabled")))for(R=(b=N.mode).length,y=0;y<R;y++)b[y].name==D&&(G[n].operation.set("checked",!0),b[y].set("active",!0));if(M)for(o=M.length,a=0;a<o;a++)n=W[L=(A=M[a]).id],S=A.desired,G[n]&&!G[n].power.get("disabled")&&(-1!=L.indexOf("Water")?(G[n].waterTemp.set("checked",!0),G[n].waterTemp.set("desired",S)):(G[n].temperature.set("checked",!0),G[n].temperature.set("desired",S)));if(P&&null!==P.value&&void 0!==P.value&&(G.point.aoav.get("disabled")||(G.point.aoav.set("checked",!0),G.point.aoav.set("value",P.value))),V&&null!==V.value&&void 0!==V.value&&!G.point.dodv.get("disabled")){G.point.dodv.set("checked",!0);var B=1==V.value;G.point.dodv.set("active",B)}if(H&&0<H.length&&(H=H[0],G.light.get("disabled")||(G.light.set("checked",!0),G.light.set("value",H.dimmingLevel))),Y&&Y.remoteControl&&(w=Y.remoteControl,!G.remoteControl.get("disabled")))for(G.remoteControl.set("checked",!0),o=G.remoteControl.control.length,a=0;a<o;a++)if(w==G.remoteControl.control[a].name){G.remoteControl.set("checked",!0),G.remoteControl.control[a].set("active",!0);break}x&&!G.pre.get("disabled")&&(x.enabled&&G.pre.set("checked",!0),"PreCooling"==x.mode?(G.pre.cool.set("value",x.preCoolingTemperature),G.pre.cool.set("disabled",!1)):"PreHeating"==x.mode&&(G.pre.heat.set("value",x.preHeatingTemperature),G.pre.heat.set("disabled",!1)),G.pre.set("radioChecked",x.mode))}},ot=function(t){return t.title&&!t.name&&(t.name=t.title),t.end&&(t.endDate=t.end),t.start&&(t.startDate=t.start),function(e){var t=new $.Deferred,i=e.condition;if(i&&i.rules&&0<i.rules.length&&(Ie||he)){var a,o,n,r,s,l=[],d=[],c=i.rules,p=c.length;for(c.sort(function(e,t){return e.order-t.order}),n=0;n<p;n++)for(s=(o=(a=c[n]).devices).length,r=0;r<s;r++)l.push(o[r].dms_devices_id);M.open(),Te.set("editLoadReady",!1),Te.set("notRegistered",!1),$.ajax({url:"/dms/devices?ids="+l.join(",")}).done(function(e){for(var t=0;t<e.length;t++)"NotRegistered"===e[t].registrationStatus&&Te.set("notRegistered",!0);d=e,(d=new X.data.DataSource({data:e})).read()}).fail(Re).always(function(){for(Ce.set("isUpdate",!0),n=0;n<p;n++)a=c[n],Ce.updateRule(a,d);setTimeout(function(){},4e3),M.close(),t.resolve()})}else t.resolve();return t.promise()}(t).always(function(){var e;(e=t).description&&Oe.set("description",e.description),e.name&&Oe.set("name",e.description)})},nt=function(e){var t=ge.startDate;t=J(t).format("YYYY-MM-DD");var i=ge.endDate,a=ge.isEndless,o=ge.isAllDay;i=J(i).format("YYYY-MM-DD"),e.startDate=t,e.endDate=i,a&&(e.endDate=j.MAX_END_DATE),o&&(e.times=null)},rt={indoor:"AirConditioner.Indoor.General",ventilator:"AirConditioner.Indoor.Ventilator",dhw:"AirConditioner.Indoor.DHW",point:"ControlPoint"},st=function(e){I(e),E(e),Ie||(e.activated=!0);var t=A.startDate,i=A.endDate,a=A.name,o=A.description;Oe.set("name",a),Oe.set("description",o);var n=$("#schedule-create-name");n.val(a),Ae?n.attr("placeholder",R.prop("FACILITY_RULE_ENTER_RULE_ALARM_NAME")):n.attr("placeholder",R.prop("FACILITY_RULE_ENTER_RULE_NAME"));var r=$("#schedule-create-description");r.data("kendoCommonValidator")||r.kendoCommonValidator({type:r.data("type")}),r.val(o);var s=A.condition.rules?A.condition.rules:[];Oe.set("rules",s),Oe.set("startDate",t),Oe.set("endDate",i),Oe.set("startDateDisplay",z.convertDateFormat(t));var l=i?z.convertDateFormat(i):R.prop("FACILITY_SCHEDULE_ENDLESS");if(Oe.set("endDateDisplay",l),Oe.set("daysOfWeek",A.daysOfWeek),A.daysOfWeek){var d,c=$.extend(!0,[],A.daysOfWeek),p=c.length;for(d=0;d<p;d++)c[d]=R.prop("FACILITY_SCHEDULE_"+c[d].toUpperCase());Oe.set("daysOfWeekJoin",c.join(", "))}A.times.sort();var u=A.times.toJSON();Oe.set("executionTimes",u);var v=ge.get("isAllDay");if(Oe.set("isAllDay",v),Ae){var m=A.alarmType;Oe.set("alarmType",m),Oe.set("alarmTypeText",R.prop("FACILITY_DEVICE_STATUS_"+m.toUpperCase()))}var _=A.control.operations?A.control.operations:[];Oe.set("control.operations",_);var f=A.control.modes?A.control.modes:[];Oe.set("control.modes",f);var T=A.control.temperatures?A.control.temperatures:[];Oe.set("control.temperatures",T);var C=A.control.configuration?A.control.configuration:{};Oe.set("hasRemoteControl",!$.isEmptyObject(C)),Oe.set("control.configuration",C),Oe.setRemoteControlText();var g=A.control.aoControlPoint?A.control.aoControlPoint:{};Oe.set("hasAoPoint",!$.isEmptyObject(g)),Oe.set("control.aoControlPoint",g),g=A.control.doControlPoint?A.control.doControlPoint:{},Oe.set("hasDoPoint",!$.isEmptyObject(g)),Oe.set("control.doControlPoint",g);var O=A.control.lights?A.control.lights:[];Oe.set("control.lights",O)},lt=function(e){I(e);var t,i,a,o,n=e.condition;if(n&&n.rules){var r,s=(t=n.rules).length;for(r=0;r<s;r++)t[r].duration||(t[r].duration="P0M"),delete t[r].statusText,delete t[r].valueText}E(e),i=e,a=$("#schedule-create-name").val(),o=$("#schedule-create-description").val(),i.name=a,i.description=o};var dt=function(e){var t=e.value,i="-";if(t){var a,o,n=K.length;for(a=0;a<n;a++)if((o=K[a]).id==t){i=o.name;break}}var r=e.aggregates;return r&&r["locations[0].foundation_space_buildings_id"]&&r["locations[0].foundation_space_buildings_id"].count&&(i+=" ("+r["locations[0].foundation_space_buildings_id"].count+")"),i},ct=function(e){var t=e.value,i="-";if(t){var a,o,n=Z.length;for(a=0;a<n;a++)if((o=Z[a]).id==t){i="F"==o.type?o.name+o.type:"B"==o.type?o.type+o.name:o.name;break}}var r=e.aggregates;return r&&r["locations[0].foundation_space_floors_id"]&&r["locations[0].foundation_space_floors_id"].count&&(i+=" ("+r["locations[0].foundation_space_floors_id"].count+")"),i},pt=function(e){var t=e.value,i="-";t&&(t=t.split("_"),i=z.getDetailDisplayTypeDeviceI18N(t[1]));var a=e.aggregates;return a&&a.displayType&&a.displayType.count&&(i+=" ("+a.displayType.count+")"),i},ut=function(e){for(var t in e)null===e[t]&&delete e[t];return!0};function vt(){var e=$("#schedule-create-start-time-input"),t=$("#schedule-create-end-time-input");e.data("kendoCommonDatePicker")&&e.data("kendoCommonDatePicker").close(),t.data("kendoCommonDatePicker")&&t.data("kendoCommonDatePicker").close()}return{init:r,destroy:function(){},setEditState:function(e){Le=e},getEditState:function(){return Le},isRuleAlarm:function(){return Ae},closeDatePicker:vt}}),define("operation/rule/rule-alarm",["operation/core","operation/rule/view-model/rule-alarm-vm","operation/rule/model/rule-alarm-model","operation/rule/common/common","operation/rule/common/widget","operation/rule/template/rule-template","operation/rule/rule-create"],function(e,t,a,i,o,d,n){function r(e){1==b&&e?O.actions[2].set("disabled",!e):O.actions[2].set("disabled",!0),O.actions[3].set("disabled",!e),O.actions[4].set("disabled",!e)}var s,l,c,p,u,v,m=window.kendo,_=window.CommonLoadingPanel,f=window.Util,T=window.MAIN_WINDOW,C=window.I18N,g=new _,O=t.MainViewModel,I=$("#rule-create-tab"),E=$("#rule-alarm-control-list"),h=o.msgDialog,A=o.confirmDialog,L=[],D=!1,b=0,y=function(){l=(l=I.data("kendoCommonTabStrip"))||I.kendoCommonTabStrip().data("kendoCommonTabStrip"),u=$("#rule-alarm-close-create"),v=$("#rule-alarm-close-search")},N=function(e){var t=a.createDataSource(e,a.Model);K(t),p=o.getRuleAlarmDetailPopup()},R=function(){s.bind("activate",function(e){var t=$(e.item).index();0==t?T.disableFloorNav(!1):1==t&&(T.disableFloorNav(!0),J())}),O.actions[1].options.set("click",H),O.actions[2].options.set("click",W),O.actions[3].options.set("click",B),O.actions[4].options.set("click",j),c.element.on("click",".ic.ic-info",function(){var e=$(this).data("id"),t=c.dataSource.get(e);p.setDataSource(t),p.setDialogType("single"),p.open()}),c.bind("checked",S),p.bind("onDelete",M),p.bind("onEdit",F),p.element.on("click",".action-button",P),u.on("click",function(){A.message(C.prop("COMMON_CLOSE_WINDOW_CONFIRM")),A.setConfirmActions({yes:function(){z()}}),A.open()}),v.on("click",q),s.bind("select",function(e){if($(e.item).hasClass("search-tab"))return e.preventDefault(),!1}),O.searchField.set("click",function(e){var t=$(e.target),i=t.val()?t.val():O.searchField.get("keywords");D||U(!0),Y(i)}),O.searchField.set("keydown",function(e){console.info(e),13==e.keyCode&&O.searchField.click(e)})},S=function(e){console.info(e),!1===e.isHeader&&k([e.item]),console.info("selected items : "+L.length);var t=V();w(t.length)},w=function(e){b=e,O.actions[0].options.set("selectedText",C.prop("FACILITY_RULE_MESSAGE_INFO_SELECTED_MULTI_RULE_ALARM_LOG",e)),0==b?(L.length=0,O.actions[0].options.set("selectedText",C.prop("FACILITY_RULE_MESSAGE_INFO_NONE_SELECT_RULE_ALARM_LOG")),r(!1)):r(!0)},k=function(e){if(e){var t,i,a,o,n=e.length;for(o=0;o<n;o++)i=(t=e[o]).checked,a=t.id,x(i,a)}},x=function(e,t){var i;e?-1==L.indexOf(t)&&L.push(t):(i=L.indexOf(t),L.splice(i,1))},F=function(e){e.sender.close();var t=e.result;G(t)},M=function(e){var t=[],i=e.result,a=e.results;a?t=a:i&&t.push(i),A.message(C.prop("FACILITY_RULE_MESSAGE_CONFIRM_DELETE_RULE_ALARM_LOG")),A.setConfirmActions({yes:function(){Q(t,e.sender)}}),A.open()},U=function(e){(D=e)?(c.uncheckAll(),O.actions[1].set("invisible",!0)):(O.searchField.set("keywords",""),s.select(0))},Y=function(e,t){var i={logic:"and",filters:[]};i.filters.push({field:"name",operator:"contains",value:e}),t&&i.filters.push({field:"type",operator:"eq",value:t})},P=function(){var e=$(this),t=e.closest("tr");!function(e,t,i){var a,o=e,n=c.dataSource;if(0<t.length){var r=t.data("uid"),s=i.grid.dataSource;a=s.getByUid(r)}else a=i.getSelectedData();var l=t.find(".grid-checkbox-cell");o.hasClass("ic-action-pause")?(g.open(i.element),$.ajax({url:"/rules/"+a.id,method:"PATCH",data:{activated:!1}}).done(function(){o.removeClass("ic-action-pause"),o.addClass("ic-action-play"),o.parent().siblings(".schedule-status").text(C.prop("COMMON_PAUSE"));var e=n.get(a.id);if(0<l.length){var t=d.getEventTemplateClass(e);l.removeClass("pause"),l.addClass(t)}e.set("activated",!1),i.grid&&i.grid.dataSource.get(a.id).set("activated",!1)}).always(function(){g.close()})):(g.open(i.element),$.ajax({url:"/rules/"+a.id,method:"PATCH",data:{activated:!0}}).done(function(){o.removeClass("ic-action-play"),o.addClass("ic-action-pause"),o.parent().siblings(".schedule-status").text(C.prop("COMMON_OPERATING"));var e=n.get(a.id);if(0<l.length){var t=d.getEventTemplateClass(e);l.removeClass(t),l.addClass("pause")}e.set("activated",!0),i.grid&&i.grid.dataSource.get(a.id).set("activated",!0)}).always(function(){g.close()}))}(e,t,p)},V=function(){var e;return e=c.getCheckedData(),b=e.length,e},H=function(e){g.open(),$.ajax({url:"/rules"}).done(function(e){if(256<=(e=a.createDataSource(e,a.Model)).length)return h.message(C.prop("FACILITY_RULE_ALARM_LOG_MAX_SIZE")),void h.open();G()}).fail(function(e){var t=f.parseFailResponse(e);h.message(t),h.open()}).always(function(){g.close()})},W=function(e){var t,i=(t=[],t=c.getCheckedData(),$.isArray(t)&&0<t.length&&(t=t[0]),t);G(i)},G=function(e){s.hide(),l.show(),n.init(e,!1,!0)},B=function(e){var t,i=V();t=1<i.length?C.prop("FACILITY_RULE_MESSAGE_CONFIRM_DELETE_MULTI_RULE_ALARM_LOG",i.length):C.prop("FACILITY_RULE_MESSAGE_CONFIRM_DELETE_RULE_ALARM_LOG"),A.message(t),A.setConfirmActions({yes:function(){Q(i)}}),A.open()},j=function(){var e=V(),t="single";1<e.length&&(t="multi",e=X(e)),p.setDataSource(e),p.setDialogType(t),p.open()},X=function(e){var t,i,a,o,n=L.length,r=e.length,s=[];for(console.info("sort prediction"),i=0;i<n;i++)for(t=L[i],a=r-1;0<=a;a--)if((o=e[a]).id==t){s.push(o),e.splice(a,1),r=e.length;break}if(0<e.length)for(n=e.length,i=0;i<n;i++)s.push(e[i]);return s},z=function(){n.setEditState(!1),T.disableFloorNav(!0),l.hide(),s.show(),D&&U(!1),J()},J=function(){g.open(),$.ajax({url:"/rules"}).done(function(e){Z(e)}).fail(function(e){var t=f.parseFailResponse(e);h.message(t),h.open()}).always(function(){g.close()})},q=function(){return U(!1),!1},Z=function(e){var t=a.createDataSource(e,a.Model),i=new m.data.DataSource({data:t});i.read(),c.setDataSource(i),w(0)},Q=function(t,i){var a,o,n=t.length,e=[];for(i?g.open(i.element):g.open(),a=0;a<n;a++)(o=t[a])&&e.push($.ajax({url:"/rules/"+o.id,method:"DELETE"}));$.when.apply(this,e).done(function(){}).fail(function(){}).always(function(){g.close(),1<b?h.message(C.prop("FACILITY_RULE_MESSAGE_NOTI_DELETED_MULTI_RULE_ALARM_LOG",b)):h.message(C.prop("FACILITY_RULE_MESSAGE_NOTI_DELETED_RULE_ALARM_LOG")),n=t.length;var e=c.dataSource;for(a=0;a<n;a++)o=t[a],(o=e.get(o.id))&&e.remove(o);h.open(),c.uncheckAll(),w(0),i&&i.close()})},K=function(e){var t={columns:[{field:"checked",width:37},{field:"name",title:C.prop("FACILITY_RULE_RULE_ALARM_LOG_NAME"),format:"",width:100,sortable:!1},{field:"activated",title:C.prop("COMMON_STATUS"),width:100,sortable:!1,template:function(e){return e.activated?C.prop("COMMON_OPERATING"):C.prop("COMMON_PAUSE")}},{title:C.prop("FACILITY_RULE_CONDITION"),width:100,template:d.conditionListTemplate},{title:C.prop("COMMON_OPERATION"),width:100,template:function(e){var t="-";if(e.alarmType){var i=e.alarmType,a=C.prop("FACILITY_DEVICE_STATUS_"+i.toUpperCase());t=a||i}return t}},{title:C.prop("COMMON_BTN_DETAIL"),width:70,template:function(e){return"<span class='ic ic-info' data-id='"+e.id+"' data-uid='"+e.uid+"'></span>"}}],dataSource:e,height:$(".schedule-content-block").height(),scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!0,setCheckedAttribute:!0};c=E.kendoGrid(t).data("kendoGrid")};return{init:function(e){s=e,y();var t=s.contentElement(1);g.open(),N([]),m.bind($(t),O),R(),g.close()},closeCreateBtnEvt:z}}),define("operation/rule/rule",["operation/core","operation/rule/view-model/rule-vm","operation/rule/model/rule-model","operation/rule/common/common","operation/rule/common/widget","operation/rule/template/rule-template","operation/rule/rule-create","operation/rule/rule-alarm"],function(t,e,a,i,o,d,n,r){function s(e){1==N&&e?I.actions[2].set("disabled",!e):I.actions[2].set("disabled",!0),I.actions[3].set("disabled",!e),I.actions[4].set("disabled",!e)}var l,c,p,u,v,m,_=window.kendo,f=window.CommonLoadingPanel,T=window.Util,C=window.MAIN_WINDOW,g=window.I18N,O=new f,I=e.MainViewModel,E=$("#rule-common-tab"),h=$("#rule-create-tab"),A=$("#rule-control-list"),L=o.msgDialog,D=o.confirmDialog,b=[],y=!1,N=0,R=function(e){var t="?";return(e=e||C.getCurrentFloor()).building.id!=C.FLOOR_NAV_BUILDING_TOTAL_ID&&(t+="foundation_space_buildings_id="+e.building.id+"&"),e.floor.id!=C.FLOOR_NAV_FLOOR_ALL_ID&&(t+="foundation_space_floors_id="+e.floor.id),t},S=function(e){var t=R(e);K(t)},w=function(){l=E.kendoCommonTabStrip().data("kendoCommonTabStrip"),c=h.kendoCommonTabStrip().data("kendoCommonTabStrip"),v=$("#rule-close-create"),m=$("#rule-close-search"),r.init(l)},k=function(e){var t=a.createDataSource(e,a.Model);ae(t),u=o.getRuleDetailPopup()},x=function(){l.bind("activate",function(e){0==$(e.item).index()&&K()}),I.actions[1].options.set("click",j),I.actions[2].options.set("click",X),I.actions[3].options.set("click",J),I.actions[4].options.set("click",q),p.element.on("click",".ic.ic-info",function(){var e=$(this).data("id"),t=p.dataSource.get(e);u.setDataSource(t),u.setDialogType("single"),u.open()}),p.bind("checked",F),u.bind("onDelete",V),u.bind("onEdit",P),u.element.on("click",".action-button",G),v.on("click",function(){n.closeDatePicker(),D.message(g.prop("COMMON_CLOSE_WINDOW_CONFIRM")),D.setConfirmActions({yes:function(){n.isRuleAlarm()?r.closeCreateBtnEvt():Q()}}),D.open()}),m.on("click",ee),l.bind("select",function(e){if($(e.item).hasClass("search-tab"))return e.preventDefault(),!1}),I.searchField.set("click",function(e){var t=$(e.target),i=t.val()?t.val():I.searchField.get("keywords");y||H(!0),W(i)}),I.searchField.set("keydown",function(e){console.info(e),13==e.keyCode&&I.searchField.click(e)})},F=function(e){console.info(e),!1===e.isHeader&&U([e.item]),console.info("selected items : "+b.length);var t=B();M(t.length)},M=function(e){N=e,I.actions[0].options.set("selectedText",g.prop("FACILITY_RULE_MESSAGE_INFO_SELECTED_MULTI_RULE",e)),0==N?(b.length=0,I.actions[0].options.set("selectedText",g.prop("FACILITY_RULE_MESSAGE_INFO_NONE_SELECT_RULE")),s(!1)):s(!0)},U=function(e){if(e){var t,i,a,o,n=e.length;for(o=0;o<n;o++)i=(t=e[o]).checked,a=t.id,Y(i,a)}},Y=function(e,t){var i;e?-1==b.indexOf(t)&&b.push(t):(i=b.indexOf(t),b.splice(i,1))},P=function(e){e.sender.close();var t=e.result;z(t)},V=function(e){var t=[],i=e.result,a=e.results;a?t=a:i&&t.push(i),D.message(g.prop("FACILITY_RULE_MESSAGE_CONFIRM_DELETE_RULE")),D.setConfirmActions({yes:function(){ie(t,e.sender)}}),D.open()},H=function(e){(y=e)?(p.uncheckAll(),E.find(".main-tab").hide(),E.find(".search-tab").show(),I.actions[1].set("invisible",!0)):(E.find(".main-tab").show(),E.find(".search-tab").hide(),I.searchField.set("keywords",""),l.select(0))},W=function(e,t){var i={logic:"and",filters:[]};i.filters.push({field:"name",operator:"contains",value:e}),t&&i.filters.push({field:"type",operator:"eq",value:t})},G=function(){var e=$(this),t=e.closest("tr");!function(e,t,i){var a,o=e,n=p.dataSource;if(0<t.length){var r=t.data("uid"),s=i.grid.dataSource;a=s.getByUid(r)}else a=i.getSelectedData();var l=t.find(".grid-checkbox-cell");o.hasClass("ic-action-pause")?(O.open(i.element),$.ajax({url:"/rules/"+a.id,method:"PATCH",data:{activated:!1}}).done(function(){o.removeClass("ic-action-pause"),o.addClass("ic-action-play"),o.parent().siblings(".schedule-status").text(g.prop("COMMON_PAUSE"));var e=n.get(a.id);if(0<l.length){var t=d.getEventTemplateClass(e);l.removeClass("pause"),l.addClass(t)}e.set("activated",!1),i.grid&&i.grid.dataSource.get(a.id).set("activated",!1)}).always(function(){O.close()})):(O.open(i.element),$.ajax({url:"/rules/"+a.id,method:"PATCH",data:{activated:!0}}).done(function(){o.removeClass("ic-action-play"),o.addClass("ic-action-pause"),o.parent().siblings(".schedule-status").text(g.prop("COMMON_OPERATING"));var e=n.get(a.id);if(0<l.length){var t=d.getEventTemplateClass(e);l.removeClass(t),l.addClass("pause")}e.set("activated",!0),i.grid&&i.grid.dataSource.get(a.id).set("activated",!0)}).always(function(){O.close()}))}(e,t,u)},B=function(){var e;return e=p.getCheckedData(),N=e.length,e},j=function(e){O.open(),$.ajax({url:"/rules"}).done(function(e){if(256<=(e=a.createDataSource(e,a.Model)).length)return L.message(g.prop("FACILITY_RULE_MAX_SIZE")),void L.open();z()}).fail(function(e){var t=T.parseFailResponse(e);L.message(t)}).always(function(){O.close()})},X=function(e){var t,i=(t=[],t=p.getCheckedData(),$.isArray(t)&&0<t.length&&(t=t[0]),t);z(i)},z=function(e){l.hide(),c.show(),n.init(e)},J=function(e){var t,i=B();t=1<i.length?g.prop("FACILITY_RULE_MESSAGE_CONFIRM_DELETE_MULTI_RULE",i.length):g.prop("FACILITY_RULE_MESSAGE_CONFIRM_DELETE_RULE"),D.message(t),D.setConfirmActions({yes:function(){ie(i)}}),D.open()},q=function(){var e=B(),t="single";1<e.length&&(t="multi",e=Z(e)),u.setDataSource(e),u.setDialogType(t),u.open()},Z=function(e){var t,i,a,o,n=b.length,r=e.length,s=[];for(i=0;i<n;i++)for(t=b[i],a=r-1;0<=a;a--)if((o=e[a]).id==t){s.push(o),e.splice(a,1),r=e.length;break}if(0<e.length)for(n=e.length,i=0;i<n;i++)s.push(e[i]);return s},Q=function(){n.setEditState(!1),C.disableFloorNav(!1),l.show(),c.hide(),y&&H(!1),K()},K=function(e){O.open(),e=e||R(),$.ajax({url:"/rules"+e}).done(function(e){te(e)}).fail(function(e){var t=T.parseFailResponse(e);L.message(t),L.open()}).always(function(){O.close()})},ee=function(){return H(!1),!1},te=function(e){var t=a.createDataSource(e,a.Model),i=new _.data.DataSource({data:t});i.read(),p.setDataSource(i),M(0)},ie=function(i,a){var e,o,n=i.length,r=n,t=[];for(a?O.open(a.element):O.open(),e=0;e<r;e++)(o=i[e])&&t.push($.ajax({url:"/rules/"+o.id,method:"DELETE"}));$.when.apply(this,t).done(function(){}).fail(function(){}).always(function(){var e;O.close(),1<n?L.message(g.prop("FACILITY_RULE_MESSAGE_NOTI_DELETED_MULTI_RULE_CONTROL",n)):L.message(g.prop("FACILITY_RULE_MESSAGE_NOTI_DELETED_RULE_CONTROL"));var t=p.dataSource;for(e=0;e<r;e++)o=i[e],(o=t.get(o.id))&&t.remove(o);L.open(),p.uncheckAll(),M(0),a&&a.close(),p.uncheckAll(),a&&a.close()})},ae=function(e){var t={columns:[{field:"checked",width:37},{field:"name",title:g.prop("FACILITY_RULE_RULE_CONTROL_NAME"),format:"",width:100,sortable:!1},{field:"activated",title:g.prop("COMMON_STATUS"),width:100,sortable:!1,template:function(e){return e.activated?g.prop("COMMON_OPERATING"):g.prop("COMMON_PAUSE")}},{title:g.prop("FACILITY_DEVICE_DEVICE"),width:100,template:function(e){var t,i,a,o="-";if(e.devices){if(t=e.devices.length,e.devices[0])a=e.devices[0].dms_devices_mappedType,i=e.devices[0].dms_devices_type,"ControlPoint"!=a&&(i=a||i),o="<span class='detail-img reg selected "+T.getDisplayClassType(i)+"'></span>";var n=t-1;0<n&&(o+=" (+"+n+")")}return o}},{title:g.prop("COMMON_LOCATION"),width:100,template:function(e){var t,i,a,o,n="-",r=[];if(i=e.devices){for(o=i.length,a=0;a<o;a++)t=i[a],-1==r.indexOf(t.location)&&r.push(t.location);r[0]&&(n=r[0]),0<(o=r.length)-1&&(n+=" (+"+(o-1)+")")}return n}},{title:g.prop("FACILITY_RULE_CONDITION"),width:100,template:d.conditionListTemplate},{title:g.prop("COMMON_OPERATION"),width:100,template:d.operationListTemplate},{title:g.prop("COMMON_BTN_DETAIL"),width:70,template:function(e){return"<span class='ic ic-info' data-id='"+e.id+"' data-uid='"+e.uid+"'></span>"}}],dataSource:e,height:"100%",scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!0,setCheckedAttribute:!0};p=A.kendoGrid(t).data("kendoGrid")};return function(){w();var a=l.contentElement(0);O.open();var e=R();$.ajax({url:"/rules"+e}).done(function(e){k(e);var t=E.find(".k-tabstrip-items");_.bind(t,I),_.bind($(a),I),x()}).fail(function(e){var t=E.find(".k-tabstrip-items");_.bind(t,I),_.bind($(a),I);var i=T.parseFailResponse(e);L.message(i),L.open()}).always(function(){O.close(),t.on("onfloorchange",S)})}(),{closeCreateBtnEvt:Q}});