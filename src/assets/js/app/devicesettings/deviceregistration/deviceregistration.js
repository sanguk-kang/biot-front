define("device/common/device-model",[],function(){"use strict";var e=window.kendo;return{Device:e.data.Model.define({id:"id",fields:{alarms:{type:"object",editType:null},networks:{type:"object"},parentId:{type:"string"},winds:{type:"object"},registrationStatus:{type:"string",options:[{text:"NotRegistered",value:"0"},{text:"Registered",value:"1"},{text:"Deleted",value:"1"}]},name:{type:"string"},information:{type:"object"},subordinateIds:{type:"object"},operations:{type:"object"},mappedType:{type:"string",options:[{text:"ControlPoint",value:"0"},{text:"Light",value:"1"},{text:"Meter.WattHour",value:"2"},{text:"Sensor.Humidity",value:"3"},{text:"Sensor.Motion",value:"4"},{text:"Sensor.Temperature",value:"5"}]},representativeStatus:{type:"string",options:[{text:"Normal.On",value:"0"},{text:"Normal.Off",value:"1"},{text:"Alarm.Critical",value:"2"},{text:"Alarm.Warning",value:"3"},{text:"Alarm.NetworkError",value:"4"},{text:"Disconnected",value:"5"},{text:"LowBattery",value:"6"},{text:"OutOfBounds",value:"7"}]},modes:{type:"object"},controlPoint:{type:"object"},groups:{type:"object"},configuration:{type:"object"},light:{type:"object"},type:{type:"string"},id:{type:"string"},schedules:{type:"object"},description:{type:"string"},locations:{type:"object"},airConditioner:{type:"object"},temperatures:{type:"object"}}}),DevicePopup:e.data.Model.define({id:"id",fields:{id:{name:"Device ID",type:"string",editType:null},name:{name:"Device NAME",type:"string",editType:"input"},representativeStatus:{name:"Status",type:"string",editType:null},modes:{name:"Operation Mode",type:"string",editType:null},temperatureS:{name:"Set Temperature",type:"string",editType:null},temperatureC:{name:"Current Temperature",type:"string",editType:null},locations:{name:"Location",type:"string",editType:"select"},groups:{name:"Group",type:"string",editType:null},"control-point":{name:"Remote Control",type:"string",editType:"input"},model:{name:"Model",type:"string",editType:null},type:{name:"Type",type:"string",editType:null},version:{name:"Firmware Version",type:"string",editType:null},description:{name:"Description",type:"string",editType:"input"}}})}}),define("device/common/device-api",["device/common/device-model"],function(e){"use strict";function n(e){var t="/dms/devices/"+e;return $.ajax({url:t,method:"DELETE"})}function o(e){return $.ajax({url:"/dms/devices",method:"PATCH",data:e})}var x=window.MAIN_WINDOW,V=e.Device,B={"AirConditioner.Indoor":["AirConditioner.*"],AirConditionerOutdoor:["AirConditionerOutdoor"],ControlPoint:["ControlPoint.*"],Meter:["Meter*"],"Sensor.Temperature_Humidity":["Sensor.Temperature_Humidity","Sensor.Temperature","Sensor.Humidity"],Light:["Light"],SmartPlug:["SmartPlug"],"Sensor.Motion":["Sensor.Motion"],Gateway:["Gateway"],Beacon:["Beacon"],CCTV:["CCTV"]},P={ControlPoint:{mappedTypes:"ControlPoint"},Meter:{types:"ControlPoint.*"},"Sensor.Temperature_Humidity":{types:"ControlPoint.*"}},k={"ControlPoint.*":{mappedTypes:["ControlPoint"]},Light:{types:["ControlPoint.*"],mappedTypes:["Light"]},"Meter*":{types:["ControlPoint.*"],mappedTypes:["Meter*"]},"Sensor.Temperature_Humidity":{types:["ControlPoint.*"],mappedTypes:["Sensor.Humidity","Sensor.Temperature","Sensor.Temperature_Humidity"]},"Sensor.Motion":{types:["ControlPoint.*"],mappedTypes:["Sensor.Motion"]}},Y={On:{representativeStatuses:"Normal.On"},Off:{representativeStatuses:"Normal.Off"},Critical:{representativeStatuses:"Alarm.Critical"},Warning:{representativeStatuses:"Alarm.Warning"},Normal:{representativeStatuses:"Normal"},"Alarm.Critical":{representativeStatuses:"Alarm.Critical"},"Alarm.Warning":{representativeStatuses:"Alarm.Warning"}};return{getStatisticByKey:function(e){var t;switch(e){case"AirConditioner.Indoor":t="/dms/devices/statisticView/AirConditioner";break;case"Meter":t="/dms/devices/statisticView/Meter";break;case"Sensor.Temperature_Humidity":t="/dms/devices/statisticView/Sensor.Temperature_Humidity";break;case"Light":t="/dms/devices/statisticView/Light";break;case"Sensor.Motion":t="/dms/devices/statisticView/Sensor.Motion";break;case"Gateway":t="/dms/devices/statisticView/Gateway";break;case"CCTV":t="/dms/devices/statisticView/CCTV";break;case"Beacon":t="/dms/devices/statisticView/Beacon";break;case"Asset":t="/dms/devices/statisticView/Asset";break;case"SmartPlug":t="/dms/devices/statisticView/SmartPlug"}return x.getCurrentFloor().building.id==x.FLOOR_NAV_BUILDING_TOTAL_ID&&(t+="?exposeFloors=false"),$.ajax({url:t}).then(function(e){return e=e||[]})},getDeviceWithType:function(e,t,i,a,n){var r;r=$.isArray(e)?e:B[e]?B[e]:[];var o,l,s,d,c,p,u,g,f=new $.Deferred,m="/dms/devices",v="",T={},I={},E=!1,C="",_="",h=(n=n||{}).type,b=n.mode||{},w=n.statuses||[],A=n.zones||[],y=n.name&&n.name.replace(/\s/g,"+")||null;if(h&&"Beacon"!=r[0])l=P[e]&&P[e].types,s=P[e]&&P[e].mappedTypes,T.types=h,s&&(T.mappedTypes=s),l&&(I.types=l,I.mappedTypes=h);else if(r){for(c=0,p=r.length;c<p;c++)o=r[c],!E&&k[o]&&(E=!0,l=k[o].types,s=k[o].mappedTypes,l?(C=m+"?types="+(l=l.join(","))+"&mappedTypes="+(s=s.join(",")),I.types=l,I.mappedTypes=s):s=s.join(",")),v+=o,v+=",";T.types=v.substr(0,v.length-1)}if(0<w.length){for(c=0,p=w.length;c<p;c++)(d=Y[d=w[c]]).representativeStatuses&&-1==_.indexOf(d.representativeStatuses)&&(_+=d.representativeStatuses+",");_&&_.lastIndexOf(",")===_.length-1&&(_=_.substr(0,_.length-1)),T.representativeStatuses=_}b.value&&b.id&&(T.equals=b.value,T.equalsAttribute="modes-"+b.id+"-mode"),0<A.length&&(T.foundation_space_zones_id=A.join(",")),y&&(T.contains=y,T.containsAttributes="id,name,controlPoint-tagName");var O=x.getCurrentFloor(),L=O.building,D=O.floor;L.id&&L.id!=x.FLOOR_NAV_BUILDING_TOTAL_ID&&(u=L.id),D.id&&D.id!=x.FLOOR_NAV_FLOOR_ALL_ID&&(g=D.id),t?t=t.join(","):(t="Registered,NotRegistered",-1==m.indexOf("Beacon")||a||(t+=",Blocked")),-1!=t.indexOf("NotRegistered")&&(g=u=null),u&&(T.foundation_space_buildings_id=u),g&&(T.foundation_space_floors_id=g),T.registrationStatuses=t,$.isEmptyObject(I)||(I.registrationStatuses=t,I.foundation_space_buildings_id=u,I.foundation_space_floors_id=g,_&&(I.representativeStatuses=_),b.value&&b.id&&(I.equals=b.value,I.equalsAttribute="modes-"+b.id+"-mode"),0<A.length&&(I.foundation_space_zones_id=A.join(",")),y&&(I.contains=y,I.containsAttributes="id,name,controlPoint-tagName")),E&&!C&&(T.mappedTypes=s),i&&(i.typeQuery&&(T=$.extend(T,i.typeQuery)),i.mappedTypeQuery&&(I=$.extend(I,i.mappedTypeQuery)));var N,S,R=[],M=[],F=[];return I.registrationStatuses&&(m="/dms/devices",I.types&&(m+="?types="+I.types,delete I.types),I.mappedTypes&&(m+=-1!=m.indexOf("?")?"&":"?",m+="mappedTypes="+I.mappedTypes,delete I.mappedTypes),I.representativeStatuses&&(m+=-1!=m.indexOf("?")?"&":"?",m+="representativeStatuses="+I.representativeStatuses,delete I.representativeStatuses),I.foundation_space_zones_id&&(m+=-1!=m.indexOf("?")?"&":"?",m+="foundation_space_zones_id="+I.foundation_space_zones_id,delete I.foundation_space_zones_id),R.push($.ajax({url:m,data:I}).then(function(e){e.page?(M=e.data,N=e.page):M=e}).fail(function(e){f.reject(e)}))),m="/dms/devices",T.types&&(m+="?types="+T.types,"Beacon"==T.types&&h&&(m+="&equals="+h+"&equalsAttribute=configuration-mobilityType"),delete T.types),T.mappedTypes&&(m+=-1!=m.indexOf("?")?"&":"?",m+="mappedTypes="+T.mappedTypes,delete T.mappedTypes),1<T.registrationStatuses.split(",").length&&(m+=-1!=m.indexOf("?")?"&":"?",m+="registrationStatuses="+T.registrationStatuses,delete T.registrationStatuses),T.representativeStatuses&&(m+=-1!=m.indexOf("?")?"&":"?",m+="representativeStatuses="+T.representativeStatuses,delete T.representativeStatuses),T.foundation_space_zones_id&&(m+=-1!=m.indexOf("?")?"&":"?",m+="foundation_space_zones_id="+T.foundation_space_zones_id,delete T.foundation_space_zones_id),R.push($.ajax({url:m,data:T}).then(function(e){F=e.page?(S=e.page,e.data):e}).fail(function(e){f.reject(e)})),$.when.apply(this,R).always(function(){var e,t,i,a,n,r,o=!1;for(i=F.length,a=M.length,e=0;e<a;e++){for(r=M[e],o=!1,t=0;t<i;t++)if(n=F[t],r.id==n.id){o=!0;break}o||F.push(r)}i=F.length;var l=[];for(e=0;e<i;e++)(n=F[e]).locations&&!n.locations[0]&&(n.locations[0]={}),n.assets||(n.assets=[]),n.selected=!1,n=new V(n),l.push(n);if(S||N){var s={data:l,total:0};S&&(s.typePage=S,s.total+=S.totalElements),N&&(s.mappedTypePage=N,s.total+=N.totalElements),f.resolve(s)}else f.resolve(l)}),f.promise()},getDeviceWithID:function(e){var t="/dms/devices/"+e;return $.ajax({url:t})},getDeviceWithMultipleID:function(e){var t="/dms/devices";if(e){for(var i="",a=0,n=e.length;a<n;a++)i+=e[a],i+=",";t+="?ids="+i.substr(0,i.length-1)}return $.ajax({url:t})},patchDevice:function(e,t){var i="/dms/devices/"+e;return $.ajax({url:i,method:"PATCH",data:t})},patchDevices:o,deleteDevice:n,multiControl:function(e){return $.ajax({url:"/dms/devices/multiControl",method:"PUT",data:e})},patchGroupAttr:function(e,t,i){var a="/dms/devices/"+e+"/"+t+"/";return $.ajax({url:a,method:"PATCH",data:i})},deleteDevices:function(e){var t,i=e.length,a=[];for(t=0;t<i;t++)a.push(n(e[t]));return $.when.apply(this,a)},patchOutdoorCurrentLimit:function(e){var t=e.value,i=e.item;return $.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{electricCurrentControl:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.electricCurrentControl&&(i.airConditioner.outdoorUnit.electricCurrentControl=t)})},patchOutdoorHeatingCapacityCalibration:function(e){var t=e.value,i=e.item;$.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{heatingCapacityCalibration:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.heatingCapacityCalibration&&(i.airConditioner.outdoorUnit.heatingCapacityCalibration=t)})},patchOutdoorCoolingCapacityCalibration:function(e){var t=e.value,i=e.item;$.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{coolingCapacityCalibration:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.coolingCapacityCalibration&&(i.airConditioner.outdoorUnit.coolingCapacityCalibration=t)})},getZone:function(e,t){return $.ajax({url:"/foundation/space/zones?foundation_space_floors_id="+e}).then(function(e){return(e=e||[]).sort(function(e,t){return e.sortOrder-t.sortOrder}),t&&e.unshift({id:void 0,name:"No Zone"}),e})},patchRegistrationStatus:function(e,t){var i,a,n=[],r=e.length;for(a=0;a<r;a++)(i={id:e[a].id}).registrationStatus=t,n.push(i);return o(n)},patchControlPointValue:function(e,t){return"number"==typeof t&&(t=t.toString()),$.ajax({url:"/dms/devices/"+e+"/controlPoint",method:"PATCH",data:{value:t}})}}}),define("device/common/device-constants",[],function(){"use strict";var e=window.I18N;return{TIME_OUT:1500,ALL_TIME_INTERVAL:4e4,PANEL_REFRESH_TIME:1e3,BEACON_TIME_INTERVAL:5e3,DISPLAY_NAME_MAX:6,INDOOR_TYPE:["AirConditioner.Indoor","AirConditioner.AHU","AirConditioner.Chiller","AirConditioner.EHS","AirConditioner.ERV","AirConditioner.ERVPlus",["AirConditioner.FCU","AirConditioner.SFCU"],"AirConditioner.DuctFresh"],OUTDOOR_TYPE:["AirConditioneromOutdoor"],POINT_TYPE:["ControlPoint.AI","ControlPoint.AO","ControlPoint.DI","ControlPoint.DO","ControlPoint.AV","ControlPoint.DV"],ENERGY_TYPE:["Meter.WattHour","Meter.Gas","Meter.Water","Meter.Calorimeter"],SENSOR_TEMP_HUM_TYPE:["Sensor.Temperature_Humidity","Sensor.Humidity","Sensor.Temperature"],STATUS:["Normal.On","Normal.Off","Alarm.Critical","Alarm.Warning"],BEACON_STATUS:["Normal","Disconnected","WrongLocation","LowBattery"],BEACON_ACTION:{BLOCK:1,DELETE:2,REGISTER:3,DETAIL:4},BEACON_LOCATION_TYPE:["Fixed","Movable"],ASSET_FILTER:{TYPE:0,LOCATION:1,STATUS:2,ZONE:3,SELECTALL:4},ASSET_ACTION:{ASSET_TYPE:1,EXPORT:2,IMPORT:3,REGISTER:4,DELETE:5,DETAIL:6},ONOFF:["On","Off"],MODE:[{mode:"Auto",id:"AirConditioner.Indoor.General"},{mode:"Cool",id:"AirConditioner.Indoor.General"},{mode:"Heat",id:"AirConditioner.Indoor.General"},{mode:"Dry",id:"AirConditioner.Indoor.General"},{mode:"Fan",id:"AirConditioner.Indoor.General"},{mode:"CoolStorage",id:"AirConditioner.Indoor.General"},{mode:"HeatStorage",id:"AirConditioner.Indoor.General"},{mode:"vAuto",id:"AirConditioner.Indoor.Ventilator"},{mode:"HeatExchange",id:"AirConditioner.Indoor.Ventilator"},{mode:"ByPass",id:"AirConditioner.Indoor.Ventilator"},{mode:"Sleep",id:"AirConditioner.Indoor.Ventilator"},{mode:"Eco",id:"AirConditioner.Indoor.DHW"},{mode:"Standard",id:"AirConditioner.Indoor.DHW"},{mode:"Power",id:"AirConditioner.Indoor.DHW"},{mode:"Force",id:"AirConditioner.Indoor.DHW"}],TEXT:{SELECTALL:e.prop("COMMON_BTN_SELECT_ALL"),DESELECTALL:e.prop("COMMON_BTN_DESELECT_ALL"),REGISTER:e.prop("COMMON_BTN_REGISTER"),DEREGISTER:e.prop("COMMON_BTN_DEREGISTER"),VIEW:e.prop("COMMON_BTN_VIEW"),DELETE:e.prop("COMMON_BTN_DELETE")},FILTER:{TYPE:0,STATUS:1,MODE:2,ZONE:3,SELECTALL:4,REGEND:5},ACTION:{REGISTER:1,DETAIL:2},NW_ACTION:{DELETE:1,REGISTER:2,DETAIL:3,VIEW:4},VIEW:{STATISTIC:0,MAP:1,LIST:2,GRID:3},SEARCH:{EDIT:0,BUTTON:1},displayShort:[{value:"CoolStorage",display:"CoolSt"},{value:"HeatStorage",display:"HeatSt"},{value:"HeatExchange",display:"HeatEx"}],controlSet:[[{apiName:"operations",id:"AirConditioner.Indoor.General",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.Ventilator",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.DHW",parameter:"power"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.General.Speed",parameter:"wind"},{},{apiName:"modes",id:"AirConditioner.Indoor.ModeLimit",parameter:"mode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"}],[{apiName:"configuration",parameter:"remoteControl"},{apiName:"airConditioner",parameter:"filterResetRequired"},{apiName:"airConditioner",parameter:"spi"},{apiName:"airConditioner",parameter:"stillAir"}],{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.Ventilator",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.Ventilator.Speed",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.DHW",parameter:"mode"},[{apiName:"airConditioner",parameter:"chiller",underParameter:"waterLaw"},{apiName:"airConditioner",parameter:"chiller",underParameter:"quiet"},{apiName:"airConditioner",parameter:"chiller",underParameter:"forcedFan"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demand"}],{apiName:"airConditioner",parameter:"chiller",underParameter:"mccMode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"desired"}],[{apiName:"temperatures",id:"AirConditioner.Indoor.Room",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"desired",Heat:"AirConditioner.Indoor.DischargeAir.Heat",Cool:"AirConditioner.Indoor.DischargeAir.Cool"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"enabled"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demandLevel"}],outdoorControlConfig:{electricCurrentControl:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:50,text:"50%"},{value:55,text:"55%"},{value:60,text:"60%"},{value:65,text:"65%"},{value:70,text:"70%"},{value:75,text:"75%"},{value:80,text:"80%"},{value:85,text:"85%"},{value:90,text:"90%"},{value:95,text:"95%"},{value:100,text:"100%"}],coolingCapacityCalibration:{Celsius:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"5~7\xb0C"},{value:"7~9",text:"7~9\xb0C"},{value:"9~11",text:"9~11\xb0C"},{value:"10~12",text:"10~12\xb0C"},{value:"11~13",text:"11~13\xb0C"},{value:"12~14",text:"12~14\xb0C"},{value:"13~15",text:"13~15\xb0C"}],Fahrenheit:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"41~45\xb0F"},{value:"7~9",text:"45~48\xb0F"},{value:"9~11",text:"48~52\xb0F"},{value:"10~12",text:"50~54\xb0F"},{value:"11~13",text:"52~55\xb0F"},{value:"12~14",text:"54~57\xb0F"},{value:"13~15",text:"55~59\xb0F"}]},heatingCapacityCalibration:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:25,text:"25kg/cm\xb2"},{value:26,text:"26kg/cm\xb2"},{value:27,text:"27kg/cm\xb2"},{value:28,text:"28kg/cm\xb2"},{value:29,text:"29kg/cm\xb2"},{value:30,text:"30kg/cm\xb2"},{value:31,text:"31kg/cm\xb2"},{value:32,text:"32kg/cm\xb2"},{value:33,text:"33kg/cm\xb2"}]},INNER_LAYOUT:{MONITORING:0,REGISTRATION:1},FILTER_NAME:{SELECTALL:"selectAll",ZONE:"zone",STATUS:"status",TYPE:"type",MODE:"mode",ASSET_TYPE:"assetType"},ACTION_NAME:{DETAIL:"detail",REGISTER:"register",DELETE:"delete",BLOCK:"block",SELECTEDTEXT:"selectedText",VIEW:"view",ASSET_TYPE:"assetType"},REGISTRATION_STATUS_BUTTONS:{REGISTER:0,UNREGISTER:1},LIGHT_CONTROL:{POWER:0,DIMMING:1}}}),define("device/common/device-util",["device/common/device-constants"],function(l){"use strict";function s(){for(var e=w.getDefaultViewType(),t=e.length,i="statistic",a=0;a<t;a++)if("Facility.Device"==e[a].menu){i=(i=e[a].view).toLowerCase();break}return i}function i(e){var t=e.locations,i="-";if(void 0!==e.assets_types_id)return L(e);if(t&&0<t.length){i="";var a=t[0];if(a.description)return a.description;a.foundation_space_buildings_id&&(i+=a.foundation_space_buildings_id+" "),a.foundation_space_floors_id&&(i+=a.foundation_space_floors_id)}return i}function a(e){var t=e.groups,i="-";if(t){var a=t.length;0<a&&(i="",(i=t[0].dms_groups_name)&&1<a&&(i+="(+"+(a-1)+")"))}return A.decodeHtml(i)}function n(e,t){var i,a,n,r,o=e.temperatures,l=e.airConditioner,s="-",d="-",c=!1;l&&l.temperatureReference&&-1<l.temperatureReference.indexOf("WaterOutlet")&&(c=!0),!o||0<o.length&&(c&&(r=$.grep(o,function(e){return"AirConditioner.Indoor.WaterOutlet"==e.id}))&&r.length&&void 0!==(r=r[0]).desired&&(d=r.desired.toFixed(1)),(r=$.grep(o,function(e){return"AirConditioner.Indoor.Room"==e.id}))&&r.length&&(r=r[0],c||void 0!==r.desired&&(d=r.desired.toFixed(1)),void 0!==r.current&&(s=r.current.toFixed(1))),(r=$.grep(o,function(e){return"AirConditioner.Indoor.DHW"==e.id}))&&r.length&&(void 0!==(r=r[0]).desired&&(i=r.desired.toFixed(1)),void 0!==r.current&&(a=r.current.toFixed(1))),(r=$.grep(o,function(e){return"AirConditioner.Outdoor"==e.id}))&&r.length&&(void 0!==(r=r[0]).desired&&(d=r.desired.toFixed(1)),void 0!==r.current&&(s=r.current.toFixed(1))));var p=e.modes;return p&&(r=$.grep(p,function(e){return"AirConditioner.Indoor.General"==e.id&&"Fan"==e.mode}))&&r.length&&(d="-"),n="Celsius"===w.getTemperature().unit?"\xb0C":"\u2109","-"!==d&&t&&(d+=n),"-"!==s&&t&&(s+=n),i&&t&&(i+=n),a&&t&&(a+=n),{isWaterout:c,desired:d,current:s,unit:n,dhwDesired:i,dhwCurrent:a}}function r(e,n,t){var r;return"vAuto"===t&&(r="AirConditioner.Indoor.Ventilator",t="Auto"),{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){var i,a=e.length;if("undefined"==t){for(i=0;i<a;i++)if(void 0===e[i][n])return!0}else for(i=0;i<a;i++)if(e[i][n]==t)return!r||(r===e[i].id||void 0)}},value:t}}function o(e,n,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){for(var i=e.length,a=0;a<i;a++)if(e[a][n]!=t)return;return!0}},value:t}}function d(e){return{field:e,operator:function(e){if(e)return 0===e.length||void 0}}}function c(e){var t,i,a,n,r="-";if(i=e.meters){for(r="",a=i.length,t=0;t<a;t++)(n=i[t].category)&&("AirConditionerAll"==n&&(n="SAC"),r+=n,t!=a-1&&(r+=", "));r=(r=r||"Others").toUpperCase(),r=y.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_"+r)}return r}function p(e){var t="-",i=e.type;return i&&(-1!=i.indexOf("ControlPoint")&&(i=e.mappedType),t=(t=(t=A.getDisplayType(i))||"WattHour").toUpperCase(),t=(t=y.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_"+t))||y.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATTHOUR")),t}function u(e){var t,i,a,n,r="",o=e.type;if(o&&-1!=o.indexOf("ControlPoint")){var l=e.controlPoint;l&&void 0!==l.value&&(r=A.convertNumberFormat(l.value))}else if(i=e.meters)for(a=i.length,t=0;t<a;t++)null!=(n=A.convertNumberFormat(i[t].reading))&&(r+=n,t!=a-1&&(r+=", "));return r=""!=r?r:"-"}function g(e){var t,i="-",a=e.networks;return a&&a[0]&&(a=a[0],e.type,a[t="ethernet"]&&(i=(i=a[t].ipAddress)||"-")),i}function f(e){var t,i="-",a=e.networks;return a&&a[0]&&(a=a[0],e.type,a[t="ethernet"]&&(i=(i=a[t].macAddress)||"-")),i}function m(e){var t,i,a="-",n=e.networks;return n&&n[1]&&((n=n[1]).connected?(t=e.alarms)&&0<t.length?(t.sort(function(e,t){return e=e.alarms_event?e.alarms_event:"-",(t=t.alarms_event?t.alarms_event:"-").localeCompare(e)}),"Critical"==(i=t[0].alarms_type)?a="Connected (Poor)":"Warning"==i&&(a="Connected (Fair)")):a="Connected (Good)":a="Disconnected",a=a||"-"),a}function v(e,t,i,a){var n,r,o,l=0;if((n=e.networks)&&n[0])for(o=n.length,r=0;r<o;r++)if(n[r].type==t){if(!i)return n[r];if(n[r].ble&&n[r].ble.role==i){if(void 0===a)return n[r];if(a==l)return n[r];l++}}return{}}function T(e,t){var i,a,n,r="-",o=e.networks;if(o&&o[0]){for(a=o.length,i=0;i<a;i++)if(o[i].ble){n=o[i].ble;break}n&&(r=(r=n[t])||"-")}return r}function I(e){return T(e,"macAddress")}function E(e){return T(e,"uuid")}function C(e){var t="-",i=e.rules;return i&&(t=0<i.length?"O":"X"),t}function _(e){var t="-",i=e.schedules;return i&&(t=0<i.length?"O":"X"),t}function t(e,t){var i,a="-",n=e.information;if(n&&n.versions){var r,o=(i=n.versions).length;for(r=0;r<o;r++)if(i[r].type==t){a=i[r].number?i[r].number:a;break}}return a}function h(e){var t="-";return e.controlPoint&&e.controlPoint.tagName&&(t=e.controlPoint.tagName),t}var b=window.MAIN_WINDOW,w=window.GlobalSettings,A=window.Util,y=window.I18N,O=window.kendo,L=function(e){var t="-",i=e.location;if(i){if(i.description)return i.description;t="",i.foundation_space_buildings_id&&(t+=i.foundation_space_buildings_id+" "),i.foundation_space_floors_id&&(t+=i.foundation_space_floors_id)}return t};return{isAllFloorCheck:function(){var e=!1,t=b.getCurrentFloor();return t&&t.floor&&"ALL"==t.floor.value&&(e=!0),e},getDefaultView:s,goClick:function(e,t,i,a){var n,r={};if(void 0===a){var o=window.localStorage.getItem("deviceViewType");o?(n=l.VIEW[o],window.localStorage.removeItem("deviceViewType")):n=l.VIEW[s().toUpperCase()]}else n=a;return e?t?i==b.FLOOR_NAV_BUILDING_TOTAL_ID||i==b.FLOOR_NAV_FLOOR_ALL_ID?n===l.VIEW.MAP&&(n=l.VIEW.STATISTIC):n===l.VIEW.STATISTIC&&(n=l.VIEW.MAP):n===l.VIEW.MAP?i==b.FLOOR_NAV_BUILDING_TOTAL_ID?r.building=!0:i==b.FLOOR_NAV_FLOOR_ALL_ID&&(r.floor=!0):n===l.VIEW.STATISTIC&&i!=b.FLOOR_NAV_BUILDING_TOTAL_ID&&i!=b.FLOOR_NAV_FLOOR_ALL_ID&&(r.floor=!1):(i==b.FLOOR_NAV_BUILDING_TOTAL_ID?r.building=!0:i==b.FLOOR_NAV_FLOOR_ALL_ID&&(r.floor=!0),n=l.VIEW.MAP),r.floor&&!b.getCurrentFloorList().length&&(r.floor=!1,r.noFloor=!0),r.view=n,r},getStatus:function(e){return A.getStatus(e)},getLocation:i,getCurrentLocation:function(e){var t,i,a=e.locations,n="-";if(a)for(i=a.length,t=0;t<i;t++)if("Measured"==a[t].id){n="";var r=a[t];if(r.description)return r.description;r.foundation_space_buildings_id&&(n+=r.foundation_space_buildings_id+" "),r.foundation_space_floors_id&&(n+=r.foundation_space_floors_id);break}return n},locations:i,getGroup:a,group:a,getGridIcon:function(e){var t=0,i=[],a=e.airConditioner;if(a){var n=a.peakPowerControl;n&&"On"===n&&t<5&&(i[t++]="ic-peak")}var r=e.configuration;if(r){var o=r.remoteControl;o&&"NotAllowed"===o&&t<5&&(i[t++]="ic-rc-disable")}var l=e.modes;if(l){var s=$.grep(l,function(e){return"AirConditioner.Indoor.ModeLimit"==e.id}),d=s[0]?s[0].mode:void 0;d&&("HeatOnly"===d||"CoolOnly"===d)&&t<5&&(i[t++]="ic-rock")}var c=e.temperatures;if(c){var p=[];p.push($.grep(c,function(e){return"AirConditioner.Indoor.Room.Cool.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.Room.Heat.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.WaterOutlet.Cool.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.WaterOutlet.Heat.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.DHW.Limit"==e.id}));for(var u=!1,g=p.length,f=0;f<g;f++){var m=p[f][0];if(m&&m.enabled){u=!0;break}}u&&t<5&&(i[t++]="ic-thurmo")}if(a){var v=a.defrost;v&&"On"===v&&t<5&&(i[t++]="ic-deforest"),a.filterResetRequired&&t<5&&(i[t++]="ic-filter")}var T=e.schedules;if(T&&0<T.length&&t<5&&(i[t++]="ic-schedule"),a){var I=a.spi;I&&"On"===I&&t<5&&(i[t++]="ic-spi");var E=a.chiller;if(E){var C=E.freezeProtection;C&&"On"===C&&t<5&&(i[t++]="ic-antifreeze")}}return i},getTemperatures:n,curTemperatures:function(e){var t=n(e,!0),i=t.dhwCurrent;return i?t.current+", "+i:t.current},setTemperatures:function(e){var t=n(e,!0),i=t.dhwDesired;return i?t.desired+", "+i:t.desired},curOutdoorTemperature:function(e){return n(e,!0).current},columnMode:function(e){var t=$("<div/>"),i=$("<span/>"),a=e.modes;return a=a&&a.length?a[0].mode:"-",i.text(a).appendTo(t),t.html()},filter0Depth:function(e,t,i){return{field:e,operator:t,value:i}},filter0DepthEmptyList:function(e){return{field:e,operator:function(e){if(e&&e.length)return!0}}},filter1Depth:r,filter1DepthNone:o,filter1DepthNull:d,filter1DepthObj:function(e,i,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e)if("undefined"==t){if(void 0===e[i])return!0}else if(e[i]==t)return!0},value:t}},filterStatusNoAlarm:function(e,t,i,a){var n=[];return"On"===i?n.push(r(e,t,i)):n.push(o(e,t,i)),n.push(d(a)),{logic:"and",filters:n}},filter2Depth:function(e,s,d,c){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){c="undefined"==c?void 0:c;var i,a,n,r,o,l=e.length;for(i=0;i<l;i++){if(!(r=e[i][s])||!r.length)return;for(n=r.length,a=0;a<n;a++)if(void 0!==(o=r[a][d])&&($.isFunction(t)&&(t=t(o)),o==t))return!0}}},value:c}},convertStatistic:function(e,t,i){var a,n,r,o=[];if(e==b.FLOOR_NAV_BUILDING_TOTAL_ID)for(a=0,n=t.length;a<n;a++)r={},$.each(t[a],function(e,t){"foundation_space_buildings_id"===e?e="id":"foundation_space_buildings_name"===e&&(e="name"),r[e]=t}),o.push(r);else for(a=0,n=t.length;a<n;a++)if(e==t[a].foundation_space_buildings_id){for(var l=t[a].floors,s=0,d=l.length;s<d;s++)if(r={},$.each(l[s],function(e,t){if("foundation_space_floors_id"===e)e="id";else if("foundation_space_floors_name"===e){e="name";var i=r.type;"B"===i?t=i+t:"F"==i&&(t+=i)}else"foundation_space_floors_type"===e&&(e="type");r[e]=t}),o.push(r),i){var c,p=l[s].assetTypes;if(p){var u,g,f,m,v,T=p.length;for(u=0;u<T;u++)for(c=p[u].assets_types_name,f=(m=p[u].subAssetTypes).length,g=0;g<f;g++)(v=$.extend({},r,m[g])).isSubAsset=!0,v.assets_types_name=c,o.push(v)}}var I=$.extend({},t[a]);I.id=I.foundation_space_buildings_id,I.name="All",o.push(I);break}return o},convertDisplayName:function(e){return e&&e.length>l.DISPLAY_NAME_MAX?e.substr(0,l.DISPLAY_NAME_MAX):e},getAccureFilter:function(e,t,i,a,n){var r;if(r=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length){var o={logic:"and",filters:t};r.filters.push(o)}if(i&&i.length){var l={logic:"or",filters:i};r.filters.push(l)}if(a&&a.length){var s={logic:"or",filters:a};r.filters.push(s)}if(n&&n.length){var d={logic:"or",filters:n};r.filters.push(d)}return r},getAccureFilterOlder:function(e,t,i,a,n){var r;r=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length&&(r={logic:"and",filters:[r,{logic:"and",filters:t}]});i&&i.length&&(r={logic:"and",filters:[r,{logic:"or",filters:i}]});a&&a.length&&(r={logic:"and",filters:[r,{logic:"or",filters:a}]});n&&n.length&&(r={logic:"and",filters:[r,{logic:"or",filters:n}]});return r},calcScreenBySelect:function(e,t,i){var a=e.length;return 0<a?y.prop("FACILITY_DEVICE_SELECTED",a):void 0===t||void 0===i?"":y.prop("FACILITY_DEVICE_NO_SELECTED_TOTAL",t,i)},calcScreenByOnlySelect:function(e){var t=e.length;return 0<t?y.prop("FACILITY_DEVICE_SELECTED",t):y.prop("FACILITY_DEVICE_NO_SELECTED")},getTempHumiTemperature:function(e,t){var i="-",a=e.temperatures,n=e.type;if(n&&-1!=n.indexOf("ControlPoint")){var r=e.mappedType;if(r&&-1!=r.indexOf("Temperature")){var o=e.controlPoint;o&&void 0!==o.value&&(i=o.value)}}else a&&a[0]&&(i=(a=a[0]).current);"-"==(i=A.convertNumberFormat(i))||t||(i+="Celsius"===w.getTemperature().unit?"\xb0C":"\u2109");return i},getTempHumiHumidity:function(e,t){var i="-",a=e.humidities,n=e.type;if(n&&-1!=n.indexOf("ControlPoint")){var r=e.mappedType;if(r&&-1!=r.indexOf("Humidity")){var o=e.controlPoint;o&&void 0!==o.value&&(i=o.value)}}else a&&a[0]&&(i=(a=a[0]).current);return"-"==(i=A.convertNumberFormat(i))||t||(i+="%"),i},getMotionPresence:function(e){var t="-",i=e.presences;return i&&i[0]&&(t=(t=(i=i[0]).detected)?y.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"):y.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE")),t},getMacAddress:f,getIpAddress:g,getWifiIpAddress:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.ipAddress)||"-"),t},getWifiMacAddress:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.macAddress)||"-"),t},getWifiChannel:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.channel)||"-"),t},getWifiRssi:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.rssi)||"-"),t},getCCTVWifiStatus:m,getCCTVDataStatus:function(e){var t="Off",i=e.cctvs;return i&&i[0]&&"On"==(i=i[0]).dataStatus&&(t="On"),t},getCCTVWifiTxPower:function(e){var t="-",i=e.wifi;return i&&(t=(t=i.txPower)||"-"),t},getCCTVWifiType:function(e){var t="-",i=e.networks;return i&&i[1]&&("WiFi2.4GHz"==(i=i[1]).type?t="2.4GHz":"WiFi5GHz"==i.type&&(t="5GHz"),t=t||"-"),t},getCCTVWifiTotal:function(e){var t="-",i=e.wifi;return(i=i&&i.statistics)&&i.channelUtilization&&(t=(t=i.channelUtilization.total)||"-"),t},getCCTVWifiNoneWifi:function(e){var t="-",i=e.wifi;return(i=i&&i.statistics)&&i.channelUtilization&&(t=(t=i.channelUtilization["non802.11"])||"-"),t},getCCTVWifiInterfererDataSource:function(e){var t=[],i=e.wifi;return(i=i&&i.statistics)&&i.interferers&&(t=i.interferers),t},getBleObject:T,getBleMacAddress:I,getBleUUID:E,getBleMajor:function(e){return T(e,"major")},getBleMinor:function(e){return T(e,"minor")},getBleTxPower:function(e){var t=T(e,"txPower");return"999"!=t&&999!=t||(t="-"),t},getBle1mRssi:function(e){return T(e,"calibratedTxPower")},getBleSignalLevel:function(e){var t=T(e,"rssi");return"-"!=t&&(t+=" dBm"),t},getBleBatteryLevel:function(e){var t,i="-",a=e.information;return a&&a.power&&(t=a.power.batteryLevel)&&(i=t||"-"),i},getBleWritable:function(e){var t=T(e,"writable");return t="-"==t?"READ Only":"READ / WRITE"},getBleAdvertisingName:function(e){return T(e,"advertisingName")},getBleAdvertisingInterval:function(e){return T(e,"advertisingInterval")},getNetworkInterface:v,getNetworkInterfaceIndex:function(e,t,i,a,n){var r,o,l,s=0;if((r=e.networks)&&r[0])for(l=r.length,o=0;o<l;o++)if(r[o].type==t){if(!i)return o;if(r[o].ble&&r[o].ble.role==i){if(null==a)return o;if(a==s)return o;s++}}return n?-1:0},getBleObjectFromNetwork:function(e,t){var i="-";return e&&e.ble&&(i=void 0!==(i=e.ble[t])?i:"-"),i},getWifiObjectFromNetwork:function(e,t){var i="-";return e&&e.wifi&&(i=void 0!==(i=e.wifi[t])?i:"-"),i},getZigbeeStatus:function(e){return v(e,"Zigbee").enabled?"Normal.On":"Normal.Off"},getBleStatus:function(e){return v(e,"BLE","Scanner").enabled?"Normal.On":"Normal.Off"},getBleInterfaceStatus:function(e,t){return v(e,"BLE","Advertiser",t).enabled?"Normal.On":"Normal.Off"},getHasSchedule:_,getHasRule:C,getDescription:function(e){var t="-",i=e.description;return i&&(t=i),A.decodeHtml(t)},getFirmwareVersion:function(e){return t(e,"Firmware")},getZigbeeFirmwareVersion:function(e){return t(e,"Firmware.Zigbee")},getBleFirmwareVersion:function(e){return t(e,"Firmware.BLE")},getBleAppVersion:function(e){return t(e,"Application.BLE")},getHardwareVersion:function(e){return t(e,"Hardware")},getSoftwareVersion:function(e){return t(e,"Software")},getApiVersion:function(e){return t(e,"API")},getPowerAvailableSource:function(e){var t="-",i=e.information;return i&&i.power&&((t=i.power.availableSources||"-")instanceof O.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},getPowerCurrentSource:function(e){var t="-",i=e.information;return i&&i.power&&((t=i.power.currentSource||"-")instanceof O.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},sortableLocation:function(e,t){return e=(e=i(e))||"-",t=(t=i(t))||"-",e.localeCompare(t)},sortableGroup:function(e,t){return e=(e=a(e))||"-",t=(t=a(t))||"-",e.localeCompare(t)},getLocationSort:function(){var e=b.getCurrentFloor(),t=!0;return e.building.id!=b.FLOOR_NAV_BUILDING_TOTAL_ID&&e.floor.id!=b.FLOOR_NAV_FLOOR_TOTAL_ID||(t=!1),t?[{field:"locations",dir:"asc",compare:function(e,t){var i,a;i=e.locations,a=t.locations;var n="-",r="-";return i=i&&i[0]?i[0]:"-",a=a&&a[0]?a[0]:"-","-"!=i&&(i.foundation_space_zones_id||(n="\u03a9"+(n=e.name))),"-"!=a&&(a.foundation_space_zones_id||(r="\u03a9"+(r=t.name))),n.localeCompare(r)}}]:[]},getPointTagName:h,sortablePointTagName:function(e,t){return e=h(e),t=h(t),e.localeCompare(t)},sortablePointValue:function(e,t){var i,a;return e.controlPoint&&(i=e.controlPoint.value),t.controlPoint&&(a=t.controlPoint.value),i-a},sortableMeterType:function(e,t){var i,a;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return i=p(e),a=p(t),i.localeCompare(a)},sortableMeterCategoryType:function(e,t){var i,a;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return i=c(e),a=c(t),i.localeCompare(a)},sortableMacAddress:function(e,t){return e=(e=f(e))||"-",t=(t=f(t))||"-",e.localeCompare(t)},sortableBleMacAddress:function(e,t){return e=I(e),t=I(t),e.localeCompare(t)},sortableIpAddress:function(e,t){return e=(e=g(e))||"-",t=(t=g(t))||"-",e.localeCompare(t)},sortableHasSchedule:function(e,t){return e=_(e),t=_(t),e.localeCompare(t)},sortableHasRule:function(e,t){return e=C(e),t=C(t),e.localeCompare(t)},sortableBeaconUUID:function(e,t){return e=E(e),t=E(t),e.localeCompare(t)},sortableCCTVWifiStatus:function(e,t){return e=m(e),t=m(t),e.localeCompare(t)},getIndoorMode:function(e){var t="-",i=A.getRecentAlarm(e);return t=i?(t=i.type,y.prop("FACILITY_DEVICE_STATUS_"+t.toUpperCase())||t):A.getDisplayModeI18N(e.modes,e.operations,!0," / ")},getAssetType:function(e){return(e.assets_types_name?e.assets_types_name:"-")+" / "+(e.subAssetType?e.subAssetType:"-")},getAssetLocation:L,getAssetUsers:function(e){var t="-",i=e.users;if(i&&i[0]){t="";var a,n=i.length;for(a=0;a<n;a++)t+=i[a].ums_users_name,a!=n-1&&(t+=", ")}return t},getMeterCategoryType:c,getMeterType:p,getMeterCurrentConsumption:u,getMeterCurrentConsumptionUnit:function(e){var t=e.type,i=e.mappedType,a="",n=window.Util;return a="Meter.Gas"==t||"Meter.Gas"==i?n.CHAR.Gas:"Meter.WattHour"==t||"Meter.WattHour"==i?n.CHAR.WattHour:"Meter.Water"==t||"Meter.Water"==i?n.CHAR.Water:"",u(e)+a},getDimmingLevel:function(e){var t,i="-",a=e.lights||e.light;return a&&a[0]&&(i=void 0===(t=(a=a[0]).dimmingLevel)?"-":Math.round(t)+"%"),i},getTempWeatherStation:function(e){var t="-",i=e.configuration;return i&&i.locationType&&(t=i.locationType),t},getTempWeatherStationOx:function(e){var t="-",i=e.configuration;return i&&i.locationType&&(t="Outdoor"==(t=i.locationType)?"O":"X"),t},getPointValue:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.value&&(t=i.value),t},getAssetUserName:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_name),t},getAssetUserID:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_id),t},getAssetUserEmail:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_email),t},getAssetUserOrganization:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_organization?i[0].ums_users_organization:"-"),t},getAssetUserWorkPhoneNumber:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_workPhoneNumber?i[0].ums_users_workPhoneNumber:"-"),t},getAssetUserMobilePhoneNumber:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_mobilePhoneNumber?i[0].ums_users_mobilePhoneNumber:"-"),t},getAssetDeviceID:function(e){var t="-",i=e.devices;return i&&i[0]&&(t=i[0].dms_devices_id),t},getAssetDeviceName:function(e){var t="-",i=e.devices;return i&&i[0]&&(t=i[0].dms_devices_name),t},getEnergyMappingOutdoorList:function(c){var p,u=new $.Deferred,g=b.getCurrentBuildingList();return $.ajax({url:"/foundation/space/floors"}).done(function(e){p=e,$.ajax({url:"/dms/devices?types=AirConditionerOutdoor&registrationStatuses=Registered&attributes=id,name,locations"}).done(function(e){var t,i,a,n,r,o,l,s,d=e.length;for(o=0;o<d;o++){if((t=e[o]).locations&&t.locations[0]){for(n=t.locations[0].foundation_space_buildings_id,r=t.locations[0].foundation_space_floors_id,s=g.length,l=0;l<s;l++)if(n==(i=g[l]).id){t.building_group_value=O.toString(i.sortOrder,"0000")+"_"+i.id+"_"+i.name;break}for(s=p.length,l=0;l<s;l++)if(r==(a=p[l]).id){t.floor_group_value=O.toString(a.sortOrder,"0000")+"_"+a.id+"_"+A.getFloorName(a);break}}for(t.assigned=!1,s=c.length,l=0;l<s;l++)if(t.id==c[l].dms_devices_id){t.assigned=!0;break}}u.resolve(e)}).fail(function(e){u.reject(e)})}).fail(function(e){u.reject(e)}),u.promise()},isEnableEnergyMappingType:function(e){var t,i,a=e.mappedType||e.type,n=e.meters;if(!n)return!1;var r,o=n.length;for(r=0;r<o;r++)"AirConditionerAll"==n[r].category&&(t=n[r].category),"AirConditionerOutdoor"==n[r].connectedDeviceType&&(i=n[r].connectedDeviceType);return!("Meter.WattHour"!=a||!t||!i)},getEnergyMappingFieldName:function(e){var t=0,i=e.meters;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("AirConditionerAll"==i[a].category&&"AirConditionerOutdoor"==i[a].connectedDeviceType){t=a;break}}return"meters["+t+"].connectedDevices"},getMeterConnectedDevices:function(e){var t=0,i=e.meters;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("AirConditionerAll"==i[a].category&&"AirConditionerOutdoor"==i[a].connectedDeviceType){t=a;break}}return i[t]&&i[t].connectedDevices?i[t].connectedDevices:null},getDeviceRegistrationFailMsg:function(e){return 406==e.status&&-1!=e.responseText.indexOf("Count")?y.prop("FACILITY_DEVICE_COUNT_EXCEEDED"):A.parseFailResponse(e)},getConnectedDevicesConsumptionTypeList:function(e){var t={AirConditionerAll:{name:y.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_SAC"),id:"AirConditionerAll"},Light:{name:y.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_LIGHT"),id:"Light"},Others:{name:y.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_OTHERS"),id:"Others"}},i=[];return i.push(t.AirConditionerAll),"Meter.WattHour"===e&&i.push(t.Light),i.push(t.Others),i},getConnectedDevicesConnectionTypeList:function(e,t){var i={None:{name:"None",id:"None"},AirConditioner:{name:A.getDetailDisplayTypeDeviceI18N("SAC Indoor"),id:"AirConditioner"},AirConditionerOutdoor:{name:A.getDetailDisplayTypeDeviceI18N("SAC Outdoor"),id:"AirConditionerOutdoor"},Boiler:{name:A.getDetailDisplayTypeDeviceI18N("Boiler"),id:"Boiler"},CoolingTower:{name:A.getDetailDisplayTypeDeviceI18N("CoolingTower"),id:"CoolingTower"},Pump:{name:A.getDetailDisplayTypeDeviceI18N("Pump"),id:"Pump"},WaterTank:{name:A.getDetailDisplayTypeDeviceI18N("WaterTank"),id:"WaterTank"}},a=[];return"AirConditionerAll"===t&&("Meter.WattHour"===e?a.push(i.AirConditioner,i.AirConditionerOutdoor,i.Pump,i.CoolingTower,i.Boiler):"Meter.Gas"===e?a.push(i.Boiler):"Meter.Water"===e&&a.push(i.WaterTank)),a.push(i.None),a},filterHasListAttrItem:function(e,t){return{field:e,operator:function(e){return e&&e.length?t:!t}}}}}),define("device/common/device-template",["device/common/device-util","device/common/device-constants"],function(N,c){"use strict";function t(e,t,i){var a=e.sender,n=a.dataSource.view(),r=$.grep(n,function(e){return"all"==e.name.toLowerCase()});if(r&&r.length){var o=a.element;o.find(".customStatisticRowStyles").remove();var l=a.items().first().clone();l.attr("data-uid",""),l.data("uid","");var s=l.find("td[role='gridcell']");if(!s.length)return;var d;if(r=r[0],a.dataSource.remove(r),d=r.name,$(s.get(0)).html(d),t){var c=void 0!==r.numberOfSubAssetTypes?r.numberOfSubAssetTypes:"-",p=void 0!==r.numberOfRegisteredAssets?r.numberOfRegisteredAssets:"-",u=void 0!==r.numberOfNormalDevices?r.numberOfNormalDevices:"-",g=void 0!==r.numberOfDisconnectedDevices?r.numberOfDisconnectedDevices:"-",f=void 0!==r.numberOfLowBatteryDevices?r.numberOfLowBatteryDevices:"-",m=void 0!==r.numberOfOutOfBoundsDevices?r.numberOfOutOfBoundsDevices:"-";$(s.get(1)).html(c),$(s.get(2)).html(p),$(s.get(3)).html(u),$(s.get(4)).html(g),$(s.get(5)).html(f).addClass("text-err"),$(s.get(6)).html(m).addClass("text-err")}else if(i)$(s.get(1)).html(Y(r)),$(s.get(2)).html(U(r)),$(s.get(3)).html(W(r)),$(s.get(4)).html(G(r)),$(s.get(5)).html(H(r)),$(s.get(6)).html(z(r)),$(s.get(7)).html(j(r)),$(s.get(8)).html(K(r));else{var v=V(r),T=x(r),I=F(r),E=P(r),C=k(r);$(s.get(1)).html(v);var _,h,b,w,A,y,O,L=s.length;if(7==L)_=void 0!==r.numberOfOnIndoorDevices?r.numberOfOnIndoorDevices:"-",h=void 0!==r.numberOfOnVentilatorDevices?r.numberOfOnVentilatorDevices:"-",b=void 0!==r.numberOfOnDHWDevices?r.numberOfOnDHWDevices:"-",w=void 0!==r.numberOfOffIndoorDevices?r.numberOfOffIndoorDevices:"-",A=void 0!==r.numberOfOffVentilatorDevices?r.numberOfOffVentilatorDevices:"-",y=void 0!==r.numberOfOffDHWDevices?r.numberOfOffDHWDevices:"-",O=void 0!==r.numberOfSchedules?r.numberOfSchedules:"-",$(s.get(2)).html(_+"/"+h+"/"+b),$(s.get(3)).html(w+"/"+A+"/"+y),$(s.get(4)).html(T).addClass("text-err"),$(s.get(5)).html(I).addClass("text-err"),$(s.get(6)).html(O);else if(6==L)$(s.get(2)).html(E),$(s.get(3)).html(C),$(s.get(4)).html(T).addClass("text-err"),$(s.get(5)).html(I).addClass("text-err");else if(5==L){var D;D=B(r),$(s.get(2)).html(D),$(s.get(3)).html(T).addClass("text-err"),$(s.get(4)).html(I).addClass("text-err")}}l.addClass("customStatisticRowStyles"),o.find(".k-grid-header table thead").append(l)}}var e=window.kendo,S=window.Util,R=window.I18N,w=window.GlobalSettings,M=w.getLocale(),p=w.getTemperature().unit,F=function(e){return'<span class="text-err">'+(void 0!==e.numberOfWarningDevices?e.numberOfWarningDevices:"-")+"</span>"},x=function(e){return'<span class="text-err">'+(void 0!==e.numberOfCriticalDevices?e.numberOfCriticalDevices:"-")+"</span>"},V=function(e){return void 0!==e.numberOfRegisteredDevices?e.numberOfRegisteredDevices:"-"},B=function(e){return void 0!==e.numberOfNormalDevices?e.numberOfNormalDevices:"-"},P=function(e){return void 0!==e.numberOfOnDevices?e.numberOfOnDevices:"-"},k=function(e){return void 0!==e.numberOfOffDevices?e.numberOfOffDevices:"-"},Y=function(e){return"<div class='tb beacon'><span class='tbc col-1'>"+V(e)+"</span></div>"},U=function(e){var t=void 0!==e.numberOfFixedDevices?e.numberOfFixedDevices:"-",i=void 0!==e.numberOfMovableDevices?e.numberOfMovableDevices:"-";return"<div class='tb beacon'><span class='tbc col-2'>"+R.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED_TYPE")+"</span><span class='tbc col-3'>"+t+"</span></div><div class='tb beacon'><span class='tbc col-2'>"+R.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE_TYPE")+"</span><span class='tbc col-3'>"+i+"</span></div>"},W=function(e){return"<div class='tb beacon'><span class='tbc col-4'>"+(void 0!==e.numberOfFixedNormalDevices?e.numberOfFixedNormalDevices:"-")+"</span></div><div class='tb beacon'><span class='tbc col-4'>"+(void 0!==e.numberOfMovableNormalDevices?e.numberOfMovableNormalDevices:"-")+"</span></div>"},G=function(e){return"<div class='tb beacon'><span class='tbc col-5'>"+(void 0!==e.numberOfFixedCriticalDevices?e.numberOfFixedCriticalDevices:"-")+"</span></div><div class='tb beacon'><span class='tbc col-5'>"+(void 0!==e.numberOfMovableCriticalDevices?e.numberOfMovableCriticalDevices:"-")+"</span></div>"},H=function(e){return"<div class='tb text-err beacon'><span class='tbc col-6'>"+(void 0!==e.numberOfFixedWarningDevices?e.numberOfFixedWarningDevices:"-")+"</span></div><div class='tb text-err beacon'><span class='tbc col-6'>"+(void 0!==e.numberOfMovableWarningDevices?e.numberOfMovableWarningDevices:"-")+"</span></div>"},z=function(e){return"<div class='tb text-err beacon'><span class='tbc col-7'>"+(void 0!==e.numberOfFixedLowBatteryDevices?e.numberOfFixedLowBatteryDevices:"-")+"</span></div><div class='tb text-err beacon'><span class='tbc col-7'>"+(void 0!==e.numberOfMovableLowBatteryDevices?e.numberOfMovableLowBatteryDevices:"-")+"</span></div>"},j=function(e){return"<div class='tb beacon'><span class='tbc col-8'>"+(void 0!==e.numberOfFixedSchedules?e.numberOfFixedSchedules:"-")+"</span></div><div class='tb beacon'><span class='tbc col-8'>"+(void 0!==e.numberOfMovableSchedules?e.numberOfMovableSchedules:"-")+"</span></div>"},K=function(e){return"<div class='tb beacon'><span class='tbc col-9'>"+(void 0!==e.numberOfFixedRules?e.numberOfFixedRules:"-")+"</span></div><div class='tb beacon'><span class='tbc col-9'>"+(void 0!==e.numberOfMovableRules?e.numberOfMovableRules:"-")+"</span></div>"},i='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</li><li><span class="disc r"></span>'+R.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+R.prop("FACILITY_DEVICE_STATUS_WARNING")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-peak"></Label>'+R.prop("FACILITY_INDOOR_STATUS_PEAK")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-deforest"></Label>'+R.prop("FACILITY_INDOOR_STATUS_DEFROST")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-filter" ></Label>'+R.prop("FACILITY_INDOOR_STATUS_FILTER_WARNING")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-rc-disable"></Label>'+R.prop("FACILITY_INDOOR_STATUS_RC_OFF")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-rock"></Label>'+R.prop("FACILITY_INDOOR_STATUS_OPERATION_LIMIT")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-thurmo"></Label>'+R.prop("FACILITY_INDOOR_TEMPERATURE_LIMIT")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-schedule"></Label>'+R.prop("FACILITY_DEVICE_SAC_INDOOR_SCHEDULE")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-spi"></Label>'+R.prop("FACILITY_INDOOR_CONTROL_SPI")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-antifreeze"></Label>'+R.prop("FACILITY_INDOOR_STATUS_FREEZE_PROTECTION")+"</li></ul></div>",a='<div class="flyoutBox lg"><ul class="legendList"><li><span class="disc g"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</li><li class="no-block"><span class="disc r"></span>'+R.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li class="no-block"><span class="disc y"></span>'+R.prop("FACILITY_DEVICE_STATUS_WARNING")+'</li></ul><ul class="legendList"><li><span class="disc gr"></span>'+R.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED")+'</li><li><span class="disc measured gr"></span>'+R.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE")+"</li></ul></div>",n='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+"</li></ul></div>",r='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</li><li><span class="disc r"></span>'+R.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+R.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li></ul></div></div>",o='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</li><li><span class="disc r"></span>'+R.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+R.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li></ul></div></div>",u=e.template('<span title="" class="k-widget k-dropdown k-header common-grid-dropdown sac-indoor-dropdownlist"unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-busy="false"aria-activedescendant="80142285-e564-4717-88fa-3dd3d64ad025" data-field="#=field#"><span unselectable="on" class="k-dropdown-wrap #if(disabled){#k-state-disabled#}else{#k-state-default#}#"><span unselectable="on" class="k-input">#=text#</span><span unselectable="on" class="k-select" aria-label="select"><span class="k-icon k-i-arrow-60-down"></span></span></span><input class="sac-indoor-dropdownlist current-limit" data-value="#=value#" style="display: none;"></span>');return{mapListTemplate:function(e){var t=!1,i=e.operations,a=e.type,n=e.modes,r=e.mappedType,o=e.name,l=e.id,s=S.getStatus(e);s&&"Alarm"==(s=1<(s=s.split(".")).length?(S.isOnlyNormalType(e)&&s[0],s[1]):"Off")[0]&&(t=!0);var d=e.modes;t?d=s[0]:d&&0<d.length&&(d=S.getDisplayMode(n,i));return'<div class="device-map-panel-list-item">'+("<span class='detail-img "+s+" "+d+"' data-status='"+s+"' data-mode='"+d+"' data-type='"+a+"' data-mapped-type='"+r+"'></span>")+("<div class='detail-text'><span class='id'>"+l+"</span><span class='name'>"+S.decodeHtml(o)+"</span></div>")+("<span class='ic ic-info' data-id='"+l+"'></span>")+"</div>"},multiDetailListTemplate:function(e,t){var i="",a="",n="",r="",o=e.operations,l=e.modes;n=e.name;var s=!1;(a=S.getStatus(e))&&"Alarm"==(a=1<(a=a.split(".")).length?(r=a[0],S.isOnlyNormalType(e)&&"Alarm"!=a[0]||(r+="("+a[1]+")"),a[1]):(r=a[0],"Off"))[0]&&(s=!0),i=e.modes,s?i=a[0]:i&&0<i.length&&(i=S.getDisplayMode(l,o));var d="",c=e.type;return t&&c&&-1==c.indexOf("AirConditioner.")&&(d=S.getDisplayClassType(e)),"<span class='detail-img "+a+" "+i+" "+d+"'></span>"+(n="<span data-bind='text: name'>"+S.decodeHtml(n)+"</span>")+(a="<span class='panel-item-temp'><span>"+S.getStatusI18N(r)+"</span></span>")},detailPopupGroupListTemplate:function(e){var t=e.dms_devices_name,i=e.dms_devices_id,a=e.dms_devices_type,n=e.dms_devices_mappedType;return"ControlPoint"!=n&&(a=n||a),'<div class="device-detail-popup-group-list-item">'+("<span class='detail-img reg selected "+(a=S.getDisplayClassType(a))+"'></span>")+("<div class='detail-text'><span class='id'>"+i+"</span><span class='name'>"+S.decodeHtml(t)+"</span></div>")+"</div>"},multiDetailRegisterListTemplate:function(e){var t="",i="",a="",n="",r=e.operations,o=e.modes;e.type;a=e.name;var l=!1,s="unreg";return"Registered"==e.registrationStatus&&(s="reg"),(i=S.getStatus(e))&&"Alarm"==(i=1<(i=i.split(".")).length?(n=i[0],S.isOnlyNormalType(e)&&"Alarm"!=i[0]||(n+="("+i[1]+")"),i[1]):(n=i[0],"Off"))[0]&&(l=!0),"Alarm"==i[0]&&(l=!0),l?t=i[0]:t&&0<t.length&&(t=S.getDisplayMode(o,r)),"<span class='detail-img "+s+" "+S.getDisplayClassType(e)+"'></span>"+(a="<span data-bind='text: name'>"+S.decodeHtml(a)+"</span>")+(i="<span class='panel-item-temp'><span>"+n+"</span></span>")},multiDetailListDualTemplate:function(e,t,i){var a="",n="",r="",o="",l=e.operations,s=e.modes,d=void 0!==e.assets_types_id,c="name";d?void 0!==e.number&&null!==e.number&&""!==e.number?(r=e.number,c="number"):e.devices&&e.devices[0]&&(r=e.devices[0].dms_devices_name,c="devices[0].dms_devices_name"):r=e.name;var p=!1;(n=S.getStatus(e))&&"Alarm"==(n=1<(n=n.split(".")).length?(o=n[0],S.isOnlyNormalType(e)&&"Alarm"!=n[0]||(o+="("+n[1]+")"),n[1]):(o=n[0],"Off"))[0]&&(p=!0),a=e.modes,p?a=n[0]:a&&0<a.length&&(a=S.getDisplayMode(s,l));var u=e.type,g="",f=S.getPositionType(e);return g=d?t?"-"!=f&&"Movable"==f?"asset "+e.assets_types_name.toLowerCase()+" movable-reg":"asset "+e.assets_types_name.toLowerCase()+" reg":("-"!=f&&"Movable"==f&&(g="asset "+e.assets_types_name.toLowerCase()+" "+n+" movable"),"asset "+e.assets_types_name.toLowerCase()+" "+n):t?"-"!=f&&"Movable"==f?S.getDisplayClassType(e)+" movable-reg":S.getDisplayClassType(e)+" reg":-1!=u.indexOf("AirConditioner.")?n+" "+a:"-"!=f&&"Movable"==f?n+" "+a+" "+S.getDisplayClassType(e)+" movable":n+" "+a+" "+S.getDisplayClassType(e),i&&(g+=" selected"),"<span class='detail-img "+g+"'></span>"+(r="<span data-bind='text: "+c+"'>"+S.decodeHtml(r)+"</span>")+(n="<span class='panel-item-temp'><span>"+S.getStatusI18N(o)+"</span></span>")},mapListRegTemplate:function(e){var t=!1,i=e.operations,a=e.type,n=e.modes,r=e.mappedType,o=e.name,l=e.id,s=S.getStatus(e);s&&"Alarm"==(s=1<(s=s.split(".")).length?(S.isOnlyNormalType(e)&&s[0],s[1]):"Off")[0]&&(t=!0);var d=e.modes;t?d=s[0]:d&&0<d.length&&(d=S.getDisplayMode(n,i)),a=e.type;return'<div class="device-map-panel-list-item">'+("<span class='detail-img reg "+S.getDisplayClassType(e)+"' data-status='"+s+"' data-mode='"+d+"' data-type='"+a+"' data-mapped-type='"+r+"'></span>")+("<div class='detail-text'><span class='id'>"+l+"</span><span class='name'>"+S.decodeHtml(o)+"</span></div>")+("<span class='ic ic-info' data-id='"+l+"'></span>")+"</div>"},mapListDualTemplate:function(e,t){var i=!1,a=e.operations,n=e.type,r=e.modes,o=e.mappedType,l=e.name,s=e.id,d=S.getStatus(e);d&&"Alarm"==(d=1<(d=d.split(".")).length?(S.isOnlyNormalType(e)&&d[0],d[1]):"Off")[0]&&(i=!0);var c=e.modes;i?c=d[0]:c&&0<c.length&&(c=S.getDisplayMode(r,a)),n=e.type;var p=S.getPositionType(e);return'<div class="device-map-panel-list-item">'+("<span class='detail-img "+(t?"-"!=p&&"Movable"==p?S.getDisplayClassType(e)+" movable-reg":S.getDisplayClassType(e)+" reg":-1!=n.indexOf("AirConditioner.")?d+" "+c:"-"!=p&&"Movable"==p?d+" "+c+" "+S.getDisplayClassType(e)+" movable":d+" "+c+" "+S.getDisplayClassType(e))+"' data-status='"+d+"' data-mode='"+c+"' data-type='"+n+"' data-mapped-type='"+o+"'></span>")+("<div class='detail-text'><span class='id'>"+s+"</span><span class='name'>"+S.decodeHtml(l)+"</span></div>")+("<span class='ic ic-info' data-id='"+s+"'></span>")+"</div>"},getDeviceCardTemplate:function(e){var t=S.getStatus(e);t=t.replace(".","-");var i=N.getLocation(e),a=$("<div/>"),n=$("<div/>").addClass("engCardWrap").attr("data-uid",e.uid).attr("data-id",e.id);e.selected&&n.addClass("k-state-selected");var r=$("<div/>").addClass("engCard "+t),o=$("<div/>").addClass("tb icon"),l=$("<div/>").addClass("bound"),s=e.type,d=e.mappedType,c=void 0!==e.assets_types_id,p="ic-energy";s?-1!=s.indexOf("Light")||d&&-1!=d.indexOf("Light")?p="ic-light":-1!=s.indexOf("SmartPlug")?p="ic-smartplug":-1!=s.indexOf("Temperature")||-1!=s.indexOf("Humidity")||d&&-1!=d.indexOf("Temperature")||d&&-1!=d.indexOf("Humidity")?p="ic-temperature":-1!=s.indexOf("Gateway")?p="ic-gateway":-1!=s.indexOf("Beacon")?p="ic-beacon":-1!=s.indexOf("CCTV")?p="ic-cctv":(-1!=s.indexOf("Motion")||d&&-1!=d.indexOf("Motion"))&&(p="ic-motion"):c&&(p="asset "+e.assets_types_name.toLowerCase());var u=$("<span/>").addClass("dvcic "+p);l.append(u),o.append(l),r.append(o);var g=$("<div/>").addClass("txtwrap"),f=t.split("-"),m="";if("Normal"==f[0]){var v;s&&-1!=s.indexOf("Meter")||d&&-1!=d.indexOf("Meter")?(v="Meter.Gas"==s||"Meter.Gas"==d?S.CHAR.Gas:"Meter.WattHour"==s||"Meter.WattHour"==d?S.CHAR.WattHour:"Meter.Water"==s||"Meter.Water"==d?S.CHAR.Water:"",t=N.getMeterCurrentConsumption(e),t+="<span class='unit'>"+v+"</span>"):s&&-1!=s.indexOf("Temperature")||d&&-1!=d.indexOf("Temperature")?(t=N.getTempHumiTemperature(e,!0),t+="<span class='unit'>"+(v=S.CHAR[w.getTemperature().unit])+"</span>"):s&&-1!=s.indexOf("Humidity")||d&&-1!=d.indexOf("Humidity")?(v=S.CHAR.Humidity,t=N.getTempHumiHumidity(e,!0),t+="<span class='unit'>"+v+"</span>"):s&&-1!=s.indexOf("Motion")||d&&-1!=d.indexOf("Motion")?t=N.getMotionPresence(e):(t=f[0],S.isOnlyNormalType(e)&&"Alarm"!=t[0]||(t+="("+f[1]+")"))}else{t=f[1];var T=S.getRecentAlarm(e);T&&(m=c||s&&("Beacon"==s||"Gateway"==s||"CCTV"==s)?S.getAlarmDescription(T.name):"Code "+T.name)}var I=$("<p/>").addClass("cardName ellp").html(S.getStatusI18N(t)),E=$("<p/>").addClass("cardDesc ellp").text(m),C=$("<p/>").addClass("loc ellp").text(i),_="";_=c?e.number:e.name;var h=$("<p/>").addClass("dvc ellp").text(_),b=$("<i/>").addClass("ic ic-info").attr("data-id",e.id);return g.append(I),g.append(E),g.append(C),g.append(h),g.append(b),r.append(g),n.append(r),a.append(n),a.html()},statisticNumberOfCritical:x,statisticNumberOfWarning:F,statisticNumberOfRegisteredDevice:V,statisticNumberOfNormalDevices:B,statisticNumberOfOnDevices:P,statisticNumberOfOnIndoorDevices:function(e){return(void 0!==e.numberOfOnIndoorDevices?e.numberOfOnIndoorDevices:"-")+"/"+(void 0!==e.numberOfOnVentilatorDevices?e.numberOfOnVentilatorDevices:"-")+"/"+(void 0!==e.numberOfOnDHWDevices?e.numberOfOnDHWDevices:"-")},statisticNumberOfOffDevices:k,statisticNumberOfOffIndoorDevices:function(e){return(void 0!==e.numberOfOffIndoorDevices?e.numberOfOffIndoorDevices:"-")+"/"+(void 0!==e.numberOfOffVentilatorDevices?e.numberOfOffVentilatorDevices:"-")+"/"+(void 0!==e.numberOfOffDHWDevices?e.numberOfOffDHWDevices:"-")},getStatusTemplate:function(e){var t=S.getStatus(e);return"<div><span class='circle-icon "+(t=t.replace(".","-"))+"'></span></div>"},getStatisticRow:t,getAssetStatusTemplate:function(e){var t=S.getAssetStatus(e);return"<div><span class='circle-icon "+(t=t.replace(".","-"))+"'></span></div>"},assetMapListRegTemplate:function(e){var t=e.assets_types_name,i=e.number,a=e.id,n=e.subAssetType;n&&(t+=" / "+n);var r=S.getStatus(e);r&&(r=1<(r=r.split(".")).length?(S.isOnlyNormalType(e)&&r[0],r[1]):"Off")[0];var o=S.getPositionType(e);return'<div class="device-map-panel-list-item">'+("<span class='detail-img asset "+r+" "+("-"!=o&&"Movable"==o?S.getDisplayClassType(e)+" movable":S.getDisplayClassType(e))+"' data-status='"+r+"'></span>")+("<div class='detail-text'><span class='id'>"+i+"</span><span class='name'>"+S.decodeHtml(t)+"</span></div>")+("<span class='ic ic-info' data-id='"+a+"'></span>")+"</div>"},getStatisticRowAsset:function(e){t(e,!0)},getStatisticRowBeacon:function(e){t(e,!1,!0)},statisticAssetFloor:function(e){return e.isSubAsset?"":e.name?e.name:"-"},statisticAssetTypes:function(e){var t="-";e.isSubAsset?t=(void 0!==e.assets_types_name?e.assets_types_name:"-")+(void 0!==e.assets_subAssetType?" / "+e.assets_subAssetType:""):t=void 0!==e.numberOfSubAssetTypes?e.numberOfSubAssetTypes:"-";return t},statisticAssetRegisteredAssets:function(e){return void 0!==e.numberOfRegisteredAssets?e.numberOfRegisteredAssets:"-"},statisticAssetNormalDevices:function(e){return void 0!==e.numberOfNormalDevices?e.numberOfNormalDevices:"-"},statisticAssetCriticalDevices:function(e){return void 0!==e.numberOfCriticalDevices?e.numberOfCriticalDevices:"-"},statisticAssetWarningDevices:function(e){return void 0!==e.numberOfWarningDevices?e.numberOfWarningDevices:"-"},statisticAssetDisconnectedDevices:function(e){return void 0!==e.numberOfDisconnectedDevices?e.numberOfDisconnectedDevices:"-"},statisticAssetLowBatteryDevices:function(e){return"<span class='text-err'>"+(void 0!==e.numberOfLowBatteryDevices?e.numberOfLowBatteryDevices:"-")+"</span>"},statisticAssetOutOfBoundsDevices:function(e){return"<span class='text-err'>"+(void 0!==e.numberOfOutOfBoundsDevices?e.numberOfOutOfBoundsDevices:"-")+"</span>"},assetTypeListTemplate:function(e){var t=e.name;return"<span class='detail-img asset "+t.toLowerCase()+"'></span>"+("<span data-bind='text: name'>"+S.decodeHtml(t)+"</span>")+"<span class='panel-item-temp'><span></span></span>"},statisticBeaconRegister:Y,statisticBeaconPositionType:U,statisticBeaconNormal:W,statisticBeaconDisconnected:G,statisticBeaconWrongLocation:H,statisticBeaconLowBattery:z,statisticBeaconSchdules:j,statisticBeaconRules:K,detailStatusIconTemplate:function(e){var t=S.getStatus(e),i=t.split("."),a="<span class='circle-icon detail-popup "+i[0]+"-"+i[1]+"'></span>";if(-1<t.indexOf("Alarm")){var n=$("<div/>");t=t.replace(".","-");var r=S.getRecentAlarm(e),o=r.type,l=R.prop("FACILITY_DEVICE_STATUS_POPUP_"+o.toUpperCase());o=l||o;var s=$("<span/>").addClass(t).text(o+" "+R.prop("COMMON_CODE")+" "+r.name),d=$("<span/>").text(S.getAlarmDescription(r.name));return n.append(a),n.append(s),n.append("<br>"),n.append(d),n.html()}var c=i[0];return S.isOnlyNormalType(e)&&"Alarm"!=t[0]||(c+="("+i[1]+")"),a+S.getStatusI18N(c)},detailIconTemplateById:function(e){return'<span class="ic ic-info" data-num="detail" data-id='+e.id+' data-event="devicedetail"></span>'},indoorLegendTemplate:i,beaconLegendTemplate:a,pointLegendTemplate:n,baseLegendTemplate:r,legendTemplate:o,indoorTemperatureListTemplate:function(e){var t,i=$("<div/>"),a=$("<div/>"),n=S.getRecentAlarm(e),r=S.getStatus(e).replace(".","-");if(n){var o=R.prop("COMMON_CODE")+" "+n.name;t=$("<span/>").addClass(r).text(o),a.append(t),i.append(a)}else{var l,s,d=N.getTemperatures(e,!0);l=d.current,s=d.desired,t=$("<span/>").addClass(r).addClass("current").text(l);var c=$("<span/>").addClass(r).addClass("set").text(s);if(a.append(c),a.append(" / "),a.append(t),i.append(a),d.dhwDesired||d.dhwCurrent){var p=$("<div/>"),u=$("<span/>").addClass(r).addClass("current").text(d.dhwCurrent),g=$("<span/>").addClass(r).addClass("set").text(d.dhwDesired);p.append(g),p.append(" / "),p.append(u),i.append(p)}}return i.html()},indoorCardTemplate:function(e){var t,i=S.getDisplayMode(e.modes,e.operations),a=S.getStatus(e);a=a.replace(".","-"),e.information&&e.information.modelName&&(t="I"+e.information.modelName.toUpperCase().replace(/\s/gi,"").replace("+","PLUS"));var n=$("<div/>"),r=$("<div/>").addClass("card-item").attr("data-uid",e.uid).attr("data-id",e.id);e.selected&&r.addClass("k-state-selected");var o=$("<div/>"),l=$("<div/>").addClass("icon-line"),s=$("<div/>").addClass("card-info"),d=$("<div/>").addClass("left"),c=$("<div/>").addClass("right"),p=$("<span/>").addClass("type").addClass(a),u=$("<div/>").addClass("item-bottom"),g=e.name;g&&10<g.length&&(g=g.substring(0,10),g+="...");var f,m=$("<span/>").addClass("device-type-img "+t).text(g),v=S.getRecentAlarm(e);if(v){f="error",o.addClass("card-back "+a),p.text(" "),l.append("<div class='icon empty'/>");var T=a.split("-")[1];T="<span class='error'>"+(T=R.prop("FACILITY_INDOOR_MODE_"+T.toUpperCase()))+"</p><p>"+R.prop("COMMON_CODE")+" "+v.name+"</p>";var I=$("<span/>").addClass("error "+a).html(T);c.append(I),u.addClass("error")}else{var E;"HotWater"===i&&(i="HeatStorage"),f=N.convertDisplayName(i),"HeatStorage"===(E="ko"==M?S.getModeToI18N(i):f)?p.text("H.Water"):p.text(E);var C,_,h,b=N.getGridIcon(e),w=N.getTemperatures(e);if(C=w.current,_=w.desired,h=w.unit,b.length)for(var A=0,y=b.length;A<y;A++)l.append('<div class="icon '+b[A]+'"/>');else l.append("<div class='icon empty'/>");var O=$("<span/>").addClass(a).addClass("set");w.isWaterout&&$("<div/>").addClass("icon ic-dhwtemp-card").appendTo(O),$("<em/>").text(R.prop("FACILITY_INDOOR_SET")).appendTo(O),O.append(_),O.attr("data-content",h);var L=$("<span/>").addClass(a).addClass("current");$("<em/>").text(R.prop("FACILITY_INDOOR_CURRENT")).appendTo(L),L.append(C),L.attr("data-content",h),c.append(O),c.append(L)}var D=$("<span/>").addClass("device-img "+f+" "+a);return d.append(p),d.append(D),s.append(d),s.append(c),u.append(m),u.append('<i class="ic ic-info" data-id='+e.id+">"),o.append(l),o.append(s),o.append(u),r.append(o),n.append(r),n.html()},outdoorDropDownListTemplate:u,outdoorCurrentLimitTemplate:function(e){var t,i,a="-",n=e.airConditioner;n&&(i=n.outdoorUnit)&&(t=a=(a=i.electricCurrentControl)||"-",isNaN(a)?t=R.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"):t+="%");var r=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").text(R.prop("FACILITY_INDOOR_CURRENT")+": "+t).appendTo(r);var o=e.airConditioner,l=!1;return o&&(i=o.outdoorUnit),i&&(l=!i.electricCurrentControlSupported),"-"==a&&(a=c.outdoorControlConfig.electricCurrentControl[0].value),$(u({value:a,text:t,disabled:l,field:"electricCurrentControl"})).addClass("outdoor-dropdownlist").appendTo(r),r.html()},outdoorHeatingCapacityCalibrationTemplate:function(e){var t,i,a="-",n=e.airConditioner;n&&(i=n.outdoorUnit)&&(t=a=(a=i.heatingCapacityCalibration)||"-",isNaN(a)?t=R.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"):t+="kg/cm\xb2");var r=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").text(R.prop("FACILITY_INDOOR_CURRENT")+": "+t).appendTo(r);var o=e.airConditioner,l=!1;return o&&(i=o.outdoorUnit),i&&(l=!i.heatingCapacityCalibrationSupported),"-"==a&&(a=c.outdoorControlConfig.heatingCapacityCalibration[0].value),$(u({value:a,text:t,disabled:l,field:"heatingCapacityCalibration"})).addClass("outdoor-dropdownlist").appendTo(r),r.html()},outdoorCoolingCapacityCalibrationTemplate:function(e){var t,i,a="-",n=e.airConditioner;if(n&&(i=n.outdoorUnit))if("SelfControl"!=(a=(a=i.coolingCapacityCalibration)||"-")){var r=c.outdoorControlConfig.coolingCapacityCalibration[p],o=$.grep(r,function(e){return e.value==a});t=o[0]?o[0].text:"-"}else t=R.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL");var l=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").appendTo(l).text(R.prop("FACILITY_INDOOR_CURRENT")+": "+t);var s=e.airConditioner,d=!1;return s&&(i=s.outdoorUnit),i&&(d=!i.coolingCapacityCalibrationSupported),"-"==a&&(a=c.outdoorControlConfig.coolingCapacityCalibration[p][0].value),$(u({value:a,text:t,disabled:d,field:"coolingCapacityCalibration"})).addClass("cooling-capacity-calibaration-dropdownlist").addClass("outdoor-dropdownlist").appendTo(l),l.html()},pointTypeTemplate:function(e){return e.type.replace("ControlPoint.","")},pointValueTemplate:function(e){if(!e.controlPoint)return"-";var t=e.controlPoint.value,i=e.type;return-1!=i.indexOf("AO")||-1!=i.indexOf("AV")?'<input class="device-point-numeric" data-type="aoav" value="'+t+'" style="width:50%; text-align:center;"/><button class="device-point-sendbtn">'+R.prop("COMMON_BTN_SEND")+"</button>":-1!=i.indexOf("DO")||-1!=i.indexOf("DV")?'<input class="device-point-numeric" data-type="dodv" value="'+t+'" style="width:50%; text-align:center;"/><button class="device-point-sendbtn">'+R.prop("COMMON_BTN_SEND")+"</button>":t},gatewayListZigbeeTemplate:function(e){var t=N.getZigbeeStatus(e).split(".");return"<span class='circle-icon detail-popup "+t[0]+"-"+t[1]+"'></span>"},gatewayListBleTemplate:function(e){var t=N.getBleStatus(e).split(".");return"<span class='circle-icon detail-popup "+t[0]+"-"+t[1]+"'></span>"},gatewayListBleInterfaceTemplate:function(e){var t,i,a="";for(t=0;t<3;t++)a+="<span class='beacon-status'><span class='circle-icon detail-popup "+(i=N.getBleInterfaceStatus(e,t).split("."))[0]+"-"+i[1]+"'></span></span>";return a},bleMacAddressTemplate:function(e){return"<span class='ellipse'>"+N.getBleMacAddress(e)+"</span>"},bleUUIDTemplate:function(e){return"<span class='ellipse'>"+N.getBleUUID(e)+"</span>"}}}),define("device/common/config/light-control-vm",[],function(){var t=window.CommonLoadingPanel,d=window.kendo,e=window.I18N;function c(e){var t,i=e.dataSource.data(),a=i.length,n=[];for(t=0;t<a;t++)n.push({id:i[t].id,type:i[t].type});return n}function p(e,t){var i,a,n,r,o,l=t.dataSource,s=e.length;for(o=0;o<s;o++)r=(n=e[o]).id,(a=l.get(r))&&(n.operations&&a.set("operations",n.operations),n.lights&&a.set("lights",n.lights),a.locations&&((i=a.locations)instanceof d.data.ObservableObject&&(i=i.toJSON()),n.locations=i));l.fetch(),e.length<=1&&t._renderHeaderTemplate(),t.trigger("onSaved",{sender:t,result:e[0],results:e,hideMessagePopup:!0})}return $("<div/>").kendoCommonDialog().data("kendoCommonDialog"),{lightControlTemplate:'<div class="group-control-dialog-control groupControl"><div class="controllerList noarr"><div class="horzline"></div><div class="typename">'+e.prop("FACILITY_DEVICE_TYPE_LIGHT")+'</div><div class="innerBox"><div class="innerSet"><button type="button" class="controlBtn" data-bind="events:{click:light.power.click}, css:{selected:light.power.active}, invisible:light.power.invisible"><span class="icwrap"><i class="ic power"></i><span data-bind="visible:light.power.active">ON<span data-bind="visible:light.power.mixed">/OFF</span></span><span data-bind="invisible:light.power.active">OFF</span></span></button><p class="bluetit" data-bind="invisible:light.invisible">'+e.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS")+' (0 ~ 100 %)</p><div class="tb slider" data-bind="invisible:light.invisible"><div class="tbc"><div class="customSlider"><input style="width:160px;" data-bind="value:light.value,events:{slide:light.slide}" data-role="slider" data-show-buttons="false" data-tooltip="{enabled:false, format:\'{0}\'}" data-tick-placement="none" data-min="0" data-max="100" data-small-step="1" data-large-step="1"/><span class="valTxt"><span data-bind="text:light.value"></span>%</span></div></div></div></div></div></div></div>',lightControlViewModel:d.observable({init:function(e){this.popup=e,this.popup.Loading=new t(this.popup.element),this.light.init()},popup:null,light:{init:function(){this.power.set("active",!1),this.power.set("invisible",!1),this.set("invisible",!1),this.set("value",50)},timeout:null,invisible:!1,value:50,power:{invisible:!1,active:!1,mixed:!1,click:function(e){var t=this.light,i=t.power.get("active");t.power.set("active",!i),t.power.set("mixed",!1),function(e,t){var i=e.Loading;i.open();var a=c(e),n={id:"General"};n.power=t.power.get("active")?"On":"Off";var r,o,l=a.length,s=[];for(r=0;r<l;r++)o={id:a[r].id,operations:[n]},s.push(o);p(s,e),i.close()}(this.popup,this.light)}},slide:function(e){var t=this.light,i=this.popup;t.set("value",e.value),t.timeout&&(clearTimeout(t.timeout),t.timeout=null),t.timeout=setTimeout(function(){!function(e,t){var i=e.Loading;i.open();var a=c(e),n=t.get("value"),r=[];r.push({id:1,dimmingLevel:n});var o,l,s=a.length,d=[];for(o=0;o<s;o++)l={id:a[o].id,lights:r},d.push(l);p(d,e),i.close()}(i,t)},500)}}})}}),define("device/common/config/smartplug-control-vm",[],function(){var t=window.CommonLoadingPanel,d=window.kendo,e=window.I18N;function c(e){var t,i=e.dataSource.data(),a=i.length,n=[];for(t=0;t<a;t++)n.push({id:i[t].id,type:i[t].type});return n}function p(e,t){var i,a,n,r,o,l=t.dataSource,s=e.length;for(o=0;o<s;o++)r=(n=e[o]).id,(a=l.get(r))&&(n.operations&&a.set("operations",n.operations),n.lights&&a.set("lights",n.lights),a.locations&&((i=a.locations)instanceof d.data.ObservableObject&&(i=i.toJSON()),n.locations=i));l.fetch(),e.length<=1&&t._renderHeaderTemplate(),t.trigger("onSaved",{sender:t,result:e[0],results:e,hideMessagePopup:!0})}return $("<div/>").kendoCommonDialog().data("kendoCommonDialog"),{smartPlugControlTemplate:'<div class="group-control-dialog-control groupControl"><div class="controllerList noarr"><div class="horzline"></div><div class="typename">'+e.prop("FACILITY_DEVICE_TYPE_SMART_PLUG")+'</div><div class="innerBox"><div class="innerSet"><button type="button" class="controlBtn" data-bind="events:{click:smartPlug.power.click}, css:{selected:smartPlug.power.active}, invisible:smartPlug.power.invisible"><span class="icwrap"><i class="ic power"></i><span data-bind="visible:smartPlug.power.active">ON</span><span data-bind="invisible:smartPlug.power.active">OFF</span></span></button></div></div></div></div>',smartPlugControlViewModel:d.observable({init:function(e){this.popup=e,this.popup.Loading=new t(this.popup.element),this.smartPlug.init()},popup:null,smartPlug:{init:function(){this.power.set("active",!1),this.power.set("invisible",!1),this.set("invisible",!1),this.set("value",50)},timeout:null,invisible:!1,value:50,power:{invisible:!1,active:!1,click:function(e){var t=this.smartPlug,i=t.power.get("active");t.power.set("active",!i),function(e,t){var i=e.Loading;i.open();var a=c(e),n={id:"General"};n.power=t.power.get("active")?"On":"Off";var r,o,l=a.length,s=[];for(r=0;r<l;r++)o={id:a[r].id,operations:[n]},s.push(o);p(s,e),i.close()}(this.popup,this.smartPlug)}},slide:function(e){var t=this.smartPlug,i=this.popup;t.set("value",e.value),t.timeout&&(clearTimeout(t.timeout),t.timeout=null),t.timeout=setTimeout(function(){!function(e,t){var i=e.Loading;i.open();var a=c(e),n=t.get("value"),r=[];r.push({id:1,dimmingLevel:n});var o,l,s=a.length,d=[];for(o=0;o<s;o++)l={id:a[o].id,lights:r},d.push(l);p(d,e),i.close()}(i,t)},500)}}})}}),define("device/common/config/popup-config",["device/common/device-util","device/common/device-template","device/common/config/light-control-vm","device/common/config/smartplug-control-vm"],function(I,n,E,m){var v,g,c,r=window.I18N,o=window.MAIN_WINDOW,C=window.Util,e=window.CommonLoadingPanel,_=window.kendo,p=window.moment,T=new e,t=$("#device-detail-popup"),i=$("#device-detail-map-popup"),a=$("#device-history-message-popup"),l=$("#device-history-confirm-popup"),d=[];g=i.kendoCommonDialog({title:"Map",timeout:0,width:700,height:680,actions:[{text:r.prop("COMMON_BTN_CANCEL")},{text:r.prop("COMMON_BTN_SAVE")}]}).data("kendoCommonDialog");var s={height:"100%",scrollable:!1,sortable:!1,filterable:!1,pageable:!1,rowHeaders:!0},u=r.prop("FACILITY_HISTORY"),f=r.prop("FACILITY_HISTORY_CONTROLLED_TIME"),h=r.prop("FACILITY_HISTORY_LOCATION"),b=r.prop("FACILITY_HISTORY_CONTROL_BY"),w=r.prop("FACILITY_HISTORY_CONTROL_TYPE"),A=r.prop("FACILITY_HISTORY_OPERATION"),y=r.prop("FACILITY_HISTORY_DETAIL"),O=r.prop("FACILITY_HISTORY_GROUP"),L={"b.IoT":r.prop("FACILITY_HISTORY_QUADURON"),Others:r.prop("FACILITY_HISTORY_OTHERS")},D={Manual:r.prop("FACILITY_HISTORY_MANUAL"),Rule:r.prop("FACILITY_HISTORY_RULE"),Schedule:r.prop("FACILITY_HISTORY_SCHEDULE")};c=a.kendoCommonDialog().data("kendoCommonDialog"),l.kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog");var N=$("#popup-history").kendoPopupSingleWindow({title:u,width:"1296px",deactivate:function(){$("<div class='k-overlay' style='dislay:block; z-index:10002; opacity:0.5;'></div>").appendTo($("body"))}});N.closest(".popup-window").addClass("popup-device-history");var S=_.data.Model.define({fields:{time:{name:f,type:"string"},location:{name:h,type:"string"},group:{name:O,type:"string"},systemOrigin:{name:b,type:"string"},serviceOrigin:{name:w,type:"string"},attributes:{name:A,type:"string"}}});$("#popup-history-detail").kendoPopupSingleWindow({model:S,title:y,width:"600px"});var R=[{field:"time",title:f,width:200,template:function(e){var t=e.time;return p(t).format("LLL").replace(/\./g,"-")}},{field:"location",title:h,width:200,sortable:!1},{field:"systemOrigin",title:b,width:200,sortable:!1,template:function(e){var t=L[e.systemOrigin];return t=t||r.prop("FACILITY_HISTORY_OTHERS")}},{field:"serviceOrigin",title:w,width:200,sortable:!1,template:function(e){var t=D[e.serviceOrigin];return t=t||r.prop("FACILITY_HISTORY_OTHERS")}},{field:"attributes",title:A,sortable:!1,template:function(e){var t,i,a,n,r="",o="",l=e.attributes,s=l.length;if(l)for(var d=0;d<l.length;d++){for(var c=l[d],p=(t=c.key.split("-")).length-1;0<=p;p--)o+=t[p];1<t.length&&(o=(o=t[t.length-2]+"_"+t[t.length-1]).replace(/-|\./g,"_")),o=o.toUpperCase(),i=c.value,-1<o.indexOf("DIMMINGLEVEL")&&(o="DIMMINGLEVEL"),a=C.getHistoryOperation(o),n=-1!=o.indexOf("VALUE")||-1!=o.indexOf("DESIRED")||-1!=o.indexOf("LEVEL")?C.getHistoryOperationValue("FACILITY_HISTORY_OPERATION_"+o+"_VALUE",i.toUpperCase()):(-1!=i.indexOf("~")&&(i=i.replace("~","_")),C.getHistoryOperationValue("FACILITY_HISTORY_OPERATION_"+o+"_"+i.toUpperCase())),r=1<s?"<div style='text-align:center;'>"+a+" / "+n+"<span> (+"+(s-1)+")</span></div>":"<div style='text-align:center;'>"+a+" / "+n+"</div>";break}else r="<div style='text-align:center;'><span>-<span></div>";return r}},{title:y,template:"<span class='ic ic-info' data-event='detail'></span>",sortable:!1,width:"66px"}],M=$(".popup-device-history .device-history-grid").kendoGrid({dataSource:[],scrollable:{virtual:!0},sortable:!0,height:"100%",columns:R});M.data("kendoGrid").dataSource.sort([{field:"time",dir:"desc"}]);var F=new Date,x=$("#popup-history").find("input.startdate"),V=$("#popup-history").find("input.enddate");function B(){var e=x.data("kendoCommonDatePicker").value(),t=V.data("kendoCommonDatePicker").value(),i=(t.getTime()-e.getTime())/864e5,a=e,n=e,r=new Date;365<i&&(t=new Date(e.getFullYear()+1,e.getMonth(),e.getDate())),t<e&&(e=a,0<(t=n)-r&&(e=new Date,t=new Date)),0<t-r&&(t=new Date),e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59),x.data("kendoCommonDatePicker").setDate(e),V.data("kendoCommonDatePicker").setDate(t)}function P(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1),e.sender.trigger("onClosed")}function k(e){return e.sender.trigger("onEdit"),e.sender.setEditable(!0),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!1}),e.sender.setActions(e.sender.BTN.DEREGISTER,{visible:!1}),e.sender.trigger("onEdited"),!1}function Y(e){e.sender.confirmDialog.message(r.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL"));function t(){e.sender.trigger("onCancel"),e.sender.cancelDataSource(),e.sender.setEditable(!1),e.sender.setDialogType(e.sender.dialogType),e.sender.hideInvalidMessage(),e.sender.hideRemoveBtn(),e.sender.trigger("onCanceled")}return e.sender.hasChanged?(e.sender.confirmDialog.setConfirmActions({yes:function(){t()}}),e.sender.confirmDialog.open()):t(),!1}function U(e){e.sender.trigger("onSave");var t,i,a=e.sender.dialogType;return(t=e.sender.save())&&(e.sender.isBlockEvt&&(delete e.sender.isBlockEvt,a="block"),"register"==a?(1<e.sender.dataSource.total()&&(i=e.sender.saveAll({registrationStatus:"Registered"})),t.registrationStatus="Registered",e.sender.trigger("onRegister",{sender:e.sender,result:t,results:i}),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!0}),void 0!==e.sender.BTN.BLOCK&&e.sender.setActions(e.sender.BTN.BLOCK,{visible:!1})):"block"==a?(1<e.sender.dataSource.total()&&(i=e.sender.saveAll({registrationStatus:"Blocked"})),t.registrationStatus="Blocked",e.sender.trigger("onBlock",{sender:e.sender,result:t,results:i}),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!0}),e.sender.setActions(e.sender.BTN.BLOCK,{visible:!1})):(1<e.sender.dataSource.total()&&(i=e.sender.saveAll(null,!0)),e.sender.trigger("onSaved",{sender:e.sender,result:t,results:i}),"deregister"==a?e.sender.setActions(e.sender.BTN.DEREGISTER,{visible:!0}):"delete"==a&&e.sender.setActions(e.sender.BTN.DELETE,{visible:!0})),e.sender.setEditable(!1),void 0!==e.sender.BTN.BLOCK&&"delete"!=a&&e.sender.setActions(e.sender.BTN.DELETE,{visible:!1}),"register"!=a&&"block"!=a||e.sender.setActions(e.sender.BTN.EDIT,{visible:!1})),!1}function W(e){return e.sender.setEditable(!0),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!1}),void 0!==e.sender.BTN.BLOCK&&e.sender.setActions(e.sender.BTN.BLOCK,{visible:!1}),!1}function G(e){var t,i=e.sender.getSelectedData(),a={};if(a.registrationStatus="NotRegistered",1<e.sender.dataSource.total()){var n,r,o=(i=(i=e.sender.dataSource.data()).toJSON()).length;for(t=[],n=0;n<o;n++)(r={}).id=i[n].id,r.registrationStatus="NotRegistered",t.push(r)}else a.id=i.id;return e.sender.trigger("onDeregister",{sender:e.sender,result:a,results:t}),!1}function H(e){var t=e.type,i=e.sender.BTN;"register"==t?(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.EDIT,{visible:!1}),v.setActions(i.DEREGISTER,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.REGISTER,{visible:!0})):"deregister"==t?(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.REGISTER,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.EDIT,{visible:!0}),v.setActions(i.DEREGISTER,{visible:!0})):(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.DEREGISTER,{visible:!1}),v.setActions(i.REGISTER,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.EDIT,{visible:!0}))}x.kendoCommonDatePicker({value:new Date(F.getFullYear(),F.getMonth(),1,0,0,0),isStart:!0,isEnd:!1,okCallBack:B}),V.kendoCommonDatePicker({value:new Date(F.getFullYear(),F.getMonth(),F.getDate(),23,59,59),isStart:!1,isEnd:!0,okCallBack:B}),x.data("kendoCommonDatePicker").value(),V.data("kendoCommonDatePicker").value(),N.on("click","input[data-attr=All]",function(){var e=$(this),t=e.closest(".popup-window-single"),i=t.find("input.history-control-type"),a=t.find("button[data-event=view]");e.is(":checked")?(i.each(function(e,t){t.checked=!0}),a.data("kendoButton").enable(!0)):(i.each(function(e,t){t.checked=!1}),a.data("kendoButton").enable(!1))}),N.on("click","input.history-control-type",function(){var e=$(this),t=e.closest(".popup-window-single"),i=t.find("input[data-attr=All]"),a=t.find("input.history-control-type"),n=t.find(".toolbar-content.controlType").find(".history-control-type:checked"),r=t.find("button[data-event=view]");0==e.is(":checked")?(i.prop("checked",!1),0==n.length&&r.data("kendoButton").enable(!1)):(n.length==a.length&&i.prop("checked",!0),r.data("kendoButton").enable(!0))}),N.on("click","button[data-event=view]",function(){var e,i,t=$(this).closest(".popup-window-single"),a="",n=t.find("input.startdate").data("kendoCommonDatePicker").getDate(),r=t.find("input.enddate").data("kendoCommonDatePicker").getDate(),o=t.data("curDmsId"),l=t.find(".toolbar-content.controlType").find("input:checked");for(i=0;i<l.length;i++){var s=l.eq(i).attr("data-attr");"All"!==s&&(i<l.length-1?a+=s+",":a+=s)}e="/dms/controlHistories?dms_devices_id="+o+"&serviceOrigins="+a+"&startTime="+(n=n.replace("+","%2b"))+"&endTime="+(r=r.replace("+","%2b")),T.open(t),$.ajax({url:e}).done(function(e){if(e){for(i=e.length-1;0<=i;i--)null===e[i]&&e.splice(i,1);d=e}else d=[];var t=new _.data.DataSource({data:d,pageSize:30});t.read(),M.data("kendoGrid").setDataSource(t)}).fail(function(e){c.message(e.responseText),c.open()}).always(function(){T.close(t)})}),M.on("click","[data-event=detail]",function(e){var i,a,t=$(this),n=t.closest(".popup-window-single"),r=t.closest("tr").data("uid"),o=t.closest(".k-grid").data("kendoGrid").dataSource.getByUid(r),l=$("#popup-history-detail").data("kendoPopupSingleWindow"),s=$("#popup-history-detail").find(".popup-history-detail-map");for(var d in S.fields)""!=o[d]&&void 0!==o[d]||(o[d]="-"),"time"==d&&(o[d]=p(o.time).format("LLL").replace(/\./g,"-"));l.bindHistoryData(o),s.empty(),T.open(n),$.ajax({url:"/dms/devices/"+o.dms_devices_id}).done(function(e){i=e.locations[0].foundation_space_floors_id,a=e.locations[0].foundation_space_zones_id;var t=e;C.getFloorDataWithImage(i).always(function(e){l.openWindowPopup(),s.kendoCommonMapView({width:330,height:222,floor:e,zoneDataSource:[],dataSource:[t],showDeviceInfoCheckbox:!1,isForcedShowDevice:!0,isDetailPopupView:!0,hasFullScreenControl:!1,hasLegendControl:!1,hasZoomControl:!1,hasDefaultZoomControl:!1,hasColorPickerControl:!1,hasLayerControl:!1}),a?$.ajax({url:"/foundation/space/zones/"+a}).done(function(e){s.data("kendoCommonMapView").setZoneDataSource([e]),s.data("kendoCommonMapView").setDataSource([t])}).fail(function(e){c.message(C.parseFailResponse(e)),c.open()}).always(function(){T.close(n)}):T.close(n)}).fail(function(){l.openWindowPopup(),s.css({width:"330px",height:"220px"}),T.close(n)}).always(function(){})}).fail(function(e){T.close(n),c.message(e.responseText),c.open()}).always(function(){})});var z={height:200,columns:[{title:r.prop("FACILITY_DEVICE_TYPE"),field:"type",template:function(e){var t="-",i=e.type;return t=i||t}},{title:r.prop("FACILITY_DEVICE_NETWORK_RSSI"),field:"rssi",template:function(e){var t="-",i=e.rssi;return"-"!=(t=void 0!==i?i:t)&&(t+=" dBm"),t}},{title:r.prop("FACILITY_DEVICE_NETWORK_WIFI_FREQUENCY"),field:"frequency",template:function(e){var t="-",i=e.frequency;return t=i||t}},{title:r.prop("COMMON_TIME"),field:"scannedTime",template:function(e){var t="-",i=e.scannedTime;return i&&(t=(i=p(i)).format("LLL").replace(/\./g,"-")),t}}]},j={title:r.prop("COMMON_BTN_DETAIL"),width:652,height:830,gridOptions:{scrollable:{virtual:!0}},buttonsIndex:{CLOSE:0,EDIT:1,CANCEL:2,SAVE:3,REGISTER:4,DEREGISTER:5,DELETE:6},contentViewModel:{clickHistoryBtn:function(){var e=v.getSelectedData(),t=new Date,i=n(new Date(t.getFullYear(),t.getMonth(),1,0,0,0)),a=n(new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59));function n(e){var t=p(e).format("YYYY-MM-DDTHH:mm:ss");return t=(t+="+09:00").replace("+","%2b")}N.data("curDmsId",e.id),N.find("ul.toolbar-content.controlType").find("input").each(function(e,t){t.checked=!0}),x.data("kendoCommonDatePicker").value(i),V.data("kendoCommonDatePicker").value(a),M.data("kendoGrid").dataSource.data([]),N.kendoPopupSingleWindow("openWindowPopup")},detailType:r.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span><button class="device-detail-header-history-btn k-button" data-bind="events: {click : clickHistoryBtn }">'+r.prop("FACILITY_HISTORY")+'</button></div><div class="detail-dialog-detail-content-field-list"></div>',listTemplate:function(e){var t=v.dialogType,i="register"==t||"deregister"==t,a="deregister"==t;return n.multiDetailListDualTemplate(e,i,a)},headerTemplate:"<span>"+r.prop("FACILITY_DEVICE_SELECTED_DEVICE")+": <span>#:count #</span></span>",isCustomActions:!0,onTypeChange:H,actions:[{text:r.prop("COMMON_BTN_CLOSE"),visible:!0,action:P},{text:r.prop("COMMON_BTN_EDIT"),visible:!0,action:k},{text:r.prop("COMMON_BTN_CANCEL"),visible:!1,action:Y},{text:r.prop("COMMON_BTN_SAVE"),visible:!1,disabled:!0,action:U},{text:r.prop("COMMON_BTN_REGISTER"),visible:!1,action:W},{text:r.prop("COMMON_BTN_DEREGISTER"),visible:!1,action:G}],scheme:{id:"id",fields:{type:{type:"text",name:r.prop("FACILITY_DEVICE_TYPE"),template:C.getDetailDisplayTypeDeviceI18N},tagName:{type:"text",name:r.prop("FACILITY_POINT_TAG_NAME"),template:function(e){var t="-";return e.controlPoint&&e.controlPoint.tagName&&(t=e.controlPoint.tagName),t}},id:{type:"text",name:r.prop("FACILITY_DEVICE_DEVICE_ID")},name:{type:"text",name:r.prop("FACILITY_DEVICE_DEVICE_NAME"),editCss:{width:"100%"},validator:{type:"name",required:!0},hasInputRemoveBtn:!0,editable:!0},meterType:{type:"text",name:r.prop("FACILITY_DEVICE_ENERGY_METER_TYPES"),template:I.getMeterType,editable:!0,editFieldName:"type",editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='displayType' data-value-field='type' data-bind='value:fields.type, source: typeList, events:{change:changeTypeList}, disabled:disabled' style='width:216px;'/>"},editViewModel:{fields:{type:null},disabled:!1,init:function(){"AirConditionerController.DMS"==v.getSelectedData().parentType?this.disabled=!0:this.disabled=!1},typeList:[{displayType:r.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATTHOUR"),type:"Meter.WattHour"},{displayType:r.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_GAS"),type:"Meter.Gas"},{displayType:r.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATER"),type:"Meter.Water"}],changeTypeList:function(e){var t=e.sender.value(),i=v.editFields.consumptionCategory.viewModel,a=v.editFields.sacConnectionType.viewModel;this.fields.set("type",t),i.set("meterType",t),i.fields.set("category","AirConditionerAll"),i.set("typeList",I.getConnectedDevicesConsumptionTypeList(t)),a.set("meterType",t),a.set("consumptionType","AirConditionerAll"),a.fields.set("connectedDeviceType","None"),a.set("disabled",!1),a.set("typeList",I.getConnectedDevicesConnectionTypeList(t,"AirConditionerAll")),v.setEditableFieldElem("connectedDevices",!1),v.enableSaveBtn()}}},pointMeterType:{type:"text",name:r.prop("FACILITY_DEVICE_ENERGY_METER_TYPES"),template:I.getMeterType,editable:!0,editFieldName:"mappedType",editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='displayType' data-value-field='type' data-bind='value:fields.mappedType, source: typeList, events:{change:changeTypeList}, disabled:disabled' style='width:216px;'/>"},editViewModel:{fields:{mappedType:null},disabled:!1,init:function(){"AirConditionerController.DMS"==v.getSelectedData().parentType?this.disabled=!0:this.disabled=!1},typeList:[{displayType:r.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATTHOUR"),type:"Meter.WattHour"},{displayType:r.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_GAS"),type:"Meter.Gas"},{displayType:r.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATER"),type:"Meter.Water"}],changeTypeList:function(e){var t=e.sender.value(),i=v.editFields.consumptionCategory.viewModel,a=v.editFields.sacConnectionType.viewModel;this.fields.set("mappedType",t),i.set("meterType",t),i.fields.set("category","AirConditionerAll"),i.set("typeList",I.getConnectedDevicesConsumptionTypeList(t)),a.set("meterType",t),a.set("consumptionType","AirConditionerAll"),a.fields.set("connectedDeviceType","None"),a.set("disabled",!1),a.set("typeList",I.getConnectedDevicesConnectionTypeList(t,"AirConditionerAll")),v.setEditableFieldElem("connectedDevices",!1),v.enableSaveBtn()}}},consumptionCategory:{type:"object",name:r.prop("FACILITY_DEVICE_CONSUMPTION_CATEGORY_TYPE"),template:I.getMeterCategoryType,editable:!0,editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.category, source: typeList, events:{change:changeTypeList}, disabled:disabled' style='width:216px;'/>"},editFieldName:"meters[0]",editViewModel:{fields:{id:0,category:null},disabled:!1,meterType:null,init:function(){this.fields.category||(this.fields.category="Others");var e=v.getSelectedData();"AirConditionerController.DMS"==e.parentType?this.disabled=!0:this.disabled=!1;var t=e.meters;t&&t[0]&&(this.fields.id=t[0].id),this.meterType=e.mappedType||e.type,this.typeList=I.getConnectedDevicesConsumptionTypeList(this.meterType)},typeList:[],changeTypeList:function(e){var t=e.sender.value(),i=v.editFields.sacConnectionType.viewModel;this.fields.set("category",t);var a=I.getConnectedDevicesConnectionTypeList(this.meterType,t);i.set("typeList",a),i.set("consumptionType",t),i.fields.set("connectedDeviceType","None"),i.set("disabled","AirConditionerAll"!==t),v.setEditableFieldElem("connectedDevices",!1),v.enableSaveBtn()}}},sacConnectionType:{type:"object",name:r.prop("FACILITY_DEVICE_SAC_CONNECTION_TYPE"),template:function(e){var t,i,a,n,r="";if(i=e.meters)for(a=i.length,t=0;t<a;t++)(n=i[t].connectedDeviceType)&&(r+=C.getDetailDisplayType(n),t!=a-1&&(r+=", "));return r=r?C.getDetailDisplayTypeDeviceI18N(r):"None"},editable:!0,editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.connectedDeviceType, source: typeList, events:{change:changeTypeList}, disabled:disabled' style='width:216px;'/>"},editFieldName:"meters[0]",editViewModel:{fields:{id:0,connectedDeviceType:null},disabled:!1,meterType:null,consumptionType:null,init:function(){this.fields.connectedDeviceType||(this.fields.connectedDeviceType="None");var e=v.getSelectedData();this.meterType=e.mappedType||e.type,this.consumptionType=e.meters&&e.meters[0]&&e.meters[0].category||"None","AirConditionerController.DMS"==e.parentType?this.disabled=!0:this.disabled="AirConditionerAll"!==this.consumptionType;var t=e.meters;t&&t[0]&&(this.fields.id=t[0].id),this.typeList=I.getConnectedDevicesConnectionTypeList(this.meterType,this.consumptionType),v.setEditableFieldElem("connectedDevices","Meter.WattHour"===this.meterType&&"AirConditionerAll"===this.consumptionType&&"AirConditionerOutdoor"===this.fields.connectedDeviceType)},typeList:[],changeTypeList:function(e){var t=e.sender.value(),i="Meter.WattHour"===this.meterType&&"AirConditionerAll"===this.consumptionType&&"AirConditionerOutdoor"===t;this.fields.set("connectedDeviceType",t),v.setEditableFieldElem("connectedDevices",i),v.enableSaveBtn()}}},representativeStatus:{type:"text",name:r.prop("COMMON_STATUS"),template:n.detailStatusIconTemplate},configuration:{type:"object",name:r.prop("FACILITY_DEVICE_BEACON_POSITION_TYPE"),template:function(e){var t="-",i=e.configuration;return i&&i.mobilityType&&(t=(t=i.mobilityType)||"-"),t},editable:!0,editFieldName:"configuration",editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="positionType" id="position-fixed" checked="" value="Fixed" data-bind="checked:fields.mobilityType, click:clickRadio"><label class="k-radio-label" for="position-fixed" style="margin-right:51px;">Fixed</label><input type="radio" class="k-radio" name="positionType" id="position-movable" checked="" value="Movable" data-bind="checked:fields.mobilityType, click:clickRadio"><label class="k-radio-label" for="position-movable">Movable</label></div>'},editViewModel:{fields:{mobilityType:null},init:function(){this.fields.mobilityType||(this.fields.mobilityType="Fixed"),this.positionTypeChecked=this.fields.mobilityType},clickRadio:function(e){v.enableSaveBtn()}}},pointValue:{type:"text",name:r.prop("FACILITY_POINT_VALUE"),template:I.getPointValue},pointMode:{type:"text",name:r.prop("FACILITY_POINT_MODE"),template:function(e){var t="-",i=e.controlPoint;if(i&&void 0!==i.mode){var a=i.mode;1==a?t="Normal":2==a&&(t="Counter")}return t}},signalLogicStatus:{type:"text",name:r.prop("FACILITY_POINT_SIGNAL_LOGIC_STATUS"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.signalLogicStatus&&(t=i.signalLogicStatus),t}},signalReverse:{type:"text",name:r.prop("FACILITY_POINT_SIGNAL_REVERSE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.signalReverse&&(t=i.signalReverse?"Yes":"No"),t}},inputRange:{type:"text",name:r.prop("FACILITY_POINT_INPUT_RANGE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.inputRange&&("+-10V"==(t=i.inputRange)?t="+/- 10V":"+-2.5V"==t&&(t="+/- 2.5V")),t}},scaleType:{type:"text",name:r.prop("FACILITY_POINT_SCALE_TYPE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.scaleType&&(t=i.scaleType),t}},scale:{type:"text",name:r.prop("FACILITY_POINT_SCALE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.scale&&(t=i.scale),t}},bias:{type:"text",name:r.prop("FACILITY_POINT_BIAS"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.bias&&(t=i.bias),t}},maxValue:{type:"text",name:r.prop("FACILITY_POINT_MAX_VALUE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.maximumValue&&(t=i.maximumValue),t}},minValue:{type:"text",name:r.prop("FACILITY_POINT_MIN_VALUE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.minimumValue&&(t=i.minimumValue),t}},ioDescription:{type:"text",name:r.prop("FACILITY_POINT_IO_DESCRIPTION"),template:function(e){var t="-",i=e.controlPoint;return i&&i.ioDescription&&(t=i.ioDescription),t}},modes:{type:"text",name:r.prop("FACILITY_INDOOR_CONTROL_OPERATION_MODE"),template:function(e){var t=e.modes;return t&&0<t.length?C.getDisplayModeI18N(t,e.operations,!0):"-"}},outdoorTemperature:{type:"text",name:r.prop("FACILITY_DEVICE_OUTDOOR_TEMPERATURE"),template:I.curOutdoorTemperature},setTemperature:{type:"text",name:r.prop("FACILITY_INDOOR_SET_TEMPERATURE"),template:I.setTemperatures},currentTemperature:{type:"text",name:r.prop("FACILITY_INDOOR_CURRENT_TEMPERATURE"),template:I.curTemperatures},remoteControl:{type:"text",name:r.prop("FACILITY_INDOOR_REMOTE_CONTROL"),template:function(e){var t=e.configuration;return t&&t.remoteControl?"Allowed"===t.remoteControl?r.prop("FACILITY_INDOOR_REMOTE_CONTROL_ENABLE"):"NotAllowed"===t.remoteControl?r.prop("FACILITY_INDOOR_REMOTE_CONTROL_DISABLE"):r.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_CONDITIONAL"):"-"}},locations:{type:"array",name:r.prop("COMMON_LOCATION"),editable:!0,template:I.getLocation,editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.foundation_space_buildings_id, source: buildingList, events:{change:changeBuildingList, dataBound:dataBoundBuildingList}' style='width:95px;margin-right:10px;'/><input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.foundation_space_floors_id, source: floorList, events:{change:changeFloorList, dataBound:dataBoundFloorList}' style='width:95px;margin-right:10px;'/><input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.foundation_space_zones_id, source: zoneList, events:{change:changeZoneList, dataBound:dataBoundZoneList}' style='width:95px;margin-right:10px;'/><button type='button' class='ic-bt-map popup-btn k-button k-button-icon' data-bind='events:{click:onMapBtnClick}, disabled:isMapBtnDisabled'></button>"},editViewModel:{initialFieldsOnClose:function(e){this.fields.foundation_space_buildings_id=null,this.fields.foundation_space_floors_id=null,this.fields.foundation_space_zones_id=null},initialFieldsOnCloseBinded:null,init:function(){this.isMapBtnDisabled=!0;var e=o.getCurrentFloor(),t=e.building,i=e.floor,a=v.dialogType;this.isSetFloorList=!1,this.isSetZoneList=!1,this.initialFieldsOnCloseBinded||(this.initialFieldsOnCloseBinded=this.initialFieldsOnClose.bind(this)),v.unbind("onClose",this.initialFieldsOnCloseBinded),v.bind("onClose",this.initialFieldsOnCloseBinded),v.options.enableSaveBtnCondition="register"==a?function(){var e=this.editFields.locations;if(e&&e.viewModel){var t=e.viewModel.fields.get("foundation_space_floors_id");if(null!=t)return!0}return!1}:null,"register"!=a&&this.fields.foundation_space_buildings_id||t.id==o.FLOOR_NAV_BUILDING_TOTAL_ID||(this.fields.foundation_space_buildings_id=t.id),"register"!=a&&this.fields.foundation_space_floors_id||i.id==o.FLOOR_NAV_FLOOR_ALL_ID||(this.fields.foundation_space_floors_id=i.id,"register"==a&&(this.fields.foundation_space_zones_id=null),null!==i.id&&void 0!==i.id&&v.enableSaveBtn())},fields:{nameDisplayCoordinate:null,id:"Fixed",foundation_space_buildings_id:null,foundation_space_floors_id:null,foundation_space_zones_id:null,description:null,geometry:null},checkBtnDisabled:function(e){var t=this.fields.get("foundation_space_buildings_id"),i=this.fields.get("foundation_space_floors_id");e&&(null===t||null===i?v.disableSaveBtn():v.enableSaveBtn()),null===i?this.set("isMapBtnDisabled",!0):this.set("isMapBtnDisabled",!1)},isSetFloorList:!1,isSetZoneList:!1,isMapBtnDisabled:!0,buildingList:o.getCurrentBuildingList(),floorList:[],zoneList:[],centerZoneId:0,centerCoordinate:[],setSelectedLocation:function(e,t,i,a){var n,r,o=v.selectedIndex,l=v.dataSource.data(),s=l.length;if(0==o)for(r=0;r<s;r++)(n=l[r])&&(n.locations||(n.locations=[]),n.locations[0]||n.locations.push({id:"Fixed"}),n.locations[0].foundation_space_buildings_id=e,n.locations[0].foundation_space_floors_id=t,n.locations[0].foundation_space_zones_id=i,n.locations[0].description=a)},setLocationDescription:function(e,t,i){var a,n=this.fields.get("description");if(n){var r;for(a=n.split(", "),e&&(a[0]=e),a[1]=t||"",a[2]=i||"",r=a.length-1;0<=r;r--)a[r]||a.splice(r,1);n=a.join(", ")}else e&&t&&i?n=e+", "+t+", "+i:e&&t?n=e+", "+t:e&&(n=e);return this.fields.set("description",n),n},dataBoundBuildingList:function(e){this.changeBuildingList(e,!0)},changeBuildingList:function(e,t){var i,r=this;if(t){if(i=r.fields.get("foundation_space_buildings_id"),e.sender.value(i),!i)return}else i=e.sender.value(),r.fields.set("foundation_space_buildings_id",i);var a=e.sender.text();this.set("buildingText",a);var n=r.setLocationDescription(a);this.setSelectedLocation(i,null,null,n),T.open(v.element),$.ajax({url:"/foundation/space/floors?foundation_space_buildings_id="+i}).done(function(e){var t,i,a,n=e.length;for(e.sort(function(e,t){return e.sortOrder-t.sortOrder}),t=0;t<n;t++)i=e[t].type,a=e[t].name,e[t].name="F"==i?a+i:"B"==i?i+a:a;r.set("isSetFloorList",!0),r.set("floorList",e),e.length<1&&(r.fields.set("foundation_space_floors_id",null),r.set("zoneList",[]))}).fail(function(e){var t=C.parseFailResponse(e);v.msgDialog.message(t),v.msgDialog.open()}).always(function(){T.close();var e="register"==v.dialogType;r.checkBtnDisabled(e)})},dataBoundFloorList:function(e){this.changeFloorList(e,!0)},changeFloorList:function(e,n){var t,r=this,i=r.fields.get("foundation_space_buildings_id");if(n){t=r.fields.get("foundation_space_floors_id"),e.sender.value(t);var a=e.sender.value(),o=this.get("floorList"),l=this.get("isSetFloorList");if(t&&o&&l)new _.data.Query(o).filter({field:"id",operator:"eq",value:t}).toArray().length<1&&(t=null);if(t||a||r.fields.set("foundation_space_floors_id",null),!t)return}else t=e.sender.value(),r.fields.set("foundation_space_floors_id",t),v.hasChanged=!0;var s=e.sender.text();this.set("floorText",s);var d=r.setLocationDescription(this.get("buildingText"),s);this.setSelectedLocation(i,t,null,d),T.open(v.element),C.getFloorDataWithImage(t).always(function(a){$.ajax({url:"/foundation/space/zones?foundation_space_buildings_id="+i+"&foundation_space_floors_id="+t}).done(function(e){e.sort(function(e,t){return e.sortOrder-t.sortOrder});var t=C.getCenterMap(a.imageWidth,a.imageHeight),i=C.getCenterZoneId(e,t);r.set("centerZoneId",i),r.set("centerCoordinate",t),r.set("isSetZoneList",!0),r.set("zoneList",e),e.length<1?(r.fields.set("foundation_space_zones_id",null),n||r.fields.set("geometry",{type:"Point",coordinates:t})):r.fields.get("geometry")||r.fields.get("foundation_space_zones_id")||(r.fields.foundation_space_zones_id=i)}).fail(function(e){var t=C.parseFailResponse(e);v.msgDialog.message(t),v.msgDialog.open()}).always(function(){T.close(),n||r.checkBtnDisabled(!0)})})},dataBoundZoneList:function(e){this.changeZoneList(e,!0)},changeZoneList:function(e,t){var a=this,i=null,n=a.fields.get("foundation_space_buildings_id"),r=a.fields.get("foundation_space_floors_id");if(t){var o=a.fields.get("foundation_space_zones_id");e.sender.value(o),i=o;var l=e.sender.value(),s=this.get("zoneList"),d=this.get("isSetZoneList");if(o&&s&&d)new _.data.Query(s).filter({field:"id",operator:"eq",value:o}).toArray().length<1&&(i=o=null);if(!o&&!l)if(a.fields.get("geometry"))i=0,a.fields.set("foundation_space_zones_id",i);else{i=a.get("centerZoneId"),a.fields.set("foundation_space_zones_id",i);var c=a.get("centerCoordinate");c.length&&a.fields.set("geometry",{type:"Point",coordinates:c})}}else{i=e.sender.value();var p=a.fields.get("geometry");a.fields.set("foundation_space_zones_id",i),v.hasChanged=!0;var u={coordinates:null,type:"Point"};a.fields.locations&&a.fields.locations[0]?(a.fields.locations[0].set("foundation_space_zones_id",i),a.fields.locations[0].set("geometry",p)):a.fields.set("locations",[{foundation_space_buildings_id:n,foundation_space_floors_id:r,foundation_space_zones_id:i,geometry:p}]),T.open(v.element),$.ajax({url:"/foundation/space/zones/"+i}).done(function(e){if(e.geometry&&e.geometry.coordinates&&e.geometry.coordinates[0]){var t=e.geometry.coordinates[0],i=C.getCentroid(t);u.coordinates=i,a.fields.set("geometry",u)}}).fail(function(){}).always(function(){T.close()}),a.checkBtnDisabled(!0)}var g=e.sender.text();this.set("zoneText",g);var f=a.setLocationDescription(this.get("buildingText"),this.get("floorText"),g);this.setSelectedLocation(n,r,i,f)},onMapBtnClick:function(e){var s=$("<div/>").addClass("device-detail-map-view-box"),d=this,c=d.fields.get("foundation_space_buildings_id"),p=d.fields.get("foundation_space_floors_id"),u=d.fields.get("geometry");T.open(v.element),C.getFloorDataWithImage(p).always(function(a){$.ajax({url:"/foundation/space/zones?foundation_space_buildings_id="+c+"&foundation_space_floors_id="+p}).done(function(e){var t=v.getSelectedData();o&&(t.locations&&t.locations[0]?(t.locations[0].set("foundation_space_zones_id",o),t.locations[0].set("geometry",u)):t.set("locations",[{foundation_space_buildings_id:c,foundation_space_floors_id:p,foundation_space_zones_id:o,geometry:u}]));var n,i="register"==v.dialogType,r={coordinates:null,type:"Point"},o=null,l="";g.content(s),g.setActions(1,{action:function(){r.coordinates&&(d.fields.set("geometry",r),t.locations||t.set("locations",[{}]),t.locations[0]||t.locations.push({}),t.locations[0].set("geometry",r),v.hasChanged=!0,o?d.fields.set("foundation_space_zones_id",Number(o)):d.fields.set("foundation_space_zones_id",0),l&&(d.set("zoneText",l),d.setLocationDescription(d.get("buildingText"),d.get("floorText"),l))),n&&d.fields.set("nameDisplayCoordinate",n),d.checkBtnDisabled(!0)}}),g.element.css("overflow","auto"),g.open(),s.kendoCommonMapView({dataSource:[t],zoneDataSource:e,floor:a,isForcedShowDevice:!0,isDetailPopupView:!0,canDragDeviceIcon:!0,isRegisterView:i,width:668,height:527,hasLegendControl:-1===t.type.indexOf("Outdoor")}).data("kendoCommonMapView").bind("dragend",function(e){var t,i,a=e.devices[0];a?(a.nameDisplayCoordinate&&(n=a.nameDisplayCoordinate),a.locations&&(t=a.locations[0],r.coordinates=t.geometry.coordinates,(o=t.foundation_space_zones_id)&&(i=e.sender.zoneDataSource.get(o),l=i.name))):console.error("device is not found when device move end")})}).fail(function(e){var t=C.parseFailResponse(e);console.error(t)}).always(function(){T.close()})})}}},currentLocations:{type:"text",name:r.prop("FACILITY_DEVICE_BEACON_CURRENT_LOCATION"),template:I.getCurrentLocation},groups:{type:"text",name:r.prop("FACILITY_GROUP_GROUP"),template:I.getGroup},weatherStation:{type:"object",name:r.prop("FACILITY_DEVICE_TEMP_HUM_WEATHER_STATION"),template:I.getTempWeatherStationOx,editable:!0,editFieldName:"configuration",editTemplate:function(e,t){var i=e.configuration,a="";if(i&&i.locationType){var n="checked"==(a="Outdoor"==i.locationType?"checked":"");t.checked=n}return"<div style='line-height:38px;'><input type='checkbox' id='weather-station' class='k-checkbox' data-bind='checked:checked, events:{click:clickChecked}'"+a+"/><label style='padding-left:20px;' class='k-checkbox-label' for='weather-station'>&nbsp;</label></div>"},editViewModel:{init:function(){},fields:{locationType:"Indoor"},checked:!1,clickChecked:function(e){var t=$(e.target).prop("checked");v.enableSaveBtn();var i=1==t?"Outdoor":"Indoor";this.fields.set("locationType",i)}}},parentId:{type:"text",name:"Parent ID",template:function(e){var t="-";return e.parentId&&(t=e.parentId),t}},macAddress:{type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:I.getMacAddress},ipAddress:{type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_IP_ADDRESS"),template:I.getIpAddress},brightness:{type:"text",name:r.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS"),template:I.getDimmingLevel},colorTemperature:{type:"text",name:r.prop("FACILITY_DEVICE_LIGHT_COLOR_TEMPERATURE"),template:function(){return"-"}},temperatureUnit:{type:"text",name:r.prop("FACILITY_DEVICE_TEMP_HUM_TEMPERATURE_UNIT"),template:function(e){var t,i="-",a=e.temperatures;return a&&a[0]&&(t=(a=a[0]).unit,i=(t=C.CHAR[t])||"-"),i}},sensorTemperature:{type:"text",name:r.prop("FACILITY_DEVICE_TEMP_HUMI_CURRENT_TEMPERATURE"),template:I.getTempHumiTemperature},humidity:{type:"text",name:r.prop("FACILITY_DEVICE_TEMP_HUM_CURRENT_HUMIDITY"),template:I.getTempHumiHumidity},dataStatus:{type:"text",name:r.prop("FACILITY_DEVICE_CCTV_DATA_STATUS"),template:I.getCCTVDataStatus},bleMacAddress:{type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:I.getBleMacAddress},signalLevel:{type:"text",name:r.prop("FACILITY_DEVICE_BEACON_SIGNAL_LEVEL_RSSI"),template:I.getBleSignalLevel},batteryLevel:{type:"text",name:r.prop("FACILITY_DEVICE_BEACON_BATTERY_LEVEL"),template:function(e){var t=I.getBleBatteryLevel(e);return"999"!=t&&999!=t||(t="-"),"-"!=t&&(t+=" %"),t}},lastEventTime:{type:"text",name:r.prop("FACILITY_DEVICE_TEMP_HUM_LAST_EVENT_TIME"),template:function(e){var t="-",i=e.information;return i&&i.updatedTime&&(t=p(i.updatedTime).format("LLL")),t}},presence:{type:"text",name:r.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE"),template:I.getMotionPresence},currentConsumption:{type:"text",name:r.prop("FACILITY_DEVICE_CURRENT_CONSUMPTION"),template:I.getMeterCurrentConsumptionUnit},totalConsumption:{type:"text",name:r.prop("FACILITY_DEVICE_TOTAL_CONSUMPTION"),template:function(e){var t,i,a,n,r="";if(i=e.meters)for(a=i.length,t=0;t<a;t++)null!=(n=i[t].reading)&&(r+=n,t!=a-1&&(r+=", "));return r=r||"-"}},manufacturer:{type:"text",name:r.prop("FACILITY_DEVICE_MANUFACTURER"),template:function(e){var t="-",i=e.information;return i&&i.manufacturer&&(t=i.manufacturer),t}},information:{type:"text",name:r.prop("FACILITY_DEVICE_MODEL"),template:function(e){var t="-",i=e.information;if(i&&i.modelName){t=i.modelName;var a=r.prop("FACILITY_DEVICE_STATUS_POPUP_MODEL_"+t.toUpperCase());t=a||t}return t}},firmwareVersion:{type:"text",name:r.prop("FACILITY_DEVICE_FIRMWARE_VERSION"),template:I.getFirmwareVersion},hardwareVersion:{type:"text",name:r.prop("FACILITY_DEVICE_HARDWARE_VERSION"),template:I.getHardwareVersion},softwareVersion:{type:"text",name:r.prop("FACILITY_DEVICE_SOFTWARE_VERSION"),template:I.getSoftwareVersion},apiVersion:{type:"text",name:r.prop("FACILITY_DEVICE_API_VERSION"),template:I.getApiVersion},powerAvailableSource:{type:"text",name:r.prop("FACILITY_DEVICE_POWER_AVAILABLE_SOURCE"),template:I.getPowerAvailableSource},powerCurrentSource:{type:"text",name:r.prop("FACILITY_DEVICE_POWER_CURRENT_SOURCE"),template:I.getPowerCurrentSource},schedule:{type:"text",name:r.prop("COMMON_MENU_FACILITY_SCHEDULE"),template:I.getHasSchedule},rule:{type:"text",name:r.prop("COMMON_MENU_FACILITY_RULE"),template:I.getHasRule},description:{type:"text",name:r.prop("COMMON_DESCRIPTION"),editCss:{width:"100%"},editable:!0,hasInputRemoveBtn:!0,validator:!0},wifiStatus:{groupName:"wifiInterface",name:r.prop("FACILITY_DEVICE_NETWORK_WIFI_STATUS"),template:I.getCCTVWifiStatus},wifiType:{groupName:"wifiInterface",name:r.prop("FACILITY_DEVICE_NETWORK_WIFI_FREQUENCY_BAND"),template:I.getCCTVWifiType},wifiChannel:{groupName:"wifiInterface",name:r.prop("FACILITY_DEVICE_NETWORK_WIFI_CHANNEL"),template:I.getWifiChannel},wifiRssi:{groupName:"wifiInterface",name:r.prop("FACILITY_DEVICE_NETWORK_RSSI"),template:I.getWifiRssi},cctvWifiMacAddress:{groupName:"wifiInterface",name:r.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:I.getWifiMacAddress},cctvWifiIPAddress:{groupName:"wifiInterface",name:r.prop("FACILITY_DEVICE_NETWORK_IP_ADDRESS"),template:I.getWifiIpAddress},cctvWifiTxPower:{groupName:"wifiInterfaceDetail",name:r.prop("FACILITY_DEVICE_NETWORK_TX_POWER"),template:I.getCCTVWifiTxPower},cctvWifiChannelUtilization:{groupName:"wifiInterfaceDetail",name:r.prop("FACILITY_DEVICE_NETWORK_CHANNEL_UTILIZATION"),template:function(){return""}},cctvWifiChannelUtilizationTotal:{groupName:"wifiInterfaceDetail",name:"<div style='margin-left:10px;'>"+r.prop("COMMON_TOTAL")+"</div>",template:function(e){var t=I.getCCTVWifiTotal(e);return"-"!=t&&(t+=" %"),t}},cctvWifiChannelUtilizationNonWifi:{groupName:"wifiInterfaceDetail",name:"<div style='margin-left:10px;'>"+r.prop("FACILITY_DEVICE_NETWORK_NONE_WIFI")+"</div>",template:function(e){var t=I.getCCTVWifiNoneWifi(e);return"-"!=t&&(t+=" %"),t}},cctvWifiInterferer:{groupName:"wifiInterfaceDetail",type:"grid",name:r.prop("FACILITY_DEVICE_NETWORK_WIFI_INTERFERER"),valueFieldDisplayType:"row",gridDataSource:I.getCCTVWifiInterfererDataSource,gridOptions:$.extend({},s,z)},writable:{groupName:"advertisement",type:"text",name:r.prop("FACILITY_DEVICE_BEACON_CONFIGURATION_TYPE"),template:I.getBleWritable},advertisingName:{groupName:"advertisement",type:"text",name:r.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME"),template:I.getBleAdvertisingName,validator:{type:"name"},editCss:{width:"100%"},customFieldKey:function(e){var t,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.advertisingName"}},advertisingInterval:{groupName:"advertisement",type:"text",name:r.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_INTERVAL"),template:function(e){var t=I.getBleAdvertisingInterval(e);return"-"!=t&&(t+=" msec"),t},editable:function(e){return"-"!=I.getBleObject(e,"writable")},customFieldKey:function(e){var t,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.advertisingInterval"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="100" data-max="10240" data-spinners="false" data-bind="value : fields.advertisingInterval, events:{change:change}" /></span><span style="margin-left:10px;">(100 ~ 10,240)</div>'},editViewModel:{fields:{advertisingInterval:100},init:function(){this.fields.advertisingInterval||(this.fields.advertisingInterval=100)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getBleObject(e,"advertisingInterval");return"-"==t&&(t=100),t},isEditAll:!0},uuid:{groupName:"advertisement",type:"text",name:"UUID",template:I.getBleUUID,editable:function(e){return"-"!=I.getBleObject(e,"writable")},validator:{type:"uuid_min"},editCss:{width:"100%"},customFieldKey:function(e){var t,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.uuid"},getEditableData:function(e){var t=I.getBleObject(e,"uuid");return"-"==t&&(t=""),t},isEditAll:!0},major:{groupName:"advertisement",type:"text",name:"Major",template:I.getBleMajor,editable:function(e){return"-"!=I.getBleObject(e,"writable")},customFieldKey:function(e){var t,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.major"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.major, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65,535)</div>'},editViewModel:{fields:{major:0},init:function(){this.fields.major||(this.fields.major=0)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getBleObject(e,"major");return"-"==t&&(t=0),t},isEditAll:!0},minor:{groupName:"advertisement",type:"text",name:"Minor",template:I.getBleMinor,editable:function(e){return"-"!=I.getBleObject(e,"writable")},customFieldKey:function(e){var t,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.minor"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.minor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65,535)</div>'},editViewModel:{fields:{minor:0},init:function(){this.fields.minor||(this.fields.minor=0)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getBleObject(e,"minor");return"-"==t&&(t=0),t},isEditAll:!0},txPower:{groupName:"advertisement",type:"text",name:"Tx Power",template:function(e){var t=I.getBleTxPower(e);return"999"!=t&&999!=t||(t="-"),"-"!=t&&(t+=" dBm"),t},editable:function(e){return"-"!=I.getBleObject(e,"writable")},customFieldKey:function(e){var t=0,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.txPower"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="-100" data-max="20" data-spinners="false" data-bind="value : fields.txPower, events:{change:change}" /></span><span style="margin-left:10px;">(-100 ~ 20)</div>'},editViewModel:{fields:{txPower:null},init:function(){this.fields.txPower||(this.fields.txPower=0)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getBleObject(e,"txPower");return"-"==t&&(t=0),t}},calibratedTxPower:{groupName:"advertisement",type:"text",name:"1m RSSI",template:function(e){var t=I.getBle1mRssi(e);return"-"!=t&&(t+=" dBm"),t}},gatewayZigbeeId:{groupName:"zigbeeInterface",type:"text",name:"ZigBee ID",template:function(e){var t="-",i=I.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=(t=i.zigbee.networkAddress)||"-"),t}},gatewayZigbeePower:{groupName:"zigbeeInterface",name:r.prop("FACILITY_DEVICE_NETWORK_POWER"),template:function(e){var t="-",i=I.getNetworkInterface(e,"Zigbee");return i&&(t=!0===i.enabled||"true"===i.enabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"Zigbee")+"].enabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="zigbee-power" id="zigbee-power-on" checked="" value="true" data-bind="checked:fields.gatewayZigbeePower, click:clickRadio"><label class="k-radio-label" for="zigbee-power-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="zigbee-power" id="zigbee-power-off" checked="" value="false" data-bind="checked:fields.gatewayZigbeePower, click:clickRadio"><label class="k-radio-label" for="zigbee-power-off">Off</label></div>'},editViewModel:{fields:{gatewayZigbeePower:null},init:function(){null===this.fields.gatewayZigbeePower&&(this.fields.gatewayZigbeePower=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=I.getNetworkInterface(e,"Zigbee");return i&&void 0!==i.enabled&&(t=i.enabled),t},isEditAll:!0},gatewayZigbeeFirmwareVersion:{groupName:"zigbeeInterface",type:"text",name:r.prop("FACILITY_DEVICE_FIRMWARE_VERSION"),template:I.getZigbeeFirmwareVersion},gatewayZigbeeChannel:{groupName:"zigbeeInterface",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_WIFI_CHANNEL"),template:function(e){var t="-",i=I.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=(t=i.zigbee.channel)||"-"),t},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"Zigbee")+"].zigbee.channel"},editTemplate:function(){return'<div><input data-role="dropdownlist" data-bind="source : channelList, value : fields.gatewayZigbeeChannel, events:{change:change}" /></div>'},editViewModel:{fields:{gatewayZigbeeChannel:null},channelList:["26","25","24","23","22","21","20","19","18","17","16","15","14","13","12","11"],init:function(){this.fields.gatewayZigbeeChannel||(this.fields.gatewayZigbeeChannel="26")},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t="26",i=I.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=i.zigbee.channel),t},isEditAll:!0},gatewayZigbeeTxPower:{groupName:"zigbeeInterface",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_TX_POWER"),template:function(e){var t="-",i=I.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=(t=i.zigbee.txPower)?t+" dBm":"-"),t},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"Zigbee")+"].zigbee.txPower"},editTemplate:function(){return'<div><input data-role="dropdownlist" data-bind="source : txPowerList, value : fields.gatewayZigbeeTxPower, events:{change:change}" /></div>'},editViewModel:{fields:{gatewayZigbeeTxPower:null},txPowerList:["9","-3","-15","-26"],init:function(){this.fields.gatewayZigbeeTxPower||(this.fields.gatewayZigbeeTxPower="9")},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t="9",i=I.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=i.zigbee.txPower),t},isEditAll:!0},gatewayZigbeePairingMode:{groupName:"zigbeeInterface",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_PAIRING_MODE"),template:function(e){var t="-",i=I.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=i.zigbee.pairing?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"Zigbee")+"].zigbee.pairing"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="zigbee-pairing" id="zigbee-pairing-on" value="true" data-bind="checked:fields.gatewayZigbeePairingMode, click:clickRadio"><label class="k-radio-label" for="zigbee-pairing-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="zigbee-pairing" id="zigbee-pairing-off" value="false" data-bind="checked:fields.gatewayZigbeePairingMode, click:clickRadio"><label class="k-radio-label" for="zigbee-pairing-off">Off</label></div>'},editViewModel:{fields:{gatewayZigbeePairingMode:null},init:function(){null===this.fields.gatewayZigbeePairingMode&&(this.fields.gatewayZigbeePairingMode=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=I.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=i.zigbee.pairing),t},isEditAll:!0},gatewayBlePower:{groupName:"bleInterface",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_POWER"),template:function(e){var t="-",i=I.getNetworkInterface(e,"BLE","Scanner");return i&&(t=i.enabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].enabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power" id="ble-power-on" checked="" value="true" data-bind="checked:fields.gatewayBlePower, click:clickRadio"><label class="k-radio-label" for="ble-power-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power" id="ble-power-off" checked="" value="false" data-bind="checked:fields.gatewayBlePower, click:clickRadio"><label class="k-radio-label" for="ble-power-off">Off</label></div>'},editViewModel:{fields:{gatewayBlePower:null},init:function(){null===this.fields.gatewayBlePower&&(this.fields.gatewayBlePower=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=I.getNetworkInterface(e,"BLE","Scanner");return"undefined"!==i.enabled&&(t=i.enabled),t},isEditAll:!0},gatewayBleFirmwareVersion:{groupName:"bleInterface",type:"text",name:r.prop("FACILITY_DEVICE_FIRMWARE_VERSION"),template:I.getBleFirmwareVersion},gatewayBleAppVersion:{groupName:"bleInterface",type:"text",name:r.prop("FACILITY_DEVICE_APP_VERSION"),template:I.getBleAppVersion},gatewayBleScanReport:{groupName:"bleInterface",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_SCAN_REPORT"),template:function(e){var t="-",i=I.getNetworkInterface(e,"BLE","Scanner");return i&&i.ble&&(t=i.ble.scanlistReportEnabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].ble.scanlistReportEnabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-scan-report" id="ble-scan-report-on" checked="" value="true" data-bind="checked:fields.gatewayBleScanReport, click:clickRadio"><label class="k-radio-label" for="ble-scan-report-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-scan-report" id="ble-scan-report-off" checked="" value="false" data-bind="checked:fields.gatewayBleScanReport, click:clickRadio"><label class="k-radio-label" for="ble-scan-report-off">Off</label></div>'},editViewModel:{fields:{gatewayBleScanReport:null},init:function(){null===this.fields.gatewayBleScanReport&&(this.fields.gatewayBleScanReport=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=I.getNetworkInterface(e,"BLE","Scanner");return i&&i.ble&&(t=i.ble.scanlistReportEnabled),t},isEditAll:!0},gatewayBleScanReportInterval:{groupName:"bleInterface",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_SCAN_REPORT_INTERVAL"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Scanner"),i=I.getBleObjectFromNetwork(t,"scanlistReportInterval");return"-"!=i&&(i+=" msec"),i},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].ble.scanlistReportInterval"},editTemplate:function(){return'<div><input style="width: calc( 100% - 150px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="3000" data-max="120000" data-spinners="false" data-bind="value : fields.gatewayBleScanReportInterval, events:{change:change}" /></span><span style="margin-left:10px;">(3,000 ~ 120,000)</div>'},editViewModel:{fields:{gatewayBleScanReportInterval:null},init:function(){null===this.fields.gatewayBleScanReportInterval&&(this.fields.gatewayBleScanReportInterval=100)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Scanner"),i=I.getBleObjectFromNetwork(t,"scanlistReportInterval");return"-"==i&&(i=100),i},isEditAll:!0},gatewayBleScanWindow:{groupName:"bleInterface",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_SCAN_WINDOW"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Scanner"),i=I.getBleObjectFromNetwork(t,"scanWindow");return"-"!=i&&(i+=" msec"),i},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].ble.scanWindow"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="10240" data-spinners="false" data-bind="value : fields.gatewayBleScanWindow, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 10,240)</div>'},editViewModel:{fields:{gatewayBleScanWindow:null},init:function(){null===this.fields.gatewayBleScanWindow&&(this.fields.gatewayBleScanWindow=0)},change:function(e){var t,i=e.sender.value();if(void 0!==i){t=i;var a=v.editFields.gatewayBleScanInterval,n=a.find(".device-point-numeric[data-role='numerictextbox']");n.attr("data-min",t),a.find(".scan-interval-min").text(t);var r=n.data("kendoNumericTextBox"),o=r.value();r.min(t),o<t&&(r.value(t),a.viewModel.fields.set("gatewayBleScanInterval",t))}v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Scanner"),i=I.getBleObjectFromNetwork(t,"scanWindow");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleScanInterval:{groupName:"bleInterface",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_SCAN_INTERVAL"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Scanner"),i=I.getBleObjectFromNetwork(t,"scanInterval");return"-"!=i&&(i+=" msec"),i},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].ble.scanInterval"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="10240" data-spinners="false" data-bind="value : fields.gatewayBleScanInterval, events:{change:change}" /></span><span style="margin-left:10px;">(<span class="scan-interval-min">0</span> ~ 10,240)</div>'},editViewModel:{fields:{gatewayBleScanInterval:null},init:function(){var e=v.getSelectedData(),t=I.getNetworkInterface(e,"BLE","Scanner"),i=0,a=I.getBleObjectFromNetwork(t,"scanWindow");if("-"!=a){i<a&&(i=a);var n=v.editFields.gatewayBleScanInterval;n.find(".device-point-numeric").attr("data-min",i),n.find(".scan-interval-min").text(i)}null===this.fields.gatewayBleScanInterval&&(this.fields.gatewayBleScanInterval=0)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Scanner"),i=I.getBleObjectFromNetwork(t,"scanInterval");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleScanType:{groupName:"bleInterface",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_SCAN_TYPE"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Scanner");return I.getBleObjectFromNetwork(t,"scanType")},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].ble.scanType"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-scan-type" id="ble-scan-type-on" checked="" value="Passive" data-bind="checked:fields.gatewayBleScanType, click:clickRadio"><label class="k-radio-label" for="ble-scan-type-on" style="margin-right:51px;">Passive</label><input type="radio" class="k-radio" name="ble-scan-type" id="ble-scan-type-off" checked="" value="Active" data-bind="checked:fields.gatewayBleScanType, click:clickRadio"><label class="k-radio-label" for="ble-scan-type-off">Active</label></div>'},editViewModel:{fields:{gatewayBleScanType:null},init:function(){null===this.fields.gatewayBleScanType&&(this.fields.gatewayBleScanType="Passive")},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Scanner"),i=I.getBleObjectFromNetwork(t,"scanType");return"-"==i&&(i="Passive"),i},isEditAll:!0},gatewayBleAdvertisementInterval:{groupName:"bleSetup",type:"text",name:r.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_INTERVAL"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser"),i=I.getBleObjectFromNetwork(t,"advertisingInterval");return"-"!=i&&(i+=" msec"),i},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser")+"].ble.advertisingInterval"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="100" data-max="5000" data-spinners="false" data-bind="value : fields.gatewayBleAdvertisementInterval, events:{change:change}" /></span><span style="margin-left:10px;">(100 ~ 5,000)</div>'},editViewModel:{fields:{gatewayBleAdvertisementInterval:null},init:function(){null===this.fields.gatewayBleAdvertisementInterval&&(this.fields.gatewayBleAdvertisementInterval=100)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser"),i=I.getBleObjectFromNetwork(t,"advertisingInterval");return"-"==i&&(i=100),i},isEditAll:!0},gatewayBleTxPower:{groupName:"bleSetup",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_TX_POWER"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser"),i=I.getBleObjectFromNetwork(t,"txPower");return"-"!=i&&(i+=" dBm"),i},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser")+"].ble.txPower"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="-20" data-max="8" data-spinners="false" data-bind="value : fields.gatewayBleTxPower, events:{change:change}" /></span><span style="margin-left:10px;">(-20 ~ 8)</div>'},editViewModel:{fields:{gatewayBleTxPower:null},init:function(){this.fields.gatewayBleTxPower||(this.fields.gatewayBleTxPower=0)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser"),i=I.getBleObjectFromNetwork(t,"txPower");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleCalibration:{groupName:"bleSetup",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_CALIBRATION"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser"),i=I.getBleObjectFromNetwork(t,"txPowerAttenuation");return"-"!=i&&(i+=" dBm"),i},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser")+"].ble.txPowerAttenuation"},editTemplate:function(){return'<div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="-100" data-max="0" data-spinners="false" data-bind="value : fields.gatewayBleCalibration, events:{change:change}" /></span><span style="margin-left:10px;">(-100 ~ 0)</div>'},editViewModel:{fields:{gatewayBleCalibration:null},init:function(){null===this.fields.gatewayBleCalibration&&(this.fields.gatewayBleCalibration=-100)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser"),i=I.getBleObjectFromNetwork(t,"txPowerAttenuation");return"-"==i&&(i=-100),i},isEditAll:!0},gatewayBleMacAddress:{groupName:"bleSetup",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser");return I.getBleObjectFromNetwork(t,"macAddress")}},gatewayBleFirstPower:{groupName:"bleFirst",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_POWER"),template:function(e){var t="-",i=I.getNetworkInterface(e,"BLE","Advertiser",0);return i&&(t=i.enabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",0)+"].enabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power-1" id="ble-power-on-1" checked="" value="true" data-bind="checked:fields.gatewayBleFirstPower, click:clickRadio"><label class="k-radio-label" for="ble-power-on-1" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power-1" id="ble-power-off-1" checked="" value="false" data-bind="checked:fields.gatewayBleFirstPower, click:clickRadio"><label class="k-radio-label" for="ble-power-off-1">Off</label></div>'},editViewModel:{fields:{gatewayBleFirstPower:null},init:function(){null===this.fields.gatewayBleFirstPower&&(this.fields.gatewayBleFirstPower=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=I.getNetworkInterface(e,"BLE","Advertiser",0);return i&&void 0!==i.enabled&&(t=i.enabled),t},isEditAll:!0},gatewayBleFirstAdvertiseName:{groupName:"bleFirst",type:"text",name:r.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",0);return I.getBleObjectFromNetwork(t,"advertisingName")},editable:!0,validator:{type:"name_16"},editCss:{width:"100%"},customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",0)+"].ble.advertisingName"},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",0),i=I.getBleObjectFromNetwork(t,"advertisingName");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleFirstUUID:{groupName:"bleFirst",type:"text",name:"UUID",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",0);return I.getBleObjectFromNetwork(t,"uuid")},validator:{type:"uuid"},editable:!0,editCss:{width:"100%"},customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",0)+"].ble.uuid"},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",0),i=I.getBleObjectFromNetwork(t,"uuid");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleFirstMajor:{groupName:"bleFirst",type:"text",name:"Major",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",0);return I.getBleObjectFromNetwork(t,"major")},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",0)+"].ble.major"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleFirstMajor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleFirstMajor:null},init:function(){null===this.fields.gatewayBleFirstMajor&&(this.fields.gatewayBleFirstMajor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",0),i=I.getBleObjectFromNetwork(t,"major");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleFirstMinor:{groupName:"bleFirst",type:"text",name:"Minor",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",0);return I.getBleObjectFromNetwork(t,"minor")},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",0)+"].ble.minor"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleFirstMinor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleFirstMinor:null},init:function(){null===this.fields.gatewayBleFirstMinor&&(this.fields.gatewayBleFirstMinor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",0),i=I.getBleObjectFromNetwork(t,"minor");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleFirstCalibratedTxPower:{groupName:"bleFirst",type:"text",name:"1m RSSI",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",0),i=I.getBleObjectFromNetwork(t,"calibratedTxPower");return"-"!=i&&(i+=" dBm"),i}},gatewayBleSecondPower:{groupName:"bleSecond",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_POWER"),template:function(e){var t="-",i=I.getNetworkInterface(e,"BLE","Advertiser",1);return i&&(t=i.enabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",1)+"].enabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power-2" id="ble-power-on-2" checked="" value="true" data-bind="checked:fields.gatewayBleSecondPower, click:clickRadio"><label class="k-radio-label" for="ble-power-on-2" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power-2" id="ble-power-off-2" checked="" value="false" data-bind="checked:fields.gatewayBleSecondPower, click:clickRadio"><label class="k-radio-label" for="ble-power-off-2">Off</label></div>'},editViewModel:{fields:{gatewayBleSecondPower:null},init:function(){null===this.fields.gatewayBleSecondPower&&(this.fields.gatewayBleSecondPower=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=I.getNetworkInterface(e,"BLE","Advertiser",1);return i&&void 0!==i.enabled&&(t=i.enabled),t},isEditAll:!0},gatewayBleSecondAdvertiseName:{groupName:"bleSecond",type:"text",name:r.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",1);return I.getBleObjectFromNetwork(t,"advertisingName")},editable:!0,validator:{type:"name_16"},editCss:{width:"100%"},customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",1)+"].ble.advertisingName"},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",1),i=I.getBleObjectFromNetwork(t,"advertisingName");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleSecondUUID:{groupName:"bleSecond",type:"text",name:"UUID",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",1);return I.getBleObjectFromNetwork(t,"uuid")},validator:{type:"uuid"},editable:!0,editCss:{width:"100%"},customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",1)+"].ble.uuid"},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",1),i=I.getBleObjectFromNetwork(t,"uuid");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleSecondMajor:{groupName:"bleSecond",type:"text",name:"Major",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",1);return I.getBleObjectFromNetwork(t,"major")},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",1)+"].ble.major"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleSecondMajor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleSecondMajor:null},init:function(){null===this.fields.gatewayBleSecondMajor&&(this.fields.gatewayBleSecondMajor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",1),i=I.getBleObjectFromNetwork(t,"major");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleSecondMinor:{groupName:"bleSecond",type:"text",name:"Minor",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",1);return I.getBleObjectFromNetwork(t,"minor")},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",1)+"].ble.minor"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleSecondMinor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleSecondMinor:null},init:function(){null===this.fields.gatewayBleSecondMinor&&(this.fields.gatewayBleSecondMinor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",1),i=I.getBleObjectFromNetwork(t,"minor");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleSecondCalibratedTxPower:{groupName:"bleSecond",type:"text",name:"1m RSSI",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",1),i=I.getBleObjectFromNetwork(t,"calibratedTxPower");return"-"!=i&&(i+=" dBm"),i}},gatewayBleThirdPower:{groupName:"bleThird",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_POWER"),template:function(e){var t="-",i=I.getNetworkInterface(e,"BLE","Advertiser",2);return i&&(t=i.enabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",2)+"].enabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power-3" id="ble-power-on-3" checked="" value="true" data-bind="checked:fields.gatewayBleThirdPower, click:clickRadio"><label class="k-radio-label" for="ble-power-on-3" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power-3" id="ble-power-off-3" checked="" value="false" data-bind="checked:fields.gatewayBleThirdPower, click:clickRadio"><label class="k-radio-label" for="ble-power-off-3">Off</label></div>'},editViewModel:{fields:{gatewayBleThirdPower:null},init:function(){null===this.fields.gatewayBleThirdPower&&(this.fields.gatewayBleThirdPower=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=I.getNetworkInterface(e,"BLE","Advertiser",2);return i&&void 0!==i.enabled&&(t=i.enabled),t},isEditAll:!0},gatewayBleThirdAdvertiseName:{groupName:"bleThird",type:"text",name:r.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME"),template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",2);return I.getBleObjectFromNetwork(t,"advertisingName")},editable:!0,validator:{type:"name_16"},editCss:{width:"100%"},customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",2)+"].ble.advertisingName"},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",2),i=I.getBleObjectFromNetwork(t,"advertisingName");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleThirdUUID:{groupName:"bleThird",type:"text",name:"UUID",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",2);return I.getBleObjectFromNetwork(t,"uuid")},validator:{type:"uuid"},editable:!0,editCss:{width:"100%"},customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",2)+"].ble.uuid"},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",2),i=I.getBleObjectFromNetwork(t,"uuid");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleThirdMajor:{groupName:"bleThird",type:"text",name:"Major",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",2);return I.getBleObjectFromNetwork(t,"major")},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",2)+"].ble.major"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleThirdMajor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleThirdMajor:null},init:function(){null===this.fields.gatewayBleThirdMajor&&(this.fields.gatewayBleThirdMajor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",2),i=I.getBleObjectFromNetwork(t,"major");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleThirdMinor:{groupName:"bleThird",type:"text",name:"Minor",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",2);return I.getBleObjectFromNetwork(t,"minor")},editable:!0,customFieldKey:function(e){return"networks["+I.getNetworkInterfaceIndex(e,"BLE","Advertiser",2)+"].ble.minor"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleThirdMinor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleThirdMinor:null},init:function(){null===this.fields.gatewayBleThirdMinor&&(this.fields.gatewayBleThirdMinor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",2),i=I.getBleObjectFromNetwork(t,"minor");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleThirdCalibratedTxPower:{groupName:"bleThird",type:"text",name:"1m RSSI",template:function(e){var t=I.getNetworkInterface(e,"BLE","Advertiser",2),i=I.getBleObjectFromNetwork(t,"calibratedTxPower");return"-"!=i&&(i+=" dBm"),i}},gatewayWifiFirstStatus:{groupName:"wifiFirst",type:"text",name:r.prop("COMMON_STATUS"),template:function(e){var t="-",i=I.getNetworkInterface(e,"WiFi2.4GHz");return i&&(t=i.enabled?"On":"Off"),t}},gatewayWifiFirstChannel:{groupName:"wifiFirst",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_WIFI_CHANNEL"),template:function(e){var t=I.getNetworkInterface(e,"WiFi2.4GHz");return I.getWifiObjectFromNetwork(t,"channel")}},gatewayWifiFirstTxPower:{groupName:"wifiFirst",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_TX_POWER"),template:function(e){var t="-",i=I.getNetworkInterface(e,"WiFi2.4GHz");return"-"!=(t=I.getWifiObjectFromNetwork(i,"txPower"))&&(t+=" dBm"),t}},gatewayWifiFirstChannelUtilization:{groupName:"wifiFirst",name:r.prop("FACILITY_DEVICE_NETWORK_CHANNEL_UTILIZATION"),template:function(){return""}},gatewayWifiFirstChannelUtilizationTotal:{groupName:"wifiFirst",name:"<div style='margin-left:10px;'>"+r.prop("COMMON_TOTAL")+"</div>",template:function(e){var t,i="-",a=I.getNetworkInterface(e,"WiFi2.4GHz");return a&&a.wifi&&((t=a.wifi.statistics)&&t.channelUtilization&&(i=(i=t.channelUtilization.total)||"-"),"-"!=i&&(i+=" %")),i}},gatewayWifiFirstChannelUtilizationNonWifi:{groupName:"wifiFirst",name:"<div style='margin-left:10px;'>"+r.prop("FACILITY_DEVICE_NETWORK_NONE_WIFI")+"</div>",template:function(e){var t,i="-",a=I.getNetworkInterface(e,"WiFi2.4GHz");return a&&a.wifi&&((t=a.wifi.statistics)&&t.channelUtilization&&(i=(i=t.channelUtilization["non802.11"])||"-"),"-"!=i&&(i+=" %")),i}},gatewayWifiFirstInterferer:{groupName:"wifiFirst",type:"grid",name:r.prop("FACILITY_DEVICE_NETWORK_WIFI_INTERFERER"),valueFieldDisplayType:"row",gridDataSource:function(e){var t,i=[],a=I.getNetworkInterface(e,"WiFi2.4GHz");return a&&a.wifi&&(t=a.wifi.statistics)&&t.interferers&&(i=t.interferers),i},gridOptions:$.extend({},s,z)},gatewayWifiSecondStatus:{groupName:"wifiSecond",type:"text",name:r.prop("COMMON_STATUS"),template:function(e){var t="-",i=I.getNetworkInterface(e,"WiFi5GHz");return i&&(t=i.enabled?"On":"Off"),t}},gatewayWifiSecondChannel:{groupName:"wifiSecond",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_WIFI_CHANNEL"),template:function(e){var t=I.getNetworkInterface(e,"WiFi5GHz");return I.getWifiObjectFromNetwork(t,"channel")}},gatewayWifiSecondTxPower:{groupName:"wifiSecond",type:"text",name:r.prop("FACILITY_DEVICE_NETWORK_TX_POWER"),template:function(e){var t="-",i=I.getNetworkInterface(e,"WiFi5GHz");return"-"!=(t=I.getWifiObjectFromNetwork(i,"txPower"))&&(t+=" dBm"),t}},gatewayWifiSecondChannelUtilization:{groupName:"wifiSecond",name:r.prop("FACILITY_DEVICE_NETWORK_CHANNEL_UTILIZATION"),template:function(){return""}},gatewayWifiSecondChannelUtilizationTotal:{groupName:"wifiSecond",name:"<div style='margin-left:10px;'>"+r.prop("COMMON_TOTAL")+"</div>",template:function(e){var t,i="-",a=I.getNetworkInterface(e,"WiFi5GHz");return a&&a.wifi&&((t=a.wifi.statistics)&&t.channelUtilization&&(i=(i=t.channelUtilization.total)||"-"),"-"!=i&&(i+=" %")),i}},gatewayWifiSecondChannelUtilizationNonWifi:{groupName:"wifiSecond",name:"<div style='margin-left:10px;'>"+r.prop("FACILITY_DEVICE_NETWORK_NONE_WIFI")+"</div>",template:function(e){var t,i="-",a=I.getNetworkInterface(e,"WiFi5GHz");return a&&a.wifi&&((t=a.wifi.statistics)&&t.channelUtilization&&(i=(i=t.channelUtilization["non802.11"])||"-"),"-"!=i&&(i+=" %")),i}},gatewayWifiSecondInterferer:{groupName:"wifiSecond",type:"grid",name:r.prop("FACILITY_DEVICE_NETWORK_WIFI_INTERFERER"),valueFieldDisplayType:"row",gridDataSource:function(e){var t,i=[],a=I.getNetworkInterface(e,"WiFi5GHz");return a&&a.wifi&&(t=a.wifi.statistics)&&t.interferers&&(i=t.interferers),i},gridOptions:$.extend({},s,z)},connectedDevices:{type:_.ui.CommonGroupList,name:r.prop("FACILITY_DEVICE_CONNECTION_DEVICE"),valueFieldDisplayType:"row",editable:I.isEnableEnergyMappingType,widgetOptions:{columns:[{field:"name",template:function(e){return"building_group_value"===e.field?e.value.split("_").slice(2):"floor_group_value"===e.field?e.value.split("_").slice(2):e.name}}],group:[{field:"building_group_value",dir:"asc",aggregates:[{field:"building_group_value",aggregate:"count"}]},{field:"floor_group_value",dir:"asc",aggregates:[{field:"floor_group_value",aggregate:"count"}]}],showEditListHeader:!1,checkedLimit:200},customFieldName:I.getEnergyMappingFieldName,widgetEditGetter:function(e){var t,i,a=e.widget,n=a.getAssignedItems(),r=[],o=n.length;for(i=0;i<o;i++)t=n[i],r.push({dms_devices_id:t.id.split("_edit")[0]});return a.hideEditMode(!0),r},widgetDisplaySetter:function(e){var t=e.sender,i=e.widget,a=I.getMeterConnectedDevices(e.data);t.hasConnectedDevices||(t.hasConnectedDevices={}),a?void 0===t.hasConnectedDevices[e.data.id]&&(t.hasConnectedDevices[e.data.id]=!0):(a=[],void 0===t.hasConnectedDevices[e.data.id]&&(t.hasConnectedDevices[e.data.id]=!1)),T.open(t.element),I.getEnergyMappingOutdoorList(a).done(function(e){i.data(e),i.hideEditMode(!0)}).fail(function(e){var t=C.parseFailResponse(e);oe.message(t),oe.open()}).always(function(){T.close()})},widgetEditSetter:function(e){var i=e.sender,a=e.widget,t=I.getMeterConnectedDevices(e.data);t=t||[],T.open(i.element),I.getEnergyMappingOutdoorList(t).done(function(e){for(var t=0;t<e.length;t++)e[t].id+="_edit";a.data(e),a.hideEditMode(!1),a.unbind("change"),a.bind("change",function(){i.enableSaveBtn()})}).fail(function(e){var t=C.parseFailResponse(e);oe.message(t),oe.open()}).always(function(){T.close()})}}}}},K={All:[],"AirConditioner.Indoor":["type","id","name","representativeStatus","modes","setTemperature","currentTemperature","remoteControl","locations","groups","information","firmwareVersion","description"],AirConditionerOutdoor:["type","id","name","representativeStatus","modes","outdoorTemperature","locations","groups","information","firmwareVersion","description"],ControlPoint:["type","tagName","id","name","representativeStatus","pointValue","pointMode","signalLogicStatus","signalReverse","inputRange","scaleType","scale","bias","maxValue","minValue","ioDescription","locations","groups","description"],Meter:["type","id","name","meterType","pointMeterType","consumptionCategory","sacConnectionType","representativeStatus","locations","groups","currentConsumption","manufacturer","information","firmwareVersion","description","connectedDevices"],"Sensor.Temperature_Humidity":["type","weatherStation","id","name","representativeStatus","locations","groups","temperatureUnit","sensorTemperature","humidity","lastEventTime","manufacturer","information","firmwareVersion","description"],Light:["type","id","name","representativeStatus","locations","groups","brightness","lastEventTime","manufacturer","information","firmwareVersion","description"],SmartPlug:["type","id","name","representativeStatus","locations","groups","lastEventTime","manufacturer","information","firmwareVersion","description"],"Sensor.Motion":["type","id","name","representativeStatus","locations","groups","lastEventTime","presence","manufacturer","information","firmwareVersion","description"],Gateway:["type","id","name","representativeStatus","locations","groups","macAddress","ipAddress","lastEventTime","manufacturer","information","firmwareVersion","hardwareVersion","softwareVersion","apiVersion","powerAvailableSource","powerCurrentSource","schedule","rule","description","gatewayZigbeeId","gatewayZigbeePower","gatewayZigbeeFirmwareVersion","gatewayZigbeeChannel","gatewayZigbeeTxPower","gatewayZigbeePairingMode","gatewayBlePower","gatewayBleFirmwareVersion","gatewayBleAppVersion","gatewayBleScanReport","gatewayBleScanReportInterval","gatewayBleScanWindow","gatewayBleScanInterval","gatewayBleScanType","gatewayBleAdvertisementInterval","gatewayBleTxPower","gatewayBleCalibration","gatewayBleMacAddress","gatewayBleFirstPower","gatewayBleFirstAdvertiseName","gatewayBleFirstUUID","gatewayBleFirstMajor","gatewayBleFirstMinor","gatewayBleFirstCalibratedTxPower","gatewayBleSecondPower","gatewayBleSecondAdvertiseName","gatewayBleSecondUUID","gatewayBleSecondMajor","gatewayBleSecondMinor","gatewayBleSecondCalibratedTxPower","gatewayBleThirdPower","gatewayBleThirdAdvertiseName","gatewayBleThirdUUID","gatewayBleThirdMajor","gatewayBleThirdMinor","gatewayBleThirdCalibratedTxPower","gatewayWifiFirstStatus","gatewayWifiFirstChannel","gatewayWifiFirstTxPower","gatewayWifiFirstChannelUtilization","gatewayWifiFirstChannelUtilizationTotal","gatewayWifiFirstChannelUtilizationNonWifi","gatewayWifiFirstInterferer","gatewayWifiSecondStatus","gatewayWifiSecondChannel","gatewayWifiSecondTxPower","gatewayWifiSecondChannelUtilization","gatewayWifiSecondChannelUtilizationTotal","gatewayWifiSecondChannelUtilizationNonWifi","gatewayWifiSecondInterferer"],Beacon:["type","id","name","representativeStatus","configuration","locations","currentLocations","groups","parentId","lastEventTime","bleMacAddress","signalLevel","batteryLevel","schedule","rule","description","writable","advertisingName","advertisingInterval","uuid","major","minor","txPower","calibratedTxPower"],CCTV:["type","id","name","representativeStatus","locations","groups","parentId","macAddress","ipAddress","lastEventTime","dataStatus","schedule","rule","description","wifiStatus","wifiType","wifiChannel","wifiRssi","cctvWifiMacAddress","cctvWifiIPAddress","cctvWifiTxPower","cctvWifiChannelUtilization","cctvWifiChannelUtilizationTotal","cctvWifiChannelUtilizationNonWifi","cctvWifiInterferer"]},Z=["advertisingName","advertisingInterval","uuid","major","minor","txPower"];function q(e,t){var i,a=Z.length,n=!1;for(i=0;i<a;i++)if(void 0!==t[Z[i]]){n=!0;break}if(console.error(t),n){var r,o={ble:{}},l=e.networks;if(l&&l[0])for(a=l.length,i=0;i<a;i++)if("BLE"==l[i].type){for(r in o.id=l[i].id,t)-1!=Z.indexOf(r)&&(o.ble[r]=t[r],l[i].ble.set(r,t[r]),delete t[r]);break}t.networks?t.networks=o:(t.networks=[],t.networks.push(o))}}var X={zigbee:["gatewayZigbeePower","gatewayZigbeeChannel","gatewayZigbeeTxPower","gatewayZigbeePairingMode"],ble:["gatewayBlePower","gatewayBleScanReport","gatewayBleScanReportInterval","gatewayBleScanWindow","gatewayBleScanInterval","gatewayBleScanType"],bleFirst:["gatewayBleAdvertisementInterval","gatewayBleTxPower","gatewayBleCalibration","gatewayBleFirstPower","gatewayBleFirstAdvertiseName","gatewayBleFirstUUID","gatewayBleFirstMajor","gatewayBleFirstMinor"],bleSecond:["gatewayBleAdvertisementInterval","gatewayBleTxPower","gatewayBleCalibration","gatewayBleSecondPower","gatewayBleSecondAdvertiseName","gatewayBleSecondUUID","gatewayBleSecondMajor","gatewayBleSecondMinor"],bleThird:["gatewayBleAdvertisementInterval","gatewayBleTxPower","gatewayBleCalibration","gatewayBleThirdPower","gatewayBleThirdAdvertiseName","gatewayBleThirdUUID","gatewayBleThirdMajor","gatewayBleThirdMinor"]},Q={gatewayZigbeePower:"enabled",gatewayZigbeeChannel:"channel",gatewayZigbeeTxPower:"txPower",gatewayZigbeePairingMode:"pairing",gatewayBlePower:"enabled",gatewayBleScanReport:"scanlistReportEnabled",gatewayBleScanReportInterval:"scanlistReportInterval",gatewayBleScanWindow:"scanWindow",gatewayBleScanInterval:"scanInterval",gatewayBleScanType:"scanType",gatewayBleAdvertisementInterval:"advertisingInterval",gatewayBleTxPower:"txPower",gatewayBleCalibration:"txPowerAttenuation",gatewayBleFirstPower:"enabled",gatewayBleSecondPower:"enabled",gatewayBleThirdPower:"enabled",gatewayBleFirstAdvertiseName:"advertisingName",gatewayBleSecondAdvertiseName:"advertisingName",gatewayBleThirdAdvertiseName:"advertisingName",gatewayBleFirstUUID:"uuid",gatewayBleSecondUUID:"uuid",gatewayBleThirdUUID:"uuid",gatewayBleFirstMajor:"major",gatewayBleSecondMajor:"major",gatewayBleThirdMajor:"major",gatewayBleFirstMinor:"minor",gatewayBleSecondMinor:"minor",gatewayBleThirdMinor:"minor"};function J(e,t){var i,a,n,r=Z.length,o=!1;for(a in X){for(r=(i=X[a]).length,n=0;n<r;n++)if(void 0!==t[i[n]]){o=!0;break}if(o)break}if(o){var l,s,d,c,p,u={},g=[],f=[];for(a in X)for(l in i=X[a],t)-1!=i.indexOf(l)&&(u[a]||(u[a]={}),"zigbee"==a?((d=I.getNetworkInterface(e,"Zigbee")).zigbee||(d.zigbee={}),p=d.zigbee,u[a].zigbee||(u[a].zigbee={}),c=u[a].zigbee):"ble"==a?((d=I.getNetworkInterface(e,"BLE","Scanner")).ble||(d.ble={}),p=d.ble,u[a].ble||(u[a].ble={}),c=u[a].ble):"bleFirst"==a?((d=I.getNetworkInterface(e,"BLE","Advertiser",0)).ble||(d.ble={}),p=d.ble,u[a].ble||(u[a].ble={}),c=u[a].ble):"bleSecond"==a?(c=d=I.getNetworkInterface(e,"BLE","Advertiser",1),d.ble||(d.ble={}),p=d.ble,u[a].ble||(u[a].ble={}),c=u[a].ble):"bleThird"==a&&((d=I.getNetworkInterface(e,"BLE","Advertiser",2)).ble||(d.ble={}),p=d.ble,u[a].ble||(u[a].ble={}),c=u[a].ble),u[a].id=d.id,"enabled"==(s=Q[l])?("true"==t[l]?t[l]=!0:"false"==t[l]&&(t[l]=!1),u[a][s]=t[l],d.set?d.set(s,t[l]):d[s]=t[l]):("true"==t[l]?t[l]=!0:"false"==t[l]&&(t[l]=!1),c[s]=t[l],p.set?p.set(s,t[l]):p[s]=t[l]),f.push(l));for(r=f.length,n=0;n<r;n++)delete t[f[n]];for(a in u)void 0!==u[a].id&&g.push(u[a]);t.networks=g}}var ee,te,ie,ae,ne={ControlPoint:{selectedDetailFilter:function(e){var t=e.type;if(t){if(-1!=t.indexOf("DI")||-1!=t.indexOf("DO")||-1!=t.indexOf("DV"))return["inputRange","scaleType","scale","bias","maxValue","minValue"];if(-1!=t.indexOf("AI")||-1!=t.indexOf("AO")||-1!=t.indexOf("AV"))return["pointMode","signalLogicStatus","signalReverse"]}}},Meter:{detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',selectedDetailFilter:function(e){var t,i=e.type;return i&&(t=-1!=i.indexOf("ControlPoint")?["meterType"]:["pointMeterType"]),I.isEnableEnergyMappingType(e)||t.push("connectedDevices"),t}},"Sensor.Motion":{detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>'},"Sensor.Temperature_Humidity":{detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>'},Light:{width:932,height:888,gridOptions:{height:"calc(100% - 60px)",columns:[{headerTemplate:"",template:function(e){var t=v.dialogType,i="register"==t||"deregister"==t,a="deregister"==t;return n.multiDetailListDualTemplate(e,i,a)}}]},onTypeChange:function(e){H(e);var t,i,a,n=e.sender,r=!1,o=!1,l=!1,s=void 0,d=n.dataSource.data(),c=d.length,p=0,u=0,g=0;for(t=0;t<c;t++)if(i=(a=d[t]).type){-1!=i.indexOf("AO")&&(o=!0),-1!=i.indexOf("DO")&&(r=!0),"Light"==i&&(o=r=!0),"Normal.On"==C.getStatus(a)?(p=p<1?1:p,void 0===s?s="On":l||"Off"!==s||(l=!0)):(p=p<=0?0:p,void 0===s?s="Off":l||"On"!==s||(l=!0));var f=I.getDimmingLevel(a);"-"!=f&&-1==i.indexOf("AI")&&-1==i.indexOf("DI")&&(f=f.replace("%",""),u+=f=Number(f),g++)}0!=g&&(u=Math.round(u/g));var m=E.lightControlViewModel;m.init(n),p=1==p,m.light.power.set("active",p),m.light.power.set("mixed",l),m.light.set("value",u);var v=n.element.find(".group-control-dialog-control");if(!r&&!o||n.dialogType)n.element.find(".group-control-dialog").removeClass("group-control-dialog"),v.hide(),n.wrapper.css({width:652});else{n.wrapper.css({width:932}),_.unbind(v),_.bind(v,m);var T=m.get("light");T.power.set("invisible",!r),T.set("invisible",!o)}},contentTemplate:'<div class="group-control-dialog detail-dialog-content device-dialog-content" style="width:592px;"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>'+E.lightControlTemplate},Beacon:{parseSaveData:function(e,t){if(!t)return t;var i,a;if($.isArray(t))for(a=t.length,i=0;i<a;i++)q(e[i],t[i]);else q(e,t);return t},buttonsIndex:{CLOSE:0,EDIT:1,CANCEL:2,SAVE:3,REGISTER:4,DEREGISTER:5,BLOCK:6,DELETE:7},onTypeChange:function(e){var t=e.type,i=e.sender.BTN,a=e.sender.dataSource.data();"register"==t?(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.EDIT,{visible:!1}),v.setActions(i.DEREGISTER,{visible:!1}),v.setActions(i.DELETE,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.REGISTER,{visible:!0}),v.setActions(i.BLOCK,{visible:!1})):"deregister"==t?(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.REGISTER,{visible:!1}),v.setActions(i.DELETE,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.EDIT,{visible:!0}),v.setActions(i.DEREGISTER,{visible:!0}),v.setActions(i.BLOCK,{visible:!1})):"delete"==t?(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.BLOCK,{visible:!1}),v.setActions(i.DEREGISTER,{visible:!1}),v.setActions(i.REGISTER,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.EDIT,{visible:!0}),v.setActions(i.DELETE,{visible:!0})):(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.DEREGISTER,{visible:!1}),v.setActions(i.REGISTER,{visible:!1}),v.setActions(i.BLOCK,{visible:!1}),v.setActions(i.DELETE,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),1<a.length?v.setActions(i.EDIT,{visible:!0,disabled:!0}):v.setActions(i.EDIT,{visible:!0,disabled:!1}))},actions:[{text:r.prop("COMMON_BTN_CLOSE"),visible:!0,action:P},{text:r.prop("COMMON_BTN_EDIT"),visible:!0,action:k},{text:r.prop("COMMON_BTN_CANCEL"),visible:!1,action:Y},{text:r.prop("COMMON_BTN_SAVE"),visible:!1,disabled:!0,action:U},{text:r.prop("COMMON_BTN_REGISTER"),visible:!1,action:W},{text:r.prop("COMMON_BTN_DEREGISTER"),visible:!1,action:G},{text:r.prop("COMMON_BTN_BLOCK"),visible:!1,action:function(e){var t,i=e.sender.getSelectedData(),a={registrationStatus:"Blocked"};if(1<e.sender.dataSource.total()){var n,r,o=(i=(i=e.sender.dataSource.data()).toJSON()).length;for(t=[],n=0;n<o;n++)(r={}).id=i[n].id,r.registrationStatus="Blocked",t.push(r)}return e.sender.trigger("onBlock",{sender:e.sender,result:a,results:t}),!1}},{text:r.prop("COMMON_BTN_DELETE"),visible:!1,action:function(e){var t,i=e.sender.getSelectedData(),a={};if(a.id=i.id,1<e.sender.dataSource.total()){var n,r,o=(i=(i=e.sender.dataSource.data()).toJSON()).length;for(t=[],n=0;n<o;n++)(r={}).id=i[n].id,t.push(r)}return e.sender.trigger("onDelete",{sender:e.sender,result:a,results:t}),!1}}],scheme:{groupName:{advertisement:{template:"<div class='group'>Advertisement</div>"}},fields:{description:{isEditAll:!0},configuration:{isEditAll:!0}}}},Gateway:{parseSaveData:function(e,t){if(!t)return t;var i,a;if($.isArray(t))for(a=t.length,i=0;i<a;i++)J(e[i],t[i]);else J(e,t);return t},selectedDetailFilter:function(e){var t=e.networks;if(!t||!t[0])return["wifiFirst","wifiSecond"];var i,a=t.length,n=["wifiFirst","wifiSecond"];for(i=0;i<a;i++)"WiFi2.4GHz"==t[i].type?n[0]=null:"WiFi5GHz"==t[i].type&&(n[1]=null);var r=I.getNetworkInterfaceIndex(e,"Zigbee",null,null,!0);return-1==r&&n.push("zigbeeInterface"),-1==(r=I.getNetworkInterfaceIndex(e,"BLE","Scanner",null,!0))&&n.push("bleInterface"),-1==(r=I.getNetworkInterfaceIndex(e,"BLE","Advertiser",0,!0))?(n.push("bleSetup"),n.push("bleFirst"),n.push("bleSecond"),n.push("bleThird")):(-1==(r=I.getNetworkInterfaceIndex(e,"BLE","Advertiser",2,!0))&&n.push("bleThird"),-1==(r=I.getNetworkInterfaceIndex(e,"BLE","Advertiser",1,!0))&&n.push("bleSecond")),n},scheme:{groupName:{zigbeeInterface:{template:"<div class='group'>ZigBee Interface</div>"},bleInterface:{template:"<div class='group'>BLE Interface</div>"},bleSetup:{template:"<div class='group'>Built-in Beacon Setup</div>"},bleFirst:{template:"<div class='group'>Built-in Beacon #1</div>"},bleSecond:{template:"<div class='group'>Built-in Beacon #2</div>"},bleThird:{template:"<div class='group'>Built-in Beacon #3</div>"},wifiFirst:{template:"<div class='group'>WIFI Interface (2.4GHz)</div>"},wifiSecond:{template:"<div class='group'>WIFI Interface (5GHz)</div>"}},fields:{description:{isEditAll:!0}}}},CCTV:{scheme:{groupName:{wifiInterface:{template:"<div class='group'>WIFI Interface</div>"},wifiInterfaceDetail:{template:"<div class='group'>Gateway WIFI Interface (<span data-bind='text: wifiFrequency'></span>)</div>"}},fields:{description:{isEditAll:!0}}},setAdditionalDetailData:function(n){console.error("set additional!"),console.error(this),T.open(this.element);var r,e=n.parentId,o=n.networks;if(o&&o[0]){if((r=o[0]).type)return $.ajax({url:"/dms/devices/"+e+"/networks"}).then(function(e){T.close();var t,i=e.length;if(e&&e[0]){var a=o[1];for(t=0;t<i;t++)if(e[t].type==a.type){e=e[t];break}r?r.wifi=e.wifi:o.push(e)}n.wifiFrequency=I.getCCTVWifiType(n),n.wifi=e.wifi}).fail(function(){T.close()})}else n.wifiFrequency="-";var t=new $.Deferred;return t.resolve(),T.close(),t.promise()},onTypeChange:function(e){var t=e.sender.dataSource.data().length,i=e.type,a=e.sender.BTN;"register"==i?(v.setActions(a.SAVE,{visible:!1}),v.setActions(a.CANCEL,{visible:!1}),v.setActions(a.EDIT,{visible:!1}),v.setActions(a.DEREGISTER,{visible:!1}),v.setActions(a.CLOSE,{visible:!0}),v.setActions(a.REGISTER,{visible:!0})):"deregister"==i?(v.setActions(a.SAVE,{visible:!1}),v.setActions(a.CANCEL,{visible:!1}),v.setActions(a.REGISTER,{visible:!1}),v.setActions(a.CLOSE,{visible:!0}),v.setActions(a.EDIT,{visible:!0}),v.setActions(a.DEREGISTER,{visible:!0})):(v.setActions(a.SAVE,{visible:!1}),v.setActions(a.CANCEL,{visible:!1}),v.setActions(a.DEREGISTER,{visible:!1}),v.setActions(a.REGISTER,{visible:!1}),v.setActions(a.CLOSE,{visible:!0}),1<t?v.setActions(a.EDIT,{visible:!0,disabled:!0}):v.setActions(a.EDIT,{visible:!0,disabled:!1}))}},SmartPlug:{width:932,height:888,gridOptions:{height:"calc(100% - 60px)",columns:[{headerTemplate:"",template:function(e){var t=v.dialogType,i="register"==t||"deregister"==t,a="deregister"==t;return n.multiDetailListDualTemplate(e,i,a)}}]},onTypeChange:function(e){var t,i,a,n=e.sender,r=!1,o=!1,l=n.dataSource.data(),s=l.length,d=0;for(t=0;t<s;t++){if(i=(a=l[t]).type)-1!=i.indexOf("AO")&&(o=!0),-1!=i.indexOf("DO")&&(r=!0),"SmartPlug"==i&&(r=!0),d="Normal.On"==C.getStatus(a)?d<1?1:d:d<=0?0:d}var c=e.type,p=e.sender.BTN;"register"==c?(v.setActions(p.SAVE,{visible:!1}),v.setActions(p.CANCEL,{visible:!1}),v.setActions(p.EDIT,{visible:!1}),v.setActions(p.DEREGISTER,{visible:!1}),v.setActions(p.CLOSE,{visible:!0}),v.setActions(p.REGISTER,{visible:!0})):"deregister"==c?(v.setActions(p.SAVE,{visible:!1}),v.setActions(p.CANCEL,{visible:!1}),v.setActions(p.REGISTER,{visible:!1}),v.setActions(p.CLOSE,{visible:!0}),v.setActions(p.EDIT,{visible:!0}),v.setActions(p.DEREGISTER,{visible:!0})):(v.setActions(p.SAVE,{visible:!1}),v.setActions(p.CANCEL,{visible:!1}),v.setActions(p.DEREGISTER,{visible:!1}),v.setActions(p.REGISTER,{visible:!1}),v.setActions(p.CLOSE,{visible:!0}),1<s?v.setActions(p.EDIT,{visible:!0,disabled:!0}):v.setActions(p.EDIT,{visible:!0,disabled:!1}));var u=m.smartPlugControlViewModel;u.init(n),d=1==d,u.smartPlug.power.set("active",d),u.smartPlug.set("value",0);var g=n.element.find(".group-control-dialog-control");if(r||o){n.wrapper.css({width:932}),_.unbind(g),_.bind(g,u);var f=u.get("smartPlug");f.power.set("invisible",!r),f.set("invisible",!o)}else n.element.find(".group-control-dialog").removeClass("group-control-dialog"),g.hide(),n.wrapper.css({width:652})},contentTemplate:'<div class="group-control-dialog detail-dialog-content device-dialog-content" style="width:592px;"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>'+m.smartPlugControlTemplate},All:{buttonsIndex:{CLOSE:0},onTypeChange:function(e){var t=e.sender.BTN;v.setActions(t.CLOSE,{visible:!0}),v.setActions(t.EDIT,{visible:!1})},selectedDetailFilter:function(e){var t=e.mappedType||e.type,i=$.extend(!0,{},re.All.scheme.fields),a=$.extend(!0,{},re.All.scheme.groupName);-1!=(t=C.getGeneralType(t)).indexOf("Meter")?t="Meter":-1==t.indexOf("Humidity")&&-1==t.indexOf("Temperature")||(t="Sensor.Temperature_Humidity");var n=K[t];n||console.error("there is no field this device "+t);var r,o=re[t].scheme.groupName?re[t].scheme.groupName:{},l=[];for(r in i)-1==n.indexOf(r)&&l.push(r);for(r in a)o[r]||l.push(r);var s=[];ne[t]&&ne[t].selectedDetailFilter&&(s=ne[t].selectedDetailFilter(e));var d,c,p=s.length;for(d=0;d<p;d++)-1!=(c=l.indexOf(s[d]))&&l.splice(c,1);return l},actions:[{text:r.prop("COMMON_BTN_CLOSE"),visible:!0,action:P}],scheme:{groupName:{}}}},re={};for(ie in K){if(te=K[ie],ee=$.extend(!0,{},j),"All"!==ie)for(ae in ee.scheme.fields)-1==te.indexOf(ae)&&delete ee.scheme.fields[ae];re[ie]=ee}for(ie in ne)"All"!==ie&&ne[ie].scheme&&ne[ie].scheme.groupName&&$.extend(ne.All.scheme.groupName,ne[ie].scheme.groupName);for(ie in ne)ee=re[ie],ee=$.extend(!0,ee,ne[ie]);var oe,le,se=$("<div/>");return oe=se.kendoCommonDialog().data("kendoCommonDialog"),le=$("<div/>").kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog"),{getDetailPopup:function(e){return v=t.kendoDetailDialog(re[e]).data("kendoDetailDialog")},messageDialog:oe,confirmDialog:le}}),define("device/common/config/base-config",[],function(){var t=window.kendo,i=window.I18N,e={widget:t.ui.Grid,routeUrl:"/statistic",widgetOptions:{dataSource:[],height:"100%",scrollable:!0,sortable:!0,filterable:!1,pageable:!1}},a={widget:t.ui.CommonMapView,routeUrl:"/map",widgetOptions:{dataSource:[]}},n={widget:t.ui.Grid,routeUrl:"/list",widgetOptions:{hasSelectedModel:!0,dataSource:[],selectable:"multiple, row",height:"100%",scrollable:{virtual:!0},sortable:!0,filterable:!1,pageable:!1}},r={routeUrl:"/grid",widget:t.ui.Grid,noRecords:!0,widgetOptions:{hasSelectedModel:!0,dataSource:[],selectable:"multiple, row",scrollable:{virtual:!0},cardHeight:206,cardNum:5}},o={invisible:!1,disabled:!1,dataTextField:"text",dataValueField:"value",animation:!1,value:null,open:function(){},close:function(){},change:function(){},select:function(){}},l={id:"device-type-filter",name:"type",type:"dropdownlist",liClassName:"",options:o},s={type:"dropdowncheckbox",liClassName:"",options:$.extend(!0,{},o,{selectionChanged:function(){},isAbleUnselectAll:!0})},d=$.extend(!0,{},s,{id:"device-status-filter",name:"status",options:{emptyText:i.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY"),selectAllText:i.prop("FACILITY_DEVICE_ALL_STATUS"),dataSource:[{text:i.prop("FACILITY_DEVICE_STATUS_NORMAL"),value:1},{text:i.prop("FACILITY_DEVICE_STATUS_CRITICAL"),value:3},{text:i.prop("FACILITY_DEVICE_STATUS_WARNING"),value:4}]}}),c=$.extend(!0,{},d,{options:{dataSource:[{text:i.prop("FACILITY_DEVICE_STATUS_NORMAL_ON"),value:1},{text:i.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF"),value:2},{text:i.prop("FACILITY_DEVICE_STATUS_CRITICAL"),value:3},{text:i.prop("FACILITY_DEVICE_STATUS_WARNING"),value:4}]}}),p=$.extend(!0,{},s,{id:"device-zone-filter",name:"zone",options:{emptyText:i.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY_ZONE"),selectAllText:i.prop("FACILITY_DEVICE_ALL_ZONE"),dataTextField:"name",dataValueField:"id"}}),u={type:"button",name:"selectAll",id:"device-select-all",text:i.prop("COMMON_BTN_SELECT_ALL"),liClassName:"",options:{invisible:!1,disabled:!1,click:function(){}}},g={type:"template",name:"selectedText",id:"device-selected-text",template:"<span class='text-view'><span data-bind='text: options.selectedText'></span></span>",liClassName:"",options:{selectedText:i.prop("FACILITY_DEVICE_NO_SELECTED")}},f={type:"button",id:"device-register-btn",name:"register",text:i.prop("COMMON_BTN_REGISTER"),liClassName:"",options:{invisible:!0,disabled:!0,click:function(){}}},m={type:"button",id:"device-detail-btn",name:"detail",text:i.prop("COMMON_BTN_DETAIL"),liClassName:"",options:{invisible:!1,disabled:!0,click:function(){}}},v={type:"button",id:"device-delete-btn",name:"delete",text:i.prop("COMMON_BTN_DELETE"),liClassName:"",options:{invisible:!1,disabled:!0,click:function(){}}},T={type:"button",id:"device-view-btn",name:"view",text:i.prop("COMMON_BTN_SHOW"),liClassName:"",options:{invisible:!1,disabled:!0,click:function(){}}},I={name:i.prop("FACILITY_DEVICE_MONITORING"),layoutName:"monitoring",active:!0,disabled:!1,invisible:!1,routeUrl:"/monitoring",dataLayout:{list:n}},E={name:i.prop("FACILITY_DEVICE_REGISTRATION"),layoutName:"registration",active:!1,disabled:!1,invisible:!1,routeUrl:"/registration",dataLayout:{map:a,list:n}};return{deviceTabConfig:{name:"Tab Name",routeUrl:"/device-type",viewModel:{viewButtons:[{buttonClass:"ic ic-statistic",viewName:"statistic"},{buttonClass:"ic ic-location",viewName:"map"},{buttonClass:"ic ic-view-list",viewName:"list"},{buttonClass:"ic ic ic-view-2x2",viewName:"grid"}],registrationStatusButtons:[{name:i.prop("FACILITY_DEVICE_REGISTERED"),active:!0,disabled:!1,count:0,click:function(){}},{name:i.prop("FACILITY_DEVICE_UNREGISTERED"),active:!1,disabled:!1,count:0,click:function(){}}],searchFieldPlaceHolder:i.prop("COMMON_ENTER_SEARCH_TERMS"),searchFieldValue:"",searchKeyDown:function(){},searchClick:function(){},enableSearch:!0,hideSearch:!1,hideSelectArea:!1,hideFilterArea:!1,hideActionArea:!1,hideRegisterArea:!0,hideRightPanel:!0,hideMapPanel:!0,hideControlPanel:!1,hideLightControlPanel:!1,hideMonitoringMapPanel:!0,hideRegistrationMapPanel:!1,filters:[],actions:[g,f,m]},innerLayout:[I,E]},statisticViewConfig:e,mapViewConfig:a,listViewConfig:n,gridViewConfig:r,dropDownListConfig:l,dropDownCheckBoxListConfig:s,baseStatusFilterConfig:d,statusFilterConfig:c,zoneFilterConfig:p,selectAllButtonConfig:u,legendTemplate:function(e){return{type:"template",id:"device-legend",liClassName:"",template:t.template('<div class="legendNote"><div><Label class="ic-help"></Label><p>'+i.prop("FACILITY_DEVICE_LEGEND")+'</p></div><div class="flyout"><Label class="flyTail ic-flyout-legends "></Label>#=legendHtml#</div></div>')({legendHtml:e})}},selectedTextActionConfig:g,registerBtnActionConfig:f,detailBtnActionConfig:m,deleteBtnActionConfig:v,viewBtnActionConfig:T,monitoringLayoutConfig:E}}),define("device/common/config/device-config",["device/common/config/base-config","device/common/device-constants","device/common/device-util","device/common/device-template","device/common/device-api"],function(i,e,t,a,n){function c(e,t){return t.key=e,$.extend(!0,{},i.deviceTabConfig,t)}var u=window.I18N,p=window.Util,g=window.MENU_TABS_ENABLED?window.MENU_TABS_ENABLED:{},f=window.GlobalSettings,r=f.getTemperature().unit,o=$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:300,format:""},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:300,format:""},{field:"detail",title:u.prop("COMMON_BTN_DETAIL"),width:80,sortable:!1,template:a.detailIconTemplateById}]}}),l=$.extend(!0,{},i.dropDownListConfig,{id:"device-mode-filter",name:"mode",options:{optionLabel:u.prop("FACILITY_DEVICE_ALL_MODE"),dataSource:[{text:u.prop("FACILITY_INDOOR_MODE_AUTO"),value:1},{text:u.prop("FACILITY_INDOOR_MODE_COOL"),value:2},{text:u.prop("FACILITY_INDOOR_MODE_HEAT"),value:3},{text:u.prop("FACILITY_INDOOR_MODE_DRY"),value:4},{text:u.prop("FACILITY_INDOOR_MODE_FAN"),value:5},{text:u.prop("FACILITY_INDOOR_MODE_COOLST"),value:6},{text:u.prop("FACILITY_INDOOR_MODE_HOTWATER"),value:7},{text:u.prop("FACILITY_INDOOR_MODE_AUTO")+" ("+u.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")",value:8},{text:u.prop("FACILITY_INDOOR_MODE_HEATEX"),value:9},{text:u.prop("FACILITY_INDOOR_MODE_BYPASS"),value:10},{text:u.prop("FACILITY_INDOOR_MODE_SLEEP"),value:11},{text:u.prop("FACILITY_INDOOR_MODE_ECO"),value:12},{text:u.prop("FACILITY_INDOOR_MODE_STANDARD"),value:13},{text:u.prop("FACILITY_INDOOR_MODE_POWER"),value:14},{text:u.prop("FACILITY_INDOOR_MODE_FORCE"),value:15}]}}),s=$.extend(!0,{},i.dropDownListConfig,{liClassName:"indoor-type-filter-wrapper",options:{optionLabel:u.prop("FACILITY_DEVICE_ALL_INDOOR_TYPE"),dataSource:[{text:"Cassette/Duct",value:0},{text:"AHU",value:1},{text:"DVM Chiller",value:2},{text:"EHS",value:3},{text:"ERV",value:4},{text:"ERV Plus",value:5},{text:"FCU",value:6},{text:"Fresh Duct",value:7}]}}),d=$.extend(!0,{},i.dropDownListConfig,{options:{optionLabel:u.prop("FACILITY_DEVICE_ALL_ENERGY_METER_TYPE"),dataSource:[{text:u.prop("FACILITY_DEVICE_TYPE_WATT_HOUR_METER"),value:0},{text:u.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_GAS_METER"),value:1},{text:u.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATER_METER"),value:2}]}}),m=$.extend(!0,{},i.dropDownListConfig,{options:{optionLabel:u.prop("FACILITY_DEVICE_ALL_IO_TYPE"),selectAllText:u.prop("FACILITY_DEVICE_ALL_STATUS"),dataSource:[{text:"AI",value:0},{text:"AO",value:1},{text:"DI",value:2},{text:"DO",value:3}]}}),v=$.extend(!0,{},i.dropDownListConfig,{options:{optionLabel:u.prop("FACILITY_DEVICE_ALL_POSITION_TYPE"),dataSource:[{text:u.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED"),value:0},{text:u.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE"),value:1}]}}),T=$.extend(!0,{},i.dropDownListConfig,{options:{optionLabel:u.prop("FACILITY_DEVICE_ALL_TEMP_HUMI"),dataSource:[{text:u.prop("FACILITY_DEVICE_TYPE_TEMP_AND_HUMIDITY_SENSOR"),value:0},{text:u.prop("FACILITY_DEVICE_TEMP_HUM_TYPE_HUMIDITY_SENSOR"),value:1},{text:u.prop("FACILITY_DEVICE_TEMP_HUM_TYPE_TEMP_SENSOR"),value:2}]}}),I={lightPanel:{lightingText:u.prop("FACILITY_DEVICE_TYPE_LIGHT"),brightnessText:u.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS")+" (0 ~ 100 %)",noSelectedText:u.prop("FACILITY_NO_SELECTED_LIGHT"),noSelected:!1,power:{invisible:!0,mixed:!1,active:!1,click:function(){}},dimmingLevel:{invisible:!0,value:0,slide:function(){}}}},E={All:{name:u.prop("COMMON_ALL"),routeUrl:"/allView",viewModel:{filters:[i.baseStatusFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.legendTemplate)],hideSearch:!0},innerLayout:[{dataLayout:{map:i.mapViewConfig}}]},"AirConditioner.Indoor":{name:u.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR"),routeUrl:"/sacIndoor",viewModel:{hideIndoorLegend:!1,filters:[s,i.statusFilterConfig,l,i.zoneFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.indoorLegendTemplate)]},innerLayout:[{dataLayout:{statistic:$.extend(!0,{},i.statisticViewConfig,{widgetOptions:{dataBound:a.getStatisticRow,columns:[{field:"name",title:u.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR"),width:80},{field:"numberOfRegisteredDevices",title:u.prop("FACILITY_DEVICE_REGISTERED"),width:80,sortable:!1},{title:u.prop("FACILITY_DEVICE_SAC_INDOOR_ON_INDOOR_VENTILATOR_DHW"),width:170,sortable:!1,template:a.statisticNumberOfOnIndoorDevices},{title:u.prop("FACILITY_DEVICE_SAC_INDOOR_OFF_INDOOR_VENTILATOR_DHW"),width:170,sortable:!1,template:a.statisticNumberOfOffIndoorDevices},{field:"numberOfCriticalDevices",title:u.prop("FACILITY_DEVICE_STATUS_CRITICAL"),width:80,sortable:!1,template:a.statisticNumberOfCritical},{field:"numberOfWarningDevices",title:u.prop("FACILITY_DEVICE_STATUS_WARNING"),width:80,sortable:!1,template:a.statisticNumberOfWarning},{field:"numberOfSchedules",title:u.prop("FACILITY_DEVICE_SAC_INDOOR_SCHEDULE"),width:80,sortable:!1}]}}),map:i.mapViewConfig,list:$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:100},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:100},{title:u.prop("COMMON_STATUS"),width:80,sortable:!1,template:a.getStatusTemplate},{title:u.prop("FACILITY_DEVICE_SAC_INDOOR_MODE"),width:70,template:t.getIndoorMode},{title:u.prop("FACILITY_DEVICE_SAC_INDDOR_TEMPERATURE_SET_CURRENT"),width:150,sortable:!1,template:a.indoorTemperatureListTemplate},{field:"locations",title:u.prop("COMMON_LOCATION"),width:100,template:t.getLocation,sortable:!1},{title:u.prop("COMMON_MENU_FACILITY_GROUP"),width:100,template:t.getGroup},{title:u.prop("COMMON_MENU_FACILITY_SCHEDULE"),width:110,template:t.getHasSchedule},{title:u.prop("COMMON_BTN_DETAIL"),width:80,sortable:!1,template:a.detailIconTemplateById}]}}),grid:$.extend(!0,{},i.gridViewConfig,{widgetOptions:{cardTemplate:a.indoorCardTemplate}})}},{dataLayout:{list:o}}]},AirConditionerOutdoor:{name:u.prop("FACILITY_DEVICE_TYPE_SAC_OUTDOOR"),routeUrl:"/sacOutdoor",viewModel:{filters:[i.selectAllButtonConfig]},innerLayout:[{dataLayout:{list:{widgetOptions:{columnDropDownList:!0,columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:"10%",format:""},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:"10%",format:""},{field:"electricCurrentControl",title:u.prop("FACILITY_DEVICE_SAC_OUTDOOR_CURRENT_LIMIT"),width:"25%",sortable:!1,template:a.outdoorCurrentLimitTemplate,dropDownOptions:{dataValueField:"value",dataTextField:"text",dataSource:e.outdoorControlConfig.electricCurrentControl,change:n.patchOutdoorCurrentLimit}},{field:"heatingCapacityCalibration",title:u.prop("FACILITY_DEVICE_SAC_OUTDOOR_HEATING_CAPACITY_CALIBRATION"),width:"25%",sortable:!1,template:a.outdoorHeatingCapacityCalibrationTemplate,dropDownOptions:{dataValueField:"value",dataTextField:"text",dataSource:e.outdoorControlConfig.heatingCapacityCalibration,change:n.patchOutdoorHeatingCapacityCalibration}},{field:"coolingCapacityCalibration",title:u.prop("FACILITY_DEVICE_SAC_OUTDOOR_COOLING_CAPACITY_CALIBRATION"),width:"25%",sortable:!1,template:a.outdoorCoolingCapacityCalibrationTemplate,dropDownOptions:{dataValueField:"value",dataTextField:"text",dataSource:e.outdoorControlConfig.coolingCapacityCalibration[r],change:n.patchOutdoorCoolingCapacityCalibration}},{title:u.prop("COMMON_BTN_DETAIL"),width:"5%",sortable:!1,template:a.detailIconTemplateById}]}}}},{dataLayout:{list:o,map:$.extend(!0,{},i.mapViewConfig,{widgetOptions:{hasLegendControl:!1}})}}]},ControlPoint:{name:u.prop("FACILITY_DEVICE_TYPE_POINT"),routeUrl:"/controlPoint",viewModel:{filters:[m,i.baseStatusFilterConfig,i.zoneFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.pointLegendTemplate)]},innerLayout:[{dataLayout:{list:$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"type",title:u.prop("FACILITY_POINT_INPUT_OUTPUT_TYPE"),width:"10%",template:a.pointTypeTemplate},{field:"tagName",title:u.prop("FACILITY_POINT_TAG_NAME"),width:70,sortable:{compare:t.sortablePointTagName},template:t.getPointTagName},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:"10%"},{field:"status",title:u.prop("COMMON_STATUS"),sortable:!1,width:80,template:a.getStatusTemplate},{field:"locations",title:u.prop("COMMON_LOCATION"),width:100,template:t.getLocation,sortable:!1},{title:u.prop("FACILITY_GROUP_GROUP"),width:100,template:t.getGroup},{field:"value",title:u.prop("FACILITY_POINT_VALUE"),width:110,sortable:{compare:t.sortablePointValue},template:a.pointValueTemplate},{title:u.prop("COMMON_BTN_DETAIL"),width:"5%",sortable:!1,template:a.detailIconTemplateById}],dataBound:function(e){function s(e){var t=$("<div/>").kendoCommonDialog({isCustomActions:!0,actions:[{text:u.prop("COMMON_BTN_OK"),action:function(e){e.sender.close(),e.sender.destroy(),e.sender.element.remove()}}]}).data("kendoCommonDialog");t.message(e),t.open()}function d(e){var t,i=$(this),a=i.val(),n=i.data("kendoNumericTextBox"),r=/^[0-9]+$/;"aoav"==n.pointType&&(r=/^[0-9.]+$/),""==a||a.match(r)||null!=(t=i.data("beforeValue"))&&(t=Number(t),i.val(t),s(u.prop("COMMON_INVALID_CHARACTER")));var o=n.min(),l=n.max();a=Number(a),o=Number(o),l=Number(l),(a<o||l<a)&&(t=i.data("beforeValue"),n.value(t),s(u.prop("COMMON_INVALID_MIN_MAX",o,l)))}function c(e){var t=$(this);if(""==t.val()){var i=t.data("beforeValue");t.val(i)}}var p=e.sender.dataSource;$(e.sender.element).find(".device-point-numeric").each(function(){var e,t,i,a=$(this),n=a.data("type"),r=a.closest("tr").data("uid"),o=p.getByUid(r);if("dodv"==n?(t=0,i=1,o&&o.controlPoint&&(o.controlPoint.minimumValue&&(t=o.controlPoint.minimumValue),o.controlPoint.maximumValue&&(i=o.controlPoint.maximumValue)),(e=a.kendoNumericTextBox({format:"n0",min:t,max:i,round:!1,spinners:!1}).data("kendoNumericTextBox")).pointType=n):(t=0,i=100,o&&o.controlPoint&&(o.controlPoint.minimumValue&&(t=o.controlPoint.minimumValue),o.controlPoint.maximumValue&&(i=o.controlPoint.maximumValue)),(e=a.kendoNumericTextBox({format:"n1",min:t,max:i,round:!1,spinners:!1,decimals:2}).data("kendoNumericTextBox")).pointType=n),e){var l=e.element.val();e.element.data("beforeValue",l),e.element.bind("keyup",d),e.element.bind("change",c)}})}}})}},{dataLayout:{list:o}}]},Meter:{name:u.prop("FACILITY_DEVICE_TYPE_ENERGY_METER"),routeUrl:"/energyMeter",viewModel:{filters:[d,i.baseStatusFilterConfig,i.zoneFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.baseLegendTemplate)]},innerLayout:[{dataLayout:{statistic:$.extend(!0,{},i.statisticViewConfig,{widgetOptions:{dataBound:a.getStatisticRow,columns:[{field:"name",title:u.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR"),width:80},{field:"numberOfRegisteredDevices",title:u.prop("FACILITY_DEVICE_REGISTERED"),width:80,sortable:!1,template:a.statisticNumberOfRegisteredDevice},{title:u.prop("FACILITY_DEVICE_STATUS_NORMAL"),width:170,sortable:!1,template:a.statisticNumberOfNormalDevices},{field:"numberOfCriticalDevices",title:u.prop("FACILITY_DEVICE_STATUS_CRITICAL"),width:170,sortable:!1,template:a.statisticNumberOfCritical},{field:"numberOfWarningDevices",title:u.prop("FACILITY_DEVICE_STATUS_WARNING"),width:170,sortable:!1,template:a.statisticNumberOfWarning}]}}),map:i.mapViewConfig,list:$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:"10%"},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:"10%"},{field:"status",title:u.prop("FACILITY_DEVICE_ENERGY_METER_STATUS"),width:80,sortable:!1,template:a.getStatusTemplate},{field:"locations",title:u.prop("COMMON_LOCATION"),width:80,sortable:!1,template:t.getLocation},{field:"group",title:u.prop("FACILITY_GROUP_GROUP"),width:80,sortable:!1,template:t.getGroup},{field:"type",title:u.prop("FACILITY_DEVICE_ENERGY_METER_TYPE"),width:80,template:t.getMeterType,sortable:{compare:t.sortableMeterType}},{field:"consumptionCategory",title:u.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY"),width:80,template:t.getMeterCategoryType,sortable:{compare:t.sortableMeterCategoryType}},{field:"currentConsumption",title:u.prop("FACILITY_DEVICE_ENERGY_METER_CURRENT_CONSUMPTION"),width:80,sortable:!1,template:t.getMeterCurrentConsumptionUnit},{title:u.prop("COMMON_BTN_DETAIL"),width:"5%",sortable:!1,template:a.detailIconTemplateById}]}}),grid:$.extend(!0,{},i.gridViewConfig,{widgetOptions:{cardTemplate:a.getDeviceCardTemplate}})}},{dataLayout:{list:o}}]},Light:{name:u.prop("FACILITY_DEVICE_TYPE_LIGHT"),routeUrl:"/light",viewModel:$.extend(!0,{},I,{filters:[i.statusFilterConfig,i.zoneFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.legendTemplate)]}),innerLayout:[{dataLayout:{statistic:$.extend(!0,{},i.statisticViewConfig,{widgetOptions:{dataBound:a.getStatisticRow,columns:[{field:"name",title:u.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR"),width:80},{field:"numberOfRegisteredDevices",title:u.prop("FACILITY_DEVICE_REGISTERED"),width:80,sortable:!1,template:a.statisticNumberOfRegisteredDevice},{title:u.prop("FACILITY_DEVICE_STATUS_NORMAL_ON"),width:170,sortable:!1,template:a.statisticNumberOfOnDevices},{title:u.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF"),width:170,sortable:!1,template:a.statisticNumberOfOffDevices},{field:"numberOfCriticalDevices",title:u.prop("FACILITY_DEVICE_STATUS_CRITICAL"),width:80,sortable:!1,template:a.statisticNumberOfCritical},{field:"numberOfWarningDevices",title:u.prop("FACILITY_DEVICE_STATUS_WARNING"),width:80,sortable:!1,template:a.statisticNumberOfWarning}]}}),map:i.mapViewConfig,list:$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:"10%"},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:"10%"},{field:"status",title:u.prop("FACILITY_DEVICE_ENERGY_METER_STATUS"),width:80,sortable:!1,template:a.getStatusTemplate},{field:"locations",title:u.prop("COMMON_LOCATION"),width:100,sortable:!1,template:t.getLocation},{field:"group",title:u.prop("FACILITY_GROUP_GROUP"),width:80,sortable:!1,template:t.getGroup},{field:"dimmingLevel",title:u.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS"),width:80,sortable:!1,template:t.getDimmingLevel},{field:"schedules",title:u.prop("COMMON_MENU_FACILITY_SCHEDULE"),sortable:!1,width:80,template:t.getHasSchedule},{title:u.prop("COMMON_BTN_DETAIL"),width:"5%",sortable:!1,template:a.detailIconTemplateById}]}}),grid:$.extend(!0,{},i.gridViewConfig,{widgetOptions:{cardTemplate:a.getDeviceCardTemplate}})}},{dataLayout:{list:o}}]},"Sensor.Motion":{name:u.prop("FACILITY_DEVICE_TYPE_MOTION_SENSOR"),routeUrl:"/motion",viewModel:{filters:[i.baseStatusFilterConfig,i.zoneFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.baseLegendTemplate)]},innerLayout:[{dataLayout:{statistic:$.extend(!0,{},i.statisticViewConfig,{widgetOptions:{dataBound:a.getStatisticRow,columns:[{field:"name",title:u.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR"),width:80},{field:"numberOfRegisteredDevices",title:u.prop("FACILITY_DEVICE_REGISTERED"),width:80,sortable:!1,template:a.statisticNumberOfRegisteredDevice},{title:u.prop("FACILITY_DEVICE_STATUS_NORMAL"),width:170,sortable:!1,template:a.statisticNumberOfNormalDevices},{field:"numberOfCriticalDevices",title:u.prop("FACILITY_DEVICE_STATUS_CRITICAL"),width:170,sortable:!1,template:a.statisticNumberOfCritical},{field:"numberOfWarningDevices",title:u.prop("FACILITY_DEVICE_STATUS_WARNING"),width:170,sortable:!1,template:a.statisticNumberOfWarning}]}}),map:i.mapViewConfig,list:$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:"10%"},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:"10%"},{field:"status",title:u.prop("FACILITY_DEVICE_ENERGY_METER_STATUS"),width:80,sortable:!1,template:a.getStatusTemplate},{field:"locations",title:u.prop("COMMON_LOCATION"),width:100,sortable:!1,template:t.getLocation},{field:"group",title:u.prop("FACILITY_GROUP_GROUP"),width:80,sortable:!1,template:t.getGroup},{field:"presences",title:u.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE"),width:80,sortable:!1,template:t.getMotionPresence},{title:u.prop("COMMON_BTN_DETAIL"),width:"5%",sortable:!1,template:a.detailIconTemplateById}]}}),grid:$.extend(!0,{},i.gridViewConfig,{widgetOptions:{cardTemplate:a.getDeviceCardTemplate}})}},{dataLayout:{list:o}}]},"Sensor.Temperature_Humidity":{name:u.prop("FACILITY_DEVICE_TYPE_TEMP_AND_HUMIDITY_SENSOR"),routeUrl:"/temperatureHumidty",viewModel:{filters:[T,i.baseStatusFilterConfig,i.zoneFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.baseLegendTemplate)]},innerLayout:[{dataLayout:{statistic:$.extend(!0,{},i.statisticViewConfig,{widgetOptions:{dataBound:a.getStatisticRow,columns:[{field:"name",title:u.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR"),width:80},{field:"numberOfRegisteredDevices",title:u.prop("FACILITY_DEVICE_REGISTERED"),width:80,sortable:!1,template:a.statisticNumberOfRegisteredDevice},{title:u.prop("FACILITY_DEVICE_STATUS_NORMAL"),width:170,sortable:!1,template:a.statisticNumberOfNormalDevices},{field:"numberOfCriticalDevices",title:u.prop("FACILITY_DEVICE_STATUS_CRITICAL"),width:170,sortable:!1,template:a.statisticNumberOfCritical},{field:"numberOfWarningDevices",title:u.prop("FACILITY_DEVICE_STATUS_WARNING"),width:170,sortable:!1,template:a.statisticNumberOfWarning}]}}),map:i.mapViewConfig,list:$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:"10%"},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:"10%"},{field:"status",title:u.prop("FACILITY_DEVICE_ENERGY_METER_STATUS"),width:80,sortable:!1,template:a.getStatusTemplate},{field:"locations",title:u.prop("COMMON_LOCATION"),width:100,sortable:!1,template:t.getLocation},{field:"group",title:u.prop("FACILITY_GROUP_GROUP"),width:80,sortable:!1,template:t.getGroup},{field:"temperatures",title:u.prop("FACILITY_DEVICE_TEMP_HUMI_CURRENT_TEMPERATURE"),width:80,sortable:!1,template:t.getTempHumiTemperature},{field:"humidities",title:u.prop("FACILITY_DEVICE_TEMP_HUMI_CURRENT_HUMIDITY"),sortable:!1,width:80,template:t.getTempHumiHumidity},{field:"weatherStation",title:u.prop("FACILITY_DEVICE_TEMP_HUM_WEATHER_STATION"),sortable:!1,width:80,template:t.getTempWeatherStationOx},{title:u.prop("COMMON_BTN_DETAIL"),width:"5%",sortable:!1,template:a.detailIconTemplateById}]}}),grid:$.extend(!0,{},i.gridViewConfig,{widgetOptions:{cardTemplate:a.getDeviceCardTemplate}})}},{dataLayout:{list:o}}]},Gateway:{name:u.prop("FACILITY_DEVICE_TYPE_IOT_GATEWAY"),routeUrl:"/gateway",viewModel:{filters:[i.baseStatusFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.baseLegendTemplate)],actions:[i.selectedTextActionConfig,i.deleteBtnActionConfig,i.registerBtnActionConfig,i.detailBtnActionConfig]},innerLayout:[{dataLayout:{statistic:$.extend(!0,{},i.statisticViewConfig,{widgetOptions:{dataBound:a.getStatisticRow,columns:[{field:"name",title:u.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR"),width:80},{field:"numberOfRegisteredDevices",title:u.prop("FACILITY_DEVICE_REGISTERED"),width:80,sortable:!1,template:a.statisticNumberOfRegisteredDevice},{title:u.prop("FACILITY_DEVICE_STATUS_NORMAL"),width:170,sortable:!1,template:a.statisticNumberOfNormalDevices},{field:"numberOfCriticalDevices",title:u.prop("FACILITY_DEVICE_STATUS_CRITICAL"),width:170,sortable:!1,template:a.statisticNumberOfCritical},{field:"numberOfWarningDevices",title:u.prop("FACILITY_DEVICE_STATUS_WARNING"),width:170,sortable:!1,template:a.statisticNumberOfWarning}]}}),map:i.mapViewConfig,list:$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:152},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:141},{field:"status",title:u.prop("FACILITY_DEVICE_ENERGY_METER_STATUS"),sortable:!1,template:a.getStatusTemplate,width:64},{field:"locations",title:u.prop("COMMON_LOCATION"),template:t.getLocation,width:106,sortable:{compare:t.sortableLocation}},{field:"group",title:u.prop("FACILITY_GROUP_GROUP"),template:t.getGroup,width:96,sortable:{compare:t.sortableGroup}},{field:"macAddress",title:u.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:t.getMacAddress,width:141,sortable:{compare:t.sortableMacAddress}},{field:"ipAddress",title:u.prop("FACILITY_DEVICE_NETWORK_IP_ADDRESS"),template:t.getIpAddress,width:126,sortable:{compare:t.ipAddress}},{field:"zigbee",title:u.prop("FACILITY_DEVICE_GATEWAY_ZIGBEE"),width:50,sortable:!1,template:a.gatewayZigbeeTemplate},{field:"ble",title:u.prop("FACILITY_DEVICE_GATEWAY_BLE"),sortable:!1,width:50,template:a.gatewayListBleTemplate},{field:"bleInterface",title:u.prop("FACILITY_DEVICE_GATEWAY_BEACON")+"#1 #2 #3",sortable:!1,width:150,template:a.gatewayListBleInterfaceTemplate},{field:"schedules",title:u.prop("COMMON_MENU_FACILITY_SCHEDULE"),width:114,template:t.getHasSchedule,sortable:{compare:t.sortableHasSchedule}},{field:"rules",title:u.prop("COMMON_MENU_FACILITY_RULE"),width:74,template:t.getHasRule,sortable:{compare:t.sortableHasRule}},{field:"description",title:u.prop("COMMON_DESCRIPTION"),sortable:!1,width:150,template:t.getDescription},{title:u.prop("COMMON_BTN_DETAIL"),width:70,sortable:!1,template:a.detailIconTemplateById}]}}),grid:$.extend(!0,{},i.gridViewConfig,{widgetOptions:{cardTemplate:a.getDeviceCardTemplate}})}},{dataLayout:{list:o}}]},Beacon:{name:u.prop("FACILITY_DEVICE_TYPE_BLE_BEACON"),routeUrl:"/beacon",viewModel:{filters:[v,i.baseStatusFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.baseLegendTemplate)],actions:[i.selectedTextActionConfig,i.deleteBtnActionConfig,i.registerBtnActionConfig,i.detailBtnActionConfig]},innerLayout:[{dataLayout:{statistic:$.extend(!0,{},i.statisticViewConfig,{widgetOptions:{dataBound:a.getStatisticRowBeacon,columns:[{field:"name",title:u.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR"),width:80},{field:"numberOfRegisteredDevices",title:u.prop("FACILITY_DEVICE_REGISTERED"),width:80,sortable:!1,template:a.statisticNumberOfRegisteredDevice},{title:u.prop("FACILITY_DEVICE_BEACON_POSITION_TYPE"),width:286,sortable:!1,template:a.statisticBeaconPositionType},{title:u.prop("FACILITY_DEVICE_STATUS_NORMAL"),width:170,sortable:!1,template:a.statisticBeaconNormal},{field:"numberOfCriticalDevices",title:u.prop("FACILITY_DEVICE_STATUS_CRITICAL"),width:170,sortable:!1,template:a.statisticBeaconDisconnected},{field:"numberOfWarningDevices",title:u.prop("FACILITY_DEVICE_STATUS_WARNING"),width:170,sortable:!1,template:a.statisticBeaconWrongLocation}]}}),map:$.extend(!0,{},i.mapViewConfig,{showRegisteredGateway:!0}),list:$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:160},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:145},{field:"status",title:u.prop("FACILITY_DEVICE_ENERGY_METER_STATUS"),width:60,sortable:!1,template:a.getStatusTemplate},{field:"locations",title:u.prop("COMMON_LOCATION"),template:t.getLocation,width:180,sortable:{compare:t.sortableLocation}},{field:"group",title:u.prop("FACILITY_GROUP_GROUP"),template:t.getGroup,width:80,sortable:{compare:t.sortableGroup}},{field:"macAddress",title:u.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:a.bleMacAddressTemplate,width:150,sortable:{compare:t.sortableBleMacAddress}},{field:"uuid",title:"UUID",width:135,template:a.bleUUIDTemplate,sortable:{compare:t.sortableBeaconUUID}},{field:"major",title:"Major",sortable:!1,width:75,template:t.getBleMajor},{field:"minor",title:"Minor",sortable:!1,width:75,template:t.getBleMinor},{field:"txPower",title:"Tx Power",sortable:!1,width:90,template:t.getBleTxPower},{field:"schedules",title:u.prop("COMMON_MENU_FACILITY_SCHEDULE"),width:100,template:t.getHasSchedule,sortable:{compare:t.sortableHasSchedule}},{field:"rules",title:u.prop("COMMON_MENU_FACILITY_RULE"),width:80,template:t.getHasRule,sortable:{compare:t.sortableHasRule}},{field:"description",title:u.prop("COMMON_DESCRIPTION"),sortable:!1,width:120,template:t.getDescription},{title:u.prop("COMMON_BTN_DETAIL"),width:70,sortable:!1,template:a.detailIconTemplateById}]}}),grid:$.extend(!0,{},i.gridViewConfig,{widgetOptions:{cardTemplate:a.getDeviceCardTemplate}})}},{dataLayout:{list:o}}]},CCTV:{name:u.prop("FACILITY_DEVICE_TYPE_CCTV"),routeUrl:"/cctv",viewModel:{filters:[i.baseStatusFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.baseLegendTemplate)],actions:[i.selectedTextActionConfig,i.deleteBtnActionConfig,i.registerBtnActionConfig,i.detailBtnActionConfig,i.viewBtnActionConfig]},innerLayout:[{dataLayout:{statistic:$.extend(!0,{},i.statisticViewConfig,{widgetOptions:{dataBound:a.getStatisticRow,columns:[{field:"name",title:u.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR"),width:80},{field:"numberOfRegisteredDevices",title:u.prop("FACILITY_DEVICE_REGISTERED"),template:a.statisticNumberOfRegsiteredDevices,width:80},{title:u.prop("FACILITY_DEVICE_STATUS_NORMAL"),width:170,sortable:!1,template:a.statisticNumberOfNormalDevices},{field:"numberOfCriticalDevices",title:u.prop("FACILITY_DEVICE_STATUS_CRITICAL"),width:170,sortable:!1,template:a.statisticNumberOfCritical},{field:"numberOfWarningDevices",title:u.prop("FACILITY_DEVICE_STATUS_WARNING"),width:170,sortable:!1,template:a.statisticNumberOfWarning}]}}),map:$.extend(!0,{},i.mapViewConfig,{showRegisteredGateway:!0}),list:$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:160},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:145},{field:"status",title:u.prop("FACILITY_DEVICE_ENERGY_METER_STATUS"),width:60,sortable:!1,template:a.getStatusTemplate},{field:"locations",title:u.prop("COMMON_LOCATION"),width:175,template:t.getLocation,sortable:{compare:t.sortableLocation}},{field:"group",title:u.prop("FACILITY_GROUP_GROUP"),width:80,template:t.getGroup,sortable:{compare:t.sortableGroup}},{field:"macAddress",title:u.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),width:156,template:t.getMacAddress,sortable:{compare:t.sortableMacAddress}},{field:"ipAddress",title:u.prop("FACILITY_DEVICE_NETWORK_IP_ADDRESS"),width:152,template:t.getIpAddress,sortable:{compare:t.sortableIpAddress}},{field:"wifiStatus",title:u.prop("FACILITY_DEVICE_NETWORK_WIFI_STATUS"),width:151,template:t.getCCTVWifiStatus,sortable:{compare:t.sortableCCTVWifiStatus}},{field:"schedules",title:u.prop("COMMON_MENU_FACILITY_SCHEDULE"),width:100,template:t.getHasSchedule,sortable:{compare:t.sortableHasSchedule}},{field:"rules",title:u.prop("COMMON_MENU_FACILITY_RULE"),width:80,template:t.getHasRule,sortable:{compare:t.sortableHasRule}},{field:"description",title:u.prop("COMMON_DESCRIPTION"),sortable:!1,width:150,template:t.getDescription},{title:u.prop("COMMON_BTN_DETAIL"),width:70,sortable:!1,template:a.detailIconTemplateById}]}}),grid:$.extend(!0,{},i.gridViewConfig,{widgetOptions:{cardTemplate:a.getDeviceCardTemplate}})}},{dataLayout:{list:o}}]},SmartPlug:{name:u.prop("FACILITY_DEVICE_TYPE_SMART_PLUG"),routeUrl:"/smart-plug",viewModel:{filters:[i.statusFilterConfig,i.selectAllButtonConfig,i.legendTemplate(a.legendTemplate)]},innerLayout:[{dataLayout:{statistic:$.extend(!0,{},i.statisticViewConfig,{widgetOptions:{dataBound:a.getStatisticRow,columns:[{field:"name",title:u.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR"),width:80},{field:"numberOfRegisteredDevices",title:u.prop("FACILITY_DEVICE_REGISTERED"),width:80,sortable:!1,template:a.statisticNumberOfRegisteredDevice},{title:u.prop("FACILITY_DEVICE_STATUS_NORMAL_ON"),width:125,sortable:!1,template:a.statisticNumberOfOnDevices},{title:u.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF"),width:125,sortable:!1,template:a.statisticNumberOfOffDevices},{field:"numberOfCriticalDevices",title:u.prop("FACILITY_DEVICE_STATUS_CRITICAL"),width:125,sortable:!1,template:a.statisticNumberOfCritical},{field:"numberOfWarningDevices",title:u.prop("FACILITY_DEVICE_STATUS_WARNING"),width:125,sortable:!1,template:a.statisticNumberOfWarning}]}}),map:$.extend(!0,{},i.mapViewConfig,{showRegisteredGateway:!0}),list:$.extend(!0,{},i.listViewConfig,{widgetOptions:{columns:[{field:"id",title:u.prop("FACILITY_DEVICE_DEVICE_ID"),width:"10%"},{field:"name",title:u.prop("FACILITY_DEVICE_DEVICE_NAME"),width:"10%"},{field:"status",title:u.prop("FACILITY_DEVICE_ENERGY_METER_STATUS"),width:80,sortable:!1,template:a.getStatusTemplate},{field:"locations",title:u.prop("COMMON_LOCATION"),width:100,sortable:!1,template:t.getLocation},{field:"group",title:u.prop("FACILITY_GROUP_GROUP"),width:80,sortable:!1,template:t.getGroup},{field:"schedules",title:u.prop("COMMON_MENU_FACILITY_SCHEDULE"),sortable:!1,width:80,template:t.getHasSchedule},{title:u.prop("COMMON_BTN_DETAIL"),width:"5%",sortable:!1,template:a.detailIconTemplateById}]}}),grid:$.extend(!0,{},i.gridViewConfig,{widgetOptions:{cardTemplate:a.getDeviceCardTemplate}})}},{dataLayout:{list:o}}]}};return{getTabConfig:function(e){var t=E[e];return t?(t.key=e,t):(console.error("There is no configuration for type : "+e),null)},getTabConfigList:function(e,t,i){var a,n,r,o=f.getDeviceTypeOrdering(),l=o.length,s=0,d=[];for(e&&!0===g.All&&(d.push(c("All",E.All)),d[0].innerLayout.splice(1,1),s++),r=0;r<l;r++)if(a=o[r],n=E[a]){if(!1===g[a])continue;if(!p.isInstalledType(a,!0))continue;n=c(a,n),i&&"AirConditionerOutdoor"!=a&&n.viewModel.filters.splice(-1,1),d.push(c(a,n)),t&&d[s].innerLayout.splice(1,1),i&&d[s].innerLayout.splice(0,1),s++}if(Object.keys(E).length!=o.length)for(a in E)-1==o.indexOf(a)&&g[a]&&p.isInstalledType(a,!0)&&(n=E[a])&&d.push(c(a,n));return d},meterTypeFilterConfig:d,controlPointTypeFilterConfig:m,positionTypeFilterConfig:v,tempHumiTypeFilterConfig:T}}),define("device/common/controller/base-controller",["device/common/device-api","device/common/device-util","device/common/device-constants","device/common/config/popup-config","device/common/device-template"],function(u,g,m,a,i){var f=window.kendo,v=window.MAIN_WINDOW,t=window.CommonLoadingPanel,T=a.messageDialog,d=a.confirmDialog,I=window.I18N;return f.Class.extend({init:function(e){this._createDataSource(),this.loadingPanel=new t,this.deviceTabPanel=e.sender,this.element=e.contentElement,this.tabIndex=e.selectedIdx,this.tabLayout=e.tabLayout,this.deviceTypeKey=this.tabLayout.key,this.innerLayouts=e.innerLayouts,this.viewModel=e.viewModel,this.nameFilter=[],this.typeFilter=[],this.statusFilter=[],this.zoneFilter=[],this.modeFilter=[],this.controlPanelElement=this.element.find(".device-control-panel"),this.registrationMapListElement=this.element.find(".device-registration-map-panel"),this.monitoringMapListElement=this.element.find(".device-monitoring-map-panel"),v.disableBuidingTotal(!1),v.disableFloorAllBtn(!1),this.initComponent(),this.attachEvent()},_createDataSource:function(){self.zoneDataSource=new f.data.DataSource({data:[]})},initComponent:function(){var e=this.getLayoutViewModel("registration");e&&(this.registrationMapView=e.dataViews.map);var t=this.deviceTypeKey;this.detailPopup=a.getDetailPopup(t);var i=this.getRegisterMapListOptions();this.registrationMapList=this.registrationMapListElement.kendoDeviceTabGroupGrid(i).data("kendoDeviceTabGroupGrid"),(i=this.getMonitoringMapListOptions())&&(this.monitoringMapList=this.monitoringMapListElement.kendoDeviceTabGroupGrid(i).data("kendoDeviceTabGroupGrid")),this.innerLayouts.length<2&&this.element.find(".device-panel-layout-buttons").hide()},attachEvent:function(){var e=this;e.deviceTabPanel.bind("changeInnerLayout",e.onChangeInnerLayout.bind(e)),e.deviceTabPanel.bind("changeDataLayout",e.onChangeDataLayout.bind(e)),e.registrationMapList&&(e.registrationMapListElement.on("click",".map-panel-list-container .k-grid-content.no-header .device-map-panel-list-item",e.initListDragDropEvt.bind(this)),e.registrationMapList.bind("expand",e.expandRegistrationMapListTab.bind(e)),e.registrationMapList.bind("change",e.onRegistrationMapListChangeSelection.bind(e))),e.registrationMapView&&e.registrationMapView.widget.bind("dragend",e.dragEndDeviceEvt.bind(e));var t=e.getFilterViewModel(m.FILTER_NAME.SELECTALL);t&&t.options.set("click",e.clickSelectAllEvt.bind(e));var i=e.getActionViewModel(m.ACTION_NAME.DETAIL);i&&i.options.set("click",e.clickDetailBtnEvt.bind(e)),$(".device-content-wrapper").on("click",".k-widget .ic-info",e.clickDetailIconEvt.bind(e));var a=e.viewModel.registrationStatusButtons;if(a){var n=a[m.REGISTRATION_STATUS_BUTTONS.REGISTER];n&&n.set("click",e.clickRegisterInRegistration.bind(e));var r=a[m.REGISTRATION_STATUS_BUTTONS.UNREGISTER];r&&r.set("click",e.clickUnregisterInRegistration.bind(e))}var o=e.getActionViewModel(m.ACTION_NAME.REGISTER);o&&o.options.set("click",e.clickRegisterBtnEvt.bind(e));var l=e.getActionViewModel(m.ACTION_NAME.DELETE);l&&l.options.set("click",e.clickDeleteBtnEvt.bind(e)),e.detailPopup&&(e.detailPopup.bind("onSaved",e.saveDetailPopupEvt.bind(e)),e.detailPopup.bind("onRegister",e.registerDetailPopupEvt.bind(e)),e.detailPopup.bind("onDeregister",e.deregisterDetailPopupEvt.bind(e))),e.refreshInterval=setInterval(e.intervalRefreshData.bind(e),m.ALL_TIME_INTERVAL),e.attachFilterEvt(),e.viewModel.set("searchKeyDown",e.keydownSearchEvt.bind(e)),e.viewModel.set("searchClick",e.clickSearchEvt.bind(e))},attachFilterEvt:function(){var r=this,e=r.getFilterViewModel(m.FILTER_NAME.ZONE);e&&e.options.set("selectionChanged",function(e){r.zoneFilter=[];var t=e.newValue,i=t.length,a=e.count;if(0===i)r.zoneFilter.push(g.filter1Depth("locations","foundation_space_zones_id",void 0));else if(i!==a&&0!==a)for(var n=0;n<i;n++)r.zoneFilter.push(g.filter1Depth("locations","foundation_space_zones_id",t[n]));r.applyCurrentFilter()})},keydownSearchEvt:function(e){13!=e.keyCode||this.keydownClickSearchTriggerEvt(e)},keydownClickSearchTriggerEvt:function(e){var t=$(e.target).val();this.viewModel.set("searchFieldValue",t),this.clickSearchEvt(e)},clickSearchEvt:function(e){this.viewModel.get("enableSearch")&&this.applyCurrentFilter()},intervalRefreshData:function(){var e=this;e.refreshTimeout&&(clearTimeout(e.refreshTimeout),e.refreshTimeout=null),e.refreshTimeout=setTimeout(e.onRefreshData.bind(e),2*m.TIMEOUT)},onRefreshData:function(){var e=this,t=e.getCurrentViewInfo(),i=t.innerLayoutName,a=t.dataViewWidget;e.isRefreshing||e.detailPopup&&e.detailPopup.isEditable||"monitoring"==i&&(e.loadingPanel.open(a.element),e.refreshDeviceData(!0).always(function(){e.loadingPanel.close()}))},saveDetailPopupEvt:function(e){this.patchInDetailPopupEvt(e,!0)},registerDetailPopupEvt:function(e){var t=this,i=e.sender;d.message(I.prop("FACILITY_DEVICE_REGISTER_CONFIRM")),d.setConfirmActions({yes:function(){t.patchInDetailPopupEvt(e)},no:function(){i.fail()}}),d.open()},deregisterDetailPopupEvt:function(e){var t=this,i=e.sender;d.message(I.prop("FACILITY_DEVICE_DEREGISTER_CONFIRM")),d.setConfirmActions({yes:function(){t.patchInDetailPopupEvt(e)},no:function(){i.fail()}}),d.open()},patchInDetailPopupEvt:function(e,t){var i=this,a=e.hideMessagePopup,n=e.sender,r=e.results?e.results:[e.result];if(r){var o=n.dialogType;i.loadingPanel.open(n.element),i.onPatchInDetailPopupEvt(r),u.patchDevices(r).done(function(){var e;n.success(),i.loadingPanel.close(),"register"==o||"deregister"==o&&!t?(e="register"==o?I.prop("FACILITY_DEVICE_REGISTER_RESULT"):I.prop("FACILITY_DEVICE_DEREGISTER_RESULT"),n.close(),T.message(e),T.open()):(e=I.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED"),T.message(e),a||T.open(n.element)),i.loadingPanel.open(),i.refreshDeviceData(!1).always(function(){i.loadingPanel.close()})}).fail(function(e){n.fail(),i.loadingPanel.close();var t=g.getDeviceRegistrationFailMsg(e);T.message(t),T.open(n.element)})}},onPatchInDetailPopupEvt:function(e){var t,i,a,n=e.length;for(i=0;i<n;i++)(a=(t=e[i]).locations)&&a[0]&&a[0].nameDisplayCoordinate&&(t.nameDisplayCoordinate=a[0].nameDisplayCoordinate,delete a[0].nameDisplayCoordinate)},clickRegisterInRegistration:function(e){var t=this,i=t.viewModel.registrationStatusButtons,a=i[m.REGISTRATION_STATUS_BUTTONS.REGISTER],n=i[m.REGISTRATION_STATUS_BUTTONS.UNREGISTER];a.get("active")||(a.set("active",!0),n.set("active",!1),t.getActionViewModel(m.ACTION_NAME.REGISTER).set("text",m.TEXT.DEREGISTER),t.onInitializeFilter(),t.loadingPanel.open(),t.refreshDeviceData(!1).always(function(){t.loadingPanel.close()}))},clickUnregisterInRegistration:function(e){var t=this,i=t.viewModel.registrationStatusButtons,a=i[m.REGISTRATION_STATUS_BUTTONS.REGISTER],n=i[m.REGISTRATION_STATUS_BUTTONS.UNREGISTER];n.get("active")||(n.set("active",!0),a.set("active",!1),t.getActionViewModel(m.ACTION_NAME.REGISTER).set("text",m.TEXT.REGISTER),t.onInitializeFilter(),t.loadingPanel.open(),t.refreshDeviceData(!1).always(function(){t.loadingPanel.close()}))},clickSelectAllEvt:function(e){var t=this.getFilterViewModel(m.FILTER_NAME.SELECTALL),i=t.get("text");i===m.TEXT.SELECTALL?(t.set("text",m.TEXT.DESELECTALL),this.selectAll()):i==m.TEXT.DESELECTALL&&(t.set("text",m.TEXT.SELECTALL),this.unselectAll())},clickRegisterBtnEvt:function(e){var t,i=this,a=i.getCurrentViewInfo(),n=a.registrationStatus,r=a.dataViewName,o=a.dataViewWidget,l=[],s=!1;if("map"==r&&"NotRegistered"==n)i.registrationMapList&&(l=i.registrationMapList.getSelectedData()),t="register",s=!0;else{if(l=o.getSelectedData(),"Registered"==n)return d.message(I.prop("FACILITY_DEVICE_DEREGISTER_CONFIRM")),d.setConfirmActions({yes:function(){i.loadingPanel.open(),u.patchRegistrationStatus(l,"NotRegistered").always(function(){i.refreshDeviceData(!1).always(function(){i.loadingPanel.close(),T.message(I.prop("FACILITY_DEVICE_DEREGISTER_RESULT")),T.open()})})}}),void d.open();t="register"}i.openDetailPopup(l,t,s)},clickDeleteBtnEvt:function(e){var n=this,t=n.getCurrentViewInfo(),i=t.registrationStatus,a=t.dataViewName,r=t.dataViewWidget,o=[];"map"==a&&"NotRegistered"==i?n.registrationMapList&&0==(o=n.registrationMapList.getSelectedData()).length&&(o=r.getSelectedData()):o=r.getSelectedData(),d.message(I.prop("FACILITY_DEVICE_DELETE_CONFIRM")),d.setConfirmActions({yes:function(){n.loadingPanel.open();var e,t,i=[],a=o.length;for(t=0;t<a;t++)e=o[t],i.push(e.id);u.deleteDevices(i).always(function(){n.refreshDeviceData(!1).always(function(){n.loadingPanel.close(),T.message(I.prop("FACILITY_DEVICE_DELETE_RESULT")),T.open()})})}}),d.open()},clickDetailIconEvt:function(e){var t=$(e.target).data("id");this.openDetailPopup([{id:t}])},clickDetailBtnEvt:function(e){var t,i=this,a=i.getCurrentViewInfo(),n=a.innerLayoutName,r=a.dataViewName,o=a.dataViewWidget,l=[];"registration"==n&&"map"==r&&i.registrationMapList&&i.registrationMapList.selectedIndex==m.REGISTRATION_STATUS_BUTTONS.UNREGISTER?0==(l=i.registrationMapList.getSelectedData()).length&&(l=o.getSelectedData(),t="deregister"):l=o.getSelectedData(),i.openDetailPopup(l,t)},openDetailPopup:function(e,i,a){var t,n,r=this,o=e.length,l=r.getCurrentViewInfo(),s=l.innerLayoutName,d=l.registrationStatus;if(i||"registration"==s&&(i="Registered"==d?"deregister":"register"),o){for(r.loadingPanel.open(),n=[],t=0;t<o;t++)n.push(e[t].id);u.getDeviceWithMultipleID(n).done(function(e){var t=new f.data.DataSource({data:e,pageSize:50});t.read(),r.detailPopup.setDialogType(i),r.detailPopup.setDataSource(t),r.detailPopup.open(i),a&&r.detailPopup.buttons[4].click()}).always(function(){r.loadingPanel.close()})}},onFloorChanged:function(e){var t=this,i=e.floor,a=e.building,n=i.id,r=a.id==v.FLOOR_NAV_BUILDING_TOTAL_ID,o=n==v.FLOOR_NAV_FLOOR_ALL_ID,l=t.getCurrentViewInfo(),s=l.innerLayoutName,d=l.dataViewName;t.viewModel.set("searchFieldValue",""),t.zoneFilter=[],t._getZoneData(n,r,o).always(function(){var e=d;"monitoring"==s?"map"==d&&(r||o)?e="statistic":"statistic"!=d||r||o||(e="map"):"registration"==s&&(e="map"),t.deviceTabPanel.trigger("changeInnerLayout",{viewName:e})})},_getZoneData:function(e,t,i){var a=new $.Deferred,n=this,r=n.getFilterViewModel(m.FILTER_NAME.ZONE);return t||i?(r&&(r.options.set("disabled",!0),r.options.set("dataSource",[{id:void 0,name:I.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY_ZONE")}])),n.zoneDataSource=new f.data.DataSource({data:[]}),a.resolve()):(r&&r.options.set("disabled",!1),n.loadingPanel.open(),u.getZone(e).done(function(e){if(r){var t=$.extend(!0,[],e);t.unshift({id:void 0,name:I.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY_ZONE")}),r.options.set("dataSource",t)}n.zoneDataSource=new f.data.DataSource({data:e}),n.zoneDataSource.read(),n.loadingPanel.close(),a.resolve()}).fail(function(){a.reject()})),a.promise()},onChangeInnerLayout:function(e){var t,i=this.getCurrentViewInfo().innerLayoutName,a=e.viewName;if(!a){var n=window.localStorage.getItem("deviceViewType");n?(a=n.toLowerCase(),window.localStorage.removeItem("deviceViewType")):a=g.getDefaultView()}"registration"==i?(t=this.onRegistrationLayout())&&(a=t):"monitoring"==i&&(t=this.onMonitoringLayout())&&(a=t),this.deviceTabPanel.changeDataLayout(a)},onMonitoringLayout:function(){var e=this;v.getCurrentFloor().building.id==v.FLOOR_NAV_BUILDING_TOTAL_ID?(v.disableBuidingTotal(!1),v.disableFloorAllBtn(!0)):(v.disableBuidingTotal(!1),v.disableFloorAllBtn(!1)),e.setViewBtnEnabled("grid",!0),e.setViewBtnEnabled("map",!0),e.setViewBtnEnabled("list",!0),e.setViewBtnEnabled("statistic",!0),e.viewModel.set("enableSearch",!0),e.getActionViewModel(m.ACTION_NAME.REGISTER).options.set("invisible",!0);var t=e.getFilterViewModel(m.FILTER_NAME.ZONE);return t&&t.options.set("invisible",!1),null},onRegistrationLayout:function(){var e=this;v.disableFloorAllBtn(!0),v.disableBuidingTotal(!0),e.setViewBtnEnabled("grid",!1),e.setViewBtnEnabled("statistic",!1),e.setViewBtnEnabled("map",!0);var t=e.getActionViewModel(m.ACTION_NAME.REGISTER);t.options.set("invisible",!1),t.set("text",m.TEXT.DEREGISTER);var i=e.getFilterViewModel(m.FILTER_NAME.ZONE);return i&&i.options.set("invisible",!0),e.viewModel.set("enableSearch",!0),"map"},onChangeDataLayout:function(e){var t=this,i=v.getCurrentFloor(),a=i.floor,n=i.building,r=a.id,o=n.id,l=v.getCurrentFloorList(),s=o==v.FLOOR_NAV_BUILDING_TOTAL_ID,d=r==v.FLOOR_NAV_FLOOR_ALL_ID,c=t.getCurrentViewInfo(),p=c.innerLayoutName,u=c.dataViewWidget,g=e.viewName;t.deviceTabPanel.setViewWidgetDatasource([]),t.deviceTabPanel.setStatisticDatasource([]),t.deviceTabPanel.setZoneDatasource([],{imageUrl:null});var f=0<l.length;if("monitoring"==p){if(!s&&!f)return t.setViewBtnEnabled("map",!1),void("map"==g&&(g="list",t.deviceTabPanel.changeDataLayout(g)));if("map"==g){if(s)return void v.clickTopBuilding(!1);if(d)return void v.clickTopFloor()}else if("statistic"==g&&!s&&!d)return void v.clickAllFloor()}else if("registration"==p){if(s)return void v.clickTopBuilding(!1);if(f&&d)return void v.clickTopFloor();if(!f)return T.message(I.prop("FACILITY_DEVICE_NO_FLOOR_MSG")),T.open(),t.onChangeDataView(p,g,u),t.viewModel.set("hideRegisterArea",!0),t.viewModel.set("hideRightPanel",!0),t.viewModel.set("hideControlPanel",!0),t.viewModel.set("hideLightControlPanel",!0),void t.viewModel.set("hideMapPanel",!0)}t.onChangeDataView(p,g,u),t.loadingPanel.open(),t.refreshDeviceData(!1,p,g,u).always(function(){"map"==g&&(t.monitoringMapList?"registration"==p?t.registrationMapList.selectTab(m.REGISTRATION_STATUS_BUTTONS.REGISTER,!0):"monitoring"==p&&t.monitoringMapList.selectTab(m.REGISTRATION_STATUS_BUTTONS.REGISTER,!0):t.registrationMapList&&t.registrationMapList.selectTab(m.REGISTRATION_STATUS_BUTTONS.REGISTER,!0)),t.loadingPanel.close()})},onChangeDataView:function(e,t,i){var a=this,n=a.viewModel;a.prevLayoutName==e&&a.prevViewName==t||a.onInitializeFilter(),a.prevLayoutName=e,a.prevViewName=t,n.set("hideRegisterArea",!0),n.set("hideRightPanel",!0),n.set("hideControlPanel",!0),n.set("hideLightControlPanel",!0),n.set("hideMapPanel",!0),"list"!=t||"monitoring"!=e&&(i.dataSource.sort([{field:"name",dir:"asc"}]),n.set("hideRegisterArea",!1),n.registrationStatusButtons[m.REGISTRATION_STATUS_BUTTONS.REGISTER].set("active",!0),n.registrationStatusButtons[m.REGISTRATION_STATUS_BUTTONS.UNREGISTER].set("active",!1),a.getActionViewModel(m.ACTION_NAME.REGISTER).set("text",m.TEXT.DEREGISTER));"statistic"==t?(n.set("hideSelectArea",!0),n.set("enableSearch",!1)):n.set("hideSelectArea",!1);var r=a.getFilterViewModel(m.FILTER_NAME.ZONE);if("map"==t){r&&r.options.set("invisible",!0),"monitoring"==e?(i.setOptions({isRegisterView:!1,canDragDeviceIcon:!1}),n.set("hideRegistrationMapPanel",!0),n.set("hideMonitoringMapPanel",!1)):"registration"==e&&(i.setOptions({isRegisterView:!0,canDragDeviceIcon:!0}),a.registrationMapList&&a.registrationMapList.selectTab(m.REGISTRATION_STATUS_BUTTONS.REGISTER),n.set("hideRegistrationMapPanel",!1),n.set("hideMonitoringMapPanel",!0)),n.set("hideRightPanel",!1),n.set("hideMapPanel",!1);var o=v.getCurrentFloor().floor;i.setFloor(o),i.setZoneDataSource(a.zoneDataSource)}else"monitoring"==e&&r&&r.options.set("invisible",!1);i.unbind("change"),i.bind("change",a.onWidgetChangeSelection.bind(a))},refreshDeviceData:function(n,r,o,l,e){var s=this,t=v.getCurrentFloor(),i=t.floor,a=t.building,d=i.id,c=a.id,p=new $.Deferred;s.isRefreshing=!0;var u=s.getCurrentViewInfo();return r=r||u.innerLayoutName,o=o||u.dataViewName,e=e||u.registrationStatus,l=l||u.dataViewWidget,"registration"==r&&"map"==o&&(e="Registered"),("statistic"==o?s.getStatisticData(c,d):s.getDeviceData({viewName:o,layoutName:r,widget:l,registrationStatus:e,isRefresh:n})).fail(function(e){var t=g.getDeviceRegistrationFailMsg(e);T.message(t),T.open()}).always(function(e){if(e){var t=l.dataSource,i=s.createDataSource(e,t);l.setDataSource(i);var a=[];"registration"==r&&a.push(s.getRegisteredDeviceNum()),$.when.apply(this,a).fail(function(e){var t=g.getDeviceRegistrationFailMsg(e);T.message(t),T.open()}).always(function(){s.onAfterRefreshData(n,r,o,l,i),p.resolve(),s.isRefreshing=!1})}else p.resolve()}),p.promise()},onAfterRefreshData:function(e,t,i,a,n){var r=this,o=a.getSelectedData();r.setSelectedDataNum(o),"map"==i&&(e?r.monitoringMapList?"monitoring"==t?r.monitoringMapList.setDataSource(n,!1,!0):"registration"==t&&r.registrationMapList.setDataSource(n,!1,!0):r.registrationMapList&&r.registrationMapList.selectedIndex==m.REGISTRATION_STATUS_BUTTONS.REGISTER&&r.registrationMapList.setDataSource(n,!1,!0):("monitoring"==t&&r.monitoringMapList&&r.monitoringMapList.selectTab(r.monitoringMapList.selectedIndex,!0),"registration"==t&&r.registrationMapList&&r.registrationMapList.selectTab(r.registrationMapList.selectedIndex,!0)))},onInitializeFilter:function(){var e=this,t=e.viewModel;e.typeFilter=[],e.statusFilter=[],e.zoneFilter=[],e.modeFilter=[],t.set("searchFieldValue","");var i,a,n,r=t.filters,o=r.length;for(n=0;n<o;n++)"dropdowncheckbox"==(i=(a=r[n]).type)?(a=$("#"+a.id).data("kendoDropDownCheckBox")).selectAll():"dropdownlist"==i&&a.options.set("value",-1)},getCurrentFilter:function(){var e=this,t=[],i=e.getCurrentViewInfo(),a=i.dataViewName,n=i.registrationStatus;if("registration"==i.innerLayoutName&&"list"==a&&"NotRegistered"==n)return[];t=g.getAccureFilter(t,e.typeFilter,e.statusFilter,e.zoneFilter,e.modeFilter);var r=e.viewModel.get("searchFieldValue");if(r){var o={logic:"or",filters:[]};o.filters.push(g.filter0Depth("id","contains",r)),o.filters.push(g.filter0Depth("name","contains",r)),o.filters.push(g.filter1Depth("controlPoint","tagName",r)),t.filters.push(o)}return 0==t.filters.length?[]:t},applyCurrentFilter:function(e){var t=this,i=t.getCurrentViewInfo(),a=t.getCurrentFilter(),n=i.dataViewWidget,r=i.dataViewName,o=i.registrationStatus,l=i.innerLayoutName,s=n.dataSource;t.unselectAll();var d=[];d.push(t.refreshDeviceData(!1)),t.loadingPanel.open(),$.when.apply(this,d).always(function(){t._isSelectingTab||t.loadingPanel.close(),"registration"==l&&"NotRegistered"==o?"map"==r?s.filter(a):"list"==r&&s.filter([]):s.filter(a),t.setSelectedDataNum([]),"map"==r&&("registration"==l&&t.registrationMapList&&t.registrationMapList.selectTab(t.registrationMapList.selectedIndex,!0,!0),"monitoring"==l&&t.monitoringMapList&&t.monitoringMapList.selectTab(m.REGISTRATION_STATUS_BUTTONS.REGISTER,!0),"monitoring"==l&&t.registrationMapList&&t.registrationMapList.element.is(":visible")&&t.registrationMapList.selectTab(m.REGISTRATION_STATUS_BUTTONS.REGISTER,!0))})},getStatisticData:function(t,e){var i=this,a=i.deviceTypeKey,n=new $.Deferred;return t==v.FLOOR_NAV_BUILDING_TOTAL_ID||e===v.FLOOR_NAV_FLOOR_ALL_ID?u.getStatisticByKey(a).done(function(e){i.deviceTabPanel.setStatisticDatasource(g.convertStatistic(t,e)),n.resolve()}).fail(function(){n.reject()}):n.resolve(),n.promise()},getDeviceData:function(e){var t,i=e.viewName,a=e.widget,n=e.registrationStatus,r=e.page,o=e.size,l=e.isRefresh,s=e.thenCallback,d=this.deviceTypeKey;if(r=r||1,o=o||(l?a.dataSource.data().length:50),l&&(this._isScrolling||0==o)){var c=new $.Deferred;return c.resolve(),c.promise()}("map"!=i||"map"==i&&"NotRegistered"==n)&&(t={typeQuery:{page:r,size:o},mappedTypeQuery:{page:r,size:o}});var p=u.getDeviceWithType(d,[n],t,null,this._getFilteredObj());return s&&p.then(s),p},_isPossibleScrolling:function(e,t,i,a){return!(e<=t)&&(!(i<a+1)&&!self._isScrolling)},_appendPaginationData:function(e,t,i){var a,n=t.data().toJSON(),r=i.data,o=r.length;for(a=0;a<o;a++)r[a].selected=!1;i.data=n.concat(r);var l=this.createDataSource(i,t);e.setDataSource(l)},scrollEndEvt:function(e){var i=this,a=e.sender,t=a.pageSize(),n=a.data().length,r=Math.ceil(n/50),o=a.pagingTotalPage,l=a.pagingTotal,s=e.grid;if(i._isPossibleScrolling(l,n,o,r)){i._isScrolling=!0,i.loadingPanel.open();var d=i.getCurrentViewInfo(),c=d.dataViewName,p=d.registrationStatus;i.getDeviceData({page:r+1,size:t,viewName:c,registrationStatus:p,widget:s,thenCallback:function(e){i._appendPaginationData(s,a,e);var t=s.getSelectedData();i.setSelectedDataNum(t),i.loadingPanel.close(),i._isScrolling=!1}})}},getRegisteredDeviceNum:function(){var t,i,e=this,a=e.deviceTypeKey,n=[],r=e.getCurrentViewInfo().dataViewWidget.dataSource,o=e.getCurrentFilter();if($.isArray(o))n.push(u.getDeviceWithType(a,["Registered"],{typeQuery:{page:1,size:5},mappedTypeQuery:{page:1,size:5}},null,e._getFilteredObj()).done(function(e){t=e.total}));else{var l=r.data(),s=new f.data.Query(l).filter(o).toArray();t=s.length}return n.push(u.getDeviceWithType(a,["NotRegistered"],{typeQuery:{page:1,size:5},mappedTypeQuery:{page:1,size:5}},null,e._getFilteredObj()).done(function(e){i=e.total})),$.when.apply(this,n).always(function(){e.setRegisteredNum(t,i)})},setRegisteredNum:function(e,t){var i=this.viewModel;i.registrationStatusButtons[m.REGISTRATION_STATUS_BUTTONS.REGISTER].set("count",e),i.registrationStatusButtons[m.REGISTRATION_STATUS_BUTTONS.UNREGISTER].set("count",t),this.registrationMapList&&(this.registrationMapList.tabViewModel[m.REGISTRATION_STATUS_BUTTONS.REGISTER].set("count",e),this.registrationMapList.tabViewModel[m.REGISTRATION_STATUS_BUTTONS.UNREGISTER].set("count",t))},createDataSource:function(e,t){var i,a;e.data&&(i=e.total,a=Math.ceil(i/50),e=e.data),void 0===e.length&&(e=[]);var n=t,r=this.getCurrentFilter(),o=n.sort(),l=new f.data.DataSource({data:e,pageSize:50});l.read();var s,d,c=new f.data.Query(n.data()).filter({field:"selected",operator:"eq",value:!0}).toArray(),p=c.length;for(d=0;d<p;d++)s=c[d],(s=l.get(s.id))&&(s.selected=!0);return r&&l.filter(r),o&&l.sort(o),l.bind("scrollend",this.scrollEndEvt.bind(this)),l.pagingTotal=i,l.pagingTotalPage=a,l},setSelectedDataNum:function(e){var t=this,i=t.deviceTabPanel,a=0<e.length;i.setEnableActions(!a);var n=t.getFilterViewModel(m.FILTER_NAME.SELECTALL);a?n.set("text",m.TEXT.DESELECTALL):n.set("text",m.TEXT.SELECTALL),t.getActionViewModel(m.ACTION_NAME.SELECTEDTEXT).options.set("selectedText",g.calcScreenBySelect(e,t.getTotalSize(),t.getDisplaySize()))},getTotalSize:function(){var e=this.getCurrentViewInfo(),t=e.innerLayoutName,i=e.dataViewName,a=e.dataViewWidget,n=e.registrationStatus;if("monitoring"!=t){if("map"==i){if("Registered"==n)return a.dataSource.data().length;if(this.registrationMapList)return this.registrationMapList.tabViewModel[m.REGISTRATION_STATUS_BUTTONS.UNREGISTER].get("count")}else if("list"==i)return a.dataSource.pagingTotal}else if("map"==i)return a.dataSource.data().length;return a.dataSource.pagingTotal},getDisplaySize:function(){var e,t,i,a=this.getCurrentViewInfo(),n=a.innerLayoutName,r=a.dataViewName,o=a.dataViewWidget,l=a.registrationStatus,s=o.dataSource,d=this.registrationMapList;if("monitoring"!=n&&("map"==r&&"NotRegistered"==l&&d))return d.tabGrids[m.REGISTRATION_STATUS_BUTTONS.UNREGISTER].dataSource.data().length;return e=s.filter(),t=s.data(),i=new f.data.Query(t),e&&(i=i.filter(e)),(i=i.toArray()).length},onWidgetChangeSelection:function(e){var t=this,i=e.sender.getSelectedData(),a=t.getCurrentViewInfo(),n=a.innerLayoutName,r=a.dataViewName,o=t.registrationMapList,l=t.getActionViewModel(m.ACTION_NAME.REGISTER),s=t.getActionViewModel(m.ACTION_NAME.BLOCK),d=t.getActionViewModel(m.ACTION_NAME.DELETE),c=t.getActionViewModel(m.ACTION_NAME.DETAIL),p=t.getActionViewModel(m.ACTION_NAME.VIEW),u=0<i.length;u&&"map"===r&&o.selectedIndex==m.REGISTRATION_STATUS_BUTTONS.UNREGISTER&&0<o.getSelectedData().length&&o.unselectAll();t.setSelectedDataNum(i),o.selectedIndex==m.REGISTRATION_STATUS_BUTTONS.UNREGISTER&&"registration"==n&&"map"==r?l.options.set("disabled",!0):l.options.set("disabled",!u),s&&s.options.set("disabled",!u),d&&d.options.set("disabled",!u),c.options.set("disabled",!u),p&&(1==i.length?p.options.set("disabled",!u):p.options.set("disabled",!0)),t.onWidgetChangeRegistrationMapList(r,n,i)},onWidgetChangeRegistrationMapList:function(e,t,i){var a=this.registrationMapList;a.unselectAll(),"map"===e&&"monitoring"!=t&&a.selectByData(i)},selectAll:function(){var e,t=this,i=t.getCurrentViewInfo(),a=i.innerLayoutName,n=i.dataViewName,r=i.dataViewWidget;return e="registration"==a&&"map"==n&&t.registrationMapList&&t.registrationMapList.selectedIndex==m.REGISTRATION_STATUS_BUTTONS.UNREGISTER?(t.registrationMapList.selectAll(),t.registrationMapListElement.find(".map-panel-list-container .k-grid-content.no-header .device-map-panel-list-item").each(function(){t.initListDragDropEvt({currentTarget:this})}),t.registrationMapList.getSelectedData()):(r.selectAll(!0),t.registrationMapList&&t.registrationMapList.selectAll(),t.monitoringMapList&&t.monitoringMapList.selectAll(),r.getSelectedData()),t.setSelectedDataNum(e),e},unselectAll:function(){var e=this;e.getCurrentViewInfo().dataViewWidget.unselectAll(),e.registrationMapList&&e.registrationMapList.unselectAll(),e.monitoringMapList&&e.monitoringMapList.unselectAll(),e.setSelectedDataNum([])},getRegisterMapListOptions:function(){var e=this;return{dataSource:[],hasNewDataSource:!1,hasSelectedModel:!0,type:"hybrid",filterTab:[{template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",listStyle:"treeList",widgetOptions:{enableShiftSelection:!0},listOptions:{column:{template:e._mapListRegisteredTabTemplate.bind(e),headerTemplate:v.getCurrentFloorName,groupHeaderTemplate:e._mapListGroupHeaderTemplate.bind(e)},group:[{field:"locations[0].foundation_space_zones_id",aggregate:"count"}]}},{template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",hideHeader:!0,widgetOptions:{scrollable:{virtual:!0}},listOptions:{column:{template:i.mapListRegTemplate},sort:[{field:"name",dir:"asc"}]}}],tabViewModel:[{name:I.prop("FACILITY_DEVICE_REGISTERED"),click:function(){},count:0},{name:I.prop("FACILITY_DEVICE_UNREGISTERED"),click:function(){},count:0}],activateTab:e.activateRegistrationMapListTab.bind(e)}},expandRegistrationMapListTab:function(e){var t=this.getCurrentViewInfo().dataViewWidget.dataSource,i=e.model;return e.sender.setDataSourceExpand(i,t),!1},activateRegistrationMapListTab:function(e){var t,i,a,n=e.index,r=e.sender,o=this,l=o.getCurrentViewInfo(),s=l.innerLayoutName,d=l.dataViewWidget,c=l.registrationStatus,p=o.getActionViewModel(m.ACTION_NAME.REGISTER);o._isSelectingTab=!0,o.loadingPanel.open(),n==m.REGISTRATION_STATUS_BUTTONS.REGISTER?(p.set("text",m.TEXT.DEREGISTER),i=new $.Deferred,a=d.dataSource.data(),i.resolve(a),t=i.promise()):n==m.REGISTRATION_STATUS_BUTTONS.UNREGISTER&&(p.set("text",m.TEXT.REGISTER),t=o.getDeviceData({viewName:"map",layoutName:s,widget:r,registrationStatus:c})),t.always(function(e){if(o._isSelectingTab=!1,e){o.unselectAll();var t=r.dataSource,i=o.createDataSource(e,t);r.setDataSource(i,!1,!0),o.setSelectedDataNum([]),o.loadingPanel.close()}})},onRegistrationMapListChangeSelection:function(e){var t,i=e.sender,a=this.getCurrentViewInfo().dataViewWidget;if(i.selectedIndex==m.REGISTRATION_STATUS_BUTTONS.REGISTER){t=i.getSelectedData(),a.unselectAll();var n,r,o=t.length;for(n=0;n<o;n++)r=t[n],a.selectDevice(r.id,r.selected)}else a.unselectAll(),t=i.getSelectedData();this.setSelectedDataNum(t)},getMonitoringMapListOptions:function(){return null},_mapListRegisteredTabTemplate:function(e){if(e.treeGroup)return this._mapListGroupHeaderTemplate(e);if(e.isDummy)return i.mapListRegTemplate(e);var t=this.getCurrentViewInfo();return i.mapListDualTemplate(e,"monitoring"!==t.innerLayoutName)},_mapListGroupHeaderTemplate:function(e){var t,i,a=this.zoneDataSource.data(),n="-";return i=e.value,(t=new f.data.Query(a).filter({value:i,operator:"eq",field:"id"}).toArray()).length&&(n=t[0].name),n},initListDragDropEvt:function(e){var t=$(e.currentTarget),i=this.registrationMapList,a=i.select(),n=i.getSelectedData(),r=t.find(".detail-img"),o=this.registrationMapView.widget;o.deviceDragDrop({selectedRows:a,deviceIconElem:r,selectedData:n}),o.unbind("drop"),o.bind("drop",this.dropEndDeviceEvt.bind(this))},dropEndDeviceEvt:function(e){var i=this,t=e.devices,a=e.deviceIcon;i.loadingPanel.open(),u.patchDevices(t).done(function(){i.refreshDeviceData(!1).always(function(){})}).fail(function(e){i.loadingPanel.close(),i.registrationMapView.widget._removeDeviceIcon(a);var t=g.getDeviceRegistrationFailMsg(e);T.message(t),T.open()})},dragEndDeviceEvt:function(e){var i=this,t=e.devices;i.loadingPanel.open(),u.patchDevices(t).done(function(){i.refreshDeviceData(!1).always(function(){})}).fail(function(e){i.loadingPanel.close();var t=g.getDeviceRegistrationFailMsg(e);T.message(t),T.open()})},setViewBtnEnabled:function(e,t){var i,a=this.viewModel.viewButtons,n=a.length;for(i=0;i<n;i++)if(a[i].viewName==e){a[i].set("disabled",!t);break}},getCurrentViewInfo:function(){var e=this.tabLayout.curInnerLayoutName,t={innerLayoutName:null,dataViewName:null,registrationStatus:null};if(t.innerLayoutName=e,t.dataViewName=this.deviceTabPanel.currentViewName,t.dataViewWidget=this.deviceTabPanel.currentWidget,"monitoring"==t.innerLayoutName)t.registrationStatus="Registered";else if("registration"==t.innerLayoutName){if("map"==t.dataViewName){var i=this.registrationMapList;t.registrationStatus=i?0===i.selectedIndex?"Registered":"NotRegistered":"Registered"}else if("list"==t.dataViewName){var a,n=this.viewModel.registrationStatusButtons,r=n.length;for(a=0;a<r&&!n[a].active;a++);0==a?t.registrationStatus="Registered":1==a?t.registrationStatus="NotRegistered":2==a&&(t.registrationStatus="Blocked")}}else"block"==t.innerLayoutName&&(t.registrationStatus="Blocked");return t},getFilterWidget:function(e){var t=this.getFilterViewModel(e);if(t){var i=t.type,a=t.id,n="";return"dropdownlist"==i?n="kendoDropDownList":"dropdowncheckbox"==i?n="kendoDropDownCheckBox":"button"==i?n="kendoButton":"combobox"==i&&(n="kendoCombobox"),$("#"+a).data(n)}return null},getLayoutViewModel:function(e){var t,i,a=this.innerLayouts,n=a.length;for(i=0;i<n;i++)if(e==(t=a[i]).layoutName)return t;return null},getFilterViewModel:function(e){var t=this.viewModel.filters;return this._getFilterOrAction(e,t)},getActionViewModel:function(e){var t=this.viewModel.actions;return this._getFilterOrAction(e,t)},_getFilterOrAction:function(e,t){var i,a=t.length;for(i=0;i<a;i++)if(t[i].name==e)return t[i];return null},_getFilteredObj:function(){var t,e=this,i=e.typeFilter&&e.typeFilter[0],a=e.statusFilter,n=e.modeFilter&&e.modeFilter[0],r=e.zoneFilter,o=(i=i&&i.filters&&i.filters[0]||i)?i.value:null,l=[],s=n||{},d=[],c=e.viewModel.searchFieldValue||null;return a.forEach(function(e){"none"!==(t=e.filters?e.filters[0].value:e.value)&&l.push(t)}),r.forEach(function(e){d.push("undefined"!=e.value?e.value:0)}),{type:o,statuses:l,mode:s,zones:d,name:c}},destroy:function(){this.zoneDataSource=new f.data.DataSource({data:[]}),clearInterval(this.refreshInterval),clearTimeout(this.refreshTimeout)}})}),define("device/common/controller/device-controller",["device/common/controller/base-controller","device/common/device-api","device/common/device-util","device/common/device-constants","device/common/config/popup-config"],function(d,g,T,m,e){var I=window.kendo,v=window.MAIN_WINDOW,E=window.I18N,C=e.messageDialog,t=d.extend({init:function(e){d.fn.init.call(this,e),this.controlPanelTimer=[],this.panelRefreshTimer=null},initComponent:function(){d.fn.initComponent.call(this),this.controlPanel=this.controlPanelElement.kendoControlTab({change:this._changeControlPanelEvt.bind(this)}).data("kendoControlTab")},attachFilterEvt:function(){var o=this;d.fn.attachFilterEvt.call(o),o.getFilterViewModel(m.FILTER_NAME.TYPE).options.set("select",function(e){var t=o.typeFilter=[],i=e.dataItem.value;if(""!==i)if(i=m.INDOOR_TYPE[i],$.isArray(i)){var a,n=i.length,r={logic:"or",filters:[]};for(a=0;a<n;a++)r.filters.push(T.filter0Depth("type","eq",i[a]));t.push(r)}else t.push(T.filter0Depth("type","eq",i));o.applyCurrentFilter()}),o.getFilterViewModel(m.FILTER_NAME.STATUS).options.set("selectionChanged",function(e){var t=o.statusFilter=[],i=e.newValue,a=i.length;if(0===a)t.push(T.filter0Depth("status","eq","none"));else if(a!==m.STATUS.length)for(var n=0;n<a;n++){var r=m.STATUS[i[n]-1].split(".")[1];switch(r){case"On":case"Off":t.push(T.filterStatusNoAlarm("operations","power",r,"alarms"));break;case"Critical":t.push(T.filter1Depth("alarms","alarms_type",r));break;case"Warning":t.push(T.filter1DepthNone("alarms","alarms_type",r))}}o.applyCurrentFilter()}),o.getFilterViewModel(m.FILTER_NAME.MODE).options.set("select",function(e){var t=o.modeFilter=[],i=e.dataItem.value;if(""!==i){var a=T.filter1Depth("modes","mode",m.MODE[i-1].mode);a.id=m.MODE[i-1].id,t.push(a)}o.applyCurrentFilter()})},onMonitoringLayout:function(){var e=this;d.fn.onMonitoringLayout.call(e),e.setViewBtnEnabled("statistic",!0),e.setViewBtnEnabled("map",!0),e.setViewBtnEnabled("list",!0),e.setViewBtnEnabled("grid",!0)},selectAll:function(){var e=d.fn.selectAll.call(this);"monitoring"==this.getCurrentViewInfo().innerLayoutName&&this.controlPanel.setDataSource(e)},unselectAll:function(){d.fn.unselectAll.call(this),"monitoring"==this.getCurrentViewInfo().innerLayoutName&&this.controlPanel.setDataSource([])},onAfterRefreshData:function(e,t,i,a,n){d.fn.onAfterRefreshData.call(this,e,t,i,a,n);var r=a.getSelectedData();this.controlPanel.setDataSource(r)},onWidgetChangeSelection:function(e){d.fn.onWidgetChangeSelection.call(this,e);var t=e.sender.getSelectedData(),i=this.getCurrentViewInfo(),a=i.innerLayoutName,n=i.dataViewName;"monitoring"==a&&"statistic"!==n&&this.controlPanel.setDataSource(t)},onChangeDataView:function(e,t,i){d.fn.onChangeDataView.call(this,e,t,i);var a=this.viewModel;a.set("hideMonitoringMapPanel",!0),"monitoring"==e&&"statistic"!==t?(a.set("hideRightPanel",!1),a.set("hideControlPanel",!1),a.set("hideMapPanel",!0),"grid"===t?a.set("hideIndoorLegend",!1):a.set("hideIndoorLegend",!0)):a.set("hideControlPanel",!0)},_changeControlPanelEvt:function(e){var n=this,t=e.item,i=e.index,a=e.subIndex,r=e.mode,o=[],l=m.controlSet[i];void 0!==a&&(l=l[a],i=10*i+a);var s=n.controlPanelTimer;s[i]&&(clearTimeout(s[i]),s[i]=void 0);var d,c={};l.id?(c.id=l.id,r&&(c.id=l[r]),c[l.parameter]=t.value,(d=[]).push(c)):(l.underParameter?(c[l.parameter]={},c[l.parameter][l.underParameter]=t.value):c[l.parameter]=t.value,d=c),clearInterval(n.refreshInterval),clearTimeout(n.refreshTimeout);var p=n.deviceTabPanel.currentWidget.getSelectedData();s[i]=setTimeout(function(){var e,t,i,a=p.length;if(1===a)t=p[0].id,o.push(g.patchGroupAttr(t,l.apiName,d));else{for((i={dms_devices_ids:[],control:{}}).control[l.apiName]=d,e=0;e<a;e++)i.dms_devices_ids.push(p[e].id);o.push(g.multiControl(i))}$.when.apply($,o).always(function(){n.panelRefreshTimer&&(clearTimeout(n.panelRefreshTimer),n.panelRefreshTimer=null),n.panelRefreshTimer=setTimeout(function(){n.loadingPanel.open(),n.refreshDeviceData(!0).always(function(){n.loadingPanel.close(),n.refreshInterval=setInterval(n.intervalRefreshData.bind(n),m.ALL_TIME_INTERVAL)})},m.PANEL_REFRESH_TIME)})},m.TIME_OUT)},destroy:function(){d.fn.destroy.call(this),clearTimeout(this.panelRefreshTimer)}}),i=t.extend({attachFilterEvt:function(){var o=this;d.fn.attachFilterEvt.call(o),o.getFilterViewModel(m.FILTER_NAME.STATUS).options.set("selectionChanged",function(e){var t=o.statusFilter=[],i=e.newValue,a=i.length;if(0===a)t.push(T.filter0Depth("status","eq","none"));else if(a!==m.STATUS.length)for(var n=0;n<a;n++){var r=m.STATUS[i[n]-1].split(".")[1];switch(r){case"On":case"Off":t.push(T.filter0Depth("representativeStatus","eq","Normal"));break;case"Critical":t.push(T.filter1Depth("alarms","alarms_type",r));break;case"Warning":t.push(T.filter1DepthNone("alarms","alarms_type",r))}}o.applyCurrentFilter()})},onMonitoringLayout:function(){return d.fn.onMonitoringLayout.call(this),v.disableBuidingTotal(!0),v.disableFloorAllBtn(!0),this.setViewBtnEnabled("list",!1),this.setViewBtnEnabled("statistic",!1),this.setViewBtnEnabled("grid",!1),"map"},selectAll:function(){var e=d.fn.selectAll.call(this);"monitoring"==this.getCurrentViewInfo().innerLayoutName&&this.controlPanel.setDataSource(this._getIndoorDevices(e))},onAfterRefreshData:function(e,t,i,a,n){d.fn.onAfterRefreshData.call(this,e,t,i,a,n);var r=a.getSelectedData();this.controlPanel.setDataSource(this._getIndoorDevices(r))},onWidgetChangeSelection:function(e){d.fn.onWidgetChangeSelection.call(this,e);var t=e.sender.getSelectedData(),i=this.getCurrentViewInfo(),a=i.innerLayoutName,n=i.dataViewName;"monitoring"==a&&"statistic"!==n&&this.controlPanel.setDataSource(this._getIndoorDevices(t))},onChangeDataLayout:function(e){var t=this,i=v.getCurrentFloor(),a=i.floor,n=i.building,r=a.id,o=n.id,l=v.getCurrentFloorList(),s=o==v.FLOOR_NAV_BUILDING_TOTAL_ID,d=r==v.FLOOR_NAV_FLOOR_ALL_ID,c=t.getCurrentViewInfo(),p=c.innerLayoutName,u=c.dataViewWidget,g=e.viewName;t.deviceTabPanel.setViewWidgetDatasource([]),t.deviceTabPanel.setStatisticDatasource([]),t.deviceTabPanel.setZoneDatasource([],{imageUrl:null});var f=0<l.length;if(s)v.clickTopBuilding(!1);else if(f&&d)v.clickTopFloor();else{if(!f)return C.message(E.prop("FACILITY_DEVICE_NO_FLOOR_MONITORING_MSG")),void C.open();t.onChangeDataView(p,g,u),t.loadingPanel.open(),t.refreshDeviceData(!1,p,g,u).always(function(){"map"==g&&(t.monitoringMapList?"registration"==p?t.registrationMapList.selectTab(m.REGISTRATION_STATUS_BUTTONS.REGISTER,!0):"monitoring"==p&&t.monitoringMapList.selectTab(m.REGISTRATION_STATUS_BUTTONS.REGISTER,!0):t.registrationMapList&&t.registrationMapList.selectTab(m.REGISTRATION_STATUS_BUTTONS.REGISTER,!0)),t.loadingPanel.close()})}},_getIndoorDevices:function(e){return new I.data.Query(e).filter({field:"type",operator:"contains",value:"AirConditioner."}).toArray()}}),a=d.extend({onMonitoringLayout:function(){return d.fn.onMonitoringLayout.call(this),this.setViewBtnEnabled("map",!1),this.setViewBtnEnabled("statistic",!1),this.setViewBtnEnabled("grid",!1),"list"},onRegistrationLayout:function(){var e=d.fn.onRegistrationLayout.call(this);return this.setViewBtnEnabled("map",!0),e},onChangeDataView:function(e,t,i){d.fn.onChangeDataView.call(this,e,t,i),"monitoring"==e&&this.setViewBtnEnabled("map",!1)}}),n=d.extend({onMonitoringLayout:function(){return d.fn.onMonitoringLayout.call(this),this.setViewBtnEnabled("map",!1),this.setViewBtnEnabled("statistic",!1),this.setViewBtnEnabled("grid",!1),"list"},onRegistrationLayout:function(){var e=d.fn.onRegistrationLayout.call(this);return this.setViewBtnEnabled("map",!0),e},onChangeDataView:function(e,t,i){d.fn.onChangeDataView.call(this,e,t,i),"monitoring"==e&&this.setViewBtnEnabled("map",!1)},attachEvent:function(){var r=this;d.fn.attachEvent.call(r);var o=r.innerLayouts[m.INNER_LAYOUT.MONITORING].dataViews.list.widget;o.element.on("click",".device-point-sendbtn",function(){var e,t=$(this).closest("tr").data("id"),i=o.dataSource.get(t),a=$(this).siblings(".device-point-numeric").find("input"),n=a.val();n&&(a.data("beforeValue",n),e=Number(n),isNaN(e)&&(e=n),r.loadingPanel.open(),g.patchControlPointValue(i.id,e).always(function(){i.controlPoint.value=n,r.loadingPanel.close()}))})},attachFilterEvt:function(){var o=this;d.fn.attachFilterEvt.call(o),o.getFilterViewModel(m.FILTER_NAME.TYPE).options.set("select",function(e){var t=o.typeFilter=[],i=e.dataItem.value;""!==i&&t.push(T.filter0Depth("type","eq",m.POINT_TYPE[i])),o.applyCurrentFilter()}),o.getFilterViewModel(m.FILTER_NAME.STATUS).options.set("selectionChanged",function(e){var t=o.statusFilter=[],i=e.newValue,a=i.length;if(0===a)t.push(T.filter0Depth("status","eq","none"));else if(a!==m.STATUS.length)for(var n=0;n<a;n++){var r=m.STATUS[i[n]-1].split(".")[1];switch(r){case"On":case"Off":t.push(T.filter0Depth("representativeStatus","eq","Normal"));break;case"Critical":t.push(T.filter1Depth("alarms","alarms_type",r));break;case"Warning":t.push(T.filter1DepthNone("alarms","alarms_type",r))}}o.applyCurrentFilter()})}}),r=d.extend({onMonitoringLayout:function(){d.fn.onMonitoringLayout.call(this),this.registrationMapList.hideTab(!0)},onRegistrationLayout:function(){var e=d.fn.onRegistrationLayout.call(this);return this.registrationMapList.hideTab(!1),e},onChangeDataView:function(e,t,i){var a=this.viewModel;d.fn.onChangeDataView.call(this,e,t,i),"monitoring"==e&&(a.set("hideMonitoringMapPanel",!0),a.set("hideRegistrationMapPanel",!1))},attachFilterEvt:function(){var o=this;d.fn.attachFilterEvt.call(o),o.getFilterViewModel(m.FILTER_NAME.TYPE).options.set("select",function(e){var t=o.typeFilter=[],i=e.dataItem.value;if(""!==i){var a={logic:"or",filters:[]};a.filters.push(T.filter0Depth("type","eq",m.ENERGY_TYPE[i])),a.filters.push(T.filter0Depth("mappedType","eq",m.ENERGY_TYPE[i])),t.push(a)}o.applyCurrentFilter()}),o.getFilterViewModel(m.FILTER_NAME.STATUS).options.set("selectionChanged",function(e){var t=o.statusFilter=[],i=e.newValue,a=i.length;if(0===a)t.push(T.filter0Depth("representativeStatus","eq","none"));else if(a!==m.STATUS.length)for(var n=0;n<a;n++){var r=m.STATUS[i[n]-1].split(".")[1];switch(r){case"On":t.push(T.filter0Depth("representativeStatus","eq","Normal"));break;case"Off":t.push(T.filter0Depth("representativeStatus","eq","Normal.Off"));break;case"Critical":t.push(T.filter1Depth("alarms","alarms_type",r));break;case"Warning":t.push(T.filter1DepthNone("alarms","alarms_type",r))}}o.applyCurrentFilter()})},onWidgetChangeRegistrationMapList:function(e,t,i){var a=this.registrationMapList;a.unselectAll(),"map"===e&&a.selectByData(i)},openDetailPopup:function(e,t,i){this.detailPopup.hasConnectedDevices={},d.fn.openDetailPopup.call(this,e,t,i)},patchInDetailPopupEvt:function(e,t){var i,a,n,r,o=e.sender,l=o.hasConnectedDevices||{},s=e.results||[e.result];for(i=0;i<s.length;i++)(n=s[i]).mappedType||delete n.mappedType,a=n.id,r=n.meters&&n.meters[0]||{},(l[a]&&!T.isEnableEnergyMappingType(n)||r.connectedDevices&&0==r.connectedDevices.length)&&(r.connectedDevices=[]);o.hasConnectedDevices={},d.fn.patchInDetailPopupEvt.call(this,e,t)}}),l=d.extend({onMonitoringLayout:function(){d.fn.onMonitoringLayout.call(this),this.registrationMapList.hideTab(!0)},onRegistrationLayout:function(){var e=d.fn.onRegistrationLayout.call(this);return this.registrationMapList.hideTab(!1),e},onChangeDataView:function(e,t,i){var a=this.viewModel;d.fn.onChangeDataView.call(this,e,t,i),"monitoring"==e&&(a.set("hideMonitoringMapPanel",!0),a.set("hideRegistrationMapPanel",!1))},attachFilterEvt:function(){var o=this;d.fn.attachFilterEvt.call(o),o.getFilterViewModel(m.FILTER_NAME.STATUS).options.set("selectionChanged",function(e){var t=o.statusFilter=[],i=e.newValue,a=i.length;if(0===a)t.push(T.filter0Depth("representativeStatus","eq","none"));else if(a!==m.STATUS.length)for(var n=0;n<a;n++){var r=m.STATUS[i[n]-1].split(".")[1];switch(r){case"On":case"Off":t.push(T.filter0Depth("representativeStatus","eq","Normal"));break;case"Critical":t.push(T.filter1Depth("alarms","alarms_type",r));break;case"Warning":t.push(T.filter1DepthNone("alarms","alarms_type",r))}}o.applyCurrentFilter()})},onWidgetChangeRegistrationMapList:function(e,t,i){var a=this.registrationMapList;a.unselectAll(),"map"===e&&a.selectByData(i)}}),o=l.extend({init:function(e){t.fn.init.call(this,e)},initComponent:function(){l.fn.initComponent.call(this),this._lightControlPanelInit()},onChangeDataView:function(e,t,i){l.fn.onChangeDataView.call(this,e,t,i);var a=this.viewModel;a.set("hideMonitoringMapPanel",!0),"monitoring"==e&&"statistic"!==t?(a.set("hideRightPanel",!1),a.set("hideLightControlPanel",!1),a.set("hideMapPanel",!0),this._lightControlPanelInit()):a.set("hideLightControlPanel",!0)},selectAll:function(){l.fn.selectAll.call(this),"monitoring"==this.getCurrentViewInfo().innerLayoutName&&this._lightControlPanelSetData()},unselectAll:function(){l.fn.unselectAll.call(this),"monitoring"==this.getCurrentViewInfo().innerLayoutName&&this._lightControlPanelSetData()},onAfterRefreshData:function(e,t,i,a,n){l.fn.onAfterRefreshData.call(this,e,t,i,a,n),this._lightControlPanelSetData()},onWidgetChangeSelection:function(e){l.fn.onWidgetChangeSelection.call(this,e),this._lightControlPanelSetData()},pageChangeEvt:function(e){l.fn.pageChangeEvt.call(this,e),this._lightControlPanelSetData()},attachFilterEvt:function(){var o=this;l.fn.attachFilterEvt.call(o),o.getFilterViewModel(m.FILTER_NAME.STATUS).options.set("selectionChanged",function(e){var t=o.statusFilter=[],i=e.newValue,a=i.length;if(0===a)t.push(T.filter0Depth("representativeStatus","eq","none"));else if(a!==m.STATUS.length)for(var n=0;n<a;n++){var r=m.STATUS[i[n]-1].split(".")[1];switch(r){case"On":case"Off":t.push(T.filterStatusNoAlarm("operations","power",r,"alarms"));break;case"Critical":t.push(T.filter1Depth("alarms","alarms_type",r));break;case"Warning":t.push(T.filter1DepthNone("alarms","alarms_type",r))}}o.applyCurrentFilter()})},_lightControlPanelInit:function(){var e=this,t=e.viewModel.lightPanel;t.power.set("click",e._changeLightPowerEvt.bind(e)),t.power.set("invisible",!0),t.dimmingLevel.set("invisible",!0),t.dimmingLevel.set("slide",e._changeLightValueEvt.bind(e))},_lightControlPanelSetData:function(){var e,t,i,a,n,r,o=this.getCurrentViewInfo().dataViewWidget,l=this.viewModel.lightPanel,s=o.getSelectedData(),d=new I.data.Query(s).filter({logic:"or",filters:[{field:"type",operator:"eq",value:"Light"},{field:"mappedType",operator:"eq",value:"Light"}]}).toArray(),c=0,p=0,u=d.length;if(0<u){var g=!1,f=!1,m=!1,v=!1;for(n=0;n<u;n++)(r=(e=d[n]).type)&&(-1!=r.indexOf("AO")?f=!0:-1!=r.indexOf("DO")?g=!0:"Light"==r&&(g=f=!0)),-1==r.indexOf("AI")&&-1==r.indexOf("DI")&&("-"!=(t=T.getDimmingLevel(e))&&(t=t.replace("%",""),c+=t=Number(t),p++),"Normal.On"==(a=window.Util.getNormalStatus(e))?m=!0:v=!0,a="Normal.On"==a,void 0===i&&(i=a),i=a||i);0!=p&&(c=Math.round(c/p)),l.dimmingLevel.set("value",c),l.dimmingLevel.set("invisible",!f),l.power.set("invisible",!g),l.set("noSelected",!0),m&&v?(l.power.set("mixed",!0),l.power.set("active",!0)):(l.power.set("active",i),l.power.set("mixed",!1))}else l.set("noSelected",!1),l.dimmingLevel.set("invisible",!0),l.power.set("invisible",!0)},_changeLightPowerEvt:function(e){var t=this.viewModel.lightPanel.get("power"),i=t.get("active");i=!(!t.get("mixed")&&i),this._changeLightControlPanelEvt({index:m.LIGHT_CONTROL.POWER,data:i})},_changeLightValueEvt:function(e){this._changeLightControlPanelEvt({index:m.LIGHT_CONTROL.DIMMING,data:e.value})},_changeLightControlPanelEvt:function(e){var t=this,i=e.index,a=e.data,n=t.controlPanelTimer;n[i]&&(clearTimeout(n[i]),n[i]=void 0);var r,o,l,s=s=t.viewModel.lightPanel.get("power"),d=t.viewModel.lightPanel.get("dimmingLevel"),c=t.getCurrentViewInfo().dataViewWidget.getSelectedData(),p=c.length,u=[];if(i==m.LIGHT_CONTROL.POWER)for(s.set("mixed",!1),s.set("active",a),r=0;r<p;r++)o=c[r],l=o.type,o.operations&&o.operations[0]&&(-1!=l.indexOf("ControlPoint.DO")&&void 0!==o.controlPoint?o.controlPoint.value=a?1:0:o.operations[0].power=a);else if(i==m.LIGHT_CONTROL.DIMMING)for(d.set("value",a),r=0;r<p;r++)o=c[r],l=o.type,o.lights&&o.lights[0]&&(o.lights[0].dimmingLevel=a);clearInterval(t.refreshInterval),clearTimeout(t.refreshTimeout),n[i]=setTimeout(function(){for(r=0;r<p;r++)o=c[r],l=o.type,i==m.LIGHT_CONTROL.POWER?-1!=l.indexOf("ControlPoint.DO")?u.push({id:o.id,controlPoint:{value:a?1:0}}):u.push({id:o.id,operations:[{id:"General",power:a?"On":"Off"}]}):i==m.LIGHT_CONTROL.DIMMING&&u.push({id:o.id,lights:[{id:1,dimmingLevel:a}]});g.patchDevices(u).always(function(){t.panelRefreshTimer&&(clearTimeout(t.panelRefreshTimer),t.panelRefreshTimer=null),t.panelRefreshTimer=setTimeout(function(){t.loadingPanel.open(),t.refreshDeviceData(!0).always(function(){t.loadingPanel.close(),t.refreshInterval=setInterval(t.intervalRefreshData.bind(t),m.ALL_TIME_INTERVAL)})},m.PANEL_REFRESH_TIME)})},m.TIME_OUT)},destroy:function(){t.fn.destroy.call(this)}}),s=l.extend({attachFilterEvt:function(){var n=this;l.fn.attachFilterEvt.call(n),n.getFilterViewModel(m.FILTER_NAME.TYPE).options.set("select",function(e){var t=n.typeFilter=[],i=e.dataItem.value;if(""!==i){var a={logic:"or",filters:[]};a.filters.push(T.filter0Depth("type","eq",m.SENSOR_TEMP_HUM_TYPE[i])),a.filters.push(T.filter0Depth("mappedType","eq",m.SENSOR_TEMP_HUM_TYPE[i])),t.push(a)}n.applyCurrentFilter()})}}),c=l.extend({onMonitoringLayout:function(){l.fn.onMonitoringLayout.call(this),this.getActionViewModel("delete").options.set("invisible",!0)},onRegistrationLayout:function(){var e=l.fn.onRegistrationLayout.call(this);return this.getActionViewModel("delete").options.set("invisible",!1),e},attachFilterEvt:function(){var r=this;r.getFilterViewModel(m.FILTER_NAME.STATUS).options.set("selectionChanged",function(e){var t=r.statusFilter=[],i=e.newValue,a=i.length;if(0===a)t.push(T.filter0Depth("representativeStatus","eq","none"));else if(a!==m.STATUS.length)for(var n=0;n<a;n++){switch(m.STATUS[i[n]-1].split(".")[1]){case"On":t.push(T.filter0Depth("representativeStatus","eq","Normal"));break;case"Critical":t.push(T.filter0Depth("representativeStatus","eq","Alarm.Critical"));break;case"Warning":t.push(T.filter0Depth("representativeStatus","eq","Alarm.Warning"))}}r.applyCurrentFilter()})}}),p=c.extend({attachFilterEvt:function(){var o=this;d.fn.attachFilterEvt.call(o),o.getFilterViewModel(m.FILTER_NAME.TYPE).options.set("select",function(e){var t=o.typeFilter=[],i=e.dataItem.value;""!==i&&t.push(T.filter1DepthObj("configuration","mobilityType",m.BEACON_LOCATION_TYPE[i])),o.applyCurrentFilter()}),o.getFilterViewModel(m.FILTER_NAME.STATUS).options.set("selectionChanged",function(e){var t=o.statusFilter=[],i=e.newValue,a=i.length;if(0===a)t.push(T.filter0Depth("representativeStatus","eq","none"));else if(a!==m.BEACON_STATUS.length)for(var n=0;n<a;n++){var r=m.STATUS[i[n]-1];"Normal.On"==r&&(r="Normal"),t.push(T.filter0Depth("representativeStatus","eq",r))}o.applyCurrentFilter()})}}),u=c.extend({attachEvent:function(){c.fn.attachEvent.call(this),this.getActionViewModel("view").options.set("click",this.clickViewBtnEvt.bind(this))},clickViewBtnEvt:function(e){var t=this.getCurrentViewInfo(),i=t.innerLayoutName,a=t.dataViewName,n=t.dataViewWidget,r=[];"registration"==i&&"map"==a&&this.registrationMapList&&this.registrationMapList.selectedIndex==m.REGISTRATION_STATUS_BUTTONS.UNREGISTER?0==(r=this.registrationMapList.getSelectedData()).length&&(r=n.getSelectedData()):r=n.getSelectedData();var o,l,s,d,c=r.length;if(length<31)for(o=0;o<c;o++)s=r[o],"-"!==(l=T.getIpAddress(s))&&(1==c?(l="http://"+l,window.open(l,"","width=640,height=480,location=0")):(d=100*o,window.open(l,"_blank","width=640,height=480, left="+d+", top="+d)));else{C.message("You cannot open over 30 windows for the same time."),C.open()}},onMonitoringLayout:function(){c.fn.onMonitoringLayout.call(this)},onRegistrationLayout:function(){return c.fn.onRegistrationLayout.call(this)}}),f=l.extend({attachFilterEvt:function(){var o=this;l.fn.attachFilterEvt.call(o),o.getFilterViewModel(m.FILTER_NAME.STATUS).options.set("selectionChanged",function(e){var t=o.statusFilter=[],i=e.newValue,a=i.length;if(0===a)t.push(T.filter0Depth("representativeStatus","eq","none"));else if(a!==m.STATUS.length)for(var n=0;n<a;n++){var r=m.STATUS[i[n]-1].split(".")[1];switch(r){case"On":case"Off":t.push(T.filterStatusNoAlarm("operations","power",r,"alarms"));break;case"Critical":t.push(T.filter1Depth("alarms","alarms_type",r));break;case"Warning":t.push(T.filter1DepthNone("alarms","alarms_type",r))}}o.applyCurrentFilter()})}}),_={All:i,"AirConditioner.Indoor":t,AirConditionerOutdoor:a,ControlPoint:n,Meter:r,Light:o,"Sensor.Motion":l,"Sensor.Temperature_Humidity":s,Gateway:c,Beacon:p,SmartPlug:f,CCTV:u};return{getDeviceController:function(e){var t=_[e];return t||console.error("There is no controller for type : "+e),t}}}),define("device/common/device",["device/common/config/device-config","device/common/device-api","device/common/device-util","device/common/controller/device-controller"],function(c,e,t,a){"use strict";var p,u,n,g,r=window.MAIN_WINDOW,f=$("#device-tab-panel"),m=new window.CommonLoadingPanel,v=$("<div/>"),o=!1,T=function(e){},I=function(e){m.close();var t=e.tabLayout.key,i=a.getDeviceController(t);i&&(n=new i(e)),o?n.onFloorChanged(r.getCurrentFloor()):o=!0},E=function(e){n&&n.destroy(e)},C=function(e){n&&n.onFloorChanged(e)};return{init:function(e,t,i,a){m.open(),g=e,u=v.kendoCommonDialog().data("kendoCommonDialog");var n=c.getTabConfigList(t,i,a);if(n.length<1){var r=window.I18N;return u.message(r.prop("FACILITY_DEVICE_NO_INSTALLED_TYPES")),u.open(),m.close(),!1}(p=f.kendoDeviceTabPanel({tabLayouts:n}).data("kendoDeviceTabPanel")).bind("activate",I),p.bind("select",T),p.bind("destroy",E);var o=window.localStorage.getItem("deviceTypeTab"),l=0;if(o){window.localStorage.removeItem("deviceTypeTab");var s,d=n.length;for(s=0;s<d;s++)if(n[s].key==o){l=s;break}}g.on("onfloorchange",C),p.selectTab(l)}}}),define("devicesettings/deviceregistration/deviceregistration",["devicesettings/core","device/common/device"],function(e,t){"use strict";t.init(e,!1,!1,!0)});