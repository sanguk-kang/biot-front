define("energy/samsungsac/common/common",["energy/samsungsac/common/widget"],function(e){var a=window.Util,o=window.I18N,i=e.msgDialog,r=window.MAIN_WINDOW,l=window.moment;var n;return{MSG:{TXT_SELECT_ALL:"Select All",TXT_UNSELECT_ALL:"Deselect All",TXT_CREATE_SCHEDULE:"Create New Schedule",TXT_EDIT_SCHEDULE:"Edit Schedule",TXT_DELETE_SCHEDULE:"Do you want to delete the selected Schedule?",TXT_DELETE_EXCEPTIONAL_DAY:"Do you want to delete the selected Exceptional Day?",TXT_DELETE_SCHEDULE_RESULT:"The selected Schedule has been deleted",TXT_DELETE_SCHEDULE_MULTI_RESULT:"The selected {0} Schedule has been deleted",TXT_DELETE_EXCEPTIONAL_DAY_RESULT:"The selected Exceptional Day has been deleted",TXT_DELETE_EXCEPTIONAL_DAY_MULTI_RESULT:"The selected {0} Exceptional Day has been deleted",TXT_CREATE_SCHEDULE_CONFIRM:"Do you want to Create schedule?",TXT_CREATE_SCHEDULE_CLOSE_CONFIRM:"Do you want to close this window?\nThe contents are canceled when you close this window.",TXT_EDIT_SCHEDULE_CONFIRM:"Do you want to Edit schedule?",TXT_CANCEL_SCHEDULE_CONFIRM:"Do you want to cancel changes?",TXT_CREATE_SCHEDULE_RESULT:"Saved.",COMMON_MESSAGE_NOTI_CHANGES_SAVED:o.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED"),COMMON_CLOSE_WINDOW_CONFIRM:o.prop("COMMON_CLOSE_WINDOW_CONFIRM")},TEXT:{ENERGY_TEXT_AVERAGE_USED:o.prop("ENERGY_TEXT_AVERAGE_USED"),ENERGY_TEXT_AVERAGE_THERMO:o.prop("ENERGY_TEXT_AVERAGE_THERMO"),ENERGY_TEXT_OUTDOOR_TEMPERATURE:o.prop("ENERGY_TEXT_OUTDOOR_TEMPERATURE"),ENERGY_TEXT_OPERATING_RATE:o.prop("ENERGY_TEXT_OPERATING_RATE"),ENERGY_TEXT_GAS_USAGE:o.prop("ENERGY_TEXT_GAS_USAGE"),ENERGY_TEXT_POWER_USAGE:o.prop("ENERGY_TEXT_POWER_USAGE"),ENERGY_TEXT_DATE:o.prop("ENERGY_TEXT_DATE"),ENERGY_TEXT_ON_DEVICE_RATE:o.prop("ENERGY_TEXT_ON_DEVICE_RATE"),ENERGY_GIRD_TOTAL:o.prop("ENERGY_GIRD_TOTAL"),COMMON_TOTAL:o.prop("ENERGY_TOTAL"),ENERGY_AVERAGE:o.prop("ENERGY_AVERAGE"),COMMON_DATE:o.prop("COMMON_DATE"),COMMON_TIME:o.prop("COMMON_TIME"),FACILITY_DEVICE_OUTDOOR_TEMPERATURE:o.prop("FACILITY_DEVICE_OUTDOOR_TEMPERATURE"),ENERGY_OPERATION_RATE:o.prop("ENERGY_OPERATION_RATE"),ENERGY_OPERATING_RATE:o.prop("ENERGY_OPERATING_RATE"),ENERGY_ON_DEVICE_RATE:o.prop("ENERGY_ON_DEVICE_RATE"),ENERGY_GAS_USAGE:o.prop("ENERGY_GAS_USAGE"),ENERGY_AVERAGE_USED_TIME:o.prop("ENERGY_AVERAGE_USED_TIME"),ENERGY_AVERAGE_THERMO_ON_TIME:o.prop("ENERGY_AVERAGE_THERMO_ON_TIME"),ENERGY_POWER_USAGE:o.prop("ENERGY_POWER_USAGE"),ENERGY_THERMO_ON_TIME_MIN:o.prop("ENERGY_THERMO_ON_TIME_MIN"),ENERGY_USED_TIME_MIN:o.prop("ENERGY_USED_TIME_MIN"),ENERGY_CURRENT_DEMAND:o.prop("ENERGY_CURRENT_DEMAND"),ENERGY_TARGET_DEMAND:o.prop("ENERGY_TARGET_DEMAND"),ENERGY_NUMBER_OF_LOSS_DETECTION:o.prop("ENERGY_NUMBER_OF_LOSS_DETECTION"),ENERGY_LIST_ENERGY_LOSS_DETECTION:o.prop("ENERGY_LIST_ENERGY_LOSS_DETECTION"),ENERGY_TOP_FIVE:o.prop("ENERGY_TOP_FIVE"),ENERGY_DATE_OF_EVENT:o.prop("ENERGY_DATE_OF_EVENT"),ENERGY_ENERGY_LOSS_NAME:o.prop("ENERGY_ENERGY_LOSS_NAME"),ENERGY_RANK:o.prop("ENERGY_RANK"),ENERGY_TYPE:o.prop("ENERGY_TYPE"),ENERGY_DEVICE_NAME:o.prop("ENERGY_DEVICE_NAME"),ENERGY_COUNT:o.prop("ENERGY_COUNT"),ENERGY_LOCATION:o.prop("ENERGY_LOCATION"),ENERGY_ESTIMATE_LINE:o.prop("ENERGY_ESTIMATE_LINE"),ENERGY_PEAK_LEVEL:o.prop("ENERGY_PEAK_LEVEL"),ENERGY_TIME_HOUR:o.prop("ENERGY_TIME_HOUR"),ENERGY_THERMO_ON_TIME:o.prop("ENERGY_THERMO_ON_TIME"),ENERGY_USED_TIME:o.prop("ENERGY_USED_TIME"),ENERGY_ON_DEVICE_RATE_TEXT:o.prop("ENERGY_ON_DEVICE_RATE_TEXT"),ENERGY_LOSS:o.prop("ENERGY_LOSS"),FACILITY_DEVICE_DEVICE_NAME_ALL:o.prop("FACILITY_DEVICE_DEVICE_NAME_ALL"),ENERGY_ALL_ZONE:o.prop("ENERGY_ALL_ZONE"),ENERGY_ZONE_COUNT:o.prop("ENERGY_ZONE_COUNT"),ENERGY_CATEGORY:o.prop("ENERGY_CATEGORY"),ENERGY_DEVICE:o.prop("ENERGY_DEVICE"),ENERGY_ALL_DEVICE_NAME:o.prop("ENERGY_ALL_DEVICE_NAME"),ENERGY_INSUFFICIENT_INSULATION:o.prop("ENERGY_INSUFFICIENT_INSULATION"),ENERGY_LONG_TIME_OPERATION:o.prop("ENERGY_LONG_TIME_OPERATION"),ENERGY_ABNORMAL_SET_TEMP:o.prop("ENERGY_ABNORMAL_SET_TEMP"),ENERGY_REPETITIVE_CONTROL:o.prop("ENERGY_REPETITIVE_CONTROL"),ENERGY_LOAD_VARIATION:o.prop("ENERGY_LOAD_VARIATION"),ENERGY_ABNORMAL_CURRENT_TEMP:o.prop("ENERGY_ABNORMAL_CURRENT_TEMP"),ENERGY_OVER_TIME_OPERATION:o.prop("ENERGY_OVER_TIME_OPERATION"),ENERGY_OPERATING_TIME:o.prop("ENERGY_OPERATING_TIME"),ENERGY_POWER_GAS_USAGE:o.prop("ENERGY_POWER_GAS_USAGE"),ENERGY_DATE_MON:o.prop("ENERGY_DATE_MON"),ENERGY_DATE_TUE:o.prop("ENERGY_DATE_TUE"),ENERGY_DATE_WED:o.prop("ENERGY_DATE_WED"),ENERGY_DATE_THU:o.prop("ENERGY_DATE_THU"),ENERGY_DATE_FRI:o.prop("ENERGY_DATE_FRI"),ENERGY_DATE_SAT:o.prop("ENERGY_DATE_SAT"),ENERGY_DATE_SUN:o.prop("ENERGY_DATE_SUN"),COMMON_BTN_DETAIL:o.prop("COMMON_BTN_DETAIL"),ENERGY_INQUIRED_PERIOD:o.prop("ENERGY_INQUIRED_PERIOD"),ENERGY_INQUIRY_TARGET:o.prop("ENERGY_INQUIRY_TARGET"),ENERGY_ALL_DEVICE_GROUP:o.prop("ENERGY_ALL_DEVICE_GROUP"),ENERGY_NUMBER_OF_GROUP:o.prop("ENERGY_NUMBER_OF_GROUP"),ENERGY_CONDITION_SETTING:o.prop("ENERGY_CONDITION_SETTING"),ENERGY_DEVICE_COUNT:o.prop("ENERGY_DEVICE_COUNT")},groupFilterDataSource:(n=[],$.ajax({url:"/dms/groups"}).done(function(e){for(var t=0;t<e.length;t++)0<e[t].dms_devices_ids.length&&n.push({text:e[t].name,value:String(e[t].id)})}).fail(function(e){var t=a.parseFailResponse(e);i.message(t),i.open()}).always(function(){}),n),getFloorQuery:function(e,t){var a="?";return(e=e||r.getCurrentFloor()).building.id!=r.FLOOR_NAV_BUILDING_TOTAL_ID&&(a+="foundation_space_buildings_id="+e.building.id+"&"),e.floor.id!=r.FLOOR_NAV_FLOOR_ALL_ID&&(a+="foundation_space_floors_id="+e.floor.id),("?"!=a&&-1!=a.indexOf("foundation_space_floors_id")||!t)&&a},getMonthDay:function(e,t,a){var i=void 0===a,r=new Date(e,t,0).getDate(),n=[];if(i)for(var o=1;o<=r;o++)1==String(o).length?n.push("0"+o):n.push(o);else for(var l=1;l<=r;l++)n.push(l);return n},getChartXAxisLabel:function(e,t){var a,i,r=[];if("runtime"===e){var n;for(i=15,a=0;a<=i;a++)n=a,n=o.prop("ENERGY_MITUTE",n),r.push(n);return r}if("day"===e)if("24Hour"===window.GlobalSettings.getTimeDisplay())for(a=0;a<24;a++)r[a]=o.prop("ENERGY_CHART_TIME_HOUR",a);else r=["12 AM","1 AM","2 AM","3 AM","4 AM","5 AM","6 AM","7 AM","8 AM","9 AM","10 AM","11 AM","12 PM","1 PM","2 PM","3 PM","4 PM","5 PM","6 PM","7 PM","8 PM","9 PM","10 PM","11 PM"];else if("month"===e)for(i=l(t).daysInMonth(),a=1;a<=i;a++)r.push(l(a,"DD").format("Do"));else if("year"===e)for(i=12,a=1;a<=i;a++)r.push(l(a,"MM").format("MMM"));return r},maxValueReturn:function(e){if(!e)return 1;var t=e.reduce(function(e,t){return t<e?e:t});return Math.ceil(t)},minValueReturn:function(e){if(!e)return 1;var t=e.reduce(function(e,t){return t<e?t:e});return Math.ceil(t)},chartMajorUnit:function(e,t){return t?a.convertNumberFormat(e/5):Math.floor(e/5)},checkListLength:function(e,t,a){if(t instanceof Array!=!1&&!(t.length>=e)){var i=a||void 0,r=e-t.length;t.length>e&&(r=t.length-e);for(var n=0;n<r;n++)t.push(i);return t}}}}),define("energy/samsungsac/common/widget",[],function(){var e=$("<div/>"),t=$("<div/>");return{createNewWidget:function(e,t,a){return new t($("<div/>").attr("id",e),a)},msgDialog:e.kendoCommonDialog().data("kendoCommonDialog"),confirmDialog:t.kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog")}}),define("energy/samsungsac/template/detection-template",[],function(){return{scheduleActivatedTemplate:function(e){return"<span class='panel-item-temp schedule-status'><span>"+(e.activated?"Operating":"Pause")+"</span></span>"}}}),define("energy/samsungsac/template/monitoring-template",[],function(){return{scheduleActivatedTemplate:function(e){return"<span class='panel-item-temp schedule-status'><span>"+(e.activated?"Operating":"Pause")+"</span></span>"}}}),define("energy/samsungsac/template/operating-template",[],function(){return{scheduleActivatedTemplate:function(e){return"<span class='panel-item-temp schedule-status'><span>"+(e.activated?"Operating":"Pause")+"</span></span>"}}}),define("energy/samsungsac/view-model/detection-vm",[],function(){var e,t,a=window.kendo,i=window.moment,r=window.Util,n=[{text:"WattHour",value:"Meter.WattHour"},{text:"Gas",value:"Meter.Gas"},{text:"Water",value:"Meter.Water"},{text:"Calori",value:"Meter.Calori"}];for(e=n.length-1;0<=e;e--)t=(t=n[e]).value,r.isInstalledType(t)||n.splice(e,1);return{MainViewModel:a.observable({graphBtn:{active:!1,disabled:!1,click:function(){}},listBtn:{active:!1,disabled:!1,click:function(){}},dayBtn:{active:!1,disabled:!1,click:function(){}},monthBtn:{active:!1,disabled:!1,click:function(){}},yearBtn:{active:!1,disabled:!1,click:function(){}},formattedDate:i().format("L").replace(/\./gi,"-"),nextBtn:{active:!1,disabled:!1,click:function(){}},prevBtn:{active:!1,disabled:!1,click:function(){}}}),typeQuery:["Meter.*"]}}),define("energy/samsungsac/view-model/monitoring-vm",[],function(){var e,t,a=window.Util,i=window.kendo,r=window.moment,n=window.I18N,o=[{text:"WattHour",value:"Meter.WattHour"},{text:"Gas",value:"Meter.Gas"},{text:"Water",value:"Meter.Water"},{text:"Calori",value:"Meter.Calori"}];for(e=o.length-1;0<=e;e--)t=(t=o[e]).value,a.isInstalledType(t)||o.splice(e,1);return{MainViewModel:i.observable({graphBtn:{active:!0,disabled:!1,click:function(){}},listBtn:{active:!1,disabled:!1,click:function(){}},nextBtn:{active:!1,disabled:!1,click:function(){}},prevBtn:{active:!1,disabled:!1,click:function(){}},monthBtn:{active:!1,disabled:!1,click:function(){}},dayBtn:{active:!1,disabled:!1,click:function(){}},runtimeBtn:{active:!1,disabled:!1,click:function(){}},formmatedDate:r().format("L").replace(/\./gi,"-"),filters:[{type:"dropdownlist",id:"group-list-demand",disabled:!1,invisible:!1,options:{optionLabel:n.prop("ENERGY_DEVICE_NAME"),dataTextField:"text",dataValueField:"value",animation:!1,dataSource:[],open:function(){},close:function(){},change:function(){},select:function(){}}}]}),typeFilterDataSource:o,typeFilterText:{"Meter.WattHour":"WattHour","Meter.Gas":"Gas","Meter.Water":"Water","Meter.Calori":"Calori"},typeQuery:["Meter.*"],Views:{graph:{view:null,widget:null,routeUrl:"/monitoring/graph"},list:{view:null,widget:null,routeUrl:"/monitoring/list"}}}}),define("energy/samsungsac/view-model/operating-vm",["energy/core","energy/samsungsac/common/common"],function(e,t){var a,i,r=window.Util,n=window.kendo,o=window.moment,l=[{text:"WattHour",value:"Meter.WattHour"},{text:"Gas",value:"Meter.Gas"},{text:"Water",value:"Meter.Water"},{text:"Calori",value:"Meter.Calori"}],s=t.TEXT;for(a=l.length-1;0<=a;a--)i=(i=l[a]).value,r.isInstalledType(i)||l.splice(a,1);for(var d=[],c=t.groupFilterDataSource,u=0;u<c.length;u++){var p=c[u];d[u]={text:p[u].text,value:p[u].value}}return{MainViewModel:n.observable({graphBtn:{active:!1,disabled:!1,click:function(){}},listBtn:{active:!1,disabled:!1,click:function(){}},monthBtn:{active:!1,disabled:!1,click:function(){}},yearBtn:{active:!1,disabled:!1,click:function(){}},nextBtn:{active:!1,disabled:!1,click:function(){}},prevBtn:{active:!1,disabled:!1,click:function(){}},formattedDate:o().format("L").replace(/\./gi,"-"),filters:[{type:"dropdownlist",id:"device-type-list",disabled:!1,invisible:!1,options:{dataTextField:"text",optionLabel:s.ENERGY_CATEGORY,dataValueField:"value",animation:!1,dataSource:[{text:s.ENERGY_OPERATING_TIME,value:"operationTime"},{text:s.ENERGY_POWER_GAS_USAGE,value:"powerGasUsage"},{text:s.ENERGY_OPERATING_RATE,value:"operatingRate"}],open:function(){},close:function(){},change:function(){},select:function(){}}},{type:"dropdowncheckbox",id:"all-zone-list",disabled:!1,invisible:!1,options:{virtual:!1,optionLabel:!1,value:null,emptyText:s.ENERGY_ALL_ZONE,showSelectAll:!0,selectAllText:s.ENERGY_ALL_ZONE,dataTextField:"name",dataValueField:"id",animation:!1,dataSource:[],height:230,applyBox:!0,isAbleUnselectAll:!0,open:function(){},close:function(e){e&&e.sender.list.hasClass("k-state-border-up")&&0<this.preventCloseCnt&&(e.preventDefault(),this.preventCloseCnt--)},change:function(){},select:function(e){e&&e.item.hasClass("k-state-disabled")&&(e.preventDefault(),this.preventCloseCnt=2)}}},{type:"dropdowncheckbox",id:"group-list",disabled:!1,invisible:!1,options:{virtual:!0,optionLabel:!1,value:null,emptyText:s.FACILITY_DEVICE_DEVICE_NAME_ALL,showSelectAll:!0,selectAllText:s.FACILITY_DEVICE_DEVICE_NAME_ALL,dataTextField:"name",dataValueField:"id",animation:!1,dataSource:[],height:230,applyBox:!0,cancelOption:!0,open:function(){},close:function(e){},change:function(){},select:function(e){}}}],exportBtn:{active:!0,disabled:!1,click:function(){}}}),Views:{graph:{view:null,widget:null,routeUrl:"/operating/graph"},list:{view:null,widget:null,routeUrl:"/operating/list"}},typeFilterDataSource:l,groupFilterDataSource:d,typeFilterText:{"Meter.WattHour":"WattHour","Meter.Gas":"Gas","Meter.Water":"Water","Meter.Calori":"Calori"},typeQuery:["Meter.*"]}}),define("energy/samsungsac/view-model/distribution-vm",[],function(){var e=window.kendo,t=window.I18N,a=window.util,i="{0:n1}";return{MainViewModel:e.observable({viewBtn:{click:function(){}},exportBtn:{disabeld:!1,click:function(){}}}),gridOptions:{dataSource:[],height:"calc(100% - 6px)",scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!1,toolbar:["excel"],excel:{allPages:!0},columns:[{title:t.prop("ENERGY_GROUP"),field:"dmsGroupName"},{title:t.prop("ENERGY_GRID_DISTRIBUTION_DVM"),columns:[{title:t.prop("ENERGY_GRID_DISTRIBUTION_POWER")+"<br/>("+a.CHAR.WattHour+")",field:"dvmPower",format:i},{title:t.prop("ENERGY_GRID_DISTRIBUTION_GAS")+"<br/>("+a.CHAR.Gas+")",field:"dvmGas",format:i}]},{title:t.prop("ENERGY_GRID_DISTRIBUTION_PUMP"),columns:[{title:t.prop("ENERGY_GRID_DISTRIBUTION_POWER")+"<br/>("+a.CHAR.WattHour+")",field:"pumpPower",format:i}]},{title:t.prop("ENERGY_GRID_DISTRIBUTION_COOLINGTOWER"),columns:[{title:t.prop("ENERGY_GRID_DISTRIBUTION_POWER")+"<br/>("+a.CHAR.WattHour+")",field:"coolingTowerPower",format:i}]},{title:t.prop("ENERGY_GRID_DISTRIBUTION_BOILER"),columns:[{title:t.prop("ENERGY_GRID_DISTRIBUTION_GAS")+"<br/>("+a.CHAR.Gas+")",field:"boilerGas",format:i}]},{title:t.prop("ENERGY_GRID_DISTRIBUTION_WATERTANK"),columns:[{title:t.prop("ENERGY_GRID_DISTRIBUTION_WATER")+"<br/>(m\xb3)",field:"waterTank",format:i}]},{title:t.prop("ENERGY_TOTAL"),columns:[{title:t.prop("ENERGY_GRID_DISTRIBUTION_POWER")+"<br/>("+a.CHAR.WattHour+")",field:"totalPower",format:i},{title:t.prop("ENERGY_GRID_DISTRIBUTION_WATER")+"<br/>(m\xb3)",field:"totalWater",format:i},{title:t.prop("ENERGY_GRID_DISTRIBUTION_GAS")+"<br/>("+a.CHAR.Gas+")",field:"totalGas",format:i}]}]}}}),define("energy/samsungsac/model/detection-model",function(){"use strict";return{Model:window.kendo.data.Model.define({id:"id",fields:{name:{name:"Name"},description:{name:"Description"},activated:{name:"Activation",type:"boolean"},startDate:{name:"Start Date",type:"date"},endDate:{name:"End Date",type:"date"},daysOfWeek:{name:"Repeat Days",type:"object",defaultValue:[]},exceptionalDays:{name:"Execeptional Days",type:"object",defaultValue:[]},executionTimes:{name:"Execution Time",type:"object",defaultValue:[]},devices:{name:"Devices",type:"object",defaultValue:[]},control:{name:"Operations",type:"object",defaultValue:{}}}}),targetData:{},lastYearData:{},thisYearData:{}}}),define("energy/samsungsac/model/monitoring-model",[],function(){"use strict";return{Model:window.kendo.data.Model.define({id:"id",fields:{name:{name:"Name"},description:{name:"Description"},activated:{name:"Activation",type:"boolean"},startDate:{name:"Start Date",type:"date"},endDate:{name:"End Date",type:"date"},daysOfWeek:{name:"Repeat Days",type:"object",defaultValue:[]},exceptionalDays:{name:"Execeptional Days",type:"object",defaultValue:[]},executionTimes:{name:"Execution Time",type:"object",defaultValue:[]},devices:{name:"Devices",type:"object",defaultValue:[]},control:{name:"Operations",type:"object",defaultValue:{}}}}),targetData:{},lastYearData:{},thisYearData:{}}}),define("energy/samsungsac/model/operating-model",[],function(){"use strict";return{Model:window.kendo.data.Model.define({id:"id",fields:{name:{name:"Name"},description:{name:"Description"},activated:{name:"Activation",type:"boolean"},startDate:{name:"Start Date",type:"date"},endDate:{name:"End Date",type:"date"},daysOfWeek:{name:"Repeat Days",type:"object",defaultValue:[]},exceptionalDays:{name:"Execeptional Days",type:"object",defaultValue:[]},executionTimes:{name:"Execution Time",type:"object",defaultValue:[]},devices:{name:"Devices",type:"object",defaultValue:[]},control:{name:"Operations",type:"object",defaultValue:{}}}}),modelData:[],temperatureData:[],targetData:[],createDataSource:function(e){return e}}}),define("energy/samsungsac/model/distribution-model",[],function(){window.moment;function c(e){var t=e.getFullYear(),a=e.getMonth(),i=e.getDate();return t+"-"+(a=r.toString(a+1,"00"))+"-"+(i=r.toString(i,"00"))}var u=window.I18N,r=window.kendo,n={dmsGroupId:1001,dmsGroupName:"Group 1",dvmPower:1e3,dvmGas:1e3,pumpPower:1e3,coolingTowerPower:1e3,boilerGas:1e3,waterTank:1e3,totalPower:1e3,totalWater:1e3,totalGas:1e3};return{MockData:[{dmsGroupId:1001,dmsGroupName:"Group 1",dvmPower:1234.123,dvmGas:1234.123,pumpPower:1234.123,coolingTowerPower:1234.123,boilerGas:1234.123,waterTank:1234.123,totalPower:1234.123,totalWater:1234.123,totalGas:1234.123},{dmsGroupId:1002,dmsGroupName:"Group 2",dvmPower:1.1,dvmGas:1.01,pumpPower:0,coolingTowerPower:20.002,boilerGas:302.33,totalPower:1231231.12,totalWater:1e3,totalGas:1e3},{dmsGroupId:1003,dmsGroupName:"Group 3",dvmPower:1e3,dvmGas:1e3,pumpPower:1e3,coolingTowerPower:1e3,boilerGas:1e3,waterTank:1e3,totalWater:1e3,totalGas:1e3}],createDataSource:function(e){var t,a,i=e.length;for(t=0;t<i;t++)for(a in n)void 0===e[t][a]&&(e[t][a]="-");return new r.data.DataSource({data:e})},createExcelContent:function(e,t,a){var i,r,n=c(e),o=c(t),l=a.rows.filter(function(e){return"data"==e.type}).length,s=[{cells:[{background:"#fff",colSpan:3,color:"#333",rowSpan:1,value:""}]},{cells:[{background:"#fff",colSpan:2,color:"#333",rowSpan:1,value:u.prop("FACILITY_GROUP_ENERGY_DISTRIBUTION_GROUP")}]},{cells:[{background:"#7a7a7a",colSpan:1,color:"#fff",rowSpan:2,value:u.prop("ENERGY_INQUIRY_TARGET")},{background:"#fff",colSpan:2,color:"#333",rowSpan:1,value:u.prop("ENERGY_NUMBER_OF_GROUP")+" : "+l}]},{cells:[{background:"#7a7a7a",colSpan:1,color:"#fff",rowSpan:1,value:u.prop("ENERGY_INQUIRED_PERIOD")},{background:"#fff",colSpan:2,color:"#333",rowSpan:1,value:n+"~"+o}]}],d=0;for(d=a.rows[1].cells.length,i=0;i<d;i++)a.rows[1].cells[i].value=a.rows[1].cells[i].value.replace("<br/>","");for(d=s.length,i=0;i<d;i++)a.rows.unshift(s[i]);for(a.freezePane.rowSplit=1,a.columns=[{autoWidth:!0},{width:130},{width:130},{width:80},{width:80},{width:80},{width:80},{width:80},{width:80},{width:80}],i=0;i<a.rows.length;i++){for(r=0;r<a.rows[i].cells.length;r++)a.rows[i].cells[r].verticalAlign="center",a.rows[i].cells[r].textAlign="center";if(void 0!==a.rows[i].type&&"data"==a.rows[i].type)for(r=1;r<a.rows[i].cells.length;r++)a.rows[i].cells[r].format="#,###0.0"}}}}),define("energy/samsungsac/monitoring",["energy/core","energy/samsungsac/view-model/monitoring-vm","energy/samsungsac/common/common","energy/samsungsac/common/widget"],function(e,t,p,i){var r,n,o,l,s,E,h,d,c=window.moment,u=window.kendo,a=window.CommonLoadingPanel,T=window.Util,m=window.MAIN_WINDOW,_=window.I18N,b=new a,D=t.MainViewModel,w=t.Views,g=new u.Router,v=new u.Layout("<div id='monitoring-main-view-content' class='monitoring-main-view-content'></div>"),N=p.TEXT,f=p.getMonthDay,A=$("#monitoring-main-view"),y=i.msgDialog,R=null,L="Runtime",C={0:"#afaeae",1:"#1aa05a",2:"#fbb248",3:"#ee5151"},S=function(){},I=function(e){g.bind("init",k);var t=O(e),a=M(t);E=$("#operating-common-tab-2").height()-203,h=$("#operating-common-tab-2").height()-164,w.graph.widget=V(a),w.graph.view=new u.View(w.graph.widget.wrapper),g.route(w.graph.routeUrl,G.bind(g,w.graph.view)),w.list.widget=H(a),w.list.view=new u.View(w.list.widget.wrapper),g.route(w.list.routeUrl,G.bind(g,w.list.view)),g.start(),D.graphBtn.click()},O=function(e){var t={runtime:function(){return 16},hourly:function(){return 24},daily:function(){var e=D.formmatedDate.split("-");return new Date(e[0],e[1],0).getDate()}},a=null;a=e?Object.keys(e)[0]:null;var i={};i.dataName=a,i.min=e&&"min"in e?e.min:null,i.max=e&&"max"in e?e.max:null;var r,n,o,l=[],s=0;if("runtime"==a&&e[a]&&0<e[a].length){for(l=e[a],s=t[a](),i.currentDemand=[],i.estimateDemand=[],i.peakLevel=[],i.syncTime=[],i.targetDemand=[],r=0;r<s;r++)i.currentDemand.push(null),i.estimateDemand.push(null),i.peakLevel.push(null),i.syncTime.push(null),i.targetDemand.push(null);for(r=0;r<l.length;r++)n=l[r].syncTime.split(":"),o=Number(n[n.length-2]),i.currentDemand[o]=l[r].currentDemand,i.estimateDemand[o]=l[r].estimateDemand,i.peakLevel[o]=C[l[r].peakLevel],i.syncTime[o]=l[r].syncTime,i.targetDemand[o]=l[r].targetDemand}if("hourly"==a&&e[a]&&0<e[a].length){for(l=e[a],s=t[a](),i.time=[],i.currentDemand={"00":[],15:[],30:[],45:[]},i.targetDemand=[],i.peakLevel0=[],i.peakLevel1=[],i.peakLevel2=[],i.peakLevel3=[],r=0;r<s;r++)i.time.push(null),i.peakLevel0.push(null),i.peakLevel1.push(null),i.peakLevel2.push(null),i.peakLevel3.push(null),i.currentDemand["00"].push(null),i.currentDemand[15].push(null),i.currentDemand[30].push(null),i.currentDemand[45].push(null);for(r=0;r<l.length;r++){n=l[r].time.split(":"),o=Number(n[0]),i.time[o]=l[r].time;var d=Number(n[0]);"00"==n[1]?(i.currentDemand["00"][d]=l[r].currentDemand,i.peakLevel0[o]=C[l[r].peakLevel]):"15"==n[1]?(i.currentDemand[15][d]=l[r].currentDemand,i.peakLevel1[o]=C[l[r].peakLevel]):"30"==n[1]?(i.currentDemand[30][d]=l[r].currentDemand,i.peakLevel2[o]=C[l[r].peakLevel]):"45"==n[1]?(i.currentDemand[45][d]=l[r].currentDemand,i.peakLevel3[o]=C[l[r].peakLevel]):i.targetDemand.push(null),i.targetDemand[o]=l[r].targetDemand}}if("daily"==a&&e[a]&&0<e[a].length){for(l=e[a],s=t[a](),i.date=[],i.currentDemand=[],i.targetDemand=[],i.peakLevel=[],r=0;r<s;r++)i.date.push(null),i.currentDemand.push(null),i.targetDemand.push(null),i.peakLevel.push(null);for(r=0;r<l.length;r++)n=l[r].date.split("-"),o=Number(n[n.length-1])-1,i.date[o]=l[r].date,i.currentDemand[o]=l[r].currentDemand,i.targetDemand[o]=l[r].targetDemand,i.peakLevel[o]=C[l[r].peakLevel]}return i},M=function(t){var e,a=D.formmatedDate,i=(a.split("-"),t.dataName),r=[],n=[],o=[],l=T.getChartOptionsForFiveChartSection(function(e){var t,a=[];if(e){for(var i in e){var r=e[i];a.push(r)}a.sort(function(e,t){return t-e}),t=1.2*a[0]}else t=1;return t}(t.max),0);if(l.newMax||(l.newMax=1),D.runtimeBtn.get("active")?i="runtime":D.dayBtn.get("active")?i="hourly":D.monthBtn.get("active")&&(i="daily"),"runtime"==i)o.push({type:"line",data:t.estimateDemand,name:"estimateDemand",color:"#333333",axis:"energy",categoryAxis:"runtime",markers:{size:0,background:"#333333",border:{width:0,color:"#333333"},highlight:{line:{width:0}}},peakValue:null,select:!1}),r.push({name:"energy",min:0,max:l.newMax,majorUnit:l.newMajorUnit,majorGridLines:{visible:!1},labels:{template:function(e){return T.convertNumberFormat(e.value)}}}),n.push({name:"runtime",categories:p.getChartXAxisLabel("runtime"),select:!1});else if("hourly"==i){r.push({name:"energy",min:0,max:l.newMax,majorUnit:l.newMajorUnit,majorGridLines:{visible:!1},labels:{template:function(e){return T.convertNumberFormat(e.value)}}});var s=p.getChartXAxisLabel("day");n.push({name:"hourly",select:!1,categories:s})}else if("daily"==i){r.push({name:"energy",min:0,max:l.newMax,majorUnit:l.newMajorUnit,majorGridLines:{visible:!1},labels:{template:function(e){return T.convertNumberFormat(e.value)}}});var d=p.getChartXAxisLabel("month",a);n.push({name:"daily",categories:d,select:!1})}var c=[];if(t.targetDemand&&Array.isArray(t.targetDemand))for(e=0;e<t.targetDemand.length;e++)c.push({open:t.targetDemand[e],high:t.targetDemand[e],low:t.targetDemand[e],close:t.targetDemand[e]});if("hourly"==i&&t.currentDemand?o=[{type:"column",data:t.currentDemand["00"],name:"currentDemand1",color:function(e){return t.peakLevel0[e.index]},axis:"energy",categoryAxis:i,peakValue:t.peakLevel0},{type:"column",data:t.currentDemand[15],name:"currentDemand2",color:function(e){return t.peakLevel1[e.index]},axis:"energy",categoryAxis:i,peakValue:t.peakLevel1},{type:"column",data:t.currentDemand[30],name:"currentDemand3",color:function(e){return t.peakLevel2[e.index]},axis:"energy",categoryAxis:i,peakValue:t.peakLevel2},{type:"column",data:t.currentDemand[45],name:"currentDemand4",color:function(e){return t.peakLevel3[e.index]},axis:"energy",categoryAxis:i,peakValue:t.peakLevel3}]:o.push({type:"column",data:t.currentDemand,name:"currentDemand",color:function(e){return t.peakLevel[e.index]},axis:"energy",categoryAxis:i,peakValue:t.peakLevel}),o.push({type:"ohlc",data:c,name:"targetDemand",color:"#2c81db",categoryAxis:i,axis:"energy",gap:0,highlight:{line:{width:1}},peakValue:null}),!t.dataName&&!Array.isArray(t.dataName)){var u=[];if(n[0])for(e=0;e<n[0].categories.length;e++)u.push(null);o=u}return{seriesData:o,categoryAxis:n,valueAxis:r}},k=function(){v.render(A)},G=function(e){v.showIn("#monitoring-main-view-content",e)},x=function(){D.set("setDateView",c().format(D.formmatedDate)),D.nextBtn.set("click",function(){var e=z(D.formmatedDate,1);D.runtimeBtn.get("active")||(D.set("formmatedDate",c().format(e)),W(),X(),j(),U())}),D.prevBtn.set("click",function(){var e=z(D.formmatedDate,-1);D.runtimeBtn.get("active")||(D.set("formmatedDate",c().format(e)),W(),X(),j(),U())}),D.monthBtn.set("click",function(){L="Month",D.dayBtn.set("active",!1),D.runtimeBtn.set("active",!1),1!=D.monthBtn.get("active")&&(D.monthBtn.set("active",!0),$(".monitoring-content").find(".operating-view-btn").show(),D.set("formmatedDate",c().format(e("month"))),$(".monitoring-chart-legend").find(".chart-legend-content-list").find(".item.estimate").hide(),l&&clearInterval(l),s&&clearInterval(s),D.nextBtn.set("disabled",!1),D.prevBtn.set("disabled",!1),j(),U())}),D.dayBtn.set("click",function(){L="Day",D.monthBtn.set("active",!1),D.runtimeBtn.set("active",!1),1!=D.dayBtn.get("active")&&(D.set("formmatedDate",c().format(e("day"))),D.dayBtn.set("active",!0),$(".monitoring-content").find(".operating-view-btn").show(),$(".monitoring-chart-legend").find(".chart-legend-content-list").find(".item.estimate").hide(),D.nextBtn.set("disabled",!1),D.prevBtn.set("disabled",!1),j(),X(),U())}),D.runtimeBtn.set("click",function(){L="Runtime",D.monthBtn.set("active",!1),D.dayBtn.set("active",!1),1!=D.runtimeBtn.get("active")&&(D.set("formmatedDate",c(new Date).format("L").replace(/\./gi,"-")),D.runtimeBtn.set("active",!0),$(".monitoring-content").find(".operating-view-btn").hide(),$(".monitoring-chart-legend").find(".chart-legend-content-list").find(".item.estimate").show(),D.nextBtn.set("disabled",!0),D.prevBtn.set("disabled",!0),X(),U())}),D.graphBtn.set("click",function(){1!=D.graphBtn.get("active")&&(D.runtimeBtn.set("disabled",!1),$(".monitoring-content .monitoring-chart-legend-content").show(),$(".monitoring-grid-top").hide(),B(),U())}),D.listBtn.set("click",function(){1!=D.listBtn.get("active")&&(D.runtimeBtn.set("disabled",!0),$(".monitoring-content .monitoring-chart-legend-content").hide(),$(".monitoring-grid-top").show(),Y(),U())}),$("#group-list-demand").data("kendoDropDownList").bind("change",function(){X(),U()});var e=function(e){var t,a="",i=D.setDateView.split("-");return"year"==e&&(a=i[0]),"month"==e&&(a=i[0]+"-"+i[1]),"day"==e&&(a=i[0]+"-"+i[1]+"-"+i[2],(t=f(i[0],i[1]).length)<i[2]&&(i[2]=t,a=i[0]+"-"+i[1]+"-"+i[2])),a};$("#main-sidebar-menu .btn-box").off("click",".btn",P).on("click",".btn",P),d.bind("show",function(e){"demandmonitoring"===$(e.item).data("role")&&P()})},P=function(e){w.graph.widget.setOptions({chartArea:{width:$("#operating-common-tab-2").width()}})},B=function(){D.graphBtn.set("active",!0),D.listBtn.set("active",!1),g.navigate(w.graph.routeUrl)},Y=function(){D.listBtn.set("active",!0),D.graphBtn.set("active",!1),g.navigate(w.list.routeUrl)},U=function(){var c,u,p,m,g,v,e,f=D.formmatedDate.split("-"),t=$("#group-list-demand").data("kendoDropDownList").value();0==$(".monitoring-content").find(".operating-tab-top-content").find(".k-button.active").index()?e="/energy/sac/demandMonitoring/runtime?dms_device_id="+t:(3==f.length&&(c="hourly",e="/energy/sac/demandMonitoring?year="+f[0]+"&month="+f[1]+"&day="+f[2]+"&dms_device_id="+t),2==f.length&&(c="daily",e="/energy/sac/demandMonitoring?year="+f[0]+"&month="+f[1]+"&dms_device_id="+t)),b.open(),$.ajax({url:e}).done(function(e){e||(u=[]),u=e}).fail(function(e){var t;t=0==e.status?_.prop("COMMON_ERROR_DISCONNECTED_TITLE")+"\n"+(t=_.prop("DCOMMON_ERROR_DISCONNECTED_MSG")):T.parseFailResponse(e),y.message(t),y.open()}).always(function(){var e,t,a,i;if(b.close(),3==f.length&&(c="hourly"),2==f.length&&(c="daily"),0==$(".monitoring-content").find(".operating-tab-top-content").find(".k-button.active").index()&&(c="runtime"),g=!!u&&c,p=O(u),"runtime"==g?(m=M(p),v=[]):"daily"!=c&&"hourly"!=c||(m=M(p),v=[],"daily"==c?v=[{field:"date",title:N.COMMON_DATE,attributes:{"data-name":"date"},width:100,format:"",editable:!1,sortable:!0,template:F.date}]:"hourly"==c&&(v=[{field:"time",title:N.COMMON_TIME,attributes:{"data-name":"time"},width:100,format:"",editable:!1,template:F.time}]),v.push({field:"currentDemand",title:N.ENERGY_CURRENT_DEMAND+"(kW)",attributes:{"data-name":"currentDemand"},width:100,format:"",editable:!1,template:F.currentDemand}),v.push({field:"targetDemand",title:N.ENERGY_TARGET_DEMAND+"(kW)",attributes:{"data-name":"targetDemand"},width:100,format:"",editable:!1,template:F.targetDemand}),v.push({field:"peakLevel",title:N.ENERGY_PEAK_LEVEL,attributes:{"data-name":"peakLevel"},width:100,format:"",editable:!1,template:F.peakLevel})),m){e=m.seriesData,t=m.valueAxis,a=m.categoryAxis;for(var r=0;r<e.length;r++)e[r]&&("ohlc"!==e[r].type?e[r].data=e[r].data.map(function(e){return T.convertNumberFormat(e)}):e[r].data=e[r].data.map(function(a){return $.each(a,function(e,t){a[e]=T.convertNumberFormat(t)}),a}))}else e=[],t=[],a=[];if(w.graph.widget.setOptions({axisDefaults:{line:{visible:!1},majorGridLines:{color:"#d6d6d6"}},seriesDefaults:{spacing:.1,gap:.2,overlay:{gradient:"none"},border:{width:0},missingValues:"gap"},chartArea:{background:"#fbfbfb",height:h,width:$("#operating-common-tab-2").width()},plotArea:{background:"#ebebeb"},legend:{visible:!1},xAxis:{border:{color:"#444"}},series:e,valueAxes:t,categoryAxis:a}),"runtime"!=c){var n="-",o="-",l=[];if($.isEmptyObject(u))i=[];else{if(i=u[g],u&&u[g]&&0<u[g].length){for(var s=0;s<u[c].length;s++)l.push(u[c][s].peakLevel);o=Math.max.apply(null,l)}"max"in u&&(n=u.max.currentDemand)}$(".monitoring-grid-top").find(".content[data-role=maximumdemand]").find(".value").text(T.convertNumberFormat(n)),$(".monitoring-grid-top").find(".content[data-role=maximumpeaklevel]").find(".value").text(o)}w.list.widget.setOptions({columns:v,dataSource:i,height:E,scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!1,setCheckedAttribute:!1}),w.graph.widget.dataSource.sync();var d=$("#custom-chart-tooltip_monitoring-chart");d&&d.hide()})},V=function(e){var t=e;t.categoryAxis=[{name:"runtime",categories:p.getChartXAxisLabel("runtime"),select:!1}];var a={axisDefaults:{line:{visible:!(t.valueAxis=[{min:0,max:1,majorUnit:.2,majorGridLines:{visible:!1}}])},majorGridLines:{color:"#d6d6d6"}},seriesDefaults:{spacing:.1,gap:.2,overlay:{gradient:"none"},border:{width:0},missingValues:"gap"},chartArea:{background:"#fbfbfb",height:h,width:$("#operating-common-tab-2").width()},plotArea:{background:"#ebebeb"},legend:{visible:!1},xAxis:{border:{color:"#444"}},series:t.seriesData,valueAxis:t.valueAxis,categoryAxis:t.categoryAxis,selectionTooltip:{isVisible:!0,width:400,seriesKeysForRowName:["name","stack"],rowGroupNames:[],rowTemplate:function(e){var t={groupName:"",content:"",priority:0},a="";if("runtime"===e.series.categoryAxis?"estimateDemand"===e.series.name?a="runtimeEstimateDemand":"currentDemand"===e.series.name?a="runtimeCurrentDemand":"targetDemand"===e.series.name&&(a=null!==e.series.data[e.categorySlotIndex].open?"runtimeTargetDemand":""):"hourly"===e.series.categoryAxis?"currentDemand1"===e.series.name||"currentDemand2"===e.series.name||"currentDemand3"===e.series.name||"currentDemand4"===e.series.name?a="hourlyCurrentDemand":"targetDemand"===e.series.name&&(a=null!==e.series.data[e.categorySlotIndex].open?"hourlyTargetDemand":""):"daily"===e.series.categoryAxis&&("currentDemand"===e.series.name?a="dailyCurrentDemand":"targetDemand"===e.series.name&&(a=null!==e.series.data[e.categorySlotIndex].open&&void 0!==e.series.data[e.categorySlotIndex].open?"dailyTargetDemand":"")),"object"==typeof e.series.data[e.categorySlotIndex]&&0===Object.keys(e.series.data[e.categorySlotIndex]).length)return null;switch(e.data=T.convertNumberFormat(e.data),a){case"runtimeCurrentDemand":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-Square' style='background-color:"+e.series.peakValue[e.categorySlotIndex]+"'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+_.prop("ENERGY_PEAK_LEVEL")+" + "+_.prop("ENERGY_CURRENT_DEMAND")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+e.data+"</span>",t.priority=3;break;case"runtimeEstimateDemand":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-line' style='background-color:"+e.series.color+"'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+_.prop("ENERGY_ESTIMATE_LINE")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+e.data+"</span>",t.priority=1;break;case"runtimeTargetDemand":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-line' style='background-color:#2c81db'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+_.prop("ENERGY_TARGET_DEMAND")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+T.convertNumberFormat(e.series.data[e.categorySlotIndex].open)+"</span>",t.priority=2;break;case"hourlyCurrentDemand":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-Square' style='background-color:"+e.series.peakValue[e.categorySlotIndex]+"'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+_.prop("ENERGY_PEAK_LEVEL")+" + "+_.prop("ENERGY_CURRENT_DEMAND")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+e.data+"</span>",t.priority=2;break;case"hourlyTargetDemand":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-line' style='background-color:#2c81db'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+_.prop("ENERGY_TARGET_DEMAND")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+T.convertNumberFormat(e.series.data[e.categorySlotIndex].open)+"</span>",t.priority=2;break;case"dailyCurrentDemand":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-Square' style='background-color:"+e.series.peakValue[e.categorySlotIndex]+"'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+_.prop("ENERGY_PEAK_LEVEL")+" + "+_.prop("ENERGY_CURRENT_DEMAND")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+e.data+"</span>",t.priority=2;break;case"dailyTargetDemand":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-line' style='background-color:#2c81db'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+_.prop("ENERGY_TARGET_DEMAND")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+T.convertNumberFormat(e.series.data[e.categorySlotIndex].open)+"</span>",t.priority=2;break;default:t=null}return t}}};return i.createNewWidget("monitoring-chart",u.dataviz.ui.Chart,a)},F={date:function(e){return e.date?'<span class="text-box">'+e.date+"</span>":'<span class="text-box">-</span>'},time:function(e){var t=D.formmatedDate+" ";return e.time?'<span class="text-box">'+t+e.time+"</span>":'<span class="text-box">-</span>'},currentDemand:function(e){return void 0===e.currentDemand||null===e.currentDemand?'<span class="text-box">-</span>':'<span class="text-box">'+T.convertNumberFormat(e.currentDemand)+"</span>"},targetDemand:function(e){return void 0===e.targetDemand||null===e.targetDemand?'<span class="text-box">-</span>':'<span class="text-box">'+T.convertNumberFormat(e.targetDemand)+"</span>"},peakLevel:function(e){return void 0===e.peakLevel||null===e.peakLevel?'<span class="text-box">-</span>':'<span class="text-box">'+e.peakLevel+"</span>"}},H=function(e){var t={columns:[],dataSource:e,height:E,scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!1,setCheckedAttribute:!1};return i.createNewWidget("monitoring-grid",u.ui.Grid,t)},W=function(){var e,t=D.formmatedDate.split("-"),a=D.setDateView.split("-");1<=t.length&&(a[0]=t[0]),2<=t.length&&(a[1]=t[1]),3<=t.length&&(a[2]=t[2]),e=a[0]+"-"+a[1]+"-"+a[2],D.set("setDateView",c().format(e))},j=function(){var e=D.formmatedDate.split("-"),t=new Date,a=new Date;a.setDate(t.getDate()-1);var i,r,n,o,l,s,d=e.length,c={year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()},u={year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate()};String(u.month).length<2&&(u.month="0"+u.month),String(u.day).length<2&&(u.day="0"+u.day),1<=d&&(i=Number(e[0]),s=c.year,o=Number(String(u.year)),Number(i)==o?D.nextBtn.set("disabled",!0):Number(i)>o?(D.nextBtn.set("disabled",!0),D.set("formmatedDate",s),D.set("setDateView",s)):D.nextBtn.set("disabled",!1)),2<=d&&(s=c.year+"-"+(1<String(c.month).length?c.month:"0"+c.month),r=Number(e[1]),String(r).length<2&&(r="0"+r),o=Number(String(u.year)+String(u.month)),(l=Number(String(i)+String(r)))==o?D.nextBtn.set("disabled",!0):o<=l?(D.nextBtn.set("disabled",!0),D.set("formmatedDate",s)):D.nextBtn.set("disabled",!1)),3<=d&&(s=c.year+"-"+(1<String(c.month).length?c.month:"0"+c.month)+"-"+(1<String(c.day).length?c.day:"0"+c.day),n=Number(e[2]),String(n).length<2&&(n="0"+n),o=Number(String(u.year)+String(u.month)+String(u.day)),(l=Number(String(i)+String(r)+String(n)))==o?D.nextBtn.set("disabled",!0):o<=l?(D.nextBtn.set("disabled",!0),D.set("formmatedDate",s)):D.nextBtn.set("disabled",!1))},z=function(e,t){var a,i,r,n,o,l,s,d,c=e.split("-"),u=c.length;return s=["01","02","03","04","05","06","07","08","09","10","11","12"],1<=u&&(a=Number(c[0]),n="year"),2<=u&&(i=Number(c[1]),n="month",d=f(a,i)),3<=u&&(r=Number(c[2]),n="day"),"year"==n?(a+=t,String(a)):"month"==n?s.length<(i+=t)||i<=0?a+t+"-"+(o=0<i?s[0]:s[11]):a+"-"+s[i-1]:"day"==n?(r+=t)>d.length||r<=0?0<r?s.length<(i+=t)||i<=0?(d=0<i?(o=s[0],f(a+t,1)):(o=s[11],f(a+t,12)),a+t+"-"+o+"-"+(l=d[0])):(l=(d=f(a,i))[0],a+"-"+s[i-1]+"-"+l):(l=d[d.length-1],s.length<(i+=t)||i<=0?(d=0<i?(o=s[0],f(a+t,1)):(o=s[11],f(a+t,12)),a+t+"-"+o+"-"+(l=d[d.length-1])):(l=(d=f(a,i))[d.length-1],a+"-"+s[i-1]+"-"+l)):a+"-"+s[i-1]+"-"+d[r-1]:void 0};function X(){s&&clearInterval(s),l&&clearInterval(l),"Day"==L?s=setInterval(function(){U()},9e5):"Runtime"==L&&(l=setInterval(function(){U()},6e4))}return{init:function(e){var a=new $.Deferred;d=e,S();var t=d.contentElement(1);return u.bind($(t),D),b.open(),$.ajax({url:"/dms/devices?types=AirConditionerController.DMS,AirConditionerController.WirelessDDC&registrationStatuses=Registered"}).done(function(e){for(var t=0;t<e.length;t++)e[t].airConditioner&&e[t].airConditioner.peakInterfaceModuleConnected&&D.filters[0].options.dataSource.push({text:e[t].name,value:String(e[t].id)});o=$("#group-list-demand").data("kendoDropDownList").value(),$.ajax({url:"/energy/sac/demandMonitoring/runtime?dms_device_id="+o}).done(function(e){e?(R=e,r=$("#operating-common-tab").find(".k-tabstrip-items"),(n=$("#operating-common-tab").find(".k-tabstrip-items").find("[aria-controls=operating-common-tab-2]").find(".k-link")).on("click",function(){l=setInterval(function(){U()},6e4)})):R=null}).fail(function(e){R=null;var t=T.parseFailResponse(e);y.message(t),y.open()}).always(function(){r=$("#operating-common-tab").find(".k-tabstrip-items"),n=$("#operating-common-tab").find(".k-tabstrip-items").find("[aria-controls=operating-common-tab-2]").find(".k-link"),I(R),x(),$(".monitoring-content").find(".operating-view-btn").hide(),D.runtimeBtn.set("active",!0),n.on("click",function(){m.disableFloorNav(!0),D.listBtn.get("active")?Y():B()}),r.on("click",".k-item .k-link",function(e){"demandmonitoring"!=$(e.target).closest("li.k-item").attr("data-role")&&(l&&clearInterval(l),s&&clearInterval(s))}),D.nextBtn.set("disabled",!0),D.prevBtn.set("disabled",!0),D.set("formmatedDate",c(new Date).format("L").replace(/\./gi,"-")),D.set("setDateView",D.formmatedDate),b.close(),a.resolve();var e=window.localStorage.getItem("dashboardDemandBtn");e&&(window.localStorage.removeItem("dashboardDemandBtn"),"day"==e&&D.dayBtn.click())})}).fail(function(e){b.close();var t=T.parseFailResponse(e);y.message(t),y.open()}).always(function(){}),a.promise()}}}),define("energy/samsungsac/detection",["energy/core","energy/samsungsac/view-model/detection-vm","energy/samsungsac/common/common","energy/samsungsac/common/widget"],function(n,e,c,t){function o(){B()}var l,s,d,u,p,m,g,r,v=window.moment,f=window.kendo,E=window.I18N,a=window.CommonLoadingPanel,h=window.Util,i=window.MAIN_WINDOW,T=new a,_=e.MainViewModel,b=$("#detection-main-view"),D=c.TEXT,w=c.MSG,N=t.msgDialog,A=t.confirmDialog,y=c.getFloorQuery,R=c.getMonthDay,L={},C={InsufficientInsulation:D.ENERGY_INSUFFICIENT_INSULATION,LongTimeOperation:D.ENERGY_LONG_TIME_OPERATION,AbnormalSetTemp:D.ENERGY_ABNORMAL_SET_TEMP,RepetitiveControl:D.ENERGY_REPETITIVE_CONTROL,LoadVariation:D.ENERGY_LOAD_VARIATION,AbnormalRoomTemp:D.ENERGY_ABNORMAL_CURRENT_TEMP,OverTimeOperation:D.ENERGY_OVER_TIME_OPERATION},S=[{name:"InsufficientInsulation",count:0},{name:"LongTimeOperation",count:0},{name:"AbnormalSetTemp",count:0},{name:"RepetitiveControl",count:0},{name:"LoadVariation",count:0},{name:"AbnormalRoomTemp",count:0},{name:"OverTimeOperation",count:0}],I=function(){},O=function(e){var t=P(e);F(t)},M=function(){_.nextBtn.set("click",function(){var e=U(_.formattedDate,1);_.set("formattedDate",v().format(e)),Y(),V(),B()}),_.prevBtn.set("click",function(){var e=U(_.formattedDate,-1);_.set("formattedDate",v().format(e)),Y(),V(),B()}),_.dayBtn.set("click",function(){_.monthBtn.set("active",!1),_.yearBtn.set("active",!1),1!=_.monthBtn.get("active")&&(_.set("formattedDate",v().format(x("day"))),_.dayBtn.set("active",!0),Y(),B())}),_.monthBtn.set("click",function(){_.dayBtn.set("active",!1),_.yearBtn.set("active",!1),1!=_.monthBtn.get("active")&&(_.monthBtn.set("active",!0),_.set("formattedDate",v().format(x("month"))),Y(),B())}),_.yearBtn.set("click",function(){_.dayBtn.set("active",!1),_.monthBtn.set("active",!1),1!=_.yearBtn.get("active")&&(_.set("formattedDate",v().format(x("year"))),_.yearBtn.set("active",!0),Y(),B())}),$(".operating-view-btn .setting-open").on("click",function(){j.kendoPopupSingleWindow("openWindowPopup"),G(),$("#detectionPopup_wnd_title").html(D.ENERGY_CONDITION_SETTING)}),$("#detectionPopup").on("click",'.popup-footer [data-event="popupClose"]',function(){$("#detectionPopup").find('.popup-footer [data-event="save"]').prop("disabled")?j.data("kendoPopupSingleWindow").close():(A.setConfirmActions({yes:function(){j.data("kendoPopupSingleWindow").close()},no:function(){A.close()}}),A.message(w.COMMON_CLOSE_WINDOW_CONFIRM),A.open())}),$("#detectionPopup").on("click",'.popup-footer [data-event="save"]',function(){N.message(w.COMMON_MESSAGE_NOTI_CHANGES_SAVED),N.open(),T.open(),$.ajax({url:"/energy/sac/energyLossDetection/setting",method:"PATCH",data:r}).done(function(){}).fail(function(e){var t=h.parseFailResponse(e);N.message(t),N.open()}).always(function(){T.close(),j.data("kendoPopupSingleWindow").close()})}),$("#detectionPopup").on("change",".setting-list .k-checkbox",function(){var e=$(this).closest("li").attr("data-settingName");r[e]=$(this).prop("checked"),$("#detectionPopup").find('.popup-footer [data-event="save"]').attr("disabled",!1)}),g.on("click",function(){i.disableFloorNav(!1),B()}),$("#main-sidebar-menu .btn-box").off("click",".btn",k).on("click",".btn",k),m.bind("show",function(e){"energylossdetection"===$(e.item).data("role")&&k()})},k=function(e){l.setOptions({chartArea:{width:$("#detection-main-view").width()}})},G=function(){T.open($("#detectionPopup")),$(".setting-container .setting-list .setting-drop-box").empty(),$(".setting-container .setting-list .setting-drop-box").each(function(){var e=$(this),t=e.closest("li[data-settingname]").index();e.append('<input type="text" class="setting-drop" data-role="dropdownlist" id="setting-drop-id-'+t+'">')}),$("#detectionPopup").find('.popup-footer [data-event="save"]').attr("disabled",!0),$.ajax({url:"/energy/sac/energyLossDetection/setting"}).done(function(e){for(var t in r=e){if($(".setting-container .setting-list").find('[data-settingName="'+t+'"] .k-checkbox').prop("checked",r[t]),"longTimeOperationSetTime"==t){var a=$(".setting-container .setting-list").find('[data-settingName="longTimeOperation"] .setting-drop').kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:q,index:0,change:function(e){r.longTimeOperationSetTime=Number(e.sender.dataSource.options.data[e.sender.selectedIndex].value),$("#detectionPopup").find('.popup-footer [data-event="save"]').attr("disabled",!1)}}).data("kendoDropDownList");a.search(String(r[t])),a._old=String(r[t])}if("overTimeOperationSetTime"==t){var i=$(".setting-container .setting-list").find('[data-settingName="overTimeOperation"] .setting-drop').kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:K,index:0,change:function(e){r.overTimeOperationSetTime=e.sender.dataSource.options.data[e.sender.selectedIndex].value,$("#detectionPopup").find('.popup-footer [data-event="save"]').attr("disabled",!1)}}).data("kendoDropDownList");i.search(r[t]),i._old=r[t]}}}).fail(function(e){var t=h.parseFailResponse(e);N.message(t),N.open()}).always(function(){T.close($("#detectionPopup"))})},x=function(e){var t,a="",i=_.setDateView.split("-");return"year"==e&&(a=i[0]),"month"==e&&(a=i[0]+"-"+i[1]),"day"==e&&(a=i[0]+"-"+i[1]+"-"+i[2],(t=R(i[0],i[1]).length)<i[2]&&(i[2]=t,a=i[0]+"-"+i[1]+"-"+i[2])),a},P=function(e){var t,a,i,r,n,o=_.formattedDate.split("-");if(L.graphLosses={},L.energyLossDetails=[],L.top5EnergyLosses=[],L.energyLossEvents=[],1==o.length&&(a="monthly",r="month",i="monthlyLosses",n=c.getChartXAxisLabel("year")),2==o.length&&(a="daily",i="dailyLosses",r="day",n=c.getChartXAxisLabel("month",_.formattedDate)),3==o.length&&(a="hourly",r="hour",i="hourlyLosses",n=c.getChartXAxisLabel("day")),t=e[a],L.graphLosses.data=[],L.graphLosses.categories=n,L.graphLosses.min=0,L.graphLosses.max=10,t&&t[i]){L.graphLosses.data=[];for(var l=0;l<n.length;l++)L.graphLosses.data.push(null);L.graphLosses.categories=n,L.graphLosses.min=0,L.graphLosses.max=t.max;for(var s=0;s<n.length;s++)for(var d=0;d<t[i].length;d++)"hour"==r&&s==t[i][d][r]&&(L.graphLosses.data[s]=t[i][d].count),"month"==r&&s==t[i][d][r]-1&&(L.graphLosses.data[s]=t[i][d].count),"day"==r&&s==t[i][d][r]-1&&(L.graphLosses.data[s]=t[i][d].count)}return L.energyLossDetails=S,t&&t.energyLossDetails&&(L.energyLossDetails=t.energyLossDetails),t&&t.top5EnergyLosses&&(L.top5EnergyLosses=t.top5EnergyLosses),t&&t.energyLossEvents&&(L.energyLossEvents=t.energyLossEvents),L},B=function(e){T.open();var t,a=_.formattedDate.split("-");e=(e=y()).replace("?","&"),1==a.length&&(t="year="+a[0]),2==a.length&&(t="year="+a[0]+"&month="+a[1]),3==a.length&&(t="year="+a[0]+"&month="+a[1]+"&day="+a[2]),$.ajax({url:"/energy/sac/energyLossDetection?"+t+e}).done(function(e){O(e)}).fail(function(e){var t=h.parseFailResponse(e);N.message(t),N.open()}).always(function(){T.close()})},Y=function(){var e,t,a,i,r,n,o=_.formattedDate.split("-"),l=new Date,s=o.length,d={year:l.getFullYear(),month:l.getMonth()+1,day:l.getDate()},c={year:l.getFullYear(),month:l.getMonth()+1,day:l.getDate()};String(c.month).length<2&&(c.month="0"+c.month),String(c.day).length<2&&(c.day="0"+c.day);var u=_.get("setDateView"),p=null;1<=s&&(e=Number(o[0]),n=d.year,i=Number(String(c.year)),Number(e)==i?_.nextBtn.set("disabled",!0):Number(e)>i?(_.nextBtn.set("disabled",!0),_.set("formattedDate",n),_.set("setDateView",n)):_.nextBtn.set("disabled",!1)),2<=s&&(n=d.year+"-"+(1<String(d.month).length?d.month:"0"+d.month),t=Number(o[1]),String(t).length<2&&(t="0"+t),i=Number(String(c.year)+String(c.month)),(r=Number(String(e)+String(t)))==i?_.nextBtn.set("disabled",!0):i<=r?(_.nextBtn.set("disabled",!0),_.set("formattedDate",n),p=u.split("-")[2],_.set("setDateView",n+"-"+p)):_.nextBtn.set("disabled",!1)),3<=s&&(n=d.year+"-"+(1<String(d.month).length?d.month:"0"+d.month)+"-"+(1<String(d.day).length?d.day:"0"+d.day),a=Number(o[2]),String(a).length<2&&(a="0"+a),i=Number(String(c.year)+String(c.month)+String(c.day)),(r=Number(String(e)+String(t)+String(a)))==i?_.nextBtn.set("disabled",!0):i<=r?(_.nextBtn.set("disabled",!0),_.set("formattedDate",n),_.set("setDateView",n)):_.nextBtn.set("disabled",!1))},U=function(e,t){var a,i,r,n,o,l,s,d,c=e.split("-"),u=c.length;return s=["01","02","03","04","05","06","07","08","09","10","11","12"],1<=u&&(a=Number(c[0]),n="year"),2<=u&&(i=Number(c[1]),n="month",d=R(a,i)),3<=u&&(r=Number(c[2]),n="day"),"year"==n?(a+=t,String(a)):"month"==n?s.length<(i+=t)||i<=0?a+t+"-"+(o=0<i?s[0]:s[11]):a+"-"+s[i-1]:"day"==n?(r+=t)>d.length||r<=0?0<r?s.length<(i+=t)||i<=0?(d=0<i?(o=s[0],R(a+t,1)):(o=s[11],R(a+t,12)),a+t+"-"+o+"-"+(l=d[0])):(l=(d=R(a,i))[0],a+"-"+s[i-1]+"-"+l):(l=d[d.length-1],s.length<(i+=t)||i<=0?(d=0<i?(o=s[0],R(a+t,1)):(o=s[11],R(a+t,12)),a+t+"-"+o+"-"+(l=d[d.length-1])):(l=(d=R(a,i))[d.length-1],a+"-"+s[i-1]+"-"+l)):a+"-"+s[i-1]+"-"+d[r-1]:void 0},V=function(){var e,t=_.formattedDate.split("-"),a=_.setDateView.split("-");1<=t.length&&(a[0]=t[0]),2<=t.length&&(a[1]=t[1]),3<=t.length&&(a[2]=t[2]),e=a[0]+"-"+a[1]+"-"+a[2],_.set("setDateView",v().format(e))},F=function(e){s=b.find(".top-box"),d=b.find(".left-box .graph-box"),u=b.find(".right-box .middle-right-grid"),p=b.find(".bottom-box .bottom-middle-grid"),s.empty(),d.empty(),u.empty(),p.empty(),b.find(".boardtitle").remove();var t=h.getChartOptionsForFiveChartSection(e.graphLosses.max,0);if(t.newMax||(t.newMax=1),l=s.kendoChart({axisDefaults:{line:{visible:!1},majorGridLines:{color:"#d6d6d6"}},seriesDefaults:{spacing:.1,gap:.2,overlay:{gradient:"none"},border:{width:0}},chartArea:{background:"#fbfbfb",height:500,width:$("#detection-main-view").width()},plotArea:{background:"#ebebeb"},legend:{visible:!1},xAxis:{border:{color:"#444"}},series:[{type:"column",data:e.graphLosses.data.map(function(e){return h.convertNumberFormat(e)}),stack:"energyLoss",name:"energyLoss",color:"#45b078"}],valueAxes:[{name:"energyLoss",min:0,max:t.newMax,majorUnit:t.newMajorUnit,axis:"energyLoss",majorGridLines:{visible:!1},labels:{template:function(e){return h.convertNumberFormat(e.value)}}}],selectionTooltip:{isVisible:!0,width:400,seriesKeysForRowName:["name"],rowGroupNames:[],rowTemplate:function(e){var t={groupName:"",content:"",priority:0};switch(e.series.name){case"energyLoss":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-Square' style='background-color:"+e.series.color+"'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+E.prop("ENERGY_NUMBER_OF_LOSS_DETECTION_COUNT")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+e.data+"</span>",t.priority=1;break;default:t.content="",t.priority=0,t.groupName=""}return t}},categoryAxis:{categories:e.graphLosses.categories,axisCrossingValues:[0,0,100,100]}}).data("kendoChart"),d.kendoChart({dataSource:{data:e.energyLossDetails},legend:{visible:!1},chartArea:{background:"#f0f0f0"},series:[{type:"donut",size:20,holeSize:50,field:"count",name:"energyLossDetails",categoryField:"name",overlay:{gradient:"none"}}],tooltip:{visible:!0,template:H,color:"#444444",background:"#f7f7f7",border:{width:0,color:"#f7f7f7"}},seriesColors:["#2c81db","#08b5d4","#68ba11","#feac5a","#f0824f","#eb5b6c","#7c62f0"]}).data("kendoChart"),b.find(".left-box").prepend('<p class="boardtitle inefficiency-cases-title">'+D.ENERGY_NUMBER_OF_LOSS_DETECTION+"</p>"),$("#detection-main-view .legendbox .unit").text(""),$("#energy_loss_chart_legend").empty(),0<e.energyLossDetails.length){for(var a=0;a<e.energyLossDetails.length;a++){var i=C[e.energyLossDetails[a].name],r='<li><span class="squmark"></span><p class="legendtxt">'+(i=i||"")+'</p><p class="valuetxt">'+e.energyLossDetails[a].count+"</p></li>";$("#energy_loss_chart_legend").append(r)}$("#detection-main-view .legendbox .unit").text("(EA)")}var n=[{field:"rank",title:D.ENERGY_RANK,attributes:{"data-name":"month"},width:49,format:"",editable:!1,sortable:!1,template:W.rank},{field:"name",title:D.ENERGY_TYPE,attributes:{"data-name":"sac"},width:235,format:"",editable:!1,sortable:!1,template:W.name},{field:"deviceName",title:D.ENERGY_DEVICE_NAME,attributes:{"data-name":"temperature"},width:215,format:"",editable:!1,sortable:!1,template:W.deviceName},{field:"count",title:D.ENERGY_COUNT,attributes:{"data-name":"temperature"},width:187,format:"",editable:!1,sortable:!1,template:W.count}],o=[{field:"eventTime",title:D.ENERGY_DATE_OF_EVENT,attributes:{"data-name":"month"},width:100,format:"",editable:!1,sortable:!1,template:W.eventTime},{field:"location",title:D.ENERGY_LOCATION,attributes:{"data-name":"sac"},width:100,format:"",editable:!1,sortable:!1,template:W.location},{field:"deviceName",title:D.ENERGY_DEVICE_NAME,attributes:{"data-name":"temperature"},width:100,format:"",editable:!1,sortable:!1,template:W.deviceName},{field:"energyLossName",title:D.ENERGY_ENERGY_LOSS_NAME,attributes:{"data-name":"temperature"},width:100,format:"",editable:!1,sortable:!1,template:W.energyLossName}];u.kendoGrid({columns:n,dataSource:e.top5EnergyLosses,height:250,scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!1,setCheckedAttribute:!1}).data("kendoGrid"),u.prepend('<p class="boardtitle inefficiency-top5-title">'+D.ENERGY_TOP_FIVE+"</p>"),p.kendoGrid({columns:o,dataSource:e.energyLossEvents,height:400,scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!1,setCheckedAttribute:!1}).data("kendoGrid"),p.prepend('<p class="boardtitle inefficiency-history-title">'+D.ENERGY_LIST_ENERGY_LOSS_DETECTION+"</p>")},H=function(e){var t,a=e.value,i=e.series.name;return"energyLoss"==i&&(t={title:D.ENERGY_LOSS,value:a}),"energyLossDetails"==i&&(t={title:C[e.category],value:a}),'<div class="custom-chart-tooltip-container"><span class="tooltip-item-title">'+t.title+'</span> : <span class="tooltip-item-value">'+t.value+"</span></div>"},W={rank:function(e){return e.rank?e.rank:"-"},name:function(e){var t="";return e.name?(C[e.name]&&(t=C[e.name]),t):"-"},deviceId:function(e){return e.deviceId?e.deviceId:"-"},count:function(e){return e.count?e.count:"-"},eventTime:function(e){return e.eventTime?e.eventTime:"-"},location:function(e){var t;return e.location?t=!(t=(e.location.type?e.location.type:"")+(e.location.coordinates?"("+e.location.coordinates[0]+","+e.location.coordinates[1]+")":""))&&!e.location.coordinates&&!e.location.type&&0<String(e.location).length?e.location:t||"-":"-"},deviceName:function(e){return e.deviceName?e.deviceName:"-"},energyLossName:function(e){return e.energyLossName?C[e.energyLossName]:"-"}},j=$("#detectionPopup");if(!j.data("kendoPopupSingleWindow")){var z=$("#summary-building-message-dialog"),X=$("#summary-building-confirm-dialog");z.kendoCommonDialog(),X.kendoCommonDialog({type:"confirm",title:"Notification"}),j=$("#detectionPopup").kendoPopupSingleWindow({model:t.Model,width:"1290px",height:"655px"})}var K=[{text:"00:00",value:"00:00"},{text:"00:30",value:"00:30"},{text:"01:00",value:"01:00"},{text:"01:30",value:"01:30"},{text:"02:00",value:"02:00"},{text:"02:30",value:"02:30"},{text:"03:00",value:"03:00"},{text:"03:30",value:"03:30"},{text:"04:00",value:"04:00"},{text:"04:30",value:"04:30"},{text:"05:00",value:"05:00"},{text:"05:30",value:"05:30"},{text:"06:00",value:"06:00"},{text:"06:30",value:"06:30"},{text:"07:00",value:"07:00"},{text:"07:30",value:"07:30"},{text:"08:00",value:"08:00"},{text:"08:30",value:"08:30"},{text:"09:00",value:"09:00"},{text:"09:30",value:"09:30"},{text:"10:00",value:"10:00"},{text:"10:30",value:"10:30"},{text:"11:00",value:"11:00"},{text:"11:30",value:"11:30"},{text:"12:00",value:"12:00"},{text:"12:30",value:"12:30"},{text:"13:00",value:"13:00"},{text:"13:30",value:"13:30"},{text:"14:00",value:"14:00"},{text:"14:30",value:"14:30"},{text:"15:00",value:"15:00"},{text:"15:30",value:"15:30"},{text:"16:00",value:"16:00"},{text:"16:30",value:"16:30"},{text:"17:00",value:"17:00"},{text:"17:30",value:"17:30"},{text:"18:00",value:"18:00"},{text:"18:30",value:"18:30"},{text:"19:00",value:"19:00"},{text:"19:30",value:"19:30"},{text:"20:00",value:"20:00"},{text:"20:30",value:"20:30"},{text:"21:00",value:"21:00"},{text:"21:30",value:"21:30"},{text:"22:00",value:"22:00"},{text:"22:30",value:"22:30"},{text:"23:00",value:"23:00"},{text:"23:30",value:"23:30"}],q=[{text:"12",value:"12"},{text:"15",value:"15"},{text:"18",value:"18"},{text:"21",value:"21"}];return{init:function(e){_.dayBtn.set("active",!0),_.set("setDateView",v().format(_.formattedDate)),n.on("onfloorchange",o),T.open(),m=e,I();var t,a=m.element.find(".detection-content").parent(),i=y(null,!0),r=_.formattedDate.split("-");i=(i=y()).replace("?","&"),1==r.length&&(t="year="+r[0]),2==r.length&&(t="year="+r[0]+"&month="+r[1]),3==r.length&&(t="year="+r[0]+"&month="+r[1]+"&day="+r[2]),f.bind($(a),_),$.ajax({url:"/energy/sac/energyLossDetection?"+t+i}).done(function(e){g=$("#operating-common-tab").find(".k-tabstrip-items").find("[aria-controls=operating-common-tab-3]").find(".k-link"),M(),O(e),_.nextBtn.set("disabled",!0)}).fail(function(e){var t=h.parseFailResponse(e);N.message(t),N.open()}).always(function(){n.on("onfloorchange",o),T.close()})}}}),define("energy/samsungsac/distribution",["energy/samsungsac/view-model/distribution-vm","energy/samsungsac/common/widget","energy/samsungsac/model/distribution-model"],function(t,e,o){function i(e,t){var a,i,r=null,n="";u.open(),(a=t,i="startDate="+N(e)+"&endDate="+N(a),$.ajax({url:"/energy/distribution/groupusage?"+i})).done(function(e){r=o.createDataSource(e)}).fail(function(e){r=o.createDataSource([]),""==(n=c.parseFailResponse(e))&&(n="url: "+this.url+"\nmethod: "+this.method+"\n"+e.statusText+" : "+e.status),E.message(n),E.open()}).always(function(){r.read(),d.setDataSource(r),d.autoFitColumn("dmsGroupName"),p.exportBtn.set("disabled",0==r.options.data.length),u.close()})}function a(){var e=l.value(),t=s.value(),a=$(l).data("prevDate"),i=$(s).data("prevDate"),r=new Date,n=new Date;n.setDate(r.getDate()-1),n<t&&(t=n),n<e&&(e=n),t<e&&(t!=i?(e=a,t=i):e!=a&&(t=e)),l.setDate(new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0)),s.setDate(new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59)),$(l).data("prevDate",l.value()),$(s).data("prevDate",s.value())}var l,s,d,r=window.kendo,c=window.Util,u=new window.CommonLoadingPanel,n=window.MAIN_WINDOW,p=t.MainViewModel,m=null,g=$("#energy-distribution-date-picker-start"),v=$("#energy-distribution-date-picker-end"),f=$("#energy-distribution-grid"),E=e.msgDialog,h=function(){var e,t,a=new Date,i=new Date;i.setDate(a.getDate()-1),e=1!==a.getDate()?new Date(a.getFullYear(),a.getMonth(),1,0,0,0):new Date(a.getFullYear(),a.getMonth()-1,1,0,0,0),t=i,l=g.kendoCommonDatePicker({value:e,isStart:!0}).data("kendoCommonDatePicker"),s=v.kendoCommonDatePicker({value:t,isEnd:!0}).data("kendoCommonDatePicker"),$(l).data("prevDate",l.value()),$(s).data("prevDate",s.value())},T=function(){var e=t.gridOptions;d=f.kendoGrid(e).data("kendoGrid")},_=function(e){"operating-common-tab-4"==$(e.contentElement).prop("id")&&(i(l.value(),s.value()),n.disableFloorNav(!0))},b=function(e){var t=l.value(),a=s.value();i(t,a)},D=function(e){$(d.wrapper).find(".k-grid-excel").trigger("click")},w=function(e){o.createExcelContent(l.value(),s.value(),e.workbook.sheets[0])},N=function(e){var t=e.getFullYear(),a=e.getMonth(),i=e.getDate();return t+"-"+(a=r.toString(a+1,"00"))+"-"+(i=r.toString(i,"00"))};return{init:function(e){var t=e.element.find(".energy-distribution-content");m=e,r.bind($(t),p),h(),T({}),p.viewBtn.set("click",b),p.exportBtn.set("click",D),l.options.okCallBack=a,s.options.okCallBack=a,d.bind("excelExport",w),m.bind("activate",_),$("#main-sidebar-menu").find(".btn-util").on("click",".btn",function(e){d.refresh()})}}}),define("energy/samsungsac/sac-algorithm/sac-algorithm-model",function(){"use strict";function e(e,t){return e=e.replace(/\'/g,"_").replace(/-/g,"_").replace(/ /g,"_").replace(/\./g,"_"),e=(t?o.prop("SETTINGS_ALGORITHM_CITY_"+e.toUpperCase()):o.prop("SETTINGS_ALGORITHM_COUNTRY_"+e.toUpperCase()))||e}var a,t,i,r,n,o=window.I18N,l=window.kendo,s={"South Korea":["Seoul","Busan","Daejeon","Incheon","Daegu","Gwangju","Ulsan"],"North Korea":["Pyongyang"],Japan:["Fukuoka","Hiroshima","Nagoya","Osaka","Sapporo","Sendai","Tokyo"],Taiwan:["Taipei"],China:["Beijing","Chengdu","Chongqing","Guangzhou","Hangzhou","HongKong","Shanghai","Tianjin","Urumqi","Xian"],Mongolia:["Ulaanbaatar"],Phillippines:["Cebu","Davao","Manila"],Indonesia:["Jakarta","Jayapura","Makassar","Manado","Medan","Merauke"],Malaysia:["Kuala Lumpur"],Singapore:["Singapore"],Brunei:["Brunei"],Vietnam:["Hanoi","Ho Chi Minh City"],Laos:["Vientiane"],Thailand:["Bangkok","Pattaya"],Cambodia:["Phnom Penh"],Bangladesh:["Dhaka"],Nepal:["Kathmandu"],India:["Ahmedabad","Bengaluru","Changdigarh","Chennai","Chhindwara","Hyderabad","Jaipur","Kochi","Kolkata","Lucknow","Mumbai","Mysuru","New Delhi","Pune","Surat"],"Sri Lanka":["Colombo"],"Papu New Guinea":["Lae","Port Moresby"],Australia:["Adelaide","Alice Springs","Brisbane","Bunbury","Cairns","Canberra","Darwin","Geelong","Geraldton","Gold Coast","Hobart","Mackay","Mandurah","Melbourne","Newcastle","Perth","Sunshine Coast","Sydney","Toowoomba","Townsville"],"New Zealand":["Auckland","Christchurch","Dunedin","Hamilton","Invercargill","Nelson","Palmerston North","Queenstown","Rotorua","Tauranga","Welington"],Pakistan:["Islamabad","Karachi","Lahore"],Afghanistan:["Kabul"],Tajikistan:["Dushanbe"],Uzbekistan:["Tashkent"],Kyrgyzstan:["Bishkek"],Kazakhstan:["Almaty","Astana","Karagandy","Pavlodar","Semey","Ust'-Kamenogorsk"],"New Caledonia":["Noumea"],Vanuatu:["Port Vila"],"Pitcairn Islands":["Adamstown"],French:["Hanga Roa"],Chilean:["Rikitea"],"French Polynesia":["Atuona","Taioha'e","Vaitape"],Kiribati:["Napari"],Nauru:["Bairiki","Taburao"],"Marshall Islands":["Majuro"],Russia:["Abakan","Achinsk","Aldan","Anadyr","Aykhal","Ayon","Barnaul","Batagay","Belaya Gora","Beringovsky","Biysk","Blagoveshchensk","Bratsk","Chatanga","Chelyabinsk","Chersky","Chita","Chokurdakh","Deputatsky","Dudinka","Irkutsk","Izhevsk","Kazan","Kemerovo","Klyuchi","Krasnodar","Krasnoyarsk","Magadan","Makhachkala","Mirny","Moscow","Murmansk","Neryungri","Nizhnevartovsk","Nizhneyansk","Nizhny Novgorod","Nordvik","Norilsk","Novokuznetsk","Novosibirsk","Novy Urengoy","Nyurba","Ola","Omsk","Orenburg","Ossora","Palana","Petropavlovsk-Kamchatskiy","Pevek","Pokrovsk","Rostov-on-Don","Salekhard","Samara","Saratov","Saskylakh","Seymchan","Sklad","Slautnoye","Srednekolymsk","St Petersburg","Surgut","Syndassko","Tiksi","Tilichiki","Tomsk","Tyumen","Udachny","Ufa","Ulan-Ude","Ust-Ilimsk","Vilyuysk","Vladivostok","Volgograd","Vorkuta","Voronezh","Yakutsk","Yekaterinburg","Yuryung-Khaya","Zyryanka"],Iran:["Tehran"],Oman:["Muscat"],Yemen:["Sana'a"],"United Arab Emirates":["Dubai"],"Saudi Arabia":["Riyadh","Medina","Mecca"],Iraq:["Baghdad"],Syria:["Damascus"],Lebanon:["Beirut"],Israel:["Jerusalem"],Turkey:["Ankara","Istanbul","Bursa","Izmir","Antalya","Adana"],Azerbaijan:["Baku"],Georgia:["Tbilisi"],Estonia:["Tallinn"],Latvia:["Riga"],Lithuania:["Vilnius"],Belarus:["Minsk"],Ukraine:["Kiev","Kharkiv","Odessa"],Moldova:["Chisinau"],Romania:["Bucharest"],Bulgaria:["Sofia"],Greece:["Athens"],Albania:["Tirana"],Serbia:["Belgrade"],Montenegro:["Podgorica"],"Bosnia and Herzegovina":["Sarajevo"],Hungary:["Budapest"],Croatia:["Zagreb"],Austria:["Vienna"],Czech:["Prague"],Poland:["Warsaw"],Germany:["Berlin","Hamburg","Cologne","Frankfurt","Munich"],Italy:["Rome","Milan"],Belgium:["Brussels"],Netherlands:["Amsterdam"],Denmark:["Copenhagen"],Sweden:["Stockholm"],Finland:["Helsinki"],Norway:["Oslo","Tromso","Alta"],France:["Paris"],Spain:["Madrid","Barcelona","Valencia","Granada","Malaga","Seville","Las Palmas de Gran Canaria","Santa Cruz de tenerife"],Portugal:["Lisbon","Porto"],"U.K.":["London","Manchester","Liverpool","Edinburgh","Glasgow"],Ireland:["Dublin"],Egypt:["Cairo","Alexandria"],Libya:["Tripoli"],Tunisia:["Tunis"],Algeria:["Algiers"],Morocoo:["Rabat","Casablanca","Marrakesh","Agadir"],Mauritania:["Nouakchott"],Mali:["Bamako"],Niger:["Niamey"],Chad:["N'Djamena"],Nigeria:["Abuja","Kano","Lagos","Port Harcourt"],Togo:["Lome"],Ghana:["Accra","Kumasi"],"Cote d'lvoire":["Yamoussoukro","Abidjan"],Liberia:["Monrovia"],Guinea:["Conakry"],Senegal:["Dakar"],"South Sudan":["Juba"],"Central African Republic":["Bangui"],Cameroon:["Yaounde","Douala"],Somalia:["Mogadishu"],Kenya:["Nairobi","Mombasa","Nakuru"],Uganda:["Kampala"],Congo:["Kinshasa"],Gabon:["Libreville"],Tanzania:["Dar es Salaam"],Zambia:["Lusaka"],Angola:["Luanda"],Zimbabwe:["Harare"],Mozambique:["Maputo"],Botswana:["Gaborone"],"South Africa":["Pretoria","Johnnesburg","Bloemfontein","Durban","East London","Port Elizaberth","Cape Town"],Madagascar:["Antananarivo"],Canada:["Baker Lake","Calgary","Edmonton","Fort McMurray","Inuvik","Montreal","Ottawa","Quebec","Regina","Saskatoon","St.John's","Toronto","Vancouver","Victoria","Whitehorse","Winnipeg","Yellowknife"],"U.S.A":["Austin","Charlotte","Chicago","Dallas","Denver","Detroit","El Paso","Houston","Indianapilis","Jacksonville","Kansas City","Las Vegas","Los Angeles","Miami","Minneapolis","Nashville","New Orleans","Orlando","Phoenix","Portland","San Antonio","San Diego","San Francisco","San Jose","Seattle","Tampa","Tucson"],Mexico:["Cancun","Guadalajara","Heroica Veracruz","Merida","Mexico City"],Cuba:["Havana"],Haiti:["Port au Prince"],Belize:["Belmopan"],Guatemala:["Guatemala"],Nicaragua:["Managua"],"Costa Rica":["San Jose"],Panama:["Panama City"],Colombia:["Barranquilla","Bogota","Cali","Cartagena","Bucaramanga","Medellin","Pereira"],Ecuador:["Quito"],Venezuela:["Barquisimeto","Caracas","Maracaibo"],Guyana:["Georgetown"],Suriname:["Paramaribo","Cusco","Lima District"],Bolivia:["Cochabamba","La Paz","Santa Cruz de la Sierra"],Brazil:["Aracaju","Belem","Belo Horizonte","Boa Vista","Brasilia","Curitiba","Fortaleza","Goiania","Joas Pessoa","Macapa","Manaus","Porto Alegre","Recife","Ribeirao Preto","Rio de Janeiro","Salvador","Sao Luis"],Paraguay:["Asuncion"],Chile:["Antofagasta","Concepcion","Punta Arenas","Santiago"],Argentina:["Bahia Blanca","Buenos Aires","Comodoro Rivadavia","Cordoba","El Calafate","Mar del Plata","Mendoza","Neuquen","Rio Callegos","Rio Grande","Rosario","Salta","San Carlos de bariloche","San Miguel de Tucuman","Santa Fe"]},d=[];for(n in s)for(d.push({text:e(n),value:n}),t=(r=s[n]).length,a=0;a<t;a++)i=r[a],r[a]={value:i,text:e(i,!0)};d.sort(function(e,t){return e.text.localeCompare(t.text)});var c,u,p=[{text:o.prop("SETTINGS_FACILITY_COMPLEX"),value:"ComplexFacility"},{text:o.prop("SETTINGS_FACILITY_SALES"),value:"SalesFacility"},{text:o.prop("SETTINGS_FACILITY_EDUCATIONAL"),value:"EducationalFacility"},{text:o.prop("SETTINGS_FACILITY_ACCOMMODATION"),value:"Accommodations"},{text:o.prop("SETTINGS_FACILITY_BUSINESS"),value:"BusinessFacility"},{text:o.prop("SETTINGS_FACILITY_PUBLIC"),value:"PublicFacility"},{text:o.prop("SETTINGS_FACILITY_MEDICAL"),value:"MedicalFacility"}],m=[{text:o.prop("SETTINGS_ALGORITHM_WEEKDAY"),value:"weekday"},{text:o.prop("SETTINGS_ALGORITHM_WEEKEND"),value:"weekend"},{text:o.prop("SETTINGS_ALGORITHM_ALL"),value:"all"}],g=[];for(c=1;c<=12;c++)u=l.toString(c,"00"),g.push({text:u,value:u});function v(e){var t=[];for(e<30&&(e=28),a=1;a<=e;a++)u=l.toString(a,"00"),t.push({text:u,value:u});return t}var f=v(31),E=l.data.Model.define({id:"device_id",fields:{device_name:{name:"Name"},algorithm_type:{name:"Algorithm Type"},comfort_option:{name:"Comfort Option"}}});return{MockData:{device_setting_list:[{device_id:"1",device_name:"Device 1",algorithm_type:"Manual",comfort_option:"Normal"},{device_id:"2",device_name:"Device 2",algorithm_type:"Comfort",comfort_option:"Comfort"},{device_id:"3",device_name:"Device 3",algorithm_type:"Manual",comfort_option:"Normal"},{device_id:"4",device_name:"Device 4",algorithm_type:"PRC",comfort_option:"VeryComfort"}]},SettingMockData:{weather_location:{country:"South Korea",city:"Seoul"},facility:"ComplexFacility",except_time:[{start_time:"12:00",end_time:"14:00"}],optimal_start_time:90},powerPricingMockData:[{id:1,name:"General purpose power! || High-voltage current select!",enable:!0,list:[{dayType:"all",startDate:"01-01",endDate:"12-31",baseRate:0,level1Rate:1,level2Rate:.5,level3Rate:.5,powerDivision:{time00Level:1,time01Level:1,time02Level:1,time03Level:2,time04Level:2,time05Level:1,time06Level:1,time07Level:3,time08Level:3,time09Level:1,time10Level:1,time11Level:1,time12Level:1,time13Level:1,time14Level:1,time15Level:1,time16Level:1,time17Level:1,time18Level:1,time19Level:1,time20Level:1,time21Level:1,time22Level:1,time23Level:1}}]},{id:2,name:"General purpose power(B) || High-voltage current select",enable:!1,list:[{dayType:"all",startDate:"01-01",endDate:"12-31",baseRate:0,level1Rate:1,level2Rate:.5,level3Rate:.5,powerDivision:{time00Level:1,time01Level:1,time02Level:1,time03Level:1,time04Level:1,time05Level:1,time06Level:1,time07Level:1,time08Level:1,time09Level:1,time10Level:1,time11Level:1,time12Level:1,time13Level:1,time14Level:1,time15Level:1,time16Level:1,time17Level:1,time18Level:1,time19Level:1,time20Level:1,time21Level:1,time22Level:1,time23Level:1}},{dayType:"weekday",startDate:"01-01",endDate:"12-31",baseRate:0,level1Rate:1,level2Rate:.5,level3Rate:.5,powerDivision:{time00Level:1,time01Level:1,time02Level:1,time03Level:1,time04Level:1,time05Level:1,time06Level:1,time07Level:1,time08Level:1,time09Level:1,time10Level:1,time11Level:1,time12Level:1,time13Level:1,time14Level:1,time15Level:1,time16Level:1,time17Level:1,time18Level:1,time19Level:1,time20Level:1,time21Level:1,time22Level:1,time23Level:1}}]},{id:3,name:"General purpose power(C) || Low-voltage current select",enable:!1,list:[{dayType:"all",startDate:"01-01",endDate:"12-31",baseRate:0,level1Rate:1,level2Rate:.5,level3Rate:.5,powerDivision:{time00Level:1,time01Level:1,time02Level:1,time03Level:1,time04Level:1,time05Level:1,time06Level:1,time07Level:1,time08Level:1,time09Level:1,time10Level:1,time11Level:1,time12Level:1,time13Level:1,time14Level:1,time15Level:1,time16Level:1,time17Level:1,time18Level:1,time19Level:1,time20Level:1,time21Level:1,time22Level:1,time23Level:1}}]},{id:4,name:"General purpose power(D) || High-voltage current select",enable:!1,list:[{dayType:"all",startDate:"01-01",endDate:"12-31",baseRate:0,level1Rate:1,level2Rate:.5,level3Rate:.5,powerDivision:{time00Level:1,time01Level:1,time02Level:1,time03Level:1,time04Level:1,time05Level:1,time06Level:1,time07Level:1,time08Level:1,time09Level:1,time10Level:1,time11Level:1,time12Level:1,time13Level:1,time14Level:1,time15Level:1,time16Level:1,time17Level:1,time18Level:1,time19Level:1,time20Level:1,time21Level:1,time22Level:1,time23Level:1}}]}],createDataSource:function(e){var t=e.device_setting_list;if(!t)return[];var a,i=t.length;for(a=0;a<i;a++)"Manual"!=t[a].algorithm_type?t[a].checked=!0:t[a].checked=!1;return t},createModel:function(e){var t=new E(e);return t},weatherDataSource:d,locationDataSource:s,purposeDataSource:p,optimalDataSource:[60,70,80,90,100,110,120],powerPricingWeekDayDataSource:m,powerPricingMonthDataSource:g,powerPricingDayDataSource:f,defaultPowerPricingListData:{isCreated:!0,dayType:"all",startDate:"01-01",endDate:"12-31",baseRate:0,level1Rate:0,level2Rate:0,level3Rate:0,powerDivision:{time00Level:1,time01Level:1,time02Level:1,time03Level:1,time04Level:1,time05Level:1,time06Level:1,time07Level:1,time08Level:1,time09Level:1,time10Level:1,time11Level:1,time12Level:1,time13Level:1,time14Level:1,time15Level:1,time16Level:1,time17Level:1,time18Level:1,time19Level:1,time20Level:1,time21Level:1,time22Level:1,time23Level:1}},createDayDataSource:v}}),define("energy/samsungsac/sac-algorithm/sac-algorithm-template",[],function(){function a(e){var t;return t=e.split("-"),d.toString(t[0],"00")+"/"+d.toString(t[1],"00")}function i(e){return d.toString(e,"n")}function r(e){return"<span class='power-pricing-hourly-level-wrapper'><input class='k-input power-pricing-hourly-level' data-level='"+e+"' value='"+e+"'/ readonly></span>"}function n(e,t){return"<span class='power-pricing-hourly-level-wrapper'><input data-role='numerictextbox' class='k-input power-pricing-hourly-level edit' data-level='"+e+"' value='"+e+"' data-min='1' data-max='3' data-key='time"+t+"Level'/></span>"}function t(e,t){var a;return"<input class='pricing-edit-month' data-value='"+(e?(a=e.split("-"),d.toString(Number(a[0]),"00")):"")+"' data-type='"+t+"'/>"}function o(e,t){var a;return"<input class='pricing-edit-day' data-value='"+(e?(a=e.split("-"),d.toString(Number(a[1]),"00")):"")+"' data-type='"+t+"'/>"}function l(e,t){var a="",i="level";return 0==t?i=a="base":a=1==t?"level1":2==t?"level2":"level3","<input class='k-input pricing-edit-rate "+i+"' data-min='0' data-max='999999999' data-spinners='false' data-decimals='1' data-format='n0' value='"+e+"' data-value='"+e+"' data-level='"+t+"' data-key='"+a+"Rate'/>"}var s=window.I18N,d=window.kendo;return{prcComfortTempl:function(e){var t=e.algorithm_type,a=e.device_id,i=e.checked?"":"disabled",r="Comfort"==(t=t||"Manual")?"checked":"";return'<input type="radio" class="k-radio type-radio" name="prc-comfort-'+a+'" value="PRC" id="prc-'+a+'" '+("PRC"==t?"checked":"")+" "+i+'><label class="k-radio-label" for="prc-'+a+'">'+s.prop("SETTINGS_ALGORITHM_NAME_PRC")+'</label><input type="radio" class="k-radio type-radio" name="prc-comfort-'+a+'" value="Comfort" id="comfort-'+a+'" '+r+" "+i+'><label class="k-radio-label" for="comfort-'+a+'">'+s.prop("SETTINGS_ALGORITHM_NAME_COMFORT")+"</label>"},comfortOptionTempl:function(e){var t=e.comfort_option,a=e.device_id,i=e.algorithm_type,r=e.checked&&"Comfort"==i?"":"disabled";t||(e.comfort_option=t="Normal");var n="Comfort"==t?"checked":"",o="VeryComfort"==t?"checked":"";return'<input type="radio" class="k-radio comfort-option-radio" name="comfort-option-'+a+'" value="Normal" id="normal-'+a+'" '+("Normal"==t?"checked":"")+" "+r+'><label class="k-radio-label" for="normal-'+a+'">'+s.prop("SETTINGS_ALGORITHM_COMFORT_MODE_NORMAL")+'</label><input type="radio" class="k-radio comfort-option-radio" name="comfort-option-'+a+'" value="Comfort" id="comfort-option-comfort-'+a+'" '+n+" "+r+'><label class="k-radio-label" for="comfort-option-comfort-'+a+'">'+s.prop("SETTINGS_ALGORITHM_COMFORT_MODE_COMFORT")+'</label><input type="radio" class="k-radio comfort-option-radio" name="comfort-option-'+a+'" value="VeryComfort" id="comfort-very-'+a+'" '+o+" "+r+'><label class="k-radio-label" for="comfort-very-'+a+'">'+s.prop("SETTINGS_ALGORITHM_COMFORT_MODE_VERY_COMFORT")+"</label>"},prcComfortFooterTempl:function(){return'<input type="radio" class="k-radio type-radio" name="prc-comfort-all" value="PRC" id="prc-all" disabled><label class="k-radio-label" for="prc-all">'+s.prop("SETTINGS_ALGORITHM_NAME_PRC")+'</label><input type="radio" class="k-radio type-radio" name="prc-comfort-all" value="Comfort" id="comfort-all" disabled><label class="k-radio-label" for="comfort-all">'+s.prop("SETTINGS_ALGORITHM_NAME_COMFORT")+"</label>"},comfortOptionFooterTempl:function(){return'<input type="radio" class="k-radio comfort-option-radio" name="comfort-option-all" value="Normal" id="normal-all" disabled><label class="k-radio-label" for="normal-all">'+s.prop("SETTINGS_ALGORITHM_COMFORT_MODE_NORMAL")+'</label><input type="radio" class="k-radio comfort-option-radio" name="comfort-option-all" value="Comfort" id="comfort-option-comfort-all" disabled><label class="k-radio-label" for="comfort-option-comfort-all">'+s.prop("SETTINGS_ALGORITHM_COMFORT_MODE_COMFORT")+'</label><input type="radio" class="k-radio comfort-option-radio" name="comfort-option-all" value="VeryComfort" id="comfort-very-all" disabled><label class="k-radio-label" for="comfort-very-all">'+s.prop("SETTINGS_ALGORITHM_COMFORT_MODE_VERY_COMFORT")+"</label>"},powerPricingWeekDayTempl:function(e){var t="-";if(e.dayType){t=e.dayType.toUpperCase();var a=s.prop("SETTINGS_ALGORITHM_"+t);t=a||t}return t},powerPricingStartDateTempl:function(e){var t="-";return e.startDate&&(t=a(e.startDate)),t},powerPricingEndDateTempl:function(e){var t="-";return e.endDate&&(t=a(e.endDate)),t},powerPricingBaseRateTempl:function(e){var t="-";return void 0!==e.baseRate&&(t=i(e.baseRate)),t},powerPricingLevel1RateTempl:function(e){var t="-";return void 0!==e.level1Rate&&(t=i(e.level1Rate)),t},powerPricingLevel2RateTempl:function(e){var t="-";return void 0!==e.level2Rate&&(t=i(e.level2Rate)),t},powerPricingLevel3RateTempl:function(e){var t="-";return void 0!==e.level3Rate&&(t=i(e.level3Rate)),t},powerPricingTime00Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time00Level&&(t=r(a.time00Level)),t},powerPricingTime01Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time01Level&&(t=r(a.time01Level)),t},powerPricingTime02Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time02Level&&(t=r(a.time02Level)),t},powerPricingTime03Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time03Level&&(t=r(a.time03Level)),t},powerPricingTime04Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time04Level&&(t=r(a.time04Level)),t},powerPricingTime05Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time05Level&&(t=r(a.time05Level)),t},powerPricingTime06Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time06Level&&(t=r(a.time06Level)),t},powerPricingTime07Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time07Level&&(t=r(a.time07Level)),t},powerPricingTime08Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time08Level&&(t=r(a.time08Level)),t},powerPricingTime09Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time09Level&&(t=r(a.time09Level)),t},powerPricingTime10Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time10Level&&(t=r(a.time10Level)),t},powerPricingTime11Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time11Level&&(t=r(a.time11Level)),t},powerPricingTime12Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time12Level&&(t=r(a.time12Level)),t},powerPricingTime13Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time13Level&&(t=r(a.time13Level)),t},powerPricingTime14Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time14Level&&(t=r(a.time14Level)),t},powerPricingTime15Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time15Level&&(t=r(a.time15Level)),t},powerPricingTime16Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time16Level&&(t=r(a.time16Level)),t},powerPricingTime17Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time17Level&&(t=r(a.time17Level)),t},powerPricingTime18Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time18Level&&(t=r(a.time18Level)),t},powerPricingTime19Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time19Level&&(t=r(a.time19Level)),t},powerPricingTime20Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time20Level&&(t=r(a.time20Level)),t},powerPricingTime21Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time21Level&&(t=r(a.time21Level)),t},powerPricingTime22Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time22Level&&(t=r(a.time22Level)),t},powerPricingTime23Templ:function(e){var t="-",a=e.powerDivision;return a&&void 0!==a.time23Level&&(t=r(a.time23Level)),t},powerPricingEditTime00Templ:function(e){var t="-",a=e.powerDivision;return t=a.time00Level?a.time00Level:"",t=n(t,"00")},powerPricingEditTime01Templ:function(e){var t="-",a=e.powerDivision;return t=a.time01Level?a.time01Level:"",t=n(t,"01")},powerPricingEditTime02Templ:function(e){var t="-",a=e.powerDivision;return t=a.time02Level?a.time02Level:"",t=n(t,"02")},powerPricingEditTime03Templ:function(e){var t="-",a=e.powerDivision;return t=a.time03Level?a.time03Level:"",t=n(t,"03")},powerPricingEditTime04Templ:function(e){var t="-",a=e.powerDivision;return t=a.time04Level?a.time04Level:"",t=n(t,"04")},powerPricingEditTime05Templ:function(e){var t="-",a=e.powerDivision;return t=a.time05Level?a.time05Level:"",t=n(t,"05")},powerPricingEditTime06Templ:function(e){var t="-",a=e.powerDivision;return t=a.time06Level?a.time06Level:"",t=n(t,"06")},powerPricingEditTime07Templ:function(e){var t="-",a=e.powerDivision;return t=a.time07Level?a.time07Level:"",t=n(t,"07")},powerPricingEditTime08Templ:function(e){var t="-",a=e.powerDivision;return t=a.time08Level?a.time08Level:"",t=n(t,"08")},powerPricingEditTime09Templ:function(e){var t="-",a=e.powerDivision;return t=a.time09Level?a.time09Level:"",t=n(t,"09")},powerPricingEditTime10Templ:function(e){var t="-",a=e.powerDivision;return t=a.time10Level?a.time10Level:"",t=n(t,"10")},powerPricingEditTime11Templ:function(e){var t="-",a=e.powerDivision;return t=a.time11Level?a.time11Level:"",t=n(t,"11")},powerPricingEditTime12Templ:function(e){var t="-",a=e.powerDivision;return t=a.time12Level?a.time12Level:"",t=n(t,"12")},powerPricingEditTime13Templ:function(e){var t="-",a=e.powerDivision;return t=a.time13Level?a.time13Level:"",t=n(t,"13")},powerPricingEditTime14Templ:function(e){var t="-",a=e.powerDivision;return t=a.time14Level?a.time14Level:"",t=n(t,"14")},powerPricingEditTime15Templ:function(e){var t="-",a=e.powerDivision;return t=a.time15Level?a.time15Level:"",t=n(t,"15")},powerPricingEditTime16Templ:function(e){var t="-",a=e.powerDivision;return t=a.time16Level?a.time16Level:"",t=n(t,"16")},powerPricingEditTime17Templ:function(e){var t="-",a=e.powerDivision;return t=a.time17Level?a.time17Level:"",t=n(t,"17")},powerPricingEditTime18Templ:function(e){var t="-",a=e.powerDivision;return t=a.time18Level?a.time18Level:"",t=n(t,"18")},powerPricingEditTime19Templ:function(e){var t="-",a=e.powerDivision;return t=a.time19Level?a.time19Level:"",t=n(t,"19")},powerPricingEditTime20Templ:function(e){var t="-",a=e.powerDivision;return t=a.time20Level?a.time20Level:"",t=n(t,"20")},powerPricingEditTime21Templ:function(e){var t="-",a=e.powerDivision;return t=a.time21Level?a.time21Level:"",t=n(t,"21")},powerPricingEditTime22Templ:function(e){var t="-",a=e.powerDivision;return t=a.time22Level?a.time22Level:"",t=n(t,"22")},powerPricingEditTime23Templ:function(e){var t="-",a=e.powerDivision;return t=a.time23Level?a.time23Level:"",t=n(t,"23")},powerPricingEditWeekDayTempl:function(e){return"<input class='pricing-edit-weekday' data-value='"+e.dayType+"'/>"},powerPricingEditMonthTempl:t,powerPricingEditDayTempl:o,powerPricingEditStartDateTempl:function(e){return t(e.startDate,"start")+"<span class='edit-date-hypen'>-</span>"+o(e.startDate,"start")},powerPricingEditEndDateTempl:function(e){return t(e.endDate,"end")+"<span class='edit-date-hypen'>-</span>"+o(e.endDate,"end")},powerPricingEditBaseRateTempl:function(e){var t=void 0!==e.baseRate?e.baseRate:"";return l(t,0)},powerPricingEditLevel1RateTempl:function(e){var t=void 0!==e.level1Rate?e.level1Rate:"";return l(t,1)},powerPricingEditLevel2RateTempl:function(e){var t=void 0!==e.level2Rate?e.level2Rate:"";return l(t,2)},powerPricingEditLevel3RateTempl:function(e){var t=void 0!==e.level3Rate?e.level3Rate:"";return l(t,3)}}}),define("energy/samsungsac/sac-algorithm/sac-algorithm-vm",["energy/core","energy/samsungsac/sac-algorithm/sac-algorithm-model"],function(e,t){var a=window.I18N,i=window.kendo,r=i.observable({category:{comfort:{active:!1,disabled:!1,invisible:!1,click:function(){}},prc:{active:!1,disabled:!1,invisible:!1,click:function(){}},optimal:{active:!1,disabled:!1,invisible:!1,click:function(){}}},saveBtn:{click:function(){}},showDeviceList:!0}),n=t.weatherDataSource,o=t.locationDataSource,l=t.purposeDataSource,s=new Date;s.setHours(0),s.setMinutes(0),s.setSeconds(0);var d=new Date;d.setHours(1),d.setMinutes(0),d.setSeconds(0);var c=i.observable({weather:{disabled:!1,invisible:!1,value:"South Korea",dataSource:n,select:function(e){var t=e.dataItem.value,a=o[t];a=a||[],this.location.set("dataSource",a),this.location.set("value",a[0])}},location:{disabled:!1,invisible:!1,value:o["South Korea"][0],dataSource:o["South Korea"],select:function(e){}},purpose:{disabled:!1,invisible:!1,dataValueField:"value",dataTextField:"text",value:l[0],dataSource:l,select:function(e){var t=e.dataItem.value;this.purpose.set("value",t)}},isExceptionTime:!1,showTimeAddBtn:!0,checkExceptionTime:function(){},except_times:[{start_time:s,end_time:d}]});function u(e){var t,a=this.savingLevelBtns,i=a.length;for(t=0;t<i;t++)a[t].set("active",!1);a[e].set("active",!0)}var p=i.observable({powerPricingBtn:{disabled:!0,click:function(){}},powerPricingText:a.prop("SETTINGS_ALGORITHM_NO_POWER_PRICING"),savingLevelBtns:[{active:!1,click:function(e){u.call(this,0)}},{active:!0,click:function(e){u.call(this,1)}},{active:!1,click:function(e){u.call(this,2)}}],enabled:!0}),m=t.optimalDataSource;return{MainViewModel:r,ComfortViewModel:c,PrcViewModel:p,OptimalViewModel:i.observable({optimalTime:{disabled:!1,invisible:!1,dataSource:m,value:m[0],select:function(){}}}),powerPricingViewModel:i.observable({isEdit:!1,isEmpty:!1,isDisableDeleteBtn:!0,isAdd:!1,isChangedDropDownList:!1,dropDownList:{dataSource:[],value:null,change:function(){}},editName:"",selectedNum:0,clickEditBtn:function(){},clickCreateBtn:function(){},clickAddBtn:function(){},clickDeleteBtn:function(){},disabledDelete:!0,clickTopDeleteBtn:function(){}}),Views:{comfort:{view:null,routeUrl:"/comfort"},prc:{view:null,routeUrl:"/prc"},optimal:{view:null,routeUrl:"/optimal"}}}}),define("energy/samsungsac/sac-algorithm/sac-algorithm-widget",["energy/core","energy/samsungsac/sac-algorithm/sac-algorithm-template","energy/samsungsac/sac-algorithm/sac-algorithm-vm"],function(e,t,a){var i,r,n=window.I18N,o=window.kendo;i=$("<div/>").kendoCommonDialog().data("kendoCommonDialog"),r=$("<div/>").kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog");var l,s=$("<div/>"),d=(l=s.kendoCommonDialog({title:n.prop("SETTINGS_ALGORITHM_SET_POWER_PRICING"),width:1841,height:794,timeout:0,actions:[{text:n.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}},{text:n.prop("COMMON_BTN_SAVE"),visible:!1,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}}],content:"<div class='algorithm-power-pricing-popup-content'><div class='algorithm-set-power-pricing-top'><div class='title tbc'>"+n.prop("SETTINGS_ALGORITHM_POWER_PRICING")+"</div><div class='tbc'><input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:dropDownList.value, events:{change:dropDownList.change}, source:dropDownList.dataSource, invisible:isEdit' class='power-select'/><span data-bind='visible:isEdit'><input type='text' id='prc-pricing-name' data-role='commonvalidator' data-type='name' class='k-input edit-name-field' data-bind='value:editName' required/></span></div><div class='tbc' data-bind='invisible:isEdit'><button class='k-button' data-bind='events:{click:clickEditBtn}, disabled:isEmpty'>"+n.prop("COMMON_BTN_EDIT")+"</button></div><div class='tbc' data-bind='invisible:isEdit'><button class='k-button' data-bind='events:{click:clickCreateBtn}'>"+n.prop("COMMON_BTN_ADD")+"</button></div><div class='tbc' data-bind='invisible:isEdit'><button class='k-button' data-bind='events:{click:clickTopDeleteBtn}, disabled:isDisableDeleteBtn'>"+n.prop("COMMON_BTN_DELETE")+"</button></div></div><div class='power-pricing-edit-btn' data-bind='visible:isEdit'><div class='tbc'><span class='selected-text'>"+n.prop("COMMON_SELECTED")+" : <span data-bind='text:selectedNum'></span></span></div><div class='tbc'><button class='k-button' data-bind='events:{{click:clickAddBtn}'>"+n.prop("COMMON_BTN_ADD")+"</button></div><div class='tbc'><button class='k-button' data-bind='events:{click:clickDeleteBtn}, disabled:disabledDelete'>"+n.prop("COMMON_BTN_DELETE")+"</button></div></div><div class='display-grid-wrapper edit' data-bind='invisible:isEdit'><div class='algorithm-set-power-pricing-grid'></div></div><div class='display-grid-wrapper' data-bind='visible:isEdit'><div class='algorithm-set-power-pricing-edit-grid'></div></div></div>"}).data("kendoCommonDialog")).element.find(".algorithm-power-pricing-popup-content");o.bind(d,a.powerPricingViewModel);var c,u,p,m={columns:[{title:n.prop("SETTINGS_ALGORITHM_WEEKDAY_WEEKEND"),width:"6.57%",template:t.powerPricingWeekDayTempl},{title:n.prop("SETTINGS_ALGORITHM_START_DATE"),width:"7.8%",template:t.powerPricingStartDateTempl},{title:n.prop("SETTINGS_ALGORITHM_END_DATE"),width:"7.8%",template:t.powerPricingEndDateTempl},{title:n.prop("SETTINGS_ALGORITHM_BASE_RATE")+"<br>/kW",width:"7.8%",template:t.powerPricingBaseRateTempl},{title:n.prop("SETTINGS_ALGORITHM_LEVEL1_RATE")+"<br>/kWh",width:"4.9%",template:t.powerPricingLevel1RateTempl},{title:n.prop("SETTINGS_ALGORITHM_LEVEL2_RATE")+"<br>/kWh",width:"4.9%",template:t.powerPricingLevel2RateTempl},{title:n.prop("SETTINGS_ALGORITHM_LEVEL3_RATE")+"<br>/kWh",width:"4.9%",template:t.powerPricingLevel3RateTempl},{title:n.prop("SETTINGS_ALGORITHM_HOURLY_RATE"),width:"57.6%",columns:[]}],dataSource:[],height:"100%",scrollable:!0,sortable:!1,filterable:!1,pageable:!1,noRecords:{template:"<div class='no-records-text'>"+n.prop("COMMON_NO_CONTENT_LIST")+"</div>"}},g=m.columns,v=g[g.length-1].columns;for(c=0;c<24;c++)u=c<10?"0"+c:c+"",v.push({title:u,template:t["powerPricingTime"+u+"Templ"]});console.error(g),p=s.find(".algorithm-set-power-pricing-grid").kendoGrid(m).data("kendoGrid"),m.hasCheckedModel=!0,m.setCheckedAttribute=!0;var f=[{title:n.prop("SETTINGS_ALGORITHM_WEEKDAY_WEEKEND"),width:"6.57%",template:t.powerPricingEditWeekDayTempl},{title:n.prop("SETTINGS_ALGORITHM_START_DATE"),width:"7.8%",template:t.powerPricingEditStartDateTempl},{title:n.prop("SETTINGS_ALGORITHM_END_DATE"),width:"7.8%",template:t.powerPricingEditEndDateTempl},{title:n.prop("SETTINGS_ALGORITHM_BASE_RATE")+"<br>/kW",width:"7.8%",template:t.powerPricingEditBaseRateTempl},{title:n.prop("SETTINGS_ALGORITHM_LEVEL1_RATE")+"<br>/kWh",width:"4.9%",template:t.powerPricingEditLevel1RateTempl},{title:n.prop("SETTINGS_ALGORITHM_LEVEL2_RATE")+"<br>/kWh",width:"4.9%",template:t.powerPricingEditLevel2RateTempl},{title:n.prop("SETTINGS_ALGORITHM_LEVEL3_RATE")+"<br>/kWh",width:"4.9%",template:t.powerPricingEditLevel3RateTempl},{title:n.prop("SETTINGS_ALGORITHM_HOURLY_RATE"),width:"57.6%",columns:[]}],E=[];for(c=0;c<24;c++)u=c<10?"0"+c:c+"",E.push({title:u,template:t["powerPricingEditTime"+u+"Templ"]});return f[g.length-1].columns=E,m.columns=f,{msgDialog:i,confirmDialog:r,powerPricingDialog:l,powerPricingGrid:p,powerPricingEditGrid:s.find(".algorithm-set-power-pricing-edit-grid").kendoGrid(m).data("kendoGrid")}}),define("energy/samsungsac/sac-algorithm/sac-algorithm",["energy/core","energy/samsungsac/sac-algorithm/sac-algorithm-vm","energy/samsungsac/sac-algorithm/sac-algorithm-widget","energy/samsungsac/sac-algorithm/sac-algorithm-model","energy/samsungsac/sac-algorithm/sac-algorithm-template"],function(t,e,k,G,r){var h,i,x,P=window.kendo,a=window.MAIN_WINDOW,B=window.Util,Y=window.I18N,U=window.moment,V=new window.CommonLoadingPanel,n=new P.Router,o=new P.Layout("<div id='algorithm-view-content' class='algorithm-view-content'></div>"),l=k.confirmDialog,F=k.msgDialog,H=k.powerPricingDialog,T=!1,s=$("#sac-algorithm-device-grid"),d=$("#operating-common-tab"),c=d.find(".tabbtn-sac-algorithm"),u=s.closest(".sac-algorithm-bottom-content"),p=$("#sac-algorithm-view"),m=e.MainViewModel,_=e.ComfortViewModel,b=e.PrcViewModel,D=e.OptimalViewModel,W=e.powerPricingViewModel,E=!1,g=e.Views,v=!1,f=function(){var e=a.getCurrentFloor(),t="?";return e.building.id!=a.FLOOR_NAV_BUILDING_TOTAL_ID&&e.floor.id==a.FLOOR_NAV_FLOOR_ALL_ID&&(t+="foundation_space_buildings_id="+e.building.id+"&"),e.floor.id!=a.FLOOR_NAV_FLOOR_ALL_ID&&(t+="foundation_space_floors_id="+e.floor.id),t},w=function(){i=d.data("kendoCommonTabStrip")},N=function(e){n.bind("init",A),g.comfort.view=new P.View($("#sac-algorithm-comfort-template"),{model:_,evalTemplate:!0}),n.route(g.comfort.routeUrl,y.bind(n,g.comfort.view,g.comfort.routeUrl)),g.prc.view=new P.View($("#sac-algorithm-prc-template"),{model:b,evalTemplate:!0}),n.route(g.prc.routeUrl,y.bind(n,g.prc.view,g.prc.routeUrl)),g.optimal.view=new P.View($("#sac-algorithm-optimal-template"),{model:D,evalTemplate:!0}),n.route(g.optimal.routeUrl,y.bind(n,g.optimal.view,g.optimal.routeUrl));var t=G.createDataSource(e),a=new P.data.DataSource({data:t,pageSize:50});a.read();var i={columns:[{field:"device_id",title:Y.prop("FACILITY_DEVICE_DEVICE_ID"),width:100,footerTemplate:Y.prop("FACILITY_DEVICE_NO_SELECTED"),footerAttributes:{class:"algorithm-device-selected"}},{field:"device_name",title:Y.prop("FACILITY_DEVICE_DEVICE_NAME"),width:100},{field:"algorithm_type",title:Y.prop("SETTINGS_ALGORITHM_NAME_PRC")+" / "+Y.prop("SETTINGS_ALGORITHM_NAME_COMFORT"),width:200,template:r.prcComfortTempl,sortable:!1,footerTemplate:r.prcComfortFooterTempl},{field:"comfort_option",title:Y.prop("SETTINGS_ALGORITHM_NAME_COMFORT_OPTION"),width:200,template:r.comfortOptionTempl,sortable:!1,footerTemplate:r.comfortOptionFooterTempl}],dataSource:a,height:"100%",sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!0,setCheckedAttribute:!0,scrollable:{virtual:!0}};(h=s.kendoGrid(i).data("kendoGrid")).footerRadios={},s.find(".k-grid-footer input[type='radio']").each(function(){var e=$(this),t=e.attr("id"),a=e.prop("checked"),i=e.prop("disabled");h.footerRadios[t]||(h.footerRadios[t]={}),h.footerRadios[t].checked=a,h.footerRadios[t].disabled=i}),M({sender:h,isForce:!0}),n.start(),x=$("#prc-pricing-name")},A=function(){n.replace("/"),o.render(p)},y=function(t,e){var a=e.split("/")[1];try{o.showIn("#algorithm-view-content",t),u.attr("view-name",a),"/comfort"==e&&_.trigger("change",{field:"isExceptionTime"})}catch(e){o.showIn("#algorithm-view-content",t)}},R=function(){c.on("click",function(e){a.disableFloorNav(!1),m.category.comfort.click(),T=!1}),m.category.comfort.set("click",function(e){1==m.category.comfort.get("active")&&!e||(m.category.comfort.set("active",!0),m.category.prc.set("active",!1),m.category.optimal.set("active",!1),m.set("showDeviceList",!0),n.navigate(g.comfort.routeUrl))}),m.category.prc.set("click",function(e){1==m.category.prc.get("active")&&!e||(m.category.prc.set("active",!0),m.category.comfort.set("active",!1),m.category.optimal.set("active",!1),m.set("showDeviceList",!0),n.navigate(g.prc.routeUrl))}),m.category.optimal.set("click",function(e){1==m.category.optimal.get("active")&&!e||(m.category.optimal.set("active",!0),m.category.comfort.set("active",!1),m.category.prc.set("active",!1),m.set("showDeviceList",!1),n.navigate(g.optimal.routeUrl))}),m.saveBtn.set("click",ee),b.powerPricingBtn.set("click",function(){H.setActions(0,{text:Y.prop("COMMON_BTN_CLOSE")}),H.open(),k.powerPricingGrid.refresh(),W.set("isDisableDeleteBtn",!0)}),h.bind("checked",M),h.bind("dataBound",function(){var a=h.footerRadios;h.element.find(".k-grid-footer input[type='radio']").each(function(){var e=$(this),t=e.attr("id");e.prop("disabled",a[t].disabled),e.prop("checked",a[t].checked)}),M({sender:h,isForce:!0})}),s.on("click",".k-grid-footer input[type='radio']",function(e){var t,a,i=$(this),r=i.closest("tr"),n=i.attr("id"),o=i.hasClass("type-radio"),l=q();a=i.val(),o?(t="algorithm_type","Comfort"==a?r.find("input.comfort-option-radio[type='radio']").prop("disabled",!1):r.find("input.comfort-option-radio[type='radio']").prop("disabled",!0)):t="comfort_option";var s=h.footerRadios;"algorithm_type"==t?(s["prc-all"].checked=!1,s["comfort-all"].checked=!1):(s["normal-all"].checked=!1,s["comfort-option-comfort-all"].checked=!1,s["comfort-very-all"].checked=!1),o&&"Comfort"==a?(s["normal-all"].disabled=!1,s["comfort-option-comfort-all"].disabled=!1,s["comfort-very-all"].disabled=!1):o&&(s["normal-all"].disabled=!0,s["comfort-option-comfort-all"].disabled=!0,s["comfort-very-all"].disabled=!0),s[n].checked=!0;var d,c=l.length;for(d=0;d<c;d++)l[d][t]=a;h.dataSource.fetch(),M({sender:h})}),s.on("click",".k-grid-content input[type='radio']",function(e){var t=$(this),a=t.val(),i=t.closest("tr"),r=i.data("uid"),n=t.hasClass("type-radio"),o=h.dataSource.getByUid(r);n?"Comfort"==(o.algorithm_type=a)?i.find("input.comfort-option-radio[type='radio']").prop("disabled",!1):i.find("input.comfort-option-radio[type='radio']").prop("disabled",!0):o.comfort_option=a,M({sender:h,isForce:!0}),T=!0}),p.on("click",".exception-time-wrapper .bt.plus",function(){var e=_.except_times,t=e[e.length-1].end_time,a=new Date(t),i=new Date(a),r=a.getHours()+1;24<r&&(r=24),i.setHours(r),i.setSeconds(0);var n={start_time:a,end_time:i};e.push(n)}),p.on("click",".exception-time-wrapper .except-times .timepickers .bt.minus",function(){var e=$(this);if(!e.hasClass("disabled")){var t=e.closest(".timepickers").index();_.except_times.splice(t,1)}}),p.on("click",".exception-time-wrapper .except-times .timepickers",function(){if(!$(this).hasClass("disabled")){var e=$(this).index(),t=_.except_times[e];t instanceof P.data.ObservableObject&&(t=t.toJSON()),_.beforeTimes=t}}),_.bind("change",function(e){var t=_.except_times,a=t.length;if("isExceptionTime"==e.field){if(!_.get("isExceptionTime"))return p.find(".exception-time-wrapper .except-times .timepickers input.time").each(function(){$(this).data("kendoCommonTimePicker").enable(!1)}),p.find(".exception-time-wrapper .except-times .timepickers .bt.minus").hide(),void _.set("showTimeAddBtn",!1);p.find(".exception-time-wrapper .except-times .timepickers input.time").each(function(){$(this).data("kendoCommonTimePicker").enable(!0)}),p.find(".exception-time-wrapper .except-times .timepickers .bt.minus").show(),a<3&&_.set("showTimeAddBtn",!0),1==a?p.find(".exception-time-wrapper .except-times .timepickers .bt.minus").addClass("disabled"):p.find(".exception-time-wrapper .except-times .timepickers .bt.minus").removeClass("disabled")}if("except_times"==e.field){var i,r;1==a?p.find(".exception-time-wrapper .except-times .timepickers .bt.minus").addClass("disabled"):p.find(".exception-time-wrapper .except-times .timepickers .bt.minus").removeClass("disabled"),3==a?_.set("showTimeAddBtn",!1):_.set("showTimeAddBtn",!0);var n=new Date;for(i=0;i<a;i++)if(r=t[i].end_time,n.getDate()<r.getDate()&&0==r.getHours()&&0==r.getMinutes()){_.set("showTimeAddBtn",!1);break}if("itemchange"==e.action){var o=_.beforeTimes,l=e.items[0];if(C(l))return l&&(l.set("start_time",o.start_time),l.set("end_time",o.end_time)),!1}t.sort(function(e,t){var a=e.start_time?U(e.start_time).format("HH:mm"):"-",i=t.start_time?U(t.start_time).format("HH:mm"):"-";return a.localeCompare(i)}),_.set("except_times",t)}}),W.set("clickEditBtn",function(){E=!1,W.set("isEdit",!0),W.set("isAdd",!1),H.setActions(1,{visible:!0,disabled:!0}),H.setActions(0,{text:Y.prop("COMMON_BTN_CLOSE")});var e=this.dropDownList,t=e.get("value");if(t instanceof P.data.ObservableObject&&(t=t.id),x.data("kendoCommonValidator").hideMessages(),t){var a,i,r,n=e.get("dataSource"),o=n.length;for(r=0;r<o;r++)if(n[r].id==t){i=n[r].list,a=n[r].name;break}i=i.toJSON();var l=new P.data.DataSource({data:i});k.powerPricingEditGrid.setDataSource(l),x.val(a),W.set("selectedNum",0),W.set("disabledDelete",!0)}}),W.set("clickCreateBtn",function(){x.data("kendoCommonValidator").hideMessages(),W.set("isEdit",!0),W.set("isAdd",!0),H.setActions(1,{visible:!0,disabled:!0}),H.setActions(0,{text:Y.prop("COMMON_BTN_CLOSE")});var e=new P.data.DataSource({data:[]});k.powerPricingEditGrid.setDataSource(e),x.val(""),W.set("selectedNum",0),W.set("disabledDelete",!0)}),W.set("clickAddBtn",function(){k.powerPricingEditGrid.dataSource.add(G.defaultPowerPricingListData),H.setActions(1,{disabled:!1}),E=!0}),W.set("clickTopDeleteBtn",function(){l.message(Y.prop("SETTINGS_ALGORITHM_POWER_PRICING_DELETE_CONFIRM")),l.setConfirmActions({yes:function(){var e=W.get("dropDownList"),i=e.get("dataSource"),r=e.get("value");r instanceof P.data.ObservableObject&&(r=r.id),V.open(),$.ajax({url:"/algorithm/sac/powerDivision/"+r,method:"DELETE"}).done(function(){var e=Y.prop("SETTINGS_ALGORITHM_POWER_PRICING_DELETE_RESULT");F.message(e),F.open();var t,a=i.length;for(t=0;t<a;t++)if(i[t].id==r){i.splice(t,1);break}J(i),V.close(),L()}).fail(function(e){var t=B.parseFailResponse(e);-1!=t.indexOf("enabled")&&(t=Y.prop("SETTINGS_ALGORITHM_CANNOT_DELETE_ENABLED_PRICING")),F.message(t),F.open()}).always(function(){})}}),l.open()}),W.set("clickDeleteBtn",function(){l.message(Y.prop("SETTINGS_ALGORITHM_POWER_PRICING_DELETE_CONFIRM")),l.setConfirmActions({yes:function(){var e,t,a=k.powerPricingEditGrid.dataSource,i=k.powerPricingEditGrid.getCheckedData(),r=i.length;for(t=0;t<r;t++)e=i[t],a.remove(e);F.message(Y.prop("SETTINGS_ALGORITHM_POWER_PRICING_DELETE_RESULT")),F.open(),W.set("selectedNum",0),0<k.powerPricingEditGrid.dataSource.data().length?H.setActions(1,{disabled:!1}):H.setActions(1,{disabled:!0}),E=!0}}),l.open()}),k.powerPricingEditGrid.bind("checked",function(e){var t=e.sender.getCheckedData();W.set("selectedNum",t.length),0<t.length?W.set("disabledDelete",!1):W.set("disabledDelete",!0)}),k.powerPricingEditGrid.bind("dataBound",function(e){var t=e.sender.element;t.find(".pricing-edit-weekday").each(function(){var e=$(this),t=e.data("value");"undefined"!=t&&""!=t||(t=null),e.kendoDropDownList({value:t,dataValueField:"value",dataTextField:"text",dataSource:G.powerPricingWeekDayDataSource,change:function(e){var t=e.sender.value(),a=e.sender.wrapper.closest("tr").data("uid"),i=k.powerPricingEditGrid.dataSource.getByUid(a);i?(i.dayType=t,H.setActions(1,{disabled:!1}),E=!0):console.error("item not found by uid")}})}),t.find(".pricing-edit-month").each(function(){var e=$(this),t=e.data("value");"undefined"!=t&&""!=t||(t=null),e.kendoDropDownList({value:t,dataValueField:"value",dataTextField:"text",dataSource:G.powerPricingMonthDataSource,change:function(e){var t,a,i,r,n,o,l,s,d=e.sender.value(),c=e.sender.element.data("type"),u=e.sender.wrapper.closest("tr"),p=e.sender.wrapper.closest("td"),m=u.data("uid"),g=k.powerPricingEditGrid.dataSource.getByUid(m);if(g){var v,f;if("start"==c)if(t=p.find(".pricing-edit-day[data-type='start']").data("kendoDropDownList"),v=d+"-"+(f=(v=g.startDate).split("-"))[1],S(v,g.endDate)){for(g.startDate=v,E=!0,n=U(d,"MM").daysInMonth(),r=G.createDayDataSource(n),a=t.value(),i=!1,s=r.length,l=0;l<s;l++)if(r[l].value==a){i=!0;break}i||(a=r[r.length-1].value,t.value(a),v=d+"-"+a,g.startDate=v),(o=new P.data.DataSource({data:r})).read(),t.setDataSource(o)}else F.message(Y.prop("SETTINGS_ALGORITHM_INVALID_DATE")),F.open(),e.sender.value(f[0]);else if(t=p.find(".pricing-edit-day[data-type='end']").data("kendoDropDownList"),v=d+"-"+(f=(v=g.endDate).split("-"))[1],S(g.startDate,v)){for(g.endDate=v,E=!0,n=U(d,"MM").daysInMonth(),r=G.createDayDataSource(n),a=t.value(),i=!1,s=r.length,l=0;l<s;l++)if(r[l].value==a){i=!0;break}i||(a=r[r.length-1].value,t.value(a),v=d+"-"+a,g.endDate=v),(o=new P.data.DataSource({data:r})).read(),t.setDataSource(o)}else F.message(Y.prop("SETTINGS_ALGORITHM_INVALID_DATE")),F.open(),e.sender.value(f[0]);H.setActions(1,{disabled:!1})}else console.error("item not found by uid")}})}),t.find(".pricing-edit-day").each(function(){var e=$(this),t=e.closest("td").find(".pricing-edit-month[data-role='dropdownlist']").data("kendoDropDownList"),a=e.data("value");"undefined"!=a&&""!=a||(a=null);var i=t.value(),r=G.powerPricingDayDataSource;if(i){var n=U(i,"MM").daysInMonth();r=G.createDayDataSource(n)}e.kendoDropDownList({value:a,dataValueField:"value",dataTextField:"text",dataSource:r,change:function(e){var t,a,i=e.sender.value(),r=e.sender.element.data("type"),n=e.sender.wrapper.closest("tr").data("uid"),o=k.powerPricingEditGrid.dataSource.getByUid(n);o?("start"==r?(t=(a=(t=o.startDate).split("-"))[0]+"-"+i,S(t,o.endDate)?(o.startDate=t,E=!0):(F.message(Y.prop("SETTINGS_ALGORITHM_INVALID_DATE")),F.open(),e.sender.value(a[1]))):(t=(a=(t=o.endDate).split("-"))[0]+"-"+i,S(o.startDate,t)?(o.endDate=t,E=!0):(F.message(Y.prop("SETTINGS_ALGORITHM_INVALID_DATE")),F.open(),e.sender.value(a[1]))),H.setActions(1,{disabled:!1})):console.error("item not found by uid")}})})}),k.powerPricingEditGrid.element.on("change",".power-pricing-hourly-level.edit",function(e){I.call(this,e)}),k.powerPricingEditGrid.element.on("input",".power-pricing-hourly-level.edit",function(e){O.call(this,e)&&(E=!0)}),k.powerPricingEditGrid.element.on("focusout",".power-pricing-hourly-level.edit",function(e){I.call(this,e)}),k.powerPricingEditGrid.element.on("change",".pricing-edit-rate",function(e){I.call(this,e)}),k.powerPricingEditGrid.element.on("input",".pricing-edit-rate",function(e){O.call(this,e)&&(E=!0)}),k.powerPricingEditGrid.element.on("focusout",".pricing-edit-rate",function(e){I.call(this,e)}),x.on("keyup",function(){0<k.powerPricingEditGrid.dataSource.total()&&H.setActions(1,{disabled:!1})}),x.on("change",function(){E=!0}),W.dropDownList.set("change",function(e){var t=b.get("powerPricingText"),a=this.dropDownList.get("value");if(a){a.name==t?(this.set("isDisableDeleteBtn",!0),this.set("isChangedDropDownList",!1),H.setActions(0,{text:Y.prop("COMMON_BTN_CLOSE")})):(this.set("isDisableDeleteBtn",!1),this.set("isChangedDropDownList",!0),H.setActions(0,{text:Y.prop("COMMON_BTN_APPLY")}));var i=a.list;i.sort(function(e,t){var a=e.startDate?e.startDate:"-",i=t.startDate?t.startDate:"-";return a.localeCompare(i)});var r=new P.data.DataSource({data:i});k.powerPricingGrid.setDataSource(r)}}),H.setActions(0,{action:X}),H.setCloseAction(X),H.setActions(1,{action:function(){var e=W.get("isEdit"),t=W.get("isAdd");if(!x.data("kendoCommonValidator").validate())return!1;if(e){var a,i,r,n,o,l,s=W.get("dropDownList"),d=x.val(),c=s.get("dataSource"),u=k.powerPricingEditGrid.dataSource.data(),p=!1,m=!1,g=(u=u.toJSON()).length,v=[],f=[],E=[];for(a=0;a<g;a++)void 0!==u[a].isCreated&&delete u[a].isCreated,"01-01"==u[a].startDate&&(p=!0),o=(i=u[a].startDate.split("-"))[0],l=i[1],(r=new Date).setMonth(Number(o)-1),r.setDate(l),n=U(r),v.push(n),"12-31"==u[a].endDate&&(m=!0),o=(i=u[a].endDate.split("-"))[0],l=i[1],(r=new Date).setMonth(Number(o)-1),r.setDate(l),n=U(r),f.push(n),E.push(u[a].dayType);var h,T,_,b,D,w,N,A,y,R,L=0;for(T=v.length,a=0;a<T;a++){for(_=v[a],b=f[a],N=E[a],y=z(_,b,N),h=0;h<T;h++)if(D=v[h],w=f[h],A=E[h],(_!==D||b!==w||N!==A)&&(R=z(D,w,A),j(y,R)))return F.message(Y.prop("SETTINGS_ALGORITHM_DUPLICATE_DATE")),F.open(),!1;L+=y.length}if(L<730)return F.message(Y.prop("SETTINGS_ALGORITHM_MISSING_DATE")),F.open(),!1;if(!p||!m)return F.message(Y.prop("SETTINGS_ALGORITHM_REQUIRED_DATE")),F.open(),!1;var C,S={name:d,list:u};if(V.open(H.element),t)S.enable=!1,C=$.ajax({url:"/algorithm/sac/powerDivision",method:"POST",data:S}).done(function(){F.message(Y.prop("SETTINGS_ALGORITHM_POWER_PRICING_CREATE_RESULT")),F.open()});else{var I=s.get("value");I instanceof P.data.ObservableObject&&(I=I.id);var O,M=c.length;for(O=0;O<M;O++)if(c[O].id==I){S.enable=c[O].enable;break}C=$.ajax({url:"/algorithm/sac/powerDivision/"+I,method:"PATCH",data:S}).done(function(){F.message(Y.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED")),F.open()})}C.done(function(){$.ajax({url:"/algorithm/sac/powerDivision"}).done(function(e){J(e)}).fail(function(){J(G.powerPricingMockData)}).always(function(){X(null,null,!0),V.close()})}).fail(function(e){var t=B.parseFailResponse(e);F.message(t),F.open(),V.close()})}return!1}})},L=function(){!function(){var e=b.get("powerPricingText"),t=W.get("dropDownList"),a=t.dataSource,i=t.value;if(null==i)return!1;if(a.length<1)return!1;var r=0,n=a.length,o=null,l=i instanceof P.data.ObservableObject?i.id:i;for(r=0;r<n&&(o=a[r]).id!=l;r++);return e==o.name}()?(W.set("isDisableDeleteBtn",!1),H.setActions(0,{text:Y.prop("COMMON_BTN_APPLY")})):(W.set("isDisableDeleteBtn",!0),H.setActions(0,{text:Y.prop("COMMON_BTN_CLOSE")}))},j=function(e,t){var a,i,r,n,o,l,s,d,c=e.length,u=t.length;for(a=0;a<c;a++)for(r=(l=e[a]).date,o=l.dayType,i=0;i<u;i++)if(n=(s=t[i]).date,d=s.dayType,r.format("MMDD")==n.format("MMDD")&&o==d)return!0;return!1},z=function(e,t,a){var i=[],r=t.diff(e,"days");i=[];var n,o,l,s=e.date();for(n=s;n<=s+r;n++)o=U(e).date(n),l="all"==a?(l={date:o,dayType:"weekend"},i.push(l),{date:o,dayType:"weekday"}):{date:o,dayType:a},i.push(l);return i},C=function(e){var t=e.start_time,a=e.end_time;if(t=U(t),(a=U(a)).isSameOrBefore(t,"minute"))return!0;var i=new Date;return i.setDate(i.getDate()+1),i.setHours(0),i.setMinutes(0),i=U(i),!(!a.isSame(i,"day")||!a.isAfter(i,"minute"))},S=function(e,t){var a=e.split("-"),i=Number(a[0]),r=Number(a[1]);a=t.split("-");var n=Number(a[0]),o=Number(a[1]);return!(n<i)&&!(i==n&&o<r)},X=function(e,t,a){if(W.get("isEdit"))E&&!a?(l.message(Y.prop("COMMON_MESSAGE_CONFIRM_CANCEL")),l.setConfirmActions({yes:function(){W.set("isEdit",!1),W.set("isAdd",!1),H.setActions(1,{visible:!1}),L(),E=!1}}),l.open()):(W.set("isEdit",!1),W.set("isAdd",!1),H.setActions(1,{visible:!1}),L());else{var i=W.get("dropDownList"),r=i.get("dataSource"),n=i.get("value");if(!n)return b.set("powerPricingText",Y.prop("SETTINGS_ALGORITHM_NO_POWER_PRICING")),void H.close();n instanceof P.data.ObservableObject&&(n=n.id),V.open(H.element),$.ajax({url:"/algorithm/sac/powerDivision/"+n,method:"PATCH",data:{enable:!0}}).fail(function(e){var t=B.parseFailResponse(e);F.message(t),F.open()}).always(function(){var e,t,a=r.length;for(e=0;e<a;e++)if(r[e].id==n){t=r[e],b.set("powerPricingText",t.name);break}V.close(),H.close()})}return!1},I=function(e){var t,a=$(this),i=a.data("max"),r=a.data("min"),n=a.val(),o=a.closest("tr"),l=a.data("key"),s=o.data("uid"),d=k.powerPricingEditGrid.dataSource.getByUid(s),c=0;if(c=-1==l.indexOf("Rate")?d.powerDivision[l]:d[l],void 0===n||""==n)a.val(c),F.message(Y.prop("COMMON_REQUIRED_INFORMATION")),F.open();else if(i<(n=Number(n))||n<r)return a.val(c),t=a.hasClass("pricing-edit-rate")?a.hasClass("base")?Y.prop("SETTINGS_ALGORITHM_REQUIRED_BASE_RATE"):Y.prop("SETTINGS_ALGORITHM_REQUIRED_LEVEL_RATE"):Y.prop("SETTINGS_ALGORITHM_REQUIRED_LEVEL3"),F.message(t),F.open(),!1;d?(-1==l.indexOf("Rate")?(d.powerDivision[l]=n,E=!0):d[l]=n,H.setActions(1,{disabled:!1})):console.error("not found item by uid")},O=function(e){var t=$(this),a=/^[1-9]+$/;-1<t.data("key").indexOf("Rate")&&(a=/^\d+\.?\d*$/);var i=t.val();if(""==i||i.match(a))return!0;var r=t.closest("tr"),n=t.data("key"),o=r.data("uid"),l=k.powerPricingEditGrid.dataSource.getByUid(o),s=0;return l&&(s=-1==n.indexOf("Rate")?l.powerDivision[n]:l[n]),t.val(s),F.message(Y.prop("COMMON_INVALID_CHARACTER")),F.open(),!1},M=function(e){var t=e.sender.element.find(".k-grid-footer"),a=e.isForce,i=t.find("input[type='radio']"),r=h.footerRadios,n=q(),o=n.length;if(!e.isHeader&&e.item){var l=!e.item.checked,s=e.checkbox.closest("tr");"Comfort"==e.item.algorithm_type?s.find("input[type='radio']").prop("disabled",l):s.find("input.type-radio[type='radio']").prop("disabled",l)}if(0==o)i.each(function(){var e=$(this),t=e.attr("id");e.prop("disabled",!0),r[t].disabled=!0});else{var d,c=!0,u=!0,p={isOnlyNormal:!0,isOnlyComfort:!0,isOnlyVeryComfort:!0};for(d=0;d<o;d++)"Comfort"!=n[d].algorithm_type&&(c=!1),"PRC"!=n[d].algorithm_type&&(u=!1),"Normal"!=n[d].comfort_option&&(p.isOnlyNormal=!1),"Comfort"!=n[d].comfort_option&&(p.isOnlyComfort=!1),"VeryComfort"!=n[d].comfort_option&&(p.isOnlyVeryComfort=!1);c?(t.find("#comfort-all").prop("checked",!0),t.find("#prc-all").prop("checked",!1)):(u?t.find("#prc-all").prop("checked",!0):t.find("#prc-all").prop("checked",!1),t.find("#comfort-all").prop("checked",!1)),p.isOnlyNormal?(t.find("#normal-all").prop("checked",!0),t.find("#comfort-option-comfort-all").prop("checked",!1),t.find("#comfort-very-all").prop("checked",!1)):p.isOnlyComfort?(t.find("#normal-all").prop("checked",!1),t.find("#comfort-option-comfort-all").prop("checked",!0),t.find("#comfort-very-all").prop("checked",!1)):p.isOnlyVeryComfort?(t.find("#normal-all").prop("checked",!1),t.find("#comfort-option-comfort-all").prop("checked",!1),t.find("#comfort-very-all").prop("checked",!0)):(t.find("#normal-all").prop("checked",!1),t.find("#comfort-option-comfort-all").prop("checked",!1),t.find("#comfort-very-all").prop("checked",!1));var m=t.find("#comfort-all").prop("checked");i.each(function(){var e=$(this),t=e.hasClass("comfort-option-radio"),a=e.attr("id");!m&&t?(e.prop("disabled",!0),r[a].disabled=!0):(e.prop("disabled",!1),r[a].disabled=!1)})}K(o),a||(T=!0)},K=function(e){var t="";t=0==e?Y.prop("FACILITY_DEVICE_NO_SELECTED"):Y.prop("FACILITY_DEVICE_SELECTED",e),s.find(".k-grid-footer").find(".algorithm-device-selected").text(t)},q=function(){return h.getCheckedData()},Q=function(e){if(T)return l.message(Y.prop("COMMON_CONFIRM_DIALOG_EDIT_SAVE")),l.setConfirmActions({yes:function(){T=!1,ee(),Q(e)},no:function(){T=!1,Q(e)}}),void l.open();var t=f();V.open(),$.ajax({url:"/algorithm/sac/device-setting"+t}).done(function(e){var t=G.createDataSource(e),a=new P.data.DataSource({data:t,pageSize:50});a.read(),h.setDataSource(a)}).fail(function(){var e=G.createDataSource(G.MockData),t=new P.data.DataSource({data:e});t.read(),h.setDataSource(t)}).always(function(){V.close()})},Z=function(e){var t=e.weather_location,a=t.country,i=t.city,r=G.locationDataSource;r=r[a]?r[a]:[],console.info(a),console.info(i),_.weather.set("value",a),_.location.set("dataSource",r),_.location.set("value",i);var n=e.facility;_.purpose.set("value",n);var o,l=e.except_time;if(l){l.sort(function(e,t){return e=e.start_time?e.start_time:"-",t=t.start_time?t.start_time:"-",e.localeCompare(t)});var s,d,c,u=l.length;for(s=0;s<u;s++)d=l[s].start_time,c=l[s].end_time,d=d.split(":"),c=c.split(":"),(o=new Date).setHours(d[0]),o.setMinutes(d[1]),o.setSeconds(0),l[s].start_time=o,(o=new Date).setHours(c[0]),o.setMinutes(c[1]),o.setSeconds(0),"00"==c[0]&&o.setDate(o.getDate()+1),l[s].end_time=o;0<u?(_.set("except_times",l),_.set("isExceptionTime",!0)):_.set("isExceptionTime",!1)}else _.set("isExceptionTime",!1);var p=e.optimal_start_time;D.optimalTime.set("value",p);var m=void 0!==e.prc_enabled&&e.prc_enabled;b.set("enabled",m);var g=e.prc_saving_level;g&&(g=g.replace("Level",""),g=Number(g)-1,b.savingLevelBtns[g].click.call(b))},J=function(e){if(e.length<1){W.set("isEmpty",!0);var t=new P.data.DataSource({data:[]});k.powerPricingGrid.setDataSource(t),k.powerPricingEditGrid.setDataSource(t),W.dropDownList.set("value",null)}else W.set("isEmpty",!1);W.dropDownList.set("dataSource",e);var a,i,r,n=e.length,o=!1;for(a=0;a<n;a++)if(e[a].enable){o=!0,W.dropDownList.set("value",e[a].id),b.set("powerPricingText",e[a].name),(r=e[a].list).sort(function(e,t){var a=e.startDate?e.startDate:"-",i=t.startDate?t.startDate:"-";return a.localeCompare(i)}),i=new P.data.DataSource({data:r}),k.powerPricingGrid.setDataSource(i),k.powerPricingEditGrid.setDataSource(i);break}!o&&0<n&&(W.dropDownList.set("value",e[0].id),b.set("powerPricingText",e[0].name),(r=e[0].list).sort(function(e,t){var a=e.startDate?e.startDate:"-",i=t.startDate?t.startDate:"-";return a.localeCompare(i)}),i=new P.data.DataSource({data:r}),k.powerPricingGrid.setDataSource(i),k.powerPricingEditGrid.setDataSource(i))},ee=function(e){V.open(),T=!1;var t,a,i={},r=h.dataSource.data(),n=[],o=r.length;for(a=0;a<o;a++)(t=r[a])instanceof P.data.ObservableObject&&(t=t.toJSON()),n.push(t),n[a].checked||(n[a].algorithm_type="Manual",r[a].algorithm_type="Manual"),delete n[a].checked,"Comfort"!=n[a].algorithm_type&&delete n[a].comfort_option;i.device_setting_list=n;var l={},s=_.weather.get("value"),d=_.location.get("value");if(d instanceof P.data.ObservableObject&&(d=d.value),l.weather_location={country:s,city:d},l.facility=_.purpose.get("value"),l.except_time=[],_.get("isExceptionTime")){var c,u,p,m=_.except_times;if(function(e){var t,a,i,r,n,o,l=e.length;for(t=0;t<l;t++)for(i=e[t].start_time,i=U(i),r=e[t].end_time,r=U(r),a=0;a<l;a++)if(n=e[a].start_time,o=e[a].end_time,(i!==n||r!==o)&&(n=U(n),o=U(o),n.isBetween(i,r,null,"()")||o.isBetween(i,r,null,"()")))return!0;return!1}(m))return F.message(Y.prop("SETTINGS_ALGORITHM_DUPLICATE_TIME")),F.open(),void V.close();for(o=m.length,a=0;a<o;a++)c=(p=m[a]).start_time,u=p.end_time,c=U(c).format("HH:mm"),u=U(u).format("HH:mm"),l.except_time.push({start_time:c,end_time:u})}l.optimal_start_time=D.optimalTime.get("value");var g,v=b.savingLevelBtns;for(o=v.length,a=0;a<o;a++)if(v[a].get("active")){g="Level"+(a+1);break}g&&(l.prc_saving_level=g);var f=b.get("enabled");l.prc_enabled=f;var E=[];E.push($.ajax({url:"/algorithm/sac/device-setting",method:"PATCH",data:i})),E.push($.ajax({url:"/algorithm/sac/common-setting",method:"PATCH",data:l})),$.when.apply(this,E).done(function(){F.message(Y.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED")),F.open()}).fail(function(e){var t=B.parseFailResponse(e);F.message(t),F.open()}).always(function(){h.dataSource.fetch(),M({sender:h,isForce:!0}),V.close()})};return function(){w(),c.on("click",function(){if(!v){v=!0;var a=i.contentElement(c.index());V.open();var e=f();$.ajax({url:"/algorithm/sac/device-setting"+e}).done(function(e){P.bind($(a),m),N(e),R(),c.trigger("click")}).fail(function(e){var t=B.parseFailResponse(e);F.message(t),P.bind($(a),m),N(G.MockData),R(),c.trigger("click")}).always(function(){V.close(),t.on("onfloorchange",Q),V.open(),$.ajax({url:"/algorithm/sac/common-setting"}).done(function(e){Z(e)}).fail(function(){Z(G.SettingMockData)}).always(function(){V.close(),V.open(),$.ajax({url:"/algorithm/sac/powerDivision"}).done(function(e){J(e)}).fail(function(){J(G.powerPricingMockData)}).always(function(){V.close()})})})}})}}),define("device/common/device-constants",[],function(){"use strict";var e=window.I18N;return{TIME_OUT:1500,ALL_TIME_INTERVAL:4e4,PANEL_REFRESH_TIME:1e3,BEACON_TIME_INTERVAL:5e3,DISPLAY_NAME_MAX:6,INDOOR_TYPE:["AirConditioner.Indoor","AirConditioner.AHU","AirConditioner.Chiller","AirConditioner.EHS","AirConditioner.ERV","AirConditioner.ERVPlus",["AirConditioner.FCU","AirConditioner.SFCU"],"AirConditioner.DuctFresh"],OUTDOOR_TYPE:["AirConditioneromOutdoor"],POINT_TYPE:["ControlPoint.AI","ControlPoint.AO","ControlPoint.DI","ControlPoint.DO","ControlPoint.AV","ControlPoint.DV"],ENERGY_TYPE:["Meter.WattHour","Meter.Gas","Meter.Water","Meter.Calorimeter"],SENSOR_TEMP_HUM_TYPE:["Sensor.Temperature_Humidity","Sensor.Humidity","Sensor.Temperature"],STATUS:["Normal.On","Normal.Off","Alarm.Critical","Alarm.Warning"],BEACON_STATUS:["Normal","Disconnected","WrongLocation","LowBattery"],BEACON_ACTION:{BLOCK:1,DELETE:2,REGISTER:3,DETAIL:4},BEACON_LOCATION_TYPE:["Fixed","Movable"],ASSET_FILTER:{TYPE:0,LOCATION:1,STATUS:2,ZONE:3,SELECTALL:4},ASSET_ACTION:{ASSET_TYPE:1,EXPORT:2,IMPORT:3,REGISTER:4,DELETE:5,DETAIL:6},ONOFF:["On","Off"],MODE:[{mode:"Auto",id:"AirConditioner.Indoor.General"},{mode:"Cool",id:"AirConditioner.Indoor.General"},{mode:"Heat",id:"AirConditioner.Indoor.General"},{mode:"Dry",id:"AirConditioner.Indoor.General"},{mode:"Fan",id:"AirConditioner.Indoor.General"},{mode:"CoolStorage",id:"AirConditioner.Indoor.General"},{mode:"HeatStorage",id:"AirConditioner.Indoor.General"},{mode:"vAuto",id:"AirConditioner.Indoor.Ventilator"},{mode:"HeatExchange",id:"AirConditioner.Indoor.Ventilator"},{mode:"ByPass",id:"AirConditioner.Indoor.Ventilator"},{mode:"Sleep",id:"AirConditioner.Indoor.Ventilator"},{mode:"Eco",id:"AirConditioner.Indoor.DHW"},{mode:"Standard",id:"AirConditioner.Indoor.DHW"},{mode:"Power",id:"AirConditioner.Indoor.DHW"},{mode:"Force",id:"AirConditioner.Indoor.DHW"}],TEXT:{SELECTALL:e.prop("COMMON_BTN_SELECT_ALL"),DESELECTALL:e.prop("COMMON_BTN_DESELECT_ALL"),REGISTER:e.prop("COMMON_BTN_REGISTER"),DEREGISTER:e.prop("COMMON_BTN_DEREGISTER"),VIEW:e.prop("COMMON_BTN_VIEW"),DELETE:e.prop("COMMON_BTN_DELETE")},FILTER:{TYPE:0,STATUS:1,MODE:2,ZONE:3,SELECTALL:4,REGEND:5},ACTION:{REGISTER:1,DETAIL:2},NW_ACTION:{DELETE:1,REGISTER:2,DETAIL:3,VIEW:4},VIEW:{STATISTIC:0,MAP:1,LIST:2,GRID:3},SEARCH:{EDIT:0,BUTTON:1},displayShort:[{value:"CoolStorage",display:"CoolSt"},{value:"HeatStorage",display:"HeatSt"},{value:"HeatExchange",display:"HeatEx"}],controlSet:[[{apiName:"operations",id:"AirConditioner.Indoor.General",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.Ventilator",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.DHW",parameter:"power"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.General.Speed",parameter:"wind"},{},{apiName:"modes",id:"AirConditioner.Indoor.ModeLimit",parameter:"mode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"}],[{apiName:"configuration",parameter:"remoteControl"},{apiName:"airConditioner",parameter:"filterResetRequired"},{apiName:"airConditioner",parameter:"spi"},{apiName:"airConditioner",parameter:"stillAir"}],{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.Ventilator",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.Ventilator.Speed",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.DHW",parameter:"mode"},[{apiName:"airConditioner",parameter:"chiller",underParameter:"waterLaw"},{apiName:"airConditioner",parameter:"chiller",underParameter:"quiet"},{apiName:"airConditioner",parameter:"chiller",underParameter:"forcedFan"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demand"}],{apiName:"airConditioner",parameter:"chiller",underParameter:"mccMode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"desired"}],[{apiName:"temperatures",id:"AirConditioner.Indoor.Room",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"desired",Heat:"AirConditioner.Indoor.DischargeAir.Heat",Cool:"AirConditioner.Indoor.DischargeAir.Cool"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"enabled"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demandLevel"}],outdoorControlConfig:{electricCurrentControl:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:50,text:"50%"},{value:55,text:"55%"},{value:60,text:"60%"},{value:65,text:"65%"},{value:70,text:"70%"},{value:75,text:"75%"},{value:80,text:"80%"},{value:85,text:"85%"},{value:90,text:"90%"},{value:95,text:"95%"},{value:100,text:"100%"}],coolingCapacityCalibration:{Celsius:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"5~7\xb0C"},{value:"7~9",text:"7~9\xb0C"},{value:"9~11",text:"9~11\xb0C"},{value:"10~12",text:"10~12\xb0C"},{value:"11~13",text:"11~13\xb0C"},{value:"12~14",text:"12~14\xb0C"},{value:"13~15",text:"13~15\xb0C"}],Fahrenheit:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"41~45\xb0F"},{value:"7~9",text:"45~48\xb0F"},{value:"9~11",text:"48~52\xb0F"},{value:"10~12",text:"50~54\xb0F"},{value:"11~13",text:"52~55\xb0F"},{value:"12~14",text:"54~57\xb0F"},{value:"13~15",text:"55~59\xb0F"}]},heatingCapacityCalibration:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:25,text:"25kg/cm\xb2"},{value:26,text:"26kg/cm\xb2"},{value:27,text:"27kg/cm\xb2"},{value:28,text:"28kg/cm\xb2"},{value:29,text:"29kg/cm\xb2"},{value:30,text:"30kg/cm\xb2"},{value:31,text:"31kg/cm\xb2"},{value:32,text:"32kg/cm\xb2"},{value:33,text:"33kg/cm\xb2"}]},INNER_LAYOUT:{MONITORING:0,REGISTRATION:1},FILTER_NAME:{SELECTALL:"selectAll",ZONE:"zone",STATUS:"status",TYPE:"type",MODE:"mode",ASSET_TYPE:"assetType"},ACTION_NAME:{DETAIL:"detail",REGISTER:"register",DELETE:"delete",BLOCK:"block",SELECTEDTEXT:"selectedText",VIEW:"view",ASSET_TYPE:"assetType"},REGISTRATION_STATUS_BUTTONS:{REGISTER:0,UNREGISTER:1},LIGHT_CONTROL:{POWER:0,DIMMING:1}}}),define("device/common/device-util",["device/common/device-constants"],function(l){"use strict";function s(){for(var e=N.getDefaultViewType(),t=e.length,a="statistic",i=0;i<t;i++)if("Facility.Device"==e[i].menu){a=(a=e[i].view).toLowerCase();break}return a}function a(e){var t=e.locations,a="-";if(void 0!==e.assets_types_id)return L(e);if(t&&0<t.length){a="";var i=t[0];if(i.description)return i.description;i.foundation_space_buildings_id&&(a+=i.foundation_space_buildings_id+" "),i.foundation_space_floors_id&&(a+=i.foundation_space_floors_id)}return a}function i(e){var t=e.groups,a="-";if(t){var i=t.length;0<i&&(a="",(a=t[0].dms_groups_name)&&1<i&&(a+="(+"+(i-1)+")"))}return A.decodeHtml(a)}function r(e,t){var a,i,r,n,o=e.temperatures,l=e.airConditioner,s="-",d="-",c=!1;l&&l.temperatureReference&&-1<l.temperatureReference.indexOf("WaterOutlet")&&(c=!0),!o||0<o.length&&(c&&(n=$.grep(o,function(e){return"AirConditioner.Indoor.WaterOutlet"==e.id}))&&n.length&&void 0!==(n=n[0]).desired&&(d=n.desired.toFixed(1)),(n=$.grep(o,function(e){return"AirConditioner.Indoor.Room"==e.id}))&&n.length&&(n=n[0],c||void 0!==n.desired&&(d=n.desired.toFixed(1)),void 0!==n.current&&(s=n.current.toFixed(1))),(n=$.grep(o,function(e){return"AirConditioner.Indoor.DHW"==e.id}))&&n.length&&(void 0!==(n=n[0]).desired&&(a=n.desired.toFixed(1)),void 0!==n.current&&(i=n.current.toFixed(1))),(n=$.grep(o,function(e){return"AirConditioner.Outdoor"==e.id}))&&n.length&&(void 0!==(n=n[0]).desired&&(d=n.desired.toFixed(1)),void 0!==n.current&&(s=n.current.toFixed(1))));var u=e.modes;return u&&(n=$.grep(u,function(e){return"AirConditioner.Indoor.General"==e.id&&"Fan"==e.mode}))&&n.length&&(d="-"),r="Celsius"===N.getTemperature().unit?"\xb0C":"\u2109","-"!==d&&t&&(d+=r),"-"!==s&&t&&(s+=r),a&&t&&(a+=r),i&&t&&(i+=r),{isWaterout:c,desired:d,current:s,unit:r,dhwDesired:a,dhwCurrent:i}}function n(e,r,t){var n;return"vAuto"===t&&(n="AirConditioner.Indoor.Ventilator",t="Auto"),{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){var a,i=e.length;if("undefined"==t){for(a=0;a<i;a++)if(void 0===e[a][r])return!0}else for(a=0;a<i;a++)if(e[a][r]==t)return!n||(n===e[a].id||void 0)}},value:t}}function o(e,r,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){for(var a=e.length,i=0;i<a;i++)if(e[i][r]!=t)return;return!0}},value:t}}function d(e){return{field:e,operator:function(e){if(e)return 0===e.length||void 0}}}function c(e){var t,a,i,r,n="-";if(a=e.meters){for(n="",i=a.length,t=0;t<i;t++)(r=a[t].category)&&("AirConditionerAll"==r&&(r="SAC"),n+=r,t!=i-1&&(n+=", "));n=(n=n||"Others").toUpperCase(),n=y.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_"+n)}return n}function u(e){var t="-",a=e.type;return a&&(-1!=a.indexOf("ControlPoint")&&(a=e.mappedType),t=(t=(t=A.getDisplayType(a))||"WattHour").toUpperCase(),t=(t=y.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_"+t))||y.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATTHOUR")),t}function p(e){var t,a,i,r,n="",o=e.type;if(o&&-1!=o.indexOf("ControlPoint")){var l=e.controlPoint;l&&void 0!==l.value&&(n=A.convertNumberFormat(l.value))}else if(a=e.meters)for(i=a.length,t=0;t<i;t++)null!=(r=A.convertNumberFormat(a[t].reading))&&(n+=r,t!=i-1&&(n+=", "));return n=""!=n?n:"-"}function m(e){var t,a="-",i=e.networks;return i&&i[0]&&(i=i[0],e.type,i[t="ethernet"]&&(a=(a=i[t].ipAddress)||"-")),a}function g(e){var t,a="-",i=e.networks;return i&&i[0]&&(i=i[0],e.type,i[t="ethernet"]&&(a=(a=i[t].macAddress)||"-")),a}function v(e){var t,a,i="-",r=e.networks;return r&&r[1]&&((r=r[1]).connected?(t=e.alarms)&&0<t.length?(t.sort(function(e,t){return e=e.alarms_event?e.alarms_event:"-",(t=t.alarms_event?t.alarms_event:"-").localeCompare(e)}),"Critical"==(a=t[0].alarms_type)?i="Connected (Poor)":"Warning"==a&&(i="Connected (Fair)")):i="Connected (Good)":i="Disconnected",i=i||"-"),i}function f(e,t,a,i){var r,n,o,l=0;if((r=e.networks)&&r[0])for(o=r.length,n=0;n<o;n++)if(r[n].type==t){if(!a)return r[n];if(r[n].ble&&r[n].ble.role==a){if(void 0===i)return r[n];if(i==l)return r[n];l++}}return{}}function E(e,t){var a,i,r,n="-",o=e.networks;if(o&&o[0]){for(i=o.length,a=0;a<i;a++)if(o[a].ble){r=o[a].ble;break}r&&(n=(n=r[t])||"-")}return n}function h(e){return E(e,"macAddress")}function T(e){return E(e,"uuid")}function _(e){var t="-",a=e.rules;return a&&(t=0<a.length?"O":"X"),t}function b(e){var t="-",a=e.schedules;return a&&(t=0<a.length?"O":"X"),t}function t(e,t){var a,i="-",r=e.information;if(r&&r.versions){var n,o=(a=r.versions).length;for(n=0;n<o;n++)if(a[n].type==t){i=a[n].number?a[n].number:i;break}}return i}function D(e){var t="-";return e.controlPoint&&e.controlPoint.tagName&&(t=e.controlPoint.tagName),t}var w=window.MAIN_WINDOW,N=window.GlobalSettings,A=window.Util,y=window.I18N,R=window.kendo,L=function(e){var t="-",a=e.location;if(a){if(a.description)return a.description;t="",a.foundation_space_buildings_id&&(t+=a.foundation_space_buildings_id+" "),a.foundation_space_floors_id&&(t+=a.foundation_space_floors_id)}return t};return{isAllFloorCheck:function(){var e=!1,t=w.getCurrentFloor();return t&&t.floor&&"ALL"==t.floor.value&&(e=!0),e},getDefaultView:s,goClick:function(e,t,a,i){var r,n={};if(void 0===i){var o=window.localStorage.getItem("deviceViewType");o?(r=l.VIEW[o],window.localStorage.removeItem("deviceViewType")):r=l.VIEW[s().toUpperCase()]}else r=i;return e?t?a==w.FLOOR_NAV_BUILDING_TOTAL_ID||a==w.FLOOR_NAV_FLOOR_ALL_ID?r===l.VIEW.MAP&&(r=l.VIEW.STATISTIC):r===l.VIEW.STATISTIC&&(r=l.VIEW.MAP):r===l.VIEW.MAP?a==w.FLOOR_NAV_BUILDING_TOTAL_ID?n.building=!0:a==w.FLOOR_NAV_FLOOR_ALL_ID&&(n.floor=!0):r===l.VIEW.STATISTIC&&a!=w.FLOOR_NAV_BUILDING_TOTAL_ID&&a!=w.FLOOR_NAV_FLOOR_ALL_ID&&(n.floor=!1):(a==w.FLOOR_NAV_BUILDING_TOTAL_ID?n.building=!0:a==w.FLOOR_NAV_FLOOR_ALL_ID&&(n.floor=!0),r=l.VIEW.MAP),n.floor&&!w.getCurrentFloorList().length&&(n.floor=!1,n.noFloor=!0),n.view=r,n},getStatus:function(e){return A.getStatus(e)},getLocation:a,getCurrentLocation:function(e){var t,a,i=e.locations,r="-";if(i)for(a=i.length,t=0;t<a;t++)if("Measured"==i[t].id){r="";var n=i[t];if(n.description)return n.description;n.foundation_space_buildings_id&&(r+=n.foundation_space_buildings_id+" "),n.foundation_space_floors_id&&(r+=n.foundation_space_floors_id);break}return r},locations:a,getGroup:i,group:i,getGridIcon:function(e){var t=0,a=[],i=e.airConditioner;if(i){var r=i.peakPowerControl;r&&"On"===r&&t<5&&(a[t++]="ic-peak")}var n=e.configuration;if(n){var o=n.remoteControl;o&&"NotAllowed"===o&&t<5&&(a[t++]="ic-rc-disable")}var l=e.modes;if(l){var s=$.grep(l,function(e){return"AirConditioner.Indoor.ModeLimit"==e.id}),d=s[0]?s[0].mode:void 0;d&&("HeatOnly"===d||"CoolOnly"===d)&&t<5&&(a[t++]="ic-rock")}var c=e.temperatures;if(c){var u=[];u.push($.grep(c,function(e){return"AirConditioner.Indoor.Room.Cool.Limit"==e.id})),u.push($.grep(c,function(e){return"AirConditioner.Indoor.Room.Heat.Limit"==e.id})),u.push($.grep(c,function(e){return"AirConditioner.Indoor.WaterOutlet.Cool.Limit"==e.id})),u.push($.grep(c,function(e){return"AirConditioner.Indoor.WaterOutlet.Heat.Limit"==e.id})),u.push($.grep(c,function(e){return"AirConditioner.Indoor.DHW.Limit"==e.id}));for(var p=!1,m=u.length,g=0;g<m;g++){var v=u[g][0];if(v&&v.enabled){p=!0;break}}p&&t<5&&(a[t++]="ic-thurmo")}if(i){var f=i.defrost;f&&"On"===f&&t<5&&(a[t++]="ic-deforest"),i.filterResetRequired&&t<5&&(a[t++]="ic-filter")}var E=e.schedules;if(E&&0<E.length&&t<5&&(a[t++]="ic-schedule"),i){var h=i.spi;h&&"On"===h&&t<5&&(a[t++]="ic-spi");var T=i.chiller;if(T){var _=T.freezeProtection;_&&"On"===_&&t<5&&(a[t++]="ic-antifreeze")}}return a},getTemperatures:r,curTemperatures:function(e){var t=r(e,!0),a=t.dhwCurrent;return a?t.current+", "+a:t.current},setTemperatures:function(e){var t=r(e,!0),a=t.dhwDesired;return a?t.desired+", "+a:t.desired},curOutdoorTemperature:function(e){return r(e,!0).current},columnMode:function(e){var t=$("<div/>"),a=$("<span/>"),i=e.modes;return i=i&&i.length?i[0].mode:"-",a.text(i).appendTo(t),t.html()},filter0Depth:function(e,t,a){return{field:e,operator:t,value:a}},filter0DepthEmptyList:function(e){return{field:e,operator:function(e){if(e&&e.length)return!0}}},filter1Depth:n,filter1DepthNone:o,filter1DepthNull:d,filter1DepthObj:function(e,a,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e)if("undefined"==t){if(void 0===e[a])return!0}else if(e[a]==t)return!0},value:t}},filterStatusNoAlarm:function(e,t,a,i){var r=[];return"On"===a?r.push(n(e,t,a)):r.push(o(e,t,a)),r.push(d(i)),{logic:"and",filters:r}},filter2Depth:function(e,s,d,c){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){c="undefined"==c?void 0:c;var a,i,r,n,o,l=e.length;for(a=0;a<l;a++){if(!(n=e[a][s])||!n.length)return;for(r=n.length,i=0;i<r;i++)if(void 0!==(o=n[i][d])&&($.isFunction(t)&&(t=t(o)),o==t))return!0}}},value:c}},convertStatistic:function(e,t,a){var i,r,n,o=[];if(e==w.FLOOR_NAV_BUILDING_TOTAL_ID)for(i=0,r=t.length;i<r;i++)n={},$.each(t[i],function(e,t){"foundation_space_buildings_id"===e?e="id":"foundation_space_buildings_name"===e&&(e="name"),n[e]=t}),o.push(n);else for(i=0,r=t.length;i<r;i++)if(e==t[i].foundation_space_buildings_id){for(var l=t[i].floors,s=0,d=l.length;s<d;s++)if(n={},$.each(l[s],function(e,t){if("foundation_space_floors_id"===e)e="id";else if("foundation_space_floors_name"===e){e="name";var a=n.type;"B"===a?t=a+t:"F"==a&&(t+=a)}else"foundation_space_floors_type"===e&&(e="type");n[e]=t}),o.push(n),a){var c,u=l[s].assetTypes;if(u){var p,m,g,v,f,E=u.length;for(p=0;p<E;p++)for(c=u[p].assets_types_name,g=(v=u[p].subAssetTypes).length,m=0;m<g;m++)(f=$.extend({},n,v[m])).isSubAsset=!0,f.assets_types_name=c,o.push(f)}}var h=$.extend({},t[i]);h.id=h.foundation_space_buildings_id,h.name="All",o.push(h);break}return o},convertDisplayName:function(e){return e&&e.length>l.DISPLAY_NAME_MAX?e.substr(0,l.DISPLAY_NAME_MAX):e},getAccureFilter:function(e,t,a,i,r){var n;if(n=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length){var o={logic:"and",filters:t};n.filters.push(o)}if(a&&a.length){var l={logic:"or",filters:a};n.filters.push(l)}if(i&&i.length){var s={logic:"or",filters:i};n.filters.push(s)}if(r&&r.length){var d={logic:"or",filters:r};n.filters.push(d)}return n},getAccureFilterOlder:function(e,t,a,i,r){var n;n=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length&&(n={logic:"and",filters:[n,{logic:"and",filters:t}]});a&&a.length&&(n={logic:"and",filters:[n,{logic:"or",filters:a}]});i&&i.length&&(n={logic:"and",filters:[n,{logic:"or",filters:i}]});r&&r.length&&(n={logic:"and",filters:[n,{logic:"or",filters:r}]});return n},calcScreenBySelect:function(e,t,a){var i=e.length;return 0<i?y.prop("FACILITY_DEVICE_SELECTED",i):void 0===t||void 0===a?"":y.prop("FACILITY_DEVICE_NO_SELECTED_TOTAL",t,a)},calcScreenByOnlySelect:function(e){var t=e.length;return 0<t?y.prop("FACILITY_DEVICE_SELECTED",t):y.prop("FACILITY_DEVICE_NO_SELECTED")},getTempHumiTemperature:function(e,t){var a="-",i=e.temperatures,r=e.type;if(r&&-1!=r.indexOf("ControlPoint")){var n=e.mappedType;if(n&&-1!=n.indexOf("Temperature")){var o=e.controlPoint;o&&void 0!==o.value&&(a=o.value)}}else i&&i[0]&&(a=(i=i[0]).current);"-"==(a=A.convertNumberFormat(a))||t||(a+="Celsius"===N.getTemperature().unit?"\xb0C":"\u2109");return a},getTempHumiHumidity:function(e,t){var a="-",i=e.humidities,r=e.type;if(r&&-1!=r.indexOf("ControlPoint")){var n=e.mappedType;if(n&&-1!=n.indexOf("Humidity")){var o=e.controlPoint;o&&void 0!==o.value&&(a=o.value)}}else i&&i[0]&&(a=(i=i[0]).current);return"-"==(a=A.convertNumberFormat(a))||t||(a+="%"),a},getMotionPresence:function(e){var t="-",a=e.presences;return a&&a[0]&&(t=(t=(a=a[0]).detected)?y.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"):y.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE")),t},getMacAddress:g,getIpAddress:m,getWifiIpAddress:function(e){var t="-",a=e.networks;return a&&a[1]&&(a=a[1]).wifi&&(t=(t=a.wifi.ipAddress)||"-"),t},getWifiMacAddress:function(e){var t="-",a=e.networks;return a&&a[1]&&(a=a[1]).wifi&&(t=(t=a.wifi.macAddress)||"-"),t},getWifiChannel:function(e){var t="-",a=e.networks;return a&&a[1]&&(a=a[1]).wifi&&(t=(t=a.wifi.channel)||"-"),t},getWifiRssi:function(e){var t="-",a=e.networks;return a&&a[1]&&(a=a[1]).wifi&&(t=(t=a.wifi.rssi)||"-"),t},getCCTVWifiStatus:v,getCCTVDataStatus:function(e){var t="Off",a=e.cctvs;return a&&a[0]&&"On"==(a=a[0]).dataStatus&&(t="On"),t},getCCTVWifiTxPower:function(e){var t="-",a=e.wifi;return a&&(t=(t=a.txPower)||"-"),t},getCCTVWifiType:function(e){var t="-",a=e.networks;return a&&a[1]&&("WiFi2.4GHz"==(a=a[1]).type?t="2.4GHz":"WiFi5GHz"==a.type&&(t="5GHz"),t=t||"-"),t},getCCTVWifiTotal:function(e){var t="-",a=e.wifi;return(a=a&&a.statistics)&&a.channelUtilization&&(t=(t=a.channelUtilization.total)||"-"),t},getCCTVWifiNoneWifi:function(e){var t="-",a=e.wifi;return(a=a&&a.statistics)&&a.channelUtilization&&(t=(t=a.channelUtilization["non802.11"])||"-"),t},getCCTVWifiInterfererDataSource:function(e){var t=[],a=e.wifi;return(a=a&&a.statistics)&&a.interferers&&(t=a.interferers),t},getBleObject:E,getBleMacAddress:h,getBleUUID:T,getBleMajor:function(e){return E(e,"major")},getBleMinor:function(e){return E(e,"minor")},getBleTxPower:function(e){var t=E(e,"txPower");return"999"!=t&&999!=t||(t="-"),t},getBle1mRssi:function(e){return E(e,"calibratedTxPower")},getBleSignalLevel:function(e){var t=E(e,"rssi");return"-"!=t&&(t+=" dBm"),t},getBleBatteryLevel:function(e){var t,a="-",i=e.information;return i&&i.power&&(t=i.power.batteryLevel)&&(a=t||"-"),a},getBleWritable:function(e){var t=E(e,"writable");return t="-"==t?"READ Only":"READ / WRITE"},getBleAdvertisingName:function(e){return E(e,"advertisingName")},getBleAdvertisingInterval:function(e){return E(e,"advertisingInterval")},getNetworkInterface:f,getNetworkInterfaceIndex:function(e,t,a,i,r){var n,o,l,s=0;if((n=e.networks)&&n[0])for(l=n.length,o=0;o<l;o++)if(n[o].type==t){if(!a)return o;if(n[o].ble&&n[o].ble.role==a){if(null==i)return o;if(i==s)return o;s++}}return r?-1:0},getBleObjectFromNetwork:function(e,t){var a="-";return e&&e.ble&&(a=void 0!==(a=e.ble[t])?a:"-"),a},getWifiObjectFromNetwork:function(e,t){var a="-";return e&&e.wifi&&(a=void 0!==(a=e.wifi[t])?a:"-"),a},getZigbeeStatus:function(e){return f(e,"Zigbee").enabled?"Normal.On":"Normal.Off"},getBleStatus:function(e){return f(e,"BLE","Scanner").enabled?"Normal.On":"Normal.Off"},getBleInterfaceStatus:function(e,t){return f(e,"BLE","Advertiser",t).enabled?"Normal.On":"Normal.Off"},getHasSchedule:b,getHasRule:_,getDescription:function(e){var t="-",a=e.description;return a&&(t=a),A.decodeHtml(t)},getFirmwareVersion:function(e){return t(e,"Firmware")},getZigbeeFirmwareVersion:function(e){return t(e,"Firmware.Zigbee")},getBleFirmwareVersion:function(e){return t(e,"Firmware.BLE")},getBleAppVersion:function(e){return t(e,"Application.BLE")},getHardwareVersion:function(e){return t(e,"Hardware")},getSoftwareVersion:function(e){return t(e,"Software")},getApiVersion:function(e){return t(e,"API")},getPowerAvailableSource:function(e){var t="-",a=e.information;return a&&a.power&&((t=a.power.availableSources||"-")instanceof R.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},getPowerCurrentSource:function(e){var t="-",a=e.information;return a&&a.power&&((t=a.power.currentSource||"-")instanceof R.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},sortableLocation:function(e,t){return e=(e=a(e))||"-",t=(t=a(t))||"-",e.localeCompare(t)},sortableGroup:function(e,t){return e=(e=i(e))||"-",t=(t=i(t))||"-",e.localeCompare(t)},getLocationSort:function(){var e=w.getCurrentFloor(),t=!0;return e.building.id!=w.FLOOR_NAV_BUILDING_TOTAL_ID&&e.floor.id!=w.FLOOR_NAV_FLOOR_TOTAL_ID||(t=!1),t?[{field:"locations",dir:"asc",compare:function(e,t){var a,i;a=e.locations,i=t.locations;var r="-",n="-";return a=a&&a[0]?a[0]:"-",i=i&&i[0]?i[0]:"-","-"!=a&&(a.foundation_space_zones_id||(r="\u03a9"+(r=e.name))),"-"!=i&&(i.foundation_space_zones_id||(n="\u03a9"+(n=t.name))),r.localeCompare(n)}}]:[]},getPointTagName:D,sortablePointTagName:function(e,t){return e=D(e),t=D(t),e.localeCompare(t)},sortablePointValue:function(e,t){var a,i;return e.controlPoint&&(a=e.controlPoint.value),t.controlPoint&&(i=t.controlPoint.value),a-i},sortableMeterType:function(e,t){var a,i;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return a=u(e),i=u(t),a.localeCompare(i)},sortableMeterCategoryType:function(e,t){var a,i;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return a=c(e),i=c(t),a.localeCompare(i)},sortableMacAddress:function(e,t){return e=(e=g(e))||"-",t=(t=g(t))||"-",e.localeCompare(t)},sortableBleMacAddress:function(e,t){return e=h(e),t=h(t),e.localeCompare(t)},sortableIpAddress:function(e,t){return e=(e=m(e))||"-",t=(t=m(t))||"-",e.localeCompare(t)},sortableHasSchedule:function(e,t){return e=b(e),t=b(t),e.localeCompare(t)},sortableHasRule:function(e,t){return e=_(e),t=_(t),e.localeCompare(t)},sortableBeaconUUID:function(e,t){return e=T(e),t=T(t),e.localeCompare(t)},sortableCCTVWifiStatus:function(e,t){return e=v(e),t=v(t),e.localeCompare(t)},getIndoorMode:function(e){var t="-",a=A.getRecentAlarm(e);return t=a?(t=a.type,y.prop("FACILITY_DEVICE_STATUS_"+t.toUpperCase())||t):A.getDisplayModeI18N(e.modes,e.operations,!0," / ")},getAssetType:function(e){return(e.assets_types_name?e.assets_types_name:"-")+" / "+(e.subAssetType?e.subAssetType:"-")},getAssetLocation:L,getAssetUsers:function(e){var t="-",a=e.users;if(a&&a[0]){t="";var i,r=a.length;for(i=0;i<r;i++)t+=a[i].ums_users_name,i!=r-1&&(t+=", ")}return t},getMeterCategoryType:c,getMeterType:u,getMeterCurrentConsumption:p,getMeterCurrentConsumptionUnit:function(e){var t=e.type,a=e.mappedType,i="",r=window.Util;return i="Meter.Gas"==t||"Meter.Gas"==a?r.CHAR.Gas:"Meter.WattHour"==t||"Meter.WattHour"==a?r.CHAR.WattHour:"Meter.Water"==t||"Meter.Water"==a?r.CHAR.Water:"",p(e)+i},getDimmingLevel:function(e){var t,a="-",i=e.lights||e.light;return i&&i[0]&&(a=void 0===(t=(i=i[0]).dimmingLevel)?"-":Math.round(t)+"%"),a},getTempWeatherStation:function(e){var t="-",a=e.configuration;return a&&a.locationType&&(t=a.locationType),t},getTempWeatherStationOx:function(e){var t="-",a=e.configuration;return a&&a.locationType&&(t="Outdoor"==(t=a.locationType)?"O":"X"),t},getPointValue:function(e){var t="-",a=e.controlPoint;return a&&void 0!==a.value&&(t=a.value),t},getAssetUserName:function(e){var t="-",a=e.users;return a&&a[0]&&(t=a[0].ums_users_name),t},getAssetUserID:function(e){var t="-",a=e.users;return a&&a[0]&&(t=a[0].ums_users_id),t},getAssetUserEmail:function(e){var t="-",a=e.users;return a&&a[0]&&(t=a[0].ums_users_email),t},getAssetUserOrganization:function(e){var t="-",a=e.users;return a&&a[0]&&(t=a[0].ums_users_organization?a[0].ums_users_organization:"-"),t},getAssetUserWorkPhoneNumber:function(e){var t="-",a=e.users;return a&&a[0]&&(t=a[0].ums_users_workPhoneNumber?a[0].ums_users_workPhoneNumber:"-"),t},getAssetUserMobilePhoneNumber:function(e){var t="-",a=e.users;return a&&a[0]&&(t=a[0].ums_users_mobilePhoneNumber?a[0].ums_users_mobilePhoneNumber:"-"),t},getAssetDeviceID:function(e){var t="-",a=e.devices;return a&&a[0]&&(t=a[0].dms_devices_id),t},getAssetDeviceName:function(e){var t="-",a=e.devices;return a&&a[0]&&(t=a[0].dms_devices_name),t},getEnergyMappingOutdoorList:function(c){var u,p=new $.Deferred,m=w.getCurrentBuildingList();return $.ajax({url:"/foundation/space/floors"}).done(function(e){u=e,$.ajax({url:"/dms/devices?types=AirConditionerOutdoor&registrationStatuses=Registered&attributes=id,name,locations"}).done(function(e){var t,a,i,r,n,o,l,s,d=e.length;for(o=0;o<d;o++){if((t=e[o]).locations&&t.locations[0]){for(r=t.locations[0].foundation_space_buildings_id,n=t.locations[0].foundation_space_floors_id,s=m.length,l=0;l<s;l++)if(r==(a=m[l]).id){t.building_group_value=R.toString(a.sortOrder,"0000")+"_"+a.id+"_"+a.name;break}for(s=u.length,l=0;l<s;l++)if(n==(i=u[l]).id){t.floor_group_value=R.toString(i.sortOrder,"0000")+"_"+i.id+"_"+A.getFloorName(i);break}}for(t.assigned=!1,s=c.length,l=0;l<s;l++)if(t.id==c[l].dms_devices_id){t.assigned=!0;break}}p.resolve(e)}).fail(function(e){p.reject(e)})}).fail(function(e){p.reject(e)}),p.promise()},isEnableEnergyMappingType:function(e){var t,a,i=e.mappedType||e.type,r=e.meters;if(!r)return!1;var n,o=r.length;for(n=0;n<o;n++)"AirConditionerAll"==r[n].category&&(t=r[n].category),"AirConditionerOutdoor"==r[n].connectedDeviceType&&(a=r[n].connectedDeviceType);return!("Meter.WattHour"!=i||!t||!a)},getEnergyMappingFieldName:function(e){var t=0,a=e.meters;if(a&&a[0]){var i,r=a.length;for(i=0;i<r;i++)if("AirConditionerAll"==a[i].category&&"AirConditionerOutdoor"==a[i].connectedDeviceType){t=i;break}}return"meters["+t+"].connectedDevices"},getMeterConnectedDevices:function(e){var t=0,a=e.meters;if(a&&a[0]){var i,r=a.length;for(i=0;i<r;i++)if("AirConditionerAll"==a[i].category&&"AirConditionerOutdoor"==a[i].connectedDeviceType){t=i;break}}return a[t]&&a[t].connectedDevices?a[t].connectedDevices:null},getDeviceRegistrationFailMsg:function(e){return 406==e.status&&-1!=e.responseText.indexOf("Count")?y.prop("FACILITY_DEVICE_COUNT_EXCEEDED"):A.parseFailResponse(e)},getConnectedDevicesConsumptionTypeList:function(e){var t={AirConditionerAll:{name:y.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_SAC"),id:"AirConditionerAll"},Light:{name:y.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_LIGHT"),id:"Light"},Others:{name:y.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_OTHERS"),id:"Others"}},a=[];return a.push(t.AirConditionerAll),"Meter.WattHour"===e&&a.push(t.Light),a.push(t.Others),a},getConnectedDevicesConnectionTypeList:function(e,t){var a={None:{name:"None",id:"None"},AirConditioner:{name:A.getDetailDisplayTypeDeviceI18N("SAC Indoor"),id:"AirConditioner"},AirConditionerOutdoor:{name:A.getDetailDisplayTypeDeviceI18N("SAC Outdoor"),id:"AirConditionerOutdoor"},Boiler:{name:A.getDetailDisplayTypeDeviceI18N("Boiler"),id:"Boiler"},CoolingTower:{name:A.getDetailDisplayTypeDeviceI18N("CoolingTower"),id:"CoolingTower"},Pump:{name:A.getDetailDisplayTypeDeviceI18N("Pump"),id:"Pump"},WaterTank:{name:A.getDetailDisplayTypeDeviceI18N("WaterTank"),id:"WaterTank"}},i=[];return"AirConditionerAll"===t&&("Meter.WattHour"===e?i.push(a.AirConditioner,a.AirConditionerOutdoor,a.Pump,a.CoolingTower,a.Boiler):"Meter.Gas"===e?i.push(a.Boiler):"Meter.Water"===e&&i.push(a.WaterTank)),i.push(a.None),i},filterHasListAttrItem:function(e,t){return{field:e,operator:function(e){return e&&e.length?t:!t}}}}}),define("energy/samsungsac/operating",["energy/core","energy/samsungsac/view-model/operating-vm","energy/samsungsac/model/operating-model","energy/samsungsac/common/common","energy/samsungsac/common/widget","energy/samsungsac/monitoring","energy/samsungsac/detection","energy/samsungsac/distribution","energy/samsungsac/sac-algorithm/sac-algorithm","device/common/device-util"],function(n,e,c,E,o,t,a,i,r,s){var l,h,u,d,p,T=window.moment,m=window.kendo,g=window.GlobalSettings,v=window.CommonLoadingPanel,_=window.Util,f=window.I18N,b=window.MAIN_WINDOW,D=new v,w=e.MainViewModel,N=e.Views,A=E.TEXT,y=new m.Router,R=new m.Layout("<div id='operating-main-view-content' class='operating-main-view-content'></div>"),L=E.getFloorQuery,C=E.getMonthDay,S=$("#operating-common-tab"),I=$("#operating-main-view"),O=o.msgDialog,M=g.getTemperature().unit,k={name:"operationTime",dataList:["usedTime","thermoOnTime"],innerDataList:["average","total"],graphBg:"#0081c6",lineBg:"#e4425d"},G={name:"powerGasUsage",dataList:["totalGasUsage","totalPowerUsage"],graphBg:"#e182ce",lineBg:"#7b61ed"},x={name:"operatingRate",dataList:["onDeviceRate","operationRate","outdoorTemperature"],graphBg:"#5397df",lineBg:"#808080"},P=function(){var e=window.localStorage.getItem("dashboardEnergyCategory");if(e){window.localStorage.removeItem("dashboardEnergyCategory");var t=$("#device-type-list").data("kendoDropDownList");t.value(e),$("#group-list").trigger("change"),t.trigger("change"),Z()}},B=function(e){var a=L(null,!0);D.open();var t=[];a?t.push($.ajax({url:"/foundation/space/zones"+a}).done(function(e){$("#all-zone-list").data("kendoDropDownCheckBox").setOptions({optionLabel:!1}),e.unshift({id:void 0,name:f.prop("ENERGY_NO_ZONE")}),w.filters[1].set("disabled",!1),w.filters[1].options.set("dataSource",e)}).fail(function(){})):($("#all-zone-list").data("kendoDropDownCheckBox").selectAll(),w.filters[1].set("disabled",!0)),a=(a=L(e)).replace("?","&"),t.push($.ajax({url:"/dms/devices?types=AirConditioner.*&registrationStatuses=Registered"+a}).done(function(e){e.length,$("#group-list").data("kendoDropDownCheckBox").setOptions({optionLabel:!1});var t,a=$("#group-list").data("kendoDropDownCheckBox"),i=new m.data.DataSource({data:e,pageSize:20});i.read(),t={logic:"and",filters:[{field:"type",operator:"neq",value:"AirConditioner.FCU"},{field:"type",operator:"neq",value:"AirConditioner.ERV"}]},i.filter(t),i.sort({field:"name",dir:"asc"}),a.setDataSource(i)})),$.when.apply(this,t).always(function(){D.close(),h=$("#device-type-list").val();var e,t=$("#group-list").data("kendoDropDownCheckBox").dataSource;e="powerGasUsage"==h?{logic:"and",filters:[{field:"type",operator:"neq",value:"AirConditioner.FCU"},{field:"type",operator:"neq",value:"AirConditioner.Chiller"},{field:"type",operator:"neq",value:"AirConditioner.ERV"},{field:"type",operator:"neq",value:"AirConditioner.DVM"}]}:{logic:"and",filters:[{field:"type",operator:"neq",value:"AirConditioner.FCU"},{field:"type",operator:"neq",value:"AirConditioner.ERV"}]},t.filter(e),le(t),Z(a)})},Y=function(){(l=S.kendoCommonTabStrip().data("kendoCommonTabStrip")).element.find("[data-role=demandmonitoring]")[0]&&t.init(l).always(function(){!function(){var e=window.localStorage.getItem("dashboardShortcut");if(e){window.localStorage.removeItem("dashboardShortcut");var t=S.find(".k-tabstrip-items .k-item[data-role='"+e+"']");t.find(".k-link").click();var a=t.index();l.select(a)}}()}),a.init(l),i.init(l),r()},U=function(){y.bind("init",V);var e=c.createDataSource(c.modelData);N.graph.widget=ae(e,"operationTime"),N.graph.view=new m.View(N.graph.widget.wrapper),y.route(N.graph.routeUrl,F.bind(y,N.graph.view)),e=c.createDataSource(c.modelData),N.list.widget=oe(e,"operationTime"),N.list.view=new m.View(N.list.widget.wrapper),y.route(N.list.routeUrl,F.bind(y,N.list.view)),y.start(),w.monthBtn.set("active",!0)},V=function(){R.render(I)},F=function(e){R.showIn("#operating-main-view-content",e)},H=function(){w.set("setDateView",T().format(w.formattedDate)),w.graphBtn.set("click",function(){var e;1!=w.graphBtn.get("active")&&(j(),"operationTime"==h&&(e=ie),"operatingRate"==h&&(e=re),"powerGasUsage"==h&&(e=ne),$("#operating-main-view-content").prepend(e))}),w.listBtn.set("click",function(){1!=w.listBtn.get("active")&&($(".graphTopBox").remove(),z(),Z())}),w.exportBtn.set("click",function(){$(N.list.widget.wrapper).find(".k-grid-excel").trigger("click")}),w.monthBtn.set("click",function(){w.yearBtn.set("active",!1),1!=w.monthBtn.get("active")&&(w.monthBtn.set("active",!0),w.set("formattedDate",T().format(X("month"))),q(),Z())}),w.yearBtn.set("click",function(){w.monthBtn.set("active",!1),1!=w.monthBtn.get("active")&&(w.set("formattedDate",T().format(X("year"))),w.yearBtn.set("active",!0),q(),Z())}),w.nextBtn.set("click",function(){var e=Q(w.formattedDate,1);w.set("formattedDate",T().format(e)),K(),q(),Z()}),$("#device-type-list").on("change",function(){h=$(this).val();var e,t=$("#group-list").data("kendoDropDownCheckBox").dataSource;e="powerGasUsage"==h?{logic:"and",filters:[{field:"type",operator:"neq",value:"AirConditioner.FCU"},{field:"type",operator:"neq",value:"AirConditioner.Chiller"},{field:"type",operator:"neq",value:"AirConditioner.ERV"},{field:"type",operator:"neq",value:"AirConditioner.DVM"}]}:{logic:"and",filters:[{field:"type",operator:"neq",value:"AirConditioner.FCU"},{field:"type",operator:"neq",value:"AirConditioner.ERV"}]},t.filter(e),Z()}),$("#group-list").on("change",function(){u=$(this).val()}),$("#all-zone-list").on("change",function(){var e=$(this);d=e.val();var t,a=$("#group-list").data("kendoDropDownCheckBox").dataSource,i=[{logic:"or",filters:[]}];if(d){var r,n,o=d.split(","),l=o.length;for(r=0;r<l;r++)n=o[r],t=s.filter1Depth("locations","foundation_space_zones_id",n),i[0].filters.push(t)}else t=s.filter1Depth("locations","foundation_space_zones_id","none"),i[0].filters.push(t);i[1]="powerGasUsage"==h?{logic:"and",filters:[{field:"type",operator:"neq",value:"AirConditioner.FCU"},{field:"type",operator:"neq",value:"AirConditioner.Chiller"},{field:"type",operator:"neq",value:"AirConditioner.ERV"},{field:"type",operator:"neq",value:"AirConditioner.DVM"}]}:{logic:"and",filters:[{field:"type",operator:"neq",value:"AirConditioner.FCU"},{field:"type",operator:"neq",value:"AirConditioner.ERV"}]},a.filter(i),le(a),q(),Z()}),p.on("click",function(){b.disableFloorNav(!1),w.listBtn.get("active")?z():j()}),w.prevBtn.set("click",function(){var e=Q(w.formattedDate,-1);w.set("formattedDate",T().format(e)),K(),q(),Z()}),$("#group-list").data("kendoDropDownCheckBox").bind("selectionChanged",function(e){u=e.newValue,Z()}),$("#main-sidebar-menu .btn-box").off("click",".btn",W).on("click",".btn",W),l.bind("show",function(e){"historyofoperating"===$(e.item).data("role")&&W()})},W=function(e){N.graph.widget.setOptions({chartArea:{width:$("#operating-main-view").width()}})},j=function(){w.graphBtn.set("active",!0),w.listBtn.set("active",!1),y.navigate(N.graph.routeUrl)},z=function(){w.listBtn.set("active",!0),w.graphBtn.set("active",!1),y.navigate(N.list.routeUrl)},X=function(e){var t="",a=w.setDateView.split("-");return"year"==e&&(t=a[0]),"month"==e&&(t=a[0]+"-"+a[1]),"day"==e&&(t=a[0]+"-"+a[1]+"-"+a[2]),t},K=function(){var e,t=w.formattedDate.split("-"),a=w.setDateView.split("-");1<=t.length&&(a[0]=t[0]),2<=t.length&&(a[1]=t[1]),3<=t.length&&(a[2]=t[2]),e=a[0]+"-"+a[1]+"-"+a[2],w.set("setDateView",T().format(e))},q=function(){var e,t,a,i,r,n,o=w.formattedDate.split("-"),l=new Date,s=o.length,d={year:l.getFullYear(),month:l.getMonth()+1,day:l.getDate()},c={year:l.getFullYear(),month:l.getMonth()+1,day:l.getDate()};String(c.month).length<2&&(c.month="0"+c.month),String(c.day).length<2&&(c.day="0"+c.day),1<=s&&(e=Number(o[0]),n=d.year,i=Number(String(c.year)),Number(e)==i?w.nextBtn.set("disabled",!0):Number(e)>i?(w.nextBtn.set("disabled",!0),w.set("formattedDate",n),w.set("setDateView",n)):w.nextBtn.set("disabled",!1)),2<=s&&(n=d.year+"-"+(1<String(d.month).length?d.month:"0"+d.month),t=Number(o[1]),String(t).length<2&&(t="0"+t),i=Number(String(c.year)+String(c.month)),(r=Number(String(e)+String(t)))==i?w.nextBtn.set("disabled",!0):i<=r?(w.nextBtn.set("disabled",!0),w.set("formattedDate",n),w.set("setDateView",n)):w.nextBtn.set("disabled",!1)),3<=s&&(n=d.year+"-"+(1<String(d.month).length?d.month:"0"+d.month)+"-"+(1<String(d.day).length?d.day:"0"+d.day),a=Number(o[2]),String(a).length<2&&(a="0"+a),i=Number(String(c.year)+String(c.month)+String(c.day)),(r=Number(String(e)+String(t)+String(a)))==i?w.nextBtn.set("disabled",!0):i<=r?(w.nextBtn.set("disabled",!0),w.set("formattedDate",n),w.set("setDateView",n)):w.nextBtn.set("disabled",!1))},Q=function(e,t){var a,i,r,n,o,l,s,d,c=e.split("-"),u=c.length;return s=["01","02","03","04","05","06","07","08","09","10","11","12"],1<=u&&(a=Number(c[0]),n="year"),2<=u&&(i=Number(c[1]),n="month",d=C(a,i)),3<=u&&(r=Number(c[2]),n="day"),"year"==n?(a+=t,String(a)):"month"==n?s.length<(i+=t)||i<=0?a+t+"-"+(o=0<i?s[0]:s[11]):a+"-"+s[i-1]:"day"==n?(r+=t)>d.length||r<=0?0<r?s.length<(i+=t)||i<=0?(d=0<i?(o=s[0],C(a+t,1)):(o=s[11],C(a+t,12)),a+t+"-"+o+"-"+(l=d[0])):(l=(d=C(a,i))[0],a+"-"+s[i-1]+"-"+l):(l=d[d.length-1],s.length<(i+=t)||i<=0?(d=0<i?(o=s[0],C(a+t,1)):(o=s[11],C(a+t,12)),a+t+"-"+o+"-"+(l=d[d.length-1])):(l=(d=C(a,i))[d.length-1],a+"-"+s[i-1]+"-"+l)):a+"-"+s[i-1]+"-"+d[r-1]:void 0},Z=function(e){var a;e=e||L();var t,i,r,n=w.formattedDate.split("-");h=""!==(h=$("#device-type-list").val())?h:"mockData",1==n.length?t="year="+n[0]:2==n.length&&(t="year="+n[0]+"&month="+Number(n[1]));var o=$("#group-list").data("kendoDropDownCheckBox"),l=o.value(),s=$(".graphTopBox");if(!l||""===l||!h||"mockData"===h){e=e.replace("?","&"),s[0]&&s[0].remove();var d=c.createDataSource(c.modelData);return i=te(d,h),r=ee(d,h),o.dataSource.view().length<1&&$("#group-list").data("kendoDropDownCheckBox").unselectAll(),N.graph.widget.setOptions({axisDefaults:{line:{visible:!1},majorGridLines:{color:"#d6d6d6"}},seriesDefaults:{spacing:.1,gap:.2,overlay:{gradient:"none"},border:{width:0}},chartArea:{background:"#fbfbfb",height:$("#operating-common-tab-1").height()-172,width:$("#operating-main-view").width()},plotArea:{background:"#ebebeb"},legend:{visible:!1},xAxis:{border:{color:"#444"}},series:i.setSeries,valueAxes:i.setValueAxes,categoryAxis:{categories:i.categories,axisCrossingValues:[0,0,100,100],select:!1}}),void N.list.widget.setOptions({columns:[],dataSource:{data:r},height:"100%",toolbar:["excel"],scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!1,excel:{allPages:!0},excelExport:J,setCheckedAttribute:!1})}u=l,e=e.replace("?","&"),D.open(),$.ajax({url:"/energy/sac/operatingHistory/"+h+"?dms_device_ids="+u+"&"+t+e}).done(function(e){e||(a=[]),a=e}).fail(function(e){var t=_.parseFailResponse(e);O.message(t),a=[],h&&O.open()}).always(function(){var e;i=te(a,h),r=ee(a,h),N.graph.widget.setOptions({axisDefaults:{line:{visible:!1},majorGridLines:{color:"#d6d6d6"}},seriesDefaults:{spacing:.1,gap:.2,overlay:{gradient:"none"},border:{width:0}},chartArea:{background:"#fbfbfb",height:$("#operating-common-tab-1").height()-202,width:$("#operating-main-view").width()},plotArea:{background:"#ebebeb"},legend:{visible:!1},xAxis:{border:{color:"#444"}},series:i.setSeries,valueAxes:i.setValueAxes,categoryAxis:{categories:i.categories,axisCrossingValues:[0,0,100,100],select:!1}}),N.list.widget.wrapper&&N.list.widget.wrapper.attr("data-operating-type",h),"operationTime"==h&&(e=[{field:"time",title:A.COMMON_DATE,footerTemplate:A.COMMON_TOTAL,footerAttributes:{class:"table-footer-cell3"},attributes:{"data-name":"sac"},width:100,format:"",editable:!1,template:function(e){return e.time?e.time:"-"}},{title:A.ENERGY_USED_TIME_MIN,columns:[{field:"totalUsedTime",title:A.COMMON_TOTAL,footerTemplate:function(e){if(e.totalUsedTime.sum){var t=[];return t[0]=Math.floor(e.totalUsedTime.sum/60),t[1]=Math.floor(e.totalUsedTime.sum%60),String(t[0]).length<2&&(t[0]="0"+t[0]),String(t[1]).length<2&&(t[1]="0"+t[1]),t[0]+" : "+t[1]}return"-"},footerAttributes:{class:"table-footer-cell1"},attributes:{"data-name":"month"},width:100,format:"",editable:!1,template:function(e){if(e.totalUsedTime||0==e.totalUsedTime){var t=[];return t[0]=Math.floor(e.totalUsedTime/60),t[1]=Math.floor(e.totalUsedTime%60),String(t[0]).length<2&&(t[0]="0"+t[0]),String(t[1]).length<2&&(t[1]="0"+t[1]),t[0]+" : "+t[1]}return"-"}},{field:"averageUsedTime",title:A.ENERGY_AVERAGE,footerTemplate:function(e){if(e.averageUsedTime.sum){var t=[];return t[0]=Math.floor(e.averageUsedTime.sum/60),t[1]=Math.floor(e.averageUsedTime.sum%60),String(t[0]).length<2&&(t[0]="0"+t[0]),String(t[1]).length<2&&(t[1]="0"+t[1]),t[0]+" : "+t[1]}return"-"},footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"temperature"},width:100,format:"",editable:!1,template:function(e){if(e.averageUsedTime||0==e.averageUsedTime){var t=[];return t[0]=Math.floor(e.averageUsedTime/60),t[1]=Math.floor(e.averageUsedTime%60),String(t[0]).length<2&&(t[0]="0"+t[0]),String(t[1]).length<2&&(t[1]="0"+t[1]),t[0]+" : "+t[1]}return"-"}}]},{title:A.ENERGY_THERMO_ON_TIME_MIN,columns:[{field:"totalThermoTime",title:A.COMMON_TOTAL,footerTemplate:function(e){if(e.totalThermoTime.sum){var t=[];return t[0]=Math.floor(e.totalThermoTime.sum/60),t[1]=Math.floor(e.totalThermoTime.sum%60),String(t[0]).length<2&&(t[0]="0"+t[0]),String(t[1]).length<2&&(t[1]="0"+t[1]),t[0]+" : "+t[1]}return"-"},footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"total"},width:100,format:"",editable:!1,template:function(e){if(e.totalThermoTime||0==e.totalThermoTime){var t=[];return t[0]=Math.floor(e.totalThermoTime/60),t[1]=Math.floor(e.totalThermoTime%60),String(t[0]).length<2&&(t[0]="0"+t[0]),String(t[1]).length<2&&(t[1]="0"+t[1]),t[0]+" : "+t[1]}return"-"}},{field:"averageThermoTime",title:A.ENERGY_AVERAGE,footerTemplate:function(e){if(e.averageThermoTime.sum){var t=[];return t[0]=Math.floor(e.averageThermoTime.sum/60),t[1]=Math.floor(e.averageThermoTime.sum%60),String(t[0]).length<2&&(t[0]="0"+t[0]),String(t[1]).length<2&&(t[1]="0"+t[1]),t[0]+" : "+t[1]}return"-"},footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"total"},width:100,format:"",editable:!1,template:function(e){if(e.averageThermoTime||0==e.averageThermoTime){var t=[];return t[0]=Math.floor(e.averageThermoTime/60),t[1]=Math.floor(e.averageThermoTime%60),String(t[0]).length<2&&(t[0]="0"+t[0]),String(t[1]).length<2&&(t[1]="0"+t[1]),t[0]+" : "+t[1]}return"-"}}]}]),"powerGasUsage"==h&&(e=[{field:"time",title:A.COMMON_DATE,footerTemplate:A.COMMON_TOTAL,footerAttributes:{class:"table-footer-cell1"},attributes:{"data-name":"month"},width:100,format:"",editable:!1,template:function(e){return e.time?e.time:"-"}},{field:"totalPowerUsage",title:A.ENERGY_POWER_USAGE+" (kWh)",footerTemplate:function(e){return e.totalPowerUsage.sum?_.convertNumberFormat(e.totalPowerUsage.sum):"-"},footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"temperature"},width:100,format:"",editable:!1,template:function(e){return e.totalPowerUsage||0==e.totalPowerUsage?_.convertNumberFormat(e.totalPowerUsage):"-"}},{field:"totalGasUsage",title:A.ENERGY_GAS_USAGE+" (\u33a5)",footerTemplate:function(e){return e.totalGasUsage.sum?_.convertNumberFormat(e.totalGasUsage.sum):"-"},footerAttributes:{class:"table-footer-cell3"},attributes:{"data-name":"sac"},width:100,format:"",editable:!1,template:function(e){return e.totalGasUsage||0==e.totalGasUsage?_.convertNumberFormat(e.totalGasUsage):"-"}}]),"operatingRate"==h&&(e=[{field:"time",title:A.COMMON_DATE,footerTemplate:A.ENERGY_AVERAGE,footerAttributes:{class:"table-footer-cell3"},attributes:{"data-name":"sac"},width:100,format:"",editable:!1,template:function(e){return e.time?e.time:"-"}},{field:"onDeviceRate",title:A.ENERGY_ON_DEVICE_RATE,footerTemplate:function(e){var t,a,i=w.formattedDate.split("-"),r=new Date;return e.onDeviceRate&&e.onDeviceRate.sum&&e.onDeviceRate.average||0==e.onDeviceRate.sum||0==e.onDeviceRate.average?(a=2==i.length?(t=Number(i[1])==r.getMonth()+1?r.getDate()-1:new Date(i[0],i[1],0).getDate(),(e.onDeviceRate.sum/t).toFixed(2)):e.onDeviceRate.average.toFixed(2),_.convertNumberFormat(a)):"-"},footerAttributes:{class:"table-footer-cell1"},attributes:{"data-name":"month"},width:100,format:"",editable:!1,template:function(e){return e.onDeviceRate||0==e.onDeviceRate?_.convertNumberFormat(e.onDeviceRate):"-"}},{field:"operationRate",title:A.ENERGY_OPERATION_RATE,footerTemplate:function(e){var t,a,i=w.formattedDate.split("-"),r=new Date;return e.operationRate&&e.operationRate.sum&&e.operationRate.average||0==e.operationRate.sum||0==e.operationRate.average?(a=2==i.length?(t=Number(i[1])==r.getMonth()+1?r.getDate()-1:new Date(i[0],i[1],0).getDate(),(e.operationRate.sum/t).toFixed(2)):e.operationRate.average.toFixed(2),_.convertNumberFormat(a)):"-"},footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"temperature"},width:100,format:"",editable:!1,template:function(e){return e.operationRate||0==e.operationRate?_.convertNumberFormat(e.operationRate):"-"}},{field:"outdoorTemperature",title:A.FACILITY_DEVICE_OUTDOOR_TEMPERATURE+"("+_.CHAR[M]+")",footerTemplate:function(e){return e.outdoorTemperature.average?_.convertNumberFormat(e.outdoorTemperature.average):"-"},footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"total"},width:100,format:"",editable:!1,template:function(e){return e.outdoorTemperature||0==e.outdoorTemperature?_.convertNumberFormat(e.outdoorTemperature):"-"}}]),N.list.widget.setOptions({columns:e,dataSource:{data:r,aggregate:[{field:"totalUsedTime",aggregate:"sum"},{field:"averageUsedTime",aggregate:"sum"},{field:"totalThermoTime",aggregate:"sum"},{field:"averageThermoTime",aggregate:"sum"},{field:"totalGasUsage",aggregate:"sum"},{field:"totalPowerUsage",aggregate:"sum"},{field:"onDeviceRate",aggregate:"sum"},{field:"operationRate",aggregate:"sum"},{field:"onDeviceRate",aggregate:"average"},{field:"operationRate",aggregate:"average"},{field:"outdoorTemperature",aggregate:"average"}]},height:"100%",toolbar:["excel"],scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!1,excel:{allPages:!0},excelExport:J,setCheckedAttribute:!1}),N.graph.widget.dataSource.sync(),N.list.widget.dataSource.sync(),$(".graphTopBox").remove(),"operationTime"==h&&(s=ie),"operatingRate"==h&&(s=re),"powerGasUsage"==h&&(s=ne),$(".operating-content .operating-view-btn .ic-view-graph").hasClass("active")?$("#operating-main-view-content").prepend(s):$("#operating-main-view-content").find(".graphTopBox").remove(),w.filters[1].options.dataSource.length<1&&$("#all-zone-list").data("kendoDropDownCheckBox").unselectAll(),D.close()})},J=function(e){var t,a,i=w.formattedDate.split("-"),r=new Date(Number(i[0]),Number(i[1]),0).getDate();2==i.length&&(t=i[0]+"."+i[1]+".01~"+i[0]+"."+i[1]+"."+r),1==i.length&&(t=i[0]+".01.01~"+i[0]+".12.31");var n,o="";a=$("#all-zone-list").data("kendoDropDownCheckBox")._getSelectedItemsText(),n=$("#group-list").data("kendoDropDownCheckBox").getCheckedData(),o=E.TEXT.ENERGY_DEVICE_COUNT+" : "+n.length,n&&n.length<1&&(o="No Device");var l=[{cells:[{background:"#fff",colSpan:3,color:"#333",rowSpan:1,value:""}],type:"header"},{cells:[{background:"#fff",colSpan:2,color:"#333",rowSpan:1,value:o}],type:"header"},{cells:[{background:"#7a7a7a",colSpan:1,color:"#fff",rowSpan:2,value:A.ENERGY_INQUIRY_TARGET},{background:"#fff",colSpan:2,color:"#333",rowSpan:1,value:A.ENERGY_ZONE_COUNT+" : "+a.length}],type:"header"},{cells:[{background:"#7a7a7a",colSpan:1,color:"#fff",rowSpan:1,value:A.ENERGY_INQUIRED_PERIOD},{background:"#fff",colSpan:2,color:"#333",rowSpan:1,value:t}],type:"header"}],s=1;if("operationTime"==$("#device-type-list").val()){s=2;for(var d=0;d<e.workbook.sheets[0].rows.length;d++){var c=e.workbook.sheets[0].rows[d].cells;if("data"==e.workbook.sheets[0].rows[d].type)for(var u=1;u<c.length;u++){var p=[];p[0]=Math.floor(c[u].value/60),p[1]=Math.floor(c[u].value%60),String(p[0]).length<2&&(p[0]="0"+String(p[0])),String(p[1]).length<2&&(p[1]="0"+String(p[1])),c[u].value=p[0]+":"+p[1]}}}e.workbook.sheets[0].rows.splice(s,0,e.workbook.sheets[0].rows[e.workbook.sheets[0].rows.length-1]),e.workbook.sheets[0].rows.pop();for(var m=0;m<l.length;m++)e.workbook.sheets[0].rows.unshift(l[m])},ee=function(e,t){var a,i,r,n,o,l,s,d,c,u,p,m,g,v,f=w.formattedDate.split("-"),E=[];if(2==f.length&&(a="daily",i="day"),1==f.length&&(a="monthly",i="month"),e){if(e[a]&&"operationTime"==t)for(v=0;v<e[a].length;v++)1==f.length?(g=new Date(f[0],e[a][v][i]-1),r=T(g).format("YYYY-MM")):2==f.length&&(g=new Date(f[0],f[1]-1,e[a][v][i]),r=T(g).format("YYYY-MM-DD")),s=e[a][v].usedTime.total,d=e[a][v].usedTime.average,c=e[a][v].thermoOnTime.total,u=e[a][v].thermoOnTime.average,E.push({time:r,totalUsedTime:s,averageUsedTime:d,totalThermoTime:c,averageThermoTime:u});if(e[a]&&"powerGasUsage"==t)for(v=0;v<e[a].length;v++)1==f.length?(g=new Date(f[0],e[a][v][i]-1),r=T(g).format("YYYY-MM")):2==f.length&&(g=new Date(f[0],f[1]-1,e[a][v][i]),r=T(g).format("YYYY-MM-DD")),p=e[a][v].totalGasUsage,m=e[a][v].totalPowerUsage,E.push({time:r,totalGasUsage:p,totalPowerUsage:m});if(e[a]&&"operatingRate"==t)for(v=0;v<e[a].length;v++)1==f.length?(g=new Date(f[0],e[a][v][i]-1),r=T(g).format("YYYY-MM")):2==f.length&&(g=new Date(f[0],f[1]-1,e[a][v][i]),r=T(g).format("YYYY-MM-DD")),n=e[a][v].onDeviceRate,o=e[a][v].operationRate,l=e[a][v].outdoorTemperature,E.push({time:r,onDeviceRate:n,operationRate:o,outdoorTemperature:l})}return E},te=function(e,t){var a,i,r,n,o,l=e,s=w.formattedDate.split("-"),d=[];2==s.length&&(a="daily",i="day",r=E.getChartXAxisLabel("month",T(w.formattedDate))),1==s.length&&(a="monthly",i="month",r=E.getChartXAxisLabel("year")),t=t||h;var c,u,p,m={},g={};if(m.data=[],o=[{majorGridLines:{visible:!(g.data=[])},visible:!1}],l){if("mockData"==t){if(g.max=5,g.min=0,m.max=0,m.min=0,l[a]){for(n=0;n<l[a].length;n++)m.data.push(null),g.data.push(null);for(n=0;n<l[a].length;n++)c=l[a][n][i]-1,m.data[c]=l[a][n].thermoOnTime.average,g.data[c]=l[a][n].usedTime.average;g.max=Math.ceil(1.2*l.max.avgUsedTime),g.min=0,m.max=Math.ceil(1.2*l.max.avgThermoOnTime),m.min=0}g.max>m.max?u=g.max:m.max>g.max&&(u=m.max),m.background=k.graphBg,g.background=k.lineBg,o=[{name:t,min:m.min,max:u,majorUnit:E.chartMajorUnit(u),majorGridLines:{visible:!1},labels:{template:function(e){return se(e.value)}}}]}if("operationTime"==t){if(g.max=5,g.min=0,m.max=0,m.min=0,l[a]){for(n=0;n<l[a].length;n++)m.data.push(null),g.data.push(null);for(n=0;n<l[a].length;n++)c=l[a][n][i]-1,m.data[c]=l[a][n].thermoOnTime.average,g.data[c]=l[a][n].usedTime.average;g.max=Math.ceil(1.2*l.max.avgUsedTime),g.min=0,m.max=Math.ceil(1.2*l.max.avgThermoOnTime),m.min=0}g.max>m.max?u=g.max:m.max>g.max&&(u=m.max),m.background=k.graphBg,g.background=k.lineBg,p=_.getChartOptionsForFiveChartSection(u,0),o=[{name:t,min:m.min,max:p.newMax,majorUnit:p.newMajorUnit,majorGridLines:{visible:!1},labels:{template:function(e){return se(e.value)}}}]}if("powerGasUsage"==t){if(g.max=1,g.min=0,m.max=1,m.min=0,l[a]){for(n=0;n<l[a].length;n++)m.data.push(null),g.data.push(null);for(n=0;n<l[a].length;n++)c=l[a][n][i]-1,m.data[c]=l[a][n].totalPowerUsage,g.data[c]=l[a][n].totalGasUsage;g.max=Math.ceil(1.2*l.max.totalGasUsage),g.min=0,m.max=Math.ceil(1.2*l.max.totalPowerUsage),m.min=0}m.background=G.graphBg,g.background=G.lineBg;var v=_.getChartOptionsForFiveChartSection(m.max,0),f=_.getChartOptionsForFiveChartSection(g.max,0);o=[{name:"kWh",min:m.min,max:v.newMax,majorUnit:v.newMajorUnit,majorGridLines:{visible:!1},labels:{template:function(e){return _.convertNumberFormat(e.value)}}},{majorGridLines:{visible:!1},visible:!1},{name:t,min:g.min,max:f.newMax,majorUnit:f.newMajorUnit,axis:t,majorGridLines:{visible:!1},labels:{template:function(e){return _.convertNumberFormat(e.value)}}}]}if("operatingRate"==t){if(g.max=35,g.min=-15,m.max=100,m.min=0,l[a]){for(n=0;n<l[a].length;n++)m.data.push(null),g.data.push(null);for(n=0;n<l[a].length;n++)c=l[a][n][i]-1,m.data[c]=l[a][n].operationRate,g.data[c]=l[a][n].outdoorTemperature;g.max=Math.ceil(1.2*l.max.outdoorTemperature),Math.ceil(l.min.outdoorTemperature)<0?g.min=Math.ceil(1.2*l.min.outdoorTemperature):g.min=0,m.max=Math.ceil(1.2*l.max.operationRate),m.min=0}m.background=x.graphBg,g.background=x.lineBg,p={newMax:50,newMajorUnit:10},50<m.max&&(p.newMax=100,p.newMajorUnit=20),o=[{name:"kWh",min:m.min,max:p.newMax,majorUnit:p.newMajorUnit,majorGridLines:{visible:!1},labels:{template:function(e){return _.convertNumberFormat(e.value)}}},{majorGridLines:{visible:!1},visible:!1},{name:t,min:g.min,max:g.max,majorUnit:E.chartMajorUnit(g.max-g.min,!0),axis:t,majorGridLines:{visible:!1},labels:{template:function(e){return _.convertNumberFormat(e.value)}}}]}}return 0<g.data.length?(g.data=g.data.map(function(e){return _.convertNumberFormat(e)}),d.push({type:"line",data:g.data,name:t,color:g.background,axis:t,markers:{size:6,background:g.background,border:{width:0,color:g.background},highlight:{line:{width:0}}}})):g.max=10,0<m.data.length?(m.data=m.data.map(function(e){return _.convertNumberFormat(e)}),d.push({type:"column",data:m.data,stack:t,name:t,color:m.background})):m.max=10,{setSeries:d,setValueAxes:o,categories:r}},ae=function(e,t){var a,i=te(e,t),r={axisDefaults:{line:{visible:!1},majorGridLines:{color:"#d6d6d6"}},seriesDefaults:{spacing:.1,gap:.2,overlay:{gradient:"none"},border:{width:0},missingValues:"gap"},chartArea:{background:"#fbfbfb",height:$("#operating-common-tab-1").height()-172,width:$("#operating-main-view").width()},plotArea:{border:{},background:"#ebebeb"},legend:{visible:!1},xAxis:{border:{color:"#444"}},series:i.setSeries,valueAxes:i.setValueAxes,categoryAxis:{categories:i.categories,axisCrossingValues:[0,0,100,100]},selectionTooltip:{isVisible:!0,width:300,seriesKeysForRowName:["name"],rowGroupNames:[],rowTemplate:function(e){var t={groupName:"",content:"",priority:0},a="",i="";switch("powerGasUsage"===e.series.name?a="column"===e.series.type?"gas":"power":"operationTime"===e.series.name?a="column"===e.series.type?"thermoOnTime":"useTime":"operatingRate"===e.series.name&&(a="column"===e.series.type?"operationgRate":"Temperature",i="Celsius"==g.getTemperature().unit?f.prop("ENERGY_OUTDOOR_TEMPERATURE_CELSIUS"):f.prop("ENERGY_OUTDOOR_TEMPERATURE_FAHRENHEIT")),a){case"gas":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-Square' style='background-color:"+e.series.color+"'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+f.prop("ENERGY_POWER_USAGE")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+e.data+"</span>",t.priority=1;break;case"power":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-line-complex' style='background-color:"+e.series.color+"'><span class='energy-sacMonitoring-graph-tooltip-legend-circle-complex' style='background-color:"+e.series.color+"'></span></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+f.prop("ENERGY_GAS_USAGE")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+e.data+"</span>",t.priority=2;break;case"useTime":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-line-complex' style='background-color:"+e.series.color+"'><span class='energy-sacMonitoring-graph-tooltip-legend-circle-complex' style='background-color:"+e.series.color+"'></span></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+f.prop("ENERGY_AVERAGE_USED_TIME")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+se(e.data)+"</span>",t.priority=1;break;case"thermoOnTime":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-Square' style='background-color:"+e.series.color+"'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+f.prop("ENERGY_AVERAGE_THERMO_ON_TIME")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+se(e.data)+"</span>",t.priority=2;break;case"Temperature":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-line'><em class='energy-sacMonitoring-graph-tooltip-legend-circle'></em></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+i+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+e.data+"</span>",t.priority=1;break;case"operationgRate":t.content+="<span class='energy-sacMonitoring-graph-tooltip-legend-Square' style='background-color:"+e.series.color+"'></span><span class='energy-sacMonitoring-graph-tooltip-content-name'>"+f.prop("ENERGY_OPERATING_RATE")+"</span><span class='energy-sacMonitoring-graph-tooltip-content-data'>"+e.data+"</span>",t.priority=2;break;default:t.content="",t.priority=0,t.groupName=""}return t}}};return"operationTime"==t&&(a=ie),"operatingRate"==t&&(a=re),"PowerGasUsage"==t&&(a=ne),$("#operating-main-view-content").prepend(a),o.createNewWidget("operating-chart",m.dataviz.ui.Chart,r)},ie='<div class="graphTopBox"><div class="left"><span class="graph-unit">('+A.ENERGY_TIME_HOUR+')</span></div><div class="right"><ul><li><span class="line" style="background-color:#e4425d"><em class="circle" style="background-color:#e4425d"></em></span>'+A.ENERGY_AVERAGE_USED_TIME+'</li><li><span class="square" style="background-color:#0081c6"></span>'+A.ENERGY_AVERAGE_THERMO_ON_TIME+"</li></ul></div></div>",re='<div class="graphTopBox"><div class="left"><span class="graph-unit">(%)</span></div><div class="right"><span class="graph-unit">('+_.CHAR[M]+')</span><ul><li><span class="line" style="background-color:#808080"><em class="circle" style="background-color:#808080"></em></span>'+A.FACILITY_DEVICE_OUTDOOR_TEMPERATURE+'</li><li><span class="square" style="background-color:#2c81db"></span>'+A.ENERGY_OPERATING_RATE+"</li></ul></div></div>",ne='<div class="graphTopBox"><div class="left"><span class="graph-unit">(kWh)</span></div><div class="right"><span class="graph-unit">(\u33a5)</span><ul><li><span class="line" style="background-color:#7b61ed"><em class="circle" style="background-color:#7b61ed"></em></span>'+A.ENERGY_GAS_USAGE+' (\u33a5)</li><li><span class="square" style="background-color:#e182ce"></span>'+A.ENERGY_POWER_USAGE+" (kWh)</li></ul></div></div>",oe=function(e,t){var a,i=ee(e,t);"operationTime"==t&&(a=[{field:"time",title:A.COMMON_DATE,footerTemplate:A.COMMON_TOTAL,footerAttributes:{class:"table-footer-cell3"},attributes:{"data-name":"sac"},width:100,format:"",editable:!1},{title:A.ENERGY_USED_TIME_MIN,columns:[{field:"totalUsedTime",title:A.COMMON_TOTAL,footerTemplate:A.COMMON_TIME,footerAttributes:{class:"table-footer-cell1"},attributes:{"data-name":"month"},width:100,format:"",editable:!1},{field:"averageUsedTime",title:A.ENERGY_AVERAGE,footerTemplate:"",footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"temperature"},width:100,format:"",editable:!1}]},{title:A.ENERGY_THERMO_ON_TIME_MIN,columns:[{field:"totalThermoTime",title:A.COMMON_TOTAL,footerTemplate:"",footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"total"},width:100,format:"",editable:!1},{field:"averageThermoTime",title:A.ENERGY_AVERAGE,footerTemplate:"",footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"total"},width:100,format:"",editable:!1}]}]),"PowerGasUsage"==t&&(a=[{field:"time",title:A.COMMON_DATE,footerTemplate:A.COMMON_TIME,footerAttributes:{class:"table-footer-cell1"},attributes:{"data-name":"month"},width:100,format:"",editable:!1},{field:"totalGasUsage",title:A.ENERGY_POWER_USAGE+" (kWh)",footerTemplate:"",footerAttributes:{class:"table-footer-cell3"},attributes:{"data-name":"sac"},width:100,format:"",editable:!1},{field:"totalPowerUsage",title:A.ENERGY_GAS_USAGE+" (\u33a5)",footerTemplate:"",footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"temperature"},width:100,format:"",editable:!1}]),"operatingRate"==t&&(a=[{field:"time",title:A.COMMON_DATE,footerTemplate:A.COMMON_TOTAL,footerAttributes:{class:"table-footer-cell3"},attributes:{"data-name":"sac"},width:100,format:"",editable:!1},{field:"onDeviceRate",title:A.ENERGY_ON_DEVICE_RATE,footerTemplate:A.COMMON_TIME,footerAttributes:{class:"table-footer-cell1"},attributes:{"data-name":"month"},width:100,format:"",editable:!1},{field:"operationRate",title:A.ENERGY_OPERATION_RATE,footerTemplate:"",footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"temperature"},width:100,format:"",editable:!1},{field:"outdoorTemperature",title:A.FACILITY_DEVICE_OUTDOOR_TEMPERATURE+"("+_.CHAR[M]+")",footerTemplate:"",footerAttributes:{class:"table-footer-cell2"},attributes:{"data-name":"total"},width:100,format:"",editable:!1}]);var r={columns:a,dataSource:i,height:"100%",scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,excel:{allPages:!0},hasCheckedModel:!1,setCheckedAttribute:!1};return o.createNewWidget("operating-grid",m.ui.Grid,r)},le=function(e){1<=e.total()&&$("#group-list").data("kendoDropDownCheckBox").selectAll()},se=function(e){var t=[];return t[0]=Math.floor(e/60),t[1]=Math.floor(e%60),String(t[0]).length<2&&(t[0]="0"+String(t[0])),String(t[1]).length<2&&(t[1]="0"+String(t[1])),t[0]+":"+t[1]};!function(){Y();var e=l.contentElement(0),t=w.formattedDate.split("-");w.set("formattedDate",T().format(t[0]+"-"+t[1])),w.filters[1].set("disabled",!0),U();var a=S.find(".k-tabstrip-items");m.bind(a,w),m.bind($(e),w),p=$("#operating-common-tab").find(".k-tabstrip-items").find("[aria-controls=operating-common-tab-1]").find(".k-link");var i=L(null,!0),r=[];i?r.push($.ajax({url:"/foundation/space/zones"+i}).done(function(e){$("#all-zone-list").data("kendoDropDownCheckBox").setOptions({optionLabel:!1}),e.unshift({id:void 0,name:f.prop("ENERGY_NO_ZONE")}),w.filters[1].set("disabled",!1),w.filters[1].options.set("dataSource",e)}).fail(function(){})):w.filters[1].set("disabled",!0),i=(i=L()).replace("?","&"),r.push($.ajax({url:"/dms/devices?types=AirConditioner.*&registrationStatuses=Registered"+i}).done(function(e){e.length,$("#group-list").data("kendoDropDownCheckBox").setOptions({optionLabel:!1});var t,a=$("#group-list").data("kendoDropDownCheckBox"),i=new m.data.DataSource({data:e,pageSize:20});i.read(),t={logic:"and",filters:[{field:"type",operator:"neq",value:"AirConditioner.FCU"},{field:"type",operator:"neq",value:"AirConditioner.ERV"}]},i.filter(t),i.sort({field:"name",dir:"asc"}),a.setDataSource(i)})),D.open(),$.when.apply(this,r).always(function(){H(),w.graphBtn.click(),n.on("onfloorchange",B),D.close(),$("#group-list").data("kendoDropDownCheckBox").unselectAll(),$("#group-list").data("kendoDropDownCheckBox").selectAll(),$("#all-zone-list").data("kendoDropDownCheckBox").unselectAll(),$("#all-zone-list").data("kendoDropDownCheckBox").selectAll(),w.nextBtn.set("disabled",!0),P()}),h="",$("#group-list").data("kendoDropDownCheckBox").options.cancelOption=!0}()});