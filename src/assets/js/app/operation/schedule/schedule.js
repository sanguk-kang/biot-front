define("device/common/device-model",[],function(){"use strict";var e=window.kendo;return{Device:e.data.Model.define({id:"id",fields:{alarms:{type:"object",editType:null},networks:{type:"object"},parentId:{type:"string"},winds:{type:"object"},registrationStatus:{type:"string",options:[{text:"NotRegistered",value:"0"},{text:"Registered",value:"1"},{text:"Deleted",value:"1"}]},name:{type:"string"},information:{type:"object"},subordinateIds:{type:"object"},operations:{type:"object"},mappedType:{type:"string",options:[{text:"ControlPoint",value:"0"},{text:"Light",value:"1"},{text:"Meter.WattHour",value:"2"},{text:"Sensor.Humidity",value:"3"},{text:"Sensor.Motion",value:"4"},{text:"Sensor.Temperature",value:"5"}]},representativeStatus:{type:"string",options:[{text:"Normal.On",value:"0"},{text:"Normal.Off",value:"1"},{text:"Alarm.Critical",value:"2"},{text:"Alarm.Warning",value:"3"},{text:"Alarm.NetworkError",value:"4"},{text:"Disconnected",value:"5"},{text:"LowBattery",value:"6"},{text:"OutOfBounds",value:"7"}]},modes:{type:"object"},controlPoint:{type:"object"},groups:{type:"object"},configuration:{type:"object"},light:{type:"object"},type:{type:"string"},id:{type:"string"},schedules:{type:"object"},description:{type:"string"},locations:{type:"object"},airConditioner:{type:"object"},temperatures:{type:"object"}}}),DevicePopup:e.data.Model.define({id:"id",fields:{id:{name:"Device ID",type:"string",editType:null},name:{name:"Device NAME",type:"string",editType:"input"},representativeStatus:{name:"Status",type:"string",editType:null},modes:{name:"Operation Mode",type:"string",editType:null},temperatureS:{name:"Set Temperature",type:"string",editType:null},temperatureC:{name:"Current Temperature",type:"string",editType:null},locations:{name:"Location",type:"string",editType:"select"},groups:{name:"Group",type:"string",editType:null},"control-point":{name:"Remote Control",type:"string",editType:"input"},model:{name:"Model",type:"string",editType:null},type:{name:"Type",type:"string",editType:null},version:{name:"Firmware Version",type:"string",editType:null},description:{name:"Description",type:"string",editType:"input"}}})}}),define("device/common/device-constants",[],function(){"use strict";var e=window.I18N;return{TIME_OUT:1500,ALL_TIME_INTERVAL:4e4,PANEL_REFRESH_TIME:1e3,BEACON_TIME_INTERVAL:5e3,DISPLAY_NAME_MAX:6,INDOOR_TYPE:["AirConditioner.Indoor","AirConditioner.AHU","AirConditioner.Chiller","AirConditioner.EHS","AirConditioner.ERV","AirConditioner.ERVPlus",["AirConditioner.FCU","AirConditioner.SFCU"],"AirConditioner.DuctFresh"],OUTDOOR_TYPE:["AirConditioneromOutdoor"],POINT_TYPE:["ControlPoint.AI","ControlPoint.AO","ControlPoint.DI","ControlPoint.DO","ControlPoint.AV","ControlPoint.DV"],ENERGY_TYPE:["Meter.WattHour","Meter.Gas","Meter.Water","Meter.Calorimeter"],SENSOR_TEMP_HUM_TYPE:["Sensor.Temperature_Humidity","Sensor.Humidity","Sensor.Temperature"],STATUS:["Normal.On","Normal.Off","Alarm.Critical","Alarm.Warning"],BEACON_STATUS:["Normal","Disconnected","WrongLocation","LowBattery"],BEACON_ACTION:{BLOCK:1,DELETE:2,REGISTER:3,DETAIL:4},BEACON_LOCATION_TYPE:["Fixed","Movable"],ASSET_FILTER:{TYPE:0,LOCATION:1,STATUS:2,ZONE:3,SELECTALL:4},ASSET_ACTION:{ASSET_TYPE:1,EXPORT:2,IMPORT:3,REGISTER:4,DELETE:5,DETAIL:6},ONOFF:["On","Off"],MODE:[{mode:"Auto",id:"AirConditioner.Indoor.General"},{mode:"Cool",id:"AirConditioner.Indoor.General"},{mode:"Heat",id:"AirConditioner.Indoor.General"},{mode:"Dry",id:"AirConditioner.Indoor.General"},{mode:"Fan",id:"AirConditioner.Indoor.General"},{mode:"CoolStorage",id:"AirConditioner.Indoor.General"},{mode:"HeatStorage",id:"AirConditioner.Indoor.General"},{mode:"vAuto",id:"AirConditioner.Indoor.Ventilator"},{mode:"HeatExchange",id:"AirConditioner.Indoor.Ventilator"},{mode:"ByPass",id:"AirConditioner.Indoor.Ventilator"},{mode:"Sleep",id:"AirConditioner.Indoor.Ventilator"},{mode:"Eco",id:"AirConditioner.Indoor.DHW"},{mode:"Standard",id:"AirConditioner.Indoor.DHW"},{mode:"Power",id:"AirConditioner.Indoor.DHW"},{mode:"Force",id:"AirConditioner.Indoor.DHW"}],TEXT:{SELECTALL:e.prop("COMMON_BTN_SELECT_ALL"),DESELECTALL:e.prop("COMMON_BTN_DESELECT_ALL"),REGISTER:e.prop("COMMON_BTN_REGISTER"),DEREGISTER:e.prop("COMMON_BTN_DEREGISTER"),VIEW:e.prop("COMMON_BTN_VIEW"),DELETE:e.prop("COMMON_BTN_DELETE")},FILTER:{TYPE:0,STATUS:1,MODE:2,ZONE:3,SELECTALL:4,REGEND:5},ACTION:{REGISTER:1,DETAIL:2},NW_ACTION:{DELETE:1,REGISTER:2,DETAIL:3,VIEW:4},VIEW:{STATISTIC:0,MAP:1,LIST:2,GRID:3},SEARCH:{EDIT:0,BUTTON:1},displayShort:[{value:"CoolStorage",display:"CoolSt"},{value:"HeatStorage",display:"HeatSt"},{value:"HeatExchange",display:"HeatEx"}],controlSet:[[{apiName:"operations",id:"AirConditioner.Indoor.General",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.Ventilator",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.DHW",parameter:"power"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.General.Speed",parameter:"wind"},{},{apiName:"modes",id:"AirConditioner.Indoor.ModeLimit",parameter:"mode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"}],[{apiName:"configuration",parameter:"remoteControl"},{apiName:"airConditioner",parameter:"filterResetRequired"},{apiName:"airConditioner",parameter:"spi"},{apiName:"airConditioner",parameter:"stillAir"}],{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.Ventilator",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.Ventilator.Speed",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.DHW",parameter:"mode"},[{apiName:"airConditioner",parameter:"chiller",underParameter:"waterLaw"},{apiName:"airConditioner",parameter:"chiller",underParameter:"quiet"},{apiName:"airConditioner",parameter:"chiller",underParameter:"forcedFan"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demand"}],{apiName:"airConditioner",parameter:"chiller",underParameter:"mccMode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"desired"}],[{apiName:"temperatures",id:"AirConditioner.Indoor.Room",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"desired",Heat:"AirConditioner.Indoor.DischargeAir.Heat",Cool:"AirConditioner.Indoor.DischargeAir.Cool"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"enabled"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demandLevel"}],outdoorControlConfig:{electricCurrentControl:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:50,text:"50%"},{value:55,text:"55%"},{value:60,text:"60%"},{value:65,text:"65%"},{value:70,text:"70%"},{value:75,text:"75%"},{value:80,text:"80%"},{value:85,text:"85%"},{value:90,text:"90%"},{value:95,text:"95%"},{value:100,text:"100%"}],coolingCapacityCalibration:{Celsius:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"5~7\xb0C"},{value:"7~9",text:"7~9\xb0C"},{value:"9~11",text:"9~11\xb0C"},{value:"10~12",text:"10~12\xb0C"},{value:"11~13",text:"11~13\xb0C"},{value:"12~14",text:"12~14\xb0C"},{value:"13~15",text:"13~15\xb0C"}],Fahrenheit:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"41~45\xb0F"},{value:"7~9",text:"45~48\xb0F"},{value:"9~11",text:"48~52\xb0F"},{value:"10~12",text:"50~54\xb0F"},{value:"11~13",text:"52~55\xb0F"},{value:"12~14",text:"54~57\xb0F"},{value:"13~15",text:"55~59\xb0F"}]},heatingCapacityCalibration:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:25,text:"25kg/cm\xb2"},{value:26,text:"26kg/cm\xb2"},{value:27,text:"27kg/cm\xb2"},{value:28,text:"28kg/cm\xb2"},{value:29,text:"29kg/cm\xb2"},{value:30,text:"30kg/cm\xb2"},{value:31,text:"31kg/cm\xb2"},{value:32,text:"32kg/cm\xb2"},{value:33,text:"33kg/cm\xb2"}]},INNER_LAYOUT:{MONITORING:0,REGISTRATION:1},FILTER_NAME:{SELECTALL:"selectAll",ZONE:"zone",STATUS:"status",TYPE:"type",MODE:"mode",ASSET_TYPE:"assetType"},ACTION_NAME:{DETAIL:"detail",REGISTER:"register",DELETE:"delete",BLOCK:"block",SELECTEDTEXT:"selectedText",VIEW:"view",ASSET_TYPE:"assetType"},REGISTRATION_STATUS_BUTTONS:{REGISTER:0,UNREGISTER:1},LIGHT_CONTROL:{POWER:0,DIMMING:1}}}),define("device/common/device-util",["device/common/device-constants"],function(d){"use strict";function s(){for(var e=I.getDefaultViewType(),t=e.length,i="statistic",o=0;o<t;o++)if("Facility.Device"==e[o].menu){i=(i=e[o].view).toLowerCase();break}return i}function i(e){var t=e.locations,i="-";if(void 0!==e.assets_types_id)return k(e);if(t&&0<t.length){i="";var o=t[0];if(o.description)return o.description;o.foundation_space_buildings_id&&(i+=o.foundation_space_buildings_id+" "),o.foundation_space_floors_id&&(i+=o.foundation_space_floors_id)}return i}function o(e){var t=e.groups,i="-";if(t){var o=t.length;0<o&&(i="",(i=t[0].dms_groups_name)&&1<o&&(i+="(+"+(o-1)+")"))}return A.decodeHtml(i)}function a(e,t){var i,o,a,n,r=e.temperatures,d=e.airConditioner,s="-",l="-",c=!1;d&&d.temperatureReference&&-1<d.temperatureReference.indexOf("WaterOutlet")&&(c=!0),!r||0<r.length&&(c&&(n=$.grep(r,function(e){return"AirConditioner.Indoor.WaterOutlet"==e.id}))&&n.length&&void 0!==(n=n[0]).desired&&(l=n.desired.toFixed(1)),(n=$.grep(r,function(e){return"AirConditioner.Indoor.Room"==e.id}))&&n.length&&(n=n[0],c||void 0!==n.desired&&(l=n.desired.toFixed(1)),void 0!==n.current&&(s=n.current.toFixed(1))),(n=$.grep(r,function(e){return"AirConditioner.Indoor.DHW"==e.id}))&&n.length&&(void 0!==(n=n[0]).desired&&(i=n.desired.toFixed(1)),void 0!==n.current&&(o=n.current.toFixed(1))),(n=$.grep(r,function(e){return"AirConditioner.Outdoor"==e.id}))&&n.length&&(void 0!==(n=n[0]).desired&&(l=n.desired.toFixed(1)),void 0!==n.current&&(s=n.current.toFixed(1))));var p=e.modes;return p&&(n=$.grep(p,function(e){return"AirConditioner.Indoor.General"==e.id&&"Fan"==e.mode}))&&n.length&&(l="-"),a="Celsius"===I.getTemperature().unit?"\xb0C":"\u2109","-"!==l&&t&&(l+=a),"-"!==s&&t&&(s+=a),i&&t&&(i+=a),o&&t&&(o+=a),{isWaterout:c,desired:l,current:s,unit:a,dhwDesired:i,dhwCurrent:o}}function n(e,a,t){var n;return"vAuto"===t&&(n="AirConditioner.Indoor.Ventilator",t="Auto"),{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){var i,o=e.length;if("undefined"==t){for(i=0;i<o;i++)if(void 0===e[i][a])return!0}else for(i=0;i<o;i++)if(e[i][a]==t)return!n||(n===e[i].id||void 0)}},value:t}}function r(e,a,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){for(var i=e.length,o=0;o<i;o++)if(e[o][a]!=t)return;return!0}},value:t}}function l(e){return{field:e,operator:function(e){if(e)return 0===e.length||void 0}}}function c(e){var t,i,o,a,n="-";if(i=e.meters){for(n="",o=i.length,t=0;t<o;t++)(a=i[t].category)&&("AirConditionerAll"==a&&(a="SAC"),n+=a,t!=o-1&&(n+=", "));n=(n=n||"Others").toUpperCase(),n=w.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_"+n)}return n}function p(e){var t="-",i=e.type;return i&&(-1!=i.indexOf("ControlPoint")&&(i=e.mappedType),t=(t=(t=A.getDisplayType(i))||"WattHour").toUpperCase(),t=(t=w.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_"+t))||w.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATTHOUR")),t}function u(e){var t,i,o,a,n="",r=e.type;if(r&&-1!=r.indexOf("ControlPoint")){var d=e.controlPoint;d&&void 0!==d.value&&(n=A.convertNumberFormat(d.value))}else if(i=e.meters)for(o=i.length,t=0;t<o;t++)null!=(a=A.convertNumberFormat(i[t].reading))&&(n+=a,t!=o-1&&(n+=", "));return n=""!=n?n:"-"}function v(e){var t,i="-",o=e.networks;return o&&o[0]&&(o=o[0],e.type,o[t="ethernet"]&&(i=(i=o[t].ipAddress)||"-")),i}function m(e){var t,i="-",o=e.networks;return o&&o[0]&&(o=o[0],e.type,o[t="ethernet"]&&(i=(i=o[t].macAddress)||"-")),i}function h(e){var t,i,o="-",a=e.networks;return a&&a[1]&&((a=a[1]).connected?(t=e.alarms)&&0<t.length?(t.sort(function(e,t){return e=e.alarms_event?e.alarms_event:"-",(t=t.alarms_event?t.alarms_event:"-").localeCompare(e)}),"Critical"==(i=t[0].alarms_type)?o="Connected (Poor)":"Warning"==i&&(o="Connected (Fair)")):o="Connected (Good)":o="Disconnected",o=o||"-"),o}function f(e,t,i,o){var a,n,r,d=0;if((a=e.networks)&&a[0])for(r=a.length,n=0;n<r;n++)if(a[n].type==t){if(!i)return a[n];if(a[n].ble&&a[n].ble.role==i){if(void 0===o)return a[n];if(o==d)return a[n];d++}}return{}}function g(e,t){var i,o,a,n="-",r=e.networks;if(r&&r[0]){for(o=r.length,i=0;i<o;i++)if(r[i].ble){a=r[i].ble;break}a&&(n=(n=a[t])||"-")}return n}function _(e){return g(e,"macAddress")}function C(e){return g(e,"uuid")}function E(e){var t="-",i=e.rules;return i&&(t=0<i.length?"O":"X"),t}function T(e){var t="-",i=e.schedules;return i&&(t=0<i.length?"O":"X"),t}function t(e,t){var i,o="-",a=e.information;if(a&&a.versions){var n,r=(i=a.versions).length;for(n=0;n<r;n++)if(i[n].type==t){o=i[n].number?i[n].number:o;break}}return o}function D(e){var t="-";return e.controlPoint&&e.controlPoint.tagName&&(t=e.controlPoint.tagName),t}var O=window.MAIN_WINDOW,I=window.GlobalSettings,A=window.Util,w=window.I18N,b=window.kendo,k=function(e){var t="-",i=e.location;if(i){if(i.description)return i.description;t="",i.foundation_space_buildings_id&&(t+=i.foundation_space_buildings_id+" "),i.foundation_space_floors_id&&(t+=i.foundation_space_floors_id)}return t};return{isAllFloorCheck:function(){var e=!1,t=O.getCurrentFloor();return t&&t.floor&&"ALL"==t.floor.value&&(e=!0),e},getDefaultView:s,goClick:function(e,t,i,o){var a,n={};if(void 0===o){var r=window.localStorage.getItem("deviceViewType");r?(a=d.VIEW[r],window.localStorage.removeItem("deviceViewType")):a=d.VIEW[s().toUpperCase()]}else a=o;return e?t?i==O.FLOOR_NAV_BUILDING_TOTAL_ID||i==O.FLOOR_NAV_FLOOR_ALL_ID?a===d.VIEW.MAP&&(a=d.VIEW.STATISTIC):a===d.VIEW.STATISTIC&&(a=d.VIEW.MAP):a===d.VIEW.MAP?i==O.FLOOR_NAV_BUILDING_TOTAL_ID?n.building=!0:i==O.FLOOR_NAV_FLOOR_ALL_ID&&(n.floor=!0):a===d.VIEW.STATISTIC&&i!=O.FLOOR_NAV_BUILDING_TOTAL_ID&&i!=O.FLOOR_NAV_FLOOR_ALL_ID&&(n.floor=!1):(i==O.FLOOR_NAV_BUILDING_TOTAL_ID?n.building=!0:i==O.FLOOR_NAV_FLOOR_ALL_ID&&(n.floor=!0),a=d.VIEW.MAP),n.floor&&!O.getCurrentFloorList().length&&(n.floor=!1,n.noFloor=!0),n.view=a,n},getStatus:function(e){return A.getStatus(e)},getLocation:i,getCurrentLocation:function(e){var t,i,o=e.locations,a="-";if(o)for(i=o.length,t=0;t<i;t++)if("Measured"==o[t].id){a="";var n=o[t];if(n.description)return n.description;n.foundation_space_buildings_id&&(a+=n.foundation_space_buildings_id+" "),n.foundation_space_floors_id&&(a+=n.foundation_space_floors_id);break}return a},locations:i,getGroup:o,group:o,getGridIcon:function(e){var t=0,i=[],o=e.airConditioner;if(o){var a=o.peakPowerControl;a&&"On"===a&&t<5&&(i[t++]="ic-peak")}var n=e.configuration;if(n){var r=n.remoteControl;r&&"NotAllowed"===r&&t<5&&(i[t++]="ic-rc-disable")}var d=e.modes;if(d){var s=$.grep(d,function(e){return"AirConditioner.Indoor.ModeLimit"==e.id}),l=s[0]?s[0].mode:void 0;l&&("HeatOnly"===l||"CoolOnly"===l)&&t<5&&(i[t++]="ic-rock")}var c=e.temperatures;if(c){var p=[];p.push($.grep(c,function(e){return"AirConditioner.Indoor.Room.Cool.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.Room.Heat.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.WaterOutlet.Cool.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.WaterOutlet.Heat.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.DHW.Limit"==e.id}));for(var u=!1,v=p.length,m=0;m<v;m++){var h=p[m][0];if(h&&h.enabled){u=!0;break}}u&&t<5&&(i[t++]="ic-thurmo")}if(o){var f=o.defrost;f&&"On"===f&&t<5&&(i[t++]="ic-deforest"),o.filterResetRequired&&t<5&&(i[t++]="ic-filter")}var g=e.schedules;if(g&&0<g.length&&t<5&&(i[t++]="ic-schedule"),o){var _=o.spi;_&&"On"===_&&t<5&&(i[t++]="ic-spi");var C=o.chiller;if(C){var E=C.freezeProtection;E&&"On"===E&&t<5&&(i[t++]="ic-antifreeze")}}return i},getTemperatures:a,curTemperatures:function(e){var t=a(e,!0),i=t.dhwCurrent;return i?t.current+", "+i:t.current},setTemperatures:function(e){var t=a(e,!0),i=t.dhwDesired;return i?t.desired+", "+i:t.desired},curOutdoorTemperature:function(e){return a(e,!0).current},columnMode:function(e){var t=$("<div/>"),i=$("<span/>"),o=e.modes;return o=o&&o.length?o[0].mode:"-",i.text(o).appendTo(t),t.html()},filter0Depth:function(e,t,i){return{field:e,operator:t,value:i}},filter0DepthEmptyList:function(e){return{field:e,operator:function(e){if(e&&e.length)return!0}}},filter1Depth:n,filter1DepthNone:r,filter1DepthNull:l,filter1DepthObj:function(e,i,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e)if("undefined"==t){if(void 0===e[i])return!0}else if(e[i]==t)return!0},value:t}},filterStatusNoAlarm:function(e,t,i,o){var a=[];return"On"===i?a.push(n(e,t,i)):a.push(r(e,t,i)),a.push(l(o)),{logic:"and",filters:a}},filter2Depth:function(e,s,l,c){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){c="undefined"==c?void 0:c;var i,o,a,n,r,d=e.length;for(i=0;i<d;i++){if(!(n=e[i][s])||!n.length)return;for(a=n.length,o=0;o<a;o++)if(void 0!==(r=n[o][l])&&($.isFunction(t)&&(t=t(r)),r==t))return!0}}},value:c}},convertStatistic:function(e,t,i){var o,a,n,r=[];if(e==O.FLOOR_NAV_BUILDING_TOTAL_ID)for(o=0,a=t.length;o<a;o++)n={},$.each(t[o],function(e,t){"foundation_space_buildings_id"===e?e="id":"foundation_space_buildings_name"===e&&(e="name"),n[e]=t}),r.push(n);else for(o=0,a=t.length;o<a;o++)if(e==t[o].foundation_space_buildings_id){for(var d=t[o].floors,s=0,l=d.length;s<l;s++)if(n={},$.each(d[s],function(e,t){if("foundation_space_floors_id"===e)e="id";else if("foundation_space_floors_name"===e){e="name";var i=n.type;"B"===i?t=i+t:"F"==i&&(t+=i)}else"foundation_space_floors_type"===e&&(e="type");n[e]=t}),r.push(n),i){var c,p=d[s].assetTypes;if(p){var u,v,m,h,f,g=p.length;for(u=0;u<g;u++)for(c=p[u].assets_types_name,m=(h=p[u].subAssetTypes).length,v=0;v<m;v++)(f=$.extend({},n,h[v])).isSubAsset=!0,f.assets_types_name=c,r.push(f)}}var _=$.extend({},t[o]);_.id=_.foundation_space_buildings_id,_.name="All",r.push(_);break}return r},convertDisplayName:function(e){return e&&e.length>d.DISPLAY_NAME_MAX?e.substr(0,d.DISPLAY_NAME_MAX):e},getAccureFilter:function(e,t,i,o,a){var n;if(n=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length){var r={logic:"and",filters:t};n.filters.push(r)}if(i&&i.length){var d={logic:"or",filters:i};n.filters.push(d)}if(o&&o.length){var s={logic:"or",filters:o};n.filters.push(s)}if(a&&a.length){var l={logic:"or",filters:a};n.filters.push(l)}return n},getAccureFilterOlder:function(e,t,i,o,a){var n;n=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length&&(n={logic:"and",filters:[n,{logic:"and",filters:t}]});i&&i.length&&(n={logic:"and",filters:[n,{logic:"or",filters:i}]});o&&o.length&&(n={logic:"and",filters:[n,{logic:"or",filters:o}]});a&&a.length&&(n={logic:"and",filters:[n,{logic:"or",filters:a}]});return n},calcScreenBySelect:function(e,t,i){var o=e.length;return 0<o?w.prop("FACILITY_DEVICE_SELECTED",o):void 0===t||void 0===i?"":w.prop("FACILITY_DEVICE_NO_SELECTED_TOTAL",t,i)},calcScreenByOnlySelect:function(e){var t=e.length;return 0<t?w.prop("FACILITY_DEVICE_SELECTED",t):w.prop("FACILITY_DEVICE_NO_SELECTED")},getTempHumiTemperature:function(e,t){var i="-",o=e.temperatures,a=e.type;if(a&&-1!=a.indexOf("ControlPoint")){var n=e.mappedType;if(n&&-1!=n.indexOf("Temperature")){var r=e.controlPoint;r&&void 0!==r.value&&(i=r.value)}}else o&&o[0]&&(i=(o=o[0]).current);"-"==(i=A.convertNumberFormat(i))||t||(i+="Celsius"===I.getTemperature().unit?"\xb0C":"\u2109");return i},getTempHumiHumidity:function(e,t){var i="-",o=e.humidities,a=e.type;if(a&&-1!=a.indexOf("ControlPoint")){var n=e.mappedType;if(n&&-1!=n.indexOf("Humidity")){var r=e.controlPoint;r&&void 0!==r.value&&(i=r.value)}}else o&&o[0]&&(i=(o=o[0]).current);return"-"==(i=A.convertNumberFormat(i))||t||(i+="%"),i},getMotionPresence:function(e){var t="-",i=e.presences;return i&&i[0]&&(t=(t=(i=i[0]).detected)?w.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"):w.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE")),t},getMacAddress:m,getIpAddress:v,getWifiIpAddress:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.ipAddress)||"-"),t},getWifiMacAddress:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.macAddress)||"-"),t},getWifiChannel:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.channel)||"-"),t},getWifiRssi:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.rssi)||"-"),t},getCCTVWifiStatus:h,getCCTVDataStatus:function(e){var t="Off",i=e.cctvs;return i&&i[0]&&"On"==(i=i[0]).dataStatus&&(t="On"),t},getCCTVWifiTxPower:function(e){var t="-",i=e.wifi;return i&&(t=(t=i.txPower)||"-"),t},getCCTVWifiType:function(e){var t="-",i=e.networks;return i&&i[1]&&("WiFi2.4GHz"==(i=i[1]).type?t="2.4GHz":"WiFi5GHz"==i.type&&(t="5GHz"),t=t||"-"),t},getCCTVWifiTotal:function(e){var t="-",i=e.wifi;return(i=i&&i.statistics)&&i.channelUtilization&&(t=(t=i.channelUtilization.total)||"-"),t},getCCTVWifiNoneWifi:function(e){var t="-",i=e.wifi;return(i=i&&i.statistics)&&i.channelUtilization&&(t=(t=i.channelUtilization["non802.11"])||"-"),t},getCCTVWifiInterfererDataSource:function(e){var t=[],i=e.wifi;return(i=i&&i.statistics)&&i.interferers&&(t=i.interferers),t},getBleObject:g,getBleMacAddress:_,getBleUUID:C,getBleMajor:function(e){return g(e,"major")},getBleMinor:function(e){return g(e,"minor")},getBleTxPower:function(e){var t=g(e,"txPower");return"999"!=t&&999!=t||(t="-"),t},getBle1mRssi:function(e){return g(e,"calibratedTxPower")},getBleSignalLevel:function(e){var t=g(e,"rssi");return"-"!=t&&(t+=" dBm"),t},getBleBatteryLevel:function(e){var t,i="-",o=e.information;return o&&o.power&&(t=o.power.batteryLevel)&&(i=t||"-"),i},getBleWritable:function(e){var t=g(e,"writable");return t="-"==t?"READ Only":"READ / WRITE"},getBleAdvertisingName:function(e){return g(e,"advertisingName")},getBleAdvertisingInterval:function(e){return g(e,"advertisingInterval")},getNetworkInterface:f,getNetworkInterfaceIndex:function(e,t,i,o,a){var n,r,d,s=0;if((n=e.networks)&&n[0])for(d=n.length,r=0;r<d;r++)if(n[r].type==t){if(!i)return r;if(n[r].ble&&n[r].ble.role==i){if(null==o)return r;if(o==s)return r;s++}}return a?-1:0},getBleObjectFromNetwork:function(e,t){var i="-";return e&&e.ble&&(i=void 0!==(i=e.ble[t])?i:"-"),i},getWifiObjectFromNetwork:function(e,t){var i="-";return e&&e.wifi&&(i=void 0!==(i=e.wifi[t])?i:"-"),i},getZigbeeStatus:function(e){return f(e,"Zigbee").enabled?"Normal.On":"Normal.Off"},getBleStatus:function(e){return f(e,"BLE","Scanner").enabled?"Normal.On":"Normal.Off"},getBleInterfaceStatus:function(e,t){return f(e,"BLE","Advertiser",t).enabled?"Normal.On":"Normal.Off"},getHasSchedule:T,getHasRule:E,getDescription:function(e){var t="-",i=e.description;return i&&(t=i),A.decodeHtml(t)},getFirmwareVersion:function(e){return t(e,"Firmware")},getZigbeeFirmwareVersion:function(e){return t(e,"Firmware.Zigbee")},getBleFirmwareVersion:function(e){return t(e,"Firmware.BLE")},getBleAppVersion:function(e){return t(e,"Application.BLE")},getHardwareVersion:function(e){return t(e,"Hardware")},getSoftwareVersion:function(e){return t(e,"Software")},getApiVersion:function(e){return t(e,"API")},getPowerAvailableSource:function(e){var t="-",i=e.information;return i&&i.power&&((t=i.power.availableSources||"-")instanceof b.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},getPowerCurrentSource:function(e){var t="-",i=e.information;return i&&i.power&&((t=i.power.currentSource||"-")instanceof b.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},sortableLocation:function(e,t){return e=(e=i(e))||"-",t=(t=i(t))||"-",e.localeCompare(t)},sortableGroup:function(e,t){return e=(e=o(e))||"-",t=(t=o(t))||"-",e.localeCompare(t)},getLocationSort:function(){var e=O.getCurrentFloor(),t=!0;return e.building.id!=O.FLOOR_NAV_BUILDING_TOTAL_ID&&e.floor.id!=O.FLOOR_NAV_FLOOR_TOTAL_ID||(t=!1),t?[{field:"locations",dir:"asc",compare:function(e,t){var i,o;i=e.locations,o=t.locations;var a="-",n="-";return i=i&&i[0]?i[0]:"-",o=o&&o[0]?o[0]:"-","-"!=i&&(i.foundation_space_zones_id||(a="\u03a9"+(a=e.name))),"-"!=o&&(o.foundation_space_zones_id||(n="\u03a9"+(n=t.name))),a.localeCompare(n)}}]:[]},getPointTagName:D,sortablePointTagName:function(e,t){return e=D(e),t=D(t),e.localeCompare(t)},sortablePointValue:function(e,t){var i,o;return e.controlPoint&&(i=e.controlPoint.value),t.controlPoint&&(o=t.controlPoint.value),i-o},sortableMeterType:function(e,t){var i,o;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return i=p(e),o=p(t),i.localeCompare(o)},sortableMeterCategoryType:function(e,t){var i,o;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return i=c(e),o=c(t),i.localeCompare(o)},sortableMacAddress:function(e,t){return e=(e=m(e))||"-",t=(t=m(t))||"-",e.localeCompare(t)},sortableBleMacAddress:function(e,t){return e=_(e),t=_(t),e.localeCompare(t)},sortableIpAddress:function(e,t){return e=(e=v(e))||"-",t=(t=v(t))||"-",e.localeCompare(t)},sortableHasSchedule:function(e,t){return e=T(e),t=T(t),e.localeCompare(t)},sortableHasRule:function(e,t){return e=E(e),t=E(t),e.localeCompare(t)},sortableBeaconUUID:function(e,t){return e=C(e),t=C(t),e.localeCompare(t)},sortableCCTVWifiStatus:function(e,t){return e=h(e),t=h(t),e.localeCompare(t)},getIndoorMode:function(e){var t="-",i=A.getRecentAlarm(e);return t=i?(t=i.type,w.prop("FACILITY_DEVICE_STATUS_"+t.toUpperCase())||t):A.getDisplayModeI18N(e.modes,e.operations,!0," / ")},getAssetType:function(e){return(e.assets_types_name?e.assets_types_name:"-")+" / "+(e.subAssetType?e.subAssetType:"-")},getAssetLocation:k,getAssetUsers:function(e){var t="-",i=e.users;if(i&&i[0]){t="";var o,a=i.length;for(o=0;o<a;o++)t+=i[o].ums_users_name,o!=a-1&&(t+=", ")}return t},getMeterCategoryType:c,getMeterType:p,getMeterCurrentConsumption:u,getMeterCurrentConsumptionUnit:function(e){var t=e.type,i=e.mappedType,o="",a=window.Util;return o="Meter.Gas"==t||"Meter.Gas"==i?a.CHAR.Gas:"Meter.WattHour"==t||"Meter.WattHour"==i?a.CHAR.WattHour:"Meter.Water"==t||"Meter.Water"==i?a.CHAR.Water:"",u(e)+o},getDimmingLevel:function(e){var t,i="-",o=e.lights||e.light;return o&&o[0]&&(i=void 0===(t=(o=o[0]).dimmingLevel)?"-":Math.round(t)+"%"),i},getTempWeatherStation:function(e){var t="-",i=e.configuration;return i&&i.locationType&&(t=i.locationType),t},getTempWeatherStationOx:function(e){var t="-",i=e.configuration;return i&&i.locationType&&(t="Outdoor"==(t=i.locationType)?"O":"X"),t},getPointValue:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.value&&(t=i.value),t},getAssetUserName:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_name),t},getAssetUserID:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_id),t},getAssetUserEmail:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_email),t},getAssetUserOrganization:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_organization?i[0].ums_users_organization:"-"),t},getAssetUserWorkPhoneNumber:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_workPhoneNumber?i[0].ums_users_workPhoneNumber:"-"),t},getAssetUserMobilePhoneNumber:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_mobilePhoneNumber?i[0].ums_users_mobilePhoneNumber:"-"),t},getAssetDeviceID:function(e){var t="-",i=e.devices;return i&&i[0]&&(t=i[0].dms_devices_id),t},getAssetDeviceName:function(e){var t="-",i=e.devices;return i&&i[0]&&(t=i[0].dms_devices_name),t},getEnergyMappingOutdoorList:function(c){var p,u=new $.Deferred,v=O.getCurrentBuildingList();return $.ajax({url:"/foundation/space/floors"}).done(function(e){p=e,$.ajax({url:"/dms/devices?types=AirConditionerOutdoor&registrationStatuses=Registered&attributes=id,name,locations"}).done(function(e){var t,i,o,a,n,r,d,s,l=e.length;for(r=0;r<l;r++){if((t=e[r]).locations&&t.locations[0]){for(a=t.locations[0].foundation_space_buildings_id,n=t.locations[0].foundation_space_floors_id,s=v.length,d=0;d<s;d++)if(a==(i=v[d]).id){t.building_group_value=b.toString(i.sortOrder,"0000")+"_"+i.id+"_"+i.name;break}for(s=p.length,d=0;d<s;d++)if(n==(o=p[d]).id){t.floor_group_value=b.toString(o.sortOrder,"0000")+"_"+o.id+"_"+A.getFloorName(o);break}}for(t.assigned=!1,s=c.length,d=0;d<s;d++)if(t.id==c[d].dms_devices_id){t.assigned=!0;break}}u.resolve(e)}).fail(function(e){u.reject(e)})}).fail(function(e){u.reject(e)}),u.promise()},isEnableEnergyMappingType:function(e){var t,i,o=e.mappedType||e.type,a=e.meters;if(!a)return!1;var n,r=a.length;for(n=0;n<r;n++)"AirConditionerAll"==a[n].category&&(t=a[n].category),"AirConditionerOutdoor"==a[n].connectedDeviceType&&(i=a[n].connectedDeviceType);return!("Meter.WattHour"!=o||!t||!i)},getEnergyMappingFieldName:function(e){var t=0,i=e.meters;if(i&&i[0]){var o,a=i.length;for(o=0;o<a;o++)if("AirConditionerAll"==i[o].category&&"AirConditionerOutdoor"==i[o].connectedDeviceType){t=o;break}}return"meters["+t+"].connectedDevices"},getMeterConnectedDevices:function(e){var t=0,i=e.meters;if(i&&i[0]){var o,a=i.length;for(o=0;o<a;o++)if("AirConditionerAll"==i[o].category&&"AirConditionerOutdoor"==i[o].connectedDeviceType){t=o;break}}return i[t]&&i[t].connectedDevices?i[t].connectedDevices:null},getDeviceRegistrationFailMsg:function(e){return 406==e.status&&-1!=e.responseText.indexOf("Count")?w.prop("FACILITY_DEVICE_COUNT_EXCEEDED"):A.parseFailResponse(e)},getConnectedDevicesConsumptionTypeList:function(e){var t={AirConditionerAll:{name:w.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_SAC"),id:"AirConditionerAll"},Light:{name:w.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_LIGHT"),id:"Light"},Others:{name:w.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_OTHERS"),id:"Others"}},i=[];return i.push(t.AirConditionerAll),"Meter.WattHour"===e&&i.push(t.Light),i.push(t.Others),i},getConnectedDevicesConnectionTypeList:function(e,t){var i={None:{name:"None",id:"None"},AirConditioner:{name:A.getDetailDisplayTypeDeviceI18N("SAC Indoor"),id:"AirConditioner"},AirConditionerOutdoor:{name:A.getDetailDisplayTypeDeviceI18N("SAC Outdoor"),id:"AirConditionerOutdoor"},Boiler:{name:A.getDetailDisplayTypeDeviceI18N("Boiler"),id:"Boiler"},CoolingTower:{name:A.getDetailDisplayTypeDeviceI18N("CoolingTower"),id:"CoolingTower"},Pump:{name:A.getDetailDisplayTypeDeviceI18N("Pump"),id:"Pump"},WaterTank:{name:A.getDetailDisplayTypeDeviceI18N("WaterTank"),id:"WaterTank"}},o=[];return"AirConditionerAll"===t&&("Meter.WattHour"===e?o.push(i.AirConditioner,i.AirConditionerOutdoor,i.Pump,i.CoolingTower,i.Boiler):"Meter.Gas"===e?o.push(i.Boiler):"Meter.Water"===e&&o.push(i.WaterTank)),o.push(i.None),o},filterHasListAttrItem:function(e,t){return{field:e,operator:function(e){return e&&e.length?t:!t}}}}}),define("device/common/device-template",["device/common/device-util","device/common/device-constants"],function(N,c){"use strict";function t(e,t,i){var o=e.sender,a=o.dataSource.view(),n=$.grep(a,function(e){return"all"==e.name.toLowerCase()});if(n&&n.length){var r=o.element;r.find(".customStatisticRowStyles").remove();var d=o.items().first().clone();d.attr("data-uid",""),d.data("uid","");var s=d.find("td[role='gridcell']");if(!s.length)return;var l;if(n=n[0],o.dataSource.remove(n),l=n.name,$(s.get(0)).html(l),t){var c=void 0!==n.numberOfSubAssetTypes?n.numberOfSubAssetTypes:"-",p=void 0!==n.numberOfRegisteredAssets?n.numberOfRegisteredAssets:"-",u=void 0!==n.numberOfNormalDevices?n.numberOfNormalDevices:"-",v=void 0!==n.numberOfDisconnectedDevices?n.numberOfDisconnectedDevices:"-",m=void 0!==n.numberOfLowBatteryDevices?n.numberOfLowBatteryDevices:"-",h=void 0!==n.numberOfOutOfBoundsDevices?n.numberOfOutOfBoundsDevices:"-";$(s.get(1)).html(c),$(s.get(2)).html(p),$(s.get(3)).html(u),$(s.get(4)).html(v),$(s.get(5)).html(m).addClass("text-err"),$(s.get(6)).html(h).addClass("text-err")}else if(i)$(s.get(1)).html(U(n)),$(s.get(2)).html(W(n)),$(s.get(3)).html(V(n)),$(s.get(4)).html(B(n)),$(s.get(5)).html(G(n)),$(s.get(6)).html(q(n)),$(s.get(7)).html(j(n)),$(s.get(8)).html(X(n));else{var f=R(n),g=F(n),_=M(n),C=H(n),E=Y(n);$(s.get(1)).html(f);var T,D,O,I,A,w,b,k=s.length;if(7==k)T=void 0!==n.numberOfOnIndoorDevices?n.numberOfOnIndoorDevices:"-",D=void 0!==n.numberOfOnVentilatorDevices?n.numberOfOnVentilatorDevices:"-",O=void 0!==n.numberOfOnDHWDevices?n.numberOfOnDHWDevices:"-",I=void 0!==n.numberOfOffIndoorDevices?n.numberOfOffIndoorDevices:"-",A=void 0!==n.numberOfOffVentilatorDevices?n.numberOfOffVentilatorDevices:"-",w=void 0!==n.numberOfOffDHWDevices?n.numberOfOffDHWDevices:"-",b=void 0!==n.numberOfSchedules?n.numberOfSchedules:"-",$(s.get(2)).html(T+"/"+D+"/"+O),$(s.get(3)).html(I+"/"+A+"/"+w),$(s.get(4)).html(g).addClass("text-err"),$(s.get(5)).html(_).addClass("text-err"),$(s.get(6)).html(b);else if(6==k)$(s.get(2)).html(C),$(s.get(3)).html(E),$(s.get(4)).html(g).addClass("text-err"),$(s.get(5)).html(_).addClass("text-err");else if(5==k){var y;y=P(n),$(s.get(2)).html(y),$(s.get(3)).html(g).addClass("text-err"),$(s.get(4)).html(_).addClass("text-err")}}d.addClass("customStatisticRowStyles"),r.find(".k-grid-header table thead").append(d)}}var e=window.kendo,L=window.Util,S=window.I18N,I=window.GlobalSettings,x=I.getLocale(),p=I.getTemperature().unit,M=function(e){return'<span class="text-err">'+(void 0!==e.numberOfWarningDevices?e.numberOfWarningDevices:"-")+"</span>"},F=function(e){return'<span class="text-err">'+(void 0!==e.numberOfCriticalDevices?e.numberOfCriticalDevices:"-")+"</span>"},R=function(e){return void 0!==e.numberOfRegisteredDevices?e.numberOfRegisteredDevices:"-"},P=function(e){return void 0!==e.numberOfNormalDevices?e.numberOfNormalDevices:"-"},H=function(e){return void 0!==e.numberOfOnDevices?e.numberOfOnDevices:"-"},Y=function(e){return void 0!==e.numberOfOffDevices?e.numberOfOffDevices:"-"},U=function(e){return"<div class='tb beacon'><span class='tbc col-1'>"+R(e)+"</span></div>"},W=function(e){var t=void 0!==e.numberOfFixedDevices?e.numberOfFixedDevices:"-",i=void 0!==e.numberOfMovableDevices?e.numberOfMovableDevices:"-";return"<div class='tb beacon'><span class='tbc col-2'>"+S.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED_TYPE")+"</span><span class='tbc col-3'>"+t+"</span></div><div class='tb beacon'><span class='tbc col-2'>"+S.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE_TYPE")+"</span><span class='tbc col-3'>"+i+"</span></div>"},V=function(e){return"<div class='tb beacon'><span class='tbc col-4'>"+(void 0!==e.numberOfFixedNormalDevices?e.numberOfFixedNormalDevices:"-")+"</span></div><div class='tb beacon'><span class='tbc col-4'>"+(void 0!==e.numberOfMovableNormalDevices?e.numberOfMovableNormalDevices:"-")+"</span></div>"},B=function(e){return"<div class='tb beacon'><span class='tbc col-5'>"+(void 0!==e.numberOfFixedCriticalDevices?e.numberOfFixedCriticalDevices:"-")+"</span></div><div class='tb beacon'><span class='tbc col-5'>"+(void 0!==e.numberOfMovableCriticalDevices?e.numberOfMovableCriticalDevices:"-")+"</span></div>"},G=function(e){return"<div class='tb text-err beacon'><span class='tbc col-6'>"+(void 0!==e.numberOfFixedWarningDevices?e.numberOfFixedWarningDevices:"-")+"</span></div><div class='tb text-err beacon'><span class='tbc col-6'>"+(void 0!==e.numberOfMovableWarningDevices?e.numberOfMovableWarningDevices:"-")+"</span></div>"},q=function(e){return"<div class='tb text-err beacon'><span class='tbc col-7'>"+(void 0!==e.numberOfFixedLowBatteryDevices?e.numberOfFixedLowBatteryDevices:"-")+"</span></div><div class='tb text-err beacon'><span class='tbc col-7'>"+(void 0!==e.numberOfMovableLowBatteryDevices?e.numberOfMovableLowBatteryDevices:"-")+"</span></div>"},j=function(e){return"<div class='tb beacon'><span class='tbc col-8'>"+(void 0!==e.numberOfFixedSchedules?e.numberOfFixedSchedules:"-")+"</span></div><div class='tb beacon'><span class='tbc col-8'>"+(void 0!==e.numberOfMovableSchedules?e.numberOfMovableSchedules:"-")+"</span></div>"},X=function(e){return"<div class='tb beacon'><span class='tbc col-9'>"+(void 0!==e.numberOfFixedRules?e.numberOfFixedRules:"-")+"</span></div><div class='tb beacon'><span class='tbc col-9'>"+(void 0!==e.numberOfMovableRules?e.numberOfMovableRules:"-")+"</span></div>"},i='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+S.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+S.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</li><li><span class="disc r"></span>'+S.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+S.prop("FACILITY_DEVICE_STATUS_WARNING")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-peak"></Label>'+S.prop("FACILITY_INDOOR_STATUS_PEAK")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-deforest"></Label>'+S.prop("FACILITY_INDOOR_STATUS_DEFROST")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-filter" ></Label>'+S.prop("FACILITY_INDOOR_STATUS_FILTER_WARNING")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-rc-disable"></Label>'+S.prop("FACILITY_INDOOR_STATUS_RC_OFF")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-rock"></Label>'+S.prop("FACILITY_INDOOR_STATUS_OPERATION_LIMIT")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-thurmo"></Label>'+S.prop("FACILITY_INDOOR_TEMPERATURE_LIMIT")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-schedule"></Label>'+S.prop("FACILITY_DEVICE_SAC_INDOOR_SCHEDULE")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-spi"></Label>'+S.prop("FACILITY_INDOOR_CONTROL_SPI")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-antifreeze"></Label>'+S.prop("FACILITY_INDOOR_STATUS_FREEZE_PROTECTION")+"</li></ul></div>",o='<div class="flyoutBox lg"><ul class="legendList"><li><span class="disc g"></span>'+S.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</li><li class="no-block"><span class="disc r"></span>'+S.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li class="no-block"><span class="disc y"></span>'+S.prop("FACILITY_DEVICE_STATUS_WARNING")+'</li></ul><ul class="legendList"><li><span class="disc gr"></span>'+S.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED")+'</li><li><span class="disc measured gr"></span>'+S.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE")+"</li></ul></div>",a='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+S.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+S.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+"</li></ul></div>",n='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+S.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</li><li><span class="disc r"></span>'+S.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+S.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li></ul></div></div>",r='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+S.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+S.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</li><li><span class="disc r"></span>'+S.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+S.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li></ul></div></div>",u=e.template('<span title="" class="k-widget k-dropdown k-header common-grid-dropdown sac-indoor-dropdownlist"unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-busy="false"aria-activedescendant="80142285-e564-4717-88fa-3dd3d64ad025" data-field="#=field#"><span unselectable="on" class="k-dropdown-wrap #if(disabled){#k-state-disabled#}else{#k-state-default#}#"><span unselectable="on" class="k-input">#=text#</span><span unselectable="on" class="k-select" aria-label="select"><span class="k-icon k-i-arrow-60-down"></span></span></span><input class="sac-indoor-dropdownlist current-limit" data-value="#=value#" style="display: none;"></span>');return{mapListTemplate:function(e){var t=!1,i=e.operations,o=e.type,a=e.modes,n=e.mappedType,r=e.name,d=e.id,s=L.getStatus(e);s&&"Alarm"==(s=1<(s=s.split(".")).length?(L.isOnlyNormalType(e)&&s[0],s[1]):"Off")[0]&&(t=!0);var l=e.modes;t?l=s[0]:l&&0<l.length&&(l=L.getDisplayMode(a,i));return'<div class="device-map-panel-list-item">'+("<span class='detail-img "+s+" "+l+"' data-status='"+s+"' data-mode='"+l+"' data-type='"+o+"' data-mapped-type='"+n+"'></span>")+("<div class='detail-text'><span class='id'>"+d+"</span><span class='name'>"+L.decodeHtml(r)+"</span></div>")+("<span class='ic ic-info' data-id='"+d+"'></span>")+"</div>"},multiDetailListTemplate:function(e,t){var i="",o="",a="",n="",r=e.operations,d=e.modes;a=e.name;var s=!1;(o=L.getStatus(e))&&"Alarm"==(o=1<(o=o.split(".")).length?(n=o[0],L.isOnlyNormalType(e)&&"Alarm"!=o[0]||(n+="("+o[1]+")"),o[1]):(n=o[0],"Off"))[0]&&(s=!0),i=e.modes,s?i=o[0]:i&&0<i.length&&(i=L.getDisplayMode(d,r));var l="",c=e.type;return t&&c&&-1==c.indexOf("AirConditioner.")&&(l=L.getDisplayClassType(e)),"<span class='detail-img "+o+" "+i+" "+l+"'></span>"+(a="<span data-bind='text: name'>"+L.decodeHtml(a)+"</span>")+(o="<span class='panel-item-temp'><span>"+L.getStatusI18N(n)+"</span></span>")},detailPopupGroupListTemplate:function(e){var t=e.dms_devices_name,i=e.dms_devices_id,o=e.dms_devices_type,a=e.dms_devices_mappedType;return"ControlPoint"!=a&&(o=a||o),'<div class="device-detail-popup-group-list-item">'+("<span class='detail-img reg selected "+(o=L.getDisplayClassType(o))+"'></span>")+("<div class='detail-text'><span class='id'>"+i+"</span><span class='name'>"+L.decodeHtml(t)+"</span></div>")+"</div>"},multiDetailRegisterListTemplate:function(e){var t="",i="",o="",a="",n=e.operations,r=e.modes;e.type;o=e.name;var d=!1,s="unreg";return"Registered"==e.registrationStatus&&(s="reg"),(i=L.getStatus(e))&&"Alarm"==(i=1<(i=i.split(".")).length?(a=i[0],L.isOnlyNormalType(e)&&"Alarm"!=i[0]||(a+="("+i[1]+")"),i[1]):(a=i[0],"Off"))[0]&&(d=!0),"Alarm"==i[0]&&(d=!0),d?t=i[0]:t&&0<t.length&&(t=L.getDisplayMode(r,n)),"<span class='detail-img "+s+" "+L.getDisplayClassType(e)+"'></span>"+(o="<span data-bind='text: name'>"+L.decodeHtml(o)+"</span>")+(i="<span class='panel-item-temp'><span>"+a+"</span></span>")},multiDetailListDualTemplate:function(e,t,i){var o="",a="",n="",r="",d=e.operations,s=e.modes,l=void 0!==e.assets_types_id,c="name";l?void 0!==e.number&&null!==e.number&&""!==e.number?(n=e.number,c="number"):e.devices&&e.devices[0]&&(n=e.devices[0].dms_devices_name,c="devices[0].dms_devices_name"):n=e.name;var p=!1;(a=L.getStatus(e))&&"Alarm"==(a=1<(a=a.split(".")).length?(r=a[0],L.isOnlyNormalType(e)&&"Alarm"!=a[0]||(r+="("+a[1]+")"),a[1]):(r=a[0],"Off"))[0]&&(p=!0),o=e.modes,p?o=a[0]:o&&0<o.length&&(o=L.getDisplayMode(s,d));var u=e.type,v="",m=L.getPositionType(e);return v=l?t?"-"!=m&&"Movable"==m?"asset "+e.assets_types_name.toLowerCase()+" movable-reg":"asset "+e.assets_types_name.toLowerCase()+" reg":("-"!=m&&"Movable"==m&&(v="asset "+e.assets_types_name.toLowerCase()+" "+a+" movable"),"asset "+e.assets_types_name.toLowerCase()+" "+a):t?"-"!=m&&"Movable"==m?L.getDisplayClassType(e)+" movable-reg":L.getDisplayClassType(e)+" reg":-1!=u.indexOf("AirConditioner.")?a+" "+o:"-"!=m&&"Movable"==m?a+" "+o+" "+L.getDisplayClassType(e)+" movable":a+" "+o+" "+L.getDisplayClassType(e),i&&(v+=" selected"),"<span class='detail-img "+v+"'></span>"+(n="<span data-bind='text: "+c+"'>"+L.decodeHtml(n)+"</span>")+(a="<span class='panel-item-temp'><span>"+L.getStatusI18N(r)+"</span></span>")},mapListRegTemplate:function(e){var t=!1,i=e.operations,o=e.type,a=e.modes,n=e.mappedType,r=e.name,d=e.id,s=L.getStatus(e);s&&"Alarm"==(s=1<(s=s.split(".")).length?(L.isOnlyNormalType(e)&&s[0],s[1]):"Off")[0]&&(t=!0);var l=e.modes;t?l=s[0]:l&&0<l.length&&(l=L.getDisplayMode(a,i)),o=e.type;return'<div class="device-map-panel-list-item">'+("<span class='detail-img reg "+L.getDisplayClassType(e)+"' data-status='"+s+"' data-mode='"+l+"' data-type='"+o+"' data-mapped-type='"+n+"'></span>")+("<div class='detail-text'><span class='id'>"+d+"</span><span class='name'>"+L.decodeHtml(r)+"</span></div>")+("<span class='ic ic-info' data-id='"+d+"'></span>")+"</div>"},mapListDualTemplate:function(e,t){var i=!1,o=e.operations,a=e.type,n=e.modes,r=e.mappedType,d=e.name,s=e.id,l=L.getStatus(e);l&&"Alarm"==(l=1<(l=l.split(".")).length?(L.isOnlyNormalType(e)&&l[0],l[1]):"Off")[0]&&(i=!0);var c=e.modes;i?c=l[0]:c&&0<c.length&&(c=L.getDisplayMode(n,o)),a=e.type;var p=L.getPositionType(e);return'<div class="device-map-panel-list-item">'+("<span class='detail-img "+(t?"-"!=p&&"Movable"==p?L.getDisplayClassType(e)+" movable-reg":L.getDisplayClassType(e)+" reg":-1!=a.indexOf("AirConditioner.")?l+" "+c:"-"!=p&&"Movable"==p?l+" "+c+" "+L.getDisplayClassType(e)+" movable":l+" "+c+" "+L.getDisplayClassType(e))+"' data-status='"+l+"' data-mode='"+c+"' data-type='"+a+"' data-mapped-type='"+r+"'></span>")+("<div class='detail-text'><span class='id'>"+s+"</span><span class='name'>"+L.decodeHtml(d)+"</span></div>")+("<span class='ic ic-info' data-id='"+s+"'></span>")+"</div>"},getDeviceCardTemplate:function(e){var t=L.getStatus(e);t=t.replace(".","-");var i=N.getLocation(e),o=$("<div/>"),a=$("<div/>").addClass("engCardWrap").attr("data-uid",e.uid).attr("data-id",e.id);e.selected&&a.addClass("k-state-selected");var n=$("<div/>").addClass("engCard "+t),r=$("<div/>").addClass("tb icon"),d=$("<div/>").addClass("bound"),s=e.type,l=e.mappedType,c=void 0!==e.assets_types_id,p="ic-energy";s?-1!=s.indexOf("Light")||l&&-1!=l.indexOf("Light")?p="ic-light":-1!=s.indexOf("SmartPlug")?p="ic-smartplug":-1!=s.indexOf("Temperature")||-1!=s.indexOf("Humidity")||l&&-1!=l.indexOf("Temperature")||l&&-1!=l.indexOf("Humidity")?p="ic-temperature":-1!=s.indexOf("Gateway")?p="ic-gateway":-1!=s.indexOf("Beacon")?p="ic-beacon":-1!=s.indexOf("CCTV")?p="ic-cctv":(-1!=s.indexOf("Motion")||l&&-1!=l.indexOf("Motion"))&&(p="ic-motion"):c&&(p="asset "+e.assets_types_name.toLowerCase());var u=$("<span/>").addClass("dvcic "+p);d.append(u),r.append(d),n.append(r);var v=$("<div/>").addClass("txtwrap"),m=t.split("-"),h="";if("Normal"==m[0]){var f;s&&-1!=s.indexOf("Meter")||l&&-1!=l.indexOf("Meter")?(f="Meter.Gas"==s||"Meter.Gas"==l?L.CHAR.Gas:"Meter.WattHour"==s||"Meter.WattHour"==l?L.CHAR.WattHour:"Meter.Water"==s||"Meter.Water"==l?L.CHAR.Water:"",t=N.getMeterCurrentConsumption(e),t+="<span class='unit'>"+f+"</span>"):s&&-1!=s.indexOf("Temperature")||l&&-1!=l.indexOf("Temperature")?(t=N.getTempHumiTemperature(e,!0),t+="<span class='unit'>"+(f=L.CHAR[I.getTemperature().unit])+"</span>"):s&&-1!=s.indexOf("Humidity")||l&&-1!=l.indexOf("Humidity")?(f=L.CHAR.Humidity,t=N.getTempHumiHumidity(e,!0),t+="<span class='unit'>"+f+"</span>"):s&&-1!=s.indexOf("Motion")||l&&-1!=l.indexOf("Motion")?t=N.getMotionPresence(e):(t=m[0],L.isOnlyNormalType(e)&&"Alarm"!=t[0]||(t+="("+m[1]+")"))}else{t=m[1];var g=L.getRecentAlarm(e);g&&(h=c||s&&("Beacon"==s||"Gateway"==s||"CCTV"==s)?L.getAlarmDescription(g.name):"Code "+g.name)}var _=$("<p/>").addClass("cardName ellp").html(L.getStatusI18N(t)),C=$("<p/>").addClass("cardDesc ellp").text(h),E=$("<p/>").addClass("loc ellp").text(i),T="";T=c?e.number:e.name;var D=$("<p/>").addClass("dvc ellp").text(T),O=$("<i/>").addClass("ic ic-info").attr("data-id",e.id);return v.append(_),v.append(C),v.append(E),v.append(D),v.append(O),n.append(v),a.append(n),o.append(a),o.html()},statisticNumberOfCritical:F,statisticNumberOfWarning:M,statisticNumberOfRegisteredDevice:R,statisticNumberOfNormalDevices:P,statisticNumberOfOnDevices:H,statisticNumberOfOnIndoorDevices:function(e){return(void 0!==e.numberOfOnIndoorDevices?e.numberOfOnIndoorDevices:"-")+"/"+(void 0!==e.numberOfOnVentilatorDevices?e.numberOfOnVentilatorDevices:"-")+"/"+(void 0!==e.numberOfOnDHWDevices?e.numberOfOnDHWDevices:"-")},statisticNumberOfOffDevices:Y,statisticNumberOfOffIndoorDevices:function(e){return(void 0!==e.numberOfOffIndoorDevices?e.numberOfOffIndoorDevices:"-")+"/"+(void 0!==e.numberOfOffVentilatorDevices?e.numberOfOffVentilatorDevices:"-")+"/"+(void 0!==e.numberOfOffDHWDevices?e.numberOfOffDHWDevices:"-")},getStatusTemplate:function(e){var t=L.getStatus(e);return"<div><span class='circle-icon "+(t=t.replace(".","-"))+"'></span></div>"},getStatisticRow:t,getAssetStatusTemplate:function(e){var t=L.getAssetStatus(e);return"<div><span class='circle-icon "+(t=t.replace(".","-"))+"'></span></div>"},assetMapListRegTemplate:function(e){var t=e.assets_types_name,i=e.number,o=e.id,a=e.subAssetType;a&&(t+=" / "+a);var n=L.getStatus(e);n&&(n=1<(n=n.split(".")).length?(L.isOnlyNormalType(e)&&n[0],n[1]):"Off")[0];var r=L.getPositionType(e);return'<div class="device-map-panel-list-item">'+("<span class='detail-img asset "+n+" "+("-"!=r&&"Movable"==r?L.getDisplayClassType(e)+" movable":L.getDisplayClassType(e))+"' data-status='"+n+"'></span>")+("<div class='detail-text'><span class='id'>"+i+"</span><span class='name'>"+L.decodeHtml(t)+"</span></div>")+("<span class='ic ic-info' data-id='"+o+"'></span>")+"</div>"},getStatisticRowAsset:function(e){t(e,!0)},getStatisticRowBeacon:function(e){t(e,!1,!0)},statisticAssetFloor:function(e){return e.isSubAsset?"":e.name?e.name:"-"},statisticAssetTypes:function(e){var t="-";e.isSubAsset?t=(void 0!==e.assets_types_name?e.assets_types_name:"-")+(void 0!==e.assets_subAssetType?" / "+e.assets_subAssetType:""):t=void 0!==e.numberOfSubAssetTypes?e.numberOfSubAssetTypes:"-";return t},statisticAssetRegisteredAssets:function(e){return void 0!==e.numberOfRegisteredAssets?e.numberOfRegisteredAssets:"-"},statisticAssetNormalDevices:function(e){return void 0!==e.numberOfNormalDevices?e.numberOfNormalDevices:"-"},statisticAssetCriticalDevices:function(e){return void 0!==e.numberOfCriticalDevices?e.numberOfCriticalDevices:"-"},statisticAssetWarningDevices:function(e){return void 0!==e.numberOfWarningDevices?e.numberOfWarningDevices:"-"},statisticAssetDisconnectedDevices:function(e){return void 0!==e.numberOfDisconnectedDevices?e.numberOfDisconnectedDevices:"-"},statisticAssetLowBatteryDevices:function(e){return"<span class='text-err'>"+(void 0!==e.numberOfLowBatteryDevices?e.numberOfLowBatteryDevices:"-")+"</span>"},statisticAssetOutOfBoundsDevices:function(e){return"<span class='text-err'>"+(void 0!==e.numberOfOutOfBoundsDevices?e.numberOfOutOfBoundsDevices:"-")+"</span>"},assetTypeListTemplate:function(e){var t=e.name;return"<span class='detail-img asset "+t.toLowerCase()+"'></span>"+("<span data-bind='text: name'>"+L.decodeHtml(t)+"</span>")+"<span class='panel-item-temp'><span></span></span>"},statisticBeaconRegister:U,statisticBeaconPositionType:W,statisticBeaconNormal:V,statisticBeaconDisconnected:B,statisticBeaconWrongLocation:G,statisticBeaconLowBattery:q,statisticBeaconSchdules:j,statisticBeaconRules:X,detailStatusIconTemplate:function(e){var t=L.getStatus(e),i=t.split("."),o="<span class='circle-icon detail-popup "+i[0]+"-"+i[1]+"'></span>";if(-1<t.indexOf("Alarm")){var a=$("<div/>");t=t.replace(".","-");var n=L.getRecentAlarm(e),r=n.type,d=S.prop("FACILITY_DEVICE_STATUS_POPUP_"+r.toUpperCase());r=d||r;var s=$("<span/>").addClass(t).text(r+" "+S.prop("COMMON_CODE")+" "+n.name),l=$("<span/>").text(L.getAlarmDescription(n.name));return a.append(o),a.append(s),a.append("<br>"),a.append(l),a.html()}var c=i[0];return L.isOnlyNormalType(e)&&"Alarm"!=t[0]||(c+="("+i[1]+")"),o+L.getStatusI18N(c)},detailIconTemplateById:function(e){return'<span class="ic ic-info" data-num="detail" data-id='+e.id+' data-event="devicedetail"></span>'},indoorLegendTemplate:i,beaconLegendTemplate:o,pointLegendTemplate:a,baseLegendTemplate:n,legendTemplate:r,indoorTemperatureListTemplate:function(e){var t,i=$("<div/>"),o=$("<div/>"),a=L.getRecentAlarm(e),n=L.getStatus(e).replace(".","-");if(a){var r=S.prop("COMMON_CODE")+" "+a.name;t=$("<span/>").addClass(n).text(r),o.append(t),i.append(o)}else{var d,s,l=N.getTemperatures(e,!0);d=l.current,s=l.desired,t=$("<span/>").addClass(n).addClass("current").text(d);var c=$("<span/>").addClass(n).addClass("set").text(s);if(o.append(c),o.append(" / "),o.append(t),i.append(o),l.dhwDesired||l.dhwCurrent){var p=$("<div/>"),u=$("<span/>").addClass(n).addClass("current").text(l.dhwCurrent),v=$("<span/>").addClass(n).addClass("set").text(l.dhwDesired);p.append(v),p.append(" / "),p.append(u),i.append(p)}}return i.html()},indoorCardTemplate:function(e){var t,i=L.getDisplayMode(e.modes,e.operations),o=L.getStatus(e);o=o.replace(".","-"),e.information&&e.information.modelName&&(t="I"+e.information.modelName.toUpperCase().replace(/\s/gi,"").replace("+","PLUS"));var a=$("<div/>"),n=$("<div/>").addClass("card-item").attr("data-uid",e.uid).attr("data-id",e.id);e.selected&&n.addClass("k-state-selected");var r=$("<div/>"),d=$("<div/>").addClass("icon-line"),s=$("<div/>").addClass("card-info"),l=$("<div/>").addClass("left"),c=$("<div/>").addClass("right"),p=$("<span/>").addClass("type").addClass(o),u=$("<div/>").addClass("item-bottom"),v=e.name;v&&10<v.length&&(v=v.substring(0,10),v+="...");var m,h=$("<span/>").addClass("device-type-img "+t).text(v),f=L.getRecentAlarm(e);if(f){m="error",r.addClass("card-back "+o),p.text(" "),d.append("<div class='icon empty'/>");var g=o.split("-")[1];g="<span class='error'>"+(g=S.prop("FACILITY_INDOOR_MODE_"+g.toUpperCase()))+"</p><p>"+S.prop("COMMON_CODE")+" "+f.name+"</p>";var _=$("<span/>").addClass("error "+o).html(g);c.append(_),u.addClass("error")}else{var C;"HotWater"===i&&(i="HeatStorage"),m=N.convertDisplayName(i),"HeatStorage"===(C="ko"==x?L.getModeToI18N(i):m)?p.text("H.Water"):p.text(C);var E,T,D,O=N.getGridIcon(e),I=N.getTemperatures(e);if(E=I.current,T=I.desired,D=I.unit,O.length)for(var A=0,w=O.length;A<w;A++)d.append('<div class="icon '+O[A]+'"/>');else d.append("<div class='icon empty'/>");var b=$("<span/>").addClass(o).addClass("set");I.isWaterout&&$("<div/>").addClass("icon ic-dhwtemp-card").appendTo(b),$("<em/>").text(S.prop("FACILITY_INDOOR_SET")).appendTo(b),b.append(T),b.attr("data-content",D);var k=$("<span/>").addClass(o).addClass("current");$("<em/>").text(S.prop("FACILITY_INDOOR_CURRENT")).appendTo(k),k.append(E),k.attr("data-content",D),c.append(b),c.append(k)}var y=$("<span/>").addClass("device-img "+m+" "+o);return l.append(p),l.append(y),s.append(l),s.append(c),u.append(h),u.append('<i class="ic ic-info" data-id='+e.id+">"),r.append(d),r.append(s),r.append(u),n.append(r),a.append(n),a.html()},outdoorDropDownListTemplate:u,outdoorCurrentLimitTemplate:function(e){var t,i,o="-",a=e.airConditioner;a&&(i=a.outdoorUnit)&&(t=o=(o=i.electricCurrentControl)||"-",isNaN(o)?t=S.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"):t+="%");var n=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").text(S.prop("FACILITY_INDOOR_CURRENT")+": "+t).appendTo(n);var r=e.airConditioner,d=!1;return r&&(i=r.outdoorUnit),i&&(d=!i.electricCurrentControlSupported),"-"==o&&(o=c.outdoorControlConfig.electricCurrentControl[0].value),$(u({value:o,text:t,disabled:d,field:"electricCurrentControl"})).addClass("outdoor-dropdownlist").appendTo(n),n.html()},outdoorHeatingCapacityCalibrationTemplate:function(e){var t,i,o="-",a=e.airConditioner;a&&(i=a.outdoorUnit)&&(t=o=(o=i.heatingCapacityCalibration)||"-",isNaN(o)?t=S.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"):t+="kg/cm\xb2");var n=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").text(S.prop("FACILITY_INDOOR_CURRENT")+": "+t).appendTo(n);var r=e.airConditioner,d=!1;return r&&(i=r.outdoorUnit),i&&(d=!i.heatingCapacityCalibrationSupported),"-"==o&&(o=c.outdoorControlConfig.heatingCapacityCalibration[0].value),$(u({value:o,text:t,disabled:d,field:"heatingCapacityCalibration"})).addClass("outdoor-dropdownlist").appendTo(n),n.html()},outdoorCoolingCapacityCalibrationTemplate:function(e){var t,i,o="-",a=e.airConditioner;if(a&&(i=a.outdoorUnit))if("SelfControl"!=(o=(o=i.coolingCapacityCalibration)||"-")){var n=c.outdoorControlConfig.coolingCapacityCalibration[p],r=$.grep(n,function(e){return e.value==o});t=r[0]?r[0].text:"-"}else t=S.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL");var d=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").appendTo(d).text(S.prop("FACILITY_INDOOR_CURRENT")+": "+t);var s=e.airConditioner,l=!1;return s&&(i=s.outdoorUnit),i&&(l=!i.coolingCapacityCalibrationSupported),"-"==o&&(o=c.outdoorControlConfig.coolingCapacityCalibration[p][0].value),$(u({value:o,text:t,disabled:l,field:"coolingCapacityCalibration"})).addClass("cooling-capacity-calibaration-dropdownlist").addClass("outdoor-dropdownlist").appendTo(d),d.html()},pointTypeTemplate:function(e){return e.type.replace("ControlPoint.","")},pointValueTemplate:function(e){if(!e.controlPoint)return"-";var t=e.controlPoint.value,i=e.type;return-1!=i.indexOf("AO")||-1!=i.indexOf("AV")?'<input class="device-point-numeric" data-type="aoav" value="'+t+'" style="width:50%; text-align:center;"/><button class="device-point-sendbtn">'+S.prop("COMMON_BTN_SEND")+"</button>":-1!=i.indexOf("DO")||-1!=i.indexOf("DV")?'<input class="device-point-numeric" data-type="dodv" value="'+t+'" style="width:50%; text-align:center;"/><button class="device-point-sendbtn">'+S.prop("COMMON_BTN_SEND")+"</button>":t},gatewayListZigbeeTemplate:function(e){var t=N.getZigbeeStatus(e).split(".");return"<span class='circle-icon detail-popup "+t[0]+"-"+t[1]+"'></span>"},gatewayListBleTemplate:function(e){var t=N.getBleStatus(e).split(".");return"<span class='circle-icon detail-popup "+t[0]+"-"+t[1]+"'></span>"},gatewayListBleInterfaceTemplate:function(e){var t,i,o="";for(t=0;t<3;t++)o+="<span class='beacon-status'><span class='circle-icon detail-popup "+(i=N.getBleInterfaceStatus(e,t).split("."))[0]+"-"+i[1]+"'></span></span>";return o},bleMacAddressTemplate:function(e){return"<span class='ellipse'>"+N.getBleMacAddress(e)+"</span>"},bleUUIDTemplate:function(e){return"<span class='ellipse'>"+N.getBleUUID(e)+"</span>"}}}),define("operation/group/config/group-model",function(){"use strict";var d=window.kendo.data.Model.define({id:"id",fields:{name:{name:"Name"},type:{name:"Type"},description:{name:"Description"},dms_devices_ids:{name:"Devices",type:"object",defaultValue:[]}}});return{MockData:[{foundation_space_buildings_id:1,foundation_space_buildings_name:"A Tower",floors:[{foundation_space_floors_id:23,foundation_space_floors_type:"F",foundation_space_floors_name:"15",groups:[{dms_groups_id:11,dms_groups_name:"Marketing Department",dms_groups_description:"A collection of all devices belonging to the marketing department.",deviceTypes:[{dms_devices_type:"AirConditionerOutdoor",numberOfDevices:1},{dms_devices_type:"AirConditioner.Indoor",numberOfDevices:3},{dms_devices_type:"Beacon",numberOfDevices:2}]},{dms_groups_id:12,dms_groups_name:"Sales Department",dms_groups_description:"A collection of all devices belonging to the sales department.",deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",numberOfDevices:4},{dms_devices_type:"Beacon",numberOfDevices:3}]}]}]}],createDataSource:function(e,t,i){var o,a,n,r,d,s,l=e.length;for(o=0;o<l;o++){if((r=e[o]).deviceTypes)for(n=r.deviceTypes.length,a=0;a<n;a++)d=r.deviceTypes[a].dms_devices_type,s=r.deviceTypes[a].numberOfDevices,r[d]=s;i&&(r.selected=!1)}return e},createModel:function(e){var t=new d(e);return e||t.set("dms_devices_ids",[]),t},createModelByGroupIdData:function(e){var t,i,o,a=new d;if(a.set("id",e.id),a.set("name",e.name),a.set("type",e.type),i=e.devices){o=i.length;var n,r=[];for(t=0;t<o;t++)n=i[t].dms_devices_id,r.push(n);a.set("dms_devices_ids",r)}return a}}}),define("operation/schedule/config/schedule-common",[],function(){var e,t=window.I18N,i={TXT_SELECT_ALL:t.prop("COMMON_BTN_SELECT_ALL"),TXT_UNSELECT_ALL:t.prop("COMMON_BTN_DESELECT_ALL"),TXT_CREATE_SCHEDULE:t.prop("FACILITY_SCHEDULE_CREATE_NEW_SCHEDULE"),TXT_EDIT_SCHEDULE:t.prop("FACILITY_SCHEDULE_EDIT_SCHEDULE"),TXT_DELETE_SCHEDULE:t.prop("FACILITY_SCHEDULE_DELETE_SCHEDULE_CONFIRM"),TXT_DELETE_EXCEPTIONAL_DAY:t.prop("FACILITY_SCHEDULE_DELETE_EXCEPTIONAL_DAY_CONFIRM"),TXT_DELETE_MULTI_EXCEPTIONAL_DAY:t.prop("FACILITY_SCHEDULE_DELETE_MULTI_EXCEPTIONAL_DAY_CONFIRM"),TXT_DELETE_SCHEDULE_RESULT:t.prop("FACILITY_SCHEDULE_DELETE_SCHEDULE_RESULT"),TXT_DELETE_SCHEDULE_MULTI_RESULT:t.prop("FACILITY_SCHEDULE_DELETE_SCHEDULE_MULTI_RESULT"),TXT_DELETE_EXCEPTIONAL_DAY_RESULT:t.prop("FACILITY_SCHEDULE_DELETE_EXCEPTIONAL_DAY_RESULT"),TXT_DELETE_EXCEPTIONAL_DAY_MULTI_RESULT:t.prop("FACILITY_SCHEDULE_DELETE_EXCEPTIONAL_DAY_MULTI_RESULT"),TXT_CREATE_SCHEDULE_CONFIRM:t.prop("FACILITY_SCHEDULE_CREATE_SCHEDULE_CONFIRM"),TXT_CREATE_SCHEDULE_CLOSE_CONFIRM:t.prop("COMMON_CLOSE_WINDOW_CONFIRM"),TXT_EDIT_SCHEDULE_CONFIRM:t.prop("FACILITY_SCHEDULE_EDIT_SCHEDULE_CONFIRM"),TXT_CANCEL_SCHEDULE_CONFIRM:t.prop("COMMON_MESSAGE_CONFIRM_CANCEL"),TXT_CREATE_SCHEDULE_RESULT:t.prop("COMMON_MESSAGE_NOTI_SAVED")},o='<div class="k-floatwrap k-header k-scheduler-toolbar grid-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-views k-scheduler-navigation"><li class="k-current-view-dropdownlist"><input id="toolbar-dropdownlist-btn" data-role="dropdownlist" data-text-field="text" data-value-field="value" data-option-label="'+t.prop("FACILITY_DEVICE_TYPE_ALL")+'" data-bind="source: dateTypeFilter.options.dataSource, events: {select: dateTypeFilter.options.select }"></input></li><li class="k-state-default k-header k-nav-today" data-action="today"><button data-role="button" class="k-button" data-bind="disabled: todayButton.disabled, events: {click: todayButton.options.click}"><span data-bind="text:todayButton.text"></span></button></li></ul><ul class="k-reset k-scheduler-navigation" data-bind="invisible: navigation.isInvisible"><li class="k-state-default k-header k-nav-prev" data-action="previous"><a role="button" class="k-link"><span class="ic ic-date-prev"></span></a></li><li class="k-state-default k-nav-current" data-action="nav-current"><a role="button" class="k-link"><span class="k-icon k-i-calendar"></span><span class="k-sm-date-format" data-bind="text: formattedShortDate" style="display:block;">2017-04-23 ~ 2017-04-29</span></a><i class="ic ic-error-calendar" style="display:none;"></i></li><li class="k-state-default k-header k-nav-next" data-action="next"><a role="button" class="k-link"><span class="ic ic-date-next"></span></a></li></ul><ul class="k-reset k-header k-scheduler-views legend"><li class="k-current-view" data-name="week"><a role="button" class="k-link">Week</a></li><li class="selected-text"><span data-bind="text: selectedText"></span></li></ul></div>',a='<div class="k-floatwrap k-header k-scheduler-toolbar grid-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-views k-scheduler-navigation"><li class="k-state-default k-view-month" data-name="month"><a role="button" class="k-button">'+t.prop("COMMON_MONTH")+'</a></li><li class="k-state-default k-view-year" data-name="year"><a role="button" class="k-button">'+t.prop("COMMON_YEAR")+'</a></li></ul><ul class="k-reset k-scheduler-navigation"><li class="k-state-default k-header k-nav-prev" data-action="previous"><a role="button" class="k-link"><span class="k-icon k-i-arrow-60-left"></span></a></li><li class="k-state-default k-nav-current"><a role="button" class="k-link"><span class="k-icon k-i-calendar"></span><span class="k-sm-date-format" data-bind="text: formattedShortDate" style="display:block;">2017-04-23 ~ 2017-04-29</span></a></li><li class="k-state-default k-header k-nav-next" data-action="next"><a role="button" class="k-link"><span class="k-icon k-i-arrow-60-right"></span></a></li></ul></div>',n=$("<div/>"),r=$("<div/>");return e=n.kendoCommonDialog().data("kendoCommonDialog"),{MSG:i,createNewWidget:function(e,t,i){return new t($("<div/>").attr("id",e),i)},schedulerHeaderTemplate:'<div class="k-floatwrap k-header k-scheduler-toolbar grid-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-views k-scheduler-navigation"><li class="k-current-view-dropdownlist"><input id="toolbar-dropdownlist-btn" data-role="dropdownlist" data-text-field="text" data-value-field="value" data-bind="source: dateTypeFilter.options.dataSource, events: {select: dateTypeFilter.options.select }"></input></li><li class="k-state-default k-header k-nav-today" data-action="today"><button data-role="button" class="k-button" data-bind="disabled: todayButton.disabled, events: {click: todayButton.options.click}"><span data-bind="text:todayButton.text"></span></button></li></ul><ul class="k-reset k-scheduler-navigation" data-bind="invisible: navigation.isInvisible"><li class="k-state-default k-header k-nav-prev" data-action="previous"><a role="button" class="k-link"><span class="ic ic-date-prev"></span></a></li><li class="k-state-default k-nav-current" data-action="nav-current"><a role="button" class="k-link"><span class="k-icon k-i-calendar"></span><span class="k-sm-date-format" data-bind="text: formattedShortDate" style="display:block;">2017-04-23 ~ 2017-04-29</span></a><i class="ic ic-error-calendar" style="display:none;"></i></li><li class="k-state-default k-header k-nav-next" data-action="next"><a role="button" class="k-link"><span class="ic ic-date-next"></span></a></li></ul><ul class="k-reset k-header k-scheduler-views legend"><li class="k-current-view" data-name="week"><a role="button" class="k-link">Week</a></li><li class="selected-text"><span data-bind="text: selectedText"></span></li></ul></div>',schedulerSearchHeaderTemplate:o,exceptionalDaysHeaderTemplate:a,confirmDialog:r.kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog"),msgDialog:e}}),define("operation/schedule/config/schedule-template",[],function(){function o(e){var t=e.devices,i=3;if(e.activated){var o,a,n,r;if(t&&0<t.length){var d,s=t.length;for(r=n=!1,d=0;d<s;d++)o=t[d].dms_devices_type,a=t[d].dms_devices_mappedType,-1!=o.indexOf("AirConditioner")&&(n=!0),(-1!=o.indexOf("Light")||a&&-1!=a.indexOf("Light"))&&(r=!0)}i=n&&r?2:n?0:r?1:3}else i=4;e.type=i;var l=p[i],c={type:i};return l&&(c.text=l.displayText,c.className=l.className),c}function a(e){var t="",i=o(e);return i.className&&(t=i.className),t}function t(e){return"<span class='panel-item-temp schedule-status'><span>"+(e.activated?S.prop("FACILITY_SCHEDULE_ACTIVATED"):S.prop("FACILITY_SCHEDULE_NOT_ACTIVATED"))+"</span></span>"}function i(e){return"<span class='action-button-wrapper'><button class='k-button action-button "+(e.activated?"ic ic-action-pause":"ic ic-action-play")+"'></button></span>"+t(e)}function n(e){e.name=e.name||e.title,e.title=e.name;var t=e.name;return"<span class='td-padding-left'>"+L.decodeHtml(t)+"</span>"}function r(e){if("scheduleDay"!==e.field){var t,i,o,a,n,r,d="",s="<span>",l=void 0!==e.deviceTypes?e.deviceTypes:[],c={operations:[],temperatures:[],modes:[],configuration:{},aoControlPoint:{},doControlPoint:{},lights:[]},p=e.algorithm;for(i=l.length,t=0;t<i;t++)(n=(a=l[t]).control)&&(n.operations&&((r=n.operations)instanceof N.data.ObservableArray&&(r=r.toJSON()),c.operations=c.operations.concat(r)),n.temperatures&&((r=n.temperatures)instanceof N.data.ObservableArray&&(r=r.toJSON()),c.temperatures=c.temperatures.concat(r)),n.modes&&((r=n.modes)instanceof N.data.ObservableArray&&(r=r.toJSON()),c.modes=c.modes.concat(r)),n.configuration&&(c.configuration=n.configuration),-1!=a.dms_devices_type.indexOf("AO")&&n.controlPoint&&(c.aoControlPoint=n.controlPoint),-1!=a.dms_devices_type.indexOf("DO")&&n.controlPoint&&(c.doControlPoint=n.controlPoint),n.lights&&(c.lights=n.lights));if(c){var u=c.modes,v=c.temperatures,m=c.configuration,h=c.aoControlPoint,f=c.doControlPoint,g=c.lights;o=c.operations;var _,C,E=0,T=!1,D="";if(u&&0<u.length&&(E+=u.length,T||(_=u[0].id,C=u[0].mode,-1!=_.indexOf("Ventilator")?D="("+S.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=_.indexOf("DHW")&&(D="("+S.prop("FACILITY_DEVICE_TYPE_DHW")+")"),d=(_=L.getDetailDisplayTypeDeviceI18N(_)+D+" "+S.prop("FACILITY_DEVICE_SAC_INDOOR_MODE"))+" : "+(C=S.prop("FACILITY_INDOOR_MODE_"+C.toUpperCase())),T=!0)),D="",o&&0<o.length&&(E+=o.length,T||(_=o[0].id,C=o[0].power,d=(_=(_="General"==_?L.getDetailDisplayTypeDeviceI18N("Light"):(-1!=_.indexOf("Ventilator")?D="("+S.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=_.indexOf("DHW")&&(D="("+S.prop("FACILITY_DEVICE_TYPE_DHW")+")"),L.getDetailDisplayTypeDeviceI18N(_)))+D+" "+S.prop("FACILITY_INDOOR_CONTROL_POWER"))+" : "+(C=S.prop("FACILITY_DEVICE_STATUS_"+C.toUpperCase())),T=!0)),D="",v&&0<v.length&&(E+=v.length,T||(_=v[0].id,C=v[0].desired,-1!=_.indexOf("Room")?D="("+S.prop("FACILITY_INDOOR_SET_TEMPERATURE")+")":-1!=_.indexOf("DHW")?D="("+S.prop("FACILITY_INDOOR_DHW_SET_TEMPERATURE")+")":-1!=_.indexOf("WaterOutlet")&&(D="("+S.prop("FACILITY_INDOOR_WATER_OUT_SET_TEMP")+")"),d=(_=L.getDetailDisplayTypeDeviceI18N(_)+D)+":"+C+L.CHAR.Celsius,T=!0)),m&&m.remoteControl&&(E+=1,!T)){var O="Allowed"===m.remoteControl?S.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_PERMIT"):S.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_PROHIBIT");d=S.prop("FACILITY_INDOOR_REMOTE_CONTROL")+" : "+O}g&&0<g.length&&(E+=g.length,T||(d=S.prop("FACILITY_DEVICE_TYPE_LIGHT")+" "+S.prop("LIGHT_BRIGHTNESS")+" : "+g[0].dimmingLevel));var I=h;if(I&&void 0!==I.value&&(E+=1,T||(d="AO "+S.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+" : "+I.value)),(I=f)&&void 0!==I.value&&(E+=1,T||(d="DO "+S.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+" : "+I.value)),void 0!==p){var A,w=p.mode,b=x.getTemperature().unit;C="PreCooling"==w?p.preCoolingTemperature:p.preHeatingTemperature,A="PreCooling"==w?"PRECOOLING":"PREHEATING",E+=1,T||(C=L.convertNumberFormat(Number(C).toFixed(1)),d=S.prop("FACILITY_INDOOR_"+A)+" : "+C+L.CHAR[b],T=!0)}0<E&&--E,0<E&&(d+=" (+"+E+")")}return s=s+d+"</span>"}}var N=window.kendo,L=window.Util,S=window.I18N,x=window.GlobalSettings,p=[{className:"indoor",displayText:S.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR")},{className:"light",displayText:S.prop("FACILITY_DEVICE_TYPE_LIGHT")},{className:"indoorlight",displayText:S.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR")+" + "+S.prop("FACILITY_DEVICE_TYPE_LIGHT")},{className:"others",displayText:S.prop("FACILITY_DEVICE_OTHERS")},{className:"pause",displayText:S.prop("COMMON_PAUSE")}];return{detailPopupGroupListTemplate:function(e){var t=e.dms_devices_name,i=e.dms_devices_id,o=void 0===e.location||null===e.location?"":e.location,a=o.split(", "),n=a.length<=2?o:a[0]+", "+a[1],r=a.length<3?"":a[2];return'<div class="device-detail-popup-group-list-item">'+("<div class='detail-text'><div class='name-and-id'><div class='name'>"+L.decodeHtml(t)+"</div><div class='id'>"+i+"</div></div><div class='location-wrapper'><div class='location-building'>"+n+"</div><div class='location-zone'>"+r+"</div></div></div>")+"</div>"},scheduleDetailListTemplate:function(e){return n(e)+i(e)},scheduleDetailNameTemplate:n,operationListTemplate:r,scheduleActivatedTemplate:t,scheduleUpdatedDateTemplate:function(e){var t=e.updated.date;return(0,window.moment)(t).format("YYYY-MM-DD")},moreOperationListTemplate:function(e){return r(e)+i(e)},executionTimeListTemplate:function(e){if("scheduleDay"!==e.field){var t,i="-",o=e.executionTimes,a=o.length;return 0<a&&(i=t=(t=(t=o[0]).split(":"))[0]+":"+t[1],1<a&&(i+=" (+"+(a-1)+")")),e.times=i}},getEventTemplateClass:a,checkboxCellTemplate:function(e){var t=a(e),i=e.uid;return'<div class="schedule-checkbox-cell '+t+'"><span class="checkbox-wrapper"><input type="checkbox" id="check_'+i+'" class="k-checkbox" '+(e.checked?"checked":"")+'/><label for="check_'+i+'" class="k-checkbox-label"></label></span></div>'},radioCellTemplate:function(e){var t=a(e),i=e.uid;return'<div class="schedule-checkbox-cell '+t+'"><span class="checkbox-wrapper"><input type="radio" id="check_'+i+'" class="k-radio" '+(e.checked?"checked":"")+'/><label for="check_'+i+'" class="k-radio-label"></label></span></div>'},getEventTemplateType:o,daysOfWeekTemplate:function(e){if("folder.groupName"!==e.field){var i={Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6},t="-",o=e.configurations,a=o[0].daysOfWeek;if(a&&0<a.length){var n=$.extend(!0,[],a);n.sort(function(e,t){return i[e]-i[t]});var r,d=n.length;for(r=0;r<d;r++)n[r]=S.prop("FACILITY_SCHEDULE_"+n[r].toUpperCase());t=n.join(", ")}var s=o.length;return 0<s-1&&(t+=" (+"+(s-1)+")"),t}},configuOperationListTemplate:function(e,t){var i,o,a,n,r,d,s,l,c="",p="<span>",u=e.configurations,v=0,m=!1;if("folder.groupName"!==e.field){if(!u)return p+="-</span>";for(var h={},f=0;f<u.length;f++){for(n=u[f].deviceTypes,l=u[f].algorithm,h={operations:[],temperatures:[],modes:[],configuration:{},aoControlPoint:{},doControlPoint:{},lights:[]},void 0===n&&(n=[]),o=n.length,i=0;i<o;i++)(d=(r=n[i]).control)&&(d.operations&&((s=d.operations)instanceof N.data.ObservableArray&&(s=s.toJSON()),h.operations=h.operations.concat(s)),d.temperatures&&((s=d.temperatures)instanceof N.data.ObservableArray&&(s=s.toJSON()),h.temperatures=h.temperatures.concat(s)),d.modes&&((s=d.modes)instanceof N.data.ObservableArray&&(s=s.toJSON()),h.modes=h.modes.concat(s)),d.configuration&&(h.configuration=d.configuration),-1!=r.dms_devices_type.indexOf("AO")&&d.controlPoint&&(h.aoControlPoint=d.controlPoint),-1!=r.dms_devices_type.indexOf("DO")&&d.controlPoint&&(h.doControlPoint=d.controlPoint),d.lights&&(h.lights=d.lights));if(h){var g=h.modes,_=h.temperatures,C=h.configuration,E=h.aoControlPoint,T=h.doControlPoint,D=h.lights;a=h.operations;var O,I,A="";if(g&&0<g.length&&(v+=g.length,m||(O=g[0].id,I=g[0].mode,-1!=O.indexOf("Ventilator")?A="("+S.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=O.indexOf("DHW")&&(A="("+S.prop("FACILITY_DEVICE_TYPE_DHW")+")"),c=(O=L.getDetailDisplayTypeDeviceI18N(O)+A+" "+S.prop("FACILITY_DEVICE_SAC_INDOOR_MODE"))+" : "+(I=S.prop("FACILITY_INDOOR_MODE_"+I.toUpperCase())),m=!0)),A="",a&&0<a.length&&(v+=a.length,m||(O=a[0].id,I=a[0].power,c=(O=(O="General"==O?L.getDetailDisplayTypeDeviceI18N("Light"):(-1!=O.indexOf("Ventilator")?A="("+S.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=O.indexOf("DHW")&&(A="("+S.prop("FACILITY_DEVICE_TYPE_DHW")+")"),L.getDetailDisplayTypeDeviceI18N(O)))+A+" "+S.prop("FACILITY_INDOOR_CONTROL_POWER"))+" : "+(I=S.prop("FACILITY_DEVICE_STATUS_"+I.toUpperCase())),m=!0)),A="",_&&0<_.length&&(v+=_.length,m||(O=_[0].id,I=_[0].desired,-1!=O.indexOf("Room")?A="("+S.prop("FACILITY_INDOOR_SET_TEMPERATURE")+")":-1!=O.indexOf("DHW")?A="("+S.prop("FACILITY_INDOOR_DHW_SET_TEMPERATURE")+")":-1!=O.indexOf("WaterOutlet")&&(A="("+S.prop("FACILITY_INDOOR_WATER_OUT_SET_TEMP")+")"),c=(O=L.getDetailDisplayTypeDeviceI18N(O)+A)+":"+I+L.CHAR.Celsius,m=!0)),C&&C.remoteControl&&(v+=1,!m)){var w="Allowed"===C.remoteControl?S.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_PERMIT"):S.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_PROHIBIT");c=S.prop("FACILITY_INDOOR_REMOTE_CONTROL")+" : "+w,m=!0}D&&0<D.length&&(v+=D.length,m||(c=S.prop("FACILITY_DEVICE_TYPE_LIGHT")+" "+S.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS")+" : "+D[0].dimmingLevel,m=!0));var b=E;if(b&&void 0!==b.value&&(v+=1,m||(c="AO "+S.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+" : "+b.value,m=!0)),(b=T)&&void 0!==b.value&&(v+=1,m||(c="DO "+S.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+" : "+b.value,m=!0)),void 0!==l){var k=l.mode,y=x.getTemperature().unit;k="PreCooling"==k?(I=l.preCoolingTemperature,"PRECOOLING"):(I=l.preHeatingTemperature,"PREHEATING"),v+=1,m||(I=L.convertNumberFormat(Number(I).toFixed(1)),c=S.prop("FACILITY_INDOOR_"+k)+" : "+I+L.CHAR[y],m=!0)}}}return 0<v&&--v,0<v&&(c+=" (+"+v+")"),t?c:p=p+c+"</span>"}},configuExecutionTimeListTemplate:function(e){if("folder.groupName"!==e.field){var t,i="-",o=e.configurations[0].executionTimes,a=o.length;return 0<a&&(i=t=(t=(t=o[0]).split(":"))[0]+":"+t[1],1<a&&(i+=" (+"+(a-1)+")")),e.times=i}},scheduleLoadDetailNameTemplate:function(e){e.name=e.name||e.title,e.title=e.name;var t=e.name;return"<span class='grid-cell-two-line-ellipsis'>"+L.decodeHtml(t)+"</span>"}}}),define("operation/schedule/config/popup-config",["device/common/device-util","device/common/device-template","operation/schedule/config/schedule-template","operation/schedule/model"],function(e,t,M,a){var i,F=window.kendo,R=window.I18N,P=window.GlobalSettings,H=window.Util,n=window.moment,o=$("#device-detail-popup"),r=$("#except-detail-popup"),d=$("#schedule-detail-popup"),s=$("#schedule-more-popup"),l=$("#schedule-exceptional-more-popup"),c=$("#schedule-load-popup"),p=$("#folder-select-popup"),u=[{controlledTime:"2016-08-27 16:30",location:{building:"A Building",floor:"30F",zone:"Meeting Room A"},devices:{Indoor:[{icon:"",deviceId:"Device01",deviceName:"Device01"},{icon:"",deviceId:"Device02",deviceName:"DeviceName02"}]},group:["Group A","Group B"],controlBy:"Quaduron",controlType:"Manual control",operation:"\u2022 SAC Indoor : On - Cool (18 \xb0C)"},{controlledTime:"2016-08-27 16:30",location:{building:"A Building",floor:"30F",zone:"Meeting Room A"},devices:{Indoor:[{icon:"",deviceId:"Device01",deviceName:"Device01"},{icon:"",deviceId:"Device02",deviceName:"DeviceName02"}]},group:["Group A","Group B"],controlBy:"Quaduron",controlType:"Manual control",operation:"\u2022 SAC Indoor : On - Cool (18 \xb0C)"}],v=$("#popup-history").kendoPopupSingleWindow({title:"History",width:"1296px"});v.closest(".popup-window").addClass("popup-device-history");var m=$(".popup-device-history .device-history-grid").kendoGrid({dataSource:[],scrollable:!0,sortable:!0,height:"100%",columns:[{field:"controlledTime",title:"Controlled Time"},{field:"location",title:"Location",sortable:!1,template:"#: location.building #, #: location.floor #, #: location.zone #"},{field:"devices",title:"Devices",sortable:!1,template:"Indoor #: devices.Indoor.length #"},{field:"controlBy",title:"Control By",sortable:!1},{field:"controlType",title:"Control Type",sortable:!1},{field:"operation",title:"Operation",sortable:!1}]}),h=new Date,f=new Date(h.getFullYear(),h.getMonth(),1),g=f,_=h;v.find(".toolbar").find(".item.start").find("input[data-role=startDate]").val(w(g)),v.find(".toolbar").find(".item.end").find("input[data-role=endDate]").val(w(_));var C=v.find("li.start .device-history-calendar").kendoPopupSingleWindow({title:"Date Picker",width:"365px",height:"460px",modal:!1,resizable:!1,scrollable:!1,visible:!1,draggable:!1});C.find(".calendar").kendoCalendar({value:f,footer:!1,change:function(){b(this.value(),"start")}}),C.closest(".popup-window").addClass("dateStart");var E=v.find("li.end .device-history-calendar").kendoPopupSingleWindow({title:"Date Picker",width:"365px",height:"460px",modal:!1,resizable:!1,scrollable:!1,visible:!1,draggable:!1});E.find(".calendar").kendoCalendar({value:h,footer:!1,change:function(){b(this.value(),"end")}}),E.closest(".popup-window").addClass("dateEnd");var T=$("#popup-timepicker-start").kendoPopupSingleWindow({title:"Time Picker",width:"500px",height:"320px",modal:!1,resizable:!1,scrollable:!1,visible:!1,draggable:!1}),D=$("#popup-history").find(".toolbar-content.date").find(".item.start").find("[data-role=startTime]");D.val("00:00");var O=$("#popup-timepicker-end").kendoPopupSingleWindow({title:"Time Picker",width:"500px",height:"320px",modal:!1,resizable:!1,scrollable:!1,visible:!1,draggable:!1}),I=$("#popup-history").find(".toolbar-content.date").find(".item.end").find("[data-role=endTime]");function A(e,t){for(var i,o=e.find(".timepicker"),a=e.find(".popup-footer").find("button[data-event=ok]"),n=e.find(".popup-footer").find("button[data-event=cancel]"),r="00",d="00",s=[],l=0;l<60;l++){var c;c=l<10?"0"+l:""+l,s.push(c)}o.find("input.hour").kendoDropDownList({dataSource:["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],change:function(){r=this.value()}}),o.find("input.minute").kendoDropDownList({dataSource:s,change:function(){d=this.value()}}),e.css({backgroundColor:"#f7f7f7"}),e.find(".popup-header").css({borderBottom:0}),e.find(".popup-container").css({height:"200px"}),o.css({textAlign:"center",marginTop:"80px"}),o.find(".k-dropdown").css({width:"150px"}),o.find(".k-dropdown-wrap").css({top:"-7px",left:"-11px",width:"109px"}),o.find(".k-icon").css({top:"16px",right:"5px"}),a.on("click",function(){i=r+":"+d,t.val(i),e.data("kendoPopupSingleWindow").close()}),n.on("click",function(){e.data("kendoPopupSingleWindow").close()})}function w(e){return n(e).format("L").replace(/\./g,"-")}function b(e,t){"start"===t?g=e:"end"===t&&(_=e)}I.val("00:00"),A(T,D),A(O,I),v.kendoPopupSingleWindow("addEventToFactory","#popup-history .item.start [data-event=calendar]","singleDeviceHistoryCalendarStartOpen",function(e){var t=$(".popup-window.dateStart").find(".device-history-calendar");t.kendoPopupSingleWindow("openWindowPopup"),t.closest(".popup-window").css({top:"212px",left:"759px"})}),v.kendoPopupSingleWindow("addEventToFactory","#popup-history .item.end [data-event=calendar]","singleDeviceHistoryCalendarEndOpen",function(e){var t=$(".popup-window.dateEnd").find(".device-history-calendar");t.kendoPopupSingleWindow("openWindowPopup"),t.closest(".popup-window").css({top:"212px",left:"1188px"})}),v.kendoPopupSingleWindow("addEventToFactory",".device-history-calendar .popup-footer [data-event=ok]","singleDeviceHistoryCalendarOk",function(e){var t=$(e.target).closest(".popup-window"),i=v.find(".toolbar"),o=(_.getTime()-g.getTime())/864e5,a=new Date;365<o&&(g=new Date(_.getFullYear(),_.getMonth(),_.getDate())).setYear(_.getFullYear()-1),0<_-a&&(_=new Date),_<g&&(g=new Date(a.getFullYear(),a.getMonth(),1)),i.find(".item.start").find("input[data-role=startDate]").val(w(g)),i.find(".item.end").find("input[data-role=endDate]").val(w(_)),t.hasClass("dateStart")?$(".popup-window.dateStart .device-history-calendar").data("kendoPopupSingleWindow").close():t.hasClass("dateEnd")&&$(".popup-window.dateEnd .device-history-calendar").data("kendoPopupSingleWindow").close()}),v.kendoPopupSingleWindow("addEventToFactory","#popup-history .item.start [data-event=timepicker]","singleDeviceHistoryTimePickerStartOpen",function(e){T.kendoPopupSingleWindow("openWindowPopup"),T.closest(".popup-window").css({top:"212px",left:"890px"})}),v.kendoPopupSingleWindow("addEventToFactory","#popup-history .item.end [data-event=timepicker]","singleDeviceHistoryTimePickerEndOpen",function(e){O.kendoPopupSingleWindow("openWindowPopup"),O.closest(".popup-window").css({top:"212px",left:"1320px"})});function k(e){var t;t=this.dataSource.get(this.contentViewModel.id),this.trigger("onDelete",{result:t})}function y(e){var t;t=this.dataSource.get(this.contentViewModel.id),this.trigger("onEdit",{result:t})}var N={height:"100%",scrollable:!0,sortable:!1,filterable:!1,pageable:!1},L={id:"id",groupName:{updated:{template:"<div class='group blue'>"+R.prop("COMMON_LAST_UPDATE")+"</div>"},created:{template:"<div class='group blue'>"+R.prop("FACILITY_SCHEDULE_CREATE_CREATION_TITLE")+"</div>"},device:{template:"<div class='group'>"+R.prop("FACILITY_SCHEDULE_DEVICE")+"</div>"},period:{template:"<div class='group'>"+R.prop("FACILITY_SCHEDULE_PERIOD")+"</div>"},timeAndOperation:{template:"<div class='group'>"+R.prop("FACILITY_SCHEDULE_TIME_AND_OPERATION_SETTINGS")+"</div>"},time:{template:"<div class='group blue'>"+R.prop("COMMON_TIME")+"</div>"},operation:{template:"<div class='group blue'>"+R.prop("FACILITY_SCHEDULE_CREATE_OPERATION_TITLE")+"</div>"},exceptionDay:{template:"<div class='group'>"+R.prop("FACILITY_SCHEDULE_EXCEPTION_DAY")+"</div>"},description:{template:"<div class='group'>"+R.prop("FACILITY_SCHEDULE_DESCRIPTION")+"</div>"}},fields:{updatedDate:{groupName:"updated",type:"text",name:R.prop("COMMON_DATE"),template:function(e){var t="-";return e.updated&&e.updated.date&&(t=n(e.updated.date).format("LLL").replace(/\./g,"-")),t}},updatedUser:{groupName:"updated",type:"text",name:R.prop("COMMON_MANAGER"),template:function(e){var t="-";return e.updated&&e.updated.ums_users_name&&(t=e.updated.ums_users_name),H.decodeHtml(t)}},createdDate:{groupName:"created",type:"text",name:R.prop("COMMON_DATE"),template:function(e){var t="-";return e.created&&e.created.date&&(t=n(e.created.date).format("LLL").replace(/\./g,"-")),t}},createdUser:{groupName:"created",type:"text",name:R.prop("COMMON_MANAGER"),template:function(e){var t="-";return e.created&&e.created.ums_users_name&&(t=e.created.ums_users_name),H.decodeHtml(t)}},devices:{groupName:"device",type:"grid",name:R.prop("FACILITY_DEVICE_DEVICE"),gridDataSource:function(e){var t=e.devices;if(t){var i,o,a,n=t.length;for(i=0;i<n;i++)a="ControlPoint"!=t[i].dms_devices_mappedType?(o=t[i].dms_devices_mappedType||t[i].dms_devices_type,!0):(o=t[i].dms_devices_type,!1),t[i].displayType=H.getDetailDisplayType(o,a)}return t},gridOptions:$.extend({},N,{hideHeader:!0,columns:[{template:M.detailPopupGroupListTemplate,field:"displayType",groupHeaderTemplate:function(e){var t=e.value,i="<span class='detail-img reg selected "+H.getDisplayClassType(t)+"'></span>",o="-";return t&&(o=H.getDetailDisplayTypeDeviceI18N(t)),e.count&&(o+=" ("+e.count+")"),i+o}}],group:[{field:"displayType",aggregates:[{field:"displayType",aggregate:"count"}]}],dataBound:function(e){var t,i=this.element.find("tr"),o=i.length;for(t=1;t<o;t++)if(this.collapseRow(i[t]),t==o-1)i[t].classList.add("last-child");else{if(!i[t].nextSibling.classList.contains("k-grouping-row"))continue;i[t].classList.add("last-child")}for(t=0;t<o;t++)i[t].classList.contains("k-grouping-row")&&$(i[t]).on("click",function(e){void 0!==e.target&&null!==e.target&&(e.target.classList.contains("k-i-expand")||e.target.classList.contains("k-i-collapse"))||void 0!==e.currentTarget&&null!==e.currentTarget&&(0<$(e.currentTarget).find("a.k-i-expand").length?$(e.currentTarget).find("a.k-i-expand").trigger("click"):$(e.currentTarget).find("a.k-i-collapse").trigger("click"))})}})},period:{groupName:"period",type:"text",name:"period",template:function(e){var t="-",i="-",o=e.startDate||e.start;o&&(t=n(o).format("L").replace(/\./g,"-")),(o=e.endDate||e.end)&&(i=n(o).year()==a.MAX_END_DATE_YEAR?R.prop("FACILITY_SCHEDULE_ENDLESS"):n(o).format("L").replace(/\./g,"-"));return t+" ~ "+i}},timeAndOperation:{groupName:"timeAndOperation",type:"text",name:"timeAndOperation",template:function(){return""}},time:{groupName:"time",name:R.prop("COMMON_TIME"),type:F.ui.GridStyleDropDownList,widgetOptions:{index:0,valuePrimitive:!0,dataTextField:"text",dataValueField:"value"},widgetDataSource:function(e){if(e.configurations){for(var t=e.configurations,i=[],o=0;o<t.length;o++){var a,n,r,d,s=t[o].executionTimes,l=s.length;for(a=0;a<l;a++)d=(n=(n=(n=s[a]).split(":"))[0]+":"+n[1])+" / "+M.configuOperationListTemplate({configurations:[t[o]]},!0)+" / "+M.daysOfWeekTemplate({configurations:[t[o]]}),r=F.guid()+"-time-"+o,i.push({value:r,text:d})}return i=i.sort(function(e,t){return e.text.localeCompare(t.text)})}},widgetDisplaySetter:function(e){var t=e.widget,i=e.sender;t.bind("onChange",function(e){var t=e.event.sender.value();i.dataSource.at(0).selectedTime=t.substr(t.lastIndexOf("-time-")+6),i.updateDisplayField&&i.updateDisplayField("operation")}),$(t.element.find("#grid-style-dropdownlist")).data("kendoDropDownList")._triggerChange()}},operation:{groupName:"operation",type:"text",name:R.prop("FACILITY_SCHEDULE_CREATE_OPERATION_TITLE"),template:function(e){var t,i,o,a,n,r,d,s,l,c,p,u,v=P.getTemperature().unit,m="-";if(!(h=e.configurations))return m;if(void 0===e.selectedTime||""===e.selectedTime){if(!e.configurations)return;for(var h=e.configurations,f=[],g=0;g<h.length;g++){var _,C,E,T,D=h[g].executionTimes,O=D.length;for(_=0;_<O;_++)T=(C=(C=(C=D[_]).split(":"))[0]+":"+C[1])+" / "+M.configuOperationListTemplate({configurations:[h[g]]},!0)+" / "+M.daysOfWeekTemplate({configurations:[h[g]]}),E=F.guid()+"-time-"+g,f.push({value:E,text:T})}u=(f=f.sort(function(e,t){return e.text.localeCompare(t.text)}))[0].value.substr(f[0].value.lastIndexOf("-time-")+6)}for(var I=e.selectedTime||u,A=0,w=h.length;A<w;A++)h[A].selected=!1;h[I].set("selected",!0),s=h[I].deviceTypes,d=h[I].algorithm;var b={operations:[],temperatures:[],modes:[],configuration:{},aoControlPoint:{},doControlPoint:{},lights:[]};for(void 0===s&&(s=[]),O=s.length,_=0;_<O;_++)(c=(l=s[_]).control)&&(c.operations&&((p=c.operations)instanceof F.data.ObservableArray&&(p=p.toJSON()),b.operations=b.operations.concat(p)),c.temperatures&&((p=c.temperatures)instanceof F.data.ObservableArray&&(p=p.toJSON()),b.temperatures=b.temperatures.concat(p)),c.modes&&((p=c.modes)instanceof F.data.ObservableArray&&(p=p.toJSON()),b.modes=b.modes.concat(p)),c.configuration&&(b.configuration=c.configuration),-1!=l.dms_devices_type.indexOf("AO")&&c.controlPoint&&(b.aoControlPoint=c.controlPoint),-1!=l.dms_devices_type.indexOf("DO")&&c.controlPoint&&(b.doControlPoint=c.controlPoint),c.lights&&(b.lights=c.lights));if(b){var k,y,N,L,S;if(m="",t=b.modes)for(O=t.length,S="",_=0;_<O;_++)k=t[_].id,y=t[_].mode,-1!=k.indexOf("Ventilator")?S="("+R.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=k.indexOf("DHW")&&(S="("+R.prop("FACILITY_DEVICE_TYPE_DHW")+")"),m+='<div class="popup-text-wrapper"><div class="tb"><div class="tbc"><span>'+(k=H.getDetailDisplayTypeDeviceI18N(k)+S+" "+R.prop("FACILITY_DEVICE_SAC_INDOOR_MODE"))+'</span> :&nbsp;</div><div class="tbc">'+(y=R.prop("FACILITY_INDOOR_MODE_"+y.toUpperCase()))+"</div></div></div>";if(i=b.operations)for(O=i.length,S="",_=0;_<O;_++)k=i[_].id,N=i[_].power,m+='<div class="popup-text-wrapper"><div class="tb"><div class="tbc"><span>'+(k=(k="General"==k?H.getDetailDisplayTypeDeviceI18N("Light"):(-1!=k.indexOf("Ventilator")?S="("+R.prop("FACILITY_DEVICE_TYPE_VENTILATOR")+")":-1!=k.indexOf("DHW")&&(S="("+R.prop("FACILITY_DEVICE_TYPE_DHW")+")"),H.getDetailDisplayTypeDeviceI18N(k)))+S+" "+R.prop("FACILITY_INDOOR_CONTROL_POWER"))+'</span> :&nbsp;</div><div class="tbc">'+(N=R.prop("FACILITY_DEVICE_STATUS_"+N.toUpperCase()))+"</div></div></div>";if(r=b.lights)for(O=r.length,_=0;_<O;_++)E=r[_].dimmingLevel,m+='<div class="popup-text-wrapper"><div class="tb"><div class="tbc"><span>'+R.prop("FACILITY_DEVICE_TYPE_LIGHT")+" "+R.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS")+'</span> :&nbsp;</div><div class="tbc">'+E+"</div></div></div>";if(o=b.temperatures)for(O=o.length,S="",_=0;_<O;_++)-1!=(k=o[_].id).indexOf("Room")?S="("+R.prop("FACILITY_INDOOR_SET_TEMPERATURE")+")":-1!=k.indexOf("DHW")?S="("+R.prop("FACILITY_INDOOR_DHW_SET_TEMPERATURE")+")":-1!=k.indexOf("WaterOutlet")&&(S="("+R.prop("FACILITY_INDOOR_WATER_OUT_SET_TEMP")+")"),L=o[_].desired,m+='<div class="popup-text-wrapper"><div class="tb"><div class="tbc"><span>'+(k=H.getDetailDisplayTypeDeviceI18N(k)+S)+'</span> :&nbsp;</div><div class="tbc">'+L+"<span>"+H.CHAR[v]+"</span></div></div></div>";if((a=b.configuration)&&a.remoteControl){var x=a.remoteControl;x="Allowed"==x?R.prop("FACILITY_INDOOR_REMOTE_CONTROL_ENABLE"):R.prop("FACILITY_INDOOR_REMOTE_CONTROL_DISABLE"),m+='<div class="popup-text-wrapper"><div class="tb"><div class="tbc"><span>'+R.prop("FACILITY_INDOOR_REMOTE_CONTROL")+'</span> :&nbsp;</div><div class="tbc">'+x+"</div></div></div>"}(n=b.aoControlPoint)&&void 0!==n.value&&null!==n.value&&(m+='<div class="popup-text-wrapper"><div class="tb"><div class="tbc"><span>AO '+R.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+'</span> :&nbsp;</div><div class="tbc">'+n.value+"</div></div></div>"),(n=b.doControlPoint)&&void 0!==n.value&&null!==n.value&&(m+='<div class="popup-text-wrapper"><div class="tb"><div class="tbc"><span>DO '+R.prop("FACILITY_HISTORY_OPERATION_CONTROLPOINT_VALUE")+'</span> :&nbsp;</div><div class="tbc">'+n.value+"</div></div></div>"),d&&(y="PreCooling"==(y=d.mode)?(E=d.preCoolingTemperature,"PRECOOLING"):(E=d.preHeatingTemperature,"PREHEATING"),m+='<div class="popup-text-wrapper"><div class="tb"><div class="tbc"><span>'+R.prop("FACILITY_INDOOR_"+y)+'</span> :&nbsp;</div><div class="tbc">'+E+"<span>"+H.CHAR[v]+"</span></div></div></div>")}return m}},exceptionDay:{groupName:"exceptionDay",type:"grid",name:R.prop("FACILITY_SCHEDULE_EXCEPTION_DAY"),gridDataSource:function(e){return e.exceptionalDays},gridOptions:$.extend({},N,{hideHeader:!1,columns:[{field:"name",width:224,title:R.prop("COMMON_NAME"),template:function(e){return void 0!==e.name?e.name:"-"}},{field:"preiod",width:124,title:R.prop("FACILITY_SCHEDULE_PERIOD"),template:function(e){var t="-",i="-";return e.startDate&&(t=n(e.startDate).format("L").replace(/\./g,"-")),e.endDate&&(i=n(e.endDate).format("L").replace(/\./g,"-")),"-"==t&&"-"==i?"-":t===i?i:t+" ~<br>"+i}},{field:"description",width:300,title:R.prop("FACILITY_SCHEDULE_DESCRIPTION"),template:function(e){return void 0!==e.description?e.description:"-"}}],noRecords:{template:"<div class='no-records-text'>"+R.prop("FACILITY_SCHEDULE_NO_EXCEPTION_DAY")+"</div>"}})},description:{groupName:"description",type:"text",name:R.prop("COMMON_DESCRIPTION"),template:function(e){var t=e.description?e.description:"-";return H.decodeHtml(t)}}}},S={id:"id",fields:{title:{type:"text",name:R.prop("FACILITY_SCHEDULE_EXCEPTIONAL_DAY_NAME"),editable:!0,template:M.scheduleDetailNameTemplate,validator:{type:"name",required:!0},hasInputRemoveBtn:!0,editCss:{width:"100%"}},date:{type:"text",name:R.prop("COMMON_DATE"),editable:!0,editTemplate:'<input data-role="commondatepicker" data-is-start="true" data-bind="value: fields.start, events:{ open: getOldStartDate, change : changeStartTime }" data-format="yyyy-MM-dd" title="datepicker" style="width: 46.5%;"/><span style="display:inline-block;width:7%;text-align:center;"><span>-</span></span><input data-role="commondatepicker" data-is-end="true" data-bind="value:fields.end, events:{ open: getOldEndDate, change : changeEndTime }" data-format="yyyy-MM-dd" title="datepicker" style="width: 46.5%;"/>',editViewModel:{fields:{start:null,end:null,oldStartDate:null,oldEndDate:null},init:function(e){this.fields.start||(this.fields.start=new Date),this.fields.end||(this.fields.end=new Date)},getOldStartDate:function(e){var t=this.get("fields.start");this.set("fields.oldStartDate",t)},getOldEndDate:function(e){var t=this.get("fields.end");this.set("fields.oldEndDate",t)},changeStartTime:function(e){var t,i=this.get("fields.start"),o=this.get("fields.end"),a=new Date;i<a&&this.set("fields.start",a),t=this.get("fields.start"),t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0),this.set("fields.start",t),(o<i||o<i)&&(t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59),this.set("fields.end",t));var n=$(e.sender.element).closest(".k-content").data("kendoDetailDialog");n&&n.enableSaveBtn()},changeEndTime:function(e){var t,i=this.get("fields.start"),o=this.get("fields.end");t=o<i||o<i?i:this.get("fields.end"),t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59),this.set("fields.end",t);var a=$(e.sender.element).closest(".k-content").data("kendoDetailDialog");a&&a.enableSaveBtn()}},template:function(e){e.fields={},e.start=e.start||e.startDate,e.end=e.end||e.endDate;var t=e.startDate||e.start,i=e.endDate||e.end;return e.fields||(e.fields.start=t,e.fields.end=i),(t=n(t).format("L").replace(/\./g,"-"))+" ~ "+(i=n(i).format("L").replace(/\./g,"-"))}},description:{type:"text",name:R.prop("COMMON_DESCRIPTION"),validator:{type:"description"},editCss:{width:"100%"},hasInputRemoveBtn:!0,editable:!0}}},x={title:R.prop("COMMON_BTN_DETAIL"),initialCollapse:!1,width:822,height:830,buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2},contentViewModel:{detailType:R.prop("COMMON_GENERAL"),deleteSchedule:k,editSchedule:y},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General<span></div><div class="detail-dialog-detail-content-field-list"></div><div class="schedule-action-box"><button class="k-button delete" data-bind="click: deleteSchedule">'+R.prop("COMMON_BTN_DELETE")+'</button><button class="k-button edit" data-bind="click: editSchedule">'+R.prop("COMMON_BTN_EDIT")+"</button></div>",listTemplate:M.scheduleDetailListTemplate,headerTemplate:"<span><span>#:count#</span>"+R.prop("FACILITY_SCHEDULE_SELECTED_SCHEDULE")+"</span>",isCustomActions:!0,actions:[{text:R.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}},{text:R.prop("COMMON_BTN_DELETE"),visible:!0,action:function(e){var t,i;return t=e.sender.getSelectedData(),1<e.sender.dataSource.total()&&(i=e.sender.dataSource.data()),e.sender.trigger("onDelete",{result:t,results:i}),!1}},{text:R.prop("COMMON_BTN_EDIT"),visible:!0,action:function(e){var t,i;return t=e.sender.getSelectedData(),1<e.sender.dataSource.total()&&(i=e.sender.dataSource.data()),e.sender.trigger("onEdit",{result:t,results:i}),!1}}],onTypeChange:function(e){var t=e.type,i=e.sender.BTN,o=e.sender;o.setActions(i.CLOSE,{disabled:!1}),"single"==t?(o.setActions(i.EDIT,{visible:!0}),o.setActions(i.DELETE,{visible:!0})):"multi"==t&&(o.setActions(i.EDIT,{visible:!1}),o.setActions(i.DELETE,{visible:!1}))},scheme:L},Y={title:R.prop("FACILITY_SCHEDULE_LOAD_SCHEDULE"),width:822,height:830,isOnlyMulti:!0,initialCollapse:!1,gridOptions:{columns:[{field:"checked",template:M.radioCellTemplate,width:45,sortable:!1},{field:"title",title:R.prop("FACILITY_SCHEDULE_SCHEDULE_NAME"),sortable:{compare:function(e,t,i){return e.title.localeCompare(t.title,"en",{numeric:!0})}},width:194,template:M.scheduleLoadDetailNameTemplate},{field:"updated.date",title:R.prop("FACILITY_SCHEDULE_LAST_UPDATE"),sortable:!0,width:134,template:M.scheduleUpdatedDateTemplate,attributes:{class:"td-text-center"}},{field:"operations",title:R.prop("FACILITY_SCHEDULE_CREATE_OPERATION_TITLE"),width:164,template:M.configuOperationListTemplate,sortable:!1},{field:"status",title:R.prop("COMMON_STATUS"),width:100,template:M.scheduleActivatedTemplate,sortable:!1}],sortable:!0,hasRadioModel:!0},buttonsIndex:{CANCEL:0,SELECT:1},onTypeChange:function(e){var t=e.sender.BTN;e.sender.setActions(t.CANCEL,{disabled:!1}),e.sender.setActions(t.SELECT,{disabled:!0})},contentViewModel:{detailType:R.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',headerTemplate:"<span>"+R.prop("COMMON_TOTAL")+": <span>#=count#</span></span>",isCustomActions:!0,actions:[{text:R.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}},{text:R.prop("COMMON_BTN_LOAD"),visible:!0,disabled:!0,action:function(e){var t,i;return 0<(i=e.sender.grid.getCheckedData()).length&&(t=i[0],e.sender.trigger("onSelect",{result:t,results:i})),!1}}],scheme:L},U={title:R.prop("FACILITY_SCHEDULE_CREATE_SELECT_FOLDER"),width:404,height:468,isOnlyMulti:!0,initialCollapse:!1,gridOptions:{showGridHeader:!1,columns:[{field:"checked",template:M.radioCellTemplate,width:37,sortable:!1},{field:"name",sortable:!1}],sortable:!0,hasRadioModel:!0},buttonsIndex:{CLOSE:0,SAVE:1},onTypeChange:function(e){var t=e.sender.BTN;e.sender.setActions(t.CLOSE,{disabled:!1}),e.sender.setActions(t.SAVE,{disabled:!1})},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:"",headerTemplate:"",isCustomActions:!0,actions:[{text:R.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}},{text:R.prop("COMMON_BTN_SAVE"),visible:!0,disabled:!1,action:function(e){var t,i;return 0<(i=e.sender.grid.getCheckedData()).length&&(t=i[0],e.sender.trigger("onSelect",{result:t,results:i})),!1}}]},W={title:R.prop("FACILITY_SCHEDULE_MORE_SCHEDULE"),width:884,height:830,isOnlyMulti:!0,gridOptions:{columns:[{field:"checked",template:M.checkboxCellTemplate,width:37,sortable:!1},{field:"title",title:R.prop("FACILITY_SCHEDULE_SCHEDULE_NAME"),sortable:!0,width:200,template:M.scheduleDetailNameTemplate},{field:"times",title:R.prop("COMMON_TIME"),sortable:!0,width:120,template:M.configuExecutionTimeListTemplate},{field:"operations",title:R.prop("FACILITY_SCHEDULE_CREATE_OPERATION_TITLE"),width:460,template:M.moreOperationListTemplate,sortable:!1}],sortable:!0,hasCheckedModel:!0},buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2},onTypeChange:function(e){var t=e.sender.BTN;e.sender.setActions(t.CLOSE,{disabled:!1}),e.sender.setActions(t.EDIT,{disable:!0}),e.sender.setActions(t.DELETE,{disabled:!0})},contentViewModel:{detailType:R.prop("COMMON_GENERAL")},headerViewModel:{checkedNum:0},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',headerTemplate:'<span> <span data-bind="text: checkedNum"></span> '+R.prop("FACILITY_SCHEDULE_SELECTED_SCHEDULE")+'<ul class="k-reset k-header k-scheduler-views legend"><li class="scheduler-legend"><i class="square indoor"></i><span class="legend-text">'+R.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR")+'</span></li><li class="scheduler-legend"><i class="square light"></i><span class="legend-text">'+R.prop("FACILITY_DEVICE_TYPE_LIGHT")+'</span></li><li class="scheduler-legend"><i class="square indoorlight"></i><span class="legend-text">'+R.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR")+" + "+R.prop("FACILITY_DEVICE_TYPE_LIGHT")+'</span></li><li class="scheduler-legend"><i class="square others"></i><span class="legend-text">'+R.prop("FACILITY_DEVICE_OTHERS")+'</span></li><li class="scheduler-legend"><i class="square pause"></i><span class="legend-text">'+R.prop("COMMON_PAUSE")+"</span></li></ul></span>",isCustomActions:!0,actions:[{text:R.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}},{text:R.prop("COMMON_BTN_DELETE"),visible:!0,disabled:!0,action:function(e){var t,i;return 0<(i=e.sender.grid.getCheckedData()).length&&(t=i[0],e.sender.trigger("onDelete",{result:t,results:i})),!1}},{text:R.prop("COMMON_BTN_EDIT"),visible:!0,disabled:!0,action:function(e){var t,i;return 0<(i=e.sender.grid.getCheckedData()).length&&(t=i[0],e.sender.trigger("onEdit",{result:t,results:i})),!1}}],scheme:L},V={title:R.prop("FACILITY_SCHEDULE_MORE_EXCEPTIONAL_DAYS"),width:884,height:830,isOnlyMulti:!0,gridOptions:{columns:[{field:"title",title:R.prop("FACILITY_SCHEDULE_EXCEPTIONAL_DAY_NAME"),sortable:!0,width:200,template:M.scheduleDetailNameTemplate},{field:"description",title:R.prop("COMMON_DESCRIPTION"),width:460,sortable:!1,template:function(e){var t="-";return t=e.description?e.description:t,H.decodeHtml(t)}}],sortable:!0,hasCheckedModel:!0},buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2},onTypeChange:function(e){var t=e.sender.BTN;e.sender.setActions(t.CLOSE,{disabled:!1}),e.sender.setActions(t.EDIT,{disabled:!0}),e.sender.setActions(t.DELETE,{disabled:!0})},headerViewModel:{checkedNum:0},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"></div><div class="detail-dialog-detail-content-field-list"></div>',headerTemplate:"<span>"+R.prop("FACILITY_SCHEDULE_SELECTED_EXCEPTIONAL_DAYS")+': <span data-bind="text: checkedNum"></span></span>',isCustomActions:!0,actions:[{text:R.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}},{text:R.prop("COMMON_BTN_DELETE"),visible:!0,disabled:!0,action:function(e){var t,i;return 0<(i=e.sender.grid.getCheckedData()).length&&(t=i[0],e.sender.trigger("onDelete",{result:t,results:i})),!1}},{text:R.prop("COMMON_BTN_EDIT"),visible:!0,disabled:!0,action:function(e){var t,i;return 0<(i=e.sender.grid.getCheckedData()).length&&(t=i[0],e.sender.trigger("onEdit",{result:t,results:i})),!1}}],scheme:S},B={title:R.prop("COMMON_BTN_DETAIL"),width:652,height:830,buttonsIndex:{CLOSE:0,EDIT:1,CANCEL:2,SAVE:3,REGISTER:4,DEREGISTER:5,DELETE:6},contentViewModel:{clickHistoryBtn:function(){m.data("kendoGrid").dataSource.data(u),v.kendoPopupSingleWindow("openWindowPopup")},detailType:R.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',listTemplate:t.multiDetailListDualTemplate,headerTemplate:"<span>"+R.prop("FACILITY_DEVICE_SELECTED_DEVICE")+": <span>#:count #</span></span>",isCustomActions:!0,actions:[{text:R.prop("COMMON_BTN_CLOSE"),visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}}],scheme:{id:"id",fields:{type:{type:"text",name:R.prop("FACILITY_DEVICE_TYPE"),template:H.getDetailDisplayTypeDeviceI18N},id:{type:"text",name:R.prop("FACILITY_DEVICE_DEVICE_ID")},name:{type:"text",name:R.prop("FACILITY_DEVICE_DEVICE_NAME")},representativeStatus:{type:"text",name:R.prop("COMMON_STATUS"),template:t.detailStatusIconTemplate},modes:{type:"text",name:R.prop("FACILITY_INDOOR_CONTROL_OPERATION_MODE"),template:function(e){var t=e.modes;return t&&0<t.length?H.getDisplayModeI18N(t,e.operations,!0):"-"}},setTemperature:{type:"text",name:R.prop("FACILITY_INDOOR_SET_TEMPERATURE"),template:e.setTemperatures},currentTemperature:{type:"text",name:R.prop("FACILITY_INDOOR_CURRENT_TEMPERATURE"),template:e.curTemperatures},configuration:{type:"text",name:R.prop("FACILITY_INDOOR_REMOTE_CONTROL"),template:function(e){var t=e.configuration;return t&&t.remoteControl?"Allowed"===t.remoteControl?R.prop("FACILITY_INDOOR_REMOTE_CONTROL_ENABLE"):"NotAllowed"===t.remoteControl?R.prop("FACILITY_INDOOR_REMOTE_CONTROL_DISABLE"):R.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_CONDITIONAL"):"-"}},locations:{type:"text",name:R.prop("COMMON_LOCATION"),template:e.getLocation},groups:{type:"text",name:R.prop("FACILITY_GROUP_GROUP"),template:e.getGroup},information:{type:"text",name:R.prop("FACILITY_DEVICE_MODEL"),template:function(e){var t="-",i=e.information;if(i&&i.modelName){t=i.modelName;var o=R.prop("FACILITY_DEVICE_STATUS_POPUP_MODEL_"+t.toUpperCase());t=o||t}return t}},firmwareVersion:{type:"text",name:R.prop("FACILITY_DEVICE_FIRMWARE_VERSION"),template:e.getFirmwareVersion},description:{type:"text",name:R.prop("COMMON_DESCRIPTION")}}}},G={title:R.prop("COMMON_BTN_DETAIL"),width:652,height:352,buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2,CANCEL:3,SAVE:4},contentViewModel:{clickHistoryBtn:function(){m.data("kendoGrid").dataSource.data(u),v.kendoPopupSingleWindow("openWindowPopup")},detailType:R.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"></div><div class="detail-dialog-detail-content-field-list"></div>',listTemplate:function(e){var t=e.name=e.title||e.name;return t=t||"",e.title=t,"<span data-bind='text: title'>"+H.decodeHtml(t)+"</span>"},headerTemplate:"<span>"+R.prop("FACILITY_SCHEDULE_SELECTED_EXCEPTIONAL_DAYS")+": <span>#:count #</span></span>",isCustomActions:!0,onTypeChange:function(e){var t=e.type,i=e.sender,o=e.sender.BTN;if("create"==t)i.setEditable(!0),i.setActions(o.SAVE,{visible:!0}),i.setActions(o.CANCEL,{visible:!0}),i.setActions(o.EDIT,{visible:!1}),i.setActions(o.CLOSE,{visible:!1}),i.setActions(o.DELETE,{visible:!1});else if("detail"==t){i.setActions(o.SAVE,{visible:!1}),i.setActions(o.CANCEL,{visible:!1}),i.setActions(o.CLOSE,{visible:!0}),1<i.dataSource.total()?(i.setActions(o.DELETE,{visible:!1}),i.setActions(o.EDIT,{visible:!1}),i.wrapper.css({width:652,height:830}),i.element.css({height:701})):(i.setActions(o.DELETE,{visible:!0}),i.setActions(o.EDIT,{visible:!0}),i.wrapper.css({width:652,height:352}),i.element.css({height:223}))}else"edit"==t&&(i.setEditable(!0),i.setActions(o.SAVE,{visible:!0}),i.setActions(o.CANCEL,{visible:!0}),i.setActions(o.EDIT,{visible:!1}),i.setActions(o.CLOSE,{visible:!1}),i.setActions(o.DELETE,{visible:!1}))},actions:[{text:R.prop("COMMON_BTN_CLOSE"),visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1),e.sender.trigger("onClosed")}},{text:R.prop("COMMON_BTN_DELETE"),visible:!0,action:function(e){var t,i;return t=e.sender.getSelectedData(),1<e.sender.dataSource.total()&&(i=e.sender.dataSource.data()),e.sender.trigger("onDelete",{result:t,results:i}),!1}},{text:R.prop("COMMON_BTN_EDIT"),visible:!0,action:function(e){return e.sender.trigger("onEdit"),e.sender.setEditable(!0),e.sender.trigger("onEdited"),!1}},{text:R.prop("COMMON_BTN_CANCEL"),visible:!1,action:function(e){e.sender.confirmDialog.message(R.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL"));function t(){e.sender.trigger("onCancel"),e.sender.cancelDataSource(),"create"==e.sender.dialogType&&e.sender.close(),e.sender.setEditable(!1),e.sender.setDialogType(e.sender.dialogType),e.sender.hideInvalidMessage(),e.sender.hideRemoveBtn(),e.sender.trigger("onCanceled")}return e.sender.hasChanged?(e.sender.confirmDialog.setConfirmActions({yes:function(){t()}}),e.sender.confirmDialog.open()):t(),!1}},{text:R.prop("COMMON_BTN_SAVE"),visible:!1,disabled:!0,action:function(e){var t,i;e.sender.trigger("onSave");var o=e.sender.getSelectedData();return!1===(t=e.sender.save())||(t.id=o.id,1<e.sender.dataSource.total()&&(i=e.sender.saveAll(null,!0)),e.sender.trigger("onSaved",{sender:e.sender,result:t,results:i}),e.sender.setEditable(!1)),!1}}],scheme:S};return{getDetailPopup:function(){return o.kendoDetailDialog(B).data("kendoDetailDialog")},getExceptionalPopup:function(){return r.kendoDetailDialog(G).data("kendoDetailDialog")},getScheduleDetailPopup:function(){i=d.kendoDetailDialog(x).data("kendoDetailDialog");var e=y.bind(i),t=k.bind(i);return i.setOptions({contentViewModel:{detailType:R.prop("COMMON_GENERAL"),editSchedule:e,deleteSchedule:t}}),i},getScheduleMorePopup:function(){return s.kendoDetailDialog(W).data("kendoDetailDialog")},getExceptionalMorePopup:function(){return l.kendoDetailDialog(V).data("kendoDetailDialog")},getLoadPopup:function(){return c.kendoDetailDialog(Y).data("kendoDetailDialog")},getSelectFolderPopup:function(){return p.kendoDetailDialog(U).data("kendoDetailDialog")},daysOfWeekSequence:{Mon:0,Tue:1,Wed:2,Thu:3,Fri:4,Sat:5,Sun:6}}}),define("operation/schedule/model",function(){"use strict";function r(e){return"Folder"===e.type}function d(e){return e.id}var c=window.moment,e=window.kendo,a=e.data.Model.define({id:"id",fields:{name:{name:"Name"},description:{name:"Description"},activated:{name:"Activation",type:"boolean"},startDate:{name:"Start Date",type:"date"},endDate:{name:"End Date",type:"date"},exceptionalDays:{name:"Execeptional Days",type:"object",defaultValue:[]},devices:{name:"Devices",type:"object",defaultValue:[]},configurations:{name:"Configurations",type:"object",defaultValue:[]},folder:{name:"Folder",type:"object",defaultValue:{}}}}),t=(e.data.Model.define({daysOfWeek:{name:"Repeat Days",type:"object",defaultValue:[]},executionTimes:{name:"Execution Time",type:"object",defaultValue:[]},deviceTypes:{name:"Operations",type:"object",defaultValue:{}},algorithm:{name:"Algorithm",type:"object",defaultValue:{}}}),e.data.Model.define({id:"id",fields:{name:{type:"string"},description:{type:"string "},startDate:{type:"string"},endDate:{type:"string"},repeatYear:{type:"boolean"}}})),n=e.data.Model.define({id:"id",fields:{name:{type:"string"},collapsed:{type:"object"},created:{type:"object"},updated:{type:"object"}}}),s=function(e,t){var i=new Date(e);return t?(i.setHours(23),i.setSeconds(59),i.setMinutes(59)):(i.setHours(0),i.setSeconds(0),i.setMinutes(0)),i},l=function(e){var t=e.executionTimes.sort()[0];t=t||"00:00:00";var i=new Date(e.start),o=t.split(":");i.setHours(o[0]),i.setMinutes(o[1]),i.setSeconds(o[2]);var a=new Date(i);a.setMinutes(a.getMinutes()+30),e.start=i,e.end=a},p=function(e,t){if(e.activated){if(t&&!(t.length<1)){var i,o=t.length,a=!1,n=!1;for(i=0;i<o;i++)-1!=t[i].dms_devices_type.indexOf("AirConditioner")&&(a=!0),-1!=t[i].dms_devices_type.indexOf("Light")&&(n=!0);e.type=a&&n?3:a?1:n?2:4}}else e.type=5};return{Model:a,ExceptionalDaysModel:t,createModel:function(e){var t=new a(e);if(e)return t;var i=new Date,o=new Date((new Date).getFullYear(),(new Date).getMonth()+1,(new Date).getDate());return t.set("control",{}),t.set("deviceTypes",[]),t.startDate=c(i).format("YYYY-MM-DD"),t.endDate=c(o).format("YYYY-MM-DD"),t},MockGetAllSchedules:[{id:5,name:"schedule_1_folder1",type:"Schedule",description:"asdada",level:1,schedules_folders_id:4,activated:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},startDate:"2019-05-27",endDate:"2019-06-27",exceptionalDays:[{startDate:"2017-03-10",endDate:"2017-06-15",name:"holiday",description:"holiday week"},{startDate:"2017-07-30",endDate:"2017-08-15",name:"vacation"}],devices:[{dms_devices_id:"AHU_0002",dms_devices_name:"energy_test_AHU_0002",dms_devices_type:"AirConditioner.AHU",location:"Building A, B98"},{dms_devices_id:"Chiller_0002",dms_devices_name:"energy_test_Chiller_0002",dms_devices_type:"AirConditioner.Chiller",location:"Building A, B98"}],configurations:[{daysOfWeek:["Mon","Tue","Wed","Thu"],executionTimes:["00:03:00","00:04:00","00:05:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:24},{id:"AirConditioner.Indoor.WaterOutlet",desired:24},{id:"AirConditioner.Indoor.DHW",desired:25}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}},{executionTimes:["00:11:00","00:12:00","00:13:00"],daysOfWeek:["Mon","Tue","Wed"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:27},{id:"AirConditioner.Indoor.WaterOutlet",desired:28},{id:"AirConditioner.Indoor.DHW",desired:30}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]},{id:7,name:"schedule_2_folder1",type:"Schedule",description:"hjh",level:1,activated:!0,schedules_folders_id:4,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-05-29T15:55:51+05:30",ums_users_name:"Web Admin"},devices:[{dms_devices_id:"DuctFresh_0002",dms_devices_name:"energy_test_DuctFresh_0002",dms_devices_type:"AirConditioner.DuctFresh",location:"Building A, B98"},{dms_devices_id:"EHS_0002",dms_devices_name:"energy_test_EHS_0002",dms_devices_type:"AirConditioner.EHS",location:"Building A, B98"},{dms_devices_id:"ERVPlus_0002",dms_devices_name:"energy_test_ERVPlus_0002",dms_devices_type:"AirConditioner.ERVPlus",location:"Building A, 8F"},{dms_devices_id:"FCU_0002",dms_devices_name:"energy_test_FCU_0002",dms_devices_type:"AirConditioner.FCU",location:"Building A, 10F"},{dms_devices_id:"d101077",dms_devices_name:"light_test101077",dms_devices_type:"Light",location:"Building A, B98"},{dms_devices_id:"indoor_0006",dms_devices_name:"energy_test_indoor_0006",dms_devices_type:"AirConditioner.Indoor",location:"Building A, 10F"},{dms_devices_id:"indoor_0007",dms_devices_name:"energy_test_indoor_0007",dms_devices_type:"AirConditioner.Indoor",location:"Building A, 10F"}],configurations:[{daysOfWeek:["Mon","Tue","Wed","Thu"],executionTimes:["01:03:00","02:03:00","03:03:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:24},{id:"AirConditioner.Indoor.WaterOutlet",desired:24},{id:"AirConditioner.Indoor.DHW",desired:25}]}},{dms_devices_type:"Light",control:{operations:[{id:"General",power:"On"}],lights:[{id:1,dimmingLevel:80}]}},{dms_devices_type:"ControlPoint.AO",control:{controlPoint:{value:3}}},{dms_devices_type:"ControlPoint.DO",control:{controlPoint:{value:1}}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}},{executionTimes:["04:03:00","05:03:00","06:03:00"],daysOfWeek:["Mon","Tue","Wed"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:24},{id:"AirConditioner.Indoor.WaterOutlet",desired:24},{id:"AirConditioner.Indoor.DHW",desired:25}]}},{dms_devices_type:"Light",control:{operations:[{id:"General",power:"On"}],lights:[{id:1,dimmingLevel:80}]}},{dms_devices_type:"ControlPoint.AO",control:{controlPoint:{value:3}}},{dms_devices_type:"ControlPoint.DO",control:{controlPoint:{value:1}}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]},{id:9,name:"schedule_3_folder1",type:"Schedule",description:"asdada",level:1,schedules_folders_id:4,activated:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-06-01T15:55:51+05:30",ums_users_name:"Web Admin"},startDate:"2019-05-27",endDate:"2019-06-27",exceptionalDays:[{startDate:"2017-03-10",endDate:"2017-06-15",name:"holiday",description:"holiday week"},{startDate:"2017-07-30",endDate:"2017-08-15",name:"vacation"}],devices:[{dms_devices_id:"indoor_0008",dms_devices_name:"energy_test_indoor_0008",dms_devices_type:"AirConditioner.Indoor",location:"Building A, B98"},{dms_devices_id:"indoor_0009",dms_devices_name:"energy_test_indoor_0009",dms_devices_type:"AirConditioner.Indoor",location:"Building A, B98"}],configurations:[{daysOfWeek:["Mon","Tue"],executionTimes:["00:03:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:24},{id:"AirConditioner.Indoor.WaterOutlet",desired:24},{id:"AirConditioner.Indoor.DHW",desired:25}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]},{id:13,name:"schedule_4_folder1",type:"Schedule",description:"asdada",level:1,schedules_folders_id:7,activated:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-06-11T15:55:51+05:30",ums_users_name:"Web Admin"},startDate:"2019-05-27",endDate:"2019-06-27",exceptionalDays:[{startDate:"2017-03-10",endDate:"2017-06-15",name:"holiday",description:"holiday week"},{startDate:"2017-07-30",endDate:"2017-08-15",name:"vacation"}],devices:[{dms_devices_id:"indoor_0008",dms_devices_name:"energy_test_indoor_0008",dms_devices_type:"AirConditioner.Indoor",location:"Building A, B98"},{dms_devices_id:"indoor_0009",dms_devices_name:"energy_test_indoor_0009",dms_devices_type:"AirConditioner.Indoor",location:"Building A, B98"}],configurations:[{daysOfWeek:["Mon","Tue"],executionTimes:["00:03:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:24},{id:"AirConditioner.Indoor.WaterOutlet",desired:24},{id:"AirConditioner.Indoor.DHW",desired:25}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]},{id:14,name:"schedule_5_folder1",type:"Schedule",description:"asdada",level:1,schedules_folders_id:7,activated:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-06-18T15:55:51+05:30",ums_users_name:"Web Admin"},startDate:"2019-11-27",endDate:"2019-12-27",exceptionalDays:[{startDate:"2017-03-10",endDate:"2017-06-15",name:"holiday",description:"holiday week"},{startDate:"2017-07-30",endDate:"2017-08-15",name:"vacation"}],devices:[{dms_devices_id:"AHU_0001",dms_devices_name:"energy_test_AHU_0001",dms_devices_type:"AirConditioner.AHU",location:"Building A, 8F"},{dms_devices_id:"Chiller_0001",dms_devices_name:"energy_test_Chiller_0001",dms_devices_type:"AirConditioner.Chiller",location:"Building A, B98"}],configurations:[{daysOfWeek:["Mon","Tue"],executionTimes:["00:03:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:33},{id:"AirConditioner.Indoor.WaterOutlet",desired:30},{id:"AirConditioner.Indoor.DHW",desired:27}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]},{id:20,name:"schedule_6",type:"Schedule",description:"asdada",level:1,activated:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-06-07T15:55:51+05:30",ums_users_name:"Web Admin"},startDate:"2019-11-27",endDate:"2019-12-27",exceptionalDays:[{startDate:"2017-03-10",endDate:"2017-06-15",name:"holiday",description:"holiday week"},{startDate:"2017-07-30",endDate:"2017-08-15",name:"vacation"}],devices:[{dms_devices_id:"AHU_0001",dms_devices_name:"energy_test_AHU_0001",dms_devices_type:"AirConditioner.AHU",location:"Building A, 8F"},{dms_devices_id:"Chiller_0001",dms_devices_name:"energy_test_Chiller_0001",dms_devices_type:"AirConditioner.Chiller",location:"Building A, B98"}],configurations:[{daysOfWeek:["Mon","Tue"],executionTimes:["00:03:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:33},{id:"AirConditioner.Indoor.WaterOutlet",desired:30},{id:"AirConditioner.Indoor.DHW",desired:27}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]},{id:21,name:"schedule_7",type:"Schedule",description:"asdada",level:1,activated:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-11-06T15:55:51+05:30",ums_users_name:"Web Admin"},startDate:"2019-11-27",endDate:"2019-12-27",exceptionalDays:[{startDate:"2017-03-10",endDate:"2017-06-15",name:"holiday",description:"holiday week"},{startDate:"2017-07-30",endDate:"2017-08-15",name:"vacation"}],devices:[{dms_devices_id:"AHU_0001",dms_devices_name:"energy_test_AHU_0001",dms_devices_type:"AirConditioner.AHU",location:"Building A, 8F"},{dms_devices_id:"Chiller_0001",dms_devices_name:"energy_test_Chiller_0001",dms_devices_type:"AirConditioner.Chiller",location:"Building A, B98"}],configurations:[{daysOfWeek:["Mon","Tue"],executionTimes:["00:03:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:33},{id:"AirConditioner.Indoor.WaterOutlet",desired:30},{id:"AirConditioner.Indoor.DHW",desired:27}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]}],FolderMockData:[{id:"1",name:"folder_A",updated:{date:"2018-08-16T18:54:04+09:00"},schedules_ids:[1,2,3]},{id:"2",name:"folder_B",updated:{date:"2018-08-17T18:54:04+09:00"},schedules_ids:[1,2,3]},{id:"3",name:"folder_C",updated:{date:"2018-08-18T18:54:04+09:00"},schedules_ids:[1,2,3]},{id:"4",name:"folder_D",updated:{date:"2018-08-19T18:54:04+09:00"},schedules_ids:[1,2,3]},{id:"5",name:"\ud3f4\ub354_\uac00",updated:{date:"2018-08-19T18:54:04+09:00"},schedules_ids:[1,2,3]},{id:"6",name:"\ud3f4\ub354_\ub098",updated:{date:"2018-08-19T18:54:04+09:00"},schedules_ids:[1,2,3]},{id:"7",name:"\uc0c8\ud3f4\ub354",updated:{date:"2017-08-19T18:54:04+09:00"},schedules_ids:[1,2,3]},{id:"8",name:"Newfolder",updated:{date:"2017-08-19T18:54:04+09:00"},schedules_ids:[1,2,3]},{id:"9",name:"Newfolder (1)",updated:{date:"2017-08-19T18:54:04+09:00"},schedules_ids:[1,2,3]},{id:"10",name:"Empty folder",updated:{date:"2017-09-19T18:54:04+09:00"},schedules_ids:[]}],createDataSource:function(e,t){var i,o,a,n=e.length;for(i=0;i<n;i++){if((o=e[i]).startDate?o.startDate=s(o.startDate):o.startDate=s(o.created.date),o.endDate)o.endDate=s(o.endDate,!0);else{var r=new Date;r.setFullYear(2099),o.endDate=r}o.deviceTypes||(o.deviceTypes=[]),p(o,o.devices),o.checked=!1,t&&(a=t.filter(function(e){return e.id===o.schedules_folders_id}),o.folder=a[0]||{})}return e},createFolderDataSource:function(e){var t,i,o=e.length,a=[];for(t=0;t<o;t++)"Folder"==(i=e[t]).type&&a.push(new n(i));return a},setDays:function(e){var t,i,o,a=e.length;for(o=0;o<a;o++)i=e[o].startDate,t=c(i),e[o].day=t.date(),e[o].month=t.month()+1,e[o].year=t.year(),e[o].dateForCompare=t.valueOf(),e[o].checked=!1,e[o].dateForCompareEnd=t.valueOf()},createExceptionalDs:function(e){var t,i,o=e.length;for(t=0;t<o;t++)(i=e[t]).startDate=s(i.startDate),i.endDate=s(i.endDate,!0);return e},createExceptionalDaysByRepeatYear:function(e){var l={};return e.forEach(function(e){!function(e){var t,i=c(e.startDate),o=c(e.endDate),a=i.year(),n=o.year(),r=e.repeatYear?2099:n-a+1;for(t=0;t<r;t++){var d=$.extend({},e);d.startDate=c(d.startDate).set("year",i.year()+t).toDate(),d.endDate=c(d.endDate).set("year",o.year()+t).toDate();for(var s=d.startDate;s<=d.endDate;)l[s.toString()]=!0,s.setDate(s.getDate()+1)}}(e)}),l},applyExecutionTimesDs:function(e){var t,i=e.data(),o=i.length;for(t=0;t<o;t++)l(i[t])},applyModel:function(e){var t,i=e.length;for(t=0;t<i;t++)e[t]=new a(e[t]);return e},MAX_END_DATE_YEAR:2099,MAX_END_DATE_MONTH:12,MAX_END_DATE_DAY:31,MAX_END_DATE:"2099-12-31",parseFolderModel:function(e){if(!e||0===e.length)return[];for(var t,i,o=[],a=0,n=(e=e.filter(r)).length;a<n;a++)i=[],(t=e[a]).schedules&&(i=t.schedules.map(d)),o.push({id:t.id,name:t.name,updated:t.updated,schedules_ids:i,groupName:t.updated.date+":id:"+t.id+":name:"+t.name});return o},MockGetAllFoldersSchedules:[{id:4,name:"folder1",type:"Folder",description:"desc_folder1",level:0,collapsed:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},schedules:[{id:5,name:"schedule_1_folder1",type:"Schedule",description:"asdada",level:1,schedules_folders_id:4,activated:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},startDate:"2019-05-27",endDate:"2019-06-27",exceptionalDays:[{startDate:"2017-03-10",endDate:"2017-06-15",name:"holiday",description:"holiday week"},{startDate:"2017-07-30",endDate:"2017-08-15",name:"vacation"}],devices:[{dms_devices_id:"DuctFresh_0001",dms_devices_name:"energy_test_DuctFresh_0001",dms_devices_type:"AirConditioner.DuctFresh",location:"Building A, 8F"},{dms_devices_id:"EHS_0001",dms_devices_name:"energy_test_EHS_0001",dms_devices_type:"AirConditioner.EHS",location:"Building A, 9F"}],configurations:[{daysOfWeek:["Mon","Tue","Wed","Thu"],executionTimes:["00:03:00","00:03:00","00:03:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:24},{id:"AirConditioner.Indoor.WaterOutlet",desired:24},{id:"AirConditioner.Indoor.DHW",desired:25}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}},{executionTimes:["00:03:00","00:03:00","00:03:00"],daysOfWeek:["Mon","Tue","Wed"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:24},{id:"AirConditioner.Indoor.WaterOutlet",desired:24},{id:"AirConditioner.Indoor.DHW",desired:25}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]},{id:7,name:"schedule_2_folder1",type:"Schedule",description:"hjh",level:1,schedules_folders_id:4,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},devices:[{dms_devices_id:"ERV_0001",dms_devices_name:"energy_test_ERV_0001",dms_devices_type:"AirConditioner.ERV",location:"Building A, 8F"},{dms_devices_id:"ERVPlus_0001",dms_devices_name:"energy_test_ERVPlus_0001",dms_devices_type:"AirConditioner.ERVPlus",location:"Building A, 9F"},{dms_devices_id:"FCU_0001",dms_devices_name:"energy_test_FCU_0001",dms_devices_type:"AirConditioner.FCU",location:"Building A, 8F"},{dms_devices_id:"indoor_0001",dms_devices_name:"energy_test_indoor_0001",dms_devices_type:"AirConditioner.Indoor",location:"Building A, 10F"},{dms_devices_id:"indoor_0002",dms_devices_name:"energy_test_indoor_0002",dms_devices_type:"AirConditioner.Indoor",location:"Building A, 9F"},{dms_devices_id:"indoor_0003",dms_devices_name:"energy_test_indoor_0003",dms_devices_type:"AirConditioner.Indoor",location:"Building A, 10F"},{dms_devices_id:"indoor_0004",dms_devices_name:"energy_test_indoor_0004",dms_devices_type:"AirConditioner.Indoor",location:"Building A, 10F"}],configurations:[{daysOfWeek:["Mon","Tue","Wed","Thu"],executionTimes:["00:03:00","00:03:00","00:03:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:24},{id:"AirConditioner.Indoor.WaterOutlet",desired:24},{id:"AirConditioner.Indoor.DHW",desired:25}]}},{dms_devices_type:"Light",control:{operations:[{id:"General",power:"On"}],lights:[{id:1,dimmingLevel:80}]}},{dms_devices_type:"ControlPoint.AO",control:{controlPoint:{value:3}}},{dms_devices_type:"ControlPoint.DO",control:{controlPoint:{value:1}}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}},{executionTimes:["00:03:00","00:03:00","00:03:00"],daysOfWeek:["Mon","Tue","Wed"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:24},{id:"AirConditioner.Indoor.WaterOutlet",desired:24},{id:"AirConditioner.Indoor.DHW",desired:25}]}},{dms_devices_type:"Light",control:{operations:[{id:"General",power:"On"}],lights:[{id:1,dimmingLevel:80}]}},{dms_devices_type:"ControlPoint.AO",control:{controlPoint:{value:3}}},{dms_devices_type:"ControlPoint.DO",control:{controlPoint:{value:1}}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]}]},{id:7,name:"folder2",type:"Folder",description:"desc_folder2",level:0,collapsed:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-10-01T15:55:51+05:30",ums_users_name:"Web Admin"},schedules:[{id:13,name:"schedule_4_folder1",type:"Schedule",description:"asdada",level:1,schedules_folders_id:7,activated:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-10-01T15:55:51+05:30",ums_users_name:"Web Admin"},startDate:"2019-05-27",endDate:"2019-06-27",exceptionalDays:[{startDate:"2017-03-10",endDate:"2017-06-15",name:"holiday",description:"holiday week"},{startDate:"2017-07-30",endDate:"2017-08-15",name:"vacation"}],devices:[{dms_devices_id:"indoor_0008",dms_devices_name:"energy_test_indoor_0008",dms_devices_type:"AirConditioner.Indoor",location:"Building A, B98"},{dms_devices_id:"indoor_0009",dms_devices_name:"energy_test_indoor_0009",dms_devices_type:"AirConditioner.Indoor",location:"Building A, B98"}],configurations:[{daysOfWeek:["Mon","Tue"],executionTimes:["00:03:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:24},{id:"AirConditioner.Indoor.WaterOutlet",desired:24},{id:"AirConditioner.Indoor.DHW",desired:25}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]},{id:14,name:"schedule_5_folder1",type:"Schedule",description:"asdada",level:1,schedules_folders_id:7,activated:!0,created:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-05-27T15:55:51+05:30",ums_users_name:"Web Admin"},startDate:"2019-11-27",endDate:"2019-12-27",exceptionalDays:[{startDate:"2017-03-10",endDate:"2017-06-15",name:"holiday",description:"holiday week"},{startDate:"2017-07-30",endDate:"2017-08-15",name:"vacation"}],devices:[{dms_devices_id:"AHU_0001",dms_devices_name:"energy_test_AHU_0001",dms_devices_type:"AirConditioner.AHU",location:"Building A, 8F"},{dms_devices_id:"Chiller_0001",dms_devices_name:"energy_test_Chiller_0001",dms_devices_type:"AirConditioner.Chiller",location:"Building A, B98"}],configurations:[{daysOfWeek:["Mon","Tue"],executionTimes:["00:03:00"],deviceTypes:[{dms_devices_type:"AirConditioner.Indoor",control:{modes:[{id:"AirConditioner.Indoor.General",mode:"Auto"},{id:"AirConditioner.Indoor.Ventilator",mode:"Auto"},{id:"AirConditioner.Indoor.DHW",mode:"Standard"}],operations:[{id:"AirConditioner.Indoor.General",power:"On"},{id:"AirConditioner.Indoor.Ventilator",power:"On"},{id:"AirConditioner.Indoor.DHW",power:"On"}],temperatures:[{id:"AirConditioner.Indoor.Room",desired:33},{id:"AirConditioner.Indoor.WaterOutlet",desired:30},{id:"AirConditioner.Indoor.DHW",desired:27}]}}],algorithm:{enabled:!0,mode:"PreCooling",preCoolingTemperature:24}}]}]},{id:25,name:"Light list no schedule",type:"Folder",level:0,collapsed:!1,created:{date:"2019-09-05T19:22:19+05:30",ums_users_name:"Web Admin"},updated:{date:"2019-09-05T19:22:19+05:30",ums_users_name:"Web Admin"}}]}}),define("operation/schedule/viewmodel/create-vm",["operation/core","operation/schedule/config/schedule-common","operation/schedule/config/schedule-template"],function(e,t,a){var N=window.kendo,C=window.moment,u=window.Util,i=window.GlobalSettings,T=window.I18N,o=i.getTemperature(),n=o.unit,s=u.CHAR[n],l=o.increment,r=u.getControllableDeviceTypeDataSource(),d={AirConditioner:T.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR"),AirConditionerOutdoor:T.prop("FACILITY_DEVICE_TYPE_SAC_OUTDOOR"),ControlPoint:T.prop("FACILITY_DEVICE_TYPE_POINT"),Meter:T.prop("FACILITY_DEVICE_TYPE_ENERGY_METER"),Beacon:T.prop("FACILITY_DEVICE_TYPE_BLE_BEACON"),"IoT Gateway":T.prop("FACILITY_DEVICE_TYPE_IOT_GATEWAY"),Light:T.prop("FACILITY_DEVICE_TYPE_LIGHT"),CCTV:T.prop("FACILITY_DEVICE_TYPE_CCTV"),Printer:T.prop("FACILITY_DEVICE_TYPE_PRINTER")},c=t.confirmDialog,D=t.msgDialog,E=1,O=N.observable({actions:[{type:"button",id:"schedule-load-btn",text:T.prop("COMMON_BTN_LOAD"),invisible:!1,disabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"schedule-save-btn",text:T.prop("COMMON_BTN_SAVE"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"schedule-cancel-btn",text:T.prop("COMMON_BTN_CANCEL"),invisible:!1,disabled:!1,options:{click:function(){$("#schedule-close-create").trigger("click")},dbclick:function(){},mouseover:function(){},mouseout:function(){}}}],dataFields:{id:{init:function(){},value:""},folder:{init:function(){},value:""},scheduleName:{validator:null,init:function(){var e=$("#schedule-create-name");this.validator=$(e.parent()).data("kendoCommonValidator"),this.validator.bind("validate",function(e){O.actions[E].set("disabled",!e.valid),""==e.sender.element.find("input").eq(0).val()&&O.actions[E].set("disabled",!0)}),this.validator.setOptions({messages:{required:function(){return T.prop("COMMON_REQUIRED_INFORMATION")},maxLength:function(){return T.prop("COMMON_CANNOT_INPUT_MAX_MORE",30)}},rules:{required:function(e){return!0},maxLength:function(e){return e.val().trim().length<=30}}})},value:"",onDuplicatedName:function(){D.message(T.prop("FACILITY_SCHEDULE_DUPlICATED_SCHEDULE_NAME_EXIST")),D.open()}},devices:{widget:null,init:function(){this.widget=$("#schedule-device-selector-popup").kendoCommonDeviceSelecter().data("kendoCommonDeviceSelecter"),this.widget.bind("onSave",this.saveHandler.bind(this))},value:null,openPopup:function(e){var t=O.dataFields.devices,i=t.get("value"),o=[],a=t.widget;i.forEach(function(e){var t=e.id?e.id:e.dms_devices_id;o.push(t)}),a.selectByIds(o),a.open()},saveHandler:function(e){var t=e.result;this.set("value",[]),this.set("value",t),console.log(t)},selectedDeviceTypeAndCount:{indoor:0,dhw:0,ventilator:0,point:0,light:0},selectedNumText:"",getSelectedDeviceTypesCount:function(){var e=this.get("value"),t={indoor:0,point:0,light:0};return e.forEach(function(e){void 0!==e.type?-1!=e.type.indexOf("AirConditioner")?t.indoor++:-1!=e.type.indexOf("ControlPoint")?(-1!=e.mappedType.indexOf("ControlPoint")&&t.point++,-1!=e.mappedType.indexOf("Light")&&t.light++):-1!=e.type.indexOf("Light")&&t.light++:void 0!==e.dms_devices_type&&(-1!=e.dms_devices_type.indexOf("AirConditioner")?t.indoor++:-1!=e.dms_devices_type.indexOf("ControlPoint")?(-1!=e.dms_devices_mappedType.indexOf("ControlPoint")&&t.point++,-1!=e.dms_devices_mappedType.indexOf("Light")&&t.light++):-1!=e.dms_devices_type.indexOf("Light")&&t.light++)}),t},getSelectedNumText:function(){var e=this.getSelectedDeviceTypesCount();return T.prop("FACILITY_SCHEDULE_CREATE_SELECTED_DEVICE_TYPES",e.indoor,e.point,e.light)}},period:{init:function(){var e=new Date,t=new Date;t=C(t).add(1,"M").toDate(),this.startDatePicker.init(e,this.datePickerOptions),this.endDatePicker.init(t,this.datePickerOptions),this.startDatePicker.widget.options.okCallBack=this.handleSelectDateEvt.bind(this),this.endDatePicker.widget.options.okCallBack=this.handleSelectDateEvt.bind(this),this.value.set("setDate",e),this.value.set("endDate",t)},value:{startDate:"",endDate:""},checked:"indefinitePeriod",change:function(e){var t=this.dataFields.period,i=t.startDatePicker.widget,o=t.endDatePicker.widget;"definitePeriod"==t.checked?(i.enable(!0),o.enable(!0)):(i.enable(!1),o.enable(!1))},datePickerOptions:{okCallBack:function(){}},handleSelectDateEvt:function(){var e=this.startDatePicker.widget,t=e.value(),i=this.endDatePicker.widget,o=i.value(),a=new Date;t<a&&(e.value(a),t=a),o<t&&(i.value(t),o=t),t=C(t).format("YYYY-MM-DD"),o=C(o).format("YYYY-MM-DD"),this.set("value",{startDate:t,endDate:o})},startDatePicker:{widget:null,init:function(e,t){this.widget=$("#schedule-create-start-datepicker").kendoCommonDatePicker(t).data("kendoCommonDatePicker"),this.widget.enable(!1),this.widget.value(e)}},endDatePicker:{widget:null,init:function(e,t){this.widget=$("#schedule-create-end-datepicker").kendoCommonDatePicker(t).data("kendoCommonDatePicker"),this.widget.enable(!1),this.widget.value(e)}}},timeAndOperationSettings:{init:function(){this.oneDayTimePicker.init(),this.repeatDate.init(),this.operationSettings.init(),this.timeSettingList.init(),this.oneDayTimePicker.widget.bind("change",R.operation.confirm.clear.setEnabled),v.bind("change",R.operation.confirm.clear.setEnabled),R.bind("change",R.operation.confirm.clear.setEnabled)},value:[],oneDayTimePicker:{widget:null,init:function(){this.widget=$("#oneday-time-picker").kendoOneDayTimePicker().data("kendoOneDayTimePicker")},setData:function(e){if(1<e.length)this.widget.setTimesettings(null),this.widget.enable(!1);else if(1==e.length){var t=e[0].executionTime;this.widget.setTimesettings(t),this.widget.enable(!0)}else 0==e.length&&this.widget.setTimesettings(null)},getData:function(){return this.widget.getTimesettings()},help:{icon:{click:function(e){$(".schedule-create-content .field-wrapper.time-and-operation-field .help-popup-wrapper").css("display","inline-block")}},popup:{msg:T.prop("FACILITY_SCHEDULE_CREATE_TIME_SETTING_HELP_MSG"),close:{click:function(e){$(".schedule-create-content .field-wrapper.time-and-operation-field .help-popup-wrapper").css("display","none")}}}}},repeatDate:{view:null,init:function(){v.init(),this._renderTemplate()},setData:function(e){var t=e.length,i=v.get("daysOfWeek"),o=v.get("daysOfWeekNotEqualed"),a={Mon:0,Tue:0,Wed:0,Thu:0,Fri:0,Sat:0,Sun:0};e.forEach(function(e){e.daysOfWeek.forEach(function(e){a[e]++})}),Object.keys(a).forEach(function(e){i[e.toLowerCase()]=!1,o[e.toLowerCase()]=!1,1<=a[e]&&(i[e.toLowerCase()]=!0),a[e]==t?o[e.toLowerCase()]=!1:o[e.toLowerCase()]=!0}),v.daysOfWeekChangeHandler(),v.set("daysOfWeek",i),v.set("daysOfWeekNotEqualed",o),this._renderTemplate()},_renderTemplate:function(){null!==this.view&&this.view.destroy(),this.view=new N.View($("#schedule-repeat-date-template"),{model:v,evalTemplate:!0}),this.view.render($("#schedule-repeat-date"))},getData:function(){var t=v.get("daysOfWeek"),i=[];return["sun","mon","tue","wed","thu","fri","sat"].forEach(function(e){t[e]&&i.push(e[0].toUpperCase()+e.slice(1))}),i}},operationSettings:{init:function(){R.init(),this.tab.init()},tab:{widget:null,operationTabElem:null,init:function(){var e;new N.View($("#schedule-operation-template"),{model:R,evalTemplate:!0}).render($("#schedule-operation")),e=$("#operation-tab"),this.operationTabElem=e,this.widget=e.kendoCommonTabStrip({isTopMenu:!1}).data("kendoCommonTabStrip")},activeTabInit:function(){this.setActiveTab(0)},setActiveTab:function(e){var t=this.operationTabElem,i=$(t).find("ul > li");this.widget.activateTab(i.eq(e))}},setData:function(e){var t=this,i={indoor:{power:{checked:{},active:{}},operation:{checked:{},Auto:{active:{}},Cool:{active:{}},Heat:{active:{}},Dry:{active:{}},Fan:{active:{}},CoolStorage:{active:{}},HeatStorage:{active:{}}},temperature:{checked:{},desired:{}},waterTemp:{checked:{},desired:{}}},ventilator:{power:{checked:{},active:{}},operation:{checked:{},Auto:{active:{}},HeatEx:{active:{}},Bypass:{active:{}},Sleep:{active:{}}}},dhw:{power:{checked:{},active:{}},operation:{checked:{},Eco:{active:{}},Standard:{active:{}},Power:{active:{}},Force:{active:{}}},temperature:{checked:{},desired:{}}},remoteControl:{checked:{},control:[{checked:{},active:{}},{checked:{},active:{}}]},light:{power:{checked:{},active:{}},checked:{},value:{}},point:{aoav:{checked:{},value:{}},dodv:{checked:{},active:{}}},pre:{checked:{},cool:{},heat:{},radioChecked:{}}},o=e.length;R.init(),e.forEach(function(e){t.applyOperationViewModel(e,i,o)});var a=i.indoor;R.operation.indoor.power.set("checkedNotEqualed",a.power.checked.true<o),R.operation.indoor.power.get("active")&&R.operation.indoor.power.set("active",!(a.power.active.On<o)),R.operation.indoor.power.set("activeNotEqualed",a.power.active.On<o),R.operation.indoor.operation.set("checkedNotEqualed",a.operation.checked.true<o),Object.keys(a.operation).forEach(function(t){"checked"!==t&&"active"!==t&&R.operation.indoor.operation.mode.forEach(function(e){e.name===t&&e.get("active")&&a.operation[t].active.true<o&&(e.set("active",!1),R.operation.indoor.operation.set("activeNotEqualed",!0))})}),R.operation.indoor.temperature.set("checkedNotEqualed",a.temperature.checked.true<o),R.operation.indoor.temperature.get("checked")&&Object.keys(a.temperature.desired).forEach(function(e){if(a.temperature.desired[e]<o){R.operation.indoor.temperature.set("desired","");var t=$("#indoor-temp").data("kendoCustomNumericBox");$(t.wrapper).unbind("click"),$(t.wrapper).bind("click",function(){R.operation.indoor.operation.activeNotEqualed?R.operation.indoor.temperature.set("checkedNotEqualed",!0):R.operation.indoor.temperature.checkedNotEqualed&&R.operation.indoor.temperature.set("checkedNotEqualed",!1),R.operation.indoor.temperature.set("desired",h),R.operation.indoor.operation.activeNotEqualed&&($("#usechk_indoor3").trigger("click"),R.operation.indoor.operation.mode[0].setIndoorMinMax()),$(t.wrapper).unbind("click")})}}),R.operation.indoor.waterTemp.set("checkedNotEqualed",a.waterTemp.checked.true<o),R.operation.indoor.waterTemp.get("checked")&&Object.keys(a.waterTemp.desired).forEach(function(e){if(a.waterTemp.desired[e]<o){R.operation.indoor.waterTemp.set("desired","");var t=$("#indoor-water-temp").data("kendoCustomNumericBox");$(t.wrapper).unbind("click"),$(t.wrapper).bind("click",function(){R.operation.indoor.operation.activeNotEqualed?R.operation.indoor.waterTemp.set("checkedNotEqualed",!0):R.operation.indoor.waterTemp.checkedNotEqualed&&R.operation.indoor.waterTemp.set("checkedNotEqualed",!1),R.operation.indoor.waterTemp.set("desired",_),R.operation.indoor.operation.activeNotEqualed&&($("#usechk_indoor5").trigger("click"),R.operation.indoor.operation.mode[0].setIndoorMinMax()),$(t.wrapper).unbind("click")})}});var n=i.ventilator;R.operation.ventilator.power.set("checkedNotEqualed",n.power.checked.true<o),R.operation.ventilator.power.get("active")&&R.operation.ventilator.power.set("active",!(n.power.active.On<o)),R.operation.ventilator.power.set("activeNotEqualed",n.power.active.On<o),R.operation.ventilator.operation.set("checkedNotEqualed",n.operation.checked.true<o),Object.keys(n.operation).forEach(function(t){"checked"!==t&&"active"!==t&&R.operation.ventilator.operation.mode.forEach(function(e){e.name===t&&e.get("active")&&n.operation[t].active.true<o&&(e.set("active",!1),R.operation.ventilator.operation.set("activeNotEqualed",!0))})});var r=i.dhw;R.operation.dhw.power.set("checkedNotEqualed",r.power.checked.true<o),R.operation.dhw.power.get("active")&&R.operation.dhw.power.set("active",!(r.power.active.On<o)),R.operation.dhw.power.set("activeNotEqualed",r.power.active.On<o),R.operation.dhw.operation.set("checkedNotEqualed",r.operation.checked.true<o),Object.keys(r.operation).forEach(function(t){"checked"!==t&&"active"!==t&&R.operation.dhw.operation.mode.forEach(function(e){e.name===t&&e.get("active")&&r.operation[t].active.true<o&&(e.set("active",!1),R.operation.dhw.operation.set("activeNotEqualed",!0))})}),R.operation.dhw.temperature.set("checkedNotEqualed",r.temperature.checked.true<o),R.operation.dhw.temperature.get("checked")&&Object.keys(r.temperature.desired).forEach(function(e){if(r.temperature.desired[e]<o){R.operation.dhw.temperature.set("desired","");var t=$("#dhw-temp").data("kendoCustomNumericBox");$(t.wrapper).unbind("click"),$(t.wrapper).bind("click",function(){R.operation.dhw.operation.activeNotEqualed?R.operation.dhw.temperature.set("checkedNotEqualed",!0):R.operation.dhw.temperature.checkedNotEqualed&&R.operation.dhw.temperature.set("checkedNotEqualed",!1),R.operation.dhw.temperature.set("desired",w),R.operation.dhw.operation.activeNotEqualed&&$("#usechk_dhw3").trigger("click"),$(t.wrapper).unbind("click")})}});var d=i.remoteControl;R.operation.remoteControl.set("checkedNotEqualed",d.checked.true<o),R.operation.remoteControl.control[0].get("active")&&d.control[0].active.true<o&&(R.operation.remoteControl.control[0].set("active",!1),R.operation.remoteControl.set("activeNotEqualed",!0)),R.operation.remoteControl.control[1].get("active")&&d.control[1].active.true<o&&(R.operation.remoteControl.control[1].set("active",!1),R.operation.remoteControl.set("activeNotEqualed",!0));var s=i.light;R.operation.light.power.set("checkedNotEqualed",s.power.checked.true<o),R.operation.light.power.get("active")&&R.operation.light.power.set("active",!(s.power.active.On<o)),R.operation.light.power.set("activeNotEqualed",s.power.active.On<o),R.operation.light.set("checkedNotEqualed",s.checked.true<o),Object.keys(s.value).forEach(function(e){s.value[e]<o&&R.operation.light.set("valueNotEqualed",!0)});var l=i.point;R.operation.point.aoav.set("checkedNotEqualed",l.aoav.checked.true<o),Object.keys(l.aoav.value).forEach(function(e){if(l.aoav.value[e]<o){R.operation.point.aoav.set("value","");var t=$("#point-value").data("kendoCustomNumericBox");$(t.wrapper).unbind("click"),$(t.wrapper).bind("click",function(){R.operation.point.aoav.set("checkedNotEqualed",!0),R.operation.point.aoav.set("desired",h),$("#usechk_ddc1").trigger("click"),$(t.wrapper).unbind("click")})}}),R.operation.point.dodv.set("checkedNotEqualed",l.dodv.checked.true<o),R.operation.point.dodv.get("active")&&R.operation.point.dodv.set("active",!(l.dodv.active.true<o)),R.operation.point.dodv.set("activeNotEqualed",l.dodv.active.true<o);var c=i.pre;R.operation.pre.set("checkedNotEqualed",c.checked.true<o);var p=Object.keys(c.cool).length;Object.keys(c.cool).forEach(function(e){if(c.cool[e]<o){R.operation.pre.cool.set("value","");var t=$("#pre-cool-temp").data("kendoCustomNumericBox");$(t.wrapper).unbind("click"),$(t.wrapper).bind("click",function(){R.operation.pre.cool.set("value",y),$("#usechk_preTemper2").trigger("click"),$("#usechk_preTemper1").trigger("click"),$(t.wrapper).unbind("click")})}});var u=Object.keys(c.heat).length;Object.keys(c.heat).forEach(function(e){if(c.heat[e]<o){R.operation.pre.heat.set("value","");var t=$("#pre-heat-temp").data("kendoCustomNumericBox");$(t.wrapper).unbind("click"),$(t.wrapper).bind("click",function(){R.operation.pre.heat.set("value",y),$("#usechk_preTemper1").trigger("click"),$("#usechk_preTemper2").trigger("click"),$(t.wrapper).unbind("click")})}}),1<o?R.operation.pre.set("radioCheckedNotEqualed",1<Object.keys(c.radioChecked).length):R.operation.pre.set("radioCheckedNotEqualed",!1),0<p&&0<u&&(R.operation.pre.set("radioChecked",!1),R.operation.pre.cool.set("disabled",!1),R.operation.pre.heat.set("disabled",!1)),console.log(i),console.log(R),0<a.power.checked.true||0<n.power.checked.true||0<r.power.checked.true||0<d.checked.true?t.tab.setActiveTab(0):0<s.power.checked.true||0<s.checked.true||0<l.aoav.checked.true||l.dodv.checked.true?t.tab.setActiveTab(1):0<c.checked.true&&t.tab.setActiveTab(2)},getData:function(){return R._getData()},applyOperationViewModel:function(e,t,i){var o,a,n,r,d=e.algorithm,s=void 0!==e.deviceTypes?e.deviceTypes:[],l=s.length,c={operations:[],temperatures:[],modes:[],configuration:{},aoControlPoint:{},doControlPoint:{},lights:[]};for(o=0;o<l;o++)(n=(a=s[o]).control)&&(n.operations&&((r=n.operations)instanceof N.data.ObservableArray&&(r=r.toJSON()),c.operations=c.operations.concat(r)),n.temperatures&&((r=n.temperatures)instanceof N.data.ObservableArray&&(r=r.toJSON()),c.temperatures=c.temperatures.concat(r)),n.modes&&((r=n.modes)instanceof N.data.ObservableArray&&(r=r.toJSON()),c.modes=c.modes.concat(r)),n.configuration&&(c.configuration=n.configuration),-1!=a.dms_devices_type.indexOf("AO")&&n.controlPoint&&(c.aoControlPoint=n.controlPoint),-1!=a.dms_devices_type.indexOf("DO")&&n.controlPoint&&(c.doControlPoint=n.controlPoint),n.lights&&(c.lights=n.lights));var p,u,v,m,h,f,g,_,C,E,T=(e.control=c).operations,D=c.temperatures,O=c.modes,I=(e=c.configuration,c.aoControlPoint),A=c.doControlPoint,w=c.lights,b={"AirConditioner.Indoor":"indoor","AirConditioner.Indoor.Room":"indoor","AirConditioner.Indoor.Room.Auto":"indoor","AirConditioner.Indoor.Room.Heat":"indoor","AirConditioner.Indoor.Room.Cool":"indoor","AirConditioner.Indoor.General":"indoor","AirConditioner.Indoor.WaterOutlet":"indoor","AirConditioner.Indoor.DHW":"dhw","AirConditioner.DHW":"dhw","AirConditioner.Indoor.Ventilator":"ventilator",ControlPoint:"point","ControlPoint.AO":"point.aoav","ControlPoint.AV":"point.aoav","ControlPoint.DO":"point.dodv","ControlPoint.DV":"point.dodv",General:"light"},k=R.operation;if(T)for(l=T.length,o=0;o<l;o++)u=b[m=(v=T[o]).id],p=v.power,k[u]&&!k[u].power.get("disabled")&&(p&&(k[u].power.set("checked",p),0<i&&(void 0===t[u].power.checked.true&&(t[u].power.checked.true=0),t[u].power.checked.true++)),"On"==p&&(k[u].power.set("active",p),0<i&&(void 0===t[u].power.active[p]&&(t[u].power.active[p]=0),t[u].power.active[p]++)));if(O)for(l=O.length,o=0;o<l;o++)if(u=b[m=(v=O[o]).id],h=v.mode,k[u]&&(_=k[u].operation),_&&!k[u].power.get("disabled")&&("light"!=u||!k[u].get("disabled")))for(C=(f=_.mode).length,g=0;g<C;g++)f[g].name==h&&(k[u].operation.set("checked",!0),0<i&&(void 0===t[u].operation.checked.true&&(t[u].operation.checked.true=0),t[u].operation.checked.true++),f[g].set("active",!0),void 0!==f[g].setIndoorMinMax&&f[g].setIndoorMinMax(),0<i&&(void 0===t[u].operation[f[g].name].active.true&&(t[u].operation[f[g].name].active.true=0),t[u].operation[f[g].name].active.true++));if(D)for(l=D.length,o=0;o<l;o++)u=b[m=(v=D[o]).id],E=v.desired,k[u]&&!k[u].power.get("disabled")&&(-1!=m.indexOf("Water")?(k[u].waterTemp.set("checked",!0),k[u].waterTemp.set("desired",E),0<i&&(void 0===t[u].waterTemp.checked.true&&(t[u].waterTemp.checked.true=0),t[u].waterTemp.checked.true++,void 0===t[u].waterTemp.desired[E]&&(t[u].waterTemp.desired[E]=0),t[u].waterTemp.desired[E]++)):(k[u].temperature.set("checked",!0),k[u].temperature.set("desired",E),0<i&&(void 0===t[u].temperature.checked.true&&(t[u].temperature.checked.true=0),t[u].temperature.checked.true++,void 0===t[u].temperature.desired[E]&&(t[u].temperature.desired[E]=0),t[u].temperature.desired[E]++)));if(I&&null!==I.value&&void 0!==I.value&&(k.point.aoav.get("disabled")||(k.point.aoav.set("checked",!0),k.point.aoav.set("value",Number(I.value)),void 0===t.point.aoav.checked.true&&(t.point.aoav.checked.true=0),t.point.aoav.checked.true++,void 0===t.point.aoav.value[Number(I.value)]&&(t.point.aoav.value[Number(I.value)]=0),t.point.aoav.value[Number(I.value)]++)),A&&null!==A.value&&void 0!==A.value&&!k.point.dodv.get("disabled")){k.point.dodv.set("checked",!0);var y=1==A.value;k.point.dodv.set("active",y),void 0===t.point.dodv.checked.true&&(t.point.dodv.checked.true=0),t.point.dodv.checked.true++,void 0===t.point.dodv.active[y]&&(t.point.dodv.active[y]=0),t.point.dodv.active[y]++}if(w&&0<w.length&&(w=w[0],k.light.get("disabled")||(k.light.set("checked",!0),k.light.set("value",w.dimmingLevel),void 0===t.light.checked.true&&(t.light.checked.true=0),t.light.checked.true++,void 0===t.light.value[w.dimmingLevel]&&(t.light.value[w.dimmingLevel]=0),t.light.value[w.dimmingLevel]++)),e&&e.remoteControl&&(c=e.remoteControl,!k.remoteControl.get("disabled")))for(k.remoteControl.set("checked",!0),l=k.remoteControl.control.length,void 0===t.remoteControl.checked.true&&(t.remoteControl.checked.true=0),t.remoteControl.checked.true++,o=0;o<l;o++)if(c==k.remoteControl.control[o].name){k.remoteControl.set("checked",!0),k.remoteControl.control[o].set("active",!0),void 0===t.remoteControl.control[o].active.true&&(t.remoteControl.control[o].active.true=0),t.remoteControl.control[o].active.true++;break}d&&!k.pre.get("disabled")&&(d.enabled&&(k.pre.set("checked",!0),void 0===t.pre.checked.true&&(t.pre.checked.true=0),t.pre.checked.true++),"PreCooling"==d.mode?(k.pre.cool.set("value",d.preCoolingTemperature),k.pre.cool.set("disabled",!1),void 0===t.pre.cool[d.preCoolingTemperature]&&(t.pre.cool[d.preCoolingTemperature]=0),t.pre.cool[d.preCoolingTemperature]++):"PreHeating"==d.mode&&(k.pre.heat.set("value",d.preHeatingTemperature),k.pre.heat.set("disabled",!1),void 0===t.pre.heat[d.preHeatingTemperature]&&(t.pre.heat[d.preHeatingTemperature]=0),t.pre.heat[d.preHeatingTemperature]++),k.pre.set("radioChecked",d.mode),void 0===t.pre.radioChecked[d.mode]&&(t.pre.radioChecked[d.mode]=0),t.pre.radioChecked[d.mode]++)}},timeSettingList:{widget:null,init:function(){this.widget=$("#schedule-time-list").kendoGrid(this.gridOptions).data("kendoGrid"),this.widget.setDataSource(this.getGridDataSource([])),this.attachGridResizeEvt(),this.attachGridCheckedEvt(),this.attachUserNewInputEvt()},checkedData:[],userNewInputMap:{repeatDate:{},operation:{}},setData:function(e){var s=[];e.forEach(function(e){var i=e.id,o=e.daysOfWeek,a=e.deviceTypes,n=e.algorithm,r=p();r._applyData(o);var d=F();d._applyData({deviceTypes:a,algorithm:n}),void 0===i&&(e.id=O.util.generateConfigurationId(e.executionTimes,e.daysOfWeek),i=e.id),e.executionTimes.forEach(function(e){var t={parentId:i,daysOfWeek:o,deviceTypes:a,executionTime:e,repeatDateViewModel:r,operationViewModel:d};void 0!==n&&(t.algorithm=n),s.push(t)})}),this.widget.setDataSource(this.getGridDataSource(s)),this.set("checkedData",[])},getGridDataSource:function(e){e.sort(function(e,t){var i=e.executionTime.toUpperCase(),o=t.executionTime.toUpperCase();return i<o?-1:o<i?1:0});var t=new N.data.DataSource({data:e,model:{id:"id",fields:{executionTime:{from:"executionTime",type:"string"},operation:{from:"operation",type:"string"},daysOfWeek:{from:"daysOfWeek",type:"string"}}}});return t.read(),t},gridOptions:{resizable:!0,scrollable:!0,sortable:!1,filterable:!1,pageable:!1,hasCheckedModel:!0,showGridHeader:!1,noRecords:{template:"<div class='no-records-text'>"+T.prop("FACILITY_SCHEDULE_CREATE_TIME_SETTING_LIST_EMPTY_MSG")+"</div>"},columns:[{field:"timeSetting",template:function(e){var t,i=e.executionTime,o="";return i=(i=i.split(":"))[0]+":"+i[1],t=a.operationListTemplate(e),e.daysOfWeek.forEach(function(e,t){0==!t&&(o+=", "),e=T.prop("FACILITY_SCHEDULE_"+e.toUpperCase()),o+=e}),'<div class="timesetting-item-wrapper"><div class="time-and-operation-wrapper"><span class="time">'+i+'</span><span class="operation">'+t+'</span></div><div class="repeat-date-wrapper"><span class="repeat-date">'+(o=o.toUpperCase())+"</span></div></div>"}}],dataSource:[]},attachGridResizeEvt:function(){var e=this;$(window).resize(function(){e.widget.resize()})},attachGridCheckedEvt:function(){this.widget.bind("checked",this.handleGridCheckedEvt.bind(this))},attachUserNewInputEvt:function(){var o=this;v.bind("change",function(e){var t=null,i=o.userNewInputMap.get("repeatDate");e.field&&(t=v.get(e.field)),i[e.field]=t}),R.bind("change",function(e){var t=null,i=o.userNewInputMap.get("operation");e.field&&(t=R.get(e.field)),i[e.field]=t})},handleGridCheckedEvt:function(){var e=this,t=e.widget.getCheckedData();e.widget.wrapper.find("tr").removeClass("checked-row"),t.forEach(function(e){$('tr[data-uid="'+e.uid+'"]').eq(0).addClass("checked-row")}),e.set("checkedData",[]),e.set("checkedData",t),e.deleteButton.set("disabled",0==t.length),e.userNewInputMap.set("repeatDate",{}),e.userNewInputMap.set("operation",{})},getNewConfigurationsAfterDelete:function(i,o){var e=O.dataFields.timeAndOperationSettings.get("value"),a=[];return e.forEach(function(e){if(-1==i.indexOf(e.id))a.push(e);else{var t=[];e.executionTimes.forEach(function(e){-1==o.indexOf(e)&&t.push(e)}),0!==t.length&&(e.executionTimes=t,a.push(e))}}),a},deleteButton:{text:T.prop("COMMON_BTN_DELETE"),click:function(e){c.message(T.prop("FACILITY_SCHEDULE_CREATE_TIMELIST_DELETE_CONFIRM_MSG")),c.setConfirmActions({yes:function(){var e=this.dataFields.timeAndOperationSettings,t=e.timeSettingList,i=t.widget.getCheckedData(),o=[],a=[];i.forEach(function(e){o.push(e.parentId)}),i.forEach(function(e){a.push(e.executionTime)});var n=t.getNewConfigurationsAfterDelete(o,a);e.set("value",n),t.set("checkedData",[]),t.deleteButton.set("disabled",!0)}.bind(this)}),c.open()},disabled:!0}}},exceptionDayList:{widget:null,init:function(){this.widget=$("#schedule-exception-day-list").kendoExceptionDayList(this.options).data("kendoExceptionDayList"),this.widget.setDataSource(new N.data.DataSource({data:[]})),this.widget.bind("onSave",this.saveHandler.bind(this)),this.widget.bind("onEdit",this.editHandler.bind(this)),this.widget.bind("onDelete",this.deleteHandler.bind(this)),this.widget.bind("onClose",this.closeHandler.bind(this))},value:[],setData:function(e){var t;void 0===e&&(e=[]),e&&0<e.length&&e.forEach(function(e){e.id=e.name}),t=new N.data.DataSource({data:e}),this.widget.setDataSource(t)},options:{isRepeat:!1,resizable:!1,duplicateDateInspection:!0},saveHandler:function(e){var t=e.result,i=this.get("value");t.id=t.name,void 0!==t.repeat&&delete t.repeat,i.push(t),this.set("value",i)},editHandler:function(e){var t=e.result,i=this.get("value"),o=[];i.forEach(function(e){e.id==t.id&&(t.name?t.id=t.name:t.name=t.id,e=t),o.push(e)}),this.set("value",[]),this.set("value",o)},deleteHandler:function(e){var t=this.get("value"),i=[],o=[];e.forEach(function(e){i.push(e.name)}),t.forEach(function(e){-1===i.indexOf(e.id)&&o.push(e)}),this.set("value",[]),this.set("value",o)},closeHandler:function(e){console.log(e)}},description:{validator:null,init:function(){this.validator=$($("#schedule-description").parent()).data("kendoCommonValidator"),this.validator.bind("validateInput",function(e){O.actions[E].set("disabled",!e.valid)}),this.validator.setOptions({messages:{maxLength:function(){return T.prop("COMMON_CANNOT_INPUT_MAX_MORE",300)}},rules:{maxLength:function(e){return e.val().trim().length<=300}}})},value:""}},util:{generateConfigurationId:function(e,t){var i="";return e.forEach(function(e){i+=e}),t.forEach(function(e){i+=e}),i}}});O.bind("change",function(e){console.log("MainViewModel::Change");var t=this.dataFields.scheduleName,i=this.dataFields.description,o=t.validator,a=i.validator;if(-1==e.field.indexOf("actions")){var n=null!==o&&null!==i.validator&&(o.validate()&&a.validate());if("dataFields.scheduleName.value"==e.field&&(O.actions[E].set("disabled",!n),""==O.dataFields.scheduleName.value&&O.actions[E].set("disabled",!0)),"dataFields.description.value"==e.field&&O.actions[E].set("disabled",!n),"dataFields.devices.value"==e.field){var r=this.dataFields.devices.getSelectedNumText();this.dataFields.devices.set("selectedNumText",r)}if(-1!=e.field.indexOf("dataFields.period")){var d=this.dataFields.period.startDatePicker.widget,s=this.dataFields.period.endDatePicker.widget,l=(f=this.dataFields.period.get("value")).startDate,c=f.endDate;if("dataFields.period.value"==e.field)2099===("object"==typeof c?c.getFullYear():Number(c.split("-")[0]))?(this.dataFields.period.set("checked","indefinitePeriod"),d.value(new Date),s.value(C(new Date).add(1,"M").toDate()),d.enable(!1),s.enable(!1)):(d.value(new Date(l)),s.value(new Date(c)),this.dataFields.period.set("checked","definitePeriod"),d.enable(!0),s.enable(!0));if("dataFields.period.checked"==e.field)"indefinitePeriod"==this.dataFields.period.checked?(this.dataFields.period.value.set("startDate",new Date),this.dataFields.period.value.set("endDate","2099-12-31")):(this.dataFields.period.value.set("startDate",C(d.value()).format("YYYY-MM-DD")),this.dataFields.period.value.set("endDate",C(s.value()).format("YYYY-MM-DD")))}if(-1!=e.field.indexOf("dataFields.timeAndOperationSettings")){var p=this.dataFields.timeAndOperationSettings,u=p.oneDayTimePicker,v=p.repeatDate,m=p.operationSettings,h=p.timeSettingList,f=p.get("value");if(-1!=e.field.indexOf("dataFields.timeAndOperationSettings.value")&&(h.setData(f),h.deleteButton.set("disabled",!0),m.tab.activeTabInit()),-1!=e.field.indexOf("dataFields.timeAndOperationSettings.timeSettingList.checkedData")){var g=h.get("checkedData");if("itemchange"==e.action)return;console.log("checkedData"),console.log(g),u.setData(g),v.setData(g),m.setData(g)}}if(-1!=e.field.indexOf("dataFields.exceptionDayList.value")){var _=this.dataFields.exceptionDayList;f=_.get("value");_.setData(f)}}});var p=function(){return N.observable({init:function(){var t=this.get("daysOfWeek"),i=this.get("daysOfWeekDisabled"),o=this.get("daysOfWeekNotEqualed");["mon","tue","wed","thu","fri","sat","sun"].forEach(function(e){t[e]=!1,i[e]=!1,o[e]=!1}),this.set("daysOfWeek",t),this.set("daysOfWeekDisabled",i),this.set("daysOfWeekNotEqualed",o)},all:{checked:!1,checkedNotEqualed:!1,disabled:!1,changeHandler:function(e){this.all.checked?this.checkAll():this.unCheckAll()}},daysOfWeek:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},daysOfWeekDisabled:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},daysOfWeekNotEqualed:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},daysOfWeekChangeHandler:function(e){var t=this,i=!0,o=!1,a=["mon","tue","wed","thu","fri","sat","sun"];if(e){var n=e.target,r=n.id,d=$(n).prop("checked");t.daysOfWeekNotEqualed.get(r)&&(d||t.daysOfWeek.set(r,!0),t.daysOfWeekNotEqualed.set(r,!1))}a.forEach(function(e){t.daysOfWeekNotEqualed[e]&&(o=!0)}),i&&o&&this.set("all.checkedNotEqualed",!0),i&&!o&&this.set("all.checkedNotEqualed",!1),a.forEach(function(e){t.daysOfWeek[e]||(i=!1)}),this.set("all.checked",i),R.operation.confirm.clear.setEnabled(),O.dataFields.timeAndOperationSettings.repeatDate._renderTemplate()},checkAll:function(){this._setAllChekced(!0),O.dataFields.timeAndOperationSettings.repeatDate._renderTemplate(),R.operation.confirm.clear.setEnabled()},unCheckAll:function(){this._setAllChekced(!1),O.dataFields.timeAndOperationSettings.repeatDate._renderTemplate(),R.operation.confirm.clear.setEnabled()},_setAllChekced:function(t){var e=this,i=e.get("all.checkedNotEqualed"),o=e.get("daysOfWeek"),a=e.get("daysOfWeekNotEqualed"),n=["mon","tue","wed","thu","fri","sat","sun"];i&&!t&&(e.set("all.checked",!0),t=!0),e.set("all.checkedNotEqualed",!1),n.forEach(function(e){a.set(e,!1)}),e.set("daysOfWeekNotEqualed",a),n.forEach(function(e){o.set(e,!1),o.set(e,t)}),e.set("daysOfWeek",o)},_applyData:function(e){var t=this;e.forEach(function(e){t.daysOfWeek.set(e.toLowerCase(),!0)})},_getData:function(){var t=this.get("daysOfWeek"),i=[];return["sun","mon","tue","wed","thu","fri","sat"].forEach(function(e){t[e]&&i.push(e[0].toUpperCase()+e.slice(1))}),i}})},v=p(),m="Fahrenheit"==n,h=m?u.getFahrenheit(24):24,f=m?64:18,g=m?86:30,_=m?u.getFahrenheit(24):24,I=m?59:15,A=m?176:80,w=m?u.getFahrenheit(40):40,b=m?u.getFahrenheit(5):5,k=m?u.getFahrenheit(85):85,y=m?u.getFahrenheit(24):24,L=m?u.getFahrenheit(16):16,S=m?u.getFahrenheit(16):18,x=m?u.getFahrenheit(30):30,M={INDOOR_DESIRED:h,INDOOR_MIN:f,INDOOR_MAX:g,INDOOR_WATER_DESIRED:_,INDOOR_WATER_MIN:I,INDOOR_WATER_MAX:A,DHW_DESIRED:w,DHW_MIN:b,DHW_MAX:k,PRE_DESIRED:y,PRE_HEATING_MIN:L,PRE_COOLING_MIN:S,PRE_MAX:x},F=function(){return N.observable({operation:{indoor:{init:function(){var e=this;e.power.set("disabled",!1),e.power.set("checkedNotEqualed",!1),e.power.set("checked",!1),e.power.set("activeNotEqualed",!1),e.power.set("active",!1),e.operation.set("checkedNotEqualed",!1),e.operation.set("checked",!1),e.operation.set("active",!1);var t,i,o=e.operation.mode,a=o.length;for(t=0;t<a;t++)o[t].set("active",!1);e.temperature.set("checkedNotEqualed",!1),e.temperature.set("checked",!1),e.temperature.set("desired",h),e.temperature.set("unit",s),e.temperature.set("step",l),e.waterTemp.set("checkedNotEqualed",!1),e.waterTemp.set("checked",!1),e.waterTemp.set("desired",_),e.waterTemp.set("unit",s),e.waterTemp.set("step",l);var n=e.power.beforeValue;for(i in n)n[i]=null;var r=$("#indoor-temp").data("kendoCustomNumericBox"),d=$("#indoor-water-temp").data("kendoCustomNumericBox");void 0!==r&&void 0!==d&&($(r.wrapper).unbind("click"),$(d.wrapper).unbind("click"))},setDisabled:function(){this.init(),this.power.set("disabled",!0)},power:{disabled:!1,checked:!1,active:!1,text:function(){return P.call(this)},click:function(){var e=this.operation.indoor,t=e.power.get("active");e.power.set("active",!t)},beforeValue:{powerActive:null,operationChecked:null,auto:null,cool:null,heat:null,dry:null,fan:null,coolSt:null,hotWater:null,waterChecked:null,temperChecked:null},checkClick:function(e){var t=this.operation.indoor,i=t.power.beforeValue;if($(e.target).prop("checked")){null!==i.powerActive?(t.power.set("active",i.powerActive),i.powerActive=null):t.power.set("active",!0),null!==i.operationChecked?(t.operation.set("checked",i.operationChecked),i.operationChecked=null):t.operation.set("checked",!0);var o=!1;null!==i.auto&&(t.operation.mode[0].set("active",i.auto),o=!0,i.auto=null),null!==i.cool&&(t.operation.mode[1].set("active",i.cool),o=!0,i.cool=null),null!==i.heat&&(t.operation.mode[2].set("active",i.heat),o=!0,i.heat=null),null!==i.dry&&(t.operation.mode[3].set("active",i.dry),o=!0,i.dry=null),null!==i.fan&&(t.operation.mode[4].set("active",i.fan),o=!0,i.fan=null),null!==i.coolSt&&(t.operation.mode[5].set("active",i.coolSt),o=!0,i.coolSt=null),null!==i.hotWater&&(t.operation.mode[6].set("active",i.hotWater),o=!0,i.hotWater=null),o||t.operation.mode[0].set("active",!0),null!==i.temperChecked?(t.temperature.set("checkedNotEqualed",!1),t.temperature.set("checked",i.temperChecked),i.temperChecked=null):t.temperature.set("checked",!0),null!==i.waterChecked?(t.waterTemp.set("checkedNotEqualed",!1),t.waterTemp.set("checked",i.waterChecked),i.waterChecked=null):t.waterTemp.set("checked",!0)}else i.powerActive=t.power.get("active"),t.power.get("active")&&t.power.set("active",!1),i.operationChecked=t.operation.get("checked"),i.auto=t.operation.mode[0].get("active"),i.cool=t.operation.mode[1].get("active"),i.heat=t.operation.mode[2].get("active"),i.dry=t.operation.mode[3].get("active"),i.fan=t.operation.mode[4].get("active"),i.coolSt=t.operation.mode[5].get("active"),i.hotWater=t.operation.mode[6].get("active"),t.operation.get("checked")&&(t.operation.set("checkedNotEqualed",!1),t.operation.set("checked",!1),t.operation.mode[0].set("active",!1),t.operation.mode[1].set("active",!1),t.operation.mode[2].set("active",!1),t.operation.mode[4].set("active",!1),t.operation.mode[5].set("active",!1),t.operation.mode[6].set("active",!1)),i.temperChecked=t.temperature.get("checked"),t.temperature.get("checked")&&(t.temperature.set("checkedNotEqualed",!1),t.temperature.set("checked",!1)),i.waterChecked=t.waterTemp.get("checked"),t.waterTemp.get("checked")&&(t.waterTemp.set("checkedNotEqualed",!1),t.waterTemp.set("checked",!1))}},operation:{checked:!1,active:!1,checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.indoor,o=i.power.beforeValue,a=i.operation.mode;t?(null!==o.auto&&(i.operation.mode[0].set("active",o.auto),o.auto=null),null!==o.cool&&(i.operation.mode[1].set("active",o.cool),o.cool=null),null!==o.heat&&(i.operation.mode[2].set("active",o.heat),o.heat=null),null!==o.dry&&(i.operation.mode[3].set("active",o.dry),o.dry=null),null!==o.fan&&(i.operation.mode[4].set("active",o.fan),o.fan=null),null!==o.coolSt&&(i.operation.mode[5].set("active",o.coolSt),o.coolSt=null),null!==o.hotWater&&(i.operation.mode[6].set("active",o.hotWater),o.hotWater=null)):(o.auto=a[0].get("active"),o.cool=a[1].get("active"),o.heat=a[2].get("active"),o.dry=a[3].get("active"),o.fan=a[4].get("active"),o.coolSt=a[5].get("active"),o.hotWater=a[6].get("active"),a[0].get("active")&&a[0].set("active",!1),a[1].get("active")&&a[1].set("active",!1),a[2].get("active")&&a[2].set("active",!1),a[3].get("active")&&a[3].set("active",!1),a[4].get("active")&&a[4].set("active",!1),a[5].get("active")&&a[5].set("active",!1),a[6].get("active")&&a[6].set("active",!1),i.temperature.get("checked")&&i.temperature.set("checked",!1),i.waterTemp.get("checked")&&i.waterTemp.set("checked",!1))},mode:[{active:!1,name:"Auto",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[0].get("active");t[0].set("active",!i),t[1].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),t[4].set("active",!1),t[5].set("active",!1),t[6].set("active",!1),e.checkTempActive(i),i||t[0].setIndoorMinMax()},setIndoorMinMax:function(){var e=this.parent().parent().parent().parent().indoor,t=m?64:18,i=m?86:30;e.temperature.set("min",t),e.temperature.set("max",i),t=m?59:15,i=m?176:80,e.waterTemp.set("min",t),e.waterTemp.set("max",i)}},{active:!1,name:"Cool",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[1].get("active");t[1].set("active",!i),t[0].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),t[4].set("active",!1),t[5].set("active",!1),t[6].set("active",!1),e.checkTempActive(i),i||t[1].setIndoorMinMax()},setIndoorMinMax:function(){var e=this.parent().parent().parent().parent().indoor,t=m?64:18,i=m?86:30;e.temperature.set("min",t),e.temperature.set("max",i),t=m?14:-10,i=m?77:25,e.waterTemp.set("min",t),e.waterTemp.set("max",i)}},{active:!1,name:"Heat",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[2].get("active");t[2].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[3].set("active",!1),t[4].set("active",!1),t[5].set("active",!1),t[6].set("active",!1),e.checkTempActive(i),i||t[2].setIndoorMinMax()},setIndoorMinMax:function(){var e=this.parent().parent().parent().parent().indoor,t=m?61:16,i=m?86:30;e.temperature.set("min",t),e.temperature.set("max",i),t=m?59:15,i=m?176:80,e.waterTemp.set("min",t),e.waterTemp.set("max",i)}},{active:!1,name:"Dry",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[3].get("active");t[3].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[2].set("active",!1),t[4].set("active",!1),t[5].set("active",!1),t[6].set("active",!1),e.checkTempActive(i),i||t[3].setIndoorMinMax()},setIndoorMinMax:function(){var e=this.parent().parent().parent().parent().indoor,t=m?64:18,i=m?86:30;e.temperature.set("min",t),e.temperature.set("max",i),t=m?59:15,i=m?176:80,e.waterTemp.set("min",t),e.waterTemp.set("max",i)}},{active:!1,name:"Fan",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[4].get("active");t[4].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),t[5].set("active",!1),t[6].set("active",!1),e.checkTempActive(!i)}},{active:!1,name:"CoolStorage",click:function(){var e=this.operation.indoor,t=this.operation.indoor.operation.mode,i=t[5].get("active");t[5].set("active",!i),t[0].set("active",!1),t[2].set("active",!1),t[1].set("active",!1),t[3].set("active",!1),t[4].set("active",!1),t[6].set("active",!1),e.checkTempActive(i),i||t[5].setIndoorMinMax()},setIndoorMinMax:function(){var e=this.parent().parent().parent().parent().indoor,t=m?64:18,i=m?86:30;e.temperature.set("min",t),e.temperature.set("max",i),t=m?14:-10,i=m?77:25,e.waterTemp.set("min",t),e.waterTemp.set("max",i)}},{active:!1,name:"HeatStorage",click:function(){var e=this.operation.indoor,t=e.operation.mode,i=t[6].get("active");t[6].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),t[4].set("active",!1),t[5].set("active",!1),e.checkTempActive(i),i||t[6].setIndoorMinMax()},setIndoorMinMax:function(){var e=this.parent().parent().parent().parent().indoor,t=m?64:18,i=m?86:30;e.temperature.set("min",t),e.temperature.set("max",i),t=m?59:15,i=m?176:80,e.waterTemp.set("min",t),e.waterTemp.set("max",i)}}]},checkTempActive:function(e){var t=this;t.temperature.set("checkedNotEqualed",!1),t.waterTemp.set("checkedNotEqualed",!1),e&&(t.temperature.get("checked")&&t.temperature.set("checked",!1),t.waterTemp.get("checked")&&t.waterTemp.set("checked",!1))},temperature:{checked:!1,desired:h,min:f,max:g,unit:s,step:l},waterTemp:{checked:!1,desired:h,min:I,max:A,unit:s,step:l}},ventilator:{init:function(){var e,t=this;t.power.set("disabled",!1),t.power.set("checkedNotEqualed",!1),t.power.set("checked",!1),t.power.set("activeNotEqualed",!1),t.power.set("active",!1),t.operation.set("checkedNotEqualed",!1),t.operation.set("checked",!1),t.operation.mode[0].set("active",!1),t.operation.mode[1].set("active",!1),t.operation.mode[2].set("active",!1),t.operation.mode[3].set("active",!1);var i=t.power.beforeValue;for(e in i)i[e]=null},setDisabled:function(){this.init(),this.power.set("disabled",!0)},power:{disabled:!1,checked:!1,active:!1,text:function(){return P.call(this)},click:function(){var e=this.operation.ventilator.power.get("active");this.operation.ventilator.power.set("active",!e)},beforeValue:{powerActive:null,operationChecked:null,auto:null,heatex:null,bypass:null,sleep:null},checkClick:function(e){var t=this.operation.ventilator,i=t.power.beforeValue;if($(e.target).prop("checked")){null!==i.powerActive?(t.power.set("active",i.powerActive),i.powerActive=null):t.power.set("active",!0),null!==i.operationChecked?(t.operation.set("checked",i.operationChecked),i.operationChecked=null):t.operation.set("checked",!0);var o=!1;null!==i.auto&&(t.operation.mode[0].set("active",i.auto),o=!0,i.auto=null),null!==i.heatex&&(t.operation.mode[1].set("active",i.heatex),o=!0,i.heatex=null),null!==i.bypass&&(t.operation.mode[2].set("active",i.bypass),o=!0,i.bypass=null),null!==i.sleep&&(t.operation.mode[3].set("active",i.sleep),o=!0,i.sleep=null),o||t.operation.mode[0].set("active",!0)}else i.powerActive=t.power.get("active"),t.power.get("active")&&t.power.set("active",!1),i.operationChecked=t.operation.get("checked"),i.auto=t.operation.mode[0].get("active"),i.heatex=t.operation.mode[1].get("active"),i.bypass=t.operation.mode[2].get("active"),i.sleep=t.operation.mode[3].get("active"),t.operation.get("checked")&&(t.operation.set("checkedNotEqualed",!1),t.operation.set("checked",!1),t.operation.mode[0].set("active",!1),t.operation.mode[1].set("active",!1),t.operation.mode[2].set("active",!1),t.operation.mode[3].set("active",!1))}},operation:{active:!1,checked:!1,checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.ventilator,o=i.power.beforeValue;if(t)null!==o.auto&&(i.operation.mode[0].set("active",o.auto),o.auto=null),null!==o.heatex&&(i.operation.mode[1].set("active",o.heatex),o.heatex=null),null!==o.bypass&&(i.operation.mode[2].set("active",o.bypass),o.bypass=null),null!==o.sleep&&(i.operation.mode[3].set("active",o.sleep),o.sleep=null);else{var a=i.operation.mode;o.auto=a[0].get("active"),o.heatex=a[1].get("active"),o.bypass=a[2].get("active"),o.sleep=a[3].get("active"),a[0].get("active")&&a[0].set("active",!1),a[1].get("active")&&a[1].set("active",!1),a[2].get("active")&&a[2].set("active",!1),a[3].get("active")&&a[3].set("active",!1)}},mode:[{active:!1,name:"Auto",click:function(){var e=this.operation.ventilator.operation.mode,t=e[0].get("active");e[0].set("active",!t),e[1].set("active",!1),e[2].set("active",!1),e[3].set("active",!1)}},{active:!1,name:"HeatEx",click:function(){var e=this.operation.ventilator.operation.mode,t=e[1].get("active");e[1].set("active",!t),e[0].set("active",!1),e[2].set("active",!1),e[3].set("active",!1)}},{active:!1,name:"Bypass",click:function(){var e=this.operation.ventilator.operation.mode,t=e[2].get("active");e[2].set("active",!t),e[0].set("active",!1),e[1].set("active",!1),e[3].set("active",!1)}},{active:!1,name:"Sleep",click:function(){var e=this.operation.ventilator.operation.mode,t=e[3].get("active");e[3].set("active",!t),e[0].set("active",!1),e[1].set("active",!1),e[2].set("active",!1)}}]}},dhw:{init:function(){var e,t=this;t.power.set("disabled",!1),t.power.set("checkedNotEqualed",!1),t.power.set("checked",!1),t.power.set("active",!1),t.operation.set("checkedNotEqualed",!1),t.operation.set("checked",!1),t.operation.mode[0].set("active",!1),t.operation.mode[1].set("active",!1),t.operation.mode[2].set("active",!1),t.operation.mode[3].set("active",!1),t.temperature.set("checkedNotEqualed",!1),t.temperature.set("checked",!1),t.temperature.set("desired",w),t.temperature.set("unit",s),t.temperature.set("step",l);var i=t.power.beforeValue;for(e in i)i[e]=null;var o=$("#dhw-temp").data("kendoCustomNumericBox");void 0!==o&&$(o.wrapper).unbind("click")},setDisabled:function(){this.init(),this.power.set("disabled",!0)},power:{disabled:!1,checked:!1,active:!1,text:function(){return P.call(this)},click:function(){var e=this.operation.dhw.power.get("active");this.operation.dhw.power.set("active",!e)},beforeValue:{powerActive:null,operationChecked:null,eco:null,standard:null,power:null,force:null,temperChecked:null},checkClick:function(e){var t=this.operation.dhw,i=t.power.beforeValue;if($(e.target).prop("checked")){null!==i.powerActive?(t.power.set("active",i.powerActive),i.powerActive=null):t.power.set("active",!0),null!==i.operationChecked?(t.operation.set("checked",i.operationChecked),i.operationChecked=null):t.operation.set("checked",!0);var o=!1;null!==i.eco&&(t.operation.mode[0].set("active",i.eco),o=!0,i.eco=null),null!==i.standard&&(t.operation.mode[1].set("active",i.standard),o=!0,i.standard=null),null!==i.power&&(t.operation.mode[2].set("active",i.power),o=!0,i.power=null),null!==i.force&&(t.operation.mode[3].set("active",i.force),o=!0,i.force=null),o||t.operation.mode[1].set("active",!0),null!==i.temperChecked?(t.temperature.set("checked",i.temperChecked),i.temperChecked=null):t.temperature.set("checked",!0)}else i.powerActive=t.power.get("active"),t.power.get("active")&&t.power.set("active",!1),i.operationChecked=t.operation.get("checked"),i.eco=t.operation.mode[0].get("active"),i.standard=t.operation.mode[1].get("active"),i.power=t.operation.mode[2].get("active"),i.force=t.operation.mode[3].get("active"),t.operation.get("checked")&&(t.operation.set("checkedNotEqualed",!1),t.operation.set("checked",!1),t.operation.mode[0].set("active",!1),t.operation.mode[1].set("active",!1),t.operation.mode[2].set("active",!1),t.operation.mode[3].set("active",!1)),i.temperChecked=t.temperature.get("checked"),t.temperature.get("checked")&&(t.temperature.set("checkedNotEqualed",!1),t.temperature.set("checked",!1))}},operation:{active:!1,checked:!1,checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.dhw,o=i.power.beforeValue;if(t)null!==o.eco&&(i.operation.mode[0].set("active",o.eco),o.eco=null),null!==o.standard&&(i.operation.mode[1].set("active",o.standard),o.standard=null),null!==o.power&&(i.operation.mode[2].set("active",o.power),o.power=null),null!==o.force&&(i.operation.mode[3].set("active",o.force),o.force=null);else{var a=i.operation.mode;o.operationChecked=i.operation.get("checked"),o.eco=i.operation.mode[0].get("active"),o.standard=i.operation.mode[1].get("active"),o.power=i.operation.mode[2].get("active"),o.force=i.operation.mode[3].get("active"),a[0].get("active")&&a[0].set("active",!1),a[1].get("active")&&a[1].set("active",!1),a[2].get("active")&&a[2].set("active",!1),a[3].get("active")&&a[3].set("active",!1),i.temperature.get("checked")&&i.temperature.set("checked",!1)}},mode:[{active:!1,name:"Eco",click:function(){var e=this.operation.dhw,t=e.operation.mode,i=t[0].get("active");t[0].set("active",!i),t[1].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),e.checkTempActive(i)}},{active:!1,name:"Standard",click:function(){var e=this.operation.dhw,t=e.operation.mode,i=t[1].get("active");t[1].set("active",!i),t[0].set("active",!1),t[2].set("active",!1),t[3].set("active",!1),e.checkTempActive(i)}},{active:!1,name:"Power",click:function(){var e=this.operation.dhw,t=e.operation.mode,i=t[2].get("active");t[2].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[3].set("active",!1),e.checkTempActive(i)}},{active:!1,name:"Force",click:function(){var e=this.operation.dhw,t=e.operation.mode,i=t[3].get("active");t[3].set("active",!i),t[0].set("active",!1),t[1].set("active",!1),t[2].set("active",!1),e.checkTempActive(i)}}]},checkTempActive:function(e){e&&this.temperature.get("checked")&&this.temperature.set("checked",!1)},temperature:{checked:!1,desired:w,min:b,max:k,unit:s,step:l}},remoteControl:{disabled:!1,checked:!1,init:function(){var e=this;e.set("disabled",!1),e.set("checkedNotEqualed",!1),e.set("checked",!1),e.control[0].set("active",!1),e.control[1].set("active",!1)},setDisabled:function(){this.init(),this.set("disabled",!0)},checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.remoteControl.control;t?i[0].set("active",!0):i[0].set("active",!1),i[1].set("active",!1)},control:[{active:!1,name:"Allowed",click:function(){var e=this.operation.remoteControl.control,t=e[0].get("active");e[0].set("active",!t),e[1].set("active",!1)}},{active:!1,name:"NotAllowed",click:function(){var e=this.operation.remoteControl.control,t=e[1].get("active");e[1].set("active",!t),e[0].set("active",!1)}}]},point:{aoav:{disable:!1,checked:!1,value:"0.00",min:-999999999.9,max:999999999.9,decimals:2,init:function(){this.set("disabled",!1),this.set("checkedNotEqualed",!1),this.set("checked",!1),this.set("value","0.00")},setDisabled:function(){this.init(),this.set("disabled",!0)}},dodv:{disable:!1,checked:!1,active:!1,beforeValue:{active:null},text:function(){return P.call(this)},click:function(){var e=this.operation.point.dodv,t=e.get("active");e.set("active",!t)},checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.point.dodv,o=i.beforeValue;t?null!==o.active?(i.set("active",o.active),o.active=null):i.set("active",!0):(o.active=i.get("active"),i.get("active")&&i.set("active",!1))},init:function(){var e,t=this;t.set("disabled",!1),t.set("checkedNotEqualed",!1),t.set("checked",!1),t.set("active",!1);var i=t.beforeValue;for(e in i)i[e]=null;var o=$("#point-value").data("kendoCustomNumericBox");void 0!==o&&$(o.wrapper).unbind("click")},setDisabled:function(){this.init(),this.set("disabled",!0)}}},light:{disabled:!1,power:{beforeValue:{active:null},disabled:!1,checked:!1,active:!1,text:function(){return P.call(this)},click:function(){var e=this.operation.light,t=e.power.get("active");e.power.set("active",!t)},checkClick:function(e){var t=$(e.target).prop("checked"),i=this.operation.light,o=i.power.beforeValue;t?null!==o.active?(i.power.set("active",o.active),o.active=null):i.power.set("active",!0):(o.active=i.power.get("active"),i.power.get("active")&&i.power.set("active",!1))}},checked:!1,value:50,slide:function(e){this.operation.light.set("value",e.value)},init:function(){var e,t=this;t.power.set("active",!1),t.power.set("checkedNotEqualed",!1),t.power.set("checked",!1),t.set("checkedNotEqualed",!1),t.set("checked",!1),t.set("disabled",!1),t.set("value",50);var i=t.power.beforeValue;for(e in i)i[e]=null},setDisabled:function(){this.init(),this.set("disabled",!0)}},pre:{disable:!1,checked:!1,init:function(){var e,t=this;t.set("checkedNotEqualed",!1),t.set("checked",!1),t.set("disabled",!1),t.set("radioCheckedNotEqualed",!1),t.set("radioChecked",!1),t.cool.set("value",y),t.cool.set("disabled",!0),t.cool.set("unit",s),t.cool.set("step",l),t.heat.set("value",y),t.heat.set("disabled",!0),t.heat.set("unit",s),t.heat.set("step",l);var i=this.beforeValue;for(e in i)i[e]=null;var o=$("#pre-cool-temp").data("kendoCustomNumericBox"),a=$("#pre-heat-temp").data("kendoCustomNumericBox");void 0!==o&&void 0!==a&&($(o.wrapper).unbind("click"),$(a.wrapper).unbind("click"))},setDisabled:function(){this.init(),this.set("disabled",!0),this.cool.set("disabled",!0),this.heat.set("disabled",!0)},radioChecked:"PreCooling",beforeValue:{radioChecked:null},checkClick:function(e){var t=this.operation.pre,i=t.beforeValue;if(t.get("checked"))i.radioChecked=t.get("radioChecked"),t.set("radioChecked",!1),t.cool.set("disabled",!0),t.heat.set("disabled",!0);else if(null!==i.radioChecked&&void 0!==i.radioChecked){t.set("radioChecked",i.radioChecked);var o="PreCooling"==i.radioChecked;t.cool.set("disabled",!o),t.heat.set("disabled",o),i.radioChecked=null}else t.set("radioChecked","PreCooling"),t.cool.set("disabled",!1),t.heat.set("disabled",!0)},change:function(){var e=this.operation.pre;"PreCooling"==e.get("radioChecked")?(e.cool.set("disabled",!1),e.heat.set("disabled",!0)):"PreHeating"==e.get("radioChecked")&&(e.heat.set("disabled",!1),e.cool.set("disabled",!0))},cool:{disabled:!0,value:y,min:S,max:x,unit:s,step:l},heat:{disabled:!0,value:y,min:L,max:x,unit:s,step:l}},confirm:{ok:{text:T.prop("FACILITY_SCHEDULE_CREATE_OPERATION_SETTING_CONFIRM_OK"),click:function(e){var t,i=O,o=R.operation.confirm,a=i.dataFields.timeAndOperationSettings,n=a.timeSettingList,r=a.oneDayTimePicker,d=a.repeatDate,s=a.operationSettings,l=n.get("checkedData"),c=r.getData(),p=d.getData(),u=s.getData(),v=0==c.length,m=0==p.length,h=0==u.deviceTypes.length&&void 0===u.algorithm,f=[];if(t={id:i.util.generateConfigurationId(c,p),executionTimes:c,daysOfWeek:p,deviceTypes:u.deviceTypes},void 0!==u.algorithm&&(t.algorithm=u.algorithm),console.log(c),console.log(p),console.log(u),l.length<2){if(v||m||h){var g="- ";return v&&(g+=T.prop("COMMON_TIME")+" / "),m&&(g+=T.prop("FACILITY_SCHEDULE_REPEAT_DATE")+" / "),h&&(g+=T.prop("COMMON_OPERATION")+" / "),g=g.substring(0,g.length-3),g=T.prop("FACILITY_SCHEDULE_CREATE_TIME_AND_OPERATION_SETTINGS_NOT_COMPLETED")+"\n"+g,D.message(g),void D.open()}1===l.length?f=n.getNewConfigurationsAfterDelete([l[0].parentId],[l[0].executionTime]):a.get("value").forEach(function(e){f.push(e)}),f.push(t)}else{var _=[],C=[];l.forEach(function(e){_.push(e.parentId)}),l.forEach(function(e){C.push(e.executionTime)}),f=n.getNewConfigurationsAfterDelete(_,C),l.forEach(function(e){console.log(e);var t=o.ok.getUpdatedConfigurationFromMultiSelectedView(e);f.push(t)})}if(o.ok.checkDuplicatedTimeSetting(f)){g=T.prop("FACILITY_SCHEDULE_DUPlICATED_TIME_EXIST");return D.message(g),void D.open()}var E=o.ok.getNoRepeatDateAndOperationTimes(f);if(0<E.length){g="- ";return E.forEach(function(e){var t=e.split(":");g+=t[0]+":"+t[1]+" / "}),g=g.substring(0,g.length-3),g=T.prop("FACILITY_SCHEDULE_CREATE_TIMELIST_NO_REPEAT_OR_OPERATION")+"\n"+g,D.message(g),void D.open()}a.set("value",f),console.log(a.get("value"))},getUpdatedConfigurationFromMultiSelectedView:function(e){var t={},i=O.dataFields.timeAndOperationSettings.timeSettingList.userNewInputMap,o=i.repeatDate,a=i.operation,n=e.repeatDateViewModel,r=e.operationViewModel;console.log(o);function d(t,i){Object.keys(i.toJSON()).forEach(function(e){t.set(e,i[e])})}d(n,o),d(r,a);var s=n._getData(),l=r._getData();return t={id:O.util.generateConfigurationId([e.executionTime],s),executionTimes:[e.executionTime],daysOfWeek:s,deviceTypes:l.deviceTypes},void 0!==l.algorithm&&(t.algorithm=l.algorithm),t},getNoRepeatDateAndOperationTimes:function(e){var t=[];return e.forEach(function(e){void 0===e.deviceTypes&&(e.deviceTypes=[]),(0==e.daysOfWeek.length||0==e.deviceTypes.length&&void 0===e.algorithm)&&e.executionTimes.forEach(function(e){t.push(e)})}),t},checkDuplicatedTimeSetting:function(e){var i={},o=!1;return e.forEach(function(e){e.executionTimes.forEach(function(t){void 0===i[t]&&(i[t]={}),e.daysOfWeek.forEach(function(e){void 0===i[t][e]?i[t][e]={}:void 0!==i[t][e]&&(o=!0)})})}),o},enabled:!0},clear:{text:T.prop("FACILITY_SCHEDULE_CREATE_OPERATION_SETTING_CONFIRM_CLEAR"),click:function(e){R.operation.confirm.clear._clearTeimAndOperationSettings()},_clearTeimAndOperationSettings:function(){var e=O.dataFields.timeAndOperationSettings,t=e.oneDayTimePicker,i=e.repeatDate,o=e.operationSettings;t.setData([]),i.setData([]),o.setData([])},enabled:!1,setEnabled:function(){var e=O.dataFields.timeAndOperationSettings,t=e.oneDayTimePicker,i=e.repeatDate,o=e.operationSettings,a=t.getData(),n=i.getData(),r=o.getData(),d=0==a.length,s=0==n.length,l=0==r.deviceTypes.length&&void 0===r.algorithm;d&&s&&l?R.operation.confirm.clear.set("enabled",!1):R.operation.confirm.clear.set("enabled",!0)}}}},setTempMinMax:function(e,t,i){if(!(t.length<1||i.length<1)){var o,a,n,r,d=t.data("kendoCustomNumericBox"),s=i.data("kendoCustomNumericBox"),l=this.operation.indoor,c=e.field;"operation.indoor.temperature.min"==c?(r=l.temperature.get("checked"),n=l.temperature.get("desired"),o=l.temperature.get("min"),d.min(o),n<o?l.temperature.set("desired",o):r&&(d.enable(!1),d.enable(!0))):"operation.indoor.temperature.max"==c?(r=l.temperature.get("checked"),n=l.temperature.get("desired"),a=l.temperature.get("max"),d.max(a),a<n?l.temperature.set("desired",a):r&&(d.enable(!1),d.enable(!0))):"operation.indoor.waterTemp.min"==c?(r=l.waterTemp.get("checked"),n=l.waterTemp.get("desired"),o=l.waterTemp.get("min"),s.min(o),n<o?l.waterTemp.set("desired",o):r&&(s.enable(!1),s.enable(!0))):"operation.indoor.waterTemp.max"==c&&(r=l.waterTemp.get("checked"),n=l.waterTemp.get("desired"),a=l.waterTemp.get("max"),s.max(a),a<n?l.waterTemp.set("desired",a):r&&(s.enable(!1),s.enable(!0)))}},checkActive:function(){var e=this.operation.indoor,t=e.operation.mode,i=e.operation.checkedNotEqualed,o=e.temperature.checkedNotEqualed,a=e.waterTemp.checkedNotEqualed,n=(s=this.operation.dhw).operation.checkedNotEqualed,r=s.temperature.checkedNotEqualed,d=t[0].get("active")||t[1].get("active")||t[2].get("active")||t[3].get("active")||t[5].get("active")||t[6].get("active")||i||o||a;e.operation.set("active",d);var s,l=(s=this.operation.dhw).operation.mode;d=l[0].get("active")||l[1].get("active")||l[2].get("active")||l[3].get("active")||n||r,s.operation.set("active",d)},init:function(){var e=this.operation;e.indoor.init(),e.ventilator.init(),e.dhw.init(),e.remoteControl.init();var t=e.point;t.aoav.init(),t.dodv.init(),e.light.init(),e.pre.init()},defaultIndoor:function(){var e=this.operation.indoor;e.power.set("checked",!0),e.power.set("active",!0),e.operation.set("checked",!0),e.operation.mode[0].set("active",!0),e.temperature.set("checked",!0),e.temperature.set("desired",h)},defaultVentilator:function(){var e=this.operation.ventilator;e.power.set("checked",!0),e.power.set("active",!0),e.operation.set("checked",!0),e.operation.mode[0].set("active",!0)},defaultDhw:function(){var e=this.operation.dhw;e.power.set("checked",!0),e.power.set("active",!0),e.operation.set("checked",!0),e.operation.mode[1].set("active",!0),e.temperature.set("checked",!0),e.temperature.set("desired",w)},defaultRemoteControl:function(){var e=this.operation.remoteControl;e.set("checked",!0),e.control[0].set("active",!0)},defaultControlPoint:function(){var e=this.operation.point;e.aoav.set("checked",!0),e.aoav.set("value","0.0"),e.dodv.set("checked",!0),e.dodv.set("active",!0)},defaultAoav:function(){var e=this.operation.point;e.aoav.set("checked",!0),e.aoav.set("value","0.0")},defaultDodv:function(){var e=this.operation.point;e.dodv.set("checked",!0),e.dodv.set("active",!0)},defaultLight:function(){var e=this.operation.light;e.power.set("checked",!0),e.power.set("active",!0),e.set("checked",!0),e.set("value",50)},defaultPre:function(){var e=this.operation.pre;e.set("checked",!0),e.set("radioChecked","PreCooling"),e.cool.set("value",y),e.cool.set("disabled",!1)},default:function(e){this.init(),e||(this.defaultIndoor(),this.defaultVentilator(),this.defaultDhw(),this.defaultRemoteControl(),this.defaultControlPoint(),this.defaultLight(),this.defaultPre())},checkDeviceType:function(e,t){var i,o,a,n,r,d,s,l,c,p=e.length;for(a=0;a<p&&(-1!=(i=(o=e[a]).type).indexOf("AirConditioner.")?-1!=(i=u.getIndoorType(o)).indexOf("General")?n=!0:-1!=i.indexOf("Ventilator")?r=!0:-1!=i.indexOf("DHW")&&(d=!0):-1!=i.indexOf("Light")?s=!0:-1!=i.indexOf("AO")||-1!=i.indexOf("AV")?l=!0:-1==i.indexOf("DO")&&-1==i.indexOf("DV")||(c=!0),!(n&&r&&d&&s&&l&&c));a++);n?(this.operation.indoor.init(),this.operation.pre.init(),this.operation.remoteControl.init(),t||(this.defaultIndoor(),this.defaultPre(),this.defaultRemoteControl())):(this.operation.indoor.setDisabled(),this.operation.pre.setDisabled(),this.operation.remoteControl.setDisabled()),r?(this.operation.ventilator.init(),t||this.defaultVentilator()):this.operation.ventilator.setDisabled(),d?(this.operation.dhw.init(),t||this.defaultDhw()):this.operation.dhw.setDisabled(),l?(this.operation.point.aoav.init(),t||this.defaultAoav()):this.operation.point.aoav.setDisabled(),c?(this.operation.point.dodv.init(),t||this.defaultDodv()):this.operation.point.dodv.setDisabled(),s?(this.operation.light.init(),t||this.defaultLight()):this.operation.light.setDisabled()},isValid:function(){var e=!1,t=this.operation,i=t.indoor;if(e=i.power.get("checked"))return e;if(e=i.operation.get("checked")&&(i.operation.mode[0].get("active")||i.operation.mode[1].get("active")||i.operation.mode[2].get("active")||i.operation.mode[3].get("active")||i.operation.mode[4].get("active")||i.operation.mode[5].get("active")||i.operation.mode[6].get("active")))return e;if(e=i.temperature.get("checked"))return e;var o=t.ventilator;if(e=o.power.get("checked"))return e;if(e=o.operation.get("checked")&&(o.operation.mode[0].get("active")||o.operation.mode[1].get("active")||o.operation.mode[2].get("active")||o.operation.mode[3].get("active")))return e;var a=t.dhw;if(e=a.power.get("checked"))return e;if(e=a.operation.get("checked")&&(a.operation.mode[0].get("active")||a.operation.mode[1].get("active")||a.operation.mode[2].get("active")||a.operation.mode[3].get("active")))return e;if(e=a.temperature.get("checked"))return e;var n=t.remoteControl;if(e=n.get("checked")&&(n.control[0].get("active")||n.control[1].get("active")||n.control[2].get("active")))return e;var r=t.point;if(e=r.aoav.get("checked")||this.operation.point.dodv.get("checked"))return e;if(e=r.aoav.get("checked")||this.operation.point.dodv.get("checked"))return e;var d=t.pre;if(e=d.get("checked")&&(!d.cool.get("disabled")||!d.heat.get("disabled")))return e;var s=t.light;return(e=s.power.get("checked")||s.get("checked"))||e},validation:function(){},_applyData:function(e){this.oper;var t,i,o,a,n=e.algorithm,r=void 0!==e.deviceTypes?e.deviceTypes:[],d=r.length,s={operations:[],temperatures:[],modes:[],configuration:{},aoControlPoint:{},doControlPoint:{},lights:[]};for(t=0;t<d;t++)(o=(i=r[t]).control)&&(o.operations&&((a=o.operations)instanceof N.data.ObservableArray&&(a=a.toJSON()),s.operations=s.operations.concat(a)),o.temperatures&&((a=o.temperatures)instanceof N.data.ObservableArray&&(a=a.toJSON()),s.temperatures=s.temperatures.concat(a)),o.modes&&((a=o.modes)instanceof N.data.ObservableArray&&(a=a.toJSON()),s.modes=s.modes.concat(a)),o.configuration&&(s.configuration=o.configuration),-1!=i.dms_devices_type.indexOf("AO")&&o.controlPoint&&(s.aoControlPoint=o.controlPoint),-1!=i.dms_devices_type.indexOf("DO")&&o.controlPoint&&(s.doControlPoint=o.controlPoint),o.lights&&(s.lights=o.lights));var l,c,p,u,v,m,h,f,g,_,C=(e.control=s).operations,E=s.temperatures,T=s.modes,D=s.configuration,O=s.aoControlPoint,I=s.doControlPoint,A=s.lights,w={"AirConditioner.Indoor":"indoor","AirConditioner.Indoor.Room":"indoor","AirConditioner.Indoor.Room.Auto":"indoor","AirConditioner.Indoor.Room.Heat":"indoor","AirConditioner.Indoor.Room.Cool":"indoor","AirConditioner.Indoor.General":"indoor","AirConditioner.Indoor.WaterOutlet":"indoor","AirConditioner.Indoor.DHW":"dhw","AirConditioner.DHW":"dhw","AirConditioner.Indoor.Ventilator":"ventilator",ControlPoint:"point","ControlPoint.AO":"point.aoav","ControlPoint.AV":"point.aoav","ControlPoint.DO":"point.dodv","ControlPoint.DV":"point.dodv",General:"light"},b=this.operation;if(C)for(d=C.length,t=0;t<d;t++)c=w[u=(p=C[t]).id],l=p.power,b[c]&&!b[c].power.get("disabled")&&(l&&b[c].power.set("checked",l),"On"==l&&b[c].power.set("active",l));if(T)for(d=T.length,t=0;t<d;t++)if(c=w[u=(p=T[t]).id],v=p.mode,b[c]&&(f=b[c].operation),f&&!b[c].power.get("disabled")&&("light"!=c||!b[c].get("disabled")))for(g=(m=f.mode).length,h=0;h<g;h++)m[h].name==v&&(b[c].operation.set("checked",!0),m[h].set("active",!0));if(E)for(d=E.length,t=0;t<d;t++)c=w[u=(p=E[t]).id],_=p.desired,b[c]&&!b[c].power.get("disabled")&&(-1!=u.indexOf("Water")?(b[c].waterTemp.set("checked",!0),b[c].waterTemp.set("desired",_)):(b[c].temperature.set("checked",!0),b[c].temperature.set("desired",_)));if(O&&null!==O.value&&void 0!==O.value&&(b.point.aoav.get("disabled")||(b.point.aoav.set("checked",!0),b.point.aoav.set("value",Number(O.value)))),I&&null!==I.value&&void 0!==I.value&&!b.point.dodv.get("disabled")){b.point.dodv.set("checked",!0);var k=1==I.value;b.point.dodv.set("active",k)}if(A&&0<A.length&&(A=A[0],b.light.get("disabled")||(b.light.set("checked",!0),b.light.set("value",A.dimmingLevel))),D&&D.remoteControl&&(s=D.remoteControl,!b.remoteControl.get("disabled")))for(b.remoteControl.set("checked",!0),d=b.remoteControl.control.length,t=0;t<d;t++)if(s==b.remoteControl.control[t].name){b.remoteControl.set("checked",!0),b.remoteControl.control[t].set("active",!0);break}n&&!b.pre.get("disabled")&&(n.enabled&&b.pre.set("checked",!0),"PreCooling"==n.mode?(b.pre.cool.set("value",n.preCoolingTemperature),b.pre.cool.set("disabled",!1)):"PreHeating"==n.mode&&(b.pre.heat.set("value",n.preHeatingTemperature),b.pre.heat.set("disabled",!1)),b.pre.set("radioChecked",n.mode))},_getData:function(){var e={},t={sacIndoor:"AirConditioner.Indoor",indoor:"AirConditioner.Indoor.General",ventilator:"AirConditioner.Indoor.Ventilator",dhw:"AirConditioner.Indoor.DHW",point:"ControlPoint"};e.deviceTypes||(e.deviceTypes=[]),e.control||(e.control={});var i,o,a,n,r={},d=this.operation,s=d.indoor,l=d.ventilator,c=d.dhw,p=d.light,u=[];s.power.checked&&(i={id:t.indoor},s.power.active?i.power="On":i.power="Off",u.push(i)),l.power.checked&&(i={id:t.ventilator},l.power.active?i.power="On":i.power="Off",u.push(i)),c.power.checked&&(i={id:t.dhw},c.power.active?i.power="On":i.power="Off",u.push(i));var v={dms_devices_type:"AirConditioner.Indoor",control:{}};0<u.length&&(v.control.operations=u);var m={dms_devices_type:"Light",control:{}},h=[];p.power.checked&&((i={id:"General"}).power=p.power.active?"On":"Off",h.push(i),m.control.operations=h,u=u.concat(h)),0<u.length?e.control.operations=u:delete e.control.operations;var f,g=[];if(s.operation.checked)for(a=(n=s.operation.mode).length,o=0;o<a;o++)n[o].active&&(i={id:t.indoor,mode:n[o].name},g.push(i));if(l.operation.checked)for(a=(n=l.operation.mode).length,o=0;o<a;o++)n[o].active&&(i={id:t.ventilator,mode:n[o].name},g.push(i));if(c.operation.checked)for(a=(n=c.operation.mode).length,o=0;o<a;o++)n[o].active&&(i={id:t.dhw,mode:n[o].name},g.push(i));0<g.length?(e.control.modes=g,v.control.modes=g):delete e.control.modes;var _,C=[];s.temperature.checked&&(f=s.temperature,i={id:t.indoor.replace(".General",".Room"),desired:f.get("desired")},C.push(i)),s.waterTemp.checked&&(_=s.waterTemp,i={id:t.indoor.replace(".General",".WaterOutlet"),desired:_.get("desired")},C.push(i)),c.temperature.checked&&(f=c.temperature,i={id:t.dhw,desired:f.get("desired")},C.push(i)),0<C.length?(e.control.temperatures=C,v.control.temperatures=C):delete e.control.temperatures;var E={};if(d.remoteControl.checked)for(a=(r=d.remoteControl.control).length,o=0;o<a;o++)r[o].active&&(E={remoteControl:r[o].name});$.isEmptyObject(E)?delete e.control.configuration:(e.control.configuration=E,v.control.configuration=E);var T,D={dms_devices_type:"ControlPoint.AO",control:{}},O={dms_devices_type:"ControlPoint.DO",control:{}},I={};d.point.aoav.checked&&("number"==typeof(T=d.point.aoav.get("value"))&&(T=T.toString()),I.value=T,D.control.controlPoint=I);var A={};d.point.dodv.checked&&("number"==typeof(T=d.point.dodv.get("active")?1:0)&&(T=T.toString()),A.value=T,O.control.controlPoint=A),$.isEmptyObject(I)?delete e.control.aoControlPoint:e.control.aoControlPoint=I,$.isEmptyObject(A)?delete e.control.doControlPoint:e.control.doControlPoint=A;var w=[];d.light.checked?(T=d.light.get("value"),w.push({id:1,dimmingLevel:T}),e.control.lights=w,m.control.lights=w):delete e.control.lights;var b=d.pre.cool.get("disabled")&&d.pre.heat.get("disabled");if(d.pre.checked&&!b){e.algorithm||(e.algorithm={}),e.algorithm.enabled=!0;var k=d.pre.get("radioChecked");"PreCooling"==k?(e.algorithm.mode=k,T=d.pre.cool.get("value"),e.algorithm.preCoolingTemperature=T):"PreHeating"==k&&(e.algorithm.mode=k,T=d.pre.heat.get("value"),e.algorithm.preHeatingTemperature=T)}else e.algorithm&&e.algorithm.mode?e.algorithm=null:null!==e.algorithm&&delete e.algorithm;var y,N=e.deviceTypes;if(a=N.length,$.isEmptyObject(v.control))for(o=a-1;0<=o;o--)-1!=N[o].dms_devices_type.indexOf("AirConditioner.Indoor")&&N.splice(o,1);else{for(y=null,o=0;o<a;o++)if(-1!=N[o].dms_devices_type.indexOf("AirConditioner.Indoor")){N[o].control=v.control,y=N[o].control;break}y||e.deviceTypes.push(v)}if(a=N.length,$.isEmptyObject(m.control))for(o=a-1;0<=o;o--)-1!=N[o].dms_devices_type.indexOf("Light")&&N.splice(o,1);else{for(y=null,o=0;o<a;o++)if(-1!=N[o].dms_devices_type.indexOf("Light")){N[o].control=m.control,y=N[o].control;break}y||e.deviceTypes.push(m)}if(a=N.length,$.isEmptyObject(D.control))for(o=a-1;0<=o;o--)-1!=N[o].dms_devices_type.indexOf("ControlPoint.AO")&&N.splice(o,1);else{for(y=null,o=0;o<a;o++)if(-1!=N[o].dms_devices_type.indexOf("ControlPoint.AO")){N[o].control=D.control,y=N[o].control;break}y||e.deviceTypes.push(D)}if(a=N.length,$.isEmptyObject(O.control))for(o=a-1;0<=o;o--)-1!=N[o].dms_devices_type.indexOf("ControlPoint.DO")&&N.splice(o,1);else{for(y=null,o=0;o<a;o++)if(-1!=N[o].dms_devices_type.indexOf("ControlPoint.DO")){N[o].control=O.control,y=N[o].control;break}y||e.deviceTypes.push(O)}return e}})},R=F(),P=function(){var e=this.get("active"),t=this.get("checked"),i=this.get("activeNotEqualed"),o="";return o=e?T.prop("FACILITY_ON"):T.prop("FACILITY_OFF"),t&&!i||(o=T.prop("FACILITY_ON_OFF")),o};return{Views:{map:{view:null,widget:null,routeUrl:"/map",show:null},list:{selected:{routeUrl:"/list/selected",view:null,widget:null},floor:{routeUrl:"/list/floor",view:null,widget:null},group:{routeUrl:"/list/group",view:null,widget:null},show:null},datetime:{routeUrl:"/datetime",view:null,widget:null,show:null,name:T.prop("FACILITY_SCHEDULE_DATETIME_SETTING")},operation:{routeUrl:"/operation",view:null,widget:null,show:null,name:T.prop("FACILITY_SCHEDULE_OPERATION_SETTING")},creation:{routeUrl:"/creation",view:null,widget:null,show:null,name:T.prop("FACILITY_SCHEDULE_CREATION_SETTING")}},MainViewModel:O,OperationViewModel:R,operation_default_values:M,typeFilterDataSource:r,typeFilterText:d,typeQuery:["AirConditioner.*","ControlPoint.AO","ControlPoint.DO","Beacon","Gateway","Light","CCTV"]}}),define("operation/schedule/viewmodel/execptional-vm",[],function(){var e=window.kendo,t=window.I18N;return{MainViewModel:e.observable({calendarBtn:{active:!1,disabled:!1,click:function(){}},listBtn:{active:!1,disabled:!1,click:function(){}},searchField:{invisible:!1,value:"",click:function(){},keydown:function(){}},actions:[{type:"template",id:"spanSelectedCount",template:"<span class='text-view'><span data-bind='text: options.selectedText'></span></span>",options:{selectedText:t.prop("FACILITY_EXCEPTIONAL_DAY_NO_SELECTED")}},{type:"button",id:"schedule-create-btn",text:t.prop("COMMON_BTN_CREATE"),invisible:!1,disabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"schedule-edit-btn",text:t.prop("COMMON_BTN_EDIT"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"schedule-delete-btn",text:t.prop("COMMON_BTN_DELETE"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"schedule-detail-btn",text:t.prop("COMMON_BTN_DETAIL"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}}],category:{invisible:!0,selected:{num:0,active:!1,click:function(){}},all:{num:0,text:t.prop("COMMON_ALL"),active:!1,click:function(){}},group:{num:0,invisible:!0,active:!1,click:function(){}}}}),Views:{main:{view:null,widget:null,routeUrl:"/exceptional",show:null,exceptionCalendarWidget:null}}}}),define("operation/schedule/viewmodel/schedule-vm",[],function(){var e=window.kendo,i=window.I18N,t=[{text:i.prop("FACILITY_SCHEDULE_CREATE_FOLDER"),value:"Folder"},{text:i.prop("FACILITY_SCHEDULE_CREATE_SCHEDULE"),value:"Schedule"}],o=e.observable({calendarBtn:{active:!1,disabled:!1,invisible:!1,click:function(){}},listBtn:{active:!1,disabled:!1,invisible:!1,click:function(){}},listSearchField:{invisible:!1,keywords:"",value:"",click:function(){},keydown:function(){}},isSearchMode:!1,searchField:{invisible:!0,keywords:"",keywordValue:"",click:function(){},keydown:function(){}},searchRemoveBtn:{list:{visible:!1,click:function(e){this.listSearchField.set("keywords",""),this.searchRemoveBtn.list.set("visible",!1)}},search:{visible:!1,click:function(e){this.searchField.set("keywords",""),this.searchRemoveBtn.search.set("visible",!1)}}},filters:[{type:"dropdownlist",id:"device-type-filter",disabled:!1,invisible:!0,options:{optionLabel:"All Device Type",dataTextField:"displayType",dataValueField:"type",animation:!1,dataSource:[{displayType:"SAC Indoor",type:0},{displayType:"Light",type:1},{displayType:"SAC Indoor + Light",type:2},{displayType:"Others",type:3},{displayType:"Pause",type:4}],open:function(){},close:function(){},change:function(){},select:function(){}}}],actions:[{type:"dropdownlist",id:"schedule-create-btn",disabled:!1,invisible:!1,options:{optionLabel:i.prop("COMMON_BTN_CREATE"),dataTextField:"text",dataValueField:"value",animation:!1,dataSource:t,open:function(){},close:function(){},change:function(){},select:function(){}}},{type:"button",id:"schedule-create-only-file-btn",text:i.prop("COMMON_BTN_CREATE"),invisible:!0,disabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"schedule-edit-btn",text:i.prop("COMMON_BTN_EDIT"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"dropdownlist",id:"schedule-folder-move-btn",disabled:!0,invisible:!1,options:{optionLabel:i.prop("FACILITY_SCHEDULE_MOVE_FOLDER"),valueTemplate:i.prop("FACILITY_SCHEDULE_MOVE_FOLDER"),dataTextField:"name",dataValueField:"id",animation:!1,dataSource:[],height:503,open:function(){},close:function(){},change:function(){},select:function(){}}},{type:"button",id:"schedule-delete-btn",text:i.prop("COMMON_BTN_DELETE"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"schedule-detail-btn",text:i.prop("COMMON_BTN_DETAIL"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}}],category:{invisible:!0,selected:{num:0,active:!1,click:function(){}},all:{num:0,text:i.prop("COMMON_ALL"),active:!1,click:function(){}},group:{num:0,invisible:!0,active:!1,click:function(){}}},searchNum:0}),a=e.observable({init:function(){this.set("selectedNum",0)},dateTypeFilter:{disabled:!1,value:"all",options:{dataSource:[{text:i.prop("FACILITY_SCHEDULE_ALL_SCHEDULE"),value:"all"},{text:i.prop("FACILITY_SCHEDULE_BY_MONTH"),value:"month"},{text:i.prop("FACILITY_SCHEDULE_BY_WEEK"),value:"week"},{text:i.prop("FACILITY_SCHEDULE_BY_DAY"),value:"day"}],select:function(e){this.dateTypeFilter.set("value",e.dataItem.value),this.trigger("selectDateType",{value:e.dataItem.value})}}},todayButton:{text:i.prop("FACILITY_SCHEDULE_TODAY"),disabled:!0},navigation:{isInvisible:!1},selectedNum:0,selectedText:function(){var e=i.prop("FACILITY_SCHEDULE_NO_SELECTED"),t=this.get("selectedNum");return 0<t&&(e=i.prop("FACILITY_SCHEDULE_SELECTED",t)),e}});return{MainViewModel:o,SearchViewModel:window.SearchViewModel=a,Views:{calendar:{view:null,widget:null,routeUrl:"/calendar",show:null,active:!1},list:{routeUrl:"/list",view:null,widget:null,show:null,active:!0},search:{routeUrl:"/search",view:null,widget:null,calendarWidget:null,show:null,name:"Search Results"}}}}),define("operation/schedule/create",["operation/core","operation/schedule/viewmodel/create-vm","operation/schedule/model","device/common/device-model","device/common/device-template","device/common/device-util","operation/schedule/config/schedule-common","operation/schedule/config/popup-config","operation/group/config/group-model"],function(e,t,n,i,o,a,r,d,s){"use strict";function l(e,t){if(C.open(),f.disableFloorNav(!0),p=E.data("kendoCommonTabStrip"),k.init(),console.log("init"),e&&!t?(y=!0,u=e,E.find("a.text").text(r.MSG.TXT_EDIT_SCHEDULE)):(y=!1,E.find("a.text").text(r.MSG.TXT_CREATE_SCHEDULE),u=t?e:n.createModel(),console.log(u)),f.getCurrentFloor(),O)console.log("isInitialized"),E.find(".setting-content-main-container").eq(0).scrollTop(0);else{var i=p.contentElement(0);h.bind($(i),b),N(),L(),O=!0}R(u),C.close()}function c(){var e=$("#schedule-common-tab").data("kendoCommonTabStrip");f.disableFloorNav(!1),p.hide(),e.show(),e.activateTab($(".main-tab").eq(0)),v.close(),m.close()}var p,u,v,m,h=window.kendo,f=window.MAIN_WINDOW,g=window.CommonLoadingPanel,_=window.I18N,C=new g,E=$("#schedule-create-tab"),T=r.confirmDialog,D=r.msgDialog,O=!1,I=0,A=1,w=t.operation_default_values,b=(t.Views,t.MainViewModel),k=t.OperationViewModel,y=!1,N=function(){b.dataFields.id.init(),b.dataFields.folder.init(),b.dataFields.scheduleName.init(),b.dataFields.devices.init(),b.dataFields.period.init(),b.dataFields.timeAndOperationSettings.init(),b.dataFields.exceptionDayList.init(),b.dataFields.description.init(),v=d.getLoadPopup(),m=d.getSelectFolderPopup()},L=function(){console.log("attachEvent::call"),k.bind("change",function(e){if(!e.field||"operation.indoor.temperature.min"!=e.field&&"operation.indoor.temperature.max"!=e.field&&"operation.indoor.waterTemp.min"!=e.field&&"operation.indoor.waterTemp.max"!=e.field||this.setTempMinMax(e,$("#indoor-temp"),$("#indoor-water-temp")),this.checkActive(),e.field&&"operation.indoor.power.checked"==e.field&&(this.operation.indoor.power.get("checkedNotEqualed")&&(this.operation.indoor.power.set("checked",!0),this.operation.indoor.power.set("active",!0)),this.operation.indoor.power.set("checkedNotEqualed",!1)),e.field&&"operation.indoor.power.active"==e.field&&(this.operation.indoor.power.get("activeNotEqualed")&&(this.operation.indoor.power.set("checkedNotEqualed",!1),this.operation.indoor.power.set("checked",!0),this.operation.indoor.power.set("activeNotEqualed",!0),this.operation.indoor.power.set("active",!0)),this.operation.indoor.power.set("activeNotEqualed",!1)),e.field&&"operation.indoor.operation.checked"==e.field&&this.operation.indoor.operation.get("checkedNotEqualed")&&(this.operation.indoor.operation.set("checkedNotEqualed",!1),this.operation.indoor.temperature.set("checkedNotEqualed",!1),this.operation.indoor.temperature.set("checked",!1),this.operation.indoor.waterTemp.set("checkedNotEqualed",!1),this.operation.indoor.waterTemp.set("checked",!1),this.operation.indoor.power.set("checkedNotEqualed",!1),this.operation.indoor.power.set("checked",!1),this.operation.indoor.power.set("checked",!0),this.operation.indoor.power.set("activeNotEqualed",!1),this.operation.indoor.power.set("active",!1),this.operation.indoor.power.set("active",!0),this.operation.indoor.operation.set("checked",!1),this.operation.indoor.operation.set("checked",!0),this.operation.indoor.operation.mode[0].set("active",!0)),e.field&&"operation.indoor.operation.mode"==e.field&&this.operation.indoor.operation.get("activeNotEqualed")&&(this.operation.indoor.power.set("checkedNotEqualed",!1),this.operation.indoor.power.set("checked",!1),this.operation.indoor.power.set("checked",!0),this.operation.indoor.power.set("activeNotEqualed",!1),this.operation.indoor.power.set("active",!1),this.operation.indoor.power.set("active",!0),this.operation.indoor.operation.set("activeNotEqualed",!1),this.operation.indoor.operation.set("active",!1),this.operation.indoor.operation.set("active",!0),this.operation.indoor.operation.set("checkedNotEqualed",!1),this.operation.indoor.operation.set("checked",!1),this.operation.indoor.operation.set("checked",!0),e.items)){var t=!1;e.items.forEach(function(e){e.active&&(t=!0)}),t&&(this.operation.indoor.temperature.set("checkedNotEqualed",!1),this.operation.indoor.temperature.set("checked",!1),this.operation.indoor.waterTemp.set("checkedNotEqualed",!1),this.operation.indoor.waterTemp.set("checked",!1))}if(e.field&&"operation.indoor.temperature.checked"==e.field&&this.operation.indoor.temperature.get("checkedNotEqualed")&&(this.operation.indoor.temperature.set("checkedNotEqualed",!1),this.operation.indoor.temperature.set("checked",!0),this.operation.indoor.power.set("checkedNotEqualed",!1),this.operation.indoor.power.set("checked",!0),this.operation.indoor.power.set("activeNotEqualed",!1),this.operation.indoor.power.set("active",!0),this.operation.indoor.operation.set("checkedNotEqualed",!1),this.operation.indoor.operation.set("checked",!1),this.operation.indoor.operation.set("checked",!0),this.operation.indoor.operation.set("activeNotEqualed",!1),this.operation.indoor.operation.activeNotEqualed&&this.operation.indoor.operation.mode[0].set("active",!0)),e.field&&"operation.indoor.waterTemp.checked"==e.field&&this.operation.indoor.waterTemp.get("checkedNotEqualed")&&(this.operation.indoor.waterTemp.set("checkedNotEqualed",!1),this.operation.indoor.waterTemp.set("checked",!0),this.operation.indoor.power.set("checkedNotEqualed",!1),this.operation.indoor.power.set("checked",!0),this.operation.indoor.power.set("activeNotEqualed",!1),this.operation.indoor.power.set("active",!0),this.operation.indoor.operation.set("checkedNotEqualed",!1),this.operation.indoor.operation.set("checked",!1),this.operation.indoor.operation.set("checked",!0),this.operation.indoor.operation.set("activeNotEqualed",!1),this.operation.indoor.operation.activeNotEqualed&&this.operation.indoor.operation.mode[0].set("active",!0)),e.field&&"operation.ventilator.power.checked"==e.field&&(this.operation.ventilator.power.get("checkedNotEqualed")&&(this.operation.ventilator.power.set("checked",!0),this.operation.ventilator.power.set("active",!0)),this.operation.ventilator.power.set("checkedNotEqualed",!1)),e.field&&"operation.ventilator.power.active"==e.field&&(this.operation.ventilator.power.get("activeNotEqualed")&&(this.operation.ventilator.power.set("activeNotEqualed",!1),this.operation.ventilator.power.set("checkedNotEqualed",!1),this.operation.ventilator.power.set("checked",!0),this.operation.ventilator.power.set("activeNotEqualed",!0),this.operation.ventilator.power.set("active",!0)),this.operation.ventilator.power.set("activeNotEqualed",!1)),e.field&&"operation.ventilator.operation.checked"==e.field&&this.operation.ventilator.operation.get("checkedNotEqualed")&&(this.operation.ventilator.operation.set("checkedNotEqualed",!1),this.operation.ventilator.power.set("checkedNotEqualed",!1),this.operation.ventilator.power.set("checked",!1),this.operation.ventilator.power.set("checked",!0),this.operation.ventilator.power.set("activeNotEqualed",!1),this.operation.ventilator.power.set("active",!1),this.operation.ventilator.power.set("active",!0),this.operation.ventilator.operation.set("checked",!1),this.operation.ventilator.operation.set("checked",!0),this.operation.ventilator.operation.mode[0].set("active",!0)),e.field&&"operation.ventilator.operation.mode"==e.field&&this.operation.ventilator.operation.get("activeNotEqualed")&&(this.operation.ventilator.power.set("checkedNotEqualed",!1),this.operation.ventilator.power.set("checked",!1),this.operation.ventilator.power.set("checked",!0),this.operation.ventilator.power.set("activeNotEqualed",!1),this.operation.ventilator.power.set("active",!1),this.operation.ventilator.power.set("active",!0),this.operation.ventilator.operation.set("activeNotEqualed",!1),this.operation.ventilator.operation.set("active",!1),this.operation.ventilator.operation.set("active",!0),this.operation.ventilator.operation.set("checkedNotEqualed",!1),this.operation.ventilator.operation.set("checked",!1),this.operation.ventilator.operation.set("checked",!0)),e.field&&"operation.dhw.power.checked"==e.field&&(this.operation.dhw.power.get("checkedNotEqualed")&&(this.operation.dhw.power.set("checked",!0),this.operation.dhw.power.set("active",!0)),this.operation.dhw.power.set("checkedNotEqualed",!1)),e.field&&"operation.dhw.power.active"==e.field&&(this.operation.dhw.power.get("activeNotEqualed")&&(this.operation.dhw.power.set("activeNotEqualed",!1),this.operation.dhw.power.set("checkedNotEqualed",!1),this.operation.dhw.power.set("checked",!0),this.operation.dhw.power.set("activeNotEqualed",!0),this.operation.dhw.power.set("active",!0)),this.operation.dhw.power.set("activeNotEqualed",!1)),e.field&&"operation.dhw.operation.checked"==e.field&&this.operation.dhw.operation.get("checkedNotEqualed")&&(this.operation.dhw.operation.set("checkedNotEqualed",!1),this.operation.dhw.temperature.set("checkedNotEqualed",!1),this.operation.dhw.temperature.set("checked",!1),this.operation.dhw.power.set("checkedNotEqualed",!1),this.operation.dhw.power.set("checked",!1),this.operation.dhw.power.set("checked",!0),this.operation.dhw.power.set("activeNotEqualed",!1),this.operation.dhw.power.set("active",!1),this.operation.dhw.power.set("active",!0),this.operation.dhw.operation.set("checked",!1),this.operation.dhw.operation.set("checked",!0),this.operation.dhw.operation.mode[1].set("active",!0)),e.field&&"operation.dhw.operation.mode"==e.field&&this.operation.dhw.operation.get("activeNotEqualed")&&(this.operation.dhw.power.set("checkedNotEqualed",!1),this.operation.dhw.power.set("checked",!1),this.operation.dhw.power.set("checked",!0),this.operation.dhw.power.set("activeNotEqualed",!1),this.operation.dhw.power.set("active",!1),this.operation.dhw.power.set("active",!0),this.operation.dhw.operation.set("activeNotEqualed",!1),this.operation.dhw.operation.set("active",!1),this.operation.dhw.operation.set("active",!0),this.operation.dhw.operation.set("checkedNotEqualed",!1),this.operation.dhw.operation.set("checked",!1),this.operation.dhw.operation.set("checked",!0),e.items)){t=!1;e.items.forEach(function(e){e.active&&(t=!0)}),t&&(this.operation.dhw.temperature.set("checkedNotEqualed",!1),this.operation.dhw.temperature.set("checked",!1))}if(e.field&&"operation.dhw.temperature.checked"==e.field&&this.operation.dhw.temperature.get("checkedNotEqualed")&&(this.operation.dhw.temperature.set("checkedNotEqualed",!1),this.operation.dhw.temperature.set("checked",!0),this.operation.dhw.power.set("checkedNotEqualed",!1),this.operation.dhw.power.set("checked",!0),this.operation.dhw.power.set("activeNotEqualed",!1),this.operation.dhw.power.set("active",!0),this.operation.dhw.operation.set("checkedNotEqualed",!1),this.operation.dhw.operation.set("checked",!1),this.operation.dhw.operation.set("checked",!0),this.operation.dhw.operation.set("activeNotEqualed",!1),this.operation.dhw.operation.activeNotEqualed&&this.operation.dhw.operation.mode[0].set("active",!0)),e.field&&"operation.remoteControl.checked"==e.field&&this.operation.remoteControl.get("checkedNotEqualed")&&(this.operation.remoteControl.set("checkedNotEqualed",!1),this.operation.remoteControl.set("checked",!0),this.operation.remoteControl.control[0].set("active",!0)),e.field&&"operation.remoteControl.control"==e.field&&this.operation.remoteControl.get("activeNotEqualed")&&(this.operation.remoteControl.set("activeNotEqualed",!1),this.operation.remoteControl.set("checkedNotEqualed",!1),this.operation.remoteControl.set("checked",!1),this.operation.remoteControl.set("checked",!0)),e.field&&"operation.light.power.checked"==e.field&&(this.operation.light.power.get("checkedNotEqualed")&&(this.operation.light.power.set("checked",!0),this.operation.light.power.set("active",!0)),this.operation.light.power.set("checkedNotEqualed",!1)),e.field&&"operation.light.power.active"==e.field&&(this.operation.light.power.get("activeNotEqualed")&&(this.operation.light.power.set("checkedNotEqualed",!1),this.operation.light.power.set("checked",!0),this.operation.light.power.set("activeNotEqualed",!0),this.operation.light.power.set("active",!0)),this.operation.light.power.set("activeNotEqualed",!1)),e.field&&"operation.light.checked"==e.field&&(this.operation.light.get("checkedNotEqualed")&&(this.operation.light.set("checked",!0),this.operation.light.set("value",50)),this.operation.light.set("checkedNotEqualed",!1)),e.field&&"operation.light.value"==e.field&&this.operation.light.get("valueNotEqualed")&&(this.operation.light.set("valueNotEqualed",!1),this.operation.light.set("checkedNotEqualed",!1),this.operation.light.set("checked",!1),this.operation.light.set("checked",!0)),e.field&&"operation.point.aoav.checked"==e.field&&(this.operation.point.aoav.get("checkedNotEqualed")&&this.operation.point.aoav.set("checked",!0),this.operation.point.aoav.set("checkedNotEqualed",!1)),e.field&&"operation.point.dodv.checked"==e.field&&(this.operation.point.dodv.get("checkedNotEqualed")&&(this.operation.point.dodv.set("checked",!0),this.operation.point.dodv.set("active",!0)),this.operation.point.dodv.set("checkedNotEqualed",!1)),e.field&&"operation.point.dodv.active"==e.field&&this.operation.point.dodv.get("activeNotEqualed")&&(this.operation.point.dodv.set("checkedNotEqualed",!1),this.operation.point.dodv.set("checked",!1),this.operation.point.dodv.set("checked",!0),this.operation.point.dodv.set("activeNotEqualed",!1),this.operation.point.dodv.set("active",!0)),e.field&&"operation.pre.checked"==e.field&&(this.operation.pre.get("checkedNotEqualed")&&(this.operation.pre.set("checked",!0),this.operation.pre.set("radioChecked","PreCooling"),this.operation.pre.cool.set("value",w.PRE_DESIRED),this.operation.pre.cool.set("disabled",!1),this.operation.pre.heat.set("value",w.PRE_DESIRED),this.operation.pre.heat.set("disabled",!0)),this.operation.pre.set("checkedNotEqualed",!1)),e.field&&"operation.pre.radioChecked"==e.field){var i=this.operation.pre.get("radioChecked");this.operation.pre.get("radioCheckedNotEqualed")&&this.operation.pre.get("radioChecked")?(this.operation.pre.set("radioCheckedNotEqualed",!1),this.operation.pre.set("checkedNotEqualed",!1),this.operation.pre.set("radioChecked",i),"PreCooling"==i?this.operation.pre.cool.set("disabled",!1):this.operation.pre.heat.set("disabled",!0)):this.operation.pre.get("checkedNotEqualed")&&(this.operation.pre.set("checkedNotEqualed",!1),this.operation.pre.set("checked",!1),this.operation.pre.set("checked",!0),this.operation.pre.set("radioChecked",i),this.operation.pre.cool.set("disabled","PreCooling"!==i),this.operation.pre.heat.set("disabled","PreHeating"!==i))}}),b.actions[I].options.set("click",function(){C.open(),$.ajax({url:"/schedules"}).done(function(e){e.sort(H);var t=n.createDataSource(e,[]);v.setDataSource(t),v.open()}).always(function(){C.close()})}),b.actions[A].options.set("click",function(){var i=S(),e=i.name,t=i.devices,o=i.configurations,a="";return void 0!==e&&0==e.length||null===t||0==t.length||null===o||0==o.length?(a="- ",void 0!==e&&0==e.length&&(a+=_.prop("FACILITY_SCHEDULE_SCHEDULE_NAME")+" / ",b.dataFields.scheduleName.set("value","")),null!==t&&0!=t.length||(a+=_.prop("FACILITY_SCHEDULE_DEVICE")+" / "),null!==o&&0!=o.length||(a+=_.prop("FACILITY_SCHEDULE_TIME_AND_OPERATION_SETTINGS")+" / "),a=a.substring(0,a.length-3),a=_.prop("FACILITY_SCHEDULE_CREATE_NOT_COMPLETED")+"\n"+a,D.message(a),void D.open()):F(i.startDate,i.endDate,i.exceptionalDays)?(a=_.prop("FACILITY_SCHEDULE_CREATE_HAS_EXCEPTION_DATE_OUT_OF_SCHEDULE_PERIOD"),D.message(a),void D.open()):void(y?M(b.dataFields.id.get("value"),i):(C.open,$.ajax({url:"/schedules/lists"}).done(function(e){var t=n.parseFolderModel(e);C.close(),0<t.length?(t.sort(P),t.unshift({id:null,name:_.prop("FACILITY_SCHEDULE_FOLDER_NO_FOLDER"),selected:!0,checked:!0}),void 0!==i.schedules_folders_id&&t.forEach(function(e){e.selected=e.id===i.schedules_folders_id,e.checked=e.id===i.schedules_folders_id}),m.setDataSource(t),m.open()):x(i)}).always(function(){})))}),v.bind("onChecked",function(e){var t=e.sender.BTN;e.sender.setActions(t.SELECT,{disabled:!1})}),v.bind("onSelect",function(e){var t=e.result;T.message(_.prop("FACILITY_SCHEDULE_CREATE_LOAD_SCHEDULE_CONFIRM_MSG")),T.setConfirmActions({yes:function(){v.close(),l(t,!0)}}),T.open()}),m.bind("onChecked",function(e){var t=e.sender.BTN;e.sender.setActions(t.SELECT,{disabled:!1})}),m.bind("onSelect",function(e){var t,i=e.result.id;b.dataFields.folder.set("value",i),t=S(),y?M(b.dataFields.id.get("value"),t):x(t),m.close()})},S=function(){var e=b,i=window.moment,t=e.dataFields.folder.get("value"),o=e.dataFields.scheduleName.get("value"),a=e.dataFields.period.get("value").startDate,n=e.dataFields.period.get("value").endDate,r=e.dataFields.exceptionDayList.get("value"),d=e.dataFields.devices.get("value"),s=e.dataFields.timeAndOperationSettings.get("value"),l=e.dataFields.description.get("value");o=o.trim(),l=void 0!==l?l.trim():"";var c=[];d.forEach(function(e){var t=e.id?e.id:e.dms_devices_id;c.push({dms_devices_id:t})}),d=c;var p={name:o,type:"Schedule",level:0,schedules_folders_id:t,activated:!0,startDate:a,endDate:n,exceptionalDays:[],devices:[],configurations:[],description:l};return null!==p.schedules_folders_id&&void 0!==p.schedules_folders_id||delete p.schedules_folders_id,"object"==typeof p.startDate&&(p.startDate=i(p.startDate).format("YYYY-MM-DD")),"object"==typeof p.endDate&&(p.endDate=i(p.endDate).format("YYYY-MM-DD")),void 0===r&&(r=[]),r.forEach(function(e){var t={startDate:i(e.startDate).format("YYYY-MM-DD"),endDate:i(e.endDate).format("YYYY-MM-DD"),name:e.name,description:e.description};void 0!==t.description&&""!==t.description||delete t.description,p.exceptionalDays.push(t)}),d.forEach(function(e){p.devices.push({dms_devices_id:e.dms_devices_id})}),s.forEach(function(e){var t=e.toJSON(),i={daysOfWeek:t.daysOfWeek,executionTimes:t.executionTimes,deviceTypes:t.deviceTypes};void 0!==e.algorithm&&(i.algorithm=e.algorithm.toJSON()),p.configurations.push(i)}),y&&u.name===p.name&&delete p.name,p},x=function(e){C.open(),console.log(e),$.ajax({url:"/schedules",method:"POST",data:e}).done(function(e){c()}).fail(function(e){var t=e.responseJSON.message;t="Schedule with the same name already exist"===t?_.prop("FACILITY_SCHEDULE_DUPlICATED_SCHEDULE_NAME_EXIST"):t,D.message(t),D.open()}).always(function(){C.close()})},M=function(e,t){C.open(),console.log(t),$.ajax({url:"/schedules/"+e,method:"PATCH",data:t}).done(function(e){c()}).fail(function(e){var t=e.responseJSON.message;t="Schedule with the same name already exist"===t?_.prop("FACILITY_SCHEDULE_DUPlICATED_SCHEDULE_NAME_EXIST"):t,D.message(t),D.open()}).always(function(){C.close()})},F=function(e,t,i){var o=!1,a=new Date(e).getTime(),n=new Date(t).getTime();return i.forEach(function(e){var t=new Date(e.startDate).getTime(),i=new Date(e.endDate).getTime();a<=t&&i<=n||(o=!0)}),o},R=function(e){var t=b.dataFields.period.startDatePicker.widget,i=b.dataFields.period.endDatePicker.widget;e.title&&!e.name&&(e.name=e.title),e.end&&(e.endDate=e.end),e.start&&(e.startDate=e.start),void 0===e.exceptionalDays&&(e.exceptionalDays=[]),b.dataFields.id.set("value",e.id),b.dataFields.folder.set("value",e.schedules_folders_id),b.dataFields.scheduleName.set("value",e.name),b.dataFields.devices.set("value",e.devices),b.dataFields.period.set("value",{startDate:e.startDate,endDate:e.endDate}),b.dataFields.timeAndOperationSettings.set("value",e.configurations),b.dataFields.exceptionDayList.set("value",e.exceptionalDays),b.dataFields.description.set("value",e.description),y||(b.dataFields.period.set("checked","indefinitePeriod"),t.enable(!1),i.enable(!1)),b.actions[A].set("disabled",""==b.dataFields.id.value),b.dataFields.scheduleName.validator.hideMessages(),b.dataFields.timeAndOperationSettings.oneDayTimePicker.help.popup.close.click()},P=function(e,t){var i=e.name.toUpperCase(),o=t.name.toUpperCase();return i<o?-1:o<i?1:0},H=function(e,t){var i=e.updated.date.toUpperCase(),o=t.updated.date.toUpperCase();return i<o?1:o<i?-1:0};return{init:l}}),define("operation/schedule/exceptional",["operation/core","operation/schedule/viewmodel/execptional-vm","operation/schedule/model","operation/schedule/config/schedule-common","operation/schedule/config/popup-config","operation/schedule/widget/exceptional-widget"],function(e,t,o,i,a,n){window.moment;var r,d=window.kendo,s=(window.GlobalSettings,window.CommonLoadingPanel),l=window.Util,c=(window.I18N,new s),p=i.msgDialog,u=(i.confirmDialog,t.MainViewModel),v=t.Views,m=(new d.Router,new d.Layout("<div id='exceptional-main-view-content' class='schedule-main-view-content k-scheduler'></div>"),$("#exceptional-main-view"),function(){}),h=function(e){var t=$("#exception-calendars"),i=$("#exception-day-list");v.main.exceptionCalendarWidget=t.kendoExecptionalCalenderList(n.mainView.exceptionCalendars).data("kendoExecptionalCalenderList"),v.main.exceptionDayList=i.kendoExceptionDayList(n.mainView.exceptionDayList).data("kendoExceptionDayList")},f=function(){v.main.exceptionDayList.bind("onSave",_),v.main.exceptionDayList.bind("onEdit",C),v.main.exceptionDayList.bind("onDelete",E),v.main.exceptionDayList.bind("onChecked",g)},g=function(e){var t=e.checkedData;v.main.exceptionCalendarWidget.setSelectedData(t)},_=function(e){var t=e.result;t&&(c.open(),t=l.refineDataFieldsFromModel(t,o.ExceptionalDaysModel),$.ajax({url:"/schedules/exceptionalDays",method:"POST",data:t}).done(function(){c.open(),T()}).fail(function(e){var t=l.parseFailResponse(e);p.message(t),p.open()}).always(function(){c.close()}))},C=function(e){var t,i=e.result;i&&(c.open(),t=i.id,i=l.refineDataFieldsFromModel(i,o.ExceptionalDaysModel),$.ajax({url:"/schedules/exceptionalDays/"+t,method:"PATCH",data:i}).done(function(){c.open(),T()}).fail(function(e){var t=l.parseFailResponse(e);p.message(t),p.open()}).always(function(){c.close()}))},E=function(e){var t;c.open(),t=e.map(function(e){return e.id}).join(),$.ajax({url:"/schedules/exceptionalDays?ids="+t,method:"DELETE"}).done(function(){T()}).fail(function(){}).always(function(){c.close()})},T=function(){$.ajax({url:"/schedules/exceptionalDays"}).done(function(e){var t=o.createExceptionalDs(e),i=new d.data.DataSource({data:t});i.read(),v.main.exceptionCalendarWidget.setDataSource(i),v.main.exceptionDayList.setDataSource(i),i.sort({field:"name",dir:"asc"})}).fail(function(){}).always(function(){c.close()}),v.main.exceptionCalendarWidget.resetSelectedExecptional()};return{init:function(e,t){r=e,m();var i=r.contentElement(1);d.bind($(i),u),h(t),f(),T()}}}),define("operation/schedule/widget/exceptional-widget",[],function(){window.moment,window.I18N,window.Util,window.kendo;return{createNewWidget:function(e,t,i){return new t($("<div/>").attr("id",e),i)},mainView:{exceptionCalendars:{},exceptionDayList:{isRepeat:!0,resizable:!1,duplicateDateInspection:!0}}}}),define("operation/schedule/schedule",["operation/core","operation/schedule/viewmodel/schedule-vm","operation/schedule/model","operation/schedule/config/schedule-common","operation/schedule/create","operation/schedule/exceptional","operation/schedule/config/popup-config","operation/schedule/config/schedule-template"],function(i,e,d,r,t,o,a,p){$(window).off("focus");function s(){return G?M.search.calendarWidget:M.calendar.widget}function l(e){var t,i,o,a,n=s();t=n._model.dateTypeFilter.get("value"),i=n.date(),a="day"==t?o=i:"week"==t?(o=n.view()._startDate,n.view()._endDate):"month"==t?(o=n.view()._firstDayOfMonth,n.view()._lastDayOfMonth):o=null;var r=M.list.widget,d=M.search.widget;G?d.setDate(o,a,e):r.setDate(o,a)}function n(e){var t=M.list.widget.getCheckedFolder().length;1==q&&e?x.actions[J].set("disabled",!e||0<t):1===t?x.actions[J].set("disabled",0<q):x.actions[J].set("disabled",!0),x.actions[K].set("disabled",!e),0<t&&x.actions[K].set("disabled",!(0<t)),x.actions[Q].set("disabled",!e),x.actions[z].set("invisible",!1),x.actions[X].set("invisible",!0),x.calendarBtn.get("active")?(x.actions[Z].set("disabled",!0),x.actions[J].set("disabled",!0),x.actions[K].set("disabled",!0),x.actions[z].set("invisible",!1),x.actions[X].set("invisible",!0),x.actions[X].set("invisible",!0),M.calendar.widget._model.todayButton.set("disabled",!1)):(x.actions[Z].set("disabled",!(1<=q||1<=t)),x.actions[z].set("invisible",!0),x.actions[X].set("invisible",!1),M.calendar.widget._model.todayButton.set("disabled","all"===M.calendar.widget._model.dateTypeFilter.value))}function c(e){var t=H.find(".k-item:not(.search-tab)"),i=H.find(".search-tab");if(e){for(var o=0;o<t.length;o++)t.removeClass("k-state-active");i.addClass("k-state-active")}else i.removeClass("k-state-active");i.removeClass("k-state-hover")}function u(e,t,o){var a,n=e,r=M.list.widget.originalDs,d=M.calendar.widget.dataSource,s=M.search.widget.originalDs;if(0<t.length){var i=t.data("uid"),l=o.grid.dataSource;a=l.getByUid(i)}else a=o.getSelectedData();var c=t.find(".grid-checkbox-cell");n.hasClass("ic-action-pause")?(S.open(o.element),$.ajax({url:"/schedules/"+a.id,method:"PATCH",data:{activated:!1}}).always(function(){n.removeClass("ic-action-pause"),n.addClass("ic-action-play"),n.parent().siblings(".schedule-status").text(L.prop("FACILITY_SCHEDULE_NOT_ACTIVATED"));var e=r.get(a.id),t=s.get(a.id);if(0<c.length){var i=p.getEventTemplateClass(e);c.removeClass("pause"),c.addClass(i)}e.set("activated",!1),(e=d.get(a.id)).set("activated",!1),t.set("activated",!1),o.grid&&o.grid.dataSource.get(a.id).set("activated",!1);S.close()})):(S.open(o.element),$.ajax({url:"/schedules/"+a.id,method:"PATCH",data:{activated:!0}}).always(function(){n.removeClass("ic-action-play"),n.addClass("ic-action-pause"),n.parent().siblings(".schedule-status").text(L.prop("FACILITY_SCHEDULE_ACTIVATED"));var e=r.get(a.id),t=s.get(a.id);if(0<c.length){var i=p.getEventTemplateClass(e);c.removeClass(i),c.addClass("pause")}e.set("activated",!0),(e=d.get(a.id)).set("activated",!0),t.set("activated",!0),o.grid&&o.grid.dataSource.get(a.id).set("activated",!0);S.close()}))}function v(e){var t=e.split(", ");return{buildingName:t[0],floor:t[1]}}function m(e){if(e.value)return e.value.slice(e.value.indexOf(":name:")+":name:".length)}var h,f,_,g,C,E,T,D,O,I,A=window.moment,w=window.kendo,b=window.GlobalSettings,k=window.CommonLoadingPanel,y=window.Util,N=window.MAIN_WINDOW,L=window.I18N,S=new k,x=e.MainViewModel,M=e.Views,F=e.SearchViewModel,R=new w.Router,P=new w.Layout("<div id='schedule-main-view-content' class='schedule-main-view-content k-scheduler'></div>"),H=$("#schedule-common-tab"),Y=$("#schedule-create-tab"),U=$("#schedule-main-view"),W=r.msgDialog,V=r.confirmDialog,B=[],G=!1,q=0,j=[],X=0,z=1,J=2,Z=3,K=4,Q=5,ee=0,te=function(e){var t="?";return(e=e||N.getCurrentFloor()).building.id!=N.FLOOR_NAV_BUILDING_TOTAL_ID&&(t+="foundation_space_buildings_id="+e.building.id+"&"),e.floor.id!=N.FLOOR_NAV_FLOOR_ALL_ID&&(t+="foundation_space_floors_id="+e.floor.id),t},ie=function(e){var t=te(e);Ye(t)},oe=function(e){h=H.kendoCommonTabStrip().data("kendoCommonTabStrip"),(f=Y.kendoCommonTabStrip().data("kendoCommonTabStrip")).element.closest(".common-tab-strip-wrapper").hide(),D=$("#schedule-close-create"),O=$("#schedule-close-search"),g=$("#schedule-folder-edit-popup").kendoScheduleFolderEditPopup().data("kendoScheduleFolderEditPopup"),T=$("#schedule-toast-popup").kendoCommonToastPopup({target:"#schedule-common-tab",copyAnchorStyles:!1,hideBeforeShow:!0}).data("kendoCommonToastPopup"),o.init(h,e)},ae=function(e,t){R.bind("init",$e);var i=d.createDataSource(e,t);M.calendar.widget=Ze(i),M.calendar.view=new w.View(M.calendar.widget.wrapper),R.route(M.calendar.routeUrl,qe.bind(R,M.calendar.view)),M.list.widget=ze(i,t),M.list.widget.wrapper.prepend(r.schedulerHeaderTemplate),M.list.view=new w.View(M.list.widget.wrapper),R.route(M.list.routeUrl,qe.bind(R,M.list.view)),M.search.calendarWidget=Ze(i,!0),M.search.widget=Je(i,"search"),M.search.widget.wrapper.prepend(r.schedulerHeaderTemplate),M.search.view=new w.View(M.search.widget.wrapper),R.route(M.search.routeUrl,qe.bind(R,M.search.view)),M.calendar.widget.listWidget=M.list.widget,ne(),R.start(),C=a.getScheduleDetailPopup(),E=a.getScheduleMorePopup()},ne=function(){U.on("click","#schedule-scheduler-grid .grid-scheduler-toolbar .k-state-default",function(e){var t,i=$(this),o=i.data("action"),a=s();if(!i.hasClass("k-dropdown-wrap")){if(o){if("next"==o)t=a.view().nextDate();else if("previous"==o)t=a.view().previousDate();else{if("today"==o)return;"nav-current"==o&&a._showCalendarAtListView()}a.trigger("navigate",{view:void 0,action:o,date:t})||a.date(t)}G?De():l()}}),U.on("click",".grid-scheduler-toolbar .k-state-default",function(e){var t=M.calendar.widget.viewName();de("day"==t&&0<j.length)}),_.bind("navigate",function(e){var t=e.date;"day"==e.view&&Xe(A(t))?de(!0):de(!1),B=[]}),_.bind("selectDateType",re),M.search.calendarWidget.bind("selectDateType",re)},re=function(e){var t,i,o,a=s(),n=a._model.dateTypeFilter.get("value");switch(x.calendarBtn.get("active")?n="month":a.view(n),t=a.date(),n){case"all":o=i=null,a._model.todayButton.set("disabled",!0),Qe(!1);break;case"month":i=a.view()._firstDayOfMonth,o=a.view()._lastDayOfMonth,a._model.todayButton.set("disabled",!1),Qe(!0);break;case"week":i=a.view()._startDate,o=a.view()._endDate,a._model.todayButton.set("disabled",!1),Qe(!0);break;case"day":o=i=t,a._model.todayButton.set("disabled",!1),Qe(!0);break;default:return}var r=M.list.widget;G?De():r.setDate(i,o)},de=function(e){var t=$(".k-scheduler-navigation .k-nav-current .ic-error-calendar");e?t.show():t.hide()},se=function(){h.bind("activate",function(e){var t=$(e.item).index();0==t?(N.disableFloorNav(!1),Te(!1),Ye()):1==t&&N.disableFloorNav(!0)}),_.bind("more",function(e){var t,i,o,a,n=e.slot,r=n.startDate(),d=n.endDate(),s=_.occurrencesInRange(r,d),l=A(r).format("YYYY/MM/DD/ddd"),c=_.viewName();if("day"==c||"week"==c){var p,u;i=s.length;var v,m=new Date(r),h=A(r),f=A(d),g=!1;for(t=i-1;0<=t;t--)if(h.isBetween(s[t].start,s[t].end,"day","[]")&&f.isBetween(s[t].start,s[t].end,"day","[]")){for(a=s[t].executionTimes.length,g=!1,o=0;o<a;o++)if((u=s[t].executionTimes[o])&&(p=u.split(":"),m.setHours(p[0]),m.setMinutes(p[1]),m.setSeconds(p[2]),(v=A(m)).isSameOrAfter(r)&&v.isSameOrBefore(d))){g=!0;break}g||s.splice(t,1)}else s.splice(t,1)}E.headerViewModel&&E.headerViewModel.set("checkedNum",0),E.title(l),E.setDataSource(s),E.open()}),x.calendarBtn.set("click",function(e){1!=x.calendarBtn.get("active")&&le()}),x.listBtn.set("click",function(){1!=x.listBtn.get("active")&&ce()}),x.actions[X].options.set("select",we),x.actions[z].options.set("click",be),x.actions[J].options.set("click",ke),x.actions[Z].options.set("select",Ne),$("#schedule-folder-move-btn").data("kendoDropDownList").bind("open",ye),x.actions[K].options.set("click",xe),x.actions[Q].options.set("click",Me),M.list.widget.element.on("click","table[role=treegrid] .ic.ic-info",function(){var e=$(this).data("originalid"),t=M.list.widget.originalDs.get(e);t.devices=t.devices.sort(Fe),C.setDataSource(t),C.setDialogType("single"),C.open()}),M.search.widget.element.on("click",".ic.ic-info",function(){var e=$(this).data("id"),t=M.search.widget.dataSource.get(e);t.devices=t.devices.sort(Fe),C.setDataSource(t),C.setDialogType("single"),C.open()}),M.calendar.widget.bind("change",pe),M.list.widget.bind("checked",pe),M.search.widget.bind("change",pe),M.search.widget.bind("checked",pe),C.bind("onDelete",Ee),E.bind("onDelete",Ee),E.bind("onEdit",Ce),C.bind("onEdit",Ce),E.bind("onChecked",_e),E.element.on("click",".action-button",Ie),C.element.on("click",".action-button",Oe),D.on("click",function(){V.message(L.prop("FACILITY_SCHEDULE_CREATE_CANCEL_MSG")),V.setConfirmActions({yes:function(){He()}}),V.open()}),O.on("click",Ue),h.bind("select",function(e){if($(e.item).hasClass("search-tab"))return h.select(0),Te(!0),e.preventDefault(),!1}),x.listSearchField.set("click",function(e){var t=$(".search-box input.list"),i=t.val()?t.val():x.listSearchField.keywords;x.searchField.set("keywords",i),x.searchField.set("keywordValue",i),x.listSearchField.set("keywords",""),t.val(""),G||Te(!0),De(i),x.searchRemoveBtn.search.set("isVisible",0<i.length)}),x.listSearchField.set("keydown",function(e){13!=e.keyCode||G||x.listSearchField.click()}),x.searchField.set("click",function(e){var t=$(e.target),i=t.val()?t.val():x.searchField.get("keywords");x.searchField.set("keywordValue",i),G||Te(!0),De(i)}),x.searchField.set("keydown",function(e){13==e.keyCode&&G&&x.searchField.click(e)}),F.dateTypeFilter.options.set("select",function(e){De()}),g.bind("onSave",function(e){Ye()}),M.list.widget.bind("dataBound",function(e){var t,i,o,a=M.search.widget,n=a.dataSource,r=e.sender.originalDs.data().map(function(e){return e}),d=r.length,s=[];for(t=0;t<d;t++)i=$.extend(!0,{},r[t]),(o=n.get(i.id))&&(i.checked=!!o.checked),s.push(i);a.setDataSource(s);var l=!!G;G=!0,De(),G=l,x.set("searchNum",a.dataSource.total())}),$(".search-box input.list").on("input",function(e){x.searchRemoveBtn.list.set("visible",0<this.value.length)}),$(".search-box input.search").on("input",function(e){x.searchRemoveBtn.search.set("visible",0<this.value.length)})},le=function(e){x.calendarBtn.set("active",!0),x.listBtn.set("active",!1),x.actions[z].set("invisible",!1),x.actions[X].set("invisible",!0),M.calendar.widget.view("month"),M.calendar.widget._model.dateTypeFilter.set("disabled",!0),n(!1),R.navigate(M.calendar.routeUrl),M.calendar.widget.date(M.calendar.widget.date()),M.calendar.widget.trigger("selectDateType")},ce=function(e){x.listBtn.set("active",!0),x.calendarBtn.set("active",!1),M.calendar.widget._model.dateTypeFilter.set("disabled",!1),n(!1),R.navigate(M.list.routeUrl),M.list.widget.element.find("li.k-view-month").trigger("click"),M.calendar.widget.trigger("selectDateType")},pe=function(e){var t;if(console.info(e),e.originalEvent)me(e);else if(e.isGroupHeader||!1===e.isHeader||!0===e.isHeader){var i=[e.item];!0===e.isHeader?i=e.sender.dataSource.data():void 0!==e.item.data&&(i=e.item.data),he(i),G||(t=ue(e),M.list.widget._checkItemFromCheckbox(e))}else e.events&&(fe(e.events),0===e.events.length&&(B=[]));console.info("selected events in calendar : "+B.length);var o=Ae(t);x.calendarBtn.get("active")?n(0!==o.length):ve(o.length),void 0===e.sender?ee=$(".k-scheduler-content").scrollTop():e.slots&&0!==e.slots.length&&$(".k-scheduler-content").scrollTop(ee)},ue=function(e){return e.isHeader?e.isHeader:void 0!==e.item.checked?e.item.checked:e.item.data[0].checked},ve=function(e){q=e,G?M.search.calendarWidget._model.set("selectedText",L.prop("FACILITY_SCHEDULE_SELECTED",e)):M.calendar.widget._model.set("selectedText",L.prop("FACILITY_SCHEDULE_SELECTED",e)),0==q?(B.length=0,M.calendar.widget._model.set("selectedText",L.prop("FACILITY_SCHEDULE_NO_SELECTED",e)),n(!1)):n(!0)},me=function(e){if(e.target){var t=$(e.target);t.hasClass("k-event")||(t=t.closest(".k-event"));var i=t.find(".k-event-template").data("id"),o=t.hasClass("k-state-selected");ge(o,i)}},he=function(e){if(e){void 0!==e.data&&(e=e.data);var t,i,o,a,n=e.length;for(a=0;a<n;a++)t=e[a],void 0!==e[a].originalid&&(i=t.checked,o=G?t.id:t.originalid,ge(i,o))}},fe=function(e){var t,i,o=e.length;for(i=0;i<o;i++)t=e[i].id,ge(!0,t)},ge=function(e,t){var i;e?-1==B.indexOf(t)&&B.push(t):(i=B.indexOf(t),B.splice(i,1))},_e=function(e){var t=e.sender.grid.getCheckedData().length;e.sender.headerViewModel.set("checkedNum",t);var i=e.sender.BTN;0<t?(1==t?e.sender.setActions(i.EDIT,{disabled:!1}):e.sender.setActions(i.EDIT,{disabled:!0}),e.sender.setActions(i.DELETE,{disabled:!1})):(e.sender.setActions(i.EDIT,{disabled:!0}),e.sender.setActions(i.DELETE,{disabled:!0}))},Ce=function(e){e.sender.close();var t=e.result;Se(t)},Ee=function(e){var t=[],i=e.result,o=e.results;o?t=o:i&&t.push(i),V.message(r.MSG.TXT_DELETE_SCHEDULE),V.setConfirmActions({yes:function(){Ve(t,e.sender,void 0)}}),V.open()},Te=function(e,t){G=e,x.searchField.set("invisible",!e),x.listSearchField.set("invisible",e),x.searchRemoveBtn.search.set("visible",e),x.set("isSearchMode",e),x.searchRemoveBtn.list.set("visible",!1),e?(M.calendar.widget.view().clearSelection(),M.list.widget.uncheckAll(),H.find(".search-tab").show(),x.actions[X].set("disabled",!0),x.calendarBtn.set("invisible",!0),x.listBtn.set("invisible",!0),c(!0),R.navigate(M.search.routeUrl),M.search.calendarWidget.trigger("selectDateType")):(Le(),H.find(".main-tab").show(),t&&(H.find(".search-tab").hide(),F.init(),x.searchField.set("keywords",""),x.searchRemoveBtn.set("isVisible",!1)),x.actions[X].set("disabled",!1),x.calendarBtn.set("invisible",!1),x.listBtn.set("invisible",!1),c(!1),h.select(0),je()?ce():le())},De=function(t,e){t=t||x.searchField.get("keywordValue");var i=M.search.widget.originalDs.data(),o={logic:"and",filters:[]},a={logic:"or",filters:[{field:"name",operator:function(e){return-1!==e.indexOf(t)},value:t}]};a.filters.push(et("devices","dms_devices_name",t)),a.filters.push(et("devices","dms_devices_id",t)),o.filters.push(a);var n=new w.data.Query(i).filter(o).toArray(),r=new w.data.DataSource({data:n}),d=M.search.widget;r.read(),l(r);d.filterForSearch(t,["name","devices"]),x.set("searchNum",n.length)},Oe=function(){var e=$(this),t=e.closest("tr");u(e,t,C)},Ie=function(){var e=$(this),t=e.closest("tr");u(e,t,E)},Ae=function(e){var t=[];return G?(t=M.search.widget.getCheckedData(),B=t):x.calendarBtn.get("active")?(t=M.calendar.widget.currentSelectedDaySchedules).events&&(t=t.events):t=M.list.widget.getOriginalDsCheckedData(),t},we=function(e){var t=e.dataItem.value,i=e.sender,o="Folder"==t,a=o?"/schedules/lists":"/schedules",n=o?L.prop("FACILITY_SCHEDULE_FOLDER_MAX_SIZE"):L.prop("FACILITY_SCHEDULE_MAX_SIZE");S.open(),$.ajax({url:a}).done(function(e){if(o&&(e=e.filter(function(e){return"Folder"===e.type})),256<=e.length)return W.message(n),W.open(),void S.close();o?(g.open(),S.close()):Se()}).fail(function(e){tt(e),S.close()}).always(function(){i.popup.close(),i.select(-1)})},be=function(e){S.open(),$.ajax({url:"/schedules"}).done(function(e){if(256<=e.length)return W.message(L.prop("FACILITY_SCHEDULE_MAX_SIZE")),void W.open();Se(),ce()}).fail(function(e){tt(e)}).always(function(){S.close()})},ke=function(e){var t=function(){var e=[];if(G)e=M.search.widget.getCheckedData(),$.isArray(e)&&0<e.length&&(e=e[0]);else if(x.calendarBtn.get("active")){1<(e=M.calendar.widget.select()).length&&(e=e[0]);var t=(e=e.events[0]).toJSON();e=new d.Model(t)}else e=M.list.widget.getCheckedData(),$.isArray(e)&&0<e.length&&(e=e[0]);return e}(),i=M.list.widget.getCheckedFolder();0!=t.length?Se(t):0!=i.length&&g.open(i[0])},ye=function(e){if(1<=M.list.widget.getCheckedFolder().length){var t=L.prop("FACILITY_SCHEDULE_MOVE_CHECKED_FOLDER");W.message(t),W.open(),e.preventDefault()}$("#schedule-folder-move-btn-list").closest(".k-animation-container").addClass("schedule-folder-move-popup-animation-container")},Ne=function(e){var t=e.sender,i=e.dataItem,o=G?M.search.widget.getCheckedData():M.list.widget.getCheckedData(),a=[];o.forEach(function(e){a.push(e.id)}),console.log("selectedFolderid : "+i.id),console.log("selectedScheduleIds : "+a),S.open(),function(t,e){if(e){e instanceof Array&&(e=e.join());var i=null!==t.id?"/schedules/move?schedules_folders_id="+t.id+"&schedule_ids="+e:"/schedules/move?schedules_folders_id&schedule_ids="+e;return $.ajax({method:"PATCH",url:i}).done(function(e){G?M.search.widget.uncheckAll():Ye(),T.show(L.prop("FACILITY_SCHEDULE_FOLDER_MOVE",t.name))}).fail(function(e){tt(e)})}}(i,a).always(function(){t.popup.close(),t.select(-1)}),S.close()},Le=function(){M.search.widget.uncheckAll(),M.search.widget._setOrigDs(),M.search.calendarWidget._model.set("selectedText",L.prop("FACILITY_SCHEDULE_SELECTED",0))},Se=function(e){Le(),h.hide(),f.show(),t.init(e),S.close()},xe=function(e){var t=M.list.widget.getCheckedFolder(),i=Ae(),o="";0<t.length&&0<i.length?o=L.prop("FACILITY_SCHEDULE_DELETE_FOLDER_SCHEDULE_CONFIRM"):0<t.length?o=L.prop("FACILITY_SCHEDULE_DELETE_FOLDER_CONFIRM"):0<i.length&&(o=L.prop("FACILITY_SCHEDULE_DELETE_SCHEDULE_CONFIRM")),V.message(o),V.setConfirmActions({yes:function(){Ve(i,void 0,t)}}),V.open()},Me=function(){var e=Ae(),t="single";1<(e=Re(e)).length&&(t="multi",e=Pe(e)),C.setDataSource(e),C.setDialogType(t),C.open()},Fe=function(e,t){return e.dms_devices_name.localeCompare(t.dms_devices_name)},Re=function(e){for(var t,i=0,o=e.length;i<o;i++)(t=e[i]).devices=t.devices.sort(Fe);return e},Pe=function(e){var t,i,o,a,n=B.length,r=e.length,d=[];for(i=0;i<n;i++)for(t=B[i],o=r-1;0<=o;o--)if((a=e[o]).id==t){d.push(a),e.splice(o,1),r=e.length;break}if(0<e.length)for(n=e.length,i=0;i<n;i++)d.push(e[i]);return d},He=function(){N.disableFloorNav(!1),f.hide(),h.show(),G&&Te(!1,!0),Ye()},Ye=function(t){S.open(),$.ajax({url:"/schedules/exceptionalDays"}).done(function(e){I=d.createExceptionalDaysByRepeatYear(e)}).fail(function(e){tt(e)}).always(function(){t=t||te();var e=[$.ajax({url:"/schedules"+t}),$.ajax({url:"/schedules/lists"})];$.when.apply(self,e).done(function(e,t){var i=e[0],o=d.parseFolderModel(t[0]);We(i,o)}).fail(function(e){tt(e)}).always(function(){S.close()})})},Ue=function(){return Te(!1,!0),!1},We=function(e,t){var i=d.createDataSource(e,t),o=Ke(i);o.read();var a=new Date(A(M.calendar.widget.view().shortDateForTitle()).format());M.calendar.widget.setDataSource(o),M.calendar.widget._selection&&(M.calendar.widget._selection.start=a,M.calendar.widget._selection.end=a),M.calendar.widget.date(a);var n=M.calendar.widget.viewName();M.calendar.widget.view(n),d.setDays(i);var r=new w.data.DataSource({data:i});r.read(),M.list.widget.setDataSource(r),M.list.widget.originFolders=t,M.list.widget.checkedFolderNames=[],_.trigger("selectDateType"),ve(0)},Ve=function(e,t,i){if(t?S.open(t.element):S.open(),i){var o=i.map(function(e){return e.id}).join();$.ajax({url:"/schedules/lists?ids="+o,method:"DELETE"}).done(function(){Be(e,t)}).fail(function(){S.close(),t&&t.close()})}else Be(e,t)},Be=function(e,t){var i=e.map(function(e){return e.id});$.ajax({url:"/schedules?ids="+i.join(),method:"DELETE"}).done(function(){Ye()}).fail(function(){}).always(function(){if(S.close(),t){var e=t.dataSource.data().filter(function(e){return e.id!==t.contentViewModel.id});0<e.length?t.setDataSource(e):t.close()}})},$e=function(){P.render(U)},Ge=!1,qe=function(e){var t,i,o;t=s(),i=G?M.search.widget.wrapper:M.calendar.widget.wrapper,o=t.view(),t._model.set("formattedShortDate",o.shortDateForTitle()),i.find(".k-sm-date-format").text(o.shortDateForTitle()),P.showIn("#schedule-main-view-content",e),e===M.calendar.view&&(Ge||(setTimeout(function(){w.bind(e.render(),M.calendar.widget._model)},10),Ge=!0),M.calendar.widget.refresh(),je(!0)),e===M.list.view&&setTimeout(function(){je(!1),w.bind(e.render(),M.calendar.widget._model)},10),e===M.search.view&&(M.search.calendarWidget.trigger("selectDateType"),setTimeout(function(){w.bind(e.render(),M.search.calendarWidget._model)},10))},je=function(e){if(void 0===e)return M.list.active;!0!==e&&!1!==e||(M.list.active=!e,M.calendar.active=e)},Xe=function(e){return!!I&&!!I[e.toDate()]},ze=function(e,t){d.setDays(e);var i={width:1472,height:"calc(100% - 66px)",hasCheckedModel:!0,isGroupListMode:!0,sortable:!0,messages:{noRows:L.prop("FACILITY_SCHEDULE_NO_SCHEDULE")},columns:[{field:"checked",width:72},{field:"name",title:L.prop("COMMON_NAME"),width:140,template:function(e){var t=e.value,i="";if(void 0!==t){var o=t.indexOf(":name:");i=t.slice(o+":name:".length)}return"folder.groupName"===e.field?'<div class="grid-cell-two-line-ellipsis">'+i+"</div>":'<div class="grid-cell-two-line-ellipsis">'+e.name+"</div>"},sortable:{allowUnsort:!1,compare:function(t,e,i){var o,a;if(o="folder.groupName"==t.field?m(t):t.name,a="folder.groupName"==e.field?m(e):e.name,void 0===o||void 0===a)return i?void 0!==o?1:0:void 0!==o?-1:0;var n=c.expandedFolderIds;if(void 0===t.schedules_folders_id||void 0===e.schedules_folders_id||-1!=n.indexOf(t.schedules_folders_id+"")&&-1!=n.indexOf(e.schedules_folders_id+""))return a<o?-1:a===o?0:1;if(t.schedules_folders_id!=e.schedules_folders_id)return 0;var r=c.dataSource.rootNodes().filter(function(e){return e.value==t.folder.groupName})[0],d=c.dataSource.childNodes(r),s=d.map(function(e){return e.id}).indexOf(t.id),l=d.map(function(e){return e.id}).indexOf(e.id);return s<l?i?1:-1:l==s?0:i?-1:1}}},{field:"activated",title:L.prop("COMMON_STATUS"),width:110,sortable:!1,template:function(e){if("folder.groupName"!==e.field)return e.activated?L.prop("FACILITY_SCHEDULE_ACTIVATED"):L.prop("FACILITY_SCHEDULE_NOT_ACTIVATED")}},{title:L.prop("COMMON_MENU_DEVICE"),width:127,template:function(e){if("folder.groupName"!==e.field){var t,i="-";if(e.devices){t=e.devices.length,e.devices[0]&&(i=e.devices[0].dms_devices_name);var o=t-1;0<o&&(i+=" (+"+o+")")}return'<div class="grid-cell-two-line-ellipsis">'+i+"</div>"}}},{title:L.prop("FACILITY_SCHEDULE_BUILDING"),width:108,template:function(e){if("folder.groupName"!==e.field){var t,i,o,a,n="-",r=[];if(i=e.devices){for(a=i.length,o=0;o<a;o++){var d;t=i[o],d=v(t.location).buildingName,-1==r.indexOf(d)&&r.push(d)}r[0]&&(n=r[0]),0<(a=r.length)-1&&(n+=" (+"+(a-1)+")")}return'<div class="grid-cell-two-line-ellipsis">'+n+"</div>"}}},{title:L.prop("COMMON_LOCATION"),width:90,template:function(e){if("folder.groupName"!==e.field){var t,i,o,a,n="-",r=[];if(i=e.devices){for(a=i.length,o=0;o<a;o++){var d;t=i[o],d=v(t.location).floor,-1==r.indexOf(d)&&r.push(d)}r[0]&&(n=r[0]),0<(a=r.length)-1&&(n+=" (+"+(a-1)+")")}return'<div class="grid-cell-two-line-ellipsis">'+n+"</div>"}}},{title:L.prop("FACILITY_SCHEDULE_REPEAT_DAY"),width:200,template:p.daysOfWeekTemplate},{title:L.prop("COMMON_OPERATION"),width:132,template:p.configuOperationListTemplate},{title:L.prop("FACILITY_SCHEDULE_PERIOD"),width:112,template:function(e){if("folder.groupName"!==e.field){var t="";return e.startDate&&(t=A(e.startDate).format("L").replace(/\./g,"-")),t+=" ~ <br/>",e.endDate=new Date(e.endDate),e.endDate&&(e.endDate.getFullYear()==d.MAX_END_DATE_YEAR?t=L.prop("FACILITY_SCHEDULE_ENDLESS"):t+=A(e.endDate).format("L").replace(/\./g,"-")),t}}},{title:L.prop("FACILITY_SCHEDULE_EXCEPTION"),width:100,template:function(e){if("folder.groupName"!==e.field){var o=0,t=e.exceptionalDays;return void 0===t?0:(t.forEach(function(e){var t,i;t=A(e.startDate),i=A(e.endDate),o+=i.diff(t,"days")+1}),o)}},sortable:!1},{field:"updated",title:L.prop("FACILITY_SCHEDULE_LAST_UPDATE"),width:132,template:function(t){if("folder.groupName"===t.field){var e=$("#schedule-scheduler-grid").data("kendoSchedulerTreeList");return void 0!==t.value&&void 0!==e?A(e.dataSource.data().find(function(e){return e.folder&&e.folder.groupName==t.value}).folder.updated.date).format("YYYY-MM-DD"):""}var i=new Date(t.updated.date);return A(i).format("YYYY-MM-DD")},sortable:{dir:"desc",allowUnsort:!1,compare:function(t,i,e){var o,a,n=$("#schedule-scheduler-grid").data("kendoSchedulerTreeList");if(!n)return 0;if(o="folder.groupName"==t.field&&void 0!==t.value?n.dataSource.data().find(function(e){return e.folder&&e.folder.updated&&e.folder.groupName==t.value}).folder.updated:t.updated,a="folder.groupName"==i.field&&void 0!==i.value?n.dataSource.data().find(function(e){return e.folder&&e.folder.updated&&e.folder.groupName==i.value}).folder.updated:i.updated,void 0===o||void 0===a)return void 0!==o||void 0!==a?e?void 0!==o?1:-1:void 0!==o?-1:1:0;var r=n.expandedFolderIds;if(void 0===t.schedules_folders_id||void 0===i.schedules_folders_id||-1!=r.indexOf(t.schedules_folders_id+"")&&-1!=r.indexOf(i.schedules_folders_id+""))return(o=A(o.date))<(a=A(a.date))?-1:a==o?0:1;if(t.schedules_folders_id!=i.schedules_folders_id)return 0;var d=n.dataSource.rootNodes().filter(function(e){return e.value==t.folder.groupName})[0],s=n.dataSource.childNodes(d),l=s.map(function(e){return e.id}).indexOf(t.id),c=s.map(function(e){return e.id}).indexOf(i.id);return l<c?e?1:-1:c==l?0:e?-1:1}}},{title:L.prop("COMMON_BTN_DETAIL"),width:72,template:function(e){if("folder.groupName"!==e.field)return"<span class='ic ic-info' data-originalid='"+e.originalid+"' data-uid='"+e.uid+"'></span>"}}],dataBound:function(e){var t=this.getCurrentDisplayFolderItem();G||(t.unshift({name:L.prop("FACILITY_SCHEDULE_FOLDER_NO_FOLDER"),id:null}),x.actions[Z].options.set("dataSource",t))},expand:function(e){var t=e.sender,i=t.createFolderItemDataFromTreeListModel(e.model);t.updateExpandedFolderId(i.id,!1)},collapse:function(e){var t=e.sender,i=t.createFolderItemDataFromTreeListModel(e.model);t.updateExpandedFolderId(i.id,!0)},dataSource:e,folderData:t},c=r.createNewWidget("schedule-scheduler-grid",w.ui.SchedulerTreeList,i);return c},Je=function(e,t){d.setDays(e);var i="listDay"===t?"calc(100% + 44px)":"100%",o={noRecords:{template:"<div class='no-records-text'>"+L.prop("FACILITY_SCHEDULE_NO_SEARCH_SCHEDULE")+"</div>"},columns:[{field:"checked",headerTemplate:'<input type="checkbox" id="grid-header-chkbox" class="k-checkbox grid-header-checkbox"><label class="k-checkbox-label grid-header-checkbox-label" for="grid-header-chkbox"></label>',template:p.checkboxCellTemplate,width:37},{field:"name",title:L.prop("COMMON_NAME"),width:140,template:function(e){return'<div class="grid-cell-two-line-ellipsis">'+e.name+"</div>"},sortable:{allowUnsort:!1,compare:function(e,t,i){var o,a;return o="name"==e.field?e.value:e.name,a="name"==t.field?t.value:t.name,void 0===o||void 0===a?i?void 0!==o?1:0:void 0!==o?-1:0:a<o?-1:a===o?0:1}}},{field:"activated",title:L.prop("COMMON_STATUS"),width:110,sortable:!1,template:function(e){if("folder.groupName"!==e.field)return e.activated?L.prop("FACILITY_SCHEDULE_ACTIVATED"):L.prop("FACILITY_SCHEDULE_NOT_ACTIVATED")}},{field:"devices",title:L.prop("COMMON_MENU_DEVICE"),width:127,template:function(e){if("folder.groupName"!==e.field){var t,i="-";if(e.devices){t=e.devices.length,e.devices[0]&&(i=e.devices[0].dms_devices_name);var o=t-1;0<o&&(i+=" (+"+o+")")}return i}},sortable:!1},{field:"building",title:L.prop("FACILITY_SCHEDULE_BUILDING"),width:108,template:function(e){if("folder.groupName"!==e.field){var t,i,o,a,n="-",r=[];if(i=e.devices){for(a=i.length,o=0;o<a;o++){var d;t=i[o],d=v(t.location).buildingName,-1==r.indexOf(d)&&r.push(d)}r[0]&&(n=r[0]),0<(a=r.length)-1&&(n+=" (+"+(a-1)+")")}return n}},sortable:!1},{field:"location",title:L.prop("COMMON_LOCATION"),width:90,template:function(e){if("folder.groupName"!==e.field){var t,i,o,a,n="-",r=[];if(i=e.devices){for(a=i.length,o=0;o<a;o++){var d;t=i[o],d=v(t.location).floor,-1==r.indexOf(d)&&r.push(d)}r[0]&&(n=r[0]),0<(a=r.length)-1&&(n+=" (+"+(a-1)+")")}return n}},sortable:!1},{field:"repeat",title:L.prop("FACILITY_SCHEDULE_REPEAT_DAY"),width:200,template:p.daysOfWeekTemplate,sortable:!1},{field:"operation",title:L.prop("COMMON_OPERATION"),width:132,template:p.configuOperationListTemplate,sortable:!1},{field:"period",title:L.prop("FACILITY_SCHEDULE_PERIOD"),width:112,template:function(e){if("folder.groupName"!==e.field){var t="";return e.startDate&&(t=A(e.startDate).format("L").replace(/\./g,"-")),t+=" ~ <br>",e.endDate=new Date(e.endDate),e.endDate&&(e.endDate.getFullYear()==d.MAX_END_DATE_YEAR?t=L.prop("FACILITY_SCHEDULE_ENDLESS"):t+=A(e.endDate).format("L").replace(/\./g,"-")),t}},sortable:!1},{field:"exception",title:L.prop("FACILITY_SCHEDULE_EXCEPTION"),width:100,template:function(e){if("folder.groupName"!==e.field){var o=0,t=e.exceptionalDays;return t?(t.forEach(function(e){var t,i;t=A(e.startDate),i=A(e.endDate),o+=i.diff(t,"days")+1}),o):0}},sortable:!1},{field:"updated",title:L.prop("FACILITY_SCHEDULE_LAST_UPDATE"),width:132,template:function(t){if("folder.groupName"===t.field){var e=$("#schedule-scheduler-grid").data("kendoSchedulerGrid");return void 0!==t.value&&void 0!==e?A(e.dataSource.data().find(function(e){return e.folder&&e.folder.groupName==t.value}).folder.updated.date).format("YYYY-MM-DD"):""}var i=new Date(t.updated.date);return A(i).format("YYYY-MM-DD")},sortable:{dir:"desc",allowUnsort:!1,compare:function(t,i,e){var o,a,n=$("#schedule-scheduler-grid").data("kendoSchedulerGrid");return n?(o="name"==t.field&&void 0!==t.value?n.dataSource.data().find(function(e){return e.folder&&e.folder.updated&&e.name==t.value}).folder.updated:t.updated,a="name"==i.field&&void 0!==i.value?n.dataSource.data().find(function(e){return e.folder&&e.folder.updated&&e.name==i.value}).folder.updated:i.updated,void 0===o||void 0===a?e?void 0!==o?1:0:void 0!==o?-1:0:(o=A(o.date))<(a=A(a.date))?-1:a==o?0:1):0}}},{title:L.prop("COMMON_BTN_DETAIL"),width:72,template:function(e){return"<span class='ic ic-info' data-id='"+e.id+"' data-uid='"+e.uid+"'></span>"}}],dataSource:e,height:i,scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!0,setCheckedAttribute:!0};return r.createNewWidget("schedule-scheduler-grid",w.ui.SchedulerGrid,o)},Ze=function(e,t){var i,o=b.getTimezone(),a=Ke(e);a.read();var n={date:new Date,footer:!1,height:"calc(100% - 115px);",editable:!1,selectable:!1,messages:{today:L.prop("FACILITY_SCHEDULE_TODAY")},views:[{type:"month",selected:!0,selectedShortDateFormat:"{0:yyyy-MM}",title:L.prop("COMMON_MONTH"),dayTemplate:function(e){var t=e.date,i=A(t),o=Xe(i)?"<i class='ic ic-error-calendar'></i>":"",a=$("#schedule-scheduler").data("kendoCustomScheduler"),n=0,r="";return a&&(a.dataSource.data().forEach(function(e){t>=e.start&&t<=e.end&&n++}),r=0!=n?(999<n&&(n="+999"),"<div class='month-day-schedule'><span class='month-day-schedule-count'>"+n+"</span>"+L.prop("FACILITY_SCHEDULE_MONTH_DAY_SCHEDULES")+"</div>"):""),'<div class="month-day-wrap" data-date="'+A(e.date).format("YYYY-MM-DD")+'"><span class="k-link k-nav-day">'+A(e.date).format("D")+"</span>"+o+r+"</div>"}},{type:"week",selectedShortDateFormat:"{0:yyyy-MM-dd} ~ {1:yyyy-MM-dd}"},{type:"day",selectedShortDateFormat:"{0:yyyy-MM-dd}"}],timezone:o,dataSource:a};return i=r.createNewWidget("schedule-scheduler",w.ui.CustomScheduler,n),t||(_=i),i},Ke=function(e){var t=b.getTimezone();return new w.data.SchedulerDataSource({data:e,schema:{timezone:t,model:{id:"id",fields:{id:{from:"id",type:"number"},title:{from:"name",type:"string"},start:{type:"date",from:"startDate"},end:{type:"date",from:"endDate"}}}}})},Qe=function(e){var t=e?"inline-block":"none",i=e?"absolute":"relative",o=e?"13px":"0px";$("#schedule-scheduler-grid .k-scheduler-navigation .k-nav-prev").css("display",t),$("#schedule-scheduler-grid .k-scheduler-navigation .k-nav-current").css("display",t),$("#schedule-scheduler-grid .k-scheduler-navigation .k-nav-next").css("display",t),$(".custom-scheduler .k-reset.k-header.k-scheduler-views").css("position",i),$(".k-reset.k-header.k-scheduler-views.legend").css("top",o)},et=function(e,a,t){var n;return"vAuto"===t&&(n="AirConditioner.Indoor.Ventilator",t="Auto"),{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){var i,o=e.length;if("undefined"==t){for(i=0;i<o;i++)if(void 0===e[i][a])return!0}else for(i=0;i<o;i++)if(-1!==e[i][a].indexOf(t))return!n||(n===e[i].id||void 0)}},value:t}},tt=function(e){var t=y.parseFailResponse(e);W.message(t),W.open()};return function(){var r;S.open();var t=te();window.document.body.style.userSelect="none",$.ajax({url:"/schedules/exceptionalDays"}).done(function(e){oe(e),I=d.createExceptionalDaysByRepeatYear(e)}).fail(function(e){oe([]),tt(e)}).always(function(){r=h.contentElement(0);var n=H.find(".k-tabstrip-items"),e=[$.ajax({url:"/schedules"+t}),$.ajax({url:"/schedules/lists"})];$.when.apply(self,e).done(function(e,t){var i=e[0],o=d.parseFolderModel(t[0]);ae(i,o),w.bind(n,x),w.bind($(r),x);var a=$("#schedule-folder-move-btn").data("kendoDropDownList");a.open(),a.close(),se(),x.listBtn.click(),_.trigger("selectDateType",{value:"all"})}).fail(function(e){tt(e)}).always(function(){S.close(),i.on("onfloorchange",ie)})})}(),{closeCreateBtnEvt:He}});