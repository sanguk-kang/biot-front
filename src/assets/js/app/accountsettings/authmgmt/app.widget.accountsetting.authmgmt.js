!function(i,o){var R=i.kendo,e=R.ui,s=e.Spreadsheet,r=R.ui.Widget,t=R.spreadsheet.Workbook,n=R.spreadsheet.Controller,a=R.spreadsheet.View,u=R.spreadsheet.Pane,l=R.spreadsheet.Grid,h=R.spreadsheet.Axis,d=R.spreadsheet.PaneAxis,c=R.spreadsheet.Sheet,p=R.spreadsheet.SheetNavigator,f=R.spreadsheet.Range,g={cell:"range",rowheader:"row",columnheader:"column",topcorner:"sheet",autofill:"autofill",outrange:"extra"},m=R.Class.extend({init:function(e){this._sheet=e,this._isBooleanSheet=e._isBooleanSheet,this.selection=R.spreadsheet.FIRSTREF.toRangeRef(),this.originalSelection=R.spreadsheet.FIRSTREF.toRangeRef(),this._activeCell=R.spreadsheet.FIRSTREF.toRangeRef(),this.originalActiveCell=R.spreadsheet.FIRSTREF},currentSelectionRange:function(){return this.selection.rangeAt(this.selectionRangeIndex).toRangeRef()},currentOriginalNavigationRange:function(){return this.originalSelection.rangeAt(this.selectionRangeIndex).toRangeRef()},currentNavigationRange:function(){return this.singleCellSelection()?this._sheet._sheetRef:this.selection.rangeAt(this.selectionRangeIndex).toRangeRef()},nextNavigationRange:function(){return this.singleCellSelection()||(this.selectionRangeIndex=this.selection.nextRangeIndex(this.selectionRangeIndex)),this.currentNavigationRange()},previousNavigationRange:function(){return this.singleCellSelection()||(this.selectionRangeIndex=this.selection.previousRangeIndex(this.selectionRangeIndex)),this.currentNavigationRange()},activeCell:function(e){return e&&(this.originalActiveCell=e.first(),this._activeCell=this._sheet.unionWithMerged(e.toRangeRef()),this._sheet.focus(e),this._sheet.triggerChange({activeCell:!0,selection:!0})),this._activeCell},select:function(e,t,i){if(e){if(e.eq(this.originalSelection)&&!this._sheet._isBooleanSheet)return;this._sheet.triggerSelect(new f(e,this._sheet)),this.originalSelection=e,this.selection=t,!1!==i?(e.isCell()?this.activeCell(e):this.activeCell(this.selection.lastRange().first()),this.selectionRangeIndex=this.selection.size()-1):this._sheet.triggerChange({selection:!0})}return this.selection},singleCellSelection:function(){return this._activeCell.eq(this.selection)}}),v=p.extend({completeSelection:function(e){this._sheet.completeSelection(e)}}),_=l.extend({pane:function(e){return new R.spreadsheet.PaneGrid(new k(this._rows,e.row,e.rowCount,this._headerHeight),new k(this._columns,e.column,e.columnCount,this._headerWidth),this)}}),w=h.extend({checkOutCellRange:function(e){for(var t=0,i=this.values.iterator(0,this._count-1),s=i.at(0);s<e&&t<this._count-1;)s+=i.at(++t);return t>=this._count-1&&s<e}}),k=d.extend({checkOutCellRange:function(e,t){return this._axis.checkOutCellRange(e+(this.frozen?0:t)-this.headerSize)}}),b=c.extend({_reinit:function(e,t,i,s,o,r,n,a,l,h,d){var c=e*t-1;n=n||{},this._defaultCellStyle={background:n.background,color:n.color,fontFamily:n.fontFamily,fontSize:n.fontSize,italic:n.italic,bold:n.bold,underline:n.underline,wrap:n.wrap},this._isBooleanSheet=!!h,this._rows=new w(e,i),this._columns=new w(t,s),this._mergedCells=[],this._frozenRows=0,this._frozenColumns=0,this._suspendChanges=!1,this._filter=null,this._showGridLines=!0,this._gridLinesColor=null,this._grid=new _(this._rows,this._columns,e,t,o,r),this._sheetRef=this._grid.normalize(R.spreadsheet.SHEETREF),this._properties=new R.spreadsheet.PropertyBag(c,this._defaultCellStyle),this._sorter=new R.spreadsheet.Sorter(this._grid,this._properties.sortable()),this._viewSelection=new m(this),this._editSelection=new m(this),this._formulaSelections=[],this._rowHeaderList=a,this._columnHeaderList=l,this._defaultHeaderStyle={fontSize:d&&d.fontSize}},navigator:function(){return this._navigator||(this._navigator=new v(this)),this._navigator},completeSelection:function(e){this._selectionInProgress&&this._isBooleanSheet&&"extra"!==e&&this.booleanSheetToggleData(),c.fn.completeSelection.call(this)},booleanSheetToggleData:function(){var e=this.selection(),t=e._ref;t instanceof R.spreadsheet.UnionRef?(t=t.refs[t.refs.length-1],e=new R.spreadsheet.Range(t,this)):t instanceof R.spreadsheet.CellRef&&(t=t.toRangeRef(),e=new R.spreadsheet.Range(t,this));var i,s,o,r=t.topLeft,n=t.bottomRight,a=n.row-r.row+1===this._rows._count,l=n.col-r.col+1===this._columns._count,h=a&&l,d=this._isSelectedAll(t),c=[];if(r.row==n.row&&r.col==n.col)e.value(!e.value());else{for(i=r.row;i<=n.row;i++){for(o=[],s=r.col;s<=n.col;s++)this.isHiddenRow(i)||this.isHiddenColumn(s)?o.push(e.values()[i-r.row][s-r.col]):a||l||h?o.push(!d):o.push(!e.values()[i-r.row][s-r.col]);c.push(o)}e.values(c)}},_isSelectedAll:function(e){var t,i,s=e.topLeft,o=e.bottomRight;for(t=s.row;t<=o.row;t++)for(i=s.col;i<=o.col;i++)if(!this.isHiddenRow(t)&&!this.isHiddenColumn(i)&&!1===this.selection().values()[t-s.row][i-s.col])return!1;return!0},getBooleanData:function(){if(this._isBooleanSheet){var e,t,i,s,o,r,n,a,l=this._booleanSheetKey,h=[],d=this._rowHeaderList||[],c=this._columnHeaderList||[],u=d.length,p=c.length;for(e=(t=l&&l.split(".")||[]).length,n=0;n<u;n++){for(s=[],a=0;a<p;a++)1==new R.spreadsheet.Range(new R.spreadsheet.CellRef(n,a),this).value()&&s.push(c[a].id);for((o={})[t[e-1]]=0<s.length?s:[],i=e-2;0<=i;i--)(r={})[t[i]]=o,o=r;o.id=d[n].id,h.push(o)}return h}}}),S=t.extend({init:function(e,t){R.Observable.fn.init.call(this),this.options=e,this._view=t,this._sheets=[],this._sheetsSearchCache={},this._sheet=this.insertSheet({rows:this.options.rows,columns:this.options.columns,rowHeight:this.options.rowHeight,columnWidth:this.options.columnWidth,headerHeight:this.options.headerHeight,headerWidth:this.options.headerWidth,dataSource:this.options.dataSource,rowHeaderList:this.options.rowHeaderList,columnHeaderList:this.options.columnHeaderList}),this.undoRedoStack=new R.util.UndoRedoStack,this.undoRedoStack.bind(["undo","redo"],this._onUndoRedo.bind(this)),this._context=new R.spreadsheet.FormulaContext(this),this._validationContext=new R.spreadsheet.ValidationFormulaContext(this),this._names=Object.create(null),this.fromJSON(this.options)},insertSheet:function(e){var t,i=this,s="number"==typeof(e=e||{}).index?e.index:i._sheets.length,o=i._sheets,r=function(e){var t="Sheet"+(e=e||1);return i.sheetByName(t)?r(e+1):t};if(!e.name||!i.sheetByName(e.name)){this._sheetsSearchCache={},t=e.name||r();var n=this.options.sheets&&this.options.sheets[s].rowHeaderList||null,a=this.options.sheets&&this.options.sheets[s].columnHeaderList||null;n&&0<=n.length&&(e.rows=0===n.length?1:n.length),a&&0<=a.length&&(e.columns=0===a.length?1:a.length);var l=this.options.sheets&&this.options.sheets[s].booleanSheet&&(this.options.sheets[s].booleanSheet.dataSource||[])||null,h=this.options.sheets&&this.options.sheets[s].booleanSheet&&(this.options.sheets[s].booleanSheet.propertyKey||"value")||null;l=l&&function(e,t,i,s){var o,r,n,a,l,h,d,c,u,p=[],f=e.length,g=i&&i.length||0,m=s&&s.length||0;for(o=t&&t.split(".")||[],c=0;c<g;c++){for(h=i[c].id,l=null,r=0;r<f;r++)e[r].id!==h||(l=e[r]);for(l=l||{},r=0;r<o.length;r++)l=l[o[r]]?l[o[r]]:{};for(a={},u=0;u<m;u++){for(n=!1,d=s[u].id,r=0;r<l.length;r++)l[r]!=d||(n=!0);a[o[o.length-1]+"_"+d]=n}p.push(a)}return p}(l,h,n,a);var d=new b(e.rows||this.options.rows,e.columns||this.options.columns,e.rowHeight||this.options.rowHeight,e.columnWidth||this.options.columnWidth,e.headerHeight||this.options.headerHeight,e.headerWidth||this.options.headerWidth,e.defaultCellStyle||this.options.defaultCellStyle,n,a,l,e.defaultHeaderStyle||this.options.defaultHeaderStyle);return d._workbook=this,d._name(t),this._bindSheetEvents(d),o.splice(s,0,d),e.data&&d.fromJSON(e.data),l?(d.setDataSource(l),d._booleanSheetKey=h):e.dataSource&&d.setDataSource(e.dataSource),this.trigger("change",{sheetSelection:!0}),d}}});function C(e){return["solid",(e.size||1)+"px",e.color||"#000"].join(" ")}function H(e,o,t,i,s,r,n){function a(e){var t,i=o.link;if(i||"object"==typeof o.value&&(i=o.value.link),i){var s={textDecoration:"none"};return o.color&&(s.color=o.color),o.underline&&(s.textDecoration="underline"),R.dom.element("a",{href:(/:\/\//.test(t=i)||(t="http://"+t),t),style:s,target:"_blank"},e?[e]:[])}return e}if(t||R.spreadsheet.draw.shouldDrawCell(o)||n){var l=o.left,h=o.top,d=o.width+1,c=o.height+1,u={},p=o.background,f=null;p&&(f=p,r&&((f=R.parseColor(f).toHSV()).v*=.9,f=f.toCssRgba()),f=C({color:f})),p&&(u.backgroundColor=p),o.color&&(u.color=o.color),o.fontFamily&&(u.fontFamily=o.fontFamily),o.underline&&(u.textDecoration="underline"),o.italic&&(u.fontStyle="italic"),o.textAlign&&(u.textAlign=o.textAlign),o.bold&&(u.fontWeight="bold"),o.fontSize&&(u.fontSize=o.fontSize+"px"),!0===o.wrap&&(u.whiteSpace="pre-wrap",u.overflowWrap="break-word",u.wordWrap="break-word"),o.borderLeft?(u.borderLeft=C(o.borderLeft),s&&(s[o.left]=!0)):f&&s&&!s[o.left]?u.borderLeft=f:(l++,d--),o.borderTop?(u.borderTop=C(o.borderTop),i&&(i[o.top]=!0)):f&&i&&!i[o.top]?u.borderTop=f:(h++,c--),o.borderRight?(u.borderRight=C(o.borderRight),s&&(s[o.right]=!0)):f&&s&&!s[o.right]?u.borderRight=f:d--,o.borderBottom?(u.borderBottom=C(o.borderBottom),i&&(i[o.bottom]=!0)):f&&i&&!i[o.bottom]?u.borderBottom=f:c--,u.left=l+"px",u.top=h+"px",u.width=d+"px",u.height=c+"px";var g=o.value,m=typeof g;if(o.format&&null!==g?(g=R.spreadsheet.formatting.format(g,o.format)).__dataType&&(m=g.__dataType):null==g||n||(g=R.dom.text(g)),!u.textAlign)switch(m){case"number":case"date":case"percent":u.textAlign="right";break;case"boolean":u.textAlign="center"}var v=[y.cell];t&&v.push(t),!1===o.enable&&v.push("k-state-disabled"),o.merged&&v.push("k-spreadsheet-merged-cell");var _=o.verticalAlign||"bottom";_&&g||n?n?(g=R.dom.element("div",{},""),v.push(o.value?y.booleanSelected:y.booleanDefault)):g=R.dom.element("div",{className:"k-vertical-align-"+_},[a(g)]):g=a(g);var w=g?[g]:[],k={style:u},b=o.validation;b&&!b.value&&(w.push(R.dom.element("span",{className:"k-dirty"})),v.push("k-dirty-cell"),k.title=b.message),k.className=v.join(" ");var S=R.dom.element("div",k,w);return e.push(S),S}}var x={view:"k-spreadsheet-view",fixedContainer:"k-spreadsheet-fixed-container",editContainer:"k-spreadsheet-edit-container",scroller:"k-spreadsheet-scroller",viewSize:"k-spreadsheet-view-size",clipboard:"k-spreadsheet-clipboard",cellEditor:"k-spreadsheet-cell-editor",barEditor:"k-spreadsheet-editor",topCorner:"k-spreadsheet-top-corner",filterHeadersWrapper:"k-filter-wrapper",filterRange:"k-filter-range",filterButton:"k-spreadsheet-filter",filterButtonActive:"k-state-active",horizontalResize:"k-horizontal-resize",verticalResize:"k-vertical-resize",icon:"k-icon",iconFilterDefault:"k-i-arrow-60-down",sheetsBar:"k-spreadsheet-sheets-bar",sheetsBarActive:"k-spreadsheet-sheets-bar-active",sheetsBarInactive:"k-spreadsheet-sheets-bar-inactive",cellContextMenu:"k-spreadsheet-cell-context-menu",rowHeaderContextMenu:"k-spreadsheet-row-header-context-menu",colHeaderContextMenu:"k-spreadsheet-col-header-context-menu",scrollerHorizontalHide:"k-spreadsheet-scroller-horizontal-hide",scrollerVerticalHide:"k-spreadsheet-scroller-vertical-hide"},y={cell:"k-spreadsheet-cell",vaxis:"k-spreadsheet-vaxis",haxis:"k-spreadsheet-haxis",rowHeader:"k-spreadsheet-row-header",columnHeader:"k-spreadsheet-column-header",pane:"k-spreadsheet-pane",data:"k-spreadsheet-data",mergedCell:"k-spreadsheet-merged-cell",mergedCellsWrapper:"k-merged-cells-wrapper",activeCell:"k-spreadsheet-active-cell",selection:"k-spreadsheet-selection",selectionWrapper:"k-selection-wrapper",autoFillWrapper:"k-auto-fill-wrapper",single:"k-single",top:"k-top",right:"k-right",bottom:"k-bottom",left:"k-left",resizeHandle:"k-resize-handle",columnResizeHandle:"k-column-resize-handle",rowResizeHandle:"k-row-resize-handle",resizeHint:"k-resize-hint",resizeHintHandle:"k-resize-hint-handle",resizeHintMarker:"k-resize-hint-marker",resizeHintVertical:"k-resize-hint-vertical",selectionHighlight:"k-spreadsheet-selection-highlight",series:["k-series-a","k-series-b","k-series-c","k-series-d","k-series-e","k-series-f"],booleanSheet:"k-spreadsheet-boolean-sheet",booleanDefault:"k-spreadsheet-boolean-sheet-default",booleanSelected:"k-spreadsheet-boolean-sheet-selected"};a.classNames=x,u.classNames=y;var z=u.extend({init:function(e,t,i){this._sheet=e,this._grid=t,this._isFixedCell=i},render:function(e,t){var i=u.classNames,o=this._sheet,r=this._grid,s=r.view(e,t);this._currentView=s,this._currentRect=this._rectangle(s.ref),this._selectedHeaders=o.selectedHeaders();var n=[];if(n.push(this.renderData()),n.push(this.renderSelection()),n.push(this.renderAutoFill()),n.push(this.renderEditorSelection()),n.push(this.renderFilterHeaders()),r.hasRowHeader){var a=R.dom.element("div",{className:i.rowHeader,style:{width:r.headerWidth+"px",top:s.rowOffset+"px"}});o._defaultHeaderStyle.fontSize&&(a.attr.style.fontSize=o._defaultHeaderStyle.fontSize),n.push(a),o.forEach(s.ref.leftColumn(),function(e){if(!o.isHiddenRow(e)){var t=o._rowHeaderList&&(o._rowHeaderList[e]&&o._rowHeaderList[e].name||o._rowHeaderList[e])||e+1,i=o.rowHeight(e);void 0!==o._rowHeaderList&&0===o._rowHeaderList.length&&(t="No Data"),a.children.push(R.dom.element("div",{className:this.headerClassName(e,"row"),style:{width:r.headerWidth+"px",height:i+"px"}},[R.dom.element("div",{className:"k-vertical-align-center","data-id":o._rowHeaderList&&o._rowHeaderList[e]&&o._rowHeaderList[e].id||""},[R.dom.text(t+"")])]))}}.bind(this))}if(r.hasColumnHeader){var l=R.dom.element("div",{className:i.columnHeader,style:{top:"0px",left:s.columnOffset+"px",width:this._currentRect.width+"px",height:r.headerHeight+"px"}});o._defaultHeaderStyle.fontSize&&(l.attr.style.fontSize=o._defaultHeaderStyle.fontSize),n.push(l);var h=0;o.forEach(s.ref.topRow(),function(e,t){if(!o.isHiddenColumn(t)){var i=o._columnHeaderList&&(o._columnHeaderList[t]&&o._columnHeaderList[t].name||o._columnHeaderList[t])||R.spreadsheet.Ref.display(null,1/0,t),s=o.columnWidth(t);void 0!==o._columnHeaderList&&0===o._columnHeaderList.length&&(i="No Data"),l.children.push(R.dom.element("div",{className:this.headerClassName(t,"col"),style:{position:"absolute",left:h+"px",width:s+"px",height:r.headerHeight+"px"}},[R.dom.element("div",{className:"k-vertical-align-center","data-id":o._columnHeaderList&&o._columnHeaderList[t]&&o._columnHeaderList[t].id||""},[R.dom.text(i+"")])])),h+=s}}.bind(this))}if(o.resizeHandlePosition()&&(r.hasColumnHeader||r.hasRowHeader)){var d=o._grid.normalize(o.resizeHandlePosition());s.ref.intersects(d)&&(o.resizeHintPosition()||this._isFixedCell||n.push(this.renderResizeHandle()))}var c=[i.pane];return r.hasColumnHeader&&c.push(i.top),r.hasRowHeader&&c.push(i.left),R.dom.element("div",{style:r.style,className:c.join(" ")},n)},renderData:function(){var t,s=this._sheet,e=this._currentView,o=R.dom.element("div",{className:u.classNames.data,style:{position:"relative",left:e.columnOffset+"px",top:e.rowOffset+"px"}}),i=this._currentRect,r=R.spreadsheet.draw.doLayout(s,e.ref,{forScreen:!0}),n=s._showGridLines;n&&(t=null,r.xCoords.forEach(function(e){e!==t&&(t=e,o.children.push(R.dom.element("div",{className:y.vaxis,style:{left:e+"px",height:i.height+"px",borderColor:s.gridLinesColor()}})))}),t=null,r.yCoords.forEach(function(e){e!==t&&(t=e,o.children.push(R.dom.element("div",{className:y.haxis,style:{top:e+"px",width:i.width+"px",borderColor:s.gridLinesColor()}})))}));var a={},l={};return r.cells.forEach(function(e){var t=l[e.col]||(l[e.col]={}),i=a[e.row]||(a[e.row]={});H(o.children,e,null,t,i,n,s._isBooleanSheet)}),o},renderSelection:function(){var e=u.classNames,t=[],i=[e.activeCell],s=[e.selection],o=this._sheet,r=o.activeCell().toRangeRef(),n=this._activeFormulaColor(),a=o.select();return o._isBooleanSheet&&(i.push(e.booleanSheet),s.push(e.booleanSheet)),i=i.concat(n,this._directionClasses(r)),s=s.concat(n),o.singleCellSelection()&&i.push(e.single),1===a.size()&&s.push("k-single-selection"),this._sheet.autoFillPunch()&&s.push("k-dim-auto-fill-handle"),a.forEach(function(e){e!==R.spreadsheet.NULLREF&&this._addDiv(t,e,s.join(" "))}.bind(this)),this._addTable(t,r,i.join(" ")),R.dom.element("div",{className:e.selectionWrapper},t)},_addTable:function(o,e,r){var n=this._sheet;if(this._currentView.ref.intersects(e)){var a=this._rectangle(e),l=this._sheet.activeCellCustomEditor();n.forEach(e.collapse(),function(e,t,i){if(i.left=a.left,i.top=a.top,i.width=a.width,i.height=a.height,H(o,i,r,null,null,!0,n._isBooleanSheet),l){var s=R.dom.element("div",{className:"k-button k-spreadsheet-editor-button",style:{left:i.left+i.width+"px",top:i.top+"px",height:i.height+"px"}});l.icon&&s.children.push(R.dom.element("span",{className:"k-icon "+l.icon})),o.push(s)}})}}}),L=a.extend({_resize:function(){var e=R._outerHeight,t=this.tabstrip?e(this.tabstrip.element):0,i=this.formulaBar&&this.options.actionbar?e(this.formulaBar.element):0,s=this.sheetsbar?e(this.sheetsbar.element):0;this.wrapper.height(this.element.height()-(t+i+s)),this.tabstrip&&this.tabstrip.quickAccessAdjust()},_chrome:function(){var e=this,t=o("<div class='k-spreadsheet-action-bar' />");e.options.actionbar||t.css("display","none"),t.prependTo(e.element);var i=o("<div class='k-spreadsheet-name-editor' />").appendTo(t);e.nameEditor=new R.spreadsheet.NameEditor(i);var s=o("<div />").appendTo(t);e.formulaBar=new R.spreadsheet.FormulaBar(s),e.options.toolbar&&e._tabstrip()},isAutoFill:function(e,t,i){return!this._sheet._isBooleanSheet&&a.fn.isAutoFill.call(this,e,t,i)},objectAt:function(e,t){var i,s,o=this._sheet._grid;if(e<0||t<0||e>this.scroller.clientWidth||t>this.scroller.clientHeight)i={type:"outside"};else if(e<o._headerWidth&&t<o._headerHeight)i={type:"topcorner"};else if(s=this.paneAt(e,t)){var r=s._grid.rows.index(t,this.scroller.scrollTop),n=s._grid.columns.index(e,this.scroller.scrollLeft),a="cell",l=new R.spreadsheet.CellRef(r,n),h=this._sheet.selectionInProgress();s._grid.rows.checkOutCellRange(t,this.scroller.scrollTop)||s._grid.columns.checkOutCellRange(e,this.scroller.scrollLeft)?a="outrange":this.isAutoFill(e,t,s)?a="autofill":this.isFilterIcon(e,t,s,l)?a="filtericon":!h&&e<o._headerWidth?(l=new R.spreadsheet.CellRef(r,-1/0),a=this.isRowResizer(t,s,l)?"rowresizehandle":"rowheader"):!h&&t<o._headerHeight?(l=new R.spreadsheet.CellRef(-1/0,n),a=this.isColumnResizer(e,s,l)?"columnresizehandle":"columnheader"):this.isEditButton(e,t)&&(a="editor"),i={type:a,ref:l}}else i={type:"outside"};return i.pane=s,i.x=e,i.y=t,i},_pane:function(e,t,i,s){var o=new z(this._sheet,this._sheet._grid.pane({row:e,column:t,rowCount:i,columnCount:s}),this.options.isFixedCell);return o.refresh(this.scroller.clientWidth,this.scroller.clientHeight),o},refresh:function(e){o(this.scroller).removeClass(x.scrollerVerticalHide+" "+x.scrollerHorizontalHide),this.element.width()>this._sheet._grid.totalWidth()&&o(this.scroller).addClass(x.scrollerHorizontalHide),this.element.height()>this._sheet._grid.totalHeight()&&o(this.scroller).addClass(x.scrollerVerticalHide),a.fn.refresh.call(this,e)}}),F=/:alphanum$/,N={tab:"next","shift+tab":"previous",enter:"lower","shift+enter":"upper",delete:"clearContents",backspace:"clearContents","shift+:alphanum":"edit",":alphanum":"edit","ctrl+:alphanum":"ctrl","alt+ctrl+:alphanum":"edit",":edit":"edit"},B=n.extend({onEntryAction:function(e,t){if(e.mod){var i=!0;switch(String.fromCharCode(e.keyCode)){case"A":this.navigator.selectAll();break;case"Y":this._workbook.undoRedoStack.redo();break;case"Z":this._workbook.undoRedoStack.undo();break;default:i=!1}i&&e.preventDefault()}else{var s=!1===this._workbook.activeSheet().selection().enable();if("delete"==t||"backspace"==t)s||this._execute({command:"ClearContentCommand"}),e.preventDefault();else if(F.test(t)||":edit"===t){if(s)return void e.preventDefault();":edit"!==t&&this.editor.value(""),this._workbook.activeSheet()._isBooleanSheet||this.activateEditor()}else this.navigator.navigateInSelection(N[t]),e.preventDefault()}},onMouseMove:function(e){var t=this._workbook.activeSheet();if(!t.resizingInProgress()&&!t.selectionInProgress()){var i=this.objectAt(e);this.view.options.isFixedCell||("columnresizehandle"===i.type||"rowresizehandle"===i.type?t.positionResizeHandle(i.ref):t.removeResizeHandle())}},onMouseDown:function(e){var t=this.objectAt(e);if(t.pane&&(this.originFrame=t.pane),"editor"===t.type)return this.onEditorEsc(),this.openCustomEditor(),void e.preventDefault();if(this.editor.canInsertRef(!1)&&t.ref)return this._workbook.activeSheet()._setFormulaSelections(this.editor.highlightedRefs()),this.navigator.startSelection(t.ref,this._selectionMode,this.appendSelection,e.shiftKey),void e.preventDefault();if(this._preventNavigation=!1,this.editor.deactivate(),!this._preventNavigation){var i=this._workbook.activeSheet();if(!this.view.options.isFixedCell&&("columnresizehandle"===t.type||"rowresizehandle"===t.type))return i.startResizing({x:t.x,y:t.y}),void e.preventDefault();if("filtericon"===t.type)return this.openFilterMenu(e),void e.preventDefault();this._selectionMode=g[t.type],this.appendSelection=e.mod,this.navigator.startSelection(t.ref,this._selectionMode,this.appendSelection,e.shiftKey)}},onContextMenu:function(e){this._workbook.activeSheet()._isBooleanSheet||n.fn.onContextMenu.call(this,e)},onMouseDrag:function(e){"extra"!==this._selectionMode&&n.fn.onMouseDrag.call(this,e)},onMouseUp:function(e){var t=this._workbook.activeSheet();t.completeResizing(),this.navigator.completeSelection(this._selectionMode),this.stopAutoScroll();var i=this.editor.activeEditor();if(i){for(var s=e.target;s;){if(s===i.element[0])return;s=s.parentNode}var o=this.objectAt(e);o&&o.ref&&i.canInsertRef(!1)&&(i.refAtPoint(t.selection()._ref),t._setFormulaSelections(i.highlightedRefs()))}},onDblClick:function(e){var t=this.objectAt(e),i=!1===this._workbook.activeSheet().selection().enable(),s=this._workbook.activeSheet()._isBooleanSheet;"cell"!==t.type||i||s||(this.editor.activate({range:this._workbook.activeSheet()._viewActiveCell(),rect:this.view.activeCellRectangle(),tooltip:this._activeTooltip()}).focus(),this.onEditorUpdate())}}),A=R.spreadsheet.SheetDataSourceBinder.extend({_change:function(){if(!this._skipRebind){var o=this.dataSource.view(),e=this.columns;!e.length&&o.length&&(this.columns=e=this._normalizeColumns(Object.keys(o[0].toJSON())),this._header());var r=e.map(function(e){return R.getter(e.field)});this.sheet.batch(function(){for(var e=Math.max(o.length,this._boundRowsCount),t=0;t<e;t++)for(var i=0;i<r.length;i++){var s=o[t]?r[i](o[t]):null;this.sheet._isBooleanSheet?this.sheet.range(t,i).value(s):this.sheet.range(t+1,i).value(s)}}.bind(this)),this._boundRowsCount=o.length}}});R.spreadsheet.SheetDataSourceBinder=A;var D=s.extend({options:{actionbar:!0,isFixedCell:!1,defaultHeaderStyle:{fontSize:"12px"}},init:function(e,t){r.fn.init.call(this,e,t),this.element.addClass(s.classNames.wrapper),this._view=new L(this.element,{messages:this.options.messages.view,toolbar:this.options.toolbar,sheetsbar:this.options.sheetsbar,actionbar:this.options.actionbar,isFixedCell:this.options.isFixedCell}),this._workbook=new S(this.options,this._view),this._controller=new B(this._view,this._workbook),this._autoRefresh=!0,this._bindWorkbookEvents(),this._view.workbook(this._workbook),this.refresh(),this._resizeHandler=function(){this.resize()}.bind(this),o(i).on("resize.kendoSpreadsheet",this._resizeHandler)},_workbookSelect:function(e){var t,i,s=this._workbook.activeSheet(),o=e.range._ref;if(e.selection=[],o instanceof R.spreadsheet.UnionRef)for(t=o.refs,i=0;i<t.length;i++)e.selection=e.selection.concat(E(t[i],s._rowHeaderList,s._columnHeaderList));else e.selection=e.selection.concat(E(o,s._rowHeaderList,s._columnHeaderList));void 0!==s._rowHeaderList&&0===s._rowHeaderList.length||void 0!==s._columnHeaderList&&0===s._columnHeaderList.length||this.trigger("select",e)},getBooleanData:function(e){var t=this._workbook.sheets();if(-1<e)return t[e].getBooleanData();var i,s=[];for(i=0;i<t.length;i++)s.push(t[i].getBooleanData());return s},headerFilter:function(e,t){var i,s,o,r,n,a=this._workbook.activeSheet(),l={row:a._rowHeaderList,column:a._columnHeaderList}[e],h={row:{hide:a.hideRow,unhide:a.unhideRow},column:{hide:a.hideColumn,unhide:a.unhideColumn}},d=[],c=[];if(l){if(i="number"==typeof t.length?(s=t,"and"):t.field?(s=[t],"and"):(s=t.filters,t.logic),a.select(R.spreadsheet.FIRSTREF),"or"===i){for(r=0;r<l.length;r++)h[e].hide.call(a,r);for(r=0;r<s.length;r++)for(o=s[r].operator,n=0;n<l.length;n++)"eq"===o?l[n][s[r].field]==s[r].value&&d.push(n):"neq"===o?l[n][s[r].field]!=s[r].value&&d.push(n):"contains"===o&&-1!=l[n][s[r].field].toString().indexOf(s[r].value)&&d.push(n)}else if("and"===i){for(r=0;r<l.length;r++)h[e].unhide.call(a,r);for(r=0;r<s.length;r++)for(o=s[r].operator,n=0;n<l.length;n++)"eq"===o?l[n][s[r].field]!=s[r].value&&c.push(n):"neq"===o?l[n][s[r].field]==s[r].value&&c.push(n):"contains"===o&&-1==l[n][s[r].field].toString().indexOf(s[r].value)&&c.push(n)}for(r=0;r<d.length;r++)h[e].unhide.call(a,d[r]);for(r=0;r<c.length;r++)h[e].hide.call(a,c[r])}}});function E(e,t,i){var s=[];if(e instanceof R.spreadsheet.CellRef)s.push({rowId:t&&t[e.row]&&t[e.row].id||"",columnId:i&&i[e.col]&&i[e.col].id||""});else if(e instanceof R.spreadsheet.RangeRef){var o,r,n=e.bottomRight,a=e.topLeft;for(o=a.row;o<=n.row;o++)for(r=a.col;r<=n.col;r++)s.push({rowId:t&&t[o]&&t[o].id||"",columnId:i&&i[r]&&i[r].id||""})}return s}e.plugin(D)}(window,jQuery);