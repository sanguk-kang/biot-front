!function(s,M){"use strict";var T=s.kendo,d=T.template('<div class="k-floatwrap k-header k-scheduler-toolbar grid-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-views k-scheduler-navigation"><li class="k-current-view-dropdownlist"><input id="toolbar-dropdownlist-btn" data-role="dropdownlist" data-text-field="text" data-value-field="value" data-bind="disabled: dateTypeFilter.disabled, source: dateTypeFilter.options.dataSource, events: {select: dateTypeFilter.options.select}"></input></li><li class="k-state-default k-header k-nav-today" data-action="today"><button data-role="button" class="k-button" data-bind="disabled: todayButton.disabled, events: {click: todayButton.options.click}"><span data-bind="text:todayButton.text"></span></button></li></ul><ul class="k-reset k-scheduler-navigation"><li class="k-state-default k-header k-nav-prev" data-action="previous"><a role="button" class="k-link"><span class="ic ic-date-prev"></span></a></li><li class="k-state-default k-nav-current" data-action="nav-current"><a role="button" class="k-link"><span class="k-icon k-i-calendar"></span><span class="k-sm-date-format" data-bind="text: formattedShortDate" style="display:block;">2017-04-23 ~ 2017-04-29</span></a><i class="ic ic-error-calendar" style="display:none;"></i></li><li class="k-state-default k-header k-nav-next" data-action="next"><a role="button" class="k-link"><span class="ic ic-date-next"></span></a></li></ul><ul class="k-reset k-header k-scheduler-views legend"><li class="k-current-view" data-name="week"><a role="button" class="k-link">Week</a></li></ul></div>'),l=T.template('<div class="k-floatwrap k-header k-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-navigation"><li class="k-state-default k-nav-today"><a role="button" href="\\#" class="k-link">${messages.today}</a></li></ul>#if(viewsCount === 1){#<a role="button" data-#=ns#name="#=view#" href="\\#" class="k-link k-scheduler-refresh"><span class="k-icon k-i-reload"></span></a>#}else{#<ul class="k-reset k-header k-scheduler-views">#for(var view in views){#<li class="k-state-default k-view-#= view.toLowerCase() #" data-#=ns#name="#=view#"><a role="button" href="\\#" class="k-link">${views[view].title}</a></li>#}#</ul>#}#</div><div class="k-floatwrap k-header k-scheduler-toolbar"><ul class="k-reset k-header k-scheduler-navigation"><li class="k-state-default k-nav-prev"><a role="button" href="\\#" class="k-link"><span class="k-icon k-i-arrow-60-left"></span></a></li><li class="k-state-default k-nav-current"><span class="k-sm-date-format" data-#=ns#bind="text: formattedShortDate"></span><span class="k-lg-date-format" data-#=ns#bind="text: formattedDate"></span></li><li class="k-state-default k-nav-next"><a role="button" href="\\#" class="k-link"><span class="k-icon k-i-arrow-60-right"></span></a></li></ul></div>'),r="click",c=".kendoScheduler",e=(T.date.MS_PER_DAY,T.ui),i=e.Scheduler;e.SchedulerView,T.date.MS_PER_MINUTE,T.date.setTime,T._outerHeight,T._outerWidth;var a=e.Popup,n=e.Calendar,t=i.extend({options:{name:"CustomScheduler"},currentSelectedDayElem:null,currentSelectedDay:null,currentSelectedDaySchedules:[],listWidget:null,events:["more"],init:function(e,t){i.fn.init.call(this,e,t),e.on(r+c,".k-scheduler-content .month-day-wrap",this._selectDayEvt.bind(this))},_toolbar:function(){var n=this,e=n.options,t=[];e.toolbar&&(t=M.isArray(e.toolbar)?e.toolbar:[e.toolbar]);var i=this._isMobilePhoneView()?l:d,a=s.I18N,o=M(i({messages:e.messages,dateTypeFilter:{value:"all",options:{dataSource:[{text:a.prop("FACILITY_SCHEDULE_ALL_SCHEDULE"),value:"all"},{text:a.prop("FACILITY_SCHEDULE_BY_MONTH"),value:"month"},{text:a.prop("FACILITY_SCHEDULE_BY_WEEK"),value:"week"},{text:a.prop("FACILITY_SCHEDULE_BY_DAY"),value:"day"}],select:function(e){n._model.dateTypeFilter.set("value",e.dataItem.value),n.trigger("selectDateType",{value:e.dataItem.value})}}},pdf:0<M.grep(t,function(e){return"pdf"==e||"pdf"==e.name}).length,ns:T.ns,views:n.views,viewsCount:n._viewsCount}));n.wrapper.append(o),n.toolbar=o,n._model.set("selectedText",a.prop("FACILITY_SCHEDULE_NO_SELECTED")),n._model.set("dateTypeFilter",{disabled:!1,value:"all",options:{dataSource:[{text:a.prop("FACILITY_SCHEDULE_ALL_SCHEDULE"),value:"all"},{text:a.prop("FACILITY_SCHEDULE_BY_MONTH"),value:"month"},{text:a.prop("FACILITY_SCHEDULE_BY_WEEK"),value:"week"},{text:a.prop("FACILITY_SCHEDULE_BY_DAY"),value:"day"}],select:function(e){n._model.dateTypeFilter.set("value",e.dataItem.value),n.trigger("selectDateType",{value:e.dataItem.value})}}}),n._model.set("todayButton",{text:a.prop("FACILITY_SCHEDULE_TODAY"),disabled:!0,options:{click:function(){var e=new Date;n.date(e),n.trigger("selectDateType")}}}),T.bind(n.toolbar,n._model),o.on(r+c,".k-pdf",function(e){e.preventDefault(),n.saveAsPDF()}),o.on(r+c,".k-scheduler-navigation li",function(e){var t=M(this),i=new Date(n.date()),a="";if(e.preventDefault(),!t.hasClass("k-state-disabled")){if(t.hasClass("k-nav-today"))a="today",i=new Date;else if(t.hasClass("k-nav-next"))a="next",i=n.view().nextDate();else if(t.hasClass("k-nav-prev"))a="previous",i=n.view().previousDate();else if(t.hasClass("k-nav-current")&&!n._isMobilePhoneView())return void n._showCalendar();n.trigger("navigate",{view:n._selectedViewName,action:a,date:i})||n.date(i)}}),o.on(r+c,".k-scheduler-views li, .k-scheduler-refresh",function(e){e.preventDefault();var t=M(this).attr(T.attr("name"));n.trigger("navigate",{view:t,action:"changeView",date:n.date()})||(n.view(t),n.element.find(".k-state-expanded").removeClass("k-state-expanded"))}),o.on(r+c,".k-scheduler-views li.k-current-view",function(){n.element.find(".k-scheduler-views").toggleClass("k-state-expanded")}),o.find("li").hover(function(){M(this).addClass("k-state-hover")},function(){M(this).removeClass("k-state-hover")})},_selectView:function(e){var t=this;e&&t.views[e]&&(t._selectedView&&t._unbindView(t._selectedView),t._selectedView=t._renderView(e),t._selectedViewName=e)},_bindView:function(e){i.fn._bindView.call(this,e),e.bind("more",this._viewMoreHandler.bind(this))},_viewMoreHandler:function(e){this.trigger("more",e)},rebind:function(){if(this.dataSource.fetch(),null!==this.currentSelectedDay){var e=_(this.currentSelectedDay).format("YYYY-MM-DD"),t=this.element.find('div[data-date="'+e+'"].month-day-wrap')[0];t&&(t.parentElement.classList.add("selected-day"),this.currentSelectedDayElem=t),this.trigger("change")}},_selectDayEvt:function(e){var t=this,i=e.currentTarget,a=i.parentElement,n=new Date(M(i).data("date"));null!==t.currentSelectedDayElem&&t.currentSelectedDayElem.parentElement.classList.remove("selected-day"),a.classList.add("selected-day"),t.currentSelectedDay=n,t.currentSelectedDayElem=i,t.currentSelectedDaySchedules=[],t.dataSource.data().forEach(function(e){n>=e.start&&n<=e.end&&t.currentSelectedDaySchedules.push(e)}),t.trigger("change")},_showCalendarAtListView:function(){var e=M("#schedule-scheduler-grid .k-nav-current"),t=this,i=M('<div class="k-calendar-container at-list-view"><div class="k-scheduler-calendar"/></div>');t.popupAtLisView||(t.popupAtLisView=new a(i,{anchor:e,open:function(){t.calendarAtListView||(t.calendarAtListView=new n(this.element.find(".k-scheduler-calendar"),{change:function(){var e=this.value();t.trigger("navigate",{view:t._selectedViewName,action:"changeDate",date:e})||(t.date(e),t.trigger("selectDateType",{value:t._model.dateTypeFilter.get("value")}),t.popupAtLisView.close())},min:t.options.min,max:t.options.max})),t.calendarAtListView.value(t.date())},copyAnchorStyles:!1})),t.popupAtLisView.open()}});T.ui.plugin(t);var _=s.moment,o=T.ui.TreeList,y=M.proxy,I={wrapper:"k-treelist k-grid k-widget",header:"k-header",button:"k-button",alt:"k-alt",editCell:"k-edit-cell",group:"k-treelist-group",gridToolbar:"k-grid-toolbar",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",gridContentWrap:"k-grid-content",gridFilter:"k-grid-filter",footerTemplate:"k-footer-template",loading:"k-i-loading",refresh:"k-i-reload",retry:"k-request-retry",selected:"k-state-selected",status:"k-status",link:"k-link",withIcon:"k-with-icon",filterable:"k-filterable",icon:"k-icon",iconFilter:"k-i-filter",iconCollapse:"k-i-collapse",iconExpand:"k-i-expand",iconHidden:"k-i-none",iconPlaceHolder:"k-icon k-i-none",input:"k-input",dropPositions:"k-i-insert-up k-i-insert-down k-i-plus k-i-insert-middle",dropTop:"k-i-insert-up",dropBottom:"k-i-insert-down",dropAdd:"k-i-plus",dropMiddle:"k-i-insert-middle",dropDenied:"k-i-cancel",dragStatus:"k-drag-status",dragClue:"k-drag-clue",dragClueText:"k-clue-text"},u=o.extend({options:{name:"SchedulerTreeList"},expandedFolderIds:[],originFolders:[],checkedFolderNames:[],emptyFolders:[],init:function(e,t){t.dataSource=this.createScheduleDs(t.dataSource),this.originFolders=t.folderData,o.fn.init.call(this,e,t)},setDataSource:function(e,t){t||(e=this.createScheduleDs(e)),o.fn.setDataSource.call(this,e)},createScheduleDs:function(e){return e instanceof T.data.DataSource||(e=new T.data.DataSource({data:e})).read(),this.originalDs=e,this.originalDs.bind("change",this._changeOriginalDsEvt.bind(this)),e},_changeOriginalDsEvt:function(e){var t,i,a,n,o,s,d,l;if("remove"==e.action){if(e.items){for(s=e.items.length,l=(d=this.dataSource).data(),a=0;a<s;a++)for(i=e.items[a],n=(o=l.length)-1;0<=n;n--)t=l[n],i.id==t.originalid&&l.splice(n,1);d.fetch()}}else if("itemchange"==e.action&&e.items&&e.field){var r=e.field;for(s=e.items.length,o=(l=(d=this.dataSource).data()).length,a=0;a<s;a++)for(i=e.items[a],n=0;n<o;n++)t=l[n],i.id==t.originalid&&(t[r]=i[r]);d.fetch()}},setDate:function(e,t){var i,a,n,o,s=this.originalDs.data(),d=s.length,l=!1,r=!1;e=_(e),t=_(t);var c,u,h=[];if(null===e&&null===t)for(n=0;n<d;n++)c=M.extend(!0,{},s[n]),h.push(c);else for(n=0;n<d;n++){if(i=s[n].startDate,a=s[n].endDate,i=_(i),a=_(a),l=i.isBetween(e,t,null,"[]"),r=a.isBetween(e,t,null,"[]"),c=M.extend(!0,{},s[n]),l&&r)o=a.diff(i,"days"),u=i.date(),console.info("query start date ~ query end date"),console.info(u),console.info(o);else if(l&&!r)o=t.diff(i,"days"),u=i.date(),console.info("query start date ~schedule end date"),console.info(u),console.info(o);else if(!l&&r)o=a.diff(e,"days"),u=e.date(),console.info("schedule start date ~ queryend date"),console.info(u),console.info(o);else{if(l=e.isBetween(i,a,null,"[]"),r=t.isBetween(i,a,null,"[]"),!l||!r)continue;o=t.diff(e,"days"),u=e.date()}c.originalid=c.id,h.push(c)}this._addEmptyFolders(h);var p=new T.data.DataSource({data:h,group:{field:"folder.groupName",dir:"desc"}});p.fetch(),this.setDataSource(p,!0),this.dataSource.sort({field:"updated",dir:"desc",compare:function(t,i,e){var a,n,o=M("#schedule-scheduler-grid").data("kendoSchedulerTreeList");return o?(a="folder.groupName"==t.field&&void 0!==t.value?o.dataSource.data().find(function(e){return e.folder&&e.folder.updated&&e.folder.groupName==t.value}).folder.updated:t.updated,n="folder.groupName"==i.field&&void 0!==i.value?o.dataSource.data().find(function(e){return e.folder&&e.folder.updated&&e.folder.groupName==i.value}).folder.updated:i.updated,void 0===a||void 0===n?void 0!==a||void 0!==n?e?void 0!==a?1:-1:void 0!==a?-1:1:0:(a=_(a.date))<(n=_(n.date))?-1:n==a?0:1):0}}),this.dataSource.fetch();var f=this.getCheckedData(),v=null,m=f.length,g=[];for(n=0;n<m;n++)v=f[n],g.push(v.id);this.checkByIds(g,!0),this._checkFolderByNames(this.checkedFolderNames)},updateExpandedFolderId:function(e,t){this._setExpandedFolderIds(e,t),this._render()},_setExpandedFolderIds:function(t,e){var i=this.expandedFolderIds;this._isEmptyFolder(t)?this.expandedFolderIds=i.filter(function(e){return e!=t}):e?-1!=i.indexOf(t+"")&&(this.expandedFolderIds=i.filter(function(e){return e!=t})):-1==i.indexOf(t+"")&&this.expandedFolderIds.push(t)},_isEmptyFolder:function(e){var t=null;return null===(t=this.originFolders.filter(function(e){return 0==e.schedules_ids.length}).map(function(e){return e.id+""}))&&(t=[]),-1!=t.indexOf(e+"")},_checkFolderByNames:function(t){var e=this.dataSource;e.data().forEach(function(e){"folder.groupName"===e.field&&-1!=t.indexOf(e.value)&&(e.checked=!0)}),e.fetch()},_addEmptyFolders:function(t){this.originFolders.filter(function(e){return 0==e.schedules_ids.length}).forEach(function(e){t.push({name:"dumy",isDummyScheduleItem:!0,folder:e}),this._setExpandedFolderIds(e.id,!0)}.bind(this))},getCurrentDisplayFolderItem:function(){var i=[],a=this;return a.dataSource.view().forEach(function(e){if("folder.groupName"==e.field&&void 0!==e.value){var t=a.createFolderItemDataFromTreeListModel(e);i.push(t)}}),i},createFolderItemDataFromTreeListModel:function(e){var a={name:":name:",id:":id:"},n={name:null,id:null},o=e.value+"";return void 0===e.value||Object.keys(a).forEach(function(e){var t=a[e],i=o.indexOf(t);n[e]=o.slice(i+a[e].length),o=o.replace(a[e]+n[e],"")}),n},_checkItemFromCheckbox:function(e){var t=e.checkbox;if(null!==t){var i,a,n=t.prop("checked"),o=this.originalDs;i=null===e.item?this.dataSource.data():void 0===e.item.data?[e.item]:e.item.data;for(var s=0;s<i.length;s++)void 0!==(a=i[s].originalid)&&(o.get(a).checked=n)}},getCheckedFolder:function(){var t=[],e=this.dataSource.data().filter(function(e){return e.hasChildren&&e.checked}),o={name:":name:",id:":id:"};return e.forEach(function(e){var a={name:null,id:null};if(e.value){var n=e.value+"";Object.keys(o).forEach(function(e){var t=o[e],i=n.indexOf(t);a[e]=n.slice(i+o[e].length),n=n.replace(o[e]+a[e],"")}),t.push(a)}}),t},getOriginalDsCheckedData:function(){var e=this.originalDs.data();return new T.data.Query(e).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:!0}]}).toArray()},_toggleChildren:function(e){var t=M(e.currentTarget),i=this.options,a=this.dataItem(t),n=a.expanded?"collapse":"expand";if(!this.trigger(n,{model:a})){var o=i.onceExpandParentLevel?i.onceExpandParentLevel:this.lastParentLevel;if(i.isGroupListMode&&a.level>=o){var s=this._currentExpandedModel,d=a.level;if(s[d]&&s[d]!==a){var l,r,c=this.dataSource;for(r=s[d]=a,l=d-1;0<=l;l--)r=c.parentNode(r),s[l]!==r&&(s[l]=r)}}this._toggle(a)}e.preventDefault()},_trs:function(e){var t,i,a,n,o,s,d,l,r,c,u,h,p,f,v=[],m=this.options,g=m.hasSelectedModel,_=m.hasCheckedModel,k=(m.isGroupListMode,this._currentExpandedModel),D=(m.onceExpandParentLevel?m.onceExpandParentLevel:this.lastParentLevel,e.level),b=e.data,w=this.dataSource,C=w.flatView(),E=w.aggregates()||{},S=e.columns;for(s=0,c=b.length;s<c;s++){if(a=[],n=(o=(t=b[s]).loaded()&&w.childNodes(t))&&o.length,(i={role:"row"})[T.attr("uid")]=t.uid,t.id&&(i["data-id"]=t.id),void 0!==t.level&&null!==t.level&&(i["data-level"]=t.level),t.parent_id){var x=this.dataSource.get(t.parent_id);a.push("child"),void 0===x.value&&a.push("none-folder"),0==s&&a.push("children-first-item"),s==c-1&&a.push("children-last-item")}if(n&&(w.data().forEach(function(e){t.id==e.parent_id&&e.isDummyScheduleItem&&a.push("empty-folder")}),i["aria-expanded"]=!!t.expanded,t.field&&(i["data-field"]=t.field),t.value?i["data-value"]=t.value:i["data-value"]="none-folder",u=t.hasCheckedChild,(_||g)&&u&&a.push("has-checked-child"),f=t.aggregates,p=t.field,f&&f[p]&&f[p].count)){if(h=C.indexOf(t),l=C.length,r=0,-1!==h)for(d=h+1;d<l;d++)if(C[d].hasChildren){if(C[d].level==t.level)break}else r++;f[p].count=r}e.visible?(this._absoluteIndex%2!=0&&a.push(I.alt),this._absoluteIndex++):i.style={display:"none"},g?t.selected&&a.push("k-state-selected"):_?t.checked&&a.push("k-state-checked"):0<=M.inArray(t.uid,e.selected)&&a.push(I.selected),n&&a.push(I.group),t._edit&&a.push("k-grid-edit-row"),i.className=a.join(" "),v.push(this._tds({model:t,attr:i,level:D},S,y(this._td,this))),n&&(k&&k[t.level],t.expanded&&(v=v.concat(this._trs({columns:S,aggregates:E,selected:e.selected,visible:e.visible&&!!t.expanded,data:o,level:D+1}))))}return this._hasFooterTemplate()&&(i={className:I.footerTemplate,"data-parentId":t.parentId},e.visible||(i.style={display:"none"}),v.push(this._tds({model:E[t.parentId],attr:i,level:D},S,this._footerTd))),v},_render:function(e){e=e||{};var t,i=this.options.messages,a=this.options.hasSelectedModel,n=this.options.hasCheckedModel,o=this.dataSource.rootNodes(),s=T.attr("uid"),d=this.expandedFolderIds;o.forEach(function(e){var t=this.createFolderItemDataFromTreeListModel(e);null===t.id?e.expanded=!0:-1!=d.indexOf(t.id+"")?e.expanded=!0:e.expanded=!1}.bind(this)),t=a||n?[]:this.select().removeClass("k-state-selected").map(function(e,t){return M(t).attr(s)}),this._absoluteIndex=0,this._angularItems("cleanup"),this._angularFooters("cleanup"),this._flushCache(),e.error?this._showStatus(T.template("#: messages.requestFailed # <button class='#= buttonClass #'>#: messages.retry #</button>")({buttonClass:[I.button,I.retry].join(" "),messages:i})):o.length?(this._hideStatus(),this._contentTree.render(this._trs({columns:this._nonLockedColumns(),aggregates:e.aggregates,selected:t,data:o,visible:!0,level:0})),this._hasLockedColumns&&(this._absoluteIndex=0,this._lockedContentTree.render(this._trs({columns:this._lockedColumns(),aggregates:e.aggregates,selected:t,data:o,visible:!0,level:0})))):this._showStatus(T.htmlEncode(i.noRows)),this._touchScroller&&this._touchScroller.contentResized(),this._muteAngularRebind(function(){this._angularItems("compile"),this._angularFooters("compile")}),a||n||this.items().filter(function(){return 0<=M.inArray(M(this).attr(s),t)}).addClass("k-state-selected"),this._adjustRowsHeight()},setSubGroupCheckbox:function(e,t){var i,a,n,o,s,d,l=this.dataSource,r=e.id,c=e.parent_id;a=(i=this.isCheckedAllGroup(e)).isCheckedAll,n=i.hasCheckedChild,e.checked=a,t||((o=this.getGroupCheckbox(r)).prop("checked",a),s=o.closest("tr"),n?s.addClass("has-checked-child"):s.removeClass("has-checked-child")),c&&(d=l.get(c),this.setSubGroupCheckbox(d,t))},_attachCheckedModelEvt:function(){var l=this,e=M(this.element);e.off("click"),e.on("click","tr:not(.k-treelist-group) .grid-checkbox-cell .k-checkbox",function(e){var t=M(this),i=t.closest("tr"),a=l._findItemFromCheckbox(t),n=t.prop("checked"),o=l.options.checkedLimit;if(!1!==o&&0!=o&&n&&l.getCheckedData().length>=o)return!1;a.checked=n,i.toggleClass("k-state-checked"),l.trigger("checked",{isHeader:!1,item:a,checkbox:t})}),e.on("click",".grid-checkbox-header .k-checkbox",function(e){var t=M(this),i=t.prop("checked"),a=l.options.checkedLimit;if(!1!==a&&0!=a&&i&&l.getCheckedData().length>=a)return!1;if(l.trigger("dataBinding"),i){l.checkAll(!0);var n=[];l.dataSource.data().forEach(function(e){"folder.groupName"===e.field&&-1===n.indexOf(e.value)&&n.push(e.value)}),l.checkedFolderNames=n}else l.uncheckAll(),l.checkedFolderNames=[];l.trigger("checked",{isHeader:!0,item:null,checkbox:t})}),e.on("click","tr.k-treelist-group .grid-checkbox-cell .k-checkbox",function(e){var t=M(this),i=l._findItemFromCheckbox(t),a=t.prop("checked");if(434<e.offsetX){var n=l.createFolderItemDataFromTreeListModel(i),o=!i.expanded;return t.prop("checked",!a),void l.updateExpandedFolderId(n.id,!o)}i.checked=a,l.trigger("dataBinding");var s=l.checkedFolderNames.indexOf(i.value);a?-1===s&&l.checkedFolderNames.push(i.value):-1!==s&&l.checkedFolderNames.splice(s,1),l.dataSource.fetch();var d={isGroupHeader:!0,item:{data:[i]},checkbox:t,checked:a};l.trigger("dataBound",d),l.trigger("checked",d)}),this.bind("dataBound",function(e){this.setHeaderCheckbox()})},checkByIds:function(e,t,i,a){var n=this.dataSource,o=n.data();if(a)if(n.pageSize()){var s=new T.data.Query(n.data()),d=n.filter();d&&(s=s.filter(d));var l=n.sort();l&&(s=s.sort(l)),o=s.toArray()}else o=n.flatView();var r=this.options.checkedLimit;!1!==r&&0!=r&&(i=r);var c,u=new T.data.Query(o).filter({field:"hasChildren",operator:"eq",value:!1}).toArray(),h=u.length,p=new T.data.Query(u).filter({field:"checked",operator:"eq",value:!0}).toArray();p.length&&i&&(i-=p.length);var f,v,m=(i=h<=i?h:i)||h,g=e.length,_=[];for(f=0;f<m;f++)for(c=u[f],v=0;v<g;v++)c.id==e[v]&&(c.checked=t,-1==_.indexOf(c.parent_id)&&_.push(c.parent_id));n.fetch()},filterForSearch:function(e){var t=e;this.searchFilter=t,this.isSearching=!0,this.dataSource.filter(t),this.isSearching=!1,this.searchFilter=null}});T.ui.plugin(u);var h=T.ui.Grid,p=(_=s.moment,h.extend({options:{name:"SchedulerGrid"},init:function(e,t){t.dataSource=this.createScheduleDs(t.dataSource),h.fn.init.call(this,e,t)},setDataSource:function(e,t){t||(e=this.createScheduleDs(e)),h.fn.setDataSource.call(this,e)},createScheduleDs:function(e){return e instanceof T.data.DataSource||(e=new T.data.DataSource({data:e})).read(),this.originalDs=e,this.originalDs.bind("change",this._changeOriginalDsEvt.bind(this)),e},_changeOriginalDsEvt:function(e){var t,i,a,n,o,s,d,l;if("remove"==e.action){if(e.items){for(s=e.items.length,l=(d=this.dataSource).data(),a=0;a<s;a++)for(i=e.items[a],n=(o=l.length)-1;0<=n;n--)t=l[n],i.id==t.id&&l.splice(n,1);d.fetch()}}else if("itemchange"==e.action&&e.items&&e.field){var r=e.field;for(s=e.items.length,o=(l=(d=this.dataSource).data()).length,a=0;a<s;a++)for(i=e.items[a],n=0;n<o;n++)t=l[n],i.id==t.id&&(t[r]=i[r]);d.fetch()}},setDate:function(e,t,i){var a,n,o,s,d,l,r,c,u,h=this.originalDs,p=!1,f=!1;e=_(e),t=_(t);var v=new T.data.DataSource({data:[]});for(d=(a=i?i.view():h.data()).length,s=0;s<d;s++){if(n=a[s].startDate,o=a[s].endDate,n=_(n),o=_(o),p=n.isBetween(e,t,null,"[]"),f=o.isBetween(e,t,null,"[]"),r=a[s],p&&f)l=o.diff(n,"days"),c=n.date(),console.info("query start date ~ query end date"),console.info(c),console.info(l);else if(p&&!f)l=t.diff(n,"days"),c=n.date(),console.info("query start date ~schedule end date"),console.info(c),console.info(l);else if(!p&&f)l=o.diff(e,"days"),c=e.date(),console.info("schedule start date ~ queryend date"),console.info(c),console.info(l);else{if(p=e.isBetween(n,o,null,"[]"),f=t.isBetween(n,o,null,"[]"),!p||!f)continue;l=t.diff(e,"days"),c=e.date()}_(e).date(void 0),u=M.extend(!0,{},r),v.add(u)}this.setDataSource(v,!0),this.dataSource.sort({field:"updated",dir:"desc",compare:function(t,i,e){var a,n,o=M("#schedule-scheduler-grid").data("kendoSchedulerGrid");return o?(a="name"==t.field&&void 0!==t.value?o.dataSource.data().find(function(e){return e.folder&&e.folder.updated&&e.name==t.value}).folder.updated:t.updated,n="name"==i.field&&void 0!==i.value?o.dataSource.data().find(function(e){return e.folder&&e.folder.updated&&e.name==i.value}).folder.updated:i.updated,void 0===a||void 0===n?e?void 0!==a?1:0:void 0!==a?-1:0:(a=_(a.date))<(n=_(n.date))?-1:n==a?0:1):0}})},_attachCheckedModelEvt:function(){var d=this,e=M(this.element);e.on("click","tr .grid-checkbox-cell .k-checkbox",function(e){var t=M(this),i=d._checkItemFromCheckbox(t);d.setGroupCheckbox(),d.setHeaderCheckbox(),d.dataSource.fetch(),d.trigger("checked",{isHeader:!1,item:i,checkbox:t})}),e.on("click",".grid-checkbox-cell .k-radio, .grid-checkbox-cell .k-radio-label",function(e){var t=M(this),i=d._findItemFromCheckbox(t),a=t.prop("checked");i.checked=a,d.setRadioBtn(i),d.trigger("checked",{isHeader:!1,isRadio:!0,item:i,checkbox:t})}),e.on("click",".grid-checkbox-header .k-checkbox",function(e){var t=M(this),i=t.prop("checked");d.trigger("dataBinding"),i?d.checkAll(!0,null,!0):d.uncheckAll(null,!0),d._setOrigDs(),d.trigger("checked",{isHeader:!0,item:null,checkbox:t})}),e.on("click",".grid-group-row .grid-group-row-checkbox",function(e){var t,i=M(this),a=i.prop("checked"),n=i.data("field"),o=i.data("value");d.trigger("dataBinding"),t=a?d.checkGroup(!0,n,o,!0):d.checkGroup(!0,n,o,!1),d.setHeaderCheckbox();var s={isGroupHeader:!0,field:n,value:o,item:t,checkbox:i,checked:a};d.trigger("dataBound",s),d.trigger("checked",s)}),this.bind("dataBound",function(e){this.setHeaderCheckbox(),this.setGroupCheckbox(),this.syncExpandedGroupRow(),this._checkedRow(e)})},_setOrigDs:function(){var e,t,i,a,n=this.dataSource.data(),o=n.length,s=this.originalDs;for(e=0;e<o;e++)i=(t=n[e]).id,a=t.checked,s.get(i).checked=a},_checkedRow:function(e){var t,i,a=this,n=a.dataSource.data(),o=[],s=n.length;for(t=0;t<s;t++)(i=n[t]).checked&&o.push(i.id);o.forEach(function(e){a.element.find("tr[data-id="+e+"]").toggleClass("k-state-checked")})},_checkItemFromCheckbox:function(e){var t,i,a=e.prop("checked"),n=this.dataSource,o=e.closest("tr").data("uid"),s=n.getByUid(o).id,d=n.data(),l=d.length;for(i=0;i<l;i++)s==(t=d[i]).id&&(t.checked=a);var r=this.originalDs.get(s);return r.checked=a,r},filterForSearch:function(r,e){var c=this,t=r.replace(/[^\w\s]/gi,function(e){return"\\"+e}),u=new RegExp("("+t+")+","g"),i=[];e.forEach(function(e){i.push({index:c.thead.find("th[data-field='"+e+"']").index(),category:e})}),c.tbody.find("tr[data-uid]").each(function(e){var a,n,o,s,d,l=this;i.forEach(function(e){a=M(l).find("td:eq("+e.index+")"),n=c.dataItem(l),o=a.text();for(var t=0,i=n.devices.length;t<i;t++)if(-1!==(d=n.devices[t]).dms_devices_name.indexOf(r)||-1!==d.dms_devices_id.indexOf(r)){s=!0;break}"devices"===e.category&&s&&""!==r?a.html('<div class="grid-cell-two-line-ellipsis"><span style="color:#0081c6">'+o+"</span></div>"):n[e.category]&&a.html('<div class="grid-cell-two-line-ellipsis">'+o.replace(u,'<span style="color:#0081c6">'+r+"</span>")+"</div>")})})}}));T.ui.plugin(p)}(window,jQuery),function(u,h){"use strict";var n=u.kendo,a=n.ui.Widget,i=n.ui.CommonDialog,e=n.ui.CommonDialog.extend({options:{name:"OneDayTimePickerDetailPopup",height:466,width:402,type:"single",timeout:0,events:["onSave","onSaved","onClose","onClosed"],contentViewModel:null},validators:[],init:function(e,t){this._initTitle(t),this._initActions(t),i.fn.init.call(this,e,t),this._renderTemplate()},_renderTemplate:function(){var e,t=this,i=t.options.contentViewModel;t.template='<div class="one-day-time-picker-detail-popup-wrapper" ><form data-template="one-day-time-picker-detail-popup-template" data-bind="source: slots"></form></div><script id="one-day-time-picker-detail-popup-template" type="text/x-kendo-template"><ul># for (var i = 0; i < timeSettings.length; i++) { #<li><span class="time-unit"> #= timeSettings[i].displayedHourText # </span><span class="input-wrapper"><input class="k-input" type="text" data-slot-id="#= id #" data-timesetting-id="#= timeSettings[i].uid #" data-bind="value: timeSettings[#=i#].displayedMinuteText" ></input></span><span class="minute-add-btn" data-slot-id="#= id #" data-bind=" events:{ click :  timeSettings[#=i#].clickAddMinuteBtn } " ></span><span class="minute-remove-btn" data-slot-id="#= id #" data-timesetting-id="#= timeSettings[i].uid #" data-bind=" events:{ click : timeSettings[#=i#].clickRemoveMinuteBtn } " ></span></li># } #</ul><\/script>',t.element.html(t.template),e=t.element.find(".one-day-time-picker-detail-popup-wrapper"),t._setDisplayedMinuteText(),n.bind(e,i),t._initValidator(),t._setDisabledTimsettingRemoveBtn(),t._setOnlyInputNumber(),t._attachMinuteBtnHoverEvt()},_initValidator:function(){var e,t,s=this,i=u.I18N,a=s.element.find("ul"),n=[],o=!1,d={rules:{timeSettingDupicated:function(e){var t=e.val(),i=h(e).data("slot-id"),a=h(e).data("timesetting-id");console.log(t),console.log(e),console.log(s.validators);var n=s.options.contentViewModel.slots[i].get("timeSettings"),o=!1;return n.forEach(function(e){e.displayedMinuteText===t&&e.uid!==a&&(o=!0)}),!o},timeSettingMinMax:function(e){var t=Number(e.val());return!!isNaN(t)||!(t<0||59<t)},timeSettingNumber:function(e){var t=Number(e.val());return!isNaN(t)}},messages:{timeSettingDupicated:i.prop("FACILITY_SCHEDULE_CREATE_TIME_SETTING_INVALID_MSG_DUPLICATED_MINUTE"),timeSettingMinMax:"timeSettingMinMax",timeSettingNumber:"timeSettingNumber"}};for(e=0;e<a.length;e++){var l=a.eq(e).find("input");for(t=0;t<l.length;t++){var r=l.eq(t),c=h(r.parent()).kendoCommonValidator(d).data("kendoCommonValidator");n.push(c),r.blur(function(){s._sortTimeSetting(),s._renderTemplate()})}}(s.validators=n).forEach(function(e){e.validate()||(o=!0)}),o?s.setActions(1,{disabled:!0}):s.setActions(1,{disabled:!1})},_setTimeSettingMinuteToZeroByElem:function(e){var t=h(e).data("slot-id"),i=h(e).data("timesetting-id");this.options.contentViewModel.slots[t].timeSettings.forEach(function(e){e.uid===i&&(e.set("minute",0),e.set("displayedMinuteText","00"))})},_setOnlyInputNumber:function(){function e(e){if(13==(e.keyCode?e.keyCode:e.which)&&n._setAllElemsFocusout(),""===h(e.target).val()&&void 0===e.key)return n._setTimeSettingMinuteToZeroByElem(e.target),void n.validators.forEach(function(e){e.validate()});if(/[^0123456789]/g.test(e.key))return h(e.target).val(""),void e.preventDefault();var t=h(e.target).val()+e.key,i=Number(e.key);if(!Number.isNaN(i)){var a=Number(t);3<=t.length?h(e.target).val(""):(a<0||59<a)&&e.preventDefault()}}var t,n=this,i=n.element.find("input"),a=i.length;for(t=0;t<a;t++)h(i.eq(t).on("input",function(){this.value=this.value.replace(/[^0-9.]/g,"")})),h(i.eq(t)).on("keypress",e.bind(n)),h(i.eq(t)).on("blur",e.bind(n))},_setDisplayedMinuteText:function(){var t=this;null!==t.options.contentViewModel&&t.options.contentViewModel.slots.forEach(function(e){e.timeSettings.forEach(function(e){e.set("displayedMinuteText",t._displayedMinuteText(e.displayedMinuteText))})})},_setAllElemsFocusout:function(){var e=document.querySelector(":focus");e&&e.blur()},_attachMinuteBtnHoverEvt:function(){var e,t,i=this,a=h(i.wrapper).find(".minute-add-btn"),n=h(i.wrapper).find(".minute-remove-btn");for(t=a.length,e=0;e<t;e++)a.eq(e).hover(function(){i._setAllElemsFocusout()});for(t=n.length,e=0;e<t;e++)n.eq(e).hover(function(){i._setAllElemsFocusout()})},_initTitle:function(){var e=u.I18N;this.options.title=e.prop("FACILITY_SCHEDULE_DETAIL_TIME_SETTINGS")},_initActions:function(){var e=u.I18N,i=this,t=[{text:e.prop("COMMON_BTN_CLOSE"),disabled:!1,action:function(e){e.sender.trigger("onClose")}},{text:e.prop("COMMON_BTN_SAVE"),disabled:!1,action:function(e){var t=i.options.contentViewModel.get("slots");t.forEach(function(e){e.timeSettings.forEach(function(e){""!==e.displayedMinuteText?e.minute=Number(e.displayedMinuteText):e.minute=""})}),t.forEach(function(e){e.timeSettings=e.timeSettings.filter(function(e){return""!==e.minute})}),i.options.contentViewModel.set("slots",t),e.sender.trigger("onSave",{result:i.options.contentViewModel})}}];i.options.actions=t},_onValidateTimeSetting:function(e){console.log("_onValidateTimeSetting")},_onChangeContentViewModel:function(){console.log("_onChangeContentViewModel")},_setDisabledTimsettingRemoveBtn:function(){var e=this.element,t=0;if(null!==this.options.contentViewModel&&(this.options.contentViewModel.slots.forEach(function(e){t+=e.timeSettings.length}),1==t)){var i=e.find(".minute-remove-btn").eq(0);i.css("pointer-events","none"),i.css("opacity","0.3")}},_sortTimeSetting:function(){var a=!1;this.options.contentViewModel.slots.forEach(function(e){var t=e.timeSettings.sort(function(e,t){var i=Number(e.displayedMinuteText)-Number(t.displayedMinuteText);return i<0&&(a=!0),i});0<e.get("timeSettings").length&&e.set("timeSettings",t)}),a&&this._renderTemplate()},setContentViewModel:function(e){var t=this,i=JSON.parse(JSON.stringify(e));i.slots.forEach(function(e){e.timeSettings.forEach(function(e){e.displayedMinuteText=t._displayedMinuteText(e.minute),e.displayedHourText=t._displayedHourText(e.hour),e.clickAddMinuteBtn=t.addTimeSetting.bind(t),e.clickRemoveMinuteBtn=t.removeTimeSetting.bind(t),e.onValidateTimeSetting=t._onValidateTimeSetting.bind(t)})}),i=n.observable(i),t.setOptions({contentViewModel:i}),t.options.contentViewModel.bind("change",t._onChangeContentViewModel.bind(t))},addTimeSetting:function(e){console.log("addTimeSetting");var t=h(e.target).data("slot-id"),i=this.options.contentViewModel.slots.filter(function(e){return e.id==t})[0],a=i.timeSettings,n=this._createTimeSettingModel(i,0);a.push(n),i.set("timeSettings",a),this._renderTemplate()},removeTimeSetting:function(e){console.log("removeTimeSetting");var t=h(e.target).data("slot-id"),i=h(e.target).data("timesetting-id"),a=this.options.contentViewModel.slots.filter(function(e){return e.id==t})[0],n=a.timeSettings;n=n.filter(function(e){return e.uid!==i}),a.set("timeSettings",n),this._renderTemplate()},_createTimeSettingModel:function(e,t){var i=this,a=e.gteTime;return{id:t,hour:a,minute:t,displayedMinuteText:i._displayedMinuteText(t),displayedHourText:i._displayedHourText(a),clickAddMinuteBtn:i.addTimeSetting.bind(i),clickRemoveMinuteBtn:i.removeTimeSetting.bind(i),onValidateTimeSetting:i._onValidateTimeSetting.bind(i)}},_displayedMinuteText:function(e){return null===e||""===e?"":Number.isNaN(Number(e))?e:"string"==typeof e&&"0"===e[0]?0==e?"00":e:"string"==typeof e&&"-"===e[0]?e:10<=e?e+"":"0"+e},_displayedHourText:function(e){return 10<=e?e+"":"0"+e+" :"}});n.ui.plugin(e);var t="dataBinding",o="dataBound",s="change",d=a.extend({events:[t,o,s],options:{name:"OneDayTimePicker",autoBind:!0,template:"",dataSource:[]},viewModel:null,slotsDetailPopup:null,init:function(e,t){var i=this;console.log("OneDayTimePicker::init"),a.fn.init.call(i,e,t),i._initViewModel(),i._renderTemplate(),i._initDetailPopup(),i._attachEvent(),i._dataSource()},_renderTemplate:function(){var e,t=this;t.template='<script id="one-day-time-picker-slots-template" type="text/x-kendo-template"><div class="one-day-time-picker-slot" data-uid="#=id#" data-bind="css: {activated: timeSettings.length > 0}">#if(ltTime != 24){#<span class="time-unit" data-bind="text: ltTime"></span>#}#<span class="added-item-count" data-bind="text:displayedCountText"></span></div><\/script><div class="one-day-time-picker-wrapper"><div class="one-day-time-picker-slots" data-template="one-day-time-picker-slots-template" data-bind="source: slots, css:{state-disabled: isDisabled}"></div></div><div id="one-day-time-picker-detail-popup"></div>',t.element.html(t.template),e=t.element.find(".one-day-time-picker-slots"),n.bind(e,t.viewModel)},_initViewModel:function(){var a=this;a.viewModel=n.observable({slots:function(){var e,t,i=[];for(e=0;e<24;e++)i.push({id:t=e,gteTime:t,ltTime:e+1,timeSettings:[],displayedCountText:a._displayedCountText});return i}(),isDisabled:!1})},setTimesettings:function(e){var t,i,a=this;a._initViewModel(),a._renderTemplate(),a._initDetailPopup(),a._attachEvent(),null!==e&&(e=e.split(":"),t=Number(e[0]),i=Number(e[1]),a._addSlotTimeSetting(a.viewModel.slots[t],i))},getTimesettings:function(){var e=this.viewModel.get("slots"),t=[];return e.forEach(function(e){e.timeSettings.forEach(function(e){t.push(e.displayedHourText.split(" :")[0]+":"+e.displayedMinuteText+":00")})}),t},_displayedCountText:function(){var e=this.get("timeSettings").length;return 0<e?e:""},_attachEvent:function(){this._attachSoltClickEvt(),this._attachViewModelChangeEvt()},_attachSoltClickEvt:function(){var t=this,i=0,a=null;t.element.find(".one-day-time-picker-slots").on("click",function(e){1===++i?a=setTimeout(function(){t._onClick(e),i=0},200):(clearTimeout(a),t._onDoubleClick(e),i=0)}).on("dblclick",function(e){e.preventDefault()})},_attachViewModelChangeEvt:function(){var e=this;e.viewModel.bind("change",function(){e.slotsDetailPopup.setContentViewModel(e.viewModel),e.trigger(s,{sender:e})})},_initDetailPopup:function(){var t=this,e=t.element.find("#one-day-time-picker-detail-popup");t.slotsDetailPopup=e.kendoOneDayTimePickerDetailPopup().data("kendoOneDayTimePickerDetailPopup"),t.slotsDetailPopup.bind("onSave",function(e){t._setViewModelByDetailPopupContetnViewModel(e.result)}),t.slotsDetailPopup.bind("onClose",function(e){t.slotsDetailPopup.setContentViewModel(t.viewModel)})},_setViewModelByDetailPopupContetnViewModel:function(e){var i=this;e.slots.forEach(function(e,t){i.viewModel.slots[t].set("timeSettings",e.timeSettings)})},_onClick:function(e){var t=h(e.target).data("uid"),i=this.viewModel.slots[t];0==i.get("timeSettings").length?this._addSlotTimeSetting(i,0):1==i.get("timeSettings").length&&i.set("timeSettings",[])},_onDoubleClick:function(e){console.log("doublelcick::call");var t=h(e.target).data("uid"),i=this.viewModel.slots[t];0==i.get("timeSettings").length&&this._addSlotTimeSetting(i,0),this._openTimeSettingDetailPopup()},_openTimeSettingDetailPopup:function(){console.log("_openTimeSettingDetailPopup::call");this.slotsDetailPopup._renderTemplate(),this.slotsDetailPopup.open()},_toggleDisabledState:function(){var e=this.viewModel.get("isDisabled");this.viewModel.set("isDisabled",!e)},enable:function(e){this.viewModel.set("isDisabled",!e)},_addSlotTimeSetting:function(e,t){var i=e.get("timeSettings"),a=this.slotsDetailPopup._createTimeSettingModel.bind(this.slotsDetailPopup);i.push(a(e,t)),e.set("timeSettings",i)},items:function(){return this.element.children()},setDataSource:function(e){this.options.dataSource=e,this._dataSource()},_dataSource:function(){var e=this;e.dataSource&&e._refreshHandler?e.dataSource.unbind(s,e._refreshHandler):e._refreshHandler=h.proxy(e.refresh,e),e.dataSource=n.data.DataSource.create(e.options.dataSource),e.dataSource.bind(s,e._refreshHandler),e.options.autoBind&&e.dataSource.fetch()},refresh:function(){this.trigger(t),this._refreshViewModel,this.trigger(o)},_refreshViewModel:function(){console.log("OneDayTimePicker::_refreshViewModel::call")}});n.ui.plugin(d)}(window,jQuery),function(o,l){"use strict";var n=o.kendo,a=(n.ui.Widget,n.ui.CommonDialog),s=1,e=n.ui.CommonDialog.extend({options:{name:"ScheduleFolderEditPopup",height:254,width:508,type:"single",timeout:0,events:["onSave","onSaved","onClose","onClosed"],folderApiURL:{post:"/schedules/lists",patch:"/schedules/lists/"},contentViewModel:n.observable({fieldName:"Name",id:null,value:"",folderNameValidator:{widget:null}})},init:function(e,t){var i=this;i._initConent(t),i._initActions(t),a.fn.init.call(i,e,t),i._renderTemplate(),i._initValidtorComponent()},_renderTemplate:function(){var e,t=this,i=t.options.contentViewModel,a='<div class="schedule-folder-edit-popup-content-wrapper k-content"><div class="field-name" data-bind="text: fieldName"></div><div class="input-wrapper"><input id="folder-name-validator" class="k-input" type="text" data-bind="value: value" placeholder="'+o.I18N.prop("FACILITY_SCHEDULE_NEW_FOLDER_PLACEHOLDER")+'"></input></div></div>';t.template=a,t.element.html(t.template),e=t.element.find(".schedule-folder-edit-popup-content-wrapper"),n.bind(e,i)},_initConent:function(){var e=o.I18N;this.options.title=e.prop("FACILITY_SCHEDULE_CREATE_FOLDER"),this.options.contentViewModel.fieldName=e.prop("FACILITY_SCHEDULE_CREATE_FOLDER_NAME")},_initValidtorComponent:function(){var t=this,e=o.I18N,i=t.options.contentViewModel,a=i.folderNameValidator,n={type:"name",rules:{duplicatedRule:function(e){return!0},requiredNoMsg:function(e){return!0},maxLengthCustomMsg:function(e){return e.val().trim().length<=30}},messages:{duplicatedRule:e.prop("FACILITY_SCHEDULE_DUPlICATED_NAME_EXIST"),requiredNoMsg:"",maxLengthCustomMsg:e.prop("COMMON_CANNOT_INPUT_MAX_MORE",30)}};a.widget=l("#folder-name-validator").kendoCommonValidator(n).data("kendoCommonValidator"),a.widget.element.on("blur",function(e){t.wrapper.find(".k-dialog-buttongroup button").eq(1).prop("disabled")||a.widget.validate("requiredNoMsg",""==l(e.target).val()&&""!=i.value)}),a.widget.bind("validate",function(e){t.setActions(s,{disabled:!e.valid}),""==e.sender.element.val()&&t.setActions(s,{disabled:!0})})},_validateRequired:function(){o.I18N;var e,t=this.options.contentViewModel.folderNameValidator;return e=0==t.widget.element.val().trim().length,t.widget.validate("requiredNoMsg",e),e},_initActions:function(){var e=o.I18N,s=new o.CommonLoadingPanel,d=this,t=[{text:e.prop("COMMON_BTN_CLOSE"),action:function(e){e.sender.trigger("onClose")}},{text:e.prop("COMMON_BTN_SAVE"),disabled:!0,action:function(e){var t=d.options.contentViewModel,i=t.get("value"),a=t.get("id"),n=t.folderNameValidator,o=a?d._reqPatchcheduleFolder:d._reqPostScheduleFolder;return d._validateRequired()||(i=l.trim(i),s.open(d.element),o.call(d,i,a).done(function(e){d.close()}).fail(function(e){n.widget.validate("duplicatedRule",!0)}).always(function(){s.close(),e.sender.trigger("onSave")})),!1}}];d.options.actions=t},open:function(e){var t=this,i=t.options.contentViewModel.folderNameValidator.widget;a.fn.open.call(this),e&&(t.options.contentViewModel.set("id",e.id),t.options.contentViewModel.set("value",e.name)),t.setActions(s,{disabled:!t.options.contentViewModel.get("id")}),i.hideMessages()},close:function(){this.options.contentViewModel.set("id",null),this.options.contentViewModel.set("value",""),a.fn.close.call(this)},_reqPostScheduleFolder:function(e){console.info("reqPostScheduleFolder");var t=this.options.folderApiURL.post,i={name:e};return l.ajax({url:t,method:"POST",data:i})},_reqPatchcheduleFolder:function(e,t){console.info("reqPatchcheduleFolder");var i=this.options.folderApiURL.patch+t,a={name:e};return l.ajax({url:i,method:"PATCH",data:a})}});n.ui.plugin(e)}(window,jQuery),function(s){var l=window.kendo,e=l.support,t=l.ui,i=t.Widget,o=(l.keys,l.parseDate,l.date.adjustDST),a=(l.date.weekInYear,l._extractFormat,l.template),n=(l.getCulture,l.support.transitions),d=(n&&n.css,a('<td#=data.cssClass# role="gridcell"><a tabindex="-1" class="k-link" href="\\#" data-#=data.ns#value="#=data.dateString#">#=data.value#</a></td>',{useWithBlock:!1}),a('<td role="gridcell">&nbsp;</td>',{useWithBlock:!1}),a('<td class="k-alt">#= data.weekNumber #</td>',{useWithBlock:!1}),l.support.browser),r=(d.msie&&d.version,l._outerHeight,l._outerWidth,".kendoCalendar"),c=(e.touch,e.touch,e.touch,s.proxy,s.extend,Date),u={month:0,year:1,decade:2,century:3},h=window.moment,p=t.Calendar;function f(e,t,i){var a,n=(a=new c,new c(a.getFullYear(),a.getMonth(),a.getDate()));return e&&(n=new c(+e)),n<t?n=new c(+t):i<n&&(n=new c(+i)),n}function v(e,t){return e instanceof Date&&t instanceof Date&&(e=e.getTime(),t=t.getTime()),e===t}var m,g=p.extend({options:{name:"ExecptionalCalender"},init:function(e,t){p.fn.init.call(this,e,t)},_header:function(){var e,t=this.element;t.find(".k-header")[0]||t.html('<div class="k-header"><a href="#" role="button" class="k-link k-nav-prev"><span class="k-icon k-i-arrow-60-left"></span></a><a href="#" role="button" aria-live="assertive" aria-atomic="true" class="k-link k-nav-fast"></a><a href="#" role="button" class="k-link k-nav-next"><span class="k-icon k-i-arrow-60-right"></span></a></div>'),e=t.find(".k-link"),this._title=e.eq(1),this._prevArrow=e.eq(0),this._nextArrow=e.eq(2)},_click:function(e){var t=this,i=t.options,a=new Date(+t._current),n=t._toDateObject(e);o(n,0),"month"==t._view.name&&t.options.disableDates(n)&&(n=t._value),h(a).format("M")===h(n).format("M")&&t._view.setDate(a,n),t.navigateDown(f(a,i.min,i.max))},navigateDown:function(e){var t=this,i=t._index,a=t.options.depth;e&&(i!==u[a]||v(t._value,t._current)&&v(t._value,e)||(t.value(e),t.trigger("change")))},_footer:function(){},_move:function(){},_toDateObject:function(e){var t=s(e).attr(l.attr("value")).split("/");return t=new c(t[0],t[1],t[2])}});t.plugin(g);var _=i.extend({options:{name:"ExecptionalCalenderList"},init:function(e,t){i.fn.init.call(this,e,t),this.wrapper=this.element,this.data=[],this.dataSource=[],this.calenderList=[],this.selectedDate=null,this.execptionalDate=[],this.mapDate={},this._initMapDate(),this._parseDataSource(),this._initDOM(),this._initComponent(),this._attchEvent(),this._todayCalender()},_initMapDate:function(){var e,t,i,a,n=this.mapDate;for(e=2019;e<=2099;e++)for(n[e]={},t=1;t<=12;t++)for(n[e][t]={},a=h(e+"-"+t,"YYYY-M").daysInMonth(),i=1;i<=a;i++)n[e][t][i]={execptional:!1,selected:!1}},_parseDataSource:function(){var e,t,i,a;if(console.log("execptional-calender: _parseDataSource"),this.data.data){var n=this.data.data();this.execptionalDate=[];for(var o=0,s=n.length;o<s;o++)if(i=n[o],e=h(i.startDate),t=h(i.endDate),i.repeatYear){a=2099-e.format("YYYY");for(var d=0;d<a;)this._parseMapDate(e,t),e.add(1,"year"),t.add(1,"year"),d++}else this._parseMapDate(e,t)}},_parseMapDate:function(e,t,i){var a,n="selected"===i?"selected":"execptional",o=null;a=t.diff(e,"days")+1;for(var s=0;s<a;s++)o=h(e).add(s,"days").format("YYYY/M/D").split("/"),this.mapDate[o[0]][o[1]][o[2]][n]=!0},_uniqArray:function(e){return e.reduce(function(e,t){return e.indexOf(t)<0&&e.push(t),e},[])},_setRepeatYearDate:function(){},_initDOM:function(){console.log("execptional-calender: _initDOM");var e=window.I18N;m="<div class='calender-slider-wrapper'><div class='calender-contents first'><div class='calender'></div></div><div class='calender-contents second'><div class='calender'></div></div><div class='calender-contents third'><div class='calender'></div></div></div><a class='ic arr-prev'></a><a class='ic arr-next'></a><a role='button' class='btn-today k-button'>"+e.prop("FACILITY_SCHEDULE_TODAY")+"</a></div>",this.element.append(s(m)),this.wrapper.addClass("execptional-calender-list")},_initComponent:function(){console.log("execptional-calender: _initComponent"),this._initCalender()},_initCalender:function(){for(var e=this,t=this.wrapper.find(".calender-contents"),i=[],a={month:{content:s("#execptional-calender-cell-template").html()},change:function(){e.selectedDate=this.value(),e._onChangeDate()}},n=l.culture().calendar.firstDay=0;n<t.length;n++){i.push(s(t[n]).find(".calender")),i[n].empty(),this.calenderList.push(i[n].kendoExecptionalCalender(a).data("kendoExecptionalCalender"));for(var o=0;o<n;o++)this.calenderList[n].navigateToFuture();this._setExecptionalDate(this.calenderList[n])}},_setExecptionalDate:function(e,t){for(var i,a,n,o="selected"===t?"selected":"execptional",s=0,d=(n=this._setFilterCurrentDate(t)).length;s<d;s++)a=l.toString(new Date(h(n[s])),"D"),(i=e.element.find('td:not(.k-other-month) [title="'+a+'"]'))[0]&&i.parent().addClass(o)},_setFilterCurrentDate:function(e){for(var t,i,a,n,o,s="selected"===e?"selected":"execptional",d=[],l=this.calenderList[0].current(),r=this.mapDate,c=0;c<3;c++)for(i=(o=h(l).add(c,"month")).format("YYYY"),a=o.format("M"),t=h(o).daysInMonth(),n=1;n<=t;n++)r[i][a][n][s]&&d.push(i+"-"+a+"-"+n);return d},_onChangeDate:function(){for(var e=0,t=this.calenderList.length;e<t;e++)h(this.calenderList[e].current()).format("M")!==h(this.selectedDate).format("M")&&this.calenderList[e].value(null)},_attchEvent:function(){var e=this,t=e.wrapper,i=t.find(".arr-prev"),a=t.find(".arr-next"),n=t.find(".btn-today");i.on("click",e._prevCalender.bind(e)),a.on("click",e._nextCalender.bind(e)),n.on("click",e._todayCalender.bind(e))},_removeTodayExcludingCurrentMonths:function(){for(var e=this.calenderList,t=h().format("M"),i=0,a=e.length;i<a;i++)t!==h(e[i].current()).format("M")&&e[i].wrapper.find(".k-today").removeClass("k-today")},_calenderNavigateTo:function(e){for(var t=0,i=this.calenderList.length;t<i;t++)for(var a=0;a<3;a++)"prev"===e?this.calenderList[t].navigateToPast():this.calenderList[t].navigateToFuture();this._setCalenderExecptionDate(),this._setCalenderSelectedExecptionDate(),this._removeTodayExcludingCurrentMonths()},_setCalenderExecptionDate:function(){for(var e=0,t=this.calenderList.length;e<t;e++)this._setExecptionalDate(this.calenderList[e]),this.calenderList[e].value(null)},_prevCalender:function(){this._calenderNavigateTo("prev")},_nextCalender:function(){this._calenderNavigateTo("next")},_todayCalender:function(){var e=this.calenderList,t=0,i=new Date(h().subtract(1,"months"));if(h(this.calenderList[0].current()).format("YYYY-M")!==h(i).format("YYYY-M")){for(var a=0,n=e.length;a<n;a++)this.calenderList[a].value(new Date(h(i).add(t,"months"))),this.calenderList[a].value(null),this._setExecptionalDate(this.calenderList[a]),this.setSelectedData(this.data,!0),t++;this._removeTodayExcludingCurrentMonths()}},_resetExecptional:function(){for(var e=this.wrapper.find(".execptional"),t=0,i=e.length;t<i;t++)s(e[t]).removeClass("execptional")},_parseSelectedData:function(e){for(var t,i,a,n,o=e.filter(function(e){return e.checked}),s=0,d=o.length;s<d;s++)if(t=o[s],i=h(t.startDate),a=h(t.endDate),t.repeatYear){n=2099-i.format("YYYY");for(var l=0;l<n;)this._parseMapDate(i,a,"selected"),i.add(1,"year"),a.add(1,"year"),l++}else this._parseMapDate(i,a,"selected")},_resetSelectedMapDate:function(){var e,t,i,a,n=this.mapDate;for(e=2019;e<=2099;e++)for(t=1;t<=12;t++)for(a=h(e+"-"+t,"YYYY-M").daysInMonth(),i=1;i<=a;i++)n[e][t][i].selected=!1},_resetMapDate:function(){var e,t,i,a,n,o=this.mapDate;for(e=2019;e<=2099;e++)for(t=1;t<=12;t++)for(a=h(e+"-"+t,"YYYY-M").daysInMonth(),i=1;i<=a;i++)(n=o[e][t][i]).selected=!1,n.execptional=!1},resetSelectedExecptional:function(e){for(var t=this.wrapper.find(".selected"),i=0,a=t.length;i<a;i++)s(t[i]).removeClass("selected");e||this._resetSelectedMapDate()},_setCalenderSelectedExecptionDate:function(){for(var e=0,t=this.calenderList.length;e<t;e++)this._setExecptionalDate(this.calenderList[e],"selected"),this.calenderList[e].value(null)},setDataSource:function(e){e=e||[],this.data=e,this._resetExecptional(),this._resetMapDate(),this._parseDataSource(),this._setCalenderExecptionDate()},setSelectedData:function(e,t){e=e||[],this.resetSelectedExecptional(t),t||this._parseSelectedData(e),this._setCalenderSelectedExecptionDate()}});t.plugin(_)}(jQuery),function(o){var t,s=window.kendo,e=s.ui,i=e.Widget,h=window.moment,n=1,d=!1,a=i.extend({options:{name:"ExceptionDayList",events:["onSave","onClose"],isRepeat:!1,resizable:!1},init:function(e,t){i.fn.init.call(this,e,t),this.wrapper=this.element,this.popup=null,this.msgDialog=null,this.grid=null,this.data=null,this.viewModel=null,this.confirmDialog,this.execptionalDate=[],this.totalCheckCount=0,this.isRepeat=!1,this.isEdit=!1,t&&(t.isRepeat&&(this.isRepeat=t.isRepeat),t.resizable&&(this.resizable=t.resizable),t.duplicateDateInspection&&(this.duplicateDateInspection=t.duplicateDateInspection)),this._parseDataSource(),this._initDOM(),this._initComponent(),this._attchEvent()},_parseDataSource:function(){console.log("execptional-calender: _parseDataSource")},_initDOM:function(){console.log("execptional-calender: _initDOM");var e=window.I18N;t="<div class='exception-list-container'><div class='exception-top-block'><p class='title'>"+e.prop("FACILITY_SCHEDULE_EXCEPTION_DAY")+'</p><ul class=\'schedule-actions-list\'><li><button class="k-button add" data-bind="enabled: actions.add.enabled">'+e.prop("COMMON_BTN_ADD")+'</button></li><li><button class="k-button edit" data-bind="enabled: actions.edit.enabled">'+e.prop("COMMON_BTN_EDIT")+'</button></li><li><button class="k-button delete" data-bind="enabled: actions.delete.enabled">'+e.prop("COMMON_BTN_DELETE")+"</button></li></ul></div><div class='exception-grid k-grid k-widget'></div><div class='exception-popup pop-confirm'></div></div>",this.element.html(t),this.wrapper.addClass("exception-day-list"),this._initBinding()},_initComponent:function(){console.log("execptional-calender: _initComponent"),this._initPopup(),this._initActionBtn(),this._initGrid(),this._initConfirmPopup(),this._initValidator()},_initBinding:function(){var e=this.element.find(".schedule-actions-list");this.viewModel=s.observable({actions:{add:{enabled:!0},edit:{enabled:!1},delete:{enabled:!1}}}),s.bind(e,this.viewModel)},_initConfirmPopup:function(){var e=o("<div/>");this.confirmDialog=e.kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog")},_initPopup:function(){var e=this.wrapper.find(".exception-popup"),t=this,i=window.I18N,a="<div class='exception-popup-contents'><div class='key'>"+i.prop("COMMON_NAME")+"</div><div class='value' data-role='commonvalidator' data-type='name' data-bind='events:{validate:name.change}' data-required='true'><input class='k-input text-input' type='text' placeholder='"+i.prop("FACILITY_SCHEDULE_PLACEHOLDER_NAME")+"' data-bind='value: name.value' required></input></div><div class='key'>"+i.prop("FACILITY_SCHEDULE_PERIOD")+"</div><div class='value'><input class='popup-date-picker start' data-role='commondatepicker' data-bind='value: startDate.value, events: { change: startDate.change }'></input><span class='period-wave'>~</span><input class='popup-date-picker end' data-role='commondatepicker' data-bind='value: endDate.value, events: { change: endDate.change }'></input></div><div class='key'>"+i.prop("FACILITY_SCHEDULE_REPEAT")+"</div><div class='value'><input type='checkbox' id='test-checkbox1' class='k-checkbox' checked data-bind='checked: repeatYear.checked, enabled: isRepeat'><label for='test-checkbox1' class='k-checkbox-label'>"+i.prop("FACILITY_SCHEDULE_PERIOD_YEAR")+"</label></div><div class='key'>"+i.prop("COMMON_DESCRIPTION")+"</div><div class='value' data-role='commonvalidator' data-type='description' data-key='description'><input class='k-input text-input' type='text' placeholder='"+i.prop("FACILITY_SCHEDULE_PLACEHOLDER_DESCRIPTION")+"' data-bind='value: description.value' ></input></div></div>";this.popup=e.kendoDetailDialog({width:"492px",title:i.prop("FACILITY_SCHEDULE_ADD_EXCEPTION_DAY"),height:586,detailContentTemplate:a,contentViewModel:{id:{value:null},name:{value:"",valid:!1,change:t._onChangeName},startDate:{value:new Date,change:t._onChangeStartDate},endDate:{value:new Date,change:t._onChangeEndDate},isRepeat:this.isRepeat,repeatYear:{checked:!1},description:{value:"",valid:!1,change:t._onChangeDesc},_checkDateIsBeforeToday:t._checkDateIsBeforeToday,_checkStartDateEndDateTimePicker:t._checkStartDateEndDateTimePicker},buttonsIndex:{CLOSE:0,EDIT:2,CANCEL:3,SAVE:1,REGISTER:4,DEREGISTER:5,DELETE:6},isCustomActions:!0,actions:[{text:i.prop("COMMON_BTN_CLOSE"),visible:!0,action:t._closeExceptionPopup},{text:i.prop("COMMON_BTN_SAVE"),visible:!0,disabled:!0,action:t._saveExceptionPopup.bind(t)}],onTypeChange:this._onTypeChangeEvt.bind(t),enableSaveBtnCondition:this._enableSaveBtnCondition}).data("kendoDetailDialog");var n=o("<div/>");this.msgDialog=n.kendoCommonDialog().data("kendoCommonDialog")},_onTypeChangeEvt:function(e){var t=e.type,i=e.sender.BTN,a=this.popup;a&&("save"===t?(a.setActions(i.REGISTER,{visible:!1}),a.setActions(i.CANCEL,{visible:!1}),a.setActions(i.EDIT,{visible:!1}),a.setActions(i.DEREGISTER,{visible:!1}),a.setActions(i.CLOSE,{visible:!0}),a.setActions(i.SAVE,{visible:!0,disabled:!0})):(a.setActions(i.SAVE,{visible:!0,disabled:!1}),a.setActions(i.CANCEL,{visible:!1}),a.setActions(i.DEREGISTER,{visible:!1}),a.setActions(i.REGISTER,{visible:!1}),a.setActions(i.CLOSE,{visible:!0}),a.setActions(i.EDIT,{visible:!1})))},_saveExceptionPopup:function(e){var t=this.isEdit?"onEdit":"onSave",i=this.popup.contentViewModel,a=this.data.get(i.id.value),n={name:i.name.value,startDate:i.startDate.value,endDate:i.endDate.value,repeatYear:i.repeatYear.checked,description:i.description.value};return this.isEdit&&(n.id=i.id.value,a.name===n.name&&delete n.name),this._trim(n),this._dateFormating(n),!this._validationInput()&&(this._validation(this.isEdit)?(this.msgDialog.open(),!1):(this.trigger(t,{sender:e.sender,result:n}),this.grid.uncheckAll(),this._actionBtnEnabled(),void(this._validation(this.isEdit)||this.popup.close())))},_trim:function(e){e.name&&(e.name=e.name.trim()),e.description&&(e.description=e.description.trim())},_dateFormating:function(e){e.startDate=h(e.startDate).format("YYYY-MM-DD"),e.endDate=h(e.endDate).format("YYYY-MM-DD")},_validationInput:function(){var e=this.popup.contentViewModel,t=this.popup.element.find('.value[data-type="name"]').data("kendoCommonValidator"),i=!1;return d=!0,t.validate()||(i=!0,e.name.set("value","")),d=!1,i},_validation:function(e){var t=this.popup.contentViewModel,i=e?t.id.value:null;return!!this._duplicationTitle(t.name.value,i)||!!this._duplicationDate(t.startDate.value,t.endDate.value,i)},_duplicationTitle:function(e,t){if(this.data){for(var i,a=this.data.data(),n=0,o=a.length;n<o;n++)if(i=a[n].name,t!==a[n].id&&e===i)return this.msgDialog.message(window.I18N.prop("FACILITY_SCHEDULE_EXCEPTION_DAY_DUPlICATED_NAME_EXIST")),!0;return!1}},_duplicationDate:function(e,t,i){if(this.data)for(var a,n,o,s,d=this.data.data(),l=this._compareDateFormating(e,t),r=0,c=d.length;r<c;r++)if(a=d[r],o=h(a.startDate),s=h(a.endDate),i!==a.id){if(a.repeatYear){n=2099-o.format("YYYY");for(var u=0;u<n;){if(this._currentDulpicationDate(o,s,e,t,l))return!0;o.add(1,"year"),s.add(1,"year"),u++}}if(this._currentDulpicationDate(o,s,e,t,l))return!0}},_currentDulpicationDate:function(e,t,i,a,n){var o=this._compareDateFormating(e,t);return this.duplicateDateInspection&&this._betweenDate(i,a,e,t)?(this.msgDialog.message(window.I18N.prop("FACILITY_SCHEDULE_EXCEPTION_DAY_DUPlICATED_DATE_EXIST")),!0):n===o?(this.msgDialog.message(window.I18N.prop("FACILITY_SCHEDULE_EXCEPTION_DAY_DUPlICATED_DATE_EXIST")),!0):void 0},_betweenDate:function(e,t,i,a){return e="string"==typeof e?e:h(e).format("YYYY-MM-DD"),t="string"==typeof t?t:h(t).format("YYYY-MM-DD"),i="string"==typeof i?i:h(i).format("YYYY-MM-DD"),a="string"==typeof a?a:h(a).format("YYYY-MM-DD"),h(e).isBetween(i,a,null,"[]")&&h(t).isBetween(i,a,null,"[]")||h(i).isBetween(e,a,null,"[]")&&h(a).isBetween(i,t,null,"[]")||h(i).isBetween(e,t,null,"[]")&&h(t).isBetween(i,a,null,"[]")||h(e).isBetween(i,a,null,"[]")&&h(a).isBetween(e,t,null,"[]")},_compareDateFormating:function(e,t){return h(e).format("YYYY-MM-DD")+h(t).format("YYYY-MM-DD")},_closeExceptionPopup:function(e){e.sender.trigger("onClose")},_initActionBtn:function(){var e=this.wrapper.find(".schedule-actions-list .k-button.add"),t=this.wrapper.find(".schedule-actions-list .k-button.edit"),i=this.wrapper.find(".schedule-actions-list .k-button.delete"),a=this;e.on("click",a._onActionAdd.bind(a)),t.on("click",a._onActionEdit.bind(a)),i.on("click",a._onActionDelete.bind(a))},_setPopupContents:function(e){var t={name:"",startDate:new Date,endDate:new Date,description:""},i="edit"===e?this.getCheckedDate()[0]:t,a=this.popup.options.contentViewModel;"edit"===e&&(a.id.value=i.id),a.name.value=i.name,a.startDate.value=i.startDate,a.endDate.value=i.endDate,a.repeatYear.checked=i.repeatYear,a.description.value=i.description},_setPopupTitle:function(e){var t=window.I18N,i="add"===e?t.prop("FACILITY_SCHEDULE_ADD_EXCEPTION_DAY"):t.prop("FACILITY_SCHEDULE_EDIT_EXCEPTION_DAY");this.popup.title(i)},_onActionAdd:function(){this.isEdit=!1,this._setPopupTitle("add"),this._setPopupContents("save"),this.popup.open("save"),this._initValidator()},_onActionEdit:function(){this.isEdit=!0,this._setPopupTitle("edit"),this._setPopupContents("edit"),this.popup.open("edit"),this._initValidator()},_onActionDelete:function(){var e,t=this.getCheckedDate(),i=window.I18N,a=this;e=i.prop("FACILITY_SCHEDULE_DELETE_EXCEPTIONAL_DAY_CONFIRM"),this.confirmDialog.message(e),this.confirmDialog.setConfirmActions({yes:function(){a.trigger("onDelete",t),a.viewModel.actions.edit.set("enabled",!1),a.viewModel.actions.delete.set("enabled",!1)}}),this.confirmDialog.open()},_initGrid:function(){var t=window.I18N,i=this,e=this.isRepeat?320:400,a=[{field:"name",title:t.prop("COMMON_NAME"),width:e},{field:"period",title:t.prop("FACILITY_SCHEDULE_PERIOD"),width:193,template:function(e){return"<span>"+s.htmlEncode(h(e.startDate).format("YYYY-MM-DD"))+"</span><span> ~ </span><span>"+s.htmlEncode(h(e.endDate).format("YYYY-MM-DD"))+"</span>"}},{field:"repeatYear",title:t.prop("FACILITY_SCHEDULE_REPEAT"),width:131,template:function(e){return e.repeatYear?t.prop("FACILITY_SCHEDULE_PERIOD_YEAR"):""}},{field:"description",title:t.prop("COMMON_DESCRIPTION"),width:433,template:function(e){return"<span class='grid-cell-one-line-ellipsis'>"+(e.description||"")+"</span>"}}];this.isRepeat||a.splice(2,1);var n=this.wrapper.find(".exception-grid"),o={columns:a,hasCheckedModel:!0,setCheckedAttribute:!0,resizable:!1,noRecords:{template:"<div class='no-records-text'>"+t.prop("FACILITY_SCHEDULE_NO_EXCEPTION_DAY")+"</div>"}};this.resizable&&(o.resizable=this.resizable),n.empty(),i.grid=n.kendoGrid(o).data("kendoGrid"),i.grid.bind("checked",function(e){i._actionBtnEnabled(e)})},_initValidator:function(){var e=window.I18N,t=!1,i=this.popup,a=i.element.find('.value[data-type="name"]').data("kendoCommonValidator");i.element.find('.value[data-key="description"]').data("kendoCommonValidator").setOptions({messages:{maxLength:function(){return e.prop("COMMON_CANNOT_INPUT_MAX_MORE",300)}}}),a.setOptions({messages:{required:function(){return""},maxLength:function(){return e.prop("COMMON_CANNOT_INPUT_MAX_MORE",30)}},rules:{required:function(e){var t=e.val();return d?0<t.trim().length:(i.setActions(n,{disabled:""===t}),!0)},maxLength:function(e){if(0<e.val().length&&!t)t=!0;else if(!t)return!0;return e.val().trim().length<=30}}})},_enableSaveBtnCondition:function(e){var t=this.element.find("div.common-validator[data-type=name] input")[0];return this.element.find("div.common-validator[data-type=description] input")[0].value.length<=300&&t.value.length<=30&&0<t.value.length},_actionBtnEnabled:function(e){var t=this.getCheckedDate();if(e)var i=e.item;var a=t.length;0<a&&(this.viewModel.actions.edit.set("enabled",!0),this.viewModel.actions.delete.set("enabled",!0)),2<=a&&this.viewModel.actions.edit.set("enabled",!1),a<=0&&(this.viewModel.actions.edit.set("enabled",!1),this.viewModel.actions.delete.set("enabled",!1)),this.trigger("onChecked",{checkedData:t,item:i})},_checkCount:function(){return this.getCheckedDate().reduce(function(e,t){return t.checked?e+1:e+0},0)},_attchEvent:function(){var e=this.wrapper;this.resizable&&o(window).on("resize",function(){s.resize(e)})},_onChangeName:function(e){},_checkDateIsBeforeToday:function(e){var t=h(new Date),i=h(e);return!(h.duration(t.diff(i)).asDays()<=0)},_checkStartDateEndDateTimePicker:function(e,t){var i=h(e),a=h(t);return!a.isBefore(i)&&i.format("YYYYMMDDHHMM")!=a.format("YYYYMMDDHHMM")},_onChangeStartDate:function(e){var t=this.endDate.value,i=e.sender.selectedDate;this._checkDateIsBeforeToday(i)&&this.startDate.set("value",new Date),this._checkStartDateEndDateTimePicker(this.startDate.value,t)||this.endDate.set("value",this.startDate.value)},_onChangeEndDate:function(e){var t=this.startDate.value,i=e.sender.selectedDate;this._checkDateIsBeforeToday(i)&&this.endDate.set("value",new Date),this._checkStartDateEndDateTimePicker(t,this.endDate.value)||this.startDate.set("value",this.endDate.value)},_onChangeDesc:function(e){},setDataSource:function(e){e=e||[],this.data=e,this.grid.setDataSource(e)},getCheckedDate:function(){return this.grid.getCheckedData()}});e.plugin(a)}(jQuery),function(e,a){var t=e.kendo,i=t.ui,n=i.Widget,o=(e.Util,n.extend({options:{name:"GridStyleDropDownList",dataSource:[]},init:function(e,t){var i=this;t=a.extend({},i.options,t),n.fn.init.call(i,e,t),i.dataSource=t.dataSource,i.viewModel=null,i.isVisible=t.isVisible||!1,i._initDOM(),i._parseDataSource()},_parseDataSource:function(){this.setDataSource(this.dataSource)},_initDOM:function(){this.element.html("<div class='grid-style-dropdownlist-container'><div class='ddl-box' data-bind='visible: isVisible'><input id='grid-style-dropdownlist' class='ddl-component' data-role='dropdownlist' data-auto-bind='false''data-value-primitive='true' data-text-field='text' data-value-field='value' style='width: 100%;' data-bind='source: dataSource, events: { change: onChange }' ></input ></div><div class='device-item-wrap' data-bind='invisible: isVisible'><div class='device-item-header'><div class='detail-text'><span class='name' data-bind='text: text'></span></div></div></div></div>"),this.element.addClass("grid-style-dropdownlist"),this._initBinding()},_initBinding:function(){var n=this,e=n.element.find(".grid-style-dropdownlist-container");n.viewModel=t.observable({text:"",isVisible:n.isVisible,dataSource:[],filter:{field:"selected",operator:"eq",value:!1},onChange:function(e){var t=e.sender.dataSource,i=t.data(),a=e.sender.selectedIndex;n.resetSelected(i),0<=a&&t.view()[a].set("selected",!0),t.filter({field:"selected",operator:"eq",value:!1}),n.trigger("onChange",{event:e})}}),t.bind(e,n.viewModel)},resetSelected:function(e){for(var t=0,i=e.length;t<i;t++)e[t].selected=!1},setDataSource:function(e){var t=this;e||(t.dataSource=[]),(e.total||e.length)&&(1<e.total()?(t.viewModel.set("dataSource",e.data()),t.viewModel.set("isVisible",!0)):(t.viewModel.set("isVisible",!1),e.at(0)&&t.viewModel.set("text",e.at(0).text)))}}));i.plugin(o)}(window,jQuery);