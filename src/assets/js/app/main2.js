define("core/observer",function(){"use strict";var d={},u=["alarm","event","onfloorchange","onfloorchanged"];return{get:function(e,n){var i,a,o,t,r,s,l=e&&d[e];if(!l){for(s=u.length,l={},r=0;r<s;r++)t=u[r],n&&n[t]&&(o=n[t]),a={publish:(i=$.Callbacks(o)).fire,subscribe:i.add,unsubscribe:i.remove,empty:i.empty},l[t]=a,o=null;e&&(d[e]=l)}return l},publish:function(e,n){var i,a;for(a in d)if((i=d[a])[e])try{i[e].publish(n)}catch(e){console.error(e)}},EVENT_CALLBACK_TYPE:u}}),define("core/module",["core/observer"],function(o){"use strict";window.Modules={};function e(e,n){(window.Modules[e]=this).namespace=e,this.observer=o.get(e,n),this.templateViews={},this.templateData={},this.templateUseWidthBlock=!0,this.templateViewModel={},this.router=new a.Router({root:e,pushState:!0})}function i(e,n,i){console.info(this),console.info(this.observer);var a=this.observer[n];a?"on"==e?$.isFunction(i)?a.subscribe(i):console.error("invalid callback function argument."):"off"==e?$.isFunction(i)?a.unsubscribe(i):console.error("invalid callback function argument."):"trigger"==e&&a.publish(i):console.error("'"+n+"' is invalid event type. valid observer events are "+o.EVENT_CALLBACK_TYPE)}var a=window.kendo;return e.prototype.on=function(e,n){i.call(this,"on",e,n)},e.prototype.off=function(e,n){i.call(this,"off",e,n)},e.prototype.trigger=function(e,n){i.call(this,"trigger",e,n)},e}),define("profile/profile",[],function(){"use strict";function i(){d.close()}function a(e){var n,i=new $.Deferred,a=c.getUserId();if(!a)return t.message(b),t.open(),i.reject(),i;var o={};for(n in e)e[n]||(o[n]=e[n],delete e[n]);return $.isEmptyObject(o)?$.ajax({url:"/ums/users/"+a,method:"PATCH",data:e}):(e.id=a,e.name=e.name||c.getUserName(),e.role=c.getUserRole(),$.ajax({url:"/ums/users/"+a,method:"PUT",data:e}))}function o(e){var n="";if(e&&e.responseJSON){var i=e.responseJSON;if(i.code&&i.message)n="[Error Code : "+e.responseJSON.code+"] "+e.responseJSON.message;else if(i.error_description){var a=i.error_description;a&&-1!=a.indexOf("Permission is required")&&(n=p.prop("COMMON_NOT_AUTHORIZED"))}else n=e.responseText;t.message(n),t.open()}}var t,n,r,s,l,d,u,c=window.Session,m=window.moment,f=window.MAIN_WINDOW,p=window.I18N,v=new window.CommonLoadingPanel,g=p.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL"),e=p.prop("COMMON_MY_PROFILE_LEAVE"),b=p.prop("COMMON_SESSION_EXPIRED"),h=p.prop("COMMON_REQUIRED_INFORMATION"),C=p.prop("COMMON_MY_PROFILE_CHANGE_PW"),O=$("<div/>"),w=$("<div/>"),N=$("#profile-change-password-confirm-content"),T=$("<div/>"),_=!1,k={},D=($(".editable"),$("#profile-image")),y=$("#profile-image-file"),L=$("#profile-upload-btn"),A=$("#profile-delete-btn"),I=$("#profile-leave-btn"),M=$("#main-user-profile"),S=!1,E=function(e,r){d=M.kendoDetailDialog({title:p.prop("COMMON_MY_PROFILE"),buttonsIndex:{CLOSE:4,EDIT:1,SAVE:0,CANCEL:2},dataSource:e,hasDelete:!1,height:620,width:652,scheme:{id:"id",fields:{role:{type:"select",name:p.prop("COMMON_MANAGER_TYPE"),template:function(e){var n="-";return e.role&&(n=e.role),n}},name:{type:"text",name:p.prop("COMMON_NAME"),editCss:{width:"100%"},hasInputRemoveBtn:!0,editable:!0,validator:{type:"name",required:!0}},id:{type:"text",name:p.prop("COMMON_ID"),editable:!0,editTemplate:"<span style='line-height:38px;'>#:id#</span><button class='k-button' style='float:right;' data-bind='events:{click:onclick}'>  "+p.prop("COMMON_MY_PROFILE_CHANGE_PW")+"</button>",editViewModel:{onclick:B}},mobilePhoneNumber:{type:"text",name:p.prop("COMMON_PHONE_NUM"),editCss:{width:"100%"},editable:!0,hasInputRemoveBtn:!0,validator:!0},email:{type:"email",name:p.prop("COMMON_EMAIL"),editCss:{width:"100%"},hasInputRemoveBtn:!0,template:"<a mailto:'#:email#'>#if(email){##:email##}else{#-#}#</a>",editable:!0,validator:!0},joinDate:{type:"datetime",name:p.prop("COMMON_MY_PROFILE_SIGNUP_DATE"),format:"LLL"},lastLogin:{type:"text",name:p.prop("COMMON_MY_PROFILE_LASTEST_SIGN_IN"),template:function(e){var n="-";e.lastLogin&&(n=m(e.lastLogin).format("LLL"));return n}},managementBuildings:{type:"text",name:p.prop("COMMON_MY_PROFILE_MANAGEMENT_BUILDING"),template:function(e){var n,i,a=void 0!==e.policy?e.policy.foundation_space_buildings_ids:[],o=[],t="-";for(n=0;n<r.length;n++)for(i=0;i<a.length;i++)if(r[n].id==a[i]){o.push(r[n].name);break}if(0<o.length)for(t="",n=0;n<o.length;n++)0!=n&&(t+="<br/>"),t+=o[n];return t}}}},headerTemplate:"<span class='cell' data-bind='text: id'></span>&nbsp;<span class='cell'>(<span data-bind='text: name'></span>)</span>"}).data("kendoDetailDialog")},x=function(){N.find("input").each(function(){var e=$(this),n=e.data("key");if(!n)return!0;var i=Y[n]?Y[n]:{};i.type="passwordRetype"==n?n:"password",i.mixedPasswordCheck=!0,G[n]=e.kendoCommonValidator(i).data("kendoCommonValidator"),k[n]=!1}),O.kendoCommonDialog(),t=O.data("kendoCommonDialog"),w.kendoCommonDialog({type:"confirm"}),n=w.data("kendoCommonDialog"),T.kendoCommonDialog({type:"confirm",title:C,content:N,height:380,confirmActions:{yes:j,no:U}}),r=T.data("kendoCommonDialog"),N.show(),N.on("keyup",".profile-reset-password-confirm-input",R);var i=r.options.typeActions.confirm[0].text,a=r.options.typeActions.confirm[1].text;r.wrapper.find("button").each(function(){var e=$(this),n=e.text();n==i||n==a&&(e.prop("disabled",!0).addClass("disabled"),s=e)})},F=function(){var n=new $.Deferred,e=c.getUserId();if(!e)return t.setActions(0,{action:function(){f.logout()}}),t.setCloseAction(function(){f.logout()}),t.message(b),t.open(),n.reject(),n;l=e;var i={};return $.ajax({url:"/ums/users/"+e+"?exposePolicy=true"}).done(function(e){i=e}).fail(function(e){n.reject(e)}).always(function(){n.resolve(i)}),n.promise()},R=function(e){_=_||!0;var n=$(this).data("key");k[n]=G[n].validate();var i=!0;for(n in k)if(!(i=k[n])){i=!1;break}i?s.prop("disabled",!1).removeClass("disabled"):s.hasClass("disabled")||s.prop("disabled",!0).addClass("disabled")},U=function(e){if(_)return n.message(g),n.setConfirmActions({yes:function(e){r.close()}}),n.open(),!1},B=function(){var e;for(e in _=!1,k)k[e]=!1;for(e in G)G[e].hideMessages(),G[e].element.val(""),G[e].element.removeClass("k-invalid");s.addClass("disabled"),S=!1,u=null,r.open()},P=function(){d.bind("onSaved",function(n){var e=n.result;v.open(M),console.info(e),a(e).done(function(){n.sender.success(),d.setDataSource([n.sender.dataSource.data()[0]])}).fail(function(e){o(e),n.sender.fail()}).always(function(){S&&u?a({password:u}).done(function(){}).fail(function(e){o(e)}).always(function(){v.close()}):v.close()})}),d.setCloseAction(function(){S=!1,u=null,d._cancelEvent({sender:d},!0)}),d.bind("onCancel",function(e){S=!1,u=null}),I.on("click",function(){n.message(e),n.setConfirmActions({yes:function(){var e,n;v.open(),(e=new $.Deferred,(n=c.getUserId())?$.ajax({url:"/ums/users/"+n,method:"DELETE"}):(t.message(b),t.open(),e.reject(),e)).done(function(){i(),f.goToMenu("signin")}).fail(function(e){if(e&&e.responseJSON){var n,i=e.responseJSON;n=i.code&&i.message?"[Error Code : "+e.responseJSON.code+"] "+e.responseJSON.message:e.responseText,t.message(n),t.open()}v.close()})}}),n.open()}),L.on("click",function(){y.trigger("click"),$(this).blur()}),A.on("click",function(){D.attr("src","../../src/main/resources/static-dev/images/user-default.png"),$(this).blur()}),y.on("change",function(){H(this)})},j=function(){var e=G.oldPassword,n=G.password,i=e.element.val(),a=n.element.val();return v.open(T),W(l,i).done(function(e){c.setAuthToken(e.access_token,e.expire_in),S=!0,u=a,r.close(),d.enableSaveBtn()}).fail(function(){S=!1,u=null,G.oldPassword.validate("incorrect",!0)}).always(function(){v.close()}),!1},W=function(e,n){var i=e+":"+n,a=window.btoa(i);return $.ajax({method:"POST",url:"/api/login",headers:{Accept:"application/json",Authorization:"Basic "+a}})},V=function(){return $.ajax({method:"GET",url:"/foundation/space/buildings"})},H=function(e){if(e.files&&e.files[0]){var n=new FileReader;n.onload=function(e){D.attr("src",e.target.result)},n.readAsDataURL(e.files[0])}},Y={oldPassword:{messages:{required:h}},password:{messages:{required:h}}},G={};return{init:function(){x(),F().done(function(n){var e=f.getCurrentBuildingList();0==e.length?V().done(function(e){e.sort(function(e,n){return e.sortOrder-n.sortOrder}),E(n,e),P()}):(E(n,e),P())}).fail(function(e){if(e&&e.responseJSON){var n,i=e.responseJSON;-1!=(n=i.code&&i.message?"[Error Code : "+e.responseJSON.code+"] "+e.responseJSON.message:e.responseText).indexOf("invalid_token")?(t.message(b),t.setActions(0,{action:function(){f.logout()}}),t.setCloseAction(function(){f.logout()})):t.message(n),t.open()}})},open:function(){d.open()},close:i}}),function(hn,Cn){hn.kendo.ui.progress(Cn("body"),!0),require(["domReady"],function(e){"use strict";e(function(){require(["json!/front/menus","core/observer","core/module"],function(o,n,i){function t(e){var n=e.foundation_space_buildings_id,i=e.foundation_space_floors_id,a=e.type,o=e.messageType;if(on().building.id==n&&i){var t=te.find(".main-sidebar-floor-num[data-id='"+i+"']"),r=t.attr("data-warning");r=r&&"undefined"!=r?Number(r):0;var s=t.attr("data-critical");s=s&&"undefined"!=s?Number(s):0;var l=t.siblings("i");"REGISTRATION"==o?"critical"==a?(s++,t.attr("data-critical",s)):"warning"==a&&(r++,t.attr("data-warning",r)):"CANCELLATION"==o&&("critical"==a?(s--,t.attr("data-critical",s)):"warning"==a&&(r--,t.attr("data-warning",r))),0<s?(l.removeClass("warning"),l.addClass("main-sidebar-floor-alarm critical")):0<r?(l.removeClass("critical"),l.addClass("main-sidebar-floor-alarm warning")):(l.removeClass("main-sidebar-floor-alarm"),l.removeClass("critical"),l.removeClass("warning"))}}function e(){return Cn.ajax({url:"/foundation/space/buildings"})}function s(e){if(0!=e)return Cn.ajax({url:"/foundation/space/floors",data:{foundation_space_buildings_id:e}});var n=new Cn.Deferred;return n.resolve([]),n.promise()}function r(e){var n=!1,i=e.length;1<=i?(e.sort(function(e,n){return e.sortOrder-n.sortOrder}),e.unshift({name:D,id:0}),i=e.length):n=!0;for(var a=0;a<i;a++)e[a].isDisabled=!1;var o=ne.data("kendoDropDownList");if(o){var t=new U.data.DataSource({data:e});o.setDataSource(t),o.value(0),o.trigger("change")}else(o=ne.kendoDropDownList({animation:!1,height:363,dataTextField:"name",dataValueField:"id",dataSource:e,popupClass:"main-building-select-container-wrapper",select:function(e){e.dataItem.isDisabled&&e.preventDefault()},valueTemplate:function(e){var n=e.name,i=e.id;return"en"!=Ce&&0==i&&(n=l.prop("COMMON_FLOOR_NAV_TOTAL")),"<span>"+n+"</span>"},template:function(e){var n=e.name,i=e.id;return"en"!=Ce&&0==i&&(n=l.prop("COMMON_FLOOR_NAV_TOTAL")),"<span class='"+(e.isDisabled?"k-state-disabled":"")+"'>"+S.decodeHtml(n)+"</span>"}}).data("kendoDropDownList")).popup.element.addClass("main-building-select-container");n?ne.data("kendoDropDownList").wrapper.hide():ne.data("kendoDropDownList").wrapper.show(),ae.css("height",80)}function m(e){var n=null;n=e?ee.find(".btn.hide"):ee.find(".btn.show"),q=!0,n.click()}var l,d,u,a,c,f,p,v,g,b,h,C,O,w,N,T=hn.moment,_=hn.Cookies,k="Do you want to sign out?",D="TOTAL",y="all",L="signin",A=hn.localStorage,I=hn.Session,M=hn.GlobalSettings,S=hn.Util,E=hn.CommonLoadingPanel,x=hn.CommonWebSocket,F=new hn.xssFilter,R=o,U=hn.kendo,B=Cn("<div/>"),P=Cn("<div/>"),j=new E,$=Cn("#main"),W=Cn("#main-header"),V=Cn("#main-sidebar-menu"),H=V.find(".main-sidebar-top"),Y=V.find(".main-sidebar-menu-list"),G=V.find(".main-sidebar-hidden"),J=G.find(".main-sidebar-menu-icon-list"),z=G.find(".top-info"),q=!0,K="hideMainSidebar",Q=Y.find(".main-sidebar-menu-list-line"),Z=Y.find("> ul"),X=V.find(".btn-util"),ee=X.find(".btn-box"),ne=V.find(".main-sidebar-floor-nav-building-select"),ie=Cn("#main-sidebar-floor-nav"),ae=ie.find(".main-sidebar-floor-nav-top"),oe=ie.find(".main-sidebar-floor-nav-all"),te=ie.find(".main-sidebar-floor-list"),re=!1,se=!1,le=W.find(".main-top-nav"),de=le.find(".main-top-nav-alarm.error"),ue=le.find(".main-top-nav-alarm.warning"),ce=le.find(".main-top-nav-user-icon"),me=le.find(".main-top-nav-alarm-tooltip"),fe=le.find(".main-top-nav-user-tooltip"),pe=le.find(".main-top-nav-noti-toast-template"),ve=le.find(".main-top-nav-noti"),ge=le.find(".main-top-nav-noti-rule"),be=le.find(".main-top-nav-noti-rule-toast-template"),he=[],Ce="en",Oe=!1,we=!0,Ne=function(){k=l.prop("COMMON_MAIN_SIGNOUT_CONFIRM")},Te=function(){Cn("body").on("change","input.k-input, input[type=text], input[type=password], textarea",function(){var e=Cn(this),n=e.val(),i=F.filter(n);n!=i&&e.val(i)})},_e=function(){var e=gn();if(h=vn(),C=(C=h.data("name"))||e.menuName,(d=R[C]).subMenu&&(O=h.find(".main-sidebar-sub-menu-item.active"),w=(w=O.data("name"))||e.subMenuName,d=d.subMenu[w]),hn.MENU_TABS_ENABLED={},d&&d.tabs){var n,i,a,o,t=d.tabs;for(i=t.length,n=0;n<i;n++)a=t[n].name,o=t[n].enabled,hn.MENU_TABS_ENABLED[a]=o}},ke=function(){B.kendoCommonDialog(),a=B.data("kendoCommonDialog"),P.kendoCommonDialog({type:"confirm",confirmActions:{yes:sn}}),c=P.data("kendoCommonDialog"),ve.kendoMainToast({templates:[{type:"mainNoti",template:pe.html()}]}),g=ve.data("kendoMainToast"),(b=ge.kendoRuleToast({templates:[{type:"ruleNoti",template:be.html()}]}).data("kendoRuleToast")).bind("afterOpen",xe),b.bind("afterClose",xe)},De=function(){require(["profile/profile"],function(e){(N=e).init()})},ye=function(){x.connect(),x.on("receive",function(e){var n;if(e){if("Notification"==(n=(e=Cn.extend({},e)).type)&&"ForcedLogout"==e.name)return a.message(l.prop("COMMON_FORCE_LOGOUT")),a.open(),a.setActions(0,{action:function(e){fn(L)}}),void setTimeout(function(){fn(L)},5e3);S.setAlarmData(e),"Request"!=n&&("Critical"==n?Se(e):"Warning"==n&&Ee(e))}})},Le=function(){return le.kendoMainNavTooltip({filter:"span.main-top-nav-alarm",content:U.template(me.html()),width:374,height:393,showOn:"click",autoHide:!1,animation:!1,position:"bottom"}),ce.kendoMainNavTooltip({content:U.template(fe.html()),showOn:"click",width:200,autoHide:!1,animation:!1,popupCss:{"margin-top":9},position:"bottom",events:{myProfile:ln,signOut:rn}}),ce.data("kendoMainNavTooltip").show(),ce.data("kendoMainNavTooltip").hide(),ce.data("kendoMainNavTooltip").popup.wrapper.addClass("tooltip-top-nav-user"),v=le.data("kendoMainNavTooltip"),Ie().done(function(e){var n=e.criticalAlarms,i=e.criticalNum,a=e.warningAlarms,o=e.warningNum;Ae(i),v.setErrorList(n),Me(o),v.setWarningList(a)})},Ae=function(e){de.text(e)},Ie=function(){return Cn.ajax({url:"/alarms/statisticView",pagenation:!1,data:{size:50}}).then(function(e){return{criticalAlarms:e.unresolvedCriticalAlarms,criticalNum:e.numberOfUnresolvedCriticalAlarms,warningAlarms:e.unresolvedWarningAlarms,warningNum:e.numberOfUnresolvedWarningAlarms}})},Me=function(e){ue.text(e)},Se=function(e){var n=e.isRule,i=e.code,a=de.text();a=a.replace("+",""),a=Number(a),"REGISTRATION"==e.messageType?v.addError(e)&&(a+=1):"CANCELLATION"==e.messageType&&v.removeError(e)&&--a,Ae(a),e.type="critical","Sys_5001"==i&&(n=!0),"REGISTRATION"==e.messageType?n?(e.eventTime&&(e.eventTime=T(e.eventTime).format("YYYY-MM-DD HH:mm")),b.show(e,"ruleNoti")):g.show(e,"mainNoti"):"CANCELLATION"==e.messageType&&n&&b.closePopup(e),t(e)},Ee=function(e){var n=e.isRule,i=e.code,a=ue.text();a=a.replace("+",""),a=Number(a),"REGISTRATION"==e.messageType?v.addWarning(e)&&(a+=1):"CANCELLATION"==e.messageType&&v.removeWarning(e)&&--a,Me(a),e.type="warning","Sys_5001"==i&&(n=!0),"REGISTRATION"==e.messageType?n?(e.eventTime&&(e.eventTime=T(e.eventTime).format("YYYY-MM-DD HH:mm")),b.show(e,"ruleNoti")):g.show(e,"mainNoti"):"CANCELLATION"==e.messageType&&n&&b.closePopup(e),t(e)},xe=function(e){var n=e.isOpen,i=e.data,a=he,o=null,t={},r=0,s={};if(n)s={id:i.alarmUuid,access_token:hn.Session.getAuthToken(),alarms_name:i.code,dms_devices_id:i.deviceId,popUpOpenElapsedTime:r},x.send(s),t.alarmUuid=i.alarmUuid,t.intervalItem=setInterval(function(){r+=3,s.popUpOpenElapsedTime=r,x.send(s)},3e3),a.push(t);else{s={id:i.alarmUuid,access_token:hn.Session.getAuthToken(),alarms_name:i.code,dms_devices_id:i.deviceId,popUpOpenElapsedTime:-1},x.send(s);for(var l=a.length-1;0<=l;l--)if((o=a[l]).alarmUuid==i.alarmUuid){clearInterval(o.intervalItem),o=null,a.splice(l,1);break}}},Fe=function(e){var n,i=te.find(".mCSB_container");return(n=0<i.length?i.find(".main-sidebar-floor-num[data-id='"+e+"']"):te.find(".main-sidebar-floor-num[data-id='"+e+"']")).length<1?(console.error("there is no floor is "+e),null):n=n.closest(".main-sidebar-floor-num-li")},Re=function(e){var n,i,a,o,t,r,s,l=e.length,d=Cn("<div/>");for(e.sort(function(e,n){return e.sortOrder-n.sortOrder}),n=0;n<l;n++)i=e[n],a=Cn("<li/>").addClass("main-sidebar-floor-num-li"),o=Cn("<a/>").addClass("main-sidebar-floor-num"),(s=i.alarms)&&(i.criticalNum=s.numberOfCriticalDevices,i.warningNum=s.numberOfWarningDevices,0<s.numberOfCriticalDevices?i.alarmType="critical":0<s.numberOfWarningDevices&&(i.alarmType="warning")),o.attr({"data-id":i.id,"data-value":i.name,"data-type":i.type,"data-warning":i.warningNum,"data-critical":i.criticalNum}),r="F"==i.type?i.name+i.type:"B"==i.type?i.type+i.name:i.name,o.text(r),o.appendTo(a),t=Cn("<i/>"),i.alarmType&&t.addClass("main-sidebar-floor-alarm "+i.alarmType),t.appendTo(a),d.append(a);var u=te.find(".mCSB_container");return 0<u.length?u.html(d.html()):te.html(d.html()),!0},Ue=function(){var t=new Cn.Deferred;return Pe()?(re=!0,t.resolve()):(je()&&(se=!0),e().done(function(e){var n,i,a;if(r(e),e&&e.length,(u=on())&&(n=u.floor,i=u.building),i)ne.data("kendoDropDownList").select(function(e){return e.id==i.id});else{i={};var o=ne.data("kendoDropDownList").dataItem();o?(i.id=o.id,i.value=o.name):(i.id=0,i.value=D)}s(i.id).done(function(e){(!e||e.length<1)&&0!=i.id&&Qe(!0),Re(e,i),n&&n.id?(a=n.id==y?oe:te.find("a.main-sidebar-floor-num[data-id='"+n.id+"']").closest("li.main-sidebar-floor-num-li"),qe(a)):(u=qe(oe),tn(u)),ne.data("kendoDropDownList").bind("open",function(e){we=!0,Oe="open"}),ne.data("kendoDropDownList").bind("change",We),te.mCustomScrollbar({scrollButtons:{enable:!0,scrollType:"stepped"},snapAmount:250,mouseWheel:{enable:!0,scrollAmount:250},scrollbarPosition:"outside",callbacks:{onCreate:function(){f=te.find(".mCSB_buttonUp"),p=te.find(".mCSB_buttonDown")},onInit:function(){Ze(!0,!0)},onTotalScroll:function(){Ze(!0)},onTotalScrollBack:function(){Ze(!0,!0)},onScroll:function(){Ze(!1)},onOverflowYNone:function(){Ze(!0),Ze(!0,!0)},onOverflowY:function(){Ze(!1)}}}),ie.on("click",".main-sidebar-floor-num-li",Ve),oe.on("click",Ve),se&&(Ke(!0),u=null),0==i.id&&i.value==D&&(Qe(!0),Xe(!0)),t.resolve()}).fail(function(e){$e(!0),Be(e,t)})}).fail(function(e){$e(!0),Be(e,t)})),t.promise()},Be=function(e,n){var i="";i=e.responseText&&-1!=e.responseText.indexOf("Permission")?l.prop("COMMON_NOT_AUTHORIZED"):S.parseFailResponse(e),a.message(i),a.open(),n&&n.reject()},Pe=function(){return re||$.hasClass("main-hide-floor-nav")},je=function(){return se||d.isDisabledFloorNav},$e=function(e){e?(re=!0,$.addClass("main-hide-floor-nav"),ie.hide()):(re=!1,$.removeClass("main-hide-floor-nav"),ie.show())},We=function(e){var n,i,a,o,t,r=this.dataItem();return r?(n=r.id,i=r.name,a=r.description,o=r.indexes,t=r.sortOrder):(n=0,i=D),0==n?(Qe(!0),Xe(!0),oe.trigger("click")):(Qe(!1),s(n).done(function(e){Re(e,{id:n,name:i})}).fail(function(e){Be(e)}).always(function(e){e.length?we?Je():ze():(tn(u={floor:{id:y,value:"ALL"},building:{id:n,value:i,description:a,indexes:o,sortOrder:t}}),Ge(u))}),e.preventDefault()),!1},Ve=function(e){Oe=!(!e.originalEvent&&"open"!==Oe),u=qe(Cn(this)),tn(u),He()},He=function(){var e=!1;0!=(u=on()).building.id&&(e=!0,j.open(),Cn.ajax({url:"/foundation/space/buildings/"+u.building.id}).done(function(e){u.building=Cn.extend(u.building,e),u.floor.id!=y?Cn.ajax({url:"/foundation/space/floors/"+u.floor.id}).done(function(e){u.floor=Cn.extend(u.floor,e),u.floor.imageFileName?Cn.ajax({url:"/foundation/space/floors/"+u.floor.id+"/image",dataType:"binary"}).done(function(e){(u.floor.image=e)?(u.floor.imageUrl=URL.createObjectURL(e),Ye(u).always(function(){j.close(),Ge(u)})):(u.floor.imageWidth=0,u.floor.imageHeight=0,j.close(),Ge(u))}).fail(function(){u.floor.image=null,u.floor.imageWidth=0,u.floor.imageHeight=0,j.close(),Ge(u)}):(j.close(),Ge(u))}).fail(function(){j.close(),Ge(u)}):(j.close(),Ge(u))}).fail(function(){j.close(),Ge(u)})),e||Ge(u)},Ye=function(e){var n=e.floor,i=n.imageUrl,a=new Cn.Deferred,o=new Image;return o.src=i,o.onload=function(){n.imageWidth=this.width,n.imageHeight=this.height,a.resolve()},o.onerror=function(){n.imageWidth=0,n.imageHeight=0,a.reject()},a.promise()},Ge=function(e){try{n.publish("onfloorchange",e)}catch(e){console.error(e)}},Je=function(){oe.trigger("click")},ze=function(){te.find(".main-sidebar-floor-num-li:eq(0)").trigger("click")},qe=function(e){var n,i,a=e,o=a.find(".main-sidebar-floor-num"),t=!1;e.get(0)===oe.get(0)&&(t=!0,o=oe),a.hasClass("active")||(t?te.find(".main-sidebar-floor-num-li.active").removeClass("active"):(oe.removeClass("active"),a.siblings(".active").removeClass("active")),a.addClass("active"));var r=ne.data("kendoDropDownList").dataItem();return i=r?(n=r.id,r.name):(n=0,D),{building:{id:n,value:i},floor:{id:o.data("id"),value:o.data("value"),type:o.data("type")}}},Ke=function(e){var n=ie.find(".disabled"),i=on().floor,a=i.id,o=i.type,t=te.find(".main-sidebar-floor-num[data-id="+a+"][data-type="+o+"]").closest(".main-sidebar-floor-num-li"),r=on();se=e?(0<n.length&&n.removeClass("disabled"),0<t.length&&t.removeClass("active"),ie.addClass("disabled"),ie.prop("disabled",!0),ie.append(an()),ne.data("kendoDropDownList").enable(!1),ne.data("kendoDropDownList").value(0),z.addClass("disabled"),!0):(0<t.length&&t.addClass("active"),ie.removeClass("disabled"),ie.prop("disabled",!1),ie.find(".floor-nav-mask").remove(),ne.data("kendoDropDownList").enable(!0),ne.data("kendoDropDownList").value(r.building.id),z.removeClass("disabled"),!1)},Qe=function(e){if(e){oe.addClass("disabled"),te.addClass("disabled");var n=ne.data("kendoDropDownList").wrapper.height();ie.append(an(n))}else oe.removeClass("disabled"),te.removeClass("disabled"),ie.find(".floor-nav-mask").remove()},Ze=function(e,n){var i;e?(n?(i=en(n),f.addClass("disabled")):(i=en(),p.addClass("disabled")),te.append(i)):(te.find(".floor-nav-mask").remove(),f.removeClass("disabled"),p.removeClass("disabled"))},Xe=function(e){if(e){oe.addClass("disabled");var n=nn();ae.append(n)}else ae.find(".floor-nav-mask").remove(),oe.removeClass("disabled")},en=function(e){var n={width:"100%",height:"21px",left:"0px","z-index":"100",position:"absolute"};return e?n.top="-21px":n.bottom="-21px",Cn("<div/>").addClass("floor-nav-mask").css(n)},nn=function(){var e={width:"100%",height:oe.outerHeight(),top:oe.offset().top,left:"0px","z-index":"100",position:"absolute"};return Cn("<div/>").addClass("floor-nav-mask").css(e)},an=function(e){return e=e||"0px",Cn("<div/>").addClass("floor-nav-mask").css({width:"100%",height:"100%",top:e,left:"0px","z-index":"100",position:"absolute"})},on=function(){var e,n,i,a,o;if(!u){if(e=A.getItem("floorId"),n=A.getItem("floorValue"),i=A.getItem("floorType"),a=A.getItem("buildingId"),o=A.getItem("buildingValue"),!(e&&a&&n&&o))return u={floor:{id:y,value:"ALL",type:null},building:{id:0,value:D}};u={floor:{id:e,value:n,type:i},building:{id:a,value:o}}}return u},tn=function(e){e&&e.floor&&(A.setItem("floorId",e.floor.id),A.setItem("floorValue",e.floor.value),A.setItem("floorType",e.floor.type),e.building&&(A.setItem("buildingId",e.building.id),A.setItem("buildingValue",e.building.value)))},rn=function(){ce.data("kendoMainNavTooltip").hide(),c.message(k),c.open()},sn=function(){var e;null===I.getAuthToken()&&(e="Bearer "+hn.sessionStorage.getItem(I.KEYS.AUTH_TOKEN)),Cn.ajax({url:"/api/logout",headers:{Authorization:e,Accept:"application/json"},method:"POST"}).always(function(){e||I.clearSession(),hn.onbeforeunload=null,fn(L)})},ln=function(){ce.data("kendoMainNavTooltip").hide(),N.open()},dn=function(){var o,t,r=H.height(),s=Y.css("bottom").replace("px",""),l=1*Q.length,d=Z.find(".main-sidebar-sub-menu-item.active"),n=V.find(".main-sidebar-menu-icon-item-tag"),e=J.find(".main-sidebar-menu-icon-item"),i=null,a={};re||(o=21,t=ae.outerHeight());var u=Number($.css("min-width").replace("px",""));Y.mCustomScrollbar({mouseWheel:!0}),Cn(hn).on("resize",function(){var e=Cn(this).height(),n=Cn(this).width(),i=14;u<=n&&(i=0);var a=e-r-s-l-i-80;Y.height(a),re||(a=e-t-o-i,te.height(a))}),Cn(hn).trigger("resize"),V.on("click",".main-sidebar-menu-item",function(){var e=Cn(this),n=e.data("name");if(e.find(".main-sidebar-menu-sub-list").length<1)return setTimeout(function(){fn(n)},0),!1;e.hasClass("active")?cn(e):(e.siblings(".main-sidebar-menu-item.active").each(function(){var e=Cn(this);cn(e)}),un(e)),Cn(hn).trigger("resize")}),V.on("click",".main-sidebar-sub-menu-item",function(){var e=Cn(this),n=e.closest(".main-sidebar-menu-item").data("name"),i=e.data("name");return e.hasClass("active")||(e.siblings(".active").removeClass("active"),e.addClass("active")),fn(n,i),!1}),X.show(),ee.on("click",".btn",function(e){var n,i=Cn(this).attr("event-name"),a=Z.find(".main-sidebar-menu-item.active"),o=null,t="",r="",s=!0,l=!1;"hide"==i?(l=!0,Cn("body").addClass("hide-sidebar"),$.addClass("hide-sidebar"),t=hn.location.pathname.split("/")[2],(o=J.find(".main-sidebar-menu-icon-item[data-name="+t+"]")).siblings().removeClass("active"),o.addClass("active"),cn(a),s=!1):"show"==i&&(l=!1,Cn("body").removeClass("hide-sidebar"),$.removeClass("hide-sidebar"),r=J.find(".main-sidebar-menu-icon-item.active").attr("data-name"),o=Y.find("li[data-name="+r+"]"),un(o),s=!0),q&&_.set(K,l),0<d.length&&d.addClass("active"),n={type:"changeSidebarState",isExpand:s,width:V.width(),height:V.height()},q=!0,Cn(hn).trigger(n)}),J.on("click",".main-sidebar-menu-icon-item",function(e){var n=Cn(e.target).closest(".main-sidebar-menu-icon-item"),i=ee.find(".btn.show");n.siblings().removeClass("active"),n.addClass("active"),q=!1,i.click()}),e.hover(function(e){i=Cn(e.target),n.text(i.attr("tooltip-name")),a.top=i.offset().top+20,a.left=i.offset().left+65,a.display="block",n.css(a)},function(e){i=Cn(e.target),a.display="none",n.css(a)}),G.find(".top-info").on("click",function(e){Cn(e.target).hasClass("disabled")||ne.data("kendoDropDownList").open()});var c=_.get(K);null==c&&_.set(K,!1),c=_.get(K),m("true"==c)},un=function(e){var n=e.find("ul");0<n.length&&n.slideDown({duration:300,complete:function(){e.addClass("active"),Cn(hn).trigger("resize")}}),e.addClass("active")},cn=function(e){var n=e.find("ul");0<n.length&&n.slideUp({duration:300,complete:function(){e.removeClass("active"),Cn(hn).trigger("resize")}}),e.removeClass("active")},mn=function(e){define(e+"/core",[],function(){return new i(e)})},fn=function(e,n){var i=hn.location.protocol+"//"+hn.location.host+"/front/"+e;n&&(i+="/"+n),hn.location.href=i},pn=function(e,n){setTimeout(function(){bn(e,n)},0)},vn=function(){return Z.find(".main-sidebar-menu-item.active")},gn=function(){var e,n,i=hn.location.pathname.replace("/front/","").split("/");return 1<i.length?(e=i[0],n=i[1]):e=i[0],{menuName:e,subMenuName:n}},bn=function(e,n){if(d.mainJs){var i=e+"/";n&&(i+=n+"/"),i+=d.mainJs,require([e+"/core"],function(){require([i],function(){var e,n,i,a,o;hn.kendo.ui.progress(Cn("body"),!1),He(),e=te.find(".main-sidebar-floor-num-li"),n=te.find(".main-sidebar-floor-num-li.active"),i=e.index(n),a=-1*Cn(".main-sidebar-floor-list").find(".main-sidebar-floor-num-li.active").outerHeight()*i+100,o={scrollInertia:0},0<n.length&&(te.mCustomScrollbar("scrollTo",a,o),setTimeout(function(){te.mCustomScrollbar("scrollTo",a,o)},10))},function(e){console.error(e),hn.kendo.ui.progress(Cn("body"),!1),a.message("Failed to initalize menu."),a.open()})})}else console.error("Menu Load Failed : there is no mainJs for"+e+">"+n)};return M.loadSettings().done(function(){S.getInstalledTypesFromServer().always(function(){l=hn.I18N,Ce=M.getLocale(),Ne(),Te(),_e(),ke(),Le().always(function(){ye(),Ue().always(function(){dn(),mn(C),pn(C,w),De()})})})}).fail(function(e,n,i){B.kendoCommonDialog({message:"["+n+"]Failed to load setings.json\n"+i,visible:!0})}),hn.MAIN_WINDOW={addErrorNoti:Se,addWarningNoti:Ee,disableFloorNav:Ke,disableFloorList:Qe,disableBuidingCombo:function(e){ne.data("kendoDropDownList").enable(!e)},disableFloorAllBtn:Xe,disableBuidingTotal:function(e){if(ne.data("kendoDropDownList").dataSource){var n=ne.data("kendoDropDownList").dataSource;0<n.total()&&n.get(0).set("isDisabled",e)}},setCurrentFloor:tn,setFloorImageInfo:Ye,getCurrentFloor:on,getCurrentFloorName:function(){var e=on(),n=e.floor;if(0==e.building.id||n.id==y)return l.prop("COMMON_FLOOR_NAV_ALL");var i=n.name?n.name:n.value;return"F"==n.type?i+n.type:"B"==n.type?n.type+i:i},setFloorList:function(e){var n=on();Re(e,n),oe.trigger("click")},addFloor:function(e){var n,i,a;n=Cn("<li/>").addClass("main-sidebar-floor-num-li"),(i=Cn("<a/>").addClass("main-sidebar-floor-num")).attr({"data-id":e.id,"data-value":e.value,"data-type":e.type}),a="F"==e.type?e.value+e.type:"B"==e.type?e.type+e.value:e.value,i.text(a),i.appendTo(n),Cn("<i/>").addClass("main-sidebar-floor-alarm "+e.alarmType).appendTo(n);var o=te.find(".mCSB_container");0<o.length?o.prepend(n):te.prepend(n)},removeFloor:function(e){var n=Fe(e);n&&n.remove()},editFloor:function(e,n,i){var a,o=Fe(e);o&&(n&&((a=o.find(".main-sidebar-floor-num")).attr("data-value",n),a.text(S.sliceNum(n)+"F")),i&&(o.find(".main-sidebar-floor-alarm"),o.removeClass("warning"),o.removeClass("critical"),o.addClass(i)))},setBuildingList:function(e){r(e)},addBuilding:function(e){ne.data("kendoDropDownList").dataSource.add(e)},removeBuilding:function(e){var n=ne.data("kendoDropDownList"),i=n.dataSource.get(e);if(o){var a=n.dataItem();n.dataSource.remove(i),i===a&&(n.select(0),n.trigger("change"))}else console.error("there is no building is "+e)},editBuilding:function(e,n){var i=ne.data("kendoDropDownList").dataSource.get(e);o?i.set("name",n):console.error("there is no building is "+e)},clickAllFloor:Je,clickTopFloor:ze,clickTopBuilding:function(e){Xe(!1);var n=ne.data("kendoDropDownList");1<n.dataSource.data().length&&(n.select(1),n.trigger("change"),we=e)},isOriginalClick:function(){return Oe},refreshBuildingList:function(){var n=new Cn.Deferred;return e().done(function(e){r(e),n.resolve()}).fail(function(){n.reject()}),n.promise()},refreshFloorList:function(){var n=new Cn.Deferred,i=on();return s(i.building.id).done(function(e){Re(e,i.building),n.resolve()}).fail(function(){n.reject()}),n.promise()},getCurrentBuildingList:function(){var e=ne.data("kendoDropDownList");if(!e)return[];var n=e.dataSource.data();return n=n.slice(1,n.length)},getCurrentFloorList:function(){var i=[];return te.find(".main-sidebar-floor-num-li").each(function(){var e=Cn(this).find("a"),n={id:e.data("id"),value:e.data("value"),type:e.data("type")};i.unshift(n)}),i},getMenuConfig:function(){return R},logout:sn,goToMenu:fn,hideMainMenuSidebar:m,FLOOR_NAV_BUILDING_TOTAL_ID:0,FLOOR_NAV_BUILDING_TOTAL:D,FLOOR_NAV_FLOOR_ALL:"ALL",FLOOR_NAV_FLOOR_ALL_ID:y},hn.MAIN_WINDOW})})})}(window,jQuery);