define("device/common/device-constants",[],function(){"use strict";var e=window.I18N;return{TIME_OUT:1500,ALL_TIME_INTERVAL:4e4,PANEL_REFRESH_TIME:1e3,BEACON_TIME_INTERVAL:5e3,DISPLAY_NAME_MAX:6,INDOOR_TYPE:["AirConditioner.Indoor","AirConditioner.AHU","AirConditioner.Chiller","AirConditioner.EHS","AirConditioner.ERV","AirConditioner.ERVPlus",["AirConditioner.FCU","AirConditioner.SFCU"],"AirConditioner.DuctFresh"],OUTDOOR_TYPE:["AirConditioneromOutdoor"],POINT_TYPE:["ControlPoint.AI","ControlPoint.AO","ControlPoint.DI","ControlPoint.DO","ControlPoint.AV","ControlPoint.DV"],ENERGY_TYPE:["Meter.WattHour","Meter.Gas","Meter.Water","Meter.Calorimeter"],SENSOR_TEMP_HUM_TYPE:["Sensor.Temperature_Humidity","Sensor.Humidity","Sensor.Temperature"],STATUS:["Normal.On","Normal.Off","Alarm.Critical","Alarm.Warning"],BEACON_STATUS:["Normal","Disconnected","WrongLocation","LowBattery"],BEACON_ACTION:{BLOCK:1,DELETE:2,REGISTER:3,DETAIL:4},BEACON_LOCATION_TYPE:["Fixed","Movable"],ASSET_FILTER:{TYPE:0,LOCATION:1,STATUS:2,ZONE:3,SELECTALL:4},ASSET_ACTION:{ASSET_TYPE:1,EXPORT:2,IMPORT:3,REGISTER:4,DELETE:5,DETAIL:6},ONOFF:["On","Off"],MODE:[{mode:"Auto",id:"AirConditioner.Indoor.General"},{mode:"Cool",id:"AirConditioner.Indoor.General"},{mode:"Heat",id:"AirConditioner.Indoor.General"},{mode:"Dry",id:"AirConditioner.Indoor.General"},{mode:"Fan",id:"AirConditioner.Indoor.General"},{mode:"CoolStorage",id:"AirConditioner.Indoor.General"},{mode:"HeatStorage",id:"AirConditioner.Indoor.General"},{mode:"vAuto",id:"AirConditioner.Indoor.Ventilator"},{mode:"HeatExchange",id:"AirConditioner.Indoor.Ventilator"},{mode:"ByPass",id:"AirConditioner.Indoor.Ventilator"},{mode:"Sleep",id:"AirConditioner.Indoor.Ventilator"},{mode:"Eco",id:"AirConditioner.Indoor.DHW"},{mode:"Standard",id:"AirConditioner.Indoor.DHW"},{mode:"Power",id:"AirConditioner.Indoor.DHW"},{mode:"Force",id:"AirConditioner.Indoor.DHW"}],TEXT:{SELECTALL:e.prop("COMMON_BTN_SELECT_ALL"),DESELECTALL:e.prop("COMMON_BTN_DESELECT_ALL"),REGISTER:e.prop("COMMON_BTN_REGISTER"),DEREGISTER:e.prop("COMMON_BTN_DEREGISTER"),VIEW:e.prop("COMMON_BTN_VIEW"),DELETE:e.prop("COMMON_BTN_DELETE")},FILTER:{TYPE:0,STATUS:1,MODE:2,ZONE:3,SELECTALL:4,REGEND:5},ACTION:{REGISTER:1,DETAIL:2},NW_ACTION:{DELETE:1,REGISTER:2,DETAIL:3,VIEW:4},VIEW:{STATISTIC:0,MAP:1,LIST:2,GRID:3},SEARCH:{EDIT:0,BUTTON:1},displayShort:[{value:"CoolStorage",display:"CoolSt"},{value:"HeatStorage",display:"HeatSt"},{value:"HeatExchange",display:"HeatEx"}],controlSet:[[{apiName:"operations",id:"AirConditioner.Indoor.General",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.Ventilator",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.DHW",parameter:"power"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.General.Speed",parameter:"wind"},{},{apiName:"modes",id:"AirConditioner.Indoor.ModeLimit",parameter:"mode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"}],[{apiName:"configuration",parameter:"remoteControl"},{apiName:"airConditioner",parameter:"filterResetRequired"},{apiName:"airConditioner",parameter:"spi"},{apiName:"airConditioner",parameter:"stillAir"}],{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.Ventilator",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.Ventilator.Speed",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.DHW",parameter:"mode"},[{apiName:"airConditioner",parameter:"chiller",underParameter:"waterLaw"},{apiName:"airConditioner",parameter:"chiller",underParameter:"quiet"},{apiName:"airConditioner",parameter:"chiller",underParameter:"forcedFan"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demand"}],{apiName:"airConditioner",parameter:"chiller",underParameter:"mccMode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"desired"}],[{apiName:"temperatures",id:"AirConditioner.Indoor.Room",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"desired",Heat:"AirConditioner.Indoor.DischargeAir.Heat",Cool:"AirConditioner.Indoor.DischargeAir.Cool"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"enabled"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demandLevel"}],outdoorControlConfig:{electricCurrentControl:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:50,text:"50%"},{value:55,text:"55%"},{value:60,text:"60%"},{value:65,text:"65%"},{value:70,text:"70%"},{value:75,text:"75%"},{value:80,text:"80%"},{value:85,text:"85%"},{value:90,text:"90%"},{value:95,text:"95%"},{value:100,text:"100%"}],coolingCapacityCalibration:{Celsius:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"5~7\xb0C"},{value:"7~9",text:"7~9\xb0C"},{value:"9~11",text:"9~11\xb0C"},{value:"10~12",text:"10~12\xb0C"},{value:"11~13",text:"11~13\xb0C"},{value:"12~14",text:"12~14\xb0C"},{value:"13~15",text:"13~15\xb0C"}],Fahrenheit:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"41~45\xb0F"},{value:"7~9",text:"45~48\xb0F"},{value:"9~11",text:"48~52\xb0F"},{value:"10~12",text:"50~54\xb0F"},{value:"11~13",text:"52~55\xb0F"},{value:"12~14",text:"54~57\xb0F"},{value:"13~15",text:"55~59\xb0F"}]},heatingCapacityCalibration:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:25,text:"25kg/cm\xb2"},{value:26,text:"26kg/cm\xb2"},{value:27,text:"27kg/cm\xb2"},{value:28,text:"28kg/cm\xb2"},{value:29,text:"29kg/cm\xb2"},{value:30,text:"30kg/cm\xb2"},{value:31,text:"31kg/cm\xb2"},{value:32,text:"32kg/cm\xb2"},{value:33,text:"33kg/cm\xb2"}]},INNER_LAYOUT:{MONITORING:0,REGISTRATION:1},FILTER_NAME:{SELECTALL:"selectAll",ZONE:"zone",STATUS:"status",TYPE:"type",MODE:"mode",ASSET_TYPE:"assetType"},ACTION_NAME:{DETAIL:"detail",REGISTER:"register",DELETE:"delete",BLOCK:"block",SELECTEDTEXT:"selectedText",VIEW:"view",ASSET_TYPE:"assetType"},REGISTRATION_STATUS_BUTTONS:{REGISTER:0,UNREGISTER:1},LIGHT_CONTROL:{POWER:0,DIMMING:1}}}),define("device/common/device-model",[],function(){"use strict";var e=window.kendo;return{Device:e.data.Model.define({id:"id",fields:{alarms:{type:"object",editType:null},networks:{type:"object"},parentId:{type:"string"},winds:{type:"object"},registrationStatus:{type:"string",options:[{text:"NotRegistered",value:"0"},{text:"Registered",value:"1"},{text:"Deleted",value:"1"}]},name:{type:"string"},information:{type:"object"},subordinateIds:{type:"object"},operations:{type:"object"},mappedType:{type:"string",options:[{text:"ControlPoint",value:"0"},{text:"Light",value:"1"},{text:"Meter.WattHour",value:"2"},{text:"Sensor.Humidity",value:"3"},{text:"Sensor.Motion",value:"4"},{text:"Sensor.Temperature",value:"5"}]},representativeStatus:{type:"string",options:[{text:"Normal.On",value:"0"},{text:"Normal.Off",value:"1"},{text:"Alarm.Critical",value:"2"},{text:"Alarm.Warning",value:"3"},{text:"Alarm.NetworkError",value:"4"},{text:"Disconnected",value:"5"},{text:"LowBattery",value:"6"},{text:"OutOfBounds",value:"7"}]},modes:{type:"object"},controlPoint:{type:"object"},groups:{type:"object"},configuration:{type:"object"},light:{type:"object"},type:{type:"string"},id:{type:"string"},schedules:{type:"object"},description:{type:"string"},locations:{type:"object"},airConditioner:{type:"object"},temperatures:{type:"object"}}}),DevicePopup:e.data.Model.define({id:"id",fields:{id:{name:"Device ID",type:"string",editType:null},name:{name:"Device NAME",type:"string",editType:"input"},representativeStatus:{name:"Status",type:"string",editType:null},modes:{name:"Operation Mode",type:"string",editType:null},temperatureS:{name:"Set Temperature",type:"string",editType:null},temperatureC:{name:"Current Temperature",type:"string",editType:null},locations:{name:"Location",type:"string",editType:"select"},groups:{name:"Group",type:"string",editType:null},"control-point":{name:"Remote Control",type:"string",editType:"input"},model:{name:"Model",type:"string",editType:null},type:{name:"Type",type:"string",editType:null},version:{name:"Firmware Version",type:"string",editType:null},description:{name:"Description",type:"string",editType:"input"}}})}}),define("device/common/device-api",["device/common/device-model"],function(e){"use strict";function o(e){var t="/dms/devices/"+e;return $.ajax({url:t,method:"DELETE"})}function r(e){return $.ajax({url:"/dms/devices",method:"PATCH",data:e})}var M=window.MAIN_WINDOW,P=e.Device,H={"AirConditioner.Indoor":["AirConditioner.*"],AirConditionerOutdoor:["AirConditionerOutdoor"],ControlPoint:["ControlPoint.*"],Meter:["Meter*"],"Sensor.Temperature_Humidity":["Sensor.Temperature_Humidity","Sensor.Temperature","Sensor.Humidity"],Light:["Light"],SmartPlug:["SmartPlug"],"Sensor.Motion":["Sensor.Motion"],Gateway:["Gateway"],Beacon:["Beacon"],CCTV:["CCTV"]},F={ControlPoint:{mappedTypes:"ControlPoint"},Meter:{types:"ControlPoint.*"},"Sensor.Temperature_Humidity":{types:"ControlPoint.*"}},k={"ControlPoint.*":{mappedTypes:["ControlPoint"]},Light:{types:["ControlPoint.*"],mappedTypes:["Light"]},"Meter*":{types:["ControlPoint.*"],mappedTypes:["Meter*"]},"Sensor.Temperature_Humidity":{types:["ControlPoint.*"],mappedTypes:["Sensor.Humidity","Sensor.Temperature","Sensor.Temperature_Humidity"]},"Sensor.Motion":{types:["ControlPoint.*"],mappedTypes:["Sensor.Motion"]}},U={On:{representativeStatuses:"Normal.On"},Off:{representativeStatuses:"Normal.Off"},Critical:{representativeStatuses:"Alarm.Critical"},Warning:{representativeStatuses:"Alarm.Warning"},Normal:{representativeStatuses:"Normal"},"Alarm.Critical":{representativeStatuses:"Alarm.Critical"},"Alarm.Warning":{representativeStatuses:"Alarm.Warning"}};return{getStatisticByKey:function(e){var t;switch(e){case"AirConditioner.Indoor":t="/dms/devices/statisticView/AirConditioner";break;case"Meter":t="/dms/devices/statisticView/Meter";break;case"Sensor.Temperature_Humidity":t="/dms/devices/statisticView/Sensor.Temperature_Humidity";break;case"Light":t="/dms/devices/statisticView/Light";break;case"Sensor.Motion":t="/dms/devices/statisticView/Sensor.Motion";break;case"Gateway":t="/dms/devices/statisticView/Gateway";break;case"CCTV":t="/dms/devices/statisticView/CCTV";break;case"Beacon":t="/dms/devices/statisticView/Beacon";break;case"Asset":t="/dms/devices/statisticView/Asset";break;case"SmartPlug":t="/dms/devices/statisticView/SmartPlug"}return M.getCurrentFloor().building.id==M.FLOOR_NAV_BUILDING_TOTAL_ID&&(t+="?exposeFloors=false"),$.ajax({url:t}).then(function(e){return e=e||[]})},getDeviceWithType:function(e,t,i,n,o){var a;a=$.isArray(e)?e:H[e]?H[e]:[];var r,l,s,d,c,p,g,h,u=new $.Deferred,f="/dms/devices",m="",_={},v={},b=!1,T="",C="",E=(o=o||{}).type,I=o.mode||{},y=o.statuses||[],A=o.zones||[],D=o.name&&o.name.replace(/\s/g,"+")||null;if(E&&"Beacon"!=a[0])l=F[e]&&F[e].types,s=F[e]&&F[e].mappedTypes,_.types=E,s&&(_.mappedTypes=s),l&&(v.types=l,v.mappedTypes=E);else if(a){for(c=0,p=a.length;c<p;c++)r=a[c],!b&&k[r]&&(b=!0,l=k[r].types,s=k[r].mappedTypes,l?(T=f+"?types="+(l=l.join(","))+"&mappedTypes="+(s=s.join(",")),v.types=l,v.mappedTypes=s):s=s.join(",")),m+=r,m+=",";_.types=m.substr(0,m.length-1)}if(0<y.length){for(c=0,p=y.length;c<p;c++)(d=U[d=y[c]]).representativeStatuses&&-1==C.indexOf(d.representativeStatuses)&&(C+=d.representativeStatuses+",");C&&C.lastIndexOf(",")===C.length-1&&(C=C.substr(0,C.length-1)),_.representativeStatuses=C}I.value&&I.id&&(_.equals=I.value,_.equalsAttribute="modes-"+I.id+"-mode"),0<A.length&&(_.foundation_space_zones_id=A.join(",")),D&&(_.contains=D,_.containsAttributes="id,name,controlPoint-tagName");var S=M.getCurrentFloor(),w=S.building,L=S.floor;w.id&&w.id!=M.FLOOR_NAV_BUILDING_TOTAL_ID&&(g=w.id),L.id&&L.id!=M.FLOOR_NAV_FLOOR_ALL_ID&&(h=L.id),t?t=t.join(","):(t="Registered,NotRegistered",-1==f.indexOf("Beacon")||n||(t+=",Blocked")),-1!=t.indexOf("NotRegistered")&&(h=g=null),g&&(_.foundation_space_buildings_id=g),h&&(_.foundation_space_floors_id=h),_.registrationStatuses=t,$.isEmptyObject(v)||(v.registrationStatuses=t,v.foundation_space_buildings_id=g,v.foundation_space_floors_id=h,C&&(v.representativeStatuses=C),I.value&&I.id&&(v.equals=I.value,v.equalsAttribute="modes-"+I.id+"-mode"),0<A.length&&(v.foundation_space_zones_id=A.join(",")),D&&(v.contains=D,v.containsAttributes="id,name,controlPoint-tagName")),b&&!T&&(_.mappedTypes=s),i&&(i.typeQuery&&(_=$.extend(_,i.typeQuery)),i.mappedTypeQuery&&(v=$.extend(v,i.mappedTypeQuery)));var x,O,N=[],R=[],B=[];return v.registrationStatuses&&(f="/dms/devices",v.types&&(f+="?types="+v.types,delete v.types),v.mappedTypes&&(f+=-1!=f.indexOf("?")?"&":"?",f+="mappedTypes="+v.mappedTypes,delete v.mappedTypes),v.representativeStatuses&&(f+=-1!=f.indexOf("?")?"&":"?",f+="representativeStatuses="+v.representativeStatuses,delete v.representativeStatuses),v.foundation_space_zones_id&&(f+=-1!=f.indexOf("?")?"&":"?",f+="foundation_space_zones_id="+v.foundation_space_zones_id,delete v.foundation_space_zones_id),N.push($.ajax({url:f,data:v}).then(function(e){e.page?(R=e.data,x=e.page):R=e}).fail(function(e){u.reject(e)}))),f="/dms/devices",_.types&&(f+="?types="+_.types,"Beacon"==_.types&&E&&(f+="&equals="+E+"&equalsAttribute=configuration-mobilityType"),delete _.types),_.mappedTypes&&(f+=-1!=f.indexOf("?")?"&":"?",f+="mappedTypes="+_.mappedTypes,delete _.mappedTypes),1<_.registrationStatuses.split(",").length&&(f+=-1!=f.indexOf("?")?"&":"?",f+="registrationStatuses="+_.registrationStatuses,delete _.registrationStatuses),_.representativeStatuses&&(f+=-1!=f.indexOf("?")?"&":"?",f+="representativeStatuses="+_.representativeStatuses,delete _.representativeStatuses),_.foundation_space_zones_id&&(f+=-1!=f.indexOf("?")?"&":"?",f+="foundation_space_zones_id="+_.foundation_space_zones_id,delete _.foundation_space_zones_id),N.push($.ajax({url:f,data:_}).then(function(e){B=e.page?(O=e.page,e.data):e}).fail(function(e){u.reject(e)})),$.when.apply(this,N).always(function(){var e,t,i,n,o,a,r=!1;for(i=B.length,n=R.length,e=0;e<n;e++){for(a=R[e],r=!1,t=0;t<i;t++)if(o=B[t],a.id==o.id){r=!0;break}r||B.push(a)}i=B.length;var l=[];for(e=0;e<i;e++)(o=B[e]).locations&&!o.locations[0]&&(o.locations[0]={}),o.assets||(o.assets=[]),o.selected=!1,o=new P(o),l.push(o);if(O||x){var s={data:l,total:0};O&&(s.typePage=O,s.total+=O.totalElements),x&&(s.mappedTypePage=x,s.total+=x.totalElements),u.resolve(s)}else u.resolve(l)}),u.promise()},getDeviceWithID:function(e){var t="/dms/devices/"+e;return $.ajax({url:t})},getDeviceWithMultipleID:function(e){var t="/dms/devices";if(e){for(var i="",n=0,o=e.length;n<o;n++)i+=e[n],i+=",";t+="?ids="+i.substr(0,i.length-1)}return $.ajax({url:t})},patchDevice:function(e,t){var i="/dms/devices/"+e;return $.ajax({url:i,method:"PATCH",data:t})},patchDevices:r,deleteDevice:o,multiControl:function(e){return $.ajax({url:"/dms/devices/multiControl",method:"PUT",data:e})},patchGroupAttr:function(e,t,i){var n="/dms/devices/"+e+"/"+t+"/";return $.ajax({url:n,method:"PATCH",data:i})},deleteDevices:function(e){var t,i=e.length,n=[];for(t=0;t<i;t++)n.push(o(e[t]));return $.when.apply(this,n)},patchOutdoorCurrentLimit:function(e){var t=e.value,i=e.item;return $.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{electricCurrentControl:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.electricCurrentControl&&(i.airConditioner.outdoorUnit.electricCurrentControl=t)})},patchOutdoorHeatingCapacityCalibration:function(e){var t=e.value,i=e.item;$.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{heatingCapacityCalibration:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.heatingCapacityCalibration&&(i.airConditioner.outdoorUnit.heatingCapacityCalibration=t)})},patchOutdoorCoolingCapacityCalibration:function(e){var t=e.value,i=e.item;$.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{coolingCapacityCalibration:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.coolingCapacityCalibration&&(i.airConditioner.outdoorUnit.coolingCapacityCalibration=t)})},getZone:function(e,t){return $.ajax({url:"/foundation/space/zones?foundation_space_floors_id="+e}).then(function(e){return(e=e||[]).sort(function(e,t){return e.sortOrder-t.sortOrder}),t&&e.unshift({id:void 0,name:"No Zone"}),e})},patchRegistrationStatus:function(e,t){var i,n,o=[],a=e.length;for(n=0;n<a;n++)(i={id:e[n].id}).registrationStatus=t,o.push(i);return r(o)},patchControlPointValue:function(e,t){return"number"==typeof t&&(t=t.toString()),$.ajax({url:"/dms/devices/"+e+"/controlPoint",method:"PATCH",data:{value:t}})}}}),define("hmi/hmi-util",["device/common/device-api","hmi/hmi-common"],function(e,c){var d=window.Util,p=window.I18N,a=new window.CommonLoadingPanel;function s(e){return-1!=["Alarm","Valve","ExtLabel"].indexOf(e)}function g(e){return!(!e||"AI"!=e&&"AO"!=e&&"DI"!=e&&"DO"!=e&&-1==e.indexOf("ControlPoint"))}function h(e){return!(!e||-1==e.indexOf("DO")&&-1==e.indexOf("DI"))}function u(e,t){var i;i="string"==typeof e?e:e.categoryName;var n,o,a,r=c.ControlPointValueAndStateMapping[i],l=[];if(i&&r&&r.state)for(a in n=s(i)?(t||console.error("this is multi binding type graphic "+i+"device type not provided"),h(t)?r.state.digital:r.state.analog):r.state)o=n[a],l.push({value:o,text:p.prop("HMI_STATE_"+o.toUpperCase())});return l}function f(e){return"Gauge"==e||"Damper"==e||"Pumps2"==e||"Tank"==e||"WaterTank"==e||"AnalogSensor"==e||"Valve"==e||"Dimming"==e}var m=function(e){var t,i=e.airConditioner,n=e.type;i&&i.indoorUnitType?(t=(t=i.indoorUnitType.replace("AirConditioner.Indoor.","")).replace(/\./gi,"_").toUpperCase(),t=p.prop("HMI_AIRCONDITIONER_INDOOR_TYPE_"+t)):(t=(t=n.replace("AirConditioner.","")).replace(/\./gi,"_").toUpperCase(),t=p.prop("HMI_AIRCONDITIONER_TYPE_"+t));return t},t={DeviceApi:e,Loading:a,canBindingType:function(e){return-1==[].indexOf(e)},isMultiBindingType:s,hasControlValueGraphic:function(e){return"ProgressBar"==e||"ScaleBar"==e||"ToggleButton"==e||"Combobox"==e||"RadioButton"==e||"ExtLabel"==e},getReverseState:function(e){return"off"==e?e="on":"on"==e?e="off":"stop"==e?e="rotate":"rotate"==e&&(e="stop"),e},getReverseValue:function(e){return e=1==e?0:1},getImageInfoFromUrl:function(e){var n=new $.Deferred,t=new Image;return t.crossOrigin="Anonymous",t.onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.height=this.naturalHeight,e.width=this.naturalWidth,t.drawImage(this,0,0);var i=e.toDataURL("image/jpeg");n.resolve({dataUrl:i,width:this.width,height:this.height})},t.src=e,n.promise()},getImageInfoFromFile:function(e,l){var s,d=new $.Deferred;return e=e||"",l=l||c.IMAGE_FILE_MAX_SIZE,e&&0<(s=$("input.image-info-input."+e)).length&&s.remove(),s=$('<input class="image-info-input '+e+'" type="file" accept=".png, .jpg, .gif" tabindex="0" />'),$("body").append(s),s.trigger("click"),s.on("change",function(e){var n=e.target.files[0],t=e.target.value,i=new FileReader;i.onload=function(e){var t=e.target.result,i=new Image;i.onload=function(){d.resolve({file:n,width:this.width,height:this.height,dataUrl:t})},i.onerror=function(e){d.reject(e)},i.src=t,s.remove()},i.onerror=function(e){d.reject(e)};var o,a=t.slice(t.lastIndexOf(".")).toLowerCase();if(n.size>l){var r=l/1024/1024;o=p.prop("HMI_INVALID_IMAGE_SIZE",r),d.reject(o)}else".png"==a||".jpg"==a||".gif"==a?i.readAsDataURL(n):(o=p.prop("HMI_IMAGE_EXTENSION_ERROR"),d.reject(o))}),d.promise()},getJSONFileData:function(){var n=new $.Deferred,o=$('<input class="json-file-import-input" type="file" accept=".json,application/json" />');return $("body").append(o),o.trigger("click"),o.on("change",function(e){a.open();var i=e.target.files[0],t=new FileReader;t.onload=function(e){var t=e.target.result;o.remove(),n.resolve(i,t),a.close()},t.readAsText(i)}),n.promise()},getKeepRatioSize:function(e,t,i,n){var o,a;return t<e?(o=n/i,a=t/e):e<t&&(o=i/n,a=e/t),o!=a&&(t<e?n=i*a:e<t&&(i=n*a)),{width:i,height:n}},updateOldImagePath:function(e,t){if(e){if(-1!==e.indexOf("data:"))return e;-1!==e.indexOf("asset")&&(t!=c.CURRENT_HMI_VERSION&&t?t==c.INITIAL_HMI_VERSION&&(-1!==e.indexOf("../asset/icons")?e=e.replace("../asset/icons","../../src/main/resources/static-dev/asset/icons"):-1!==e.indexOf("../asset/images")&&(e=e.replace("../asset/images","../../src/main/resources/static-dev/asset/images"))):-1!==e.indexOf("../asset/icons")?e=e.replace("../asset/icons","../../src/main/resources/static-dev/images/icon"):-1!==e.indexOf("../../src/main/resources/static-dev/asset/icons")?e=e.replace("../../src/main/resources/static-dev/asset/icons","../../src/main/resources/static-dev/images/icon"):-1!==e.indexOf("../asset/images")&&(e=e.replace("../asset/images","../../src/main/resources/static-dev/images/icon")))}return e},isControlPointType:g,isDigitalType:h,getDeviceInfo:function(e,t){var i,n=e.id?e.id:null,o=n?e.name:null;t=t||(e.type?e.type:null),e.controlPoint&&(o=o||e.controlPoint.name,i=e.controlPoint.tagName?e.controlPoint.tagName:"-"),o=o||"-";var a=0;g(t)?(a=e.controlPoint?e.controlPoint.value:null,t=1<(t=t.split("ControlPoint.")).length?t[1]:t[0]):"Sensor.Temperature"==t||"Sensor.Temperature_Humidity"==t?a=e.temperatures&&e.temperatures[0]?e.temperatures[0].current:null:"Sensor.Humidity"==t&&(a=e.humidities&&e.humidities[0]?e.humidities[0].current:null);var r=e.mappedType?e.mappedType:t;n||(a=r=t=null);var l,s="";return t&&(s=d.getDetailDisplayTypeDeviceI18N(t)),t&&-1!=t.indexOf("AirConditioner")?s=l=m(e):l=r?d.getDetailDisplayTypeDeviceI18N(r):s,{typeText:s,mappedType:r,displayType:l,value:a,name:o,tagName:i,id:n,type:t}},getI18NIndoorType:m,getDeviceValueObj:function(e,t){var i={};return g(e)?i.controlPoint={value:t}:"Sensor.Temperature"==e?i.temperatures=[{current:t}]:"Sensor.Sensor.Humidity"==e&&(i.humidities=[{current:t}]),i},getGraphicCatergoryPointType:function(e){var t=c.ControlPointValueAndStateMapping[e];if(t&&t.state){var i=t.valueType[0];return i=(i=i&&Object.keys(i))&&i[0]}return null},isLegacyGraphic:function(e){return!(!e||-1==e.indexOf("/asset/"))},hasColorGraphic:function(e){var t,i=e.images;if(i)for(t in i)if(-1!=(t=t.toUpperCase()).indexOf("GRAY")||-1!=t.indexOf("RED")||-1!=t.indexOf("BLUE")||-1!=t.indexOf("GREEN")||-1!=t.indexOf("YELLOW"))return!0;return!1},isMultiLevelGraphic:f,getStateDataSource:u,getCurrentStateItem:function(e,t,i,n,o,a){var r=u(e,t);void 0!==i&&(i=Number(i));var l=0,s="Gauge"==e?n:10;return null==i?l=0:h(t)?l=i<2?i:2<=i&&i<=30?0:i<=70?1:2<r.length?2:1:f(e)?null!=o&&null!=a?(i<o&&(i=o),a<i&&(i=a),s=(a-o)/s,10<(l=Math.ceil((i-o)/s))&&(l=10)):(10<(i=Math.ceil(i/s))&&(i=10),l=i):l=i<=30?0:i<=70?1:2<r.length?2:1,r[l]},getElementBindingType:function(e){var t=c.ControlPointValueAndStateMapping[e];if(t&&t.valueType){var i,n,o,a,r=t.valueType,l=r.length;for(n=0;n<l;n++){if(i=r[n],-1!=(a=(o=Object.keys(i)).indexOf("DI")))return o[a];if(-1!=(a=o.indexOf("DO")))return o[a];if(-1!=(a=o.indexOf("AI")))return o[a];if(-1!=(a=o.indexOf("AO")))return o[a]}}return null},getGridPosition:function(e){var t=Number(e);return isNaN(t)?e:Math.round(e/c.DEFAULT_GRID_WIDTH)*c.DEFAULT_GRID_WIDTH},getBrightness:function(e){var t=window.kendo.parseColor(e),i=t.r,n=t.g,o=t.b;return Math.sqrt(i*i*.241+n*n*.691+o*o*.068)},convertExpandInfoToCookieData:function(e){var i,n,o=[];return e.forEach(function(e,t){i=e.id||t,n=e.expanded,o.push(i+"="+n)}),o.join(",")},parseCookieDataToExpandInfo:function(e,t){var i,n=[];return e&&e.split(",").forEach(function(e){e=e.split("="),i={expanded:"true"==e[1]},t&&(i.id=Number(e[0])),n.push(i)}),n},isInvalidDevice:function(e){var t=e.registrationStatus;return!t||"NotRegistered"==t||"Deleted"==t},getGraphicDeviceInfo:function(e){var t,i,n,o,a=0,r=0,l=0,s=0,d=[];return e.forEach(function(e){t=e.get&&e.get("type")||e.type,n=e.prop&&e.prop("binding")||e.binding,i="function"==typeof e.angle?e.angle():e.angle,o=n.device,"hmi.Group"==t?s++:o&&o.id?(d.push(o),a++):0!=i?l++:r++}),{devices:d,cntBindingObjects:a,cntVectorGraphicObjects:r,cntGroupedObjects:s,cntRotatedObjects:l,totalFiguresSize:a+r+s+l}}};return window.HmiUtil=t}),define("hmi/template/facility-template",function(){return{AHU_TEMPLATE:[{type:"draw2d.shape.composite.Group",id:"c30f390a-992d-94f4-4729-7f11f04826b5",x:184.9453125,y:47.5,width:980.5546875,height:438.5,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:42,facilityTemplateVersion:"1.0"},cssClass:"draw2d_shape_composite_Group",ports:[],bgColor:"none",color:"none",stroke:1,radius:0,dasharray:null},{type:"draw2d.shape.basic.Image",id:"2afc72af-094b-7265-5ddc-b4416dcc608e68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:280.7731409928697,y:100.5,width:239,height:109,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:1},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Duct/Ducts_HorzStraight.svg"},{type:"draw2d.shape.basic.Image",id:"7e53ef96-850e-8f1b-db54-8ebae7a192cc68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:289,y:320,width:223,height:109,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:2,isMapped:!0,DeviceType:"Device type",figfilePath:""},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Duct/Ducts_HorzStraight.svg"},{type:"draw2d.shape.basic.Image",id:"7e9ac357-4843-2cda-88c0-1d4142c221aa68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:462.5,y:97,width:346,height:335,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:3,isMapped:!0,DeviceType:"Device type",figfilePath:""},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Duct/Ducts_H.svg"},{type:"draw2d.shape.basic.Image",id:"e8320bc7-e825-3c4d-74e7-6d57af8f4cab68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:184.9453125,y:342.5,width:94,height:71,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:4,isMapped:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"00R_blue_Arrow_Down_Left_GRP",combinedElePosition:"00R blue Arrow Down Left"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Arrow/arrow_blue.png"},{type:"draw2d.shape.basic.Image",id:"04050d7e-0fdd-5180-65ec-2925f6707be8",x:771,y:100,width:304,height:109,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:40},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Duct/Ducts_HorzStraight.svg"},{type:"draw2d.shape.basic.Image",id:"0652399c-19df-b68f-dc65-b82bf2bedf5768553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:191.9453125,y:118.5,width:94,height:71,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:5,isMapped:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"00A_Exhaust_Air_GRP",combinedElePosition:"00A Exhaust Air"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Arrow/arrow_red_L.png"},{type:"draw2d.shape.basic.Image",id:"e198aa50-f736-d4f2-129f-629f7c7051ef68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:644,y:319,width:110,height:110,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:7,isMapped:!0,isVisible:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"AHU_FILTER_AL_GRP",combinedElePosition:"00O Closed Window Icon"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Filter_V.png"},{type:"draw2d.shape.basic.Animation",id:"e198aa50-f736-d4f2-129f-629f7c7051ef68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403227508.92597228684541991.651306049952493.091469302075",x:665.8076923076924,y:361.5,width:48,height:44,alpha:1,angle:0,categoryName:"Alarm",visible:!0,userData:{figid:8,isMapped:!0,isVisible:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"AHU_FILTER_AL_GRP"},cssClass:"draw2d_shape_basic_Animation",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Error/ani/alarm.gif"},{type:"draw2d.shape.basic.Image",id:"94416d6c-9342-3884-2f13-2af546f5e1cf68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:576.2745098039215,y:208,width:112,height:105,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:9,isMapped:!0,isVisible:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"AHU_MA_DAMPER_CNTRL_GRP",combinedElePosition:"00C MA Damper"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Damper/Damper_H3_Blue.png"},{type:"draw2d.shape.basic.Image",id:"57902f0c-3ff6-8354-20a9-63a71c620aeb",x:770.8850002288818,y:319.5943396226421,width:309,height:109,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:41},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Duct/Ducts_HorzStraight.svg"},{type:"draw2d.shape.basic.Image",id:"97fe1dcd-500e-3f9d-bbcf-a42b55a83a6e68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:1070,y:328.2142857142858,width:94,height:71,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:10,isMapped:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"00I_Supply_Air_GRP",combinedElePosition:"00I Supply Air"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Arrow/arrow_blue.png"},{type:"draw2d.shape.basic.Image",id:"45c95a77-5b8c-9d45-d3ab-cca44128013768553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:943,y:299.5,width:108,height:86,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:11,isMapped:!0,isVisible:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"AHU_SA_TEMP_GRP",combinedElePosition:"00K Temp Down Blue"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Sensor_Down_Blue.png"},{type:"draw2d.shape.basic.Image",id:"1e89b801-07e4-6cb2-8fa5-4ed38b00c0fa68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:999,y:298.5,width:108,height:86,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:12,isMapped:!0,isVisible:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"AHU_SA_HUMI_GRP",combinedElePosition:"00J Humi Down Green"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Sensor_Down_Green.png"},{type:"draw2d.shape.basic.Image",id:"8542f785-d18c-7f0f-881c-7a09e25c6ae268553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:1071.5,y:111.5,width:94,height:71,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:13,isMapped:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"00H_Return_Air_GRP",combinedElePosition:"00H Return Air"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Arrow/arrow_red_L.png"},{type:"shape_designer.figure.ExtLabel",id:"56145142-3002-d56a-508c-948d7ae2670d42114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:195.5,y:184,width:61.34375,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:14,combinedFigGrp:"00A_Exhaust_Air_GRP"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:"Exhaust Air",outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#080808",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:89,currentFontSize:16,bold:!1,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"7229c126-d93a-9ad4-b2e5-76f0d2d1f95a42114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:428.6626506024095,y:215,width:62,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:15,combinedFigGrp:"AHU_EA_DAMPER_CNTRL_GRP"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:"EA Damper",outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#080808",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:93,currentFontSize:16,bold:!1,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"1ea2b8ec-8df6-37c5-ec3a-a786e5a3667842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:439,y:234,width:87,height:27,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:16,DeviceId:"14:FF:230:03:32:47:21cwddc",combinedFigGrp:"AHU_EA_DAMPER_CNTRL_GRP_UPDATABLE"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:0,outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#1A14DF",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:19,currentFontSize:16,bold:!0,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"970b72c6-9123-d343-c9da-2c81dc29d6f142114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:689.3333333333334,y:267.3999996185303,width:66,height:23,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:17,combinedFigGrp:"AHU_MA_DAMPER_CNTRL_GRP"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:"MA Damper",outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#080808",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:95,currentFontSize:16,bold:!1,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"b70d3254-90de-8426-c4ca-bb626500793f42114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:689.3333333333334,y:240,width:95,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:18,DeviceId:"14:FF:230:03:33:47:21cwddc",combinedFigGrp:"AHU_MA_DAMPER_CNTRL_GRP_UPDATABLE"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:0,outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#1E18E1",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:37,currentFontSize:16,bold:!0,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"16fa5045-938d-19ce-1232-ca2498b68f5242114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:982,y:257.5,width:32,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:19,DeviceId:"14:FF:230:02:20:47:21cwddc",combinedFigGrp:"AHU_SA_TEMP_GRP_UPDATABLE"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:50,outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#1E18E1",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:37,currentFontSize:16,bold:!0,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"2d684a49-7152-c2c8-6560-3fafc693147442114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:1038,y:257,width:43,height:26,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:20,DeviceId:"14:FF:230:02:21:47:21cwddc",combinedFigGrp:"AHU_SA_HUMI_GRP_UPDATABLE"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:100,outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#1E18E1",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:37,currentFontSize:16,bold:!0,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"836a5c8e-9872-7b00-c581-bf2cdabd81ea42114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:1082.375,y:175.703125,width:55,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:21,combinedFigGrp:"00H_Return_Air_GRP"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:"Return Air",outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#080808",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:79,currentFontSize:16,bold:!1,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"ff83585a-b758-f8fa-dfd8-fe432acc123142114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:1081.3850002288818,y:385.5,width:57,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:22,combinedFigGrp:"00I_Supply_Air_GRP"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:"Supply Air",outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#080808",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:81,currentFontSize:16,bold:!1,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"draw2d.shape.basic.Image",id:"ab9841a5-d25d-928a-06f1-a12d8efc3e6c68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:734,y:363.5,width:84,height:82,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:23,isMapped:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"AHU_WATER_GRP",combinedElePosition:"00M Yellow Below icon"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Steam/Steam_R_N.png"},{type:"draw2d.shape.basic.Image",id:"3c5e2b81-53b6-3e17-ff0e-979d449adea068553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:563.3850002288818,y:372.2142857142858,width:108,height:86,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:24,isMapped:!0,isVisible:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"AHU_MA_TEMP_GRP",combinedElePosition:"00P temp down green"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Sensor_Down_Green_up.png"},{type:"shape_designer.figure.ExtLabel",id:"6db5ed9f-40d5-e5f6-6e49-48c7e327f71142114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:188.5,y:402.2142857142858,width:62,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:25},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:"Outdoor Air",outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#080808",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:90,currentFontSize:16,bold:!1,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"d3ba0af4-0d7d-ca6b-634d-339d352daf7142114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:428.6626506024095,y:430,width:63,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:26,combinedFigGrp:"AHU_OA_DAMPER_CNTRL_GRP"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:"OA Damper",outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#080808",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:94,currentFontSize:16,bold:!1,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"e824f44f-bba8-f6c6-9f58-0d26b1d430fe42114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:439,y:449,width:107,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:27,DeviceId:"14:FF:230:03:31:47:21cwddc",combinedFigGrp:"AHU_OA_DAMPER_CNTRL_GRP_UPDATABLE"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:0,outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#1A14DF",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:19,currentFontSize:16,bold:!0,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"a410d012-0290-2294-26cb-098f530075aa42114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:600.3850002288818,y:459,width:32,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:28,DeviceId:"14:FF:230:02:24:47:21cwddc",combinedFigGrp:"AHU_MA_TEMP_GRP_UPDATABLE"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:50,outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#1E18E1",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:45,currentFontSize:16,bold:!0,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"draw2d.shape.basic.Animation",id:"aaf30fb4-516c-e882-4687-4903e96f4da611878.5987107403127508.92597228684541991.651306049952493.091469302075",x:830.8937492370605,y:302.39374923706055,width:141,height:141,alpha:1,angle:0,categoryName:"Blower",visible:!0,userData:{figid:30,combinedFigGrp:"AHU_SFAN_INVER_ST_GRP",combinedElePosition:"00L Supply Fan"},cssClass:"draw2d_shape_basic_Animation",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Blower/Blower_R1.png"},{type:"draw2d.shape.basic.Animation",id:"aec697d5-38d6-8128-e093-7374c816a90811878.5987107403127508.92597228684541991.651306049952493.091469302075",x:416,y:99.5,width:110,height:110,alpha:1,angle:0,categoryName:"Damper",visible:!0,userData:{figid:31,combinedFigGrp:"AHU_EA_DAMPER_CNTRL_GRP",combinedElePosition:"00B EA Damper"},cssClass:"draw2d_shape_basic_Animation",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Damper/Damper_V1_Blue.png"},{type:"draw2d.shape.basic.Animation",id:"af91e3dc-4644-2644-7f71-afcb7ad1dce611878.5987107403127508.92597228684541991.651306049952493.091469302075",x:425.5,y:316.39374923706055,width:113,height:113,alpha:1,angle:0,categoryName:"Damper",visible:!0,userData:{figid:32,combinedFigGrp:"AHU_OA_DAMPER_CNTRL_GRP",combinedElePosition:"00Q OA Damper Blue "},cssClass:"draw2d_shape_basic_Animation",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Damper/Damper_V1_Blue.png"},{type:"draw2d.shape.basic.Animation",id:"eea13d74-15f4-101f-fcae-7b6f0a3eb30111878.5987107403127508.92597228684541991.651306049952493.091469302075",x:692.5,y:319.5943396226421,width:110,height:110,alpha:1,angle:0,categoryName:"Coil",visible:!0,userData:{figid:33,combinedFigGrp:"AHU_COMP_ST_GRP",combinedElePosition:"00N Blue grill icon"},cssClass:"draw2d_shape_basic_Animation",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Coil/Coil_V_Cool_Stop.png"},{type:"draw2d.shape.basic.Animation",id:"2755d8ab-ef24-7162-5a9d-1317c2c0b2c011878.5987107403127508.92597228684541991.651306049952493.091469302075",x:717,y:91.5,width:126,height:126,alpha:1,angle:0,categoryName:"Blower",visible:!0,userData:{figid:35,combinedElePosition:"00D Return Fan",combinedFigGrp:"AHU_RFAN_INVER_ST_GRP"},cssClass:"draw2d_shape_basic_Animation",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Blower/Blower_L1.png"},{type:"draw2d.shape.basic.Image",id:"70e83d5a-5495-7090-ae25-5e6786956bc768553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:880,y:78.5,width:108,height:86,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:36,isMapped:!0,isVisible:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"AHU_RA_HUMI_GRP",combinedElePosition:"00F Humi Up Green"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Sensor_Down_Green.png"},{type:"draw2d.shape.basic.Image",id:"3374bc4d-c285-cbe5-fb01-9b3a2cf66e7e68553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:816,y:78.5,width:108,height:86,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:37,isMapped:!0,isVisible:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"AHU_RA_TEMP_GRP",combinedElePosition:"00E temp Blue Up"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/Sensor_Down_Blue.png"},{type:"draw2d.shape.basic.Image",id:"447ae3ca-68a1-8b84-9630-5f164b3693f968553.0870100797688385.679464847089037.60379744623842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:964,y:72.5,width:68,height:94,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{figid:38,isMapped:!0,isVisible:!0,DeviceType:"Device type",figfilePath:"",combinedFigGrp:"AHU_SMOKE_AL_GRP",combinedElePosition:"00G Smoke Detector"},cssClass:"draw2d_shape_basic_Image",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],path:"../../src/main/resources/static-dev/asset/icons/SensorLamp_Up.png"},{type:"shape_designer.figure.ExtLabel",id:"d24564f7-3380-8541-5a37-c068b56bc1af27508.92597228684541991.651306049952493.091469302075",x:849,y:429.5,width:62,height:21.34375,alpha:1,angle:0,categoryName:"Text",visible:!0,userData:{fontSize:16,fontType:"Arial",fontStyle:"Normal",fillColor:"",fontColor:"#000000",isEditable:!0,figid:41,combinedFigGrp:"AHU_SFAN_INVER_ST_GRP_UPDATABLE"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:"Supply Fan",outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#080808",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:90.93999481201172,currentFontSize:16,bold:!1,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"7fba3cd9-55a9-22ee-1b8f-14e2ea7589ae27508.92597228684541991.651306049952493.091469302075",x:749,y:208.5,width:60.25,height:21.34375,alpha:1,angle:0,categoryName:"Text",visible:!0,userData:{fontSize:16,fontType:"Arial",fontStyle:"Normal",fillColor:"",fontColor:"#000000",isEditable:!0,figid:42,combinedFigGrp:"AHU_RFAN_INVER_ST_GRP_UPDATABLE"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:"Return Fan",outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#080808",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:90.04999542236328,currentFontSize:16,bold:!1,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"fe857992-d549-318e-6446-765713ec216b42114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:987,y:47.5,width:82,height:21.34375,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:29,DeviceId:"14:FF:230:00:38:47:21cwddc",combinedFigGrp:"AHU_SMOKE_AL_GRP"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:0,outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#080808",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:124,currentFontSize:16,bold:!1,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"ee154994-2f76-ca3a-c335-e2770684532942114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:857,y:48.5,width:43,height:26,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:39,DeviceId:"14:FF:230:02:22:47:21cwddc",combinedFigGrp:"AHU_RA_TEMP_GRP_UPDATABLE"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:50,outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#1E18E1",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:37,currentFontSize:16,bold:!0,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]},{type:"shape_designer.figure.ExtLabel",id:"2f7e01b0-80ee-dca6-c8d8-3f5d053df8c842114.754807486257926.1214419722138567.7725575163311878.5987107403127508.92597228684541991.651306049952493.091469302075",x:919,y:47.5,width:44,height:26,alpha:1,angle:0,categoryName:"Null",visible:!0,userData:{name:"Label",figid:40,DeviceId:"14:FF:230:02:23:47:21cwddc",combinedFigGrp:"AHU_RA_HUMI_GRP_UPDATABLE"},cssClass:"shape_designer_figure_ExtLabel",composite:"c30f390a-992d-94f4-4729-7f11f04826b5",ports:[],bgColor:"none",color:"#1B1B1B",stroke:0,radius:0,dasharray:null,text:100,outlineStroke:0,outlineColor:"none",fontSize:16,fontColor:"#1E18E1",fontFamily:null,editor:"shape_designer.figure.TextInPlaceEditor",currentTextWidth:37,currentFontSize:16,bold:!0,filters:[{name:"shape_designer.filter.PositionFilter"},{name:"shape_designer.filter.FontSizeFilter"},{name:"shape_designer.filter.FontColorFilter"}]}]}}),define("hmi/hmi-common",[],function(){var e=window.I18N,t=window.moment,i=new window.Howl({src:"../../src/main/resources/static-dev/sound/Alarm_Sound.mp3",loop:!0}),n={ticks:1,tickStep:1e3,tickFormat:function(e){return t(e).format("s")}},o=$.extend({},n,{tickStep:6e4,tickFormat:function(e){return t(e).format("HH:mm")}}),a=$.extend({},n,{ticks:24,tickStep:36e5,tickFormat:function(e){return t(e).format("H")}}),r=[{DI:"ControlPoint.DI"},{DO:"ControlPoint.DO"},{AI:"ControlPoint.AI"},{AO:"ControlPoint.AO"}],l=[{DI:"ControlPoint.DI"},{DO:"ControlPoint.DO"}],s=[{AI:"ControlPoint.AI"},{AO:"ControlPoint.AO"}],d={Blower:{state:{0:"stop",1:"rotate"},valueType:l},Coil:{state:{0:"off",1:"on"},valueType:l},Damper:{state:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},valueType:s},Pumps:{state:{0:"off",1:"on"},valueType:l},Pumps2:{state:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},valueType:s},Tank:{state:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},valueType:s},WaterTank:{state:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},valueType:s},Dimming:{state:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},valueType:s},Steam:{state:{0:"off",1:"on"},valueType:l},Button:{state:{0:"off",1:"on"},valueType:l},DIP:{state:{0:"off",1:"on"},valueType:l},LED:{state:{0:"off",1:"on"},valueType:l},Lever:{state:{0:"off",1:"on"},valueType:l},Toggle:{state:{0:"off",1:"on"},valueType:l},Selector:{state:{0:"off",1:"on"},valueType:l},CoolingTower:{state:{0:"stop",1:"rotate"},valueType:l},Generator:{state:{0:"stop",1:"rotate"},valueType:l},Scalebar:{valueType:s},ProgressBar:{valueType:s},Wind:{state:{0:"off",1:"on"},valueType:l},Exhaust:{state:{0:"off",1:"on"},valueType:l},Alarm:{state:{digital:{0:"off",1:"on"},analog:{0:"off",1:"on"}},valueType:r},ExtLabel:{state:{digital:{0:"off",1:"on"},analog:{0:"off",1:"on"}},valueType:r},Valve:{state:{digital:{0:"off",1:"on"},analog:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"}},valueType:r},"Radio Button":{valueType:s},Gauge:{state:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},valueType:s},"Toggle Button":{valueType:s},Combobox:{valueType:s},CheckBox:{valueType:l},Text:{valueType:s},Chart:{valueType:s},Default:{state:{0:"off",1:"on"},valueType:l},Null:{state:{0:"off",1:"on"},valueType:l},Image:{state:{0:"off",1:"on"},valueType:l},PowerGraphicImage:{valueType:l},PowerGraphicText:{valueType:l},RectangleGraphic:{state:{0:"off",1:"on"},valueType:l},DigitalSensor:{state:{0:"off",1:"on"},valueType:l},AnalogSensor:{state:{0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10"},valueType:s},basicImage:{valueType:l},undefined:{valueType:l}},c=[{text:e.prop("HMI_NORMAL"),value:"Normal"},{text:e.prop("HMI_BOLD"),value:"Bold"},{text:e.prop("HMI_ITALIC"),value:"Italic"}],p=["AHU_SA_TEMP","AHU_SA_HUMI","AHU_RA_TEMP","AHU_RA_HUMI","AHU_MA_TEMP","AHU_SFAN_INVER_ST","AHU_RFAN_INVER_ST","AHU_COMP_ST","AHU_SMOKE_AL","AHU_FILTER_AL","AHU_OA_DAMPER_CNTRL","AHU_EA_DAMPER_CNTRL","AHU_MA_DAMPER_CNTRL","AHU_WATER"],g={AHU_SA_TEMP:"BoardIO:AHU_SA_TEMP",AHU_SA_HUMI:"BoardIO:AHU_SA_HUMI",AHU_RA_TEMP:"BoardIO:AHU_RA_TEMP",AHU_RA_HUMI:"BoardIO:AHU_RA_HUMI",AHU_MA_TEMP:"BoardIO:AHU_MA_TEMP",AHU_SFAN_INVER_ST:"BoardIO:AHU_SFAN_INVER_ST",AHU_RFAN_INVER_ST:"BoardIO:AHU_RFAN_INVER_ST",AHU_COMP_ST:"BoardIO:AHU_COMP_ST",AHU_SMOKE_AL:"Slot4:AHU_SMOKE_AL",AHU_FILTER_AL:"Slot4:AHU_FILTER_AL",AHU_OA_DAMPER_CNTRL:"Slot2:AHU_OA_DAMPER_CNTRL",AHU_EA_DAMPER_CNTRL:"Slot2:AHU_EA_DAMPER_CNTRL",AHU_MA_DAMPER_CNTRL:"Slot2:AHU_MA_DAMPER_CNTRL",AHU_WATER:"BoardIO:AHU_WATER"};var h=$("#hmi-toast-popup").kendoCommonToastPopup({}).data("kendoCommonToastPopup"),u=[{id:1,text:e.prop("HMI_LINE_DEFAULT"),value:"0",image:"../../src/main/resources/static-dev/images/icon/graphic/linetype-01.png"},{id:2,text:e.prop("HMI_LINE_DOT"),value:"3",image:"../../src/main/resources/static-dev/images/icon/graphic/linetype-02.png"},{id:3,text:e.prop("HMI_LINE_NORMAL_DASH"),value:"10, 5",image:"../../src/main/resources/static-dev/images/icon/graphic/linetype-04.png"},{id:4,text:e.prop("HMI_LINE_LONG_DASH"),value:"20, 5",image:"../../src/main/resources/static-dev/images/icon/graphic/linetype-06.png"},{id:5,text:e.prop("HMI_LINE_DASH_DOT"),value:"20, 5, 5, 5",image:"../../src/main/resources/static-dev/images/icon/graphic/linetype-07.png"},{id:6,text:e.prop("HMI_LINE_DASH_DOT_DOT"),value:"20, 5, 5, 5, 5, 5",image:"../../src/main/resources/static-dev/images/icon/graphic/linetype-08.png"}],f=[{id:1,text:e.prop("HMI_ARROW_DEFAULT"),value:"0,0",fill:"transparent",image:"../../src/main/resources/static-dev/images/icon/graphic/arrowtype-01.png"},{id:2,text:e.prop("HMI_ARROW_OPEN_ARROW"),value:"10,-5 0,0 10,5",fill:"transparent",image:"../../src/main/resources/static-dev/images/icon/graphic/arrowtype-03.png"},{id:3,text:e.prop("HMI_ARROW_ARROW"),value:"10,-5 0,0 10,5 10,-5",fill:"#000",image:"../../src/main/resources/static-dev/images/icon/graphic/arrowtype-06.png"},{id:4,text:e.prop("HMI_ARROW_ELLIPSE_ARROW"),value:function(){var e,t,i,n,o=[];for(n=0;n<19;n++)e=20*n*Math.PI/180,t=5*Math.cos(e)+5,i=5*Math.sin(e),o.push(t+","+i);return o.join(" ")}(),fill:"#000",image:"../../src/main/resources/static-dev/images/icon/graphic/arrowtype-08.png"}],m={DEFAULT_EMPTY_TAB_PREFIX:"empty-",REFRESH_CONFIRM_HOURS:0,REFRESH_CONFIRM_TIMEOUT:1e4,DEFAULT_FONT_SIZE:16,DEFAULT_CANVAS_WIDTH:1686,DEFAULT_CANVAS_HEIGHT:971,GRAPHIC_MIN_WIDTH:10,GRAPHIC_MIN_HEIGHT:10,DEFAULT_INFO_ICON_SIZE:20,DEFAULT_GRID_WIDTH:10,DEFAULT_ZOOM_LEVEL:100,DEFAULT_MAX_ZOOM_LEVEL:200,DEFAULT_MIN_ZOOM_LEVEL:25,DEFAULT_ZOOM_FACTOR:25,MAX_TEMPLATE_SIZE:4,DEFAULT_CHART_WIDTH:800,DEFAULT_CHART_HEIGHT:400,DEFAULT_CHART_Y_AXIS:{min:0,max:10,ticks:10,tickStep:10,tickFormat:".1f"},DEFAULT_CHART_X_AXIS_24:a,DEFAULT_CHART_X_AXIS_60:n,DEFAULT_CHART_X_AXIS_60_MIN:o,CHART_MINUTES:{ONE:{value:6e4,min:1},FIVE:{value:3e5,min:5},TEN:{value:6e5,min:10},FIFTEEN:{value:9e5,min:15},THIRTEEN:{value:18e5,min:30}},DEFAULT_LIST_ITEM_HEIGHT:42,MAX_OPTIONS_SIZE:20,DEFAULT_NODE_WIDTH:50,DEFAULT_NODE_HEIGHT:50,CURRENT_HMI_VERSION:"1.2",INITIAL_HMI_VERSION:"1.0",DEFAULT_FONT_STYLE:"Normal",DEFAULT_FONT_TYPE:"Arial",DEFAULT_FONT_COLOR:"#000000",DEFAULT_TEXT_FILL_COLOR:"",DEFAULT_TEXT_PADDING:5,DEFAULT_TEXT_LABEL_PADDING:10,DEFAULT_TEXT_STROKE:1,DEFAULT_MIN_VALUE:-2147483648,DEFAULT_MAX_VALUE:2147483647,DEFAULT_MIN:0,DEFAULT_MAX:100,DEFAULT_ALARM_MIN_VALUE:-1e3,DEFAULT_ALARM_MAX_VALUE:1e3,DEFAULT_TEXT_MIN_VALUE:-2147483648,DEFAULT_TEXT_MAX_VALUE:2147483647,DEFAULT_TEXT_MIN_WIDTH:30,DEFAULT_TEXT_H_ALIGN:"center",DEFAULT_TEXT_V_ALIGN:"middle",DEFAULT_DROPDOWN_MIN_WIDTH:164,DEFAULT_DROPDOWN_MIN_HEIGHT:25,DEFAULT_PROGRESSBAR_WIDTH:160,DEFAULT_PROGRESSBAR_HEIGHT:20,DEFAULT_PROGRESSBAR_TEXT:"Percentage",DEFAULT_PROGRESSBAR_COLOR:"#0000FF",DEFAULT_PROGRESSBAR_DIRECTION:"horizontal",DEFAULT_PROGRESSBAR_TEXT_LOCATION:"right",DEFAULT_PROGRESSBAR_NO_TEXT:"empty",DEFAULT_SCALEBAR_WIDTH:120,DEFAULT_SCALEBAR_HEIGHT:20,DEFAULT_SCALEBAR_SLIDER_WIDTH:1,DEFAULT_SCALEBAR_SLIDER_HEIGHT:20,DEFAULT_SCALEBAR_LEFT_ARROW_URL:"../../src/main/resources/static-dev/images/icon/ScaleBar/ScaleBar_Left_Arrow.png",DEFAULT_SCALEBAR_RIGHT_ARROW_URL:"../../src/main/resources/static-dev/images/icon/ScaleBar/ScaleBar_Right_Arrow.png",DEFAULT_SCALEBAR_ARROW_WIDTH:45,DEFAULT_SCALEBAR_ARROW_HEIGHT:18,DEFAULT_POWER_GRAPHIC_TEXTBOX_WIDTH:200,DEFAULT_POWER_GRAPHIC_TEXTBOX_HEIGHT:220.6,DEFAULT_POWER_GRAPHIC_IMAGE:"../../src/main/resources/static-dev/images/icon/Power/Power_TextBox.png",DEFAULT_TEXT:"Text",DEFAULT_RECT_GRAPHIC_WIDTH:80,DEFAULT_RECT_GRAPHIC_HEIGHT:35,DEFAULT_ROUND_BUTTON_SIZE:40,DEFAULT_CHART_MIN_VALUE:0,DEFAULT_CHART_MAX_VALUE:9999999,DEFAULT_CHECKBOX_PADDING:30,DEFAULT_CHECKBOX_CHECK_SIZE:8,DEFAULT_CHECKBOX_WRAPPER_SIZE:16,DEFAULT_RADIO_BUTTON_ITEM_WIDTH:76,DEFAULT_RADIO_BUTTON_ITEM_HEIGHT:36,DEFAULT_RADIO_BUTTON_ITEM_MARGIN:15,DEFAULT_CHECKBOX_OBJECT_WIDTH:40,DEFAULT_CHECKBOX_OBJECT_HEIGHT:40,DEFAULT_CHECKBOX_OBJECT_MIN_WIDTH:40,DEFAULT_CHECKBOX_OBJECT_MIN_HEIGHT:40,DEFAULT_RADIOBUTTON_WRAPPER_RADIUS:10,DEFAULT_RADIOBUTTON_RADIO_RADIUS:3,DEFAULT_COMBOBOX_BOX_WIDTH:220,DEFAULT_COMBOBOX_BOX_HEIGHT:48,DEFAULT_COMBOBOX_BUTTON_WIDTH:16,DEFAULT_COMBOBOX_BUTTON_HEIGHT:12,DEFAULT_COMBOBOX_BUTTON_PATH:"0,0 16,0 8,12",DEFAULT_TABLE_ROW_HEIGHT:32,DEFAULT_TABLE_COLUMN_WIDTH:100,DEFAULT_TABLE_ROW_COLUMN_MAX_COUNT:30,DEFAULT_ZONE_COLOR:"#0081c6",DEFAULT_ZONE_COLOR_ALPHA:.1,DEFAULT_ZONE_COLOR_ALPHA_SELECTED:.35,DEFAULT_ZONE_NAME:"New Zone",DEFAULT_ZONE_WIDTH:200,DEFAULT_ZONE_HEIGHT:140,DEFAULT_STATISTICS_CARD_WIDTH:304,DEFAULT_STATISTICS_CARD_HEIGHT:154,DEFAULT_STATISTICS_CARD_WIDTH_RATIO:.9,DEFAULT_STATISTICS_CARD_PIE_WIDTH_RATIO:.43,DEFAULT_STATISTICS_CARD_PIE_HEIGHT_RATIO:.4,DEFAULT_STATISTICS_COLOR_ON:"#2ea869",DEFAULT_STATISTICS_COLOR_OFF:"#454545",DEFAULT_STATISTICS_COLOR_CRITICAL:"#ee392f",DEFAULT_STATISTICS_COLOR_WARNING:"#ffa41f",DEFAULT_STATISTICS_TIMEOUT:6e4,DEFAULT_LIBRARY_NO_IMAGE_URL:"../../src/main/resources/static-dev/images/icon/library-no-image.png",DEFAULT_INDOOR_WIDTH:155,DEFAULT_INDOOR_HEIGHT:50,DEFAULT_TEXT_MAX_LENGTH:1e3,DEFAULT_TEXT_BOX_BUTTON_WIDTH:70,DEFAULT_TEXT_BOX_WITH_BUTTON_MIN_WIDTH:120,DEFAULT_TEXT_BOX_MIN_WIDTH:40,DEFAULT_TEXT_BOX_MARGIN:10,DEFAULT_COOKIE_HMI_PATH:"/front/hmi",DEFAULT_COOKIE_FILE_LIST_KEY:"hmiFileListExpanded",DEFAULT_COOKIE_CONTROL_PANEL_KEY:"hmiControlPanelExpanded",DEFAULT_FILL_COLOR:"#ffffff",DEFAULT_STROKE_COLOR:"#000000",DEFAULT_LABEL_MAX_LENGTH:30,COLOR_STR_TO_HEX:{gray:"#d4d3d4",red:"#ff0000",blue:"#1100ff",green:"#00ff00",yellow:"#feff00"},IMAGE_FILE_MAX_SIZE:10485760,LIBRARY_IMAGE_FILE_MAX_SIZE:1048576,fontTypeDataSource:[{text:"Georgia",value:"Georgia"},{text:"Palatino Linotype",value:"Palatino Linotype"},{text:"Times New Roman",value:"Times New Roman"},{text:"Arial",value:"Arial"},{text:"Arial Black",value:"Arial Black"},{text:"Comic Sans MS",value:"Comic Sans MS"},{text:"Impact",value:"Impact"},{text:"Lucida Sans Unicode",value:"Lucida Sans Unicode"},{text:"Tahoma, Geneva",value:"Tahoma, Geneva"},{text:"Trebuchet MS",value:"Trebuchet MS"},{text:"Verdana",value:"Verdana"},{text:"Courier New",value:"Courier New"},{text:"Lucida Console",value:"Lucida Console"}],fontStyleDataSource:c,fontSizeDataSource:[8,9,10,12,14,16,20,24,32,40,52,64],ControlPointValueAndStateMapping:d,templatePoints:p,templatePointAddresses:g,getAllUnCheckedDataPointsMapForSeach:function(e){for(var t={},i=p,n=i.length,o=g,a=0;a<n;a++)t[o[i[a]]+e]="0";return t},SoundPlayer:i,hasMappedTypes:["Sensor.Temperature","Sensor.Humidity"],toastPopup:h,lineDashArrayDataSource:u,lineMarkerDataSource:f,lineWidthDataSource:[{id:.25,name:"0.25pt",lineHeight:1,selected:!1},{id:.5,name:"0.5pt",lineHeight:2,selected:!1},{id:.75,name:"0.75pt",lineHeight:3,selected:!1},{id:1,name:"1pt",lineHeight:4,selected:!1},{id:1.5,name:"1.5pt",lineHeight:5,selected:!1},{id:2.25,name:"2.25pt",lineHeight:7,selected:!1},{id:3,name:"3pt",lineHeight:9,selected:!1},{id:4.5,name:"4.5pt",lineHeight:12,selected:!1},{id:5,name:"5pt",lineHeight:14,selected:!1},{id:6,name:"6pt",lineHeight:18,selected:!1}]};return window.HmiCommon=m}),define("hmi/model/hmi-model",function(){"use strict";var o=window.I18N,a=window.kendo,t=a.data.Model.define({id:"id",fields:{name:{name:"Name"},createdDate:{name:"Start Date",type:"date"}}});function c(e){return-1!=e.indexOf(".png")?"image/png":-1!=e.indexOf(".gif")?"image/gif":-1!=e.indexOf(".jpg")?"image/jpeg":-1!=e.indexOf(".svg")?"image/svg+xml":"image/gif"}function p(e,t){return"number"!=typeof e&&(e=Number(e)),t=(e=a.toString(e,"00"))+"."+t}var r=function(e,t){var i,n,o,a,r,l,s;if(i=e.component,n=e.images,e.thumbnailImage&&(e.thumbnailImage=d(e.name,e.thumbnailImage)),i){if("string"==typeof i&&(e.component=JSON.parse(e.component),i=e.component),i.controlType&&(e.controlType=i.controlType),i.min&&(e.min=i.min),i.max&&(e.max=i.max),i.step&&(e.step=i.step),a=i.images)for(s=a.length,l=0;l<s;l++)r=a[l],n&&n[l]&&(n[l]=$.extend(n[l],r));delete e.component}if(n)for(s=n.length,l=0;l<s;l++)(o=n[l]).id=o.name,o.name=g(o.name),"Multi"!=e.type&&(0==l?o.status="OFF":1==l&&(o.status="ON")),o.data&&(o.image=o.data,o.image=d(o.name,o.image),t&&(o.file=h(o.name,o.data)),delete o.data);return e},d=function(e,t){return"data:"+c(e)+";base64,"+t},g=function(e){var t=e.split(".");return 2<t.length&&t.splice(0,1),t.join(".")},h=function(e,t,i){var n,o=t.split(",");i=1<o.length?(i=o[0],n=o[1],(i=i.split("data:")[1]).split(";base64")[0]):(n=o[0],i||"");var a,r=window.Uint8Array,l=n.length,s=new r(l);for(n=window.atob(n),a=0;a<l;a++)s[a]=n.charCodeAt(a);i=c(e);var d=new Blob([s],{type:i});return new File([d],e,{type:i})},e={MockData:[{id:1,name:"A.21F.B - HMI Graphic File",createdDate:"2017-04-17T20:44:32+09:00"},{id:2,name:"A.22F.A - HMI Graphic File",createdDate:"2017-04-20T09:01:17+09:00"},{id:3,name:"A.22F.B - HMI Graphic File",createdDate:"2017-04-24T13:17:02+09:00"}],createModel:function(e){return new t(e)},createTreeDataSource:function(e){var t,i,n,o=e.length;for(t=0;t<o;t++)(i=e[t]).selected=!1,1==i.treeDepth&&i.isFolder?n=i:n&&2==i.treeDepth?i.parent_id=n.id:i.parent_id=null,void 0===i.parent_id&&(i.parent_id=null),void 0===i.isFolder&&(i.isFolder=!1),void 0===i.sortOrder&&(i.sortOrder=t+1);return new a.data.TreeListDataSource({data:e,schema:{model:{parentId:"parent_id",fields:{parent_id:{type:"string",nullable:!0}}},expanded:!0}})},createLibraryDataSource:function(e){var t,i,n=e.length;for(t=0;t<n;t++)i=e[t],e[t]=r(i);return[{id:"Controlled",name:o.prop("HMI_CONTROLLED_TYPE"),items:new a.data.Query(e).filter({field:"type",operator:"eq",value:"Controlled"}).sort({field:"sortOrder",dir:"asc"}).toArray()},{id:"Toggle",name:o.prop("HMI_TOGGLE_TYPE"),items:new a.data.Query(e).filter({field:"type",operator:"eq",value:"Toggle"}).sort({field:"sortOrder",dir:"asc"}).toArray()},{id:"Multi",name:o.prop("HMI_MULTI_TYPE"),items:new a.data.Query(e).filter({field:"type",operator:"eq",value:"Multi"}).sort({field:"sortOrder",dir:"asc"}).toArray()}]},convertComponentUiModel:r,convertComponentBackendModel:function(e,t){var i,n={};if(t&&(i=new FormData).append("json",JSON.stringify({type:e.type,sortOrder:e.sortOrder})),e.controlType&&(n.controlType=e.controlType,delete e.controlType),e.min&&(n.min=e.min,delete e.min),e.max&&(n.max=e.max,delete e.max),e.images){n.images=[];var o,a,r,l=e.images,s=l.length;for(a=0;a<s;a++)r=a+1,void 0!==(o=l[a]).min&&null!==o.min&&void 0!==o.max&&null!==o.max&&(n.images[a]={min:o.min,max:o.max}),o.image&&(t&&o.file?i.append("images["+r+"]",o.file,p(r,o.file.name),{type:o.file.type}):(o.data=o.image,delete o.image))}if(t){var d=new Blob([JSON.stringify(n)],{type:"application/json"});return i.append("component",new File([d],e.name,{type:"application/json"})),i}return e},removeComponentNumber:g,addComponentNumber:p};return window.HmiModel=e}),define("hmi/hmi-api",[],function(){function a(e,t){var i=new FormData,n={isFolder:e.isFolder,sortOrder:e.sortOrder,treeDepth:e.treeDepth};i.append("json",JSON.stringify(n)),t=t||{};var o=e.name,a=new Blob([JSON.stringify(t)],{type:"application/json"});return i.append("graphic",new File([a],o,{type:"application/json"})),i}function r(e){var o=new $.Deferred,t=e.id,i={name:e.name,sortOrder:e.sortOrder,treeDepth:e.treeDepth};return $.ajax({url:"/dms/hmi/graphics/"+t,method:"PATCH",data:i}).done(function(e,t,i){var n=I(e,"graphic","PATCH",i.status);n.success?o.resolve(n.message):o.reject(n.message)}).fail(function(e){var t=I(e.responseJSON,"graphic","PATCH",e.status);o.reject(t.message)}),o.promise()}function l(e){var o=new $.Deferred;return $.ajax({url:"/dms/hmi/graphics/"+e,method:"DELETE"}).done(function(e,t,i){var n=I(e,"graphic","DELETE",i.status);n.success?o.resolve(n.message):o.reject(n.message)}).fail(function(e){var t=I(e.responseJSON,"graphic","DELETE",e.status);o.reject(t.message)}),o.promise()}function s(e){return window.HmiModel.convertComponentBackendModel(e,!0)}function d(e){var o=new $.Deferred,t=e.id,i={name:e.name,sortOrder:e.sortOrder};return $.ajax({url:"/dms/hmi/components/"+t,method:"PATCH",data:i}).done(function(e,t,i){var n=I(e,"component","PATCH",i.status);n.success?o.resolve(n.message):o.reject(n.message)}).fail(function(e){var t=I(e.responseJSON,"component","PATCH",e.status);o.reject(t.message)}),o.promise()}function c(e){var o=new $.Deferred;return $.ajax({url:"/dms/hmi/components/"+e,method:"DELETE"}).done(function(e,t,i){var n=I(e,"component","DELETE",i.status);n.success?o.resolve(n.message):o.reject(n.message)}).fail(function(e){var t=I(e.responseJSON,"component","DELETE",e.status);o.reject(t.message)}),o.promise()}var t={Accept:"application/json; charset=utf-8","Content-Type":"application/json"},p=window.Session,g=window.I18N,i=window.Util,h="panelFolded",u="activeTab",f="openedTab",m="id",_="tabName",v="zoomLevel",b=function(e){return e.graphic.headers[0].value.split("/graphics/")[1]},T=function(e){return e.component.headers[0].value.split("/components/")[1]},C={41337:"HMI_NOT_EXIST_FILE_ERROR",41332:function(e){var t=e.message.split("("),i=(t=t[1]).indexOf(")"),n=t.substring(0,i);return g.prop("HMI_DUPLICATED_FILE_NAME",n)},41340:function(e){var t=e.message.split("("),i=(t=t[1]).indexOf(")"),n=t.substring(0,i);return g.prop("HMI_DUPLICATED_LIBRARY_NAME",n)}};function E(e){var t=i.parseFailResponse(e);return-1!=t.indexOf("doesn't match pattern")&&(t=g.prop("COMMON_INVALID_CHARACTER")),t}function I(e,t,i,n){var o={};$.isArray(e)&&(e=e[0]),e&&e.code&&e.message?(o.status=n,o.body=e):e&&e[t]?o=e[t]:o.status=n;var a="",r=!1;if(400<=o.status){var l,s=(l="string"==typeof o.body?JSON.parse(o.body):o.body).message,d=l.code,c=C[d];a=c?$.isFunction(c)?c(l):g.prop(c):s,r=!1}else r=!0,"POST"==i&&("graphic"==t?a=b(e):"component"==t&&(a=T(e)));return{message:a,success:r}}var e={getFiles:function(e){return $.ajax({data:e,url:"/dms/hmi/graphics"})},postFile:function(e,t){var o=new $.Deferred,i=a(e,t);return $.ajax({url:"/dms/hmi/graphics",method:"POST",data:i,isFileUpload:!0}).done(function(e,t,i){var n=I(e,"graphic","POST",i.status);n.success?o.resolve(n.message):o.reject(n.message)}).fail(function(e){var t=E(e);o.reject(t)}),o.promise()},putFile:function(e,t){var o=new $.Deferred,i=e.id,n=a(e,t);return $.ajax({url:"/dms/hmi/graphics/"+i,method:"POST",data:n,isFileUpload:!0}).done(function(e,t,i){var n=I(e,"graphic","POST",i.status);n.success?o.resolve(n.message):o.reject(n.message)}).fail(function(e){var t=E(e);o.reject(t)}),o.promise()},patchFile:r,patchFiles:function(e){var t,i,n=e.length,o=[];for(t=0;t<n;t++)i=e[t],o.push(r(i));return $.when.apply(this,o)},getFile:function(e){var i=new $.Deferred;return $.ajax({headers:t,url:"/dms/hmi/graphics/"+e}).done(function(e){i.resolve(e)}).fail(function(e){var t=I(e.responseJSON,"graphic","GET",e.status);i.reject(t.message)}),i.promise()},deleteFile:l,deleteFiles:function(e){var t,i,n=e.length,o=[];for(t=0;t<n;t++)i=e[t],o.push(l(i.id));return $.when.apply(this,o)},getDevicesForPolling:function(e){var t="/dms/devices?ids="+(e=e.join(","))+"&attributes=name,type,mappedType,registrationStatus,controlPoint-tagName,controlPoint-value,airConditioner,operations,temperatures,modes,configuration,winds,alarms,representativeStatus";return $.ajax({url:t})},getControlPointDevices:function(){return $.ajax({url:"/dms/devices?types=ControlPoint.*&registrationStatus=Registered"})},getFileIdFromRes:b,getComponents:function(e){return $.ajax({data:e,url:"/dms/hmi/components"})},postComponent:function(e){var o=new $.Deferred,t=s(e);return $.ajax({url:"/dms/hmi/components",method:"POST",data:t,isFileUpload:!0}).done(function(e,t,i){var n=I(e,"component","POST",i.status);n.success?o.resolve(n.message):o.reject(n.message)}).fail(function(e){var t=E(e);o.reject(t)}),o.promise()},putComponent:function(a){var e,r=new $.Deferred,l=a.id,t=a.oldImages,i=t.length,n=[];for(e=0;e<i;e++)n.push(t[e].id);return n=n.join(","),$.ajax({url:"/dms/hmi/components/"+l+"/images?names="+n,method:"DELETE"}).done(function(e,t,i){var n=I(e,"graphic","DELETE",i.status);if(n.success){var o=s(a);$.ajax({url:"/dms/hmi/components/"+l,method:"POST",data:o,isFileUpload:!0}).done(function(e,t,i){(n=I(e,"component","POST",i.status)).success?r.resolve(n.message):r.reject(n.message)}).fail(function(e){var t=E(e);r.reject(t)})}else r.reject(n.message)}).fail(function(e){var t=I(e.responseJSON,"component","DELETE",e.status);r.reject(t.message)}),r.promise()},patchComponent:d,patchComponents:function(e){var t,i,n=e.length,o=[];for(t=0;t<n;t++)i=e[t],o.push(d(i));return $.when.apply(this,o)},getComponent:function(e){var n=new $.Deferred,o=window.HmiModel;return $.ajax({headers:t,url:"/dms/hmi/components/"+e}).done(function(i){$.ajax({url:"/dms/hmi/components/"+e+"/images"}).done(function(e){var t={component:i,images:e};t=o.convertComponentUiModel(t,!0),n.resolve(t)}).fail(function(e){var t=I(e.responseJSON,"component","GET",e.status);n.reject(t.message)})}).fail(function(e){var t=I(e.responseJSON,"component","GET",e.status);n.reject(t.message)}),n.promise()},getComponentImages:function(e){return $.ajax({url:"/dms/hmi/components/"+e+"/images"})},deleteComponent:c,deleteComponents:function(e){var t,i,n=e.length,o=[];for(t=0;t<n;t++)i=e[t],o.push(c(i.id));return $.when.apply(this,o)},getComponentIdFromRes:T,getUserSettings:function(){var e="/ums/users/"+p.id+"/hmi",r=new $.Deferred;return $.ajax({url:e}).done(function(e){var t,i,n,o={panelFolded:!1,activeTab:{},openedTab:[]},a={};e.forEach(function(e){if(t=e.key.split("_"),i=e.value,-1!=t[0].indexOf(u))switch(t[1]){case m:o.activeTab.id=Number(i);break;case _:o.activeTab.name=i;break;case v:o.activeTab.zoomLevel=Number(i)}else if(-1!=t[0].indexOf(f))switch(n=t[1],a[n]||(a[n]={}),t[2]){case m:a[n].id=Number(i);break;case _:a[n].name=i;break;case v:a[n].zoomLevel=Number(i)}else-1!=t[0].indexOf(h)&&(o.panelFolded="true"==i)}),$.each(a,function(e,t){o.openedTab.push(t)}),r.resolve(o)}).fail(function(e){r.reject(e)}),r.promise()},putUserSettings:function(e){var t="/ums/users/"+p.id+"/hmi",i=[],n=e.panelFolded||!1,o=e.tabInfo,a=o.activeTab,r=o.openedTab||[];return i.push({key:h,value:n}),a&&a.id&&i.push({key:u+"_"+m,value:a.id},{key:u+"_"+_,value:a.name},{key:u+"_"+v,value:a.zoomLevel}),0<r.length&&r.forEach(function(e,t){i.push({key:f+"_"+t+"_"+m,value:e.id},{key:f+"_"+t+"_"+_,value:e.name},{key:f+"_"+t+"_"+v,value:e.zoomLevel})}),$.ajax({url:t,method:"PUT",data:i})},resCodeMsg:C};return window.HmiApi=e}),define("hmi/config/popup-config",["hmi/hmi-common","hmi/hmi-util","hmi/hmi-api","hmi/model/hmi-model"],function(e,t,l,s){"use strict";var i,n,o,a,r=window.I18N,d=(window.kendo,window.draw2d,window.Util),c=window.moment,p=new window.CommonLoadingPanel,g='<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',h="<div class='detail-dialog-content device-dialog-content'><div class='hmi-table-insert-dialog-row'><div class='hmi-table-insert-dialog-col'>"+r.prop("HMI_TABLE_COL_NUMBER")+"</div><div class='hmi-table-insert-dialog-col'><input data-role='numerictextbox' data-bind='events:{change : changeCol, spin : changeCol }, value : col' type='number' min='1' max='"+e.DEFAULT_TABLE_ROW_COLUMN_MAX_COUNT+"' data-format='n0' class='hmi-table-spin-numeric'/></div></div><div class='hmi-table-insert-dialog-row'><div class='hmi-table-insert-dialog-col'>"+r.prop("HMI_TABLE_ROW_NUMBER")+"</div><div class='hmi-table-insert-dialog-col'><input data-role='numerictextbox' data-bind='events:{change : changeRow, spin : changeRow }, value : row' type='number' min='1' max='"+e.DEFAULT_TABLE_ROW_COLUMN_MAX_COUNT+"' data-format='n0' class='hmi-table-spin-numeric'/></div></div><div class='detail-dialog-detail-content'></div></div>",u=$("<div/>");function f(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1),e.sender.trigger("onClosed")}i=u.kendoCommonDialog().data("kendoCommonDialog"),n=$("<div/>").kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog"),(o=$("<div/>").kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog")).setActions(0,{text:r.prop("COMMON_BTN_CANCEL")}),o.setActions(1,{text:r.prop("COMMON_BTN_OK")}),a=$("<div/>").kendoCommonDialog({type:"confirm",actions:[{text:r.prop("COMMON_BTN_CLOSE"),action:function(e){e.sender.close()}},{text:r.prop("HMI_CONFIRM_FOLDER_ONLY"),action:function(e){e.sender.close()}},{text:r.prop("HMI_CONFIRM_FOLDER_AND_CONTENTS"),action:function(e){e.sender.close()}}]}).data("kendoCommonDialog");var m,_={height:"100%",scrollable:!1,sortable:!1,filterable:!1,pageable:!1,rowHeaders:!0},v={title:r.prop("HMI_TABLE_INSERT"),width:400,height:270,isCustomActions:!0,buttonsIndex:{CLOSE:0,SAVE:1},contentTemplate:h,contentViewModel:{row:1,col:1,changeCol:function(e){},changeRow:function(e){}},onTypeChange:function(e){e.sender.element.on("keyup",".hmi-table-spin-numeric[data-role='numerictextbox']",function(){var e=$(this),t=e.data("kendoNumericTextBox"),i=t.options.max,n=t.options.min,o=e.val();i<(o=Number(o))?e.val(i):o<n&&e.val(n)})},actions:[{text:r.prop("COMMON_BTN_CANCEL"),visible:!0,action:f},{text:r.prop("HMI_INSERT"),visible:!0,action:function(e){var t=e.sender.contentViewModel,i={row:t.get("row"),col:t.get("col")};e.sender.setActions(e.sender.BTN.SAVE,{visible:!0}),e.sender.trigger("onSaved",{sender:e.sender,result:i})}}]},b={title:r.prop("COMMON_BTN_DETAIL"),width:652,height:830,buttonsIndex:{CLOSE:0,EDIT:1,CANCEL:2,SAVE:3,DELETE:4},contentViewModel:{detailType:r.prop("COMMON_GENERAL")},contentTemplate:g,detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',headerTemplate:"<span class='hmi-monitoring-detail-file-name' data-bind='text:name, attr:{title:name}'></span>",isCustomActions:!0,actions:[{text:r.prop("COMMON_BTN_CLOSE"),visible:!0,action:f},{text:r.prop("COMMON_BTN_EDIT"),visible:!0,action:function(e){return e.sender.trigger("onEdit"),e.sender.setEditable(!0),e.sender.setActions(e.sender.BTN.DELETE,{visible:!1}),e.sender.trigger("onEdited"),!1}},{text:r.prop("COMMON_BTN_CANCEL"),visible:!1,action:function(e){function t(){e.sender.trigger("onCancel"),e.sender.cancelDataSource(),e.sender.setEditable(!1),e.sender.setDialogType(e.sender.dialogType),e.sender.hideInvalidMessage(),e.sender.hideRemoveBtn(),e.sender.trigger("onCanceled")}return e.sender.confirmDialog.message(r.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL")),e.sender.hasChanged?(e.sender.confirmDialog.setConfirmActions({yes:function(){t()}}),e.sender.confirmDialog.open()):t(),!1}},{text:r.prop("COMMON_BTN_SAVE"),visible:!1,action:function(e){e.sender.trigger("onSave");var t,i=e.sender.editFields;if(i&&i.name){var n=i.name,o=n.val();o&&n.val($.trim(o))}return(t=e.sender.save())&&(e.sender.trigger("onSaved",{sender:e.sender,result:t}),e.sender.setActions(e.sender.BTN.DELETE,{visible:!0}),e.sender.setEditable(!1),D&&D.refresh()),!1}},{text:r.prop("COMMON_BTN_DELETE"),visible:!0,action:function(e){var t=e.sender.getSelectedData(),i={};return i.id=t.id,e.sender.trigger("onDeleted",{result:i,item:i}),!1}}],scheme:{id:"id",groupName:{detailProperties:{template:"<div class='group'>"+r.prop("HMI_DETAIL_PROPERTY")+"</div>"}},fields:{name:{type:"text",name:r.prop("HMI_FILE_NAME"),editCss:{width:"100%"},validator:{type:"hmiGraphicName",required:!0},hasInputRemoveBtn:!0,editable:!0},createdDate:{type:"text",name:r.prop("HMI_CREATE_DATE"),template:function(e){return c(e.createdDate).format("LLL").replace(/\./g,"-")}},detailInfo:{groupName:"detailProperties",type:"grid",name:"",valueFieldDisplayType:"row",gridDataSource:function(e){var t=e.graphicDeviceInfo;return[{indicator:r.prop("COMMON_TOTAL"),count:t.totalFiguresSize,limit:600},{indicator:r.prop("HMI_VECTOR_GRAPHICS"),count:t.cntVectorGraphicObjects,limit:600},{indicator:r.prop("HMI_GROUP_SHAPES"),count:t.cntGroupedObjects,limit:70},{indicator:r.prop("HMI_ROTATED_OBJECTS"),count:t.cntRotatedObjects,limit:100},{indicator:r.prop("HMI_BINDING_OBJECTS"),count:t.cntBindingObjects,limit:70,detail:!0}]},gridOptions:$.extend({},!0,_,{columns:[{title:r.prop("HMI_PERFORMANCE_INDICATOR"),field:"indicator",width:"43%"},{title:r.prop("HMI_COUNT"),field:"count",width:"43%"},{title:" ",field:"detail",template:function(e){return e.detail?"<span class='ic ic-info binding'><span>":""},width:30}]})}}},onTypeChange:function(e){D&&D.refresh()}},T={title:r.prop("HMI_BINDING_OBJECTS"),width:820,height:830,isOnlyMulti:!0,hasDetail:!1,gridOptions:$.extend({},!0,_,{scrollable:!0,columns:[{field:"type",title:r.prop("HMI_INPUT_OUTPUT_TYPE"),width:"33.3%",template:function(e){return"<span class='"+(t.isInvalidDevice(e)?"invalid-device":"")+"'>"+e.type+"</span>"}},{field:"name",title:r.prop("HMI_NAME"),width:"33.3%",template:function(e){return"<span class='"+(t.isInvalidDevice(e)?"invalid-device":"")+"'>"+e.name+"</span>"}},{field:"mappedType",title:r.prop("FACILITY_DEVICE_TYPE_ALL"),width:"33.3%",template:function(e){return"<span class='"+(t.isInvalidDevice(e)?"invalid-device":"")+"'>"+(t.isControlPointType(e.type)?d.getDetailDisplayTypeDeviceI18N(e.mappedType):t.getI18NIndoorType(e))+"</span>"}}]}),buttonsIndex:{CLOSE:0},contentTemplate:g,headerTemplate:"<span>"+r.prop("COMMON_TOTAL")+": <span>#=count#</span></span>",isCustomActions:!0,actions:[{text:r.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:f}]},C={title:r.prop("HMI_HYPER_LINK"),width:654,height:826,buttonsIndex:{CLOSE:0,SAVE:1},isCustomActions:!0,actions:[{text:r.prop("COMMON_BTN_CLOSE"),visible:!0,action:f},{text:r.prop("COMMON_BTN_SAVE"),visible:!0,action:function(e){var t=e.sender.getSelectedData().toJSON();return e.sender.trigger("onSaved",{sender:e.sender,result:t}),e.sender.close(),i.message(r.prop("COMMON_MESSAGE_NOTI_SAVED")),i.open(),!1}}],contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="hmi-hyperlink-popup"><div class="title">'+r.prop("HMI_FILE_LIST")+'</div><div class="file-list-wrapper"><div class="hmi-hyperlink-file-list"></div></div><div class="title">'+r.prop("HMI_SELECTED_FILE")+'</div><div class="content" data-bind="text : file.name"></div></div>',contentViewModel:{file:{name:"-"}},onTypeChange:function(e){var n=e.sender,t=e.sender.BTN;n.setEditable(!0),n.setActions(t.SAVE,{visible:!0}),n.setActions(t.CLOSE,{visible:!0});var i=n.element,o=n.getSelectedData(),a=n.contentViewModel;a.file.set("name",o.name);var r=i.find(".hmi-hyperlink-file-list");r.data("kendoHmiFileList")||(n.fileList=r.kendoHmiFileList({searchable:!1,creatable:!1,editable:!1,deletable:!1,treeListOptions:{isOnlyChildrenSelectable:!0,editable:!1}}).data("kendoHmiFileList"),n.fileList.bind("change",function(e){var t=e.item;a.file.set("name",t.name);var i=n.getSelectedData();i.id=t.id,i.name=t.name,i.isFolder?n.disableSaveBtn():n.enableSaveBtn()})),p.open(n.element),l.getFiles().done(function(e){if(n.fileList.setDataSource(s.createTreeDataSource(e)),o){var t=o.id,i=n.fileList.treeList.dataSource.get(t);i&&n.fileList.select(i,!0)}}).always(function(){p.close()})}},E=$("<div id='hmi-monitoring-detail-popup'/>");m=E.kendoDetailDialog(b).data("kendoDetailDialog");var I,y,A,D=E.kendoTooltip({filter:".detail-dialog-header",wrapperCssClass:"hmi-palette-tooltip",content:function(e){return e.target.find("span.hmi-monitoring-detail-file-name").attr("title")},position:"bottom"}).data("kendoToolTip");I=$("<div id='hmi-monitoring-binding-detail-popup'/>").kendoDetailDialog(T).data("kendoDetailDialog"),y=$("<div class='hmi-table-insert-confirm-popup'/>").kendoDetailDialog(v).data("kendoDetailDialog"),A=$("<div class='hmi-hyperlink-detail-popup'></div>").kendoDetailDialog(C).data("kendoDetailDialog");var S={msgDialog:i,confirmDialog:n,refreshConfirmDialog:o,tableInsertDialog:y,monitoringDetailPopup:m,bindingDetailPoup:I,hyperLinkPopup:A,folderDeleteConfirmDialog:a};return window.HmiPopupConfig=S}),define("hmi/config/palette-config",["hmi/hmi-common","hmi/hmi-util"],function(d,c){"use strict";function g(e,t){return t?"../../src/main/resources/static-dev/front/images/icon/"+e:"../../src/main/resources/static-dev/images/icon/"+e}function e(e,t,i,n){var o,a,r,l={},s=e.length;for(a=0;a<s;a++)for(o=e[a],r=i;r<=n;r++)l[o.toLowerCase()+"_"+r]=g(t+o+r)+".png";return l}var h=window.kendo,t=window.I18N,f=window.Util;function i(e,t,i,n){var o,a,r,l,s,d,c=e.length,p={};for(s=0;s<c;s++)for("grey"==(a=(o=e[s]).toLowerCase())||"N"==o?a="gray":"G"==o?a="green":"N"==o?a="gray":"R"==o?a="red":"Y"==o?a="yellow":"B"==o&&(a="blue"),d=0;d<11;d++)r=i&&void 0!==i[d]?i[d]:d,n&&(r=h.toString(r,n)),l=t.replace("{level}",r).replace("{color}",o),p[a+"_"+d]=g(l);return p}function n(e,t,i){var n,o,a,r,l,s,d=e.length,c=i.length,p={};for(l=0;l<d;l++)for("grey"==(o=(n=e[l]).toLowerCase())||"N"==n?o="gray":"G"==n?o="green":"N"==n?o="gray":"R"==n?o="red":"Y"==n?o="yellow":"B"==n&&(o="blue"),s=0;s<c;s++)a=i[s],r=t.replace("{state}",a).replace("{color}",n),p[o+"_"+a.toLowerCase()]=g(r);return p}var o={gray_on:g("Pump/CirclePump_Gray1_ani.gif"),red_on:g("Pump/CirclePump_Red1_ani.gif"),red_off:g("Pump/CirclePump_Red1.png"),blue_on:g("Pump/CirclePump_Blue1_ani.gif"),blue_off:g("Pump/CirclePump_Blue1.png"),green_on:g("Pump/CirclePump_Green1_ani.gif"),green_off:g("Pump/CirclePump_Green.png"),yellow_on:g("Pump/CirclePump_Yellow1_ani.gif"),yellow_off:g("Pump/CirclePump_Yellow.png")},a={gray_on:g("Pump/CrossPump_ani.gif"),red_on:g("Pump/CrossPump_Red1_ani.gif"),red_off:g("Pump/CrossPump_Red1.png"),blue_on:g("Pump/CrossPump_Blue1_ani.gif"),blue_off:g("Pump/CrossPump_Blue1.png"),green_on:g("Pump/CrossPump_ani_Green.gif"),green_off:g("Pump/CrossPump_Green.png"),yellow_on:g("Pump/CrossPump_ani_Yellow.gif"),yellow_off:g("Pump/CrossPump_Yellow.png")},r=i(["Grey","Red","Blue","Green","Yellow"],"Damper/Damper_H{level}_{color}.png",{0:1,1:1,2:1,3:1,4:1,5:2,6:2,7:2,8:2,9:2,10:3}),l=i(["Grey","Red","Blue","Green","Yellow"],"Damper/Damper_V{level}_{color}.png",{0:1,1:1,2:1,3:1,4:1,5:2,6:2,7:2,8:2,9:2,10:3}),s=i(["Gray","Red","Blue","Green","Yellow"],"Pump/Pump_{color}{level}.png",{0:1,1:1,2:1,3:1,4:1,5:2,6:2,7:2,8:2,9:2,10:3}),p=i(["gray","red","blue","green","yellow"],"dvc630/dvc630-tempsensor-{color}-on{level}.png",{0:1,1:2,2:3,3:4,4:5,5:6,6:7,7:8,8:9,9:10,10:11},"00"),u=i(["gray","red","blue","green","yellow"],"dvc630/dvc630-humsensor-{color}-on{level}.png",{0:1,1:2,2:3,3:4,4:5,5:6,6:7,7:8,8:9,9:10,10:11},"00"),m=n(["gray","red","blue","green","yellow"],"dvc630/dvc630-motionsensor-{color}-{state}.png",["on","off"]),_=n(["gray","red","blue","green","yellow"],"dvc630/dvc630-doorsensor-{color}-{state}.png",["on","off"]),v=i(["N","R","B","G","Y"],"Valve/Valve_{color}_{level}.png",{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10},"00");v=$.extend(v,n(["N","R","B","G","Y"],"Valve/Valve_{color}_{state}.png",["ON","OFF"]));var b=i(["N","R","B","G","Y"],"Valve/Valve_Circle_{color}_{level}.png",{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10},"00");b=$.extend(b,n(["N","R","B","G","Y"],"Valve/Valve_Circle_{color}_{state}.png",["ON","OFF"]));var T=i(["N","R","B","G","Y"],"Valve/Valve_Elec_{color}_{level}.png",{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10},"00");T=$.extend(T,n(["N","R","B","G","Y"],"Valve/Valve_Elec_{color}_{state}.png",["ON","OFF"]));function C(e,t){var i="",n=e.toUpperCase();return-1!=n.indexOf("BLUE")?i="blue":-1!=n.indexOf("GREEN")?i="green":-1!=n.indexOf("RED")?i="red":-1!=n.indexOf("YELLOW")?i="yellow":-1!=n.indexOf("GRAY")||-1!=n.indexOf("GREY")?i="gray":t&&(i="gray"),i}var E=i(["N","R","B","G","Y"],"Meter_{color}_{level}.png",{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10},"00"),I=i(["N","R","B","G","Y"],"Guage_{color}_{level}.png",{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10},"00"),y=e(["Gray","Red","Blue","Green","Yellow"],"Tank/Tank_",0,10),A=e(["Gray","Red","Blue","Green","Yellow"],"WaterTank/WaterTank_",0,10),D=n(["N","R","B","G","Y"],"Power/Light_Fluorescent_{color}_{state}.png",["ON","OFF"]),S=i(["N","R","B","G","Y"],"Power/Light_Fluorescent_{color}_{level}.png",{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10},"00"),w=n(["N","R","B","G","Y"],"Power/Light_Outdoor_{color}_{state}.png",["ON","OFF"]),L=i(["N","R","B","G","Y"],"Power/Light_Outdoor_{color}_{level}.png",{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10},"00"),x=n(["N","R","B","G","Y"],"Power/Light_Incandescent_{color}_{state}.png",["ON","OFF"]),O=i(["N","R","B","G","Y"],"Power/Light_Incandescent_{color}_{level}.png",{0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10},"00"),N=n(["N","R","B","G","Y"],"Power/ACB_{color}_{state}.png",["ON","OFF"]),R=n(["N","R","B","G","Y"],"Power/ALTS_{color}_{state}.png",["ON","OFF"]),B=n(["N","R","B","G","Y"],"Power/CB_{color}_{state}.png",["ON","OFF"]),M=n(["N","R","B","G","Y"],"Power/Condenser_{color}_{state}.png",["ON","OFF"]),P=n(["N","R","B","G","Y"],"Power/Description_{color}_{state}.png",["ON","OFF"]),H=n(["N","R","B","G","Y"],"Power/Ground_{color}_{state}.png",["ON","OFF"]),F=n(["N","R","B","G","Y"],"Power/LBS_{color}_{state}.png",["ON","OFF"]),k=n(["N","R","B","G","Y"],"Power/MCCB_{color}_{state}.png",["ON","OFF"]),U=n(["N","R","B","G","Y"],"Power/Switch_{color}_{state}.png",["ON","OFF"]),G=n(["N","R","B","G","Y"],"Power/Transformer_{color}_{state}.png",["ON","OFF"]),V=n(["N","R","B","G","Y"],"Power/Transformer1_{color}_{state}.png",["ON","OFF"]),W=n(["N","R","B","G","Y"],"Power/VCB_{color}_{state}.png",["ON","OFF"]),z=[{text:t.prop("HMI_BASIC_GRAPHIC"),groupName:"basicShape",items:[{value:"HMI_TEXT",text:t.prop("HMI_TEXT"),imageUrl:g("tools/toolbar/ic-tool-graphic-tri.png"),className:"Text",categoryName:"Null",clickable:!0},{value:"HMI_TRAPEZOID",text:t.prop("HMI_TRAPEZOID"),imageUrl:g("tools/toolbar/ic-tool-graphic-tri.png"),className:"Trapezoid",categoryName:"Null",clickable:!0},{value:"HMI_STRAIGHT",text:t.prop("HMI_STRAIGHT"),imageUrl:g("tools/toolbar/ic-tool-graphic-tri.png"),className:"Straight",categoryName:"Null",clickable:!0},{value:"HMI_POLY_LINE",text:t.prop("HMI_POLY_LINE"),imageUrl:g("tools/toolbar/ic-tool-graphic-polyline.png"),className:"Line",categoryName:"Null",clickable:!0},{value:"HMI_CURVE",text:t.prop("HMI_CURVE"),imageUrl:g("tools/toolbar/ic-tool-graphic-curve.png"),className:"Curve",categoryName:"Text",clickable:!0},{value:"HMI_RECTANGLE",text:t.prop("HMI_RECTANGLE"),imageUrl:g("tools/toolbar/ic-tool-graphic-rect.png"),className:"Rectangle",categoryName:"Null",clickable:!0},{value:"HMI_ROUNDED_RECTANGLE",text:t.prop("HMI_ROUNDED_RECTANGLE"),imageUrl:g("tools/toolbar/ic-tool-graphic-rounded.png"),className:"RoundRectangle",categoryName:"Null",clickable:!0},{value:"HMI_PARALLELOGRAM",text:t.prop("HMI_PARALLELOGRAM"),imageUrl:g("tools/toolbar/ic-tool-graphic-parallelogram.png"),className:"Parallelogram",categoryName:"Null",clickable:!0},{value:"HMI_ELLIPSE",text:t.prop("HMI_ELLIPSE"),imageUrl:g("tools/toolbar/ic-tool-graphic-ellp.png"),className:"Circle",categoryName:"Null",clickable:!0},{value:"HMI_TRIANGLE",text:t.prop("HMI_TRIANGLE"),imageUrl:g("tools/toolbar/ic-tool-graphic-tri.png"),className:"Triangle",categoryName:"Null",clickable:!0},{value:"HMI_IMAGE",text:t.prop("HMI_IMAGE"),imageUrl:g("tools/toolbar/ic-tool-graphic-img.png"),className:"ImportImage",categoryName:"basicImage"},{value:"HMI_TABLE",text:t.prop("HMI_TABLE"),imageUrl:g("tools/toolbar/ic-tool-graphic-table.png"),className:"Table",categoryName:"Null",clickable:!0},{value:"HMI_LINK",text:t.prop("HMI_HYPER_LINK"),imageUrl:g("tools/toolbar/tool-basic-link-nor.png"),className:"HyperLink",categoryName:"Null",clickable:!0},{value:"SPACE_ZONE",text:t.prop("SPACE_ZONE"),imageUrl:g("tools/toolbar/ic-tool-graphic-rect.png"),className:"Zone",categoryName:"Null",clickable:!0}]},{text:t.prop("HMI_ELEMENT_CONTROLS"),groupName:"controlGraphic",items:[{value:"HMI_BUTTON",text:t.prop("HMI_BUTTON"),imageUrl:g("Led/LED_Circle_Gray.png"),categoryName:"RectangleGraphic",className:"RoundButton"},{value:"HMI_RECT_BUTTON",text:t.prop("HMI_RECT_BUTTON"),imageUrl:g("Button/Button_Rect_Gray.png"),categoryName:"RectangleGraphic",className:"RectangleButton"},{value:"HMI_DIP_H_OFF",text:t.prop("HMI_DIP_H_OFF"),imageUrl:g("Dip/Dip_H_Off.png"),categoryName:"DIP",className:"Button",images:{gray_on:g("Dip/Dip_H_On.png"),red_off:g("Dip/Dip_H_Off_Red.png"),red_on:g("Dip/Dip_H_On_Red.png"),blue_off:g("Dip/Dip_H_Off_Blue.png"),blue_on:g("Dip/Dip_H_On_Blue.png"),green_off:g("Dip/Dip_H_Off_Green.png"),green_on:g("Dip/Dip_H_On_Green.png"),yellow_off:g("Dip/Dip_H_Off_Yellow.png"),yellow_on:g("Dip/Dip_H_On_Yellow.png")}},{value:"HMI_DIP_V_OFF",text:t.prop("HMI_DIP_V_OFF"),imageUrl:g("Dip/Dip_V_Off.png"),categoryName:"DIP",className:"Button",images:{gray_on:g("Dip/Dip_V_On.png"),red_off:g("Dip/Dip_V_Off_Red.png"),red_on:g("Dip/Dip_V_On_Red.png"),blue_off:g("Dip/Dip_V_Off_Blue.png"),blue_on:g("Dip/Dip_V_On_Blue.png"),green_off:g("Dip/Dip_V_Off_Green.png"),green_on:g("Dip/Dip_V_On_Green.png"),yellow_off:g("Dip/Dip_V_Off_Yellow.png"),yellow_on:g("Dip/Dip_V_On_Yellow.png")}},{value:"HMI_LEVER",text:t.prop("HMI_LEVER"),imageUrl:g("Lever/Lever_Off.png"),categoryName:"Toggle",className:"Button",images:{gray_on:g("Lever/Lever_On.png"),red_off:g("Lever/Lever_Off_Red.png"),red_on:g("Lever/Lever_On_Red.png"),blue_off:g("Lever/Lever_Off_Blue.png"),blue_on:g("Lever/Lever_On_Blue.png"),green_off:g("Lever/Lever_Off_Green.png"),green_on:g("Lever/Lever_On_Green.png"),yellow_off:g("Lever/Lever_Off_Yellow.png"),yellow_on:g("Lever/Lever_On_Yellow.png")}},{value:"HMI_LEVER_RECTANGLE",text:t.prop("HMI_LEVER_RECTANGLE"),imageUrl:g("Toggle/Toggle_Plastic_Off.png"),categoryName:"Toggle",className:"Button",images:{gray_on:g("Toggle/Toggle_Plastic_On.png"),red_off:g("Toggle/Toggle_Plastic_Off_Red.png"),red_on:g("Toggle/Toggle_Plastic_On_Red.png"),blue_off:g("Toggle/Toggle_Plastic_Off_Blue.png"),blue_on:g("Toggle/Toggle_Plastic_On_Blue.png"),green_off:g("Toggle/Toggle_Plastic_Off_Green.png"),green_on:g("Toggle/Toggle_Plastic_On_Green.png"),yellow_off:g("Toggle/Toggle_Plastic_Off_Yellow.png"),yellow_on:g("Toggle/Toggle_Plastic_On_Yellow.png")}},{value:"HMI_LEVER_ROUND",text:t.prop("HMI_LEVER_ROUND"),imageUrl:g("Toggle/Toggle_Silver_Off.png"),categoryName:"Toggle",className:"Button",images:{gray_on:g("Toggle/Toggle_Silver_On.png"),red_off:g("Toggle/Toggle_Off_Red.png"),red_on:g("Toggle/Toggle_On_Red.png"),blue_off:g("Toggle/Toggle_Off_Blue.png"),blue_on:g("Toggle/Toggle_On_Blue.png"),green_off:g("Toggle/Toggle_Off_Green.png"),green_on:g("Toggle/Toggle_On_Green.png"),yellow_off:g("Toggle/Toggle_Off_Yellow.png"),yellow_on:g("Toggle/Toggle_On_Yellow.png")}},{value:"HMI_SELECTOR_GREY",text:t.prop("HMI_SELECTOR"),imageUrl:g("Selector/Selector_Off_Grey.png"),categoryName:"Selector",className:"Button",images:{gray_on:g("Selector/Selector_On_Grey.png"),red_off:g("Selector/Selector_Off_Red.png"),red_on:g("Selector/Selector_On_Red.png"),blue_off:g("Selector/Selector_Off_Blue.png"),blue_on:g("Selector/Selector_On_Blue.png"),green_off:g("Selector/Selector_Off_Green.png"),green_on:g("Selector/Selector_On_Green.png"),yellow_off:g("Selector/Selector_Off_Yellow.png"),yellow_on:g("Selector/Selector_On_Yellow.png")}},{value:"HMI_LED",text:t.prop("HMI_LED"),imageUrl:g("Led/Led_Gray_Stop.PNG"),categoryName:"LED",className:"Animation",images:{green_on:g("Led/Led_Green.PNG"),green_off:g("Led/Led_Green_Stop.PNG"),red_on:g("Led/Led_Red.PNG"),red_off:g("Led/Led_Red_Stop.PNG"),yellow_on:g("Led/Led_Yellow.PNG"),yellow_off:g("Led/Led_Yellow_Stop.PNG"),blue_on:g("Led/Led_Blue.png"),blue_off:g("Led/Led_Blue_Stop.png"),gray_on:g("Led/Led_Gray.PNG")}},{value:"HMI_LED_CIRCLE",text:t.prop("HMI_LED_CIRCLE"),imageUrl:g("Led/LED_Circle_Gray.png"),categoryName:"LED",className:"Animation",images:{green_on:g("Led/LED_Circle_Green.png"),green_off:g("Led/LED_Circle_Green.png"),red_on:g("Led/LED_Circle_Red.png"),red_off:g("Led/LED_Circle_Red.png"),yellow_on:g("Led/LED_Circle_Yellow.png"),yellow_off:g("Led/LED_Circle_Yellow.png"),blue_on:g("Led/LED_Circle_Blue.png"),blue_off:g("Led/LED_Circle_Blue.png"),gray_on:g("Led/LED_Circle_Gray.png")}},{value:"HMI_LED_ROUND_RECTANGLE",text:t.prop("HMI_LED_ROUND_RECTANGLE"),imageUrl:g("Led/LED_RoundSquare_Gray.png"),categoryName:"LED",className:"Animation",images:{green_on:g("Led/LED_RoundSquare_Green.png"),green_off:g("Led/LED_RoundSquare_Green.png"),red_on:g("Led/LED_RoundSquare_Red.png"),red_off:g("Led/LED_RoundSquare_Red.png"),yellow_on:g("Led/LED_RoundSquare_Yellow.png"),yellow_off:g("Led/LED_RoundSquare_Yellow.png"),blue_on:g("Led/LED_RoundSquare_Blue.png"),blue_off:g("Led/LED_RoundSquare_Blue.png"),gray_on:g("Led/LED_RoundSquare_Gray.png")}},{value:"HMI_LED_RECTANGLE",text:t.prop("HMI_LED_RECTANGLE"),imageUrl:g("Led/LED_Square_Gray.png"),categoryName:"LED",className:"Animation",images:{green_on:g("Led/LED_Square_Green.png"),green_off:g("Led/LED_Square_Green.png"),red_on:g("Led/LED_Square_Red.png"),red_off:g("Led/LED_Square_Red.png"),yellow_on:g("Led/LED_Square_Yellow.png"),yellow_off:g("Led/LED_Square_Yellow.png"),blue_on:g("Led/LED_Square_Blue.png"),blue_off:g("Led/LED_Square_Blue.png"),gray_on:g("Led/LED_Square_Gray.png")}},{value:"HMI_ALARM",text:t.prop("HMI_ALARM"),imageUrl:g("Error/Middle.PNG"),categoryName:"Alarm",images:{on:g("Error/ani/alarm.gif")},className:"Animation"},{value:"HMI_CHECK_BOX",text:t.prop("HMI_CHECK_BOX"),imageUrl:g("controlGraphics/check.png"),className:"CheckBox",categoryName:"CheckBox"},{value:"HMI_COMBO_BOX",text:t.prop("HMI_COMBO_BOX"),imageUrl:g("controlGraphics/combo.png"),className:"ComboBox",categoryName:"Combobox"},{value:"HMI_RADIO_BUTTON",text:t.prop("HMI_RADIO_BUTTON"),imageUrl:g("controlGraphics/radiobutton.png"),className:"RadioButton",categoryName:"Radio Button"},{value:"HMI_RADIO_BUTTON_VERTICAL",text:t.prop("HMI_RADIO_BUTTON_VERTICAL"),imageUrl:g("controlGraphics/radiobutton_v.png"),className:"RadioButton",categoryName:"Radio Button",options:{direction:"vertical"}},{value:"HMI_SCALE_BAR",text:t.prop("HMI_SCALE_BAR"),imageUrl:g("controlGraphics/scalebar.png"),className:"ScaleBar",categoryName:"Scalebar"},{value:"HMI_SCALE_BAR_VERTICAL",text:t.prop("HMI_SCALE_BAR_VERTICAL"),imageUrl:g("controlGraphics/scalebar_v.png"),className:"ScaleBar",categoryName:"Scalebar",options:{direction:"vertical"}},{value:"HMI_TEXT_BOX",text:t.prop("HMI_TEXT_BOX"),imageUrl:g("basic/text.png"),className:"ExtendText",categoryName:"ExtLabel"},{value:"HMI_CHART",text:t.prop("HMI_CHART"),imageUrl:g("Chart/chart.png"),className:"Chart",categoryName:"Chart"},{value:"HMI_PROGRESS_BAR",text:t.prop("HMI_PROGRESS_BAR"),imageUrl:g("controlGraphics/progress.png"),className:"ProgressBar",categoryName:"ProgressBar"},{value:"HMI_PROGRESS_BAR_VERTICAL",text:t.prop("HMI_PROGRESS_BAR_VERTICAL"),imageUrl:g("controlGraphics/progress_v.png"),className:"ProgressBar",categoryName:"ProgressBar",options:{direction:"vertical"}}]},{text:t.prop("HMI_ELEMENT_DUCTS"),groupName:"facilityGraphicImage",className:"Image",items:[{value:"HMI_DUCT_CROSS",text:t.prop("HMI_DUCT_CROSS"),imageUrl:g("Duct/Ducts_Cross.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_Cross_Red.png"),blue:g("Duct/Ducts_Cross_Blue.png"),yellow:g("Duct/Ducts_Cross_Yellow.png"),green:g("Duct/Ducts_Cross_Green.png")}},{value:"HMI_DUCT_H",text:t.prop("HMI_DUCT_H"),imageUrl:g("Duct/Ducts_H.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_H_Red.png"),blue:g("Duct/Ducts_H_Blue.png"),yellow:g("Duct/Ducts_H_Yellow.png"),green:g("Duct/Ducts_H_Green.png")}},{value:"HMI_DUCT_HOLE",text:t.prop("HMI_DUCT_HOLE"),imageUrl:g("Duct/Ducts_Hole.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_Hole_Red.png"),blue:g("Duct/Ducts_Hole_Blue.png"),yellow:g("Duct/Ducts_Hole_Yellow.png"),green:g("Duct/Ducts_Hole_Green.png")}},{value:"HMI_DUCT_HORZSTRAIGHT",text:t.prop("HMI_DUCT_HORZSTRAIGHT"),imageUrl:g("Duct/Ducts_HorzStraight.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_HorzStraight_Red.png"),blue:g("Duct/Ducts_HorzStraight_Blue.png"),yellow:g("Duct/Ducts_HorzStraight_Yellow.png"),green:g("Duct/Ducts_HorzStraight_Green.png")}},{value:"HMI_DUCTS_HORZSTRAIGHT_HARF",text:t.prop("HMI_DUCTS_HORZSTRAIGHT_HARF"),imageUrl:g("Duct/Ducts_HorzStraight_harf.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_HorzStraight_harf_Red.png"),blue:g("Duct/Ducts_HorzStraight_harf_Blue.png"),yellow:g("Duct/Ducts_HorzStraight_harf_Yellow.png"),green:g("Duct/Ducts_HorzStraight_harf_Green.png")}},{value:"HMI_DUCT_L_DOWN_LEFT",text:t.prop("HMI_DUCT_L_DOWN_LEFT"),imageUrl:g("Duct/Ducts_L_Down_Left.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_L_Down_Left_Red.png"),blue:g("Duct/Ducts_L_Down_Left_Blue.png"),yellow:g("Duct/Ducts_L_Down_Left_Yellow.png"),green:g("Duct/Ducts_L_Down_Left_Green.png")}},{value:"HMI_DUCT_L_DOWN_RIGHT",text:t.prop("HMI_DUCT_L_DOWN_RIGHT"),imageUrl:g("Duct/Ducts_L_Down_Right.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_L_Down_Right_Red.png"),blue:g("Duct/Ducts_L_Down_Right_Blue.png"),yellow:g("Duct/Ducts_L_Down_Right_Yellow.png"),green:g("Duct/Ducts_L_Down_Right_Green.png")}},{value:"HMI_DUCTS_L_UP_LEFT",text:t.prop("HMI_DUCTS_L_UP_LEFT"),imageUrl:g("Duct/Ducts_L_Up_Left.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_L_Up_Left_Red.png"),blue:g("Duct/Ducts_L_Up_Left_Blue.png"),yellow:g("Duct/Ducts_L_Up_Left_Yellow.png"),green:g("Duct/Ducts_L_Up_Left_Green.png")}},{value:"HMI_DUCTS_L_UP_RIGHT",text:t.prop("HMI_DUCTS_L_UP_RIGHT"),imageUrl:g("Duct/Ducts_L_Up_Right.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_L_Up_Right_Red.png"),blue:g("Duct/Ducts_L_Up_Right_Blue.png"),yellow:g("Duct/Ducts_L_Up_Right_Yellow.png"),green:g("Duct/Ducts_L_Up_Right_Green.png")}},{value:"HMI_DUCT_SEPARATION_2_LEFT",text:t.prop("HMI_DUCT_SEPARATION_2_LEFT"),imageUrl:g("Duct/Ducts_Separation_2Left.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_Separation_2Left_Red.png"),blue:g("Duct/Ducts_Separation_2Left_Blue.png"),yellow:g("Duct/Ducts_Separation_2Left_Yellow.png"),green:g("Duct/Ducts_Separation_2Left_Green.png")}},{value:"HMI_DUCT_SEPARATION_3_LEFT",text:t.prop("HMI_DUCT_SEPARATION_3_LEFT"),imageUrl:g("Duct/Ducts_Separation_3Left.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_Separation_3Left_Red.png"),blue:g("Duct/Ducts_Separation_3Left_Blue.png"),yellow:g("Duct/Ducts_Separation_3Left_Yellow.png"),green:g("Duct/Ducts_Separation_3Left_Green.png")}},{value:"HMI_DUCTS_SEPARATION_3RIGHT",text:t.prop("HMI_DUCTS_SEPARATION_3RIGHT"),imageUrl:g("Duct/Ducts_Separation_3Right.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_Separation_3Right_Red.png"),blue:g("Duct/Ducts_Separation_3Right_Blue.png"),yellow:g("Duct/Ducts_Separation_3Right_Yellow.png"),green:g("Duct/Ducts_Separation_3Right_Green.png")}},{value:"HMI_DUCTS_SEPERATE_2RIGHT",text:t.prop("HMI_DUCTS_SEPERATE_2RIGHT"),imageUrl:g("Duct/Ducts_Seperate_2Right.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_Seperate_2Right_Red.png"),blue:g("Duct/Ducts_Seperate_2Right_Blue.png"),yellow:g("Duct/Ducts_Seperate_2Right_Yellow.png"),green:g("Duct/Ducts_Seperate_2Right_Green.png")}},{value:"HMI_DUCTS_T_DOWN",text:t.prop("HMI_DUCTS_T_DOWN"),imageUrl:g("Duct/Ducts_T_Down.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_T_Down_Red.png"),blue:g("Duct/Ducts_T_Down_Blue.png"),yellow:g("Duct/Ducts_T_Down_Yellow.png"),green:g("Duct/Ducts_T_Down_Green.png")}},{value:"HMI_DUCTS_T_LEFT",text:t.prop("HMI_DUCTS_T_LEFT"),imageUrl:g("Duct/Ducts_T_Left.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_T_Left_Red.png"),blue:g("Duct/Ducts_T_Left_Blue.png"),yellow:g("Duct/Ducts_T_Left_Yellow.png"),green:g("Duct/Ducts_T_Left_Green.png")}},{value:"HMI_DUCTS_T_RIGHT",text:t.prop("HMI_DUCTS_T_RIGHT"),imageUrl:g("Duct/Ducts_T_Right.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_T_Right_Red.png"),blue:g("Duct/Ducts_T_Right_Blue.png"),yellow:g("Duct/Ducts_T_Right_Yellow.png"),green:g("Duct/Ducts_T_Right_Green.png")}},{value:"HMI_DUCTS_T_UP",text:t.prop("HMI_DUCTS_T_UP"),imageUrl:g("Duct/Ducts_T_Up.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_T_Up_Red.png"),blue:g("Duct/Ducts_T_Up_Blue.png"),yellow:g("Duct/Ducts_T_Up_Yellow.png"),green:g("Duct/Ducts_T_Up_Green.png")}},{value:"HMI_DUCTSVENTILATING",text:t.prop("HMI_DUCTSVENTILATING"),imageUrl:g("Duct/Ducts_Ventilating.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_Ventilating_Red.png"),blue:g("Duct/Ducts_Ventilating_Blue.png"),yellow:g("Duct/Ducts_Ventilating_Yellow.png"),green:g("Duct/Ducts_Ventilating_Green.png")}},{value:"HMI_DUCTS_VERTSTRAIGHT",text:t.prop("HMI_DUCTS_VERTSTRAIGHT"),imageUrl:g("Duct/Ducts_VertStraight.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_VertStraight_Red.png"),blue:g("Duct/Ducts_VertStraight_Blue.png"),yellow:g("Duct/Ducts_VertStraight_Yellow.png"),green:g("Duct/Ducts_VertStraight_Green.png")}},{value:"HMI_DUCTS_VERTSTRAIGHT_HARF",text:t.prop("HMI_DUCTS_VERTSTRAIGHT_HARF"),imageUrl:g("Duct/Ducts_VertStraight_harf.svg"),categoryName:"Null",images:{red:g("Duct/Ducts_VertStraight_harf_Red.png"),blue:g("Duct/Ducts_VertStraight_harf_Blue.png"),yellow:g("Duct/Ducts_VertStraight_harf_Yellow.png"),green:g("Duct/Ducts_VertStraight_harf_Green.png")}}]},{text:t.prop("HMI_ELEMENT_PIPES"),groupName:"facilityGraphicImage",className:"Image",items:[{value:"HMI_PIPESCOVER_DOWN_GREY",text:t.prop("HMI_PIPESCOVER_DOWN"),imageUrl:g("PipesCover_Down_Grey.png"),categoryName:"Null",images:{red:g("PipesCover_Down_Red.png"),blue:g("PipesCover_Down_Blue.png"),yellow:g("PipesCover_Down_Yellow.png"),green:g("PipesCover_Down_Green.png")}},{value:"HMI_PIPESCOVER_LEFT_GREY",text:t.prop("HMI_PIPESCOVER_LEFT"),imageUrl:g("PipesCover_Left_Grey.png"),categoryName:"Null",images:{red:g("PipesCover_Left_Red.png"),blue:g("PipesCover_Left_Blue.png"),yellow:g("PipesCover_Left_Yellow.png"),green:g("PipesCover_Left_Green.png")}},{value:"HMI_PIPESCOVER_RIGHT_GREY",text:t.prop("HMI_PIPESCOVER_RIGHT"),imageUrl:g("PipesCover_Right_Grey.png"),categoryName:"Null",images:{red:g("PipesCover_Right_Red.png"),blue:g("PipesCover_Right_Blue.png"),yellow:g("PipesCover_Right_Yellow.png"),green:g("PipesCover_Right_Green.png")}},{value:"HMI_PIPESCOVER_UP_GREY",text:t.prop("HMI_PIPESCOVER_UP"),imageUrl:g("PipesCover_Up_Grey.png"),categoryName:"Null",images:{red:g("PipesCover_Up_Red.png"),blue:g("PipesCover_Up_Blue.png"),yellow:g("PipesCover_Up_Yellow.png"),green:g("PipesCover_Up_Green.png")}},{value:"HMI_PIPES_CROSS_GREY",text:t.prop("HMI_PIPES_CROSS"),imageUrl:g("Pipes_Cross_Grey.png"),categoryName:"Null",images:{red:g("Pipes_Cross_Red.png"),blue:g("Pipes_Cross_Blue.png"),yellow:g("Pipes_Cross_Yellow.png"),green:g("Pipes_Cross_Green.png")}},{value:"HMI_PIPES_HORZSTRAIGHT",text:t.prop("HMI_PIPES_HORZSTRAIGHT"),imageUrl:g("Pipes_HorzStraight_Grey.png"),categoryName:"Null",images:{red:g("Pipes_HorzStraight_Red.png"),blue:g("Pipes_HorzStraight_Blue.png"),yellow:g("Pipes_HorzStraight_Yellow.png"),green:g("Pipes_HorzStraight_Green.png")}},{value:"HMI_PIPES_L_DOWN_LEFT_GREY",text:t.prop("HMI_PIPES_L_DOWN_LEFT"),imageUrl:g("Pipes_L_Down_Left_Grey.png"),categoryName:"Null",images:{red:g("Pipes_L_Down_Left_Red.png"),blue:g("Pipes_L_Down_Left_Blue.png"),yellow:g("Pipes_L_Down_Left_Yellow.png"),green:g("Pipes_L_Down_Left_Green.png")}},{value:"HMI_PIPES_L_DOWN_RIGHT_GREY",text:t.prop("HMI_PIPES_L_DOWN_RIGHT"),imageUrl:g("Pipes_L_Down_Right_Grey.png"),categoryName:"Null",images:{red:g("Pipes_L_Down_Right_Red.png"),blue:g("Pipes_L_Down_Right_Blue.png"),yellow:g("Pipes_L_Down_Right_Yellow.png"),green:g("Pipes_L_Down_Right_Green.png")}},{value:"HMI_PIPES_L_UP_LEFT_GREY",text:t.prop("HMI_PIPES_L_UP_LEFT"),imageUrl:g("Pipes_L_Up_Left_Grey.png"),categoryName:"Null",images:{red:g("Pipes_L_Up_Left_Red.png"),blue:g("Pipes_L_Up_Left_Blue.png"),yellow:g("Pipes_L_Up_Left_Yellow.png"),green:g("Pipes_L_Up_Left_Green.png")}},{value:"HMI_PIPES_L_UP_RIGHT_GREY",text:t.prop("HMI_PIPES_L_UP_RIGHT"),imageUrl:g("Pipes_L_Up_Right_Grey.png"),categoryName:"Null",images:{red:g("Pipes_L_Up_Right_Red.png"),blue:g("Pipes_L_Up_Right_Blue.png"),yellow:g("Pipes_L_Up_Right_Yellow.png"),green:g("Pipes_L_Up_Right_Green.png")}},{value:"HMI_PIPES_T_DOWN_GREY",text:t.prop("HMI_PIPES_T_DOWN"),imageUrl:g("Pipes_T_Down_Grey.png"),categoryName:"Null",images:{red:g("Pipes_T_Down_Red.png"),blue:g("Pipes_T_Down_Blue.png"),yellow:g("Pipes_T_Down_Yellow.png"),green:g("Pipes_T_Down_Green.png")}},{value:"HMI_PIPES_T_LEFT_GREY",text:t.prop("HMI_PIPES_T_LEFT"),imageUrl:g("Pipes_T_Left_Grey.png"),categoryName:"Null",images:{red:g("Pipes_T_Left_red.png"),blue:g("Pipes_T_Left_Blue.png"),yellow:g("Pipes_T_Left_Yellow.png"),green:g("Pipes_T_Left_Green.png")}},{value:"HMI_PIPES_T_RIGHT_GREY",text:t.prop("HMI_PIPES_T_RIGHT"),imageUrl:g("Pipes_T_Right_Grey.png"),categoryName:"Null",images:{red:g("Pipes_T_Right_Red.png"),blue:g("Pipes_T_Right_Blue.png"),yellow:g("Pipes_T_Right_Yellow.png"),green:g("Pipes_T_Right_Green.png")}},{value:"HMI_PIPES_T_UP_GREY",text:t.prop("HMI_PIPES_T_UP"),imageUrl:g("Pipes_T_Up_Grey.png"),categoryName:"Null",images:{red:g("Pipes_T_Up_Red.png"),blue:g("Pipes_T_Up_Blue.png"),yellow:g("Pipes_T_Up_Yellow.png"),green:g("Pipes_T_Up_Green.png")}},{value:"HMI_PIPES_VERTSTRAIGHT_GREY",text:t.prop("HMI_PIPES_VERTSTRAIGHT"),imageUrl:g("Pipes_VertStraight_Grey.png"),categoryName:"Null",images:{red:g("Pipes_VertStraight_Red.png"),blue:g("Pipes_VertStraight_Blue.png"),yellow:g("Pipes_VertStraight_Yellow.png"),green:g("Pipes_VertStraight_Green.png")}}]},{text:t.prop("HMI_ELEMENT_FIELD_DEVICE"),groupName:"facilityGraphicImage",className:"Image",items:[{value:"HMI_FLOWSENSOR_CIRCLE",text:t.prop("HMI_FLOWSENSOR_CIRCLE"),imageUrl:g("FlowSensor_Circle.png"),categoryName:"Null",images:{red:g("FlowSensor_Circle_Red.png"),blue:g("FlowSensor_Circle_Blue.png"),yellow:g("FlowSensor_Circle_Yellow.png"),green:g("FlowSensor_Circle_Green.png")}},{value:"HMI_FLOWSENSOR_CROSS",text:t.prop("HMI_FLOWSENSOR_CROSS"),imageUrl:g("FlowSensor_Cross.png"),categoryName:"Null",images:{red:g("FlowSensor_Cross_Red.png"),blue:g("FlowSensor_Cross_Blue.png"),yellow:g("FlowSensor_Cross_Yellow.png"),green:g("FlowSensor_Cross_Green.png")}},{value:"HMI_HEATSENSOR_DOWN_BLUE",text:t.prop("HMI_HEATSENSOR_DOWN"),imageUrl:g("HeatSensor_Down_Gray.png"),categoryName:"Null",images:{red:g("HeatSensor_Down_Red.png"),blue:g("HeatSensor_Down_Blue.png"),yellow:g("HeatSensor_Down_Yellow.png"),green:g("HeatSensor_Down_Green.png")}},{value:"HMI_PIPESENSOR_DOWN_GREY",text:t.prop("HMI_PIPESENSOR_DOWN"),imageUrl:g("PipeSensor_Down_Gray.png"),categoryName:"Null",images:{red:g("PipeSensor_Down_Red.png"),blue:g("PipeSensor_Down_Blue.png"),yellow:g("PipeSensor_Down_Yellow.png"),green:g("PipeSensor_Down_Green.png")}},{value:"HMI_PRESSSENSOR_DOWN",text:t.prop("HMI_PRESSSENSOR_DOWN"),imageUrl:g("PressSensor_Down.png"),categoryName:"Null",images:{red:g("PressSensor_Down_Red.png"),blue:g("PressSensor_Down_Blue.png"),yellow:g("PressSensor_Down_Yellow.png"),green:g("PressSensor_Down_Green.png")}},{value:"HMI_SENSOR_DOWN_GREY",text:t.prop("HMI_SENSOR_DOWN"),imageUrl:g("Sensor_Down_Grey.png"),categoryName:"Null",images:{red:g("Sensor_Down_Red.png"),blue:g("Sensor_Down_Blue.png"),yellow:g("Sensor_Down_Yellow.png"),green:g("Sensor_Down_Green.png")}},{value:"HMI_SENSOR_LDOWN_BLUE2",text:t.prop("HMI_SENSOR_LDOWN"),imageUrl:g("Sensor_LDown_Gray2.png"),categoryName:"Null",images:{red:g("Sensor_LDown_Red2.png"),blue:g("Sensor_LDown_Blue2.png"),yellow:g("Sensor_LDown_Yellow2.png"),green:g("Sensor_LDown_Green2.png")}},{value:"HMI_SENSOR_LUP_BLUE2",text:t.prop("HMI_SENSOR_LUP"),imageUrl:g("Sensor_LUp_Gray2.png"),categoryName:"Null",images:{red:g("Sensor_LUp_Red2.png"),blue:g("Sensor_LUp_Blue2.png"),yellow:g("Sensor_LUp_Yellow2.png"),green:g("Sensor_LUp_Green2.png")}},{value:"HMI_SENSOR_SDOWN_BLUE2",text:t.prop("HMI_SENSOR_SDOWN"),imageUrl:g("Sensor_SDown_Gray2.png"),categoryName:"Null",images:{red:g("Sensor_SDown_Red2.png"),blue:g("Sensor_SDown_Blue2.png"),yellow:g("Sensor_SDown_Yellow2.png"),green:g("Sensor_SDown_Green2.png")}},{value:"HMI_SENSOR_SUP_BLUE2",text:t.prop("HMI_SENSOR_SUP"),imageUrl:g("Sensor_SUp_Gray2.png"),categoryName:"Null",images:{red:g("Sensor_SUp_Red2.png"),blue:g("Sensor_SUp_Blue2.png"),yellow:g("Sensor_SUp_Yellow2.png"),green:g("Sensor_SUp_Green2.png")}},{value:"HMI_SENSOR_UP_GREY",text:t.prop("HMI_SENSOR_UP"),imageUrl:g("Sensor_Up_Grey.png"),categoryName:"Null",images:{red:g("Sensor_Up_Red.png"),blue:g("Sensor_Up_Blue.png"),yellow:g("Sensor_Up_Yellow.png"),green:g("Sensor_Up_Green.png")},oldImages:[g("Sensor_Down_Green_up.png")]},{value:"HMI_SENSORLAMP_UP",text:t.prop("HMI_SENSORLAMP_UP"),imageUrl:g("SensorLamp_Up.png"),categoryName:"Null",images:{red:g("SensorLamp_Up_Red.png"),blue:g("SensorLamp_Up_Blue.png"),yellow:g("SensorLamp_Up_Yellow.png"),green:g("SensorLamp_Up_Green.png")}},{value:"HMI_TEMPSENSOR_UP",text:t.prop("HMI_TEMPSENSOR_UP"),imageUrl:g("TempSensor_Up.png"),categoryName:"Null",images:{red:g("TempSensor_Up_Red.png"),blue:g("TempSensor_Up_Blue.png"),yellow:g("TempSensor_Up_Yellow.png"),green:g("TempSensor_Up_Green.png")}},{value:"HMI_VALVE",text:t.prop("HMI_VALVE"),imageUrl:g("Valve/Valve_N_OFF.png"),categoryName:"Valve",className:"Animation",images:v},{value:"HMI_ROUND_VALVE",text:t.prop("HMI_ROUND_VALVE"),imageUrl:g("Valve/Valve_Circle_N_OFF.png"),categoryName:"Valve",className:"Animation",images:b},{value:"HMI_ELECTRONIC_VALVE",text:t.prop("HMI_ELECTRONIC_VALVE"),imageUrl:g("Valve/Valve_Elec_N_OFF.png"),categoryName:"Valve",className:"Animation",images:T}]},{text:t.prop("HMI_ELEMENT_PARTS"),groupName:"facilityGraphicImage",className:"Image",items:[{value:"HMI_DAMPER_H1_GREY",text:t.prop("HMI_DAMPER_H1_GREY"),imageUrl:g("Damper/Damper_H1_Grey.png"),categoryName:"Damper",className:"Animation",images:r},{value:"HMI_DAMPER_V1_GREY",text:t.prop("HMI_DAMPER_V1_GREY"),imageUrl:g("Damper/Damper_V1_Grey.png"),categoryName:"Damper",className:"Animation",images:l},{value:"HMI_FILTER_H",text:t.prop("HMI_FILTER_H"),imageUrl:g("Filter_H.png"),categoryName:"Null",images:{red:g("Filter_H_Red.png"),blue:g("Filter_H_Blue.png"),yellow:g("Filter_H_Yellow.png"),green:g("Filter_H_Green.png")}},{value:"HMI_FILTER_V",text:t.prop("HMI_FILTER_V"),imageUrl:g("Filter_V.png"),categoryName:"Null",images:{red:g("Filter_V_Red.png"),blue:g("Filter_V_Blue.png"),yellow:g("Filter_V_Yellow.png"),green:g("Filter_V_Green.png")}},{value:"HMI_COIL_H_COOL",text:t.prop("HMI_COIL_H_COOL"),imageUrl:g("Coil/Coil_H_Cool_Stop.png"),categoryName:"Coil",className:"Animation",images:{red_on:g("Coil/Coil_H_Red.png"),red_off:g("Coil/Coil_H_Red.png"),blue_on:g("Coil/Coil_H_Blue.png"),blue_off:g("Coil/Coil_H_Blue.png"),green_on:g("Coil/Coil_H_Green.png"),green_off:g("Coil/Coil_H_Green.png"),yellow_on:g("Coil/Coil_H_Yellow.png"),yellow_off:g("Coil/Coil_H_Yellow.png"),gray_on:g("Coil/Coil_H_Grey.png")}},{value:"HMI_COIL_H_HOT",text:t.prop("HMI_COIL_H_HOT"),imageUrl:g("Coil/Coil_H_Hot_Stop.png"),categoryName:"Coil",className:"Animation",images:{red_on:g("Coil/Coil_H_Red.png"),red_off:g("Coil/Coil_H_Red.png"),blue_on:g("Coil/Coil_H_Blue.png"),blue_off:g("Coil/Coil_H_Blue.png"),yellow_on:g("Coil/Coil_H_Yellow.png"),yellow_off:g("Coil/Coil_H_Yellow.png"),green_on:g("Coil/Coil_H_Green.png"),green_off:g("Coil/Coil_H_Green.png"),gray_on:g("Coil/Coil_H_Grey.png")}},{value:"HMI_COIL_V_COOL",text:t.prop("HMI_COIL_V_COOL"),imageUrl:g("Coil/Coil_V_Cool_Stop.png"),categoryName:"Coil",className:"Animation",images:{red_on:g("Coil/Coil_V_Red.png"),red_off:g("Coil/Coil_V_Red.png"),blue_on:g("Coil/Coil_V_Blue.png"),blue_off:g("Coil/Coil_V_Blue.png"),yellow_on:g("Coil/Coil_V_Yellow.png"),yellow_off:g("Coil/Coil_V_Yellow.png"),green_on:g("Coil/Coil_V_Green.png"),green_off:g("Coil/Coil_V_Green.png"),gray_on:g("Coil/Coil_V_Grey.png")}},{value:"HMI_COIL_V_HOT",text:t.prop("HMI_COIL_V_HOT"),imageUrl:g("Coil/Coil_V_Hot_Stop.png"),categoryName:"Coil",className:"Animation",images:{red_on:g("Coil/Coil_V_Red.png"),red_off:g("Coil/Coil_V_Red.png"),blue_on:g("Coil/Coil_V_Blue.png"),blue_off:g("Coil/Coil_V_Blue.png"),yellow_on:g("Coil/Coil_V_Yellow.png"),yellow_off:g("Coil/Coil_V_Yellow.png"),green_on:g("Coil/Coil_V_Green.png"),green_off:g("Coil/Coil_V_Green.png"),gray_on:g("Coil/Coil_V_Grey.png")}}]},{text:t.prop("HMI_ELEMENT_FACILITIES"),groupName:"facilityGraphicAnimation",className:"Animation",items:[{value:"HMI_PUMP_BLUE",text:t.prop("HMI_PUMP"),imageUrl:g("Pump/CirclePump_Gray.png"),categoryName:"Pumps",className:"Animation",images:o},{value:"HMI_BLUE_CROSS_PUMP",text:t.prop("HMI_CROSS_PUMP"),imageUrl:g("Pump/CrossPump_Gray.png"),categoryName:"Pumps",className:"Animation",images:a},{value:"HMI_BLUE_PUMP_2",text:t.prop("HMI_PUMP_2"),imageUrl:g("Pump/Pump_Gray1.png"),categoryName:"Pumps2",className:"Animation",images:s},{value:"HMI_BLOWER_LEFT",text:t.prop("HMI_BLOWER_LEFT"),imageUrl:g("Blower/Blower_L1.png"),categoryName:"Blower",images:{red_stop:g("Blower/Blower_L2_Red.png"),blue_stop:g("Blower/Blower_L2_Blue.png"),yellow_stop:g("Blower/Blower_L2_Yellow.png"),green_stop:g("Blower/Blower_L2_Green.png"),gray_rotate:g("Blower/Blower_L1_ani.gif"),red_rotate:g("Blower/Blower_L1_ani_Red.gif"),blue_rotate:g("Blower/Blower_L1_ani_Blue.gif"),yellow_rotate:g("Blower/Blower_L1_ani_Yellow.gif"),green_rotate:g("Blower/Blower_L1_ani_Green.gif")}},{value:"HMI_BLOWER_RIGHT",text:t.prop("HMI_BLOWER_RIGHT"),imageUrl:g("Blower/Blower_R1.png"),categoryName:"Blower",images:{red_stop:g("Blower/Blower_R1_Red.png"),blue_stop:g("Blower/Blower_R1_Blue.png"),yellow_stop:g("Blower/Blower_R1_Yellow.png"),green_stop:g("Blower/Blower_R1_Green.png"),gray_rotate:g("Blower/Blower_R1_ani.gif"),red_rotate:g("Blower/Blower_R1_ani_Red.gif"),blue_rotate:g("Blower/Blower_R1_ani_Blue.gif"),yellow_rotate:g("Blower/Blower_R1_ani_Yellow.gif"),green_rotate:g("Blower/Blower_R1_ani_Green.gif")}},{value:"HMI_BLOWER_UP",text:t.prop("HMI_BLOWER_UP"),imageUrl:g("Blower/Blower_UP1.png"),categoryName:"Blower",images:{red_stop:g("Blower/Blower_UP1_Red.png"),blue_stop:g("Blower/Blower_UP1_Blue.png"),yellow_stop:g("Blower/Blower_UP1_Yellow.png"),green_stop:g("Blower/Blower_UP1_Green.png"),gray_rotate:g("Blower/Blower_UP1_ani.gif"),red_rotate:g("Blower/Blower_UP1_ani_Red.gif"),blue_rotate:g("Blower/Blower_UP1_ani_Blue.gif"),yellow_rotate:g("Blower/Blower_UP1_ani_Yellow.gif"),green_rotate:g("Blower/Blower_UP1_ani_Green.gif")}},{value:"HMI_BLOWER_DOWN_",text:t.prop("HMI_BLOWER_DOWN_"),imageUrl:g("Blower/Blower_Down1.png"),categoryName:"Blower",images:{red_stop:g("Blower/Blower_Down1_Red.png"),blue_stop:g("Blower/Blower_Down1_Blue.png"),yellow_stop:g("Blower/Blower_Down1_Yellow.png"),green_stop:g("Blower/Blower_Down1_Green.png"),gray_rotate:g("Blower/Blower_D_ani.gif"),red_rotate:g("Blower/Blower_D_ani_Red.gif"),blue_rotate:g("Blower/Blower_D_ani_Blue.gif"),yellow_rotate:g("Blower/Blower_D_ani_Yellow.gif"),green_rotate:g("Blower/Blower_D_ani_Green.gif")}},{value:"HMI_EXHAUST_FAN",text:t.prop("HMI_EXHAUST_FAN"),imageUrl:g("Fan/ExhaustFan1.png"),categoryName:"Exhaust",images:{gray_on:g("Fan/ani/Exhaust-Fan1.gif"),red_off:g("Fan/ExhaustFan1_Red.png"),red_on:g("Fan/ani/Exhaust-Fan1_Red.gif"),blue_off:g("Fan/ExhaustFan1_Blue.png"),blue_on:g("Fan/ani/Exhaust-Fan1_Blue.gif"),green_off:g("Fan/ExhaustFan1_Green.png"),green_on:g("Fan/ani/Exhaust-Fan1_Green.gif"),yellow_off:g("Fan/ExhaustFan1_Yellow.png"),yellow_on:g("Fan/ani/Exhaust-Fan1_Yellow.gif")}},{value:"HMI_COOLING_TOWER_1",text:t.prop("HMI_COOLING_TOWER_1"),imageUrl:g("CoolingTower/CoolingTower_Cross1.png"),categoryName:"CoolingTower",images:{gray_rotate:g("CoolingTower/ani/Cooling-Tower_Cross1.gif"),red_stop:g("CoolingTower/CoolingTower_Cross1_Red.png"),red_rotate:g("CoolingTower/ani/Cooling-Tower_Cross1_Red.gif"),blue_stop:g("CoolingTower/CoolingTower_Cross1_Blue.png"),blue_rotate:g("CoolingTower/ani/Cooling-Tower_Cross1_Blue.gif"),green_stop:g("CoolingTower/CoolingTower_Cross1_Green.png"),green_rotate:g("CoolingTower/ani/Cooling-Tower_Cross1_Green.gif"),yellow_stop:g("CoolingTower/CoolingTower_Cross1_Yellow.png"),yellow_rotate:g("CoolingTower/ani/Cooling-Tower_Cross1_Yellow.gif")}},{value:"HMI_COOLING_TOWER_2",text:t.prop("HMI_COOLING_TOWER_2"),imageUrl:g("CoolingTower/Cooling-Tower_Parallel1_Off.png"),categoryName:"CoolingTower",images:{gray_rotate:g("CoolingTower/ani/Cooling-Tower_Parallel1.gif"),red_stop:g("CoolingTower/Cooling-Tower_Parallel1_Red.png"),red_rotate:g("CoolingTower/ani/Cooling-Tower_Parallel1_Red.gif"),blue_stop:g("CoolingTower/Cooling-Tower_Parallel1_Blue.png"),blue_rotate:g("CoolingTower/ani/Cooling-Tower_Parallel1_Blue.gif"),green_stop:g("CoolingTower/Cooling-Tower_Parallel1_Green.png"),green_rotate:g("CoolingTower/ani/Cooling-Tower_Parallel1_Green.gif"),yellow_stop:g("CoolingTower/Cooling-Tower_Parallel1_Yellow.png"),yellow_rotate:g("CoolingTower/ani/Cooling-Tower_Parallel1_Yellow.gif")}},{value:"HMI_BOILER",text:t.prop("HMI_BOILER"),imageUrl:g("Boiler.png"),categoryName:"Null",className:"Image",images:{red:g("Boiler_Red.png"),blue:g("Boiler_Blue.png"),yellow:g("Boiler_Yellow.png"),green:g("Boiler_Green.png")}},{value:"HMI_CHILLER1",text:t.prop("HMI_CHILLER1"),imageUrl:g("chiller1.png"),categoryName:"Null",className:"Image",images:{red:g("chiller1_Red.png"),blue:g("chiller1_Blue.png"),yellow:g("chiller1_Yellow.png"),green:g("chiller1_Green.png")}},{value:"HMI_CHILLER2",text:t.prop("HMI_CHILLER2"),imageUrl:g("chiller2.png"),categoryName:"Null",className:"Image",images:{red:g("chiller2_Red.png"),blue:g("chiller2_Blue.png"),yellow:g("chiller2_Yellow.png"),green:g("chiller2_Green.png")}},{value:"HMI_GENERATOR",text:t.prop("HMI_GENERATOR"),imageUrl:g("Generator/Generator1.png"),categoryName:"Generator",images:{gray_rotate:g("Generator/Generator1_ani.gif"),red_stop:g("Generator/Generator1_Red.png"),red_rotate:g("Generator/Generator1_ani_Red.gif"),blue_stop:g("Generator/Generator1_Blue.png"),blue_rotate:g("Generator/Generator1_ani_Blue.gif"),green_stop:g("Generator/Generator1_Green.png"),green_rotate:g("Generator/Generator1_ani_Green.gif"),yellow_stop:g("Generator/Generator1_Yellow.png"),yellow_rotate:g("Generator/Generator1_ani_Yellow.gif")}},{value:"HMI_TANK_GREY",text:t.prop("HMI_TANK"),imageUrl:g("Tank/Tank_Grey.png"),categoryName:"Tank",images:y,oldImages:[g("Tank/Tank_Blue.png"),g("Tank/Tank_Red.png")]},{value:"HMI_WATER_TANK",text:t.prop("HMI_WATER_TANK"),imageUrl:g("WaterTank/WaterTank_Gray0.png"),categoryName:"WaterTank",images:A},{value:"HMI_GAUGE",text:t.prop("HMI_GAUGE"),imageUrl:g("Guage_N_00.png"),categoryName:"Tank",images:I},{value:"HMI_METER",text:t.prop("HMI_METER"),imageUrl:g("Meter_N_00.png"),categoryName:"Tank",images:E}]},{text:t.prop("HMI_ELEMENT_POWER_LIGHTS"),groupName:"powerGraphicImage",className:"Animation",items:[{value:"HMI_POWER_GRAPHIC_TRANSFORMER_1",text:t.prop("HMI_POWER_GRAPHIC_TRANSFORMER_1"),imageUrl:g("Power/Transformer_N_OFF.png"),categoryName:"Default",images:G},{value:"HMI_POWER_GRAPHIC_TRANSFORMER_2",text:t.prop("HMI_POWER_GRAPHIC_TRANSFORMER_2"),imageUrl:g("Power/Transformer1_N_OFF.png"),categoryName:"Default",images:V},{value:"HMI_POWER_GRAPHIC_CONDENSOR",text:t.prop("HMI_POWER_GRAPHIC_CONDENSOR"),imageUrl:g("Power/Condenser_N_OFF.png"),categoryName:"Default",images:M},{value:"HMI_POWER_GRAPHIC_GROUND",text:t.prop("HMI_POWER_GRAPHIC_GROUND"),imageUrl:g("Power/Ground_N_OFF.png"),categoryName:"Default",images:H},{value:"HMI_POWER_GRAPHIC_SWITCH",text:t.prop("HMI_POWER_GRAPHIC_SWITCH"),imageUrl:g("Power/Switch_N_OFF.png"),categoryName:"Default",images:U},{value:"HMI_POWER_GRAPHIC_JUMPER",text:t.prop("HMI_POWER_GRAPHIC_JUMPER"),imageUrl:g("Power/CB_N_OFF.png"),categoryName:"Default",images:B},{value:"HMI_POWER_GRAPHIC_TEXT",text:t.prop("HMI_POWER_GRAPHIC_TEXT"),imageUrl:g("Power/Description_N_OFF.png"),categoryName:"Default",images:P},{value:"HMI_POWER_ALTS_ATS",text:t.prop("HMI_POWER_ALTS_ATS"),imageUrl:g("Power/ALTS_N_OFF.png"),categoryName:"LED",className:"Animation",images:R},{value:"HMI_POWER_LBS",text:t.prop("HMI_POWER_LBS"),imageUrl:g("Power/LBS_N_OFF.png"),categoryName:"LED",className:"Animation",images:F},{value:"HMI_POWER_VCB",text:t.prop("HMI_POWER_VCB"),imageUrl:g("Power/VCB_N_OFF.png"),categoryName:"LED",className:"Animation",images:W},{value:"HMI_POWER_MCCB",text:t.prop("HMI_POWER_MCCB"),imageUrl:g("Power/MCCB_N_OFF.png"),categoryName:"LED",className:"Animation",images:k},{value:"HMI_POWER_ACB",text:t.prop("HMI_POWER_ACB"),imageUrl:g("Power/ACB_N_OFF.png"),categoryName:"LED",className:"Animation",images:N},{value:"HMI_POWER_GRAPHIC_FLUORESCENT_LAMP",text:t.prop("HMI_POWER_GRAPHIC_FLUORESCENT_LAMP"),imageUrl:g("Power/Light_Fluorescent_N_OFF.png"),categoryName:"LED",className:"Animation",images:D},{value:"HMI_INCANDESCENT_LIGHT",text:t.prop("HMI_INCANDESCENT_LIGHT"),imageUrl:g("Power/Light_Incandescent_N_OFF.png"),categoryName:"LED",className:"Animation",images:x},{value:"HMI_OUTDOOR_LIGHT",text:t.prop("HMI_OUTDOOR_LIGHT"),imageUrl:g("Power/Light_Outdoor_N_OFF.png"),categoryName:"LED",className:"Animation",images:w},{value:"HMI_POWER_GRAPHIC_FLUORESCENT_LAMP_DIMMING",text:t.prop("HMI_POWER_GRAPHIC_FLUORESCENT_LAMP_DIMMING"),imageUrl:g("Power/Light_Fluorescent_N_00.png"),categoryName:"Dimming",className:"Animation",images:S},{value:"HMI_INCANDESCENT_LIGHT_DIMMING",text:t.prop("HMI_INCANDESCENT_LIGHT_DIMMING"),imageUrl:g("Power/Light_Incandescent_N_00.png"),categoryName:"Dimming",className:"Animation",images:O},{value:"HMI_OUTDOOR_LIGHT_DIMMING",text:t.prop("HMI_OUTDOOR_LIGHT_DIMMING"),imageUrl:g("Power/Light_Outdoor_N_00.png"),categoryName:"Dimming",className:"Animation",images:L}]},{text:t.prop("HMI_ELEMENT_DEVICES"),groupName:"facilityGraphicAnimation",className:"Animation",items:[{value:"HMI_SAC_INDOOR",text:t.prop("HMI_SAC_INDOOR"),imageUrl:g("dvc630/dvc630-4way-per-off.png"),categoryName:"Indoor",className:"Indoor"},{value:"HMI_SAC_INDOOR_SUMMARY",text:t.prop("HMI_SAC_INDOOR_SUMMARY"),imageUrl:g("dvc630/dvc630-4way-per-off.png"),categoryName:"Indoor",className:"Indoor"},{value:"HMI_SAC_INDOOR_GENERAL",text:t.prop("HMI_SAC_INDOOR_GENERAL"),imageUrl:g("dvc630/dvc630-4way-per-off.png"),categoryName:"Indoor",className:"Indoor"},{value:"HMI_MOTION_SENSOR",text:t.prop("HMI_MOTION_SENSOR"),imageUrl:g("dvc630/dvc630-motionsensor-gray-off.png"),categoryName:"Coil",className:"Animation",images:m},{value:"HMI_DOOR_SENSOR",text:t.prop("HMI_DOOR_SENSOR"),imageUrl:g("dvc630/dvc630-doorsensor-gray-off.png"),categoryName:"Coil",className:"Animation",images:_},{value:"HMI_TEMPERATURE_SENSOR",text:t.prop("HMI_TEMPERATURE_SENSOR"),imageUrl:g("dvc630/dvc630-tempsensor-gray-on01.png"),categoryName:"Tank",className:"Animation",images:p},{value:"HMI_HUMIDITY_SENSOR",text:t.prop("HMI_HUMIDITY_SENSOR"),imageUrl:g("dvc630/dvc630-humsensor-gray-on01.png"),categoryName:"Tank",className:"Animation",images:u}]},{text:t.prop("HMI_ELEMENT_STATISTICS"),groupName:"statistics",items:[{value:"facilityOperation",text:t.prop("HMI_STATISTICS_INDOOR"),imageUrl:g("Chart/chart_indoor.png"),categoryName:"Null",className:"StatisticsFacilityOperation"},{value:"buildingOperationStatus",text:t.prop("HMI_STATISTICS_INDOOR_BUILDING"),imageUrl:g("Chart/chart_indoor_building.png"),categoryName:"Building",className:"StatisticsBuildingOperation"}]},{text:t.prop("HMI_ELEMENT_MISC"),groupName:"facilityGraphicAnimation",className:"Animation",items:[{value:"HMI_WIND_1",text:t.prop("HMI_WIND_1"),imageUrl:g("wind/wind1/wind1HorzLIcon.jpg"),categoryName:"Wind",images:{on:g("wind/wind1/ani/wind1HorzL1.gif")}},{value:"HMI_WIND_2",text:t.prop("HMI_WIND_2"),imageUrl:g("wind/wind2/wind2HorzIcon.jpg"),categoryName:"Wind",images:{on:g("wind/wind2/ani/wind2Horz1.gif")}},{value:"HMI_WIND_3",text:t.prop("HMI_WIND_3"),imageUrl:g("wind/wind3/wind3HorzLIcon.jpg"),categoryName:"Wind",images:{on:g("wind/wind3/ani/wind3HorzL1.gif")}},{value:"HMI_WIND_4",text:t.prop("HMI_WIND_4"),imageUrl:g("wind/wind4/wind4HorzL5.png"),categoryName:"Wind",images:{on:g("wind/wind4/ani/wind4HorzL1.gif")}},{value:"HMI_STEAM_L",text:t.prop("HMI_STEAM_L"),imageUrl:g("Steam/Steam_L_N.png"),categoryName:"Steam",images:{on:g("Steam/ani/Steam_L.gif")}},{value:"HMI_STEAM_R",text:t.prop("HMI_STEAM_R"),imageUrl:g("Steam/Steam_R_N.png"),categoryName:"Steam",images:{on:g("Steam/ani/Steam_R.gif")}},{value:"HMI_ARROW_GRAY",text:t.prop("HMI_ARROW"),imageUrl:g("Arrow/arrow_gray.png"),categoryName:"Null",className:"Image",images:{red:g("Arrow/arrow_red.png"),blue:g("Arrow/arrow_blue.png"),yellow:g("Arrow/arrow_yellow.png"),green:g("Arrow/arrow_green.png")}},{value:"HMI_ARROW_GRAY_L",text:t.prop("HMI_ARROW_L"),imageUrl:g("Arrow/arrow_gray_L.png"),categoryName:"Null",className:"Image",images:{red:g("Arrow/arrow_red_L.png"),blue:g("Arrow/arrow_blue_L.png"),yellow:g("Arrow/arrow_yellow_L.png"),green:g("Arrow/arrow_green_L.png")}}]}],Y={Cool:g("ic-cool.png"),Auto:g("ic-auto.png"),Heat:g("ic-heat.png"),Dry:g("ic-dry.png"),Fan:g("ic-fan.png"),Off:g("ic-attention.png"),CoolStorage:g("ic-coolwater.png"),HotWater:g("ic-hotwater.png"),HeatExchange:g("ic-heat-ex.png"),ByPass:g("ic-heat-bypass.png"),Sleep:g("ic-heat-sleep.png"),Eco:g("ic-dhw-eco.png"),Standard:g("ic-dhw-standard.png"),Power:g("ic-dhw-power.png"),Force:g("ic-dhw-force.png")},X={Cassette1Way:{Top:{"normal-on":g("/dvc630/dvc630-1way-top-on.png"),"normal-off":g("/dvc630/dvc630-1way-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-1way-per-on.png"),"normal-off":g("/dvc630/dvc630-1way-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-1way-fro-on.png"),"normal-off":g("/dvc630/dvc630-1way-fro-off.png")}},Cassette2Way:{Top:{"normal-on":g("/dvc630/dvc630-2way-top-on.png"),"normal-off":g("/dvc630/dvc630-2way-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-2way-per-on.png"),"normal-off":g("/dvc630/dvc630-2way-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-2way-fro-on.png"),"normal-off":g("/dvc630/dvc630-2way-fro-off.png")}},Cassette4Way:{Top:{"normal-on":g("/dvc630/dvc630-4way-top-on.png"),"normal-off":g("/dvc630/dvc630-4way-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-4way-per-on.png"),"normal-off":g("/dvc630/dvc630-4way-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-4way-fro-on.png"),"normal-off":g("/dvc630/dvc630-4way-fro-off.png")}},Cassette360:{Top:{"normal-on":g("/dvc630/dvc630-360-top-on.png"),"normal-off":g("/dvc630/dvc630-360-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-360-per-on.png"),"normal-off":g("/dvc630/dvc630-360-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-360-fro-on.png"),"normal-off":g("/dvc630/dvc630-360-fro-off.png")}},Bottom:{Top:{"normal-on":g("/dvc630/dvc630-bottom-top-on.png"),"normal-off":g("/dvc630/dvc630-bottom-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-bottom-per-on.png"),"normal-off":g("/dvc630/dvc630-bottom-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-bottom-fro-on.png"),"normal-off":g("/dvc630/dvc630-bottom-fro-off.png")}},PAC:{Top:{"normal-on":g("/dvc630/dvc630-pac-top-on.png"),"normal-off":g("/dvc630/dvc630-pac-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-pac-per-on.png"),"normal-off":g("/dvc630/dvc630-pac-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-pac-fro-on.png"),"normal-off":g("/dvc630/dvc630-pac-fro-off.png")}},Duct:{Top:{"normal-on":g("/dvc630/dvc630-duct_fresh-top-on.png"),"normal-off":g("/dvc630/dvc630-duct_fresh-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-duct_fresh-per-on.png"),"normal-off":g("/dvc630/dvc630-duct_fresh-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-duct_fresh-fro-on.png"),"normal-off":g("/dvc630/dvc630-duct_fresh-fro-off.png")}},Chiller:{Top:{"normal-on":g("/dvc630/dvc630-chiller-top-on.png"),"normal-off":g("/dvc630/dvc630-chiller-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-chiller-per-on.png"),"normal-off":g("/dvc630/dvc630-chiller-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-chiller-fro-on.png"),"normal-off":g("/dvc630/dvc630-chiller-fro-off.png")}},ERV:{Top:{"normal-on":g("/dvc630/dvc630-erv-top-on.png"),"normal-off":g("/dvc630/dvc630-erv-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-erv-per-on.png"),"normal-off":g("/dvc630/dvc630-erv-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-erv-fro-on.png"),"normal-off":g("/dvc630/dvc630-erv-fro-off.png")}},Ceiling:{Top:{"normal-on":g("/dvc630/dvc630-ceiling-top-on.png"),"normal-off":g("/dvc630/dvc630-ceiling-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-ceiling-per-on.png"),"normal-off":g("/dvc630/dvc630-ceiling-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-ceiling-fro-on.png"),"normal-off":g("/dvc630/dvc630-ceiling-fro-off.png")}},Console:{Top:{"normal-on":g("/dvc630/dvc630-console-top-on.png"),"normal-off":g("/dvc630/dvc630-console-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-console-per-on.png"),"normal-off":g("/dvc630/dvc630-console-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-console-fro-on.png"),"normal-off":g("/dvc630/dvc630-console-fro-off.png")}},AHU:{Top:{"normal-on":g("/dvc630/dvc630-ahu-top-on.png"),"normal-off":g("/dvc630/dvc630-ahu-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-ahu-per-on.png"),"normal-off":g("/dvc630/dvc630-ahu-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-ahu-fro-on.png"),"normal-off":g("/dvc630/dvc630-ahu-fro-off.png")}},FCUKit:{Top:{"normal-on":g("/dvc630/dvc630-fcu-top-on.png"),"normal-off":g("/dvc630/dvc630-fcu-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-fcu-per-on.png"),"normal-off":g("/dvc630/dvc630-fcu-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-fcu-fro-on.png"),"normal-off":g("/dvc630/dvc630-fcu-fro-off.png")}},Single:{Top:{"normal-on":g("/dvc630/dvc630-ehs-top-on.png"),"normal-off":g("/dvc630/dvc630-ehs-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-ehs-per-on.png"),"normal-off":g("/dvc630/dvc630-ehs-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-ehs-fro-on.png"),"normal-off":g("/dvc630/dvc630-ehs-fro-off.png")}},DVMHE:{Top:{"normal-on":g("/dvc630/dvc630-ehs_dvm-top-on.png"),"normal-off":g("/dvc630/dvc630-ehs_dvm-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-ehs_dvm-per-on.png"),"normal-off":g("/dvc630/dvc630-ehs_dvm-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-ehs_dvm-fro-on.png"),"normal-off":g("/dvc630/dvc630-ehs_dvm-fro-off.png")}},DVMHT:{Top:{"normal-on":g("/dvc630/dvc630-ehs_s-top-on.png"),"normal-off":g("/dvc630/dvc630-ehs_s-top-off.png")},Perspective:{"normal-on":g("/dvc630/dvc630-ehs_s-per-on.png"),"normal-off":g("/dvc630/dvc630-ehs_s-per-off.png")},Front:{"normal-on":g("/dvc630/dvc630-ehs_s-fro-on.png"),"normal-off":g("/dvc630/dvc630-ehs_s-fro-off.png")}}},Z=function(e,t){e.imageWidth=this.width,e.imageHeight=this.height,t.resolve()},j=function(e,t){e.imageWidth=50,e.imageHeight=50,t.resolve()};return{paletteDataSource:z,getPaletteDataSource:function(){var e,t,i,n,o,a,r,l,s,d,c,p=z.length,g=[],h=new $.Deferred,u=[];for(e=0;e<p;e++)"basicShape"!=(n=z[e]).groupName&&u.push(z[e]);for(e=0;e<p;e++)for(r=(n=z[e]).className,l=n.categoryName,s=n.groupName,i=(o=n.items).length,t=0;t<i;t++)(a=o[t]).className||(a.className=r),a.categoryName||(a.categoryName=l),a.groupName=s,d=new Image,c=new $.Deferred,a.addBuildDateQueryUrl=f.addBuildDateQuery(a.imageUrl),d.src=f.addBuildDateQuery(a.imageUrl),d.onload=Z.bind(d,a,c),d.onerror=j.bind(d,a,c),g.push(c);return $.when.apply(this,g).always(function(){for(p=u.length,e=0;e<p;e++)(o=u[e].items).sort(function(e,t){return e=e.text,t=t.text,e.localeCompare(t)});h.resolve(u)}),h.promise()},getData:function(e,t){(t=t||z)instanceof h.data.DataSource&&(t=t.data());var i,n,o,a,r,l=t.length;for(i=0;i<l;i++)for(o=(a=t[i].items).length,n=0;n<o;n++)if((r=a[n]).value==e)return r;return null},getDataWithImagePath:function(e,t){(t=t||z)instanceof h.data.DataSource&&(t=t.data());var i,n,o,a,r,l,s,d,c,p,g=t.length;for(e&&(-1!=e.indexOf("../asset/icons")?e=e.replace("../asset/icons",""):-1!=e.indexOf("../../src/main/resources/static-dev/asset/icons")?e=e.replace("../../src/main/resources/static-dev/asset/icons",""):-1!=e.indexOf("../../src/main/resources/static-dev/images/icon")&&(e=e.replace("../../src/main/resources/static-dev/images/icon",""))),i=0;i<g;i++)for(r=(s=t[i].items).length,n=0;n<r;n++){if(c=(d=s[n]).images,-1!=d.imageUrl.indexOf(e))return d;for(a in c)if(-1!=c[a].indexOf(e))return d;if(p=d.oldImages)for(l=p.length,o=0;o<l;o++)if(-1!=p[o].indexOf(e))return d}return null},getStateImage:function(e,t,i,n,o){var a,r=e.imageUrl,l=e.images,s=e.categoryName;e.canvas;return i?c.hasColorGraphic(e)&&(a=n||C(i,t))&&(t=a+"_"+t):t&&n?t=n+"_"+t:n&&(t=n),l&&l[t]&&(r=l[t]),o==d.INITIAL_HMI_VERSION&&c.isLegacyGraphic(i)&&("Coil"==s&&"off"==t&&(r=e.imageUrl),r=r.replace("/images/icon","/asset/icons")),r},getIconUrl:g,getColorFromPath:C,indoorModeImages:Y,deviceStatusColors:{"normal-on":"rgb(26,160,90)","normal-off":"#b2b2b2","alarm-warning":"rgb(255,164,31)","alarm-critical":"rgb(239,43,43)"},indoorDeviceImages:X}}),define("hmi/config/rappid-canvas",["hmi/hmi-common","hmi/hmi-util","hmi/config/popup-config","hmi/config/palette-config","hmi/config/rappid-element","hmi/config/rappid-extended-class"],function(C,_,l,e,v,t){"use strict";var b=l.msgDialog,o=window.kendo,s=window.I18N,d=_.Loading,g=window.localStorage,E=C.toastPopup,a=window._,T=window.g,I=window.joint,y=I.util.normalizeEvent,c=t.Graph,p=t.Paper,h=t.Selection,u=t.CommandManager,r=t.FreeTransform,f=t.TextEditor,m=t.PaperScroller,i=o.Class.extend({options:{editable:!1,createView:null,wrapper:null},init:function(e,t,i){var a=this;a.options=$.extend(!0,{},a.options,i),a.element=e,a.isEditable=a.options.editable,a.createView=a.options.createView,a.baseCanvas=a.options.baseCanvas,a.wrapper=a.options.wrapper,a.graph=this.options.model=a.options.model?a.options.model:new c;var n=a.options.gridSize?a.options.gridSize:C.DEFAULT_GRID_WIDTH,o=a.options.width,r=a.options.height,l=a.paper=new p({el:a.element.get(0),model:a.graph,width:o,height:r,gridSize:n,restrictTranslate:function(){return{x:0,y:0,width:C.DEFAULT_CANVAS_WIDTH,height:C.DEFAULT_CANVAS_HEIGHT}},drawGrid:a.isEditable?"mesh":null,interactive:!1});((a.graph._paper=l)._canvas=a).graph.on({add:function(){a.reorderZOrder(this.getElements()),a.updateSaveState()},remove:function(){a._isClearing||(a.reorderZOrder(this.getElements()),a.updateSaveState())},change:function(){a._isPreventUpdate||a.updateSaveState()},"transform:rotate":function(t,e){var i,n=e-((t._previousAttributes||{}).angle||0);a.models.forEach(function(e){e!=t&&(i=e.angle(),e.rotate(i+n,!0))})}});var s=a.paperScroller=new m({paper:l,contentOptions:{allowNewOrigin:"positive"},cursor:"grab",padding:{left:0,top:0,right:0,bottom:0}});this.wrapper.append(s.el),s.render(),s.on("scroller:mousewheel",function(e){e.preventDefault();var t=a.getPaperOffsetWithMouseEvent(e);e.deltaY<0?a.zoomOut(t):0<e.deltaY&&a.zoomIn(t)}),l.on("blank:pointerdown",function(e){e.shiftKey||s.startPanning(e),f.close()}),s.on("pan:stop",function(e){var t=s.getVisibleArea();a._scrollTop=e.scrollTop+t.height/2,a._scrollLeft=e.scrollLeft+t.width/2}),a.isEditable?(a.snaplines=new I.ui.Snaplines({paper:l}),s.center(),a.isCreateShape=!1,a.isCreateMoving=!1,a.selection=new h({paper:l,strictSelection:!0,useModelGeometry:!0,filter:function(e){return e.prop("binding/locked")},createView:a.createView}),a.models=a.selection.collection,l.on("blank:pointerdown",function(e){a.createView.getColorPickerOpenedState()||(!a.isCreateShape&&e.shiftKey?a.selection.startSelecting(e):e.shiftKey||a.selection.cancelSelection())}),l.on("element:pointerdown",function(e,t){if(!a.createView.getColorPickerOpenedState()){var i=!!e.model&&e.model.prop("binding/locked");if(!a.isCreateShape&&t.shiftKey&&i)a.selection.startSelecting(t);else{a.createSelectionPoint(e,t),t.shiftKey||(a.clearTableCellSelect(),a.models.reset([]));var n=!1,o=a.models;a.isCreateShape||(0==o.length?o.add(e.model):(o.forEach(function(e){e.prop("binding/locked")&&(n=!0)}),n==i&&o.add(e.model)))}}}),l.on("selection:changed",function(){a.createView.updateToolbarButtonState(),a.updateBindingTabState()}),l.on("selection:cancelSelection",a.clearTableCellSelect.bind(a,!0)),a.selection.on("selection-box:pointerdown",function(e,t){if(t.shiftKey){var i=e.model;if(a.models.remove(i),i.prop("binding/locked"))return void a.selection.startSelecting(t)}}),this.clipboard=new I.ui.Clipboard,this.commandManager=new u({graph:a.graph,createView:a.createView,cmdBeforeAdd:function(e,t,i,n){return-1==(n&&n.propertyPath||"").indexOf("info/href")&&("change:series"!=e&&!(a._isGraphicLoading||a._isPollingUpdate||a._isBackground||a._isClearing))}}),this.keyboard=new I.ui.Keyboard,this.attachKeyboardEvt(),l.on("element:table-cell:click",function(e,t){var i=e.model;i&&i.trigger("element:table-cell:click",e,t)}),l.on("element:table-resize:click",function(e,t){var i=e.model;i&&i.trigger("element:table-resize:click",e,t)}),l.on("element:table-selection:changed",function(){a.createView.updateToolbarButtonState()}),l.on("element:zone-name:click",function(e,t){var i=e.model;i&&i.trigger("element:zone-name:click",e,t)})):(l.on("element:pointerdown",function(e,t){var i=e.model,n=i.prop("binding/type");"ScaleBar"!=n&&"Zone"!=n?s.startPanning(t):(a._isDragging="ScaleBar"!=i.prop("binding/type"),a._dragStartEvt=t)}),l.on("element:pointermove",function(e,t){a._isDragging&&!a._isPanning&&.1<Math.abs(a._dragStartEvt.clientX-t.clientX)&&.1<Math.abs(a._dragStartEvt.clientY-t.clientY)&&(s.startPanning(a._dragStartEvt),a._isPanning=!0)}),l.on("element:pointerup",function(e){a._isDragging=!1;var t=e.model;a._isPanning||"Zone"!=t.prop("binding/type")||t.toggleZoneSelect(),a._isPanning=!1})),a._attachCanvasEvt()},setBackground:function(e){var t=this;if(e&&"none"!=e)-1!==(e=_.updateOldImagePath(e)).indexOf("url(")&&(e=(e=(e=e.replace('url("',"")).replace('")',"")).replace("../../src/main/resources/static-dev/asset/icons","../../src/main/resources/static-dev/images/icon")),t.backgroundImageData=e,t.paper.drawBackground({image:this.backgroundImageData}),t.updateSaveState();else{t.backgroundImageData=null;var i=t.isEditable?"#ffffff":"#f1f1f1";t.paper.drawBackground({image:null,color:i,position:{x:0,y:0}})}},updateSaveState:function(e){var t=this.isEditable,i=this.createView;t&&(i.updateEditState(e),i.updateSaveButtonState())},setVersion:function(e){this.version=e},_attachCanvasEvt:function(){var o=this;o.paper.on("element:pointerclick",function(e,t){var i=e.model;i&&i.trigger("event:pointerclick",e,t)}),o.paper.on("element:pointerdblclick",function(e,t){var i=e.model;i&&i.trigger("event:pointerdblclick",e,t)}),o.paper.on("element:pointerdown",function(e,t){var i=e.model,n=o.paper.snapToGrid(t.clientX,t.clientY);i&&i.trigger("event:pointerdown",e,t,n)}),o.paper.on("element:contextmenu",function(e,t){var i=e.model;i&&i.trigger("event:contextmenu",e,t)}),o.paper.on("element:pointermove",function(e,t){var i=e.model,n=o.paper.snapToGrid(t.clientX,t.clientY);i&&i.trigger("event:pointermove",e,t,n)}),o.paper.on("element:pointerup",function(e,t){var i=e.model;i&&i.trigger("event:pointerup",e,t)}),o.paper.on("element:mouseover",function(e,t){var i=e.model;i&&i.trigger("event:mouseover",e,t)}),o.paper.on("element:mouseout",function(e,t){var i=e.model;i&&i.trigger("event:mouseout",e,t)}),o.paper.on("element:mouseenter",function(e,t){var i=e.model;i&&i.trigger("event:mouseenter",e,t)}),o.paper.on("event:hyperlink:click",function(e){if(!o.isEditable){var t=e.model.prop("binding/file");o.createView.onHyperLinkClickEvt(t)}}),o.paper.on("afterCommand",function(e){o.commandManager&&o.commandManager.stopListening(),o.models.reset([]),o.selection.cancelSelection();var t,i,n=e.length;for(t=0;t<n;t++)i=e[t],o.createSelectionPoint(i.findView(o.paper),{shiftKey:!0}),o.models.add(i);o.commandManager&&o.commandManager.listen()})},attachKeyboardEvt:function(){var n=this;this.keyboard.off(),this.keyboard.on({"shift+left":function(e){n.unitResize("left")},"shift+up":function(e){n.unitResize("up")},"shift+right":function(e){n.unitResize("right")},"shift+down":function(e){n.unitResize("down")},left:function(e){n.moveLeft()},up:function(e){n.moveUp()},right:function(e){n.moveRight()},down:function(e){n.moveDown()},F2:function(e){e.preventDefault();var t=n.getActiveModel();if(t&&"Label"==t.prop("binding/type")){var i=t.findView(n.paper);t.edit(i,i.el)}},"ctrl+z command+z":function(e){n.commandManager.hasUndo()&&n.undo(e)},"ctrl+y command+y":function(e){n.commandManager.hasRedo()&&n.redo(e)},"ctrl+c command+c":function(e){n.copyClipboard()},"ctrl+x command+x":function(e){n.copyClipboard(),n.remove()},"ctrl+v command+v":function(e){n.pasteClipboard()},"ctrl+d command+d":function(e){e.preventDefault(),n.copyClipboard(),n.pasteClipboard()},"ctrl+g command+g":function(e){e.preventDefault(),n.group()},"ctrl+u command+u":function(e){e.preventDefault(),n.ungroup()},"ctrl+a command+a":function(e){e.preventDefault(),n.selectAll()},"ctrl+l command+l":function(e){e.preventDefault(),n.models&&0<n.models.length&&n.changeLock(!0)},"ctrl+o command+o":function(e){e.preventDefault(),n.models&&0<n.models.length&&n.changeLock(!1)},"ctrl+s command+s":function(e){e.preventDefault(),n.createView.clickSaveBtnEvt()},delete:function(e){n.remove()}})},setDimension:function(e,t){this.paper.setDimensions(e,t)},load:function(e,t){this._isGraphicLoading=!0,t.cells&&this.graph.fromJSON(t);var i=this.commandManager;i&&i.reset(),this._isGraphicLoading=!1},save:function(){var e=new $.Deferred,t=this.graph.toJSON();return e.resolve(t),e.promise()},exportPNG:function(){},exportSVG:function(){},saveBackgroundImageData:function(e){e.backgroundImageData=t.backgroundImageData;var t=this},getGraphicDeviceInfo:function(){var e,t,i,n,o,a=0,r=0,l=0,s=0,d=g.getItem("hmiCanvas")||"{}",c=$(this.element).attr("id"),p=(e=this._isBackground?(d=JSON.parse(d))[c]&&d[c].cells||[]:(e=this.graph.get("cells")).models||[],[]);return e.forEach(function(e){t=e.get&&e.get("type")||e.type,n=e.prop&&e.prop("binding")||e.binding,i="function"==typeof e.angle?e.angle():e.angle,o=n.device,"hmi.Group"==t?s++:o&&o.id?(a++,p.push(o.id)):0!=i?l++:r++}),{ids:p,cntBindingObjects:a,cntVectorGraphicObjects:r,cntGroupedObjects:s,cntRotatedObjects:l,totalFiguresSize:a+r+s+l}},updateCanvasInPolling:function(e){var n,o,a,t,r,l,s,i=g.getItem("hmiCanvas")||"{}",d=$(this.element).attr("id"),c=this._isBackground;this._isPollingUpdate=!0,(t=c?(i=JSON.parse(i))[d]&&i[d].cells||[]:(t=this.graph.get("cells")).models||[]).forEach(function(i){if("hmi.Group"==(i.get&&i.get("type")||i.type))return!0;l=i.prop&&i.prop("binding")||i.binding,s=i.prop&&i.prop("binding/device")||l.device||{},r=!1,$.each(e,function(e,t){if(n=t.id,o=_.getDeviceInfo(t),a=o.value,t.invalid=_.isInvalidDevice(t),s.id==n)return r=!0,"Indoor"==l.type?c?l.device=t:i.prop("binding/device",t):(i.getValue&&i.getValue()||window.Util.convertNumberFormat(l.value),i.setValue?i.setValue(a,!0):l.value=a),c?l.device.invalid=t.invalid:i.prop("binding/device/invalid",t.invalid),!1}),r||(c?l.device.invalid=!0:i.prop("binding/device/invalid",!0))}),this._isBackground&&(i[d]||(i[d]={}),i[d].cells=t,g.setItem("hmiCanvas",JSON.stringify(i))),this._isPollingUpdate=!1},import:function(o){var a=this,r=new $.Deferred;return _.getJSONFileData(d).done(function(e,t){var i=e.name;i.match(".json$","i")||(b.message(s.prop("HMI_UNSUPPORTED_JSON_TYPE")),b.open()),o.element.val(i);try{var n=JSON.parse(t);a.graph.fromJSON(n),r.resolve()}catch(e){b.message(s.prop("HMI_UNSUPPORTED_JSON_TYPE")),b.open(),r.reject()}}),r.promise()},export:function(e){d.open();var t=this.graph.toJSON(),i=JSON.stringify(t);e=e||"file",e+=".json";var n=new Blob([i],{type:"application/json"});o.saveAs({dataURI:n,fileName:e}),d.close()},onDrop:function(e){var t=e.item;t?t.clickable||this.addPaletteItem(e,t):console.error("there is no palette item when drag & drop.")},addPaletteItem:function(e,t){var i=this;e.sender.element.blur();var n=t.className,o=v[n];if(o){i.selection.cancelSelection(),i.cancelCreateBasicShape&&i.cancelCreateBasicShape(),i.cancelCreateBasicShape=null,i.commandManager.initBatchCommand();var a=i.getPaperOffsetWithMouseEvent(e),r=new o($.extend({},e.options,{paletteItem:t,offset:a}));r.addTo(i.graph),r.trigger("graph:add",r,r.collection,{add:!0,remove:!1,merge:!1});var l=r.getBBox(),s=l.x,d=l.y;return s+l.width>C.DEFAULT_CANVAS_WIDTH&&(s=C.DEFAULT_CANVAS_WIDTH-l.width),d+l.height>C.DEFAULT_CANVAS_HEIGHT&&(d=C.DEFAULT_CANVAS_HEIGHT-l.height),s==l.x&&d==l.y||r.position(s,d,{preventSetGridPoint:!0}),i.commandManager.storeBatchCommand(),r}console.error("there is no Element class "+n)},onPaletteClick:function(e){var t=e.item;"basicShape"==t.groupName?this.createbasicShape(t):console.error("there is no palette item when drag & drop.")},onPaletteDoubleClick:function(e){var t,i=this,n=e.item,o=n.groupName,a="facilityGraphicImage"==o||"facilityGraphicAnmiation"==o,r=i.models.models;if(i.commandManager.initBatchCommand(),n&&a&&0<r.length){var l=i.getActiveModel(),s=l.getBBox(),d=s.x,c=s.y,p=l.prop("binding"),g=e.options?e.options.binding:{},h=$.extend(!0,{},p,g);e.pos={x:d,y:c},e.options={angle:l.angle(),size:{width:s.width,height:s.height},position:{x:d,y:c},binding:h},l.remove(),i.addPaletteItem(e,n)}else{e.options?e.options.position={x:0,y:0}:e.options={position:{x:0,y:0}},t=i.addPaletteItem(e,n);var u=i.getNewModelPosition(t);t.position(u.x,u.y)}i.commandManager.storeBatchCommand()},getNewModelPosition:function(e){var t=C.DEFAULT_CANVAS_WIDTH,i=C.DEFAULT_CANVAS_HEIGHT;this._newModelcenterX?this._newModelcenterX+=20:this._newModelcenterX=t/2,this._newModelcenterY?this._newModelcenterY+=20:this._newModelcenterY=i/2;var n=e.getBBox(),o=this._newModelcenterX-n.width/2,a=this._newModelcenterY-n.height/2;return(o+n.width>=t-1||a+n.height>=i-1||o<1||a<1)&&(this._newModelcenterX=n.width/2+1,this._newModelcenterY=n.height/2+1,a=o=1),{x:o,y:a}},setCursor:function(e){"crosshair"==e?this.paperScroller.setCursor(e):e?this.paperScroller.setCursor("url(../../src/main/resources/static-dev/images/icon/cursors/"+e+") 0 0, default"):this.paperScroller.setCursor("default")},getToolbarButtonDisabledState:function(){var e=this.getActiveModel(),t=this.models||[],i=t.length,r=[];t.forEach(function(e){var t=e.prop("binding/type");-1==r.indexOf(t)&&r.push(t)});var n={binding:!0,lock:{disabled:!0,value:!1},background:!1,fill:{disabled:!0},lineColor:{disabled:!0},lineWidth:{disabled:!0,value:1},group:!0,ungroup:!0,fontSize:{disabled:!0,value:C.DEFAULT_FONT_SIZE},bold:{disabled:!0,value:!1},italic:{disabled:!0,value:!1},fontColor:{disabled:!0},textHAlign:{disabled:!0,value:C.DEFAULT_TEXT_H_ALIGN},textVAlign:{disabled:!0,value:C.DEFAULT_TEXT_V_ALIGN},bringForward:!0,sendBackward:!0,bringTop:!0,sendBottom:!0,matchSize:!0,matchWidth:!0,matchHeight:!0,alignLeft:!0,alignHcenter:!0,alignRight:!0,alignTop:!0,alignVcenter:!0,alignBottom:!0,alignHGap:!0,alignVGap:!0,flipV:!0,flipH:!0,rotationRight:!0,rotationLeft:!0,rotation:!0,tableInsertion:!0,tableDelete:!0,mergeCell:!0,unmergeCell:!0};if(0==i)return n;var o={ungroup:["Group"],textHAlign:["Label","Table","HyperLink","ExtLabel"],textVAlign:["Label","Table","HyperLink","ExtLabel"],flipV:["BasicShape","Line","ImportImage","Image","Animation","Custom"],flipH:["BasicShape","Line","ImportImage","Image","Animation","Custom"]},a={fill:["Line","ImportImage","Button","Image","Animation","Group","Indoor","RectangleGraphic"],lineColor:["Button","Group","Indoor","Image","Animation"],lineWidth:["Button","Group","Indoor","Image","Animation"],fontSize:["BasicShape","Line","ImportImage","Zone","Image","Animation","Group","Indoor"],bold:["BasicShape","Line","ImportImage","Zone","Image","Animation","Group","Indoor"],italic:["BasicShape","Line","ImportImage","Zone","Image","Animation","Group","Indoor"],fontColor:["BasicShape","Line","ImportImage","Zone","Image","Animation","Group","Indoor"],rotationRight:["Table"],rotationLeft:["Table"],rotation:["Table"]},l=e?e.prop("binding"):{},s=!!e&&l.locked,d=e?l.type:"";if(0<i&&(n.lock.disabled=!1),s)return n.lock.value=!0,n;function c(e){var t=n[e];"object"==typeof t?t.disabled=!1:n[e]=!1}function p(e){var t=n[e];"object"==typeof t?t.disabled=!0:n[e]=!0}if(1==i&&["binding"].forEach(c),3<=i&&["alignHGap","alignVGap"].forEach(c),2<=i&&["group","matchSize","matchWidth","matchHeight"].forEach(c),1<=i&&["fill","lineColor","lineWidth","fontSize","bold","italic","fontColor","bringForward","sendBackward","bringTop","sendBottom","alignLeft","alignHcenter","alignRight","alignTop","alignVcenter","alignBottom","rotationRight","rotationLeft","rotation"].forEach(c),$.each(o,function(t,e){e.forEach(function(e){-1!=r.indexOf(e)&&c(t)})}),$.each(a,function(e,t){var i,n,o=!1,a=r.length;for(i=0;i<a;i++)n=r[i],o=o||-1==t.indexOf(n);o||p(e)}),$.each({binding:["Label","BasicShape","Line","Zone","Table","ImportImage","HyperLink","Group"],group:["Indoor"]},function(t,i){r.forEach(function(e){-1!=i.indexOf(e)&&p(t)})}),-1==a.lineWidth.indexOf(d)&&(n.lineWidth.value=l.strokeWidth||1),-1==a.bold.indexOf(d)){var g="Table"==d?e.getFontWeight():l.fontWeight,h="Table"==d?e.getFontStyle():l.fontStyle;n.bold.value="Bold"===g,n.italic.value="Italic"===h}if(-1==a.fontSize.indexOf(d)&&(n.fontSize.value=l.fontSize),-1!=o.textHAlign.indexOf(d)&&(n.textHAlign.value=e.getTextAlign("hAlign")),-1!=o.textVAlign.indexOf(d)&&(n.textVAlign.value=e.getTextAlign("vAlign")),"Table"==d){var u=e.getHighlightedCells();n.tableInsertion=1!=u.length,n.tableDelete=0==u.length,n.mergeCell=!e.isMergeable(),n.unmergeCell=!e.isUnmergeable()}return n},moveLeft:function(){var e=this.models;return this.commandManager.initBatchCommand(),e.forEach(function(e){e.prop("binding/locked")||e.translate(-1,0,{preventSetGridPoint:!0})}),this.commandManager.storeBatchCommand(),!1},moveUp:function(){var e=this.models;return this.commandManager.initBatchCommand(),e.forEach(function(e){e.prop("binding/locked")||e.translate(0,-1,{preventSetGridPoint:!0})}),this.commandManager.storeBatchCommand(),!1},moveRight:function(){var e=this.models;return this.commandManager.initBatchCommand(),e.forEach(function(e){e.prop("binding/locked")||e.translate(1,0,{preventSetGridPoint:!0})}),this.commandManager.storeBatchCommand(),!1},moveDown:function(){var e=this.models;return this.commandManager.initBatchCommand(),e.forEach(function(e){e.prop("binding/locked")||e.translate(0,1,{preventSetGridPoint:!0})}),this.commandManager.storeBatchCommand(),!1},copyClipboard:function(){var e,t,i,n=this.models,o=[],a=n.length;for(t=0;t<a;t++)"Group"==(i=n.at(t)).prop("binding/type")&&(e=i.getEmbeddedCells(),o=o.concat(e));return n.unshift(o),this.clipboard.copyElements(n,this.graph),n.remove(o),!(this.pastedCount=1)},pasteClipboard:function(){var i=this;i.commandManager.initBatchCommand();var e=this.clipboard.pasteCells(this.graph,{useLocalStorage:!0}),t=a.filter(e,function(e){return e.isElement()&&!e.parent()});this.models.reset(t),r.clear(this.paper);var n=10*i.pastedCount++;return t.forEach(function(e){e.translate(n,n),e.trigger("graph:add",e,e.collection,{add:!0,remove:!1,merge:!1});var t=i.paper.findViewByModel(e);new r({cellView:t,clearAll:!1,createView:i.createView}).render()}),i.isEditable&&i.createView.updateToolbarButtonState&&i.createView.updateToolbarButtonState(),i.commandManager.storeBatchCommand(),!1},undo:function(e){this.commandManager.undo();var t=this.isEditable,i=this.createView;return this.clearTableCellSelect(!0),t&&i.updateToolbarButtonState(),t&&!this.commandManager.hasUndo()&&this.updateSaveState(!0),e.preventDefault(),!1},redo:function(){this.commandManager.redo();var e=this.isEditable,t=this.createView;this.clearTableCellSelect(!0),e&&t.updateToolbarButtonState(),this.updateSaveState()},select:function(){var e=this;e.cancelCreateBasicShape&&e.cancelCreateBasicShape(),e.cancelCreateBasicShape=null,e.selection&&e.selection.cancelSelection()},binding:function(e){var i=this,t=i.selection.collection,n=e||t.at(0);if(n){var o=n.prop("binding/device");o.id&&o.type?(d.open(),_.DeviceApi.getDeviceWithID(o.id).done(function(e){var t=n.prop("binding/device");$.extend(t,e),t.invalid=_.isInvalidDevice(e),i.setBinding(n)}).fail(function(){var e=n.prop("binding/device");e.invalid=!0,e.locations&&(e.locations.length=0),i.setBinding(n)}).always(function(){d.close()})):i.setBinding(n)}},updateBindingTabState:function(){var e=this.createView;if(e){var t,i=this.selection.collection;if(1==i.size()){var n=(t=i.at(0)).prop("binding");e.enableBindingTab(_.canBindingType(n.type)&&!n.locked),this.binding(t)}else this._bindingElement=null,e.enableBindingTab(!1)}},setBinding:function(e){var t=this,i=e.getGraphicBindingPopupData();console.error(i);var n=t.createView,o=e.prop("binding");n&&_.canBindingType(o.type)&&!o.locked?(t._bindingElement=e,n.activateBindingTab(),t._bindingSaveEvt||(t._bindingSaveEvt=t.bindingSave.bind(t)),n.bindingPanelBar.unbind("save",t._bindingSaveEvt),n.bindingPanelBar.bind("save",t._bindingSaveEvt),n.bindingPanelBar.setActiveCanvas(t),n.bindingPanelBar.setBindingData(i)):console.error("there is no create view in this canvas.")},updateBinding:function(e){if(this._bindingElement){var t=this._bindingElement;e=e||t.getGraphicBindingPopupData();var i=this.createView,n=t.prop("binding");i&&_.canBindingType(n.type)&&!n.locked?i.bindingPanelBar.updateBindingData(e):console.error("there is no create view in this canvas.")}},bindingSave:function(e){var t=e.item,i=this.selection.collection.at(0);i&&(console.log("binding save data"),console.log(t),this.commandManager.initBatchCommand(),i.setBindingData(t),this.commandManager.storeBatchCommand())},zoomIn:function(e){var t=this.getZoomLevel();return!(t>=C.DEFAULT_MAX_ZOOM_LEVEL)&&(t+=C.DEFAULT_ZOOM_FACTOR,this.setZoomLevel(t,!1,e),!0)},zoomOut:function(e){var t=this.getZoomLevel();return!(t<=C.DEFAULT_MIN_ZOOM_LEVEL)&&(t-=C.DEFAULT_ZOOM_FACTOR,this.setZoomLevel(t,!1,e),!0)},defaultZoom:function(){this.setZoomLevel(100)},setZoomLevel:function(e,t,i){var n=this,o=!!e.dataItem,a=o?e.dataItem.id:e;n._zoomLevel=a;var r=n.createView,l=r.getToolbarViewModel("zoomin"),s=r.getToolbarViewModel("zoomout"),d=n._zoomLevel>=C.DEFAULT_MAX_ZOOM_LEVEL,c=n._zoomLevel<=C.DEFAULT_MIN_ZOOM_LEVEL;n._isPreventUpdate=!0,n.commandManager&&n.commandManager.stopListening(),l.set("disabled",d),s.set("disabled",c),d&&(n._zoomLevel=a=C.DEFAULT_MAX_ZOOM_LEVEL),c&&(n._zoomLevel=a=C.DEFAULT_MIN_ZOOM_LEVEL),E.show(a+"%"),t||r.setCurrentTabZoomLevel(a),a/=100,n.paperScroller.zoom(a,{absolute:!0}),t||n.triggerIndoorDeviceElements("element:changeZoom",{zoom:a}),i=i||{offsetX:C.DEFAULT_CANVAS_WIDTH/2,offsetY:C.DEFAULT_CANVAS_HEIGHT/2};var p=n.paperScroller,g=n.getActiveModel(),h=n.element,u=h.width(),f=h.height(),m=p.getVisibleArea(),_=m.width*a,v=m.height*a;if(u<=_?i.offsetX=C.DEFAULT_CANVAS_WIDTH/2:i.offsetX<m.width/2?i.offsetX=m.width/2:i.offsetX>C.DEFAULT_CANVAS_WIDTH-m.width/2&&(i.offsetX=C.DEFAULT_CANVAS_WIDTH-m.width/2),f<=v?i.offsetY=C.DEFAULT_CANVAS_HEIGHT/2:i.offsetY<m.height/2?i.offsetY=m.height/2:i.offsetY>C.DEFAULT_CANVAS_HEIGHT-m.height/2&&(i.offsetY=C.DEFAULT_CANVAS_HEIGHT-m.height/2),n.isEditable&&g?p.centerElement(g):p.center(i.offsetX,i.offsetY),--a,n.editable){var b=r.getToolbarViewModel("zoomlevel"),T=$("#"+b.id).data("kendoDropDownList");o?T.value(n._zoomLevel):T.text(n._zoomLevel+"%")}n.commandManager&&n.commandManager.listen(),n._isPreventUpdate=!1},setDefaultZoomLevel:function(e){var t=e.sender,i=t.value(),n=t.text();i||(t.value(null),t.text(n))},getZoomLevel:function(){return this._zoomLevel?this._zoomLevel:100},lock:function(){var t,e=this;e.commandManager.initBatchCommand(),e.models.forEach(function(e){t=!!e.prop("binding/locked"),e.prop("binding/locked",!t)}),e.commandManager.storeBatchCommand();var i=e.isEditable,n=e.createView;i&&(e.updateBindingTabState(),n.updateToolbarButtonState())},changeLock:function(t){var i,e=this,n=e.models||[];e.commandManager.initBatchCommand(),n.forEach(function(e){i=e.prop("binding/locked"),t!=i&&e.prop("binding/locked",t)}),e.commandManager.storeBatchCommand();var o=e.isEditable,a=e.createView;o&&(e.updateBindingTabState(),a.updateToolbarButtonState())},group:function(){var e=this,t=e.models||[];if(!(t.length<2)){e.commandManager.initBatchCommand();var i=new I.shapes.hmi.Group;i.addTo(e.graph),t.forEach(function(e){i.embed(e)}),e.commandManager.storeBatchCommand(),e.selection.cancelSelection(),e.createSelectionPoint(e.paper.findViewByModel(i)),t.add(i);var n=e.isEditable,o=e.createView;n&&o.updateToolbarButtonState()}},ungroup:function(){var e,t,i,n,o,a=this,r=a.models||{},l=a.isEditable,s=a.createView,d=r.length;for(a.commandManager.initBatchCommand(),r=r.models,i=d-1;0<=i;i--)if((e=r[i])instanceof I.shapes.hmi.Group){for(n=(o=e.getEmbeddedCells()).length,t=0;t<n;t++)e.unembed(o[t]);for(a.createSelectionPoint(e.findView(a.paper),{shiftKey:!0}),e.remove(),r.splice(i,1),t=0;t<n;t++)a.createSelectionPoint(a.paper.findViewByModel(o[t]),{shiftKey:!0}),a.models.add(o[t])}l&&s.updateToolbarButtonState(),a.commandManager.storeBatchCommand()},bold:function(t){var i;f.close(),this.commandManager.initBatchCommand(),this.models.forEach(function(e){i=t?"Bold":"Normal",e.setFontWeight(i)}),this.commandManager.storeBatchCommand()},italic:function(t){var i;f.close(),this.commandManager.initBatchCommand(),this.models.forEach(function(e){i=t?"Italic":"Normal",e.setFontStyle(i)}),this.commandManager.storeBatchCommand()},getActiveModel:function(){var t=this,e=this.models||[],i=null,n=null;return e.forEach(function(e){(n=t.paper.findViewByModel(e))&&n.$el.hasClass("active")&&(i=e)}),i},matchSize:function(){var e=this.models,t=this.getActiveModel().getBBox();this.commandManager.initBatchCommand(),e.forEach(function(e){e.resize(t.width,t.height)}),this.commandManager.storeBatchCommand()},matchWidth:function(){var e=this.models,t=this.getActiveModel().getBBox();this.commandManager.initBatchCommand(),e.forEach(function(e){e.resize(t.width,e.getBBox().height)}),this.commandManager.storeBatchCommand()},matchHeight:function(){var e=this.models,t=this.getActiveModel().getBBox();this.commandManager.initBatchCommand(),e.forEach(function(e){e.resize(e.getBBox().width,t.height)}),this.commandManager.storeBatchCommand()},hFlip:function(){var t,e=this.models;this.commandManager.initBatchCommand(),e.forEach(function(e){t=!!e.prop("binding/hFliped"),e.prop("binding/hFliped",!t)}),this.commandManager.storeBatchCommand()},vFlip:function(){var t,e=this.models;this.commandManager.initBatchCommand(),e.forEach(function(e){t=!!e.prop("binding/vFliped"),e.prop("binding/vFliped",!t)}),this.commandManager.storeBatchCommand()},rotation:function(t){var i,n,e=this.models;this.commandManager.initBatchCommand(),e.forEach(function(e){i=e.angle(),"left"===t?n=i-90:"right"===t?n=i+90:t.sender?n=t.sender.value():"number"==typeof t&&(n=t),n%=360,e.rotate(n,!0)}),this.commandManager.storeBatchCommand()},centerAlign:function(t){var i,n,o,e=this,a=e.models,r=a.length,l=e.getActiveModel(),s=0,d=e.paper.getArea(),c=d.width,p=d.height;e.commandManager.initBatchCommand(),i=l.getBBox(),1===r?"center_v"===t?(o=(s=p/2)-i.height/2,l.translate(0,o-i.y)):(o=(s=c/2)-i.width/2,l.translate(o-i.x,0)):1<r&&a.forEach(function(e){n=e.getBBox(),"center_v"===t?(s=i.y+i.height/2,o=s-n.height/2,e.translate(0,o-n.y)):(s=i.x+i.width/2,o=s-n.width/2,e.translate(o-n.x,0))}),e.commandManager.storeBatchCommand()},sortZOrder:function(e){var t=[];return e.forEach(function(e){t.push(e)}),t.sort(function(e,t){return e.get("z")-t.get("z")}),t},reorderZOrder:function(e){var t=this.sortZOrder(e),i=1;return t.forEach(function(e){e.set("z",i++)}),t},increaseZOrder:function(){var e,t,i,n=this,o=n.models,a=n.graph.getElements(),r={},l=a.length;for(n.commandManager.initBatchCommand(),o.forEach(function(e){r[e.id]=!0}),a=n.sortZOrder(a),i=l-2;0<=i;i--){var s=i+1;for(e=a[i];t=a[s++],s<l&&r[t.id];);r[t.id]||r[e.id]&&(t.set("z",i+1),e.set("z",i+2))}n.commandManager.storeBatchCommand()},decreaseZOrder:function(){var e,t,i,n=this,o=n.models,a=n.graph.getElements(),r={},l=a.length;for(n.commandManager.initBatchCommand(),o.forEach(function(e){r[e.id]=!0}),a=n.sortZOrder(a),i=1;i<l;i++){var s=i-1;for(e=a[i];t=a[s--],0<=s&&r[t.id];);r[t.id]||r[e.id]&&(t.set("z",i+1),e.set("z",i))}n.commandManager.storeBatchCommand()},sendToBottom:function(){var e,t=this,i=t.models,n=t.sortZOrder(i),o=t.graph.minZIndex(),a=n.length;for(t.commandManager.initBatchCommand(),e=0;e<a;e++)n[e].set("z",o-a+e);t.reorderZOrder(t.graph.getElements()),t.commandManager.storeBatchCommand()},bringToTop:function(){var e,t=this,i=t.models,n=t.sortZOrder(i),o=t.graph.maxZIndex(),a=n.length;for(t.commandManager.initBatchCommand(),e=0;e<a;e++)n[e].set("z",o+e+1);t.reorderZOrder(t.graph.getElements()),t.commandManager.storeBatchCommand()},alignFigure:function(t){var i,n,o,a,r,e=this,l=e.models,s=l.length,d=e.getActiveModel().getBBox(),c=e.paper.getArea();switch(t){case"center_v":return void e.centerAlign("center_v");case"center_h":return void e.centerAlign("center_h");case"left":i=1!==s?d.x:0;break;case"right":i=1!==s?d.x+d.width:c.width;break;case"top":n=1!==s?d.y:0;break;case"bottom":n=1!==s?d.y+d.height:c.height}e.commandManager.initBatchCommand(),l.forEach(function(e){r=e.getBBox(),"left"===t?(o=i,a=r.y):"right"===t?(o=i-r.width,a=r.y):"top"===t?(o=r.x,a=n):"bottom"===t&&(o=r.x,a=n-r.height),e.translate(o-r.x,a-r.y,{preventSetGridPoint:!0})}),e.commandManager.storeBatchCommand()},equalGap:function(i){var e,t=this.models,n=[],o=0,a=0;this.commandManager.initBatchCommand(),t.forEach(function(e){var t=e.getBBox();n.push({model:e,center:t.center()})}),n.sort(function(e,t){return"horizontal"===i?e.center.x-t.center.x:e.center.y-t.center.y}),e=n.length,"horizontal"===i?(o=(n[e-1].center.x-n[0].center.x)/(e-1),a=n[0].center.x,n.forEach(function(e){e.model.translate(a-e.center.x,0,{preventSetGridPoint:!0}),a+=o})):"vertical"===i&&(o=(n[e-1].center.y-n[0].center.y)/(e-1),a=n[0].center.y,n.forEach(function(e){e.model.translate(0,a-e.center.y,{preventSetGridPoint:!0}),a+=o})),this.commandManager.storeBatchCommand()},getColor:function(e){var t=this.getActiveModel(),i="transparent";return t&&("lineColor"===e?i=t.getStrokeColor():"fill"===e?i=t.getFillColor():"fontColor"===e&&(i=t.getFontColor())),i},changeColor:function(e,t){var i,n=this.models;"lineColor"===e?i="setStrokeColor":"fill"===e?i="setFillColor":"fontColor"===e&&(i="setFontColor"),this.commandManager.initBatchCommand(),n.forEach(function(e){e[i].call(e,t)}),this.commandManager.storeBatchCommand()},clickOutOfCanvasAreaEvt:function(e){!this.isHyperLinkCreate&&this.cancelCreateBasicShape&&this.cancelCreateBasicShape()},clickCanvasElementEvt:function(e){e.stopPropagation()},createbasicShape:function(c){var p=this,g=p.graph,h=c.className,u=v[h],f=null,m=null,n=(new Date).getTime();p.isStartCreate=!0,p.cancelCreateBasicShape&&p.cancelCreateBasicShape(),p._onClickBodyEvt||(p._onClickBodyEvt=p.clickOutOfCanvasAreaEvt.bind(p)),$("body").off("mousedown",p._onClickBodyEvt),$("body").on("mousedown",p._onClickBodyEvt),p._onClickCanvasElementEvt||(p._onClickElementEvt=p.clickCanvasElementEvt.bind(p)),p.element.off("mousedown",p._onClickElementEvt),p.element.on("mousedown",p._onClickElementEvt),p.cancelCreateBasicShape=null,p.selection.cancelSelection(),p.isCreateShape=!0,p.setCursor("crosshair");function e(e){e=y(e);var t=p.getPaperOffsetWithMouseEvent(e);if(e.shiftKey){var i=f.getRefPoints(),n=i[i.length-2],o=f.position(),a=Math.abs(t.offsetX-n.x-o.x);Math.abs(t.offsetY-n.y-o.y)<=a?t.offsetY=n.y+o.y:t.offsetX=n.x+o.x}p.isCreateMoving&&f.changeRefPoint(t,-1)}var t,i,o;if("Line"===h||"Curve"===h)t=function(e){e=y(e);var t=p.getPaperOffsetWithMouseEvent(e),i=(new Date).getTime();if(i-n<250){if(f.getRefPoints().length<1)return;return p.isCreateMoving=!1,m=null,f.removeRefPoint(-1),f=null,p.commandManager.storeBatchCommand(),n=i,void p.cancelCreateBasicShape()}n=i,m||(p.commandManager.initBatchCommand(),m={x:t.offsetX,y:t.offsetY},(f=new u({paletteItem:c})).addRefPoints(t),f.addTo(g),p.isCreateMoving=!0),f.addRefPoints(t)},i=e;else if("Straight"===h)t=function(e){e=y(e);var t=p.getPaperOffsetWithMouseEvent(e);if(m)return p.isCreateMoving=!1,f=m=null,p.commandManager.storeBatchCommand(),void p.cancelCreateBasicShape();p.commandManager.initBatchCommand(),m={x:t.offsetX,y:t.offsetY},(f=new u({paletteItem:c})).addRefPoints(t),f.addTo(g),p.isCreateMoving=!0,f.addRefPoints(t)},i=e;else if("Table"===h)t=function(e){e=y(e);var s=p.getPaperOffsetWithMouseEvent(e),t=l.tableInsertDialog;t.open(),t.unbind("onSaved"),t.bind("onSaved",function(e){var t,i,n,o=e.result,a=[],r=o.row,l=o.col;for(p.commandManager.initBatchCommand(),i=0;i<l;i++){for(n=[],t=0;t<r;t++)n.push({id:"col"+(i+1)+"-row"+(t+1),label:"",width:C.DEFAULT_TABLE_COLUMN_WIDTH,height:C.DEFAULT_TABLE_ROW_HEIGHT});a.push(n)}(f=new u({paletteItem:c})).position(s.offsetX,s.offsetY),f.set("items",a),f.addTo(g),p.commandManager.storeBatchCommand(),p.cancelCreateBasicShape&&p.cancelCreateBasicShape(),p.cancelCreateBasicShape=null})};else if("ImportImage"===h){var a=p.graph.getCells(),r=0;a.forEach(function(e){e.prop("binding/type")==h&&r++}),100<=r&&(b.message(s.prop("HMI_OVER_IMAGE_COUNT")),b.open(),o=!0),t=function(s){s=I.util.normalizeEvent(s);var d=u;_.getImageInfoFromFile("basic-image-create",1048576).done(function(e){p.commandManager.initBatchCommand();var t=e.file,i=e.width,n=e.height,o=p.paper.clientToLocalPoint(s.clientX,s.clientY),a=o.x,r=o.y;(f=new d({paletteItem:c,widthFactor:i/50,heightFactor:n/50})).addTo(g),f.position(a,r,{preventSetGridPoint:!0});var l=f.prop("binding");f.fileName=l.name=t.name,f.fileData=l.image=e.dataUrl,f.attr("body/href",f.fileData),f.resize(i,n,{preventSetGridPoint:!0}),f.setImageTransform(),p.commandManager.storeBatchCommand()}).fail(function(e){b.message(e),b.open()}),p.cancelCreateBasicShape()}}else"HyperLink"===h?t=function(e){var t=l.hyperLinkPopup;p._onSaveHyperLinkEvt||(p._onSaveHyperLinkEvt=p.createHyperLinkOnSavedEvt.bind({sender:p,BasicShape:u,paletteItem:c})),p._onCloseHyperLinkEvt||(p._onCloseHyperLinkEvt=function(){p.isHyperLinkCreate=!1,p.cancelCreateBasicShape&&p.cancelCreateBasicShape()}),p._clientCoords=p.paper.clientToLocalPoint(e.clientX,e.clientY),p.isHyperLinkCreate=!0,t.unbind("onSaved",p._onSaveHyperLinkEvt),t.bind("onSaved",p._onSaveHyperLinkEvt),t.unbind("onClosed",p._onCloseHyperLinkEvt),t.bind("onClosed",p._onCloseHyperLinkEvt),t.setDataSource({id:0,name:"-"}),t.open()}:"Zone"===h?t=function(e){e=y(e);var t=p.getPaperOffsetWithMouseEvent(e);p.commandManager.initBatchCommand(),(f=new u({paletteItem:c})).position(t.offsetX,t.offsetY),f.addTo(g),p.cancelCreateBasicShape&&p.cancelCreateBasicShape(),p.cancelCreateBasicShape=null,p.commandManager.storeBatchCommand()}:(t=function(e){e=y(e);var t=p.getPaperOffsetWithMouseEvent(e);if(m){if(p.isCreateMoving=!1,"Text"==h){var i=f.findView(p.paper);f.attr("body/stroke","transparent"),f.edit(i,i.el)}f=m=null,p.commandManager.storeBatchCommand(),p.cancelCreateBasicShape()}else p.commandManager.initBatchCommand(),m={x:t.offsetX,y:t.offsetY},(f=new u({paletteItem:c})).resize(2,2),f.position(m.x,m.y),"Text"==h&&f.attr("body/stroke","#000000"),f.addTo(g),p.isCreateMoving=!0},i=function(e){if(e=y(e),p.isCreateMoving&&f){var t=e.shiftKey,i=p.getPaperOffsetWithMouseEvent(e),n=[],o=p.paper.options.gridSize||C.DEFAULT_GRID_WIDTH,a=i.offsetX-m.x,r=i.offsetY-m.y,l=m.x,s=m.y;if(a=T.snapToGrid(a,o),r=T.snapToGrid(r,o),a<0?(a*=-1,l=i.offsetX,n.push("left")):n.push("right"),r<0?(r*=-1,s=i.offsetY,n.push("up")):n.push("down"),n=n.join("-"),("Rectangle"===h||"Triangle"===h||"Circle"===h)&&t){if("Triangle"===h){var d=a*Math.sqrt(3)/2;r<d?r=d:a=2*r/Math.sqrt(3)}else r<a?r=a:a=r;-1!=n.indexOf("left")&&(l=m.x-a),-1!=n.indexOf("up")&&(s=m.y-r)}f.position(l,s),f.resize(a,r)}});i&&p.element.on("mousemove",i),t&&p.element.on("mouseup",t),p.cancelCreateBasicShape=function(){p.keyboard.off("esc"),p.setCursor(null),p.isCreateMoving&&(p.isCreateMoving=!1,"Line"!==h&&"Curve"!==h&&"Straight"!==h&&f.remove(),p.commandManager.storeBatchCommand()),p.isCreateShape=!1,p.isStartCreate||p.createView.clearBasicShapeBtnActive(),p._onClickBodyEvt&&$("body").off("mousedown",p._onClickBodyEvt),p._onClickElementEvt&&p.element.off("mousedown",p._onClickElementEvt),i&&p.element.off("mousemove",i),t&&p.element.off("mouseup",t),p.cancelCreateBasicShape=null},p.keyboard.on("esc",p.cancelCreateBasicShape),p.isStartCreate=!1,o&&p.cancelCreateBasicShape()},createHyperLinkOnSavedEvt:function(e){var t=this.sender;if(t&&t.isHyperLinkCreate){var i=e.result,n=t._clientCoords;t.commandManager.initBatchCommand();var o=new this.BasicShape({paletteItem:this.paletteItem});o.position(n.x,n.y),o.prop("binding/file",i);var a=i.name;a&&a.length>C.DEFAULT_LABEL_MAX_LENGTH&&(a=a.substring(0,C.DEFAULT_LABEL_MAX_LENGTH)),o.prop("binding/label",a),o.addTo(t.graph),t.cancelCreateBasicShape&&t.cancelCreateBasicShape(),t.commandManager.storeBatchCommand(),t.isHyperLinkCreate=!1}},getPaperOffsetWithMouseEvent:function(e){var t,i,n=$(this.paper.el),o=n.offset(),a=n.scrollLeft(),r=n.scrollTop(),l=this.paper.scale();return t=e.clientX-o.left+window.pageXOffset+a,i=0<(i=e.clientY-o.top+window.pageYOffset+r)?i:1,{offsetX:(t=0<t?t:1)/l.sx,offsetY:i/l.sy}},textAlign:function(t){var i,e=this.models;"top"===t||"middle"===t||"bottom"===t?i="binding/vAlign":"left"!==t&&"center"!==t&&"right"!==t||(i="binding/hAlign"),f.close(),this.commandManager.initBatchCommand(),e.forEach(function(e){e.setTextAlign(i,t)}),this.commandManager.storeBatchCommand()},setLineWidth:function(t){var e=this.models;this.commandManager.initBatchCommand(),e.forEach(function(e){e.setStrokeWidth(t)}),this.commandManager.storeBatchCommand()},setLineDasharray:function(t){var e=this.models;this.commandManager.initBatchCommand(),e.forEach(function(e){e instanceof I.shapes.hmi.Line&&e.setDasharray(t)}),this.commandManager.storeBatchCommand()},setLineSourceMarker:function(t){var e=this.models;this.commandManager.initBatchCommand(),e.forEach(function(e){e instanceof I.shapes.hmi.Line&&e.setSourceMarker(t)}),this.commandManager.storeBatchCommand()},setLineTargetMarker:function(t){var e=this.models;this.commandManager.initBatchCommand(),e.forEach(function(e){e instanceof I.shapes.hmi.Line&&e.setTargetMarker(t)}),this.commandManager.storeBatchCommand()},setOpacity:function(t){var e=this.models;this.commandManager.initBatchCommand(),e.forEach(function(e){e.setOpacity(t)}),this.commandManager.storeBatchCommand()},setFontSize:function(e){var t=e.dataItem,i=this.models;f.close(),this.commandManager.initBatchCommand(),i.forEach(function(e){e.setFontSize(t)}),this.commandManager.storeBatchCommand()},tableAction:function(e,t){var i=this.getActiveModel();if("Table"===i.prop("binding/type"))switch(e){case"mergeCell":i.mergeCell();break;case"unmergeCell":i.unmergeCell();break;case"add":"left"==t||"right"==t?i.addColumn(t):i.addRow(t);break;case"remove":"column"==t?i.removeColumn():"row"==t?i.removeRow():i.remove()}},unitResize:function(t){var i,n,o,e=this.models||[];this.commandManager.initBatchCommand(),e.forEach(function(e){switch(i=e.getBBox(),n=i.width,o=i.height,t){case"left":n--;break;case"up":o--;break;case"right":n++;break;case"down":o++}e.resize(n,o,{preventSetGridPoint:!0})}),this.commandManager.storeBatchCommand()},remove:function(){var e=this,t=e.models||[];0!=t.length&&(e.commandManager.initBatchCommand(),e.ungroup(),t.forEach(function(e){e.prop("binding/locked")||e.remove()}),e.selection.cancelSelection(),e.reorderZOrder(e.graph.getElements()),e.commandManager.storeBatchCommand())},selectAll:function(){var t=this,e=t.graph,i=e._paper,n=t.models,o=e?e.getCells():[];n.reset([]),o.forEach(function(e){e.prop("binding/locked")||e.parent&&e.parent()||(t.createSelectionPoint(e.findView(i),{shiftKey:!0}),t.models.add(e))})},createSelectionPoint:function(e,t){if(!this.isCreateShape){t=t||{};var i=this.models,n=!1,o=t.shiftKey;if(0<i.length&&i.forEach(function(e){e.prop("binding/locked")&&(n=!0)}),e.model&&e.model.prop("binding/locked")&&(n=!0),!n||!o)if(!(0<i.length&&o&&e.model.prop("binding/locked")))if(!e.model||!e.model.parent())new r({cellView:e,clearAll:!o,createView:this.createView}).render()}},canvasCenterAlign:function(e){e=e||"x";var t=this.paperScroller;if(t)if("all"==e)t.center();else if("x"==e){var i=this.paper.getComputedSize(),n=t.getVisibleArea(),o=n.y+n.height/2;t.scroll(i.width/2,o)}},clearTableCellSelect:function(e){(e?this.graph.getCells():this.models).forEach(function(e){"Table"==e.prop("binding/type")&&e.clearHighlighted()})},clear:function(){var e=this;e.isEditable&&(e.baseCanvas.detachBeforeUnloadEvt(),e.keyboard.off()),e.select(),e.setBackground(null),e.setZoomLevel(100,!0);var t=e.paper,i=e.graph;e._isClearing=!0,i.clear(),t.fitToContent(e.options.width,e.options.height),e._isClearing=!1},hide:function(){$(this.paperScroller.el).hide()},show:function(){$(this.paperScroller.el).show()},getSelectedIndoorDevices:function(){var t,e=this.graph.getCells(),i=[];return e.forEach(function(e){"Indoor"==(t=e.prop("binding")).type&&t.selected&&t.device.id&&i.push(t.device)}),i},getZones:function(){var e=this.graph.getCells(),t=[];return e.forEach(function(e){"Zone"==e.prop("binding/type")&&t.push(e)}),t},triggerIndoorDeviceElements:function(t,i){var e=this.graph.getCells();i=i||{},e.forEach(function(e){"Indoor"==e.prop("binding").type&&(i.model=e).trigger(t,i)})},selectIndoorDevice:function(e){var t=this;if(!t.isEditable&&t.createView){if(e)t.getZones().forEach(function(e){e.setZoneSelectedByInnerIndoorsSelected()});t.createView.onSelectIndoorDevice({item:e,items:t.getSelectedIndoorDevices()})}},panningScroll:function(){var e=this._scrollTop,t=this._scrollLeft;void 0!==e?this.paperScroller.scroll(t,e):this.paperScroller.center()}}),n={RappidCanvas:i};return window.RappidCanvas=i,n}),define("hmi/config/rappid-element",["device/common/device-api","hmi/hmi-common","hmi/hmi-util","hmi/config/rappid-extended-class","hmi/config/popup-config","hmi/config/palette-config"],function(e,b,D,t,i,d){var s=window.I18N,g=window.Util,v=window.moment,m=window.kendo,de=window.joint,y=window.g,h=window.V,r=D.Loading,l=D.getGridPosition,c=t.TextEditor,f=de.dia.Element.define("hmi.BaseHmiElement",{attrs:{info_0:{refX:"100%",refY:0,width:b.DEFAULT_INFO_ICON_SIZE,height:b.DEFAULT_INFO_ICON_SIZE},info_1:{refX:"100%",refY:b.DEFAULT_INFO_ICON_SIZE,width:b.DEFAULT_INFO_ICON_SIZE,height:b.DEFAULT_INFO_ICON_SIZE}}},{initialize:function(e){de.dia.Element.prototype.initialize.apply(this,arguments);var t=e.paletteItem,i=this.prop("binding"),n=de.util.cloneDeep(f.markup),o=this.get("type"),a=de.util.cloneDeep(f.defaultBindingProp),r=de.util.getByPath(de.shapes,o,".").defaultBindingProp;r=r&&de.util.cloneDeep(r),i=i?$.extend(!0,{},a,r||{},i,e.binding||{}):$.extend(!0,{},a,r||{},e.binding||{});var l=[];this.markup?$.isArray(this.markup)?"string"==typeof this.markup[0]?(l=this.markup).push("<image joint-selector='info'></image>"):l=this.markup.concat(n):"string"==typeof this.markup&&(l=this.markup+"<image joint-selector='info'></image>"):l=n,this.set("markup",l),t&&(i.categoryName=t.categoryName,i.image=t.imageUrl,i.name=t.text,i.key=t.value),this._attachDefaultEvt(),this._attachDefaultBindingEvt(),this.attachEvent(),this.prop("binding",i)},initializeOptions:function(e,t){var i,n=(e=e||{}).size,o=(t=t||{}).size,a=e.position,r=e.offset,l=e.attrs,s=t.attrs,d=e.binding,c=t.binding;if(!a&&r&&this.position(r.offsetX,r.offsetY),!n&&o)this.prop("binding/initWidth",o.width),this.prop("binding/initHeight",o.height),this.resize(o.width,o.height);else if(n&&o){var p=this.prop("binding/initWidth"),g=this.prop("binding/initHeight");p!=o.width&&this.prop("binding/initWidth",o.width),g!=o.height&&this.prop("binding/initHeight",o.height)}if(!l&&s)for(i in s)this.attr(i,s[i]);var h=this.prop("binding");if(!d&&c)for(i in c)h[i]=c[i]},getPaletteItem:function(){var e=this.prop("binding/key");return"Custom"==this.prop("binding/categoryName")?this.prop("binding/custom"):d.getData(e)},getRestrictedArea:function(){var e=this.graph;return e?e._paper.getRestrictedArea():{x:0,y:0,width:b.DEFAULT_CANVAS_WIDTH,height:b.DEFAULT_CANVAS_HEIGHT}},getRestrictedAreaWithRotate:function(){var e=this.getRestrictedArea(),t=this.angle()||0,i=this.getBBox(),n=i.bbox(t);return e.x-=n.x-i.x,e.y-=n.y-i.y,e.width-=(n.width-i.width)/2,e.height-=(n.height-i.height)/2,e},position:function(e,t,i){return this._isResizing||i&&i.preventSetGridPoint||(e=l(e),t=l(t)),de.dia.Element.prototype.position.call(this,e,t,i)},translate:function(e,t,i){t=i&&i.preventSetGridPoint?(e=e||0,t||0):(e=l(e)||0,l(t)||0);var n=this.angle()||0,o=this.getBBox(),a=o.bbox(n),r=this.getRestrictedAreaWithRotate();return o.x+e<r.x&&(e=r.x-o.x),o.y+t<r.y&&(t=r.y-o.y),a.x+a.width+e>r.x+r.width&&(e=r.x+r.width-a.width-a.x),a.y+a.height+t>r.y+r.height&&(t=r.y+r.height-a.height-a.y),de.dia.Element.prototype.translate.call(this,e,t,i)},resize:function(e,t,i){this._isResizing=!0;var n=this.prop("binding/minWidth"),o=this.prop("binding/minHeight");void 0!==n&&e<n&&(e=n),void 0!==o&&t<o&&(t=o),i&&i.preventSetGridPoint||(e=l(e),t=l(t)),e>b.DEFAULT_CANVAS_WIDTH&&(e=b.DEFAULT_CANVAS_WIDTH),t>b.DEFAULT_CANVAS_HEIGHT&&(t=b.DEFAULT_CANVAS_HEIGHT);var a=de.dia.Element.prototype.resize.call(this,e,t,i);return this._isResizing=!1,a},getPropertyValue:function(e,t){return null==t&&(t=this.prop(e)),t},_attachDefaultBindingEvt:function(){var r=this;r.on("change:binding",function(e,t,i){var n=i.propertyPath;i.propertyValue;"binding/locked"!=n&&"binding/device"!=n&&"binding/device/invalid"!=n&&"binding/optionValues"!=n&&"binding/value"!=n&&"binding/highlightColor"!=n||r.updateInfoIcon()}),r.on("change:position",function(e,t){if(!r.parent()){var i=r.getCanvas(),n=r.angle()||0,o=r.getBBox(),a=y.Rect(t.x,t.y,o.width,o.height);a=a.bbox(n),i&&i.updateBinding({x:a.x,y:a.y})}}),r.on("change:size",function(e,t){if(!r.parent()){var i=r.getCanvas(),n=r.angle()||0,o=r.getBBox(),a=y.Rect(o.x,o.y,t.width,t.height);a=a.bbox(n),i&&i.updateBinding({width:a.width,height:a.height})}}),r.on("change:angle",function(){if(!r.parent()){var e=r.getCanvas(),t=r.angle()||0,i=r.getBBox().bbox(t);e&&e.updateBinding({x:i.x,y:i.y,width:i.width,height:i.height})}})},updateInfoIcon:function(){var e=this,t=e.isInvalidOptionValue()||e.isInvalidMultiCustomComponentValue(),i=e.isInvalidDevice(),n=e.isLocked()&&e.isEditableCanvas();e._renderInfoIcon(n,i,t)},_renderInfoIcon:function(e,t,i){var n=this,o=g.addBuildDateQuery("../../src/main/resources/static-dev/images/icon/tool-lock.png"),a=g.addBuildDateQuery("../../src/main/resources/static-dev/images/icon/mark-alarm.png"),r=g.addBuildDateQuery("../../src/main/resources/static-dev/images/icon/mark-value.png");e?(n.attr("info_0/href",o),t?n.attr("info_1/href",a):i&&n.attr("info_1/href",r)):(n.attr("info_1/href",null),t?n.attr("info_0/href",a):i?n.attr("info_0/href",r):n.attr("info_0/href",null))},isInvalidDevice:function(){var e=this.prop("binding/device");return!!(e&&e.id&&e.invalid)},isLocked:function(){return!!this.prop("binding/locked")},isInvalidOptionValue:function(){var e=this.prop("binding/optionValues"),t=this.getValue(),i=this.prop("binding/device");if(e&&i.id){var n,o=e.length;for(n=0;n<o;n++)if(e[n].value==t)return!1;return!0}return!1},isInvalidMultiCustomComponentValue:function(){var e=this.prop("binding/custom");return!!e&&e.invalid},_attachDefaultEvt:function(){this.once("graph:add",this._defaultAddEvt.bind(this))},_defaultAddEvt:function(){var e=this.prop("binding");this._setVisible(e.visible),this.updateInfoIcon()},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n&&(o="true"===o||!0===o,a._setVisible(o))})},getBindingData:function(){return this.prop("binding")},setBindingData:function(e){var t=e.x,i=e.y,n=e.width,o=e.height,a=e.visible,r=e.device,l=e.fontSize,s=e.fontType,d=e.fontStyle,c=e.fontColor,p=e.fillColor,g=e.strokeColor,h=e.strokeWidth,u=e.strokeDasharray,f=this.angle()||0,m=this.getBBox(),_=m.bbox(f),v=m.x-_.x,b=m.y-_.y,T=m.width-_.width,C=m.height-_.height;if(void 0!==n&&void 0!==o){var E=n+T,I=o+C;(1<=Math.abs(m.width-E)||1<=Math.abs(m.height-I))&&this.resize(E,I,{preventSetGridPoint:!0})}if(void 0!==t&&void 0!==i){var y=t+v,A=i+b;(1<=Math.abs(m.x-y)||1<=Math.abs(m.y-A))&&this.position(y,A,{preventSetGridPoint:!0})}void 0!==a&&this.setVisible(a),r&&r.id&&(r=$.extend(r,D.getDeviceValueObj(r.type,r.value)),this.prop("binding/device",r,{rewrite:!0})),l&&this.prop("binding/fontSize",l),s&&this.prop("binding/fontType",s),d&&this.prop("binding/fontStyle",d),c&&this.prop("binding/fontColor",c),p&&this.prop("binding/fillColor",p),g&&this.prop("binding/strokeColor",g),h&&this.prop("binding/strokeWidth",h),u&&this.prop("binding/strokeDasharray",u)},getGraphicBindingPopupData:function(){var e=this,t={},i=e.prop("binding");t.type=i.type,t.name=i.name,t.categoryName=i.categoryName,t.image=i.image;var n=e.getBBox(),o=e.angle()||0,a=(n=n.bbox(o)).x,r=n.y;t.locationX=Math.ceil(a),t.locationY=Math.ceil(r);var l=n.width,s=n.height;return isNaN(l)||(t.width=Math.ceil(l)),isNaN(s)||(t.height=Math.ceil(s)),t.visible=i.visible,t.reverse=i.reverse,t.device=i.device,t.fontSize=e.prop("binding/fontSize"),t.fontType=e.prop("binding/fontType"),t.fontStyle=e.prop("binding/fontStyle"),t.fontColor=e.prop("binding/fontColor"),t.fillColor=e.prop("binding/fillColor"),t.strokeColor=e.prop("binding/strokeColor"),t.strokeWidth=e.prop("binding/strokeWidth"),t.strokeDasharray=e.prop("binding/strokeDasharray"),t},setWidth:function(e){var t=this.size();this.resize(e,t.height)},setHeight:function(e){var t=this.size();this.resize(t.width,e)},setX:function(e,t,i){var n=this.position();this.position(e,n.y,{parentRelative:t,deep:i})},setY:function(e,t,i){var n=this.position();this.position(n.x,e,{parentRelative:t,deep:i})},setFontSize:function(e){this.prop("binding/fontSize",e)},setFontType:function(e){this.prop("binding/fontType",e)},setFontStyle:function(e){this.prop("binding/fontStyle",e)},setFontWeight:function(e){this.prop("binding/fontWeight",e)},setFontColor:function(e){this.prop("binding/fontColor",e)},setStrokeWidth:function(e){this.prop("binding/strokeWidth",e)},setStrokeColor:function(e){this.prop("binding/strokeColor",e)},setFillColor:function(e){this.prop("binding/fillColor",e)},getFontColor:function(){return this.prop("binding/fontColor")},getStrokeColor:function(){return this.prop("binding/strokeColor")},getFillColor:function(){return this.prop("binding/fillColor")},setOpacity:function(e){this.prop("binding/opacity",e)},getCurrentView:function(){var e=this.graph;if(e){var t=e._paper;if(t)return this.findView(t)}return null},getCanvas:function(){var e=this.graph;if(e){var t=e._paper;if(t)return t._canvas}return null},getBaseCanvas:function(){var e=this.getCanvas();return e?e.baseCanvas:null},isEditableCanvas:function(){var e=this.graph;if(e){var t=e._paper;if(t)return t._canvas.isEditable}return!1},setVisible:function(e){this.prop("binding/visible",e)},_setVisible:function(e){e="true"===e||!0===e;var t=this.getCurrentView();if(t){var i=1;i=e?1:this.isEditableCanvas()?.2:0,t.$el.css("opacity",i)}},isReverse:function(){var e=this.prop("binding/reverse");return"true"==e||!0===e},setDevice:function(e){var t=D.getDeviceInfo(e);this.setValue(t.value)},getDevice:function(){return this.prop("binding/device")},getValue:function(){var e=this.prop("binding/buttonType"),t=this.prop("binding/custom/type");if("Controlled"==t?e=this.prop("binding/custom/controlType"):"Toggle"!=t&&"Multi"!=t||(e=null),e&&("Push"==e||"Momentary"==e))return 0;var i=this.prop("binding/value");return isNaN(Number(i))||(i=g.convertNumberFormat(i)),i},setValue:function(e,t){var i=this;"string"!=typeof e||isNaN(Number(e))||(e=Number(e));var n=i.prop("binding/value");i.prop("binding/value",e),t&&n==e&&i.trigger("change:binding",i,i.prop("binding"),{propertyPath:"binding/value",propertyValue:e})},getCurrentState:function(e,t,i,n){var o=this.prop("binding"),a=o.device,r=o.categoryName,l=a.type;l=l||D.getElementBindingType(r);var s=D.getCurrentStateItem(r,l,e,t,i,n).value;return D.isDigitalType(l)&&this.isReverse()&&(s=D.getReverseState(s)),s},getDigitalTypeControlValue:function(){var e=this.getValue();return null==e&&(e=0),e=1==e?0:1},patchDigitalTypeControlValue:function(e,t){var i=this,n=i.prop("binding/device").id,o=i.getDigitalTypeControlValue();if(!e){var a=i.getValue();i.setValue(o),o==a&&i.updateBindingValue()}var r=i.getBaseCanvas();return r&&r.stopPolling(),t&&(o=D.getReverseValue(o)),i.isReverse()&&(o=D.getReverseValue(o)),D.DeviceApi.patchControlPointValue(n,o).always(function(e){return r&&r.startPolling(!0),e})},patchAnalogTypeControlValue:function(e){var t=this.prop("binding/device").id;e=e||this.getValue();var i=this.getBaseCanvas();return i&&i.stopPolling(),D.DeviceApi.patchControlPointValue(t,e).always(function(e){return i&&i.startPolling(!0),e})},getRefPosFromTextLocation:function(){var e,t,i,n,o,a,r=this.prop("binding/textLocation");if("top"==r)e="50%",i=t=0,n=-5,o="middle",a="bottom";else if("left"==r)t="50%",i=-5,n=e=0,o="end",a="middle";else if("right"==r)e="100%",t="50%",i=5,n=0,o="start",a="middle";else if("bottom"==r)e="50%",t="100%",i=0,n=5,o="middle",a="top";else{if("middle"!=r)return null;t=e="50%",n=i=0,a=o="middle"}return{refX:e,refY:t,refX2:i,refY2:n,textAnchor:o,textVerticalAnchor:a}},getTextFromState:function(e){var t,i;return i="on"==e?(t=this.prop("binding/state/on/text"),this.prop("binding/state/on/svgTextColor")):(t=this.prop("binding/state/off/text"),this.prop("binding/state/off/svgTextColor")),{text:t,color:i}},updateTextFromState:function(e){var t=this.getTextFromState(e),i=this.getRefPosFromTextLocation();i?this.attr("label",{opacity:1,text:t.text,fill:t.color,textVerticalAnchor:i.textVerticalAnchor,textAnchor:i.textAnchor,refX:i.refX,refX2:i.refX2,refY:i.refY,refY2:i.refY2}):this.attr("label",{opacity:0})},flipAngle:function(e){var t,i=this.angle();t=Math.abs(i-360),"binding/hFliped"==e&&(t=(t+180)%360),this.rotate(t,!0)},startCanvasListening:function(){var e=this.getCanvas(),t=e?e.commandManager:null;e&&(e._isPreventUpdate=!1),t&&t.listen()},stopCanvasListening:function(){var e=this.getCanvas(),t=e?e.commandManager:null;e&&(e._isPreventUpdate=!0),t&&t.stopListening()}},{markup:[{tagName:"image",selector:"info_0"},{tagName:"image",selector:"info_1"}],defaultBindingProp:{type:null,name:"",image:null,categoryName:"",visible:!0,reverse:!1,locked:!1,device:{invalid:!1,id:null,name:null,type:null,mappedType:null,locations:null,controlPoint:null},minWidth:b.GRAPHIC_MIN_WIDTH,minHeight:b.GRAPHIC_MIN_HEIGHT,initWidth:2,initHeight:2,vFliped:!1,hFliped:!1,vAlign:null,hAlign:null,fontSize:b.DEFAULT_FONT_SIZE,fontType:b.DEFAULT_FONT_TYPE,fontStyle:b.DEFAULT_FONT_STYLE,fontWeight:b.DEFAULT_FONT_STYLE,strokeWidth:null,strokeColor:null,fillColor:null,fontColor:null,value:null}});function n(e,t,i,n,o){var a=de.util.cloneDeep(e.prototype.defaults),r=de.util.cloneDeep(e.prototype);return delete r.defaults,f.define(t,de.util.merge(a,i),de.util.merge(r,n),o)}function o(e,t,i,n,o){var a=i.extend(n,o);return de.util.setByPath(e,t,a,"."),a}var a=f.define("hmi.Group",{attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"transparent",fill:"transparent"}}},{markup:[{tagName:"rect",selector:"body"}],initialize:function(e){e=e||{paletteItem:{}},f.prototype.initialize.call(this,e),this.rotateAngleGrid=e.rotateAngleGird||15},attachEvent:function(){f.prototype.attachEvent.call(this),this.on("change:embeds",this.afterEmbeds.bind(this))},fitEmbeds:function(e){if(e=e||{},!this.graph)return this;var t=this.getEmbeddedCells();if(0<t.length){this.startBatch("fit-embeds",e),e.deep&&de.util.invoke(t,"fitEmbeds",e);var i=this.graph.getCellsBBox(t,{ignoreRotate:e.ignoreRotate}),n=de.util.normalizeSides(e.padding);i.moveAndExpand({x:-n.left,y:-n.top,width:n.right+n.left,height:n.bottom+n.top}),this.set({position:{x:i.x,y:i.y},size:{width:i.width,height:i.height}},e),this.stopBatch("fit-embeds")}return this},afterEmbeds:function(){this.fitEmbeds({deep:!0,ignoreRotate:!0}),this.setCellPosition()},setCellPosition:function(){var t,i,e=this,n=e.getBBox(),o=n.center(),a=e.angle()||0,r=e.getEmbeddedCells(),l=n.width,s=n.height,d=n.x,c=n.y,p=n.width,g=n.height,h=e._cellsPosition={};r.forEach(function(e){t=e.getBBox(),i=t.center(),l=l>t.width?t.width:l,s=s>t.height?t.height:s,i=y.Point(i.x,i.y).rotate(o,y.normalizeAngle(a)),h[e.id]={cxr:(i.x-d)/p,cyr:(i.y-c)/g,wr:t.width/p,hr:t.height/g,angle:e.angle()-a||0}}),e.prop("binding/minWidth",b.GRAPHIC_MIN_WIDTH*n.width/l),e.prop("binding/minHeight",b.GRAPHIC_MIN_HEIGHT*n.height/s)},rotate:function(e,t,i,n){var o=this;o._cellsPosition&&0!=Object.keys(o._cellsPosition).length||o.setCellPosition(),f.prototype.rotate.call(o,e,t,i,n),o.resizingAndPositioningEmbeddedCells({preventSetGridPoint:!0})},resize:function(e,t,i){var n=this,o=i&&i.isGroupProcess;n._cellsPosition&&0!=Object.keys(n._cellsPosition).length||n.setCellPosition(),e=Math.max(e,n.prop("binding/minWidth")),t=Math.max(t,n.prop("binding/minHeight")),i=$.extend(!0,i,{preventSetGridPoint:!0,isGroupProcess:!0});var a=f.prototype.resize.call(n,e,t,i);return o||n.resizingAndPositioningEmbeddedCells({preventSetGridPoint:!0}),a},position:function(e,t,i){var n=i&&i.isGroupProcess;i=$.extend(!0,i,{preventSetGridPoint:!0,isGroupProcess:!0});var o=f.prototype.position.call(this,e,t,i);return n||this.resizingAndPositioningEmbeddedCells({preventSetGridPoint:!0},!1),o},resizingAndPositioningEmbeddedCells:function(t,e){var i,n,o,a,r,l,s,d,c,p=this,g=p.getEmbeddedCells(),h=p.getBBox(),u=h.center(),f=p._cellsPosition||{},m=p.angle()||0;g.forEach(function(e){i=f[e.id],c=i.angle+m,a=h.width*i.wr,r=h.height*i.hr,l=h.x+h.width*i.cxr,s=h.y+h.height*i.cyr,d=y.Point(l,s).rotate(u,y.normalizeAngle(-m)),n=d.x-a/2,o=d.y-r/2,e.resize(a,r,t),e.position(n,o,t),e.rotate(c,!0)}),e&&p.fitEmbeds({deep:!0,ignoreRotate:!0})}},{defaultBindingProp:{type:"Group",minWidth:b.GRAPHIC_MIN_WIDTH,minHeight:b.GRAPHIC_MIN_HEIGHT}}),p=de.shapes.hmi.BaseHmiElement.define("hmi.BasicShape",{attrs:{body:{strokeDasharray:"0"}}},{initialize:function(e){f.prototype.initialize.apply(this,arguments)},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/strokeWidth"==n?a.attr("body/strokeWidth",o):"binding/strokeColor"==n?a.attr("body/stroke",o):"binding/fillColor"==n?a.attr("body/fill",o):"binding/opacity"==n?a.attr("body/opacity",o):"binding/strokeDasharray"==n?a.setDasharray(o):"binding/vFliped"!=n&&"binding/hFliped"!=n||a.flipAngle(n)})},setDasharray:function(e){this.attr("body/strokeDasharray",e)}},{defaultBindingProp:{type:"BasicShape",strokeWidth:1,strokeColor:"#000000",strokeDasharray:"0",fillColor:"#ffffff",opacity:1},getCursor:function(){return null}});function u(e,t,i,n,o){var a=de.util.cloneDeep(e.prototype.defaults),r=de.util.cloneDeep(e.prototype);return delete r.defaults,p.define(t,de.util.merge(a,i),de.util.merge(r,n),o)}function ce(e){throw new Error("shapes.standard.Record: "+e)}var _=u(de.shapes.standard.Rectangle,"hmi.Rectangle",{attrs:{body:{strokeWidth:1,stroke:"#000000"}}},{},{getCursor:function(){return"cursor_rectangle.png"}}),T=_.define("hmi.RoundRectangle",{attrs:{body:{rx:43,ry:43,stroke:"#000000"}}},{},{getCursor:function(){return"cursor_round_square.png"}}),C=u(de.shapes.standard.Polygon,"hmi.Parallelogram",{attrs:{body:{strokeWidth:1,stroke:"#000000"}}},{initialize:function(e){p.prototype.initialize.apply(this,arguments)},attachEvent:function(){p.prototype.attachEvent.apply(this,arguments);var o=this;o.on("change:size",function(){o.setAttrRefPoints()}),o.on("change:binding",function(e,t,i){var n=i.propertyPath;"binding/hFliped"!=n&&"binding/vFliped"!=n||o.setAttrRefPoints()})},setAttrRefPoints:function(){var e=this.prop("binding"),t=e.hFliped,i=e.vFliped;t&&i||!t&&!i?this.attr("body/refPoints","1,0 0,4 3,4 4,0"):this.attr("body/refPoints","0,0 1,4 4,4 3,0")}},{getCursor:function(){return"cursor_parallelogram.png"}}),E=C.define("hmi.Trapezoid",{},{setAttrRefPoints:function(){this.attr("body/refPoints","1,0 0,4 4,4 3,0")}},{getCursor:function(){return"cursor_parallelogram.png"}}),I=C.define("hmi.Triangle",{attrs:{body:{strokeWidth:1,stroke:"#000000"}}},{initialize:function(e){p.prototype.initialize.apply(this,arguments)},attachEvent:function(){p.prototype.attachEvent.apply(this,arguments);var e=this;e.on("change:size",function(){e.setAttrRefPoints()})},setAttrRefPoints:function(){this.attr("body/refPoints","1,0 0,2 2,2")}},{getCursor:function(){return"cursor_triangle.png"}}),A=u(de.shapes.standard.Ellipse,"hmi.Circle",{attrs:{body:{strokeWidth:1,stroke:"#000000"}}},{initialize:function(e){p.prototype.initialize.apply(this,arguments)}},{getCursor:function(){return"cursor_circle.png"}}),S=u(de.shapes.standard.Polyline,"hmi.Line",{attrs:{body:{fill:"transparent",stroke:"#000000",strokeWidth:1,opacity:1,strokeDasharray:"0",targetMarker:{type:"polyline",fill:"transparent",stroke:"#000","stroke-width":1,orient:"auto",points:"0,0"},sourceMarker:{type:"polyline",fill:"transparent",stroke:"#000","stroke-width":1,orient:"auto",points:"0,0"}}}},{initialize:function(e){p.prototype.initialize.apply(this,arguments);var t=e.refPoints||[];this.prop("refPoints",t),this.setAttrRefPoints()},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/hFliped"==n||"binding/vFliped"==n?(a.flipRefPoints("x"),a.flipAngle(n)):"binding/opacity"==n?a.attr("body/opacity",o):"binding/sourceMarker"==n?a.setSourceMarker(o):"binding/targetMarker"==n?a.setTargetMarker(o):"binding/strokeDasharray"==n?a.setDasharray(o):"binding/strokeWidth"==n?(a.attr("body/strokeWidth",o),a.attr("body/sourceMarker",a.getMarkerOption("sourceMarker")),a.attr("body/targetMarker",a.getMarkerOption("targetMarker"))):"binding/strokeColor"==n?(a.attr("body/stroke",o),a.attr("body/sourceMarker",a.getMarkerOption("sourceMarker")),a.attr("body/targetMarker",a.getMarkerOption("targetMarker"))):"binding/fillColor"==n?a.attr("body/fill",o):"binding/opacity"==n?a.attr("body/opacity",o):"binding/strokeDasharray"==n&&a.setDasharray(o)})},setDasharray:function(e){this.attr("body/strokeDasharray",e)},setSourceMarker:function(e){this.attr("body/sourceMarker",this.getMarkerOption("sourceMarker",e))},setTargetMarker:function(e){this.attr("body/targetMarker",this.getMarkerOption("targetMarker",e))},getMarkerOption:function(e,t){t=t||this.prop("binding/"+e);var i=$.extend(!0,{},t),n=this.prop("binding/strokeColor"),o=this.prop("binding/strokeWidth");return"transparent"!=t.fill&&(i.fill=n),i.stroke=n,i["stroke-width"]=o,i},addRefPoint:function(e){if(Array.isArray(e))return this.addRefPoints(e);this.addRefPoints([e])},addRefPoints:function(e){var i=this,n=i.getRefPoints();this.startBatch("add:refPoint"),Array.isArray(e)||(e=[e]),e.forEach(function(e){var t=i.getRefByOffset(e.offsetX,e.offsetY);0===n.length?(n.push({x:0,y:0}),i.position(e.offsetX,e.offsetY)):n.push({x:t.x,y:t.y})}),i.prop("refPoints",n),i.setSize(),i.setAttrRefPoints(),this.stopBatch("add:refPoint")},changeRefPoint:function(e,t){for(var i=this.getRefPoints(),n=i.length;t<0;)t+=n;this.startBatch("change:refPoints"),this._isChangingPoint=!0;var o=this.getRefByOffset(e.offsetX,e.offsetY);i[t].x=o.x,i[t].y=o.y,this.prop("refPoints",i),this.setSize(),this.setAttrRefPoints(),this._isChangingPoint=!1,this.stopBatch("change:refPoints")},removeRefPoint:function(e){for(var t=this.getRefPoints(),i=t.length;e<0;)e+=i;this.startBatch("remove:refPoint"),t.splice(e,1),this.prop("refPoints",t),this.setSize(),this.setAttrRefPoints(),this.stopBatch("remove:refPoint")},getRefByOffset:function(e,t){var i=this.getBBox(),n=i.center(),o=this.get("angle");o=o*Math.PI/-180,t=0<t?t:0;var a=(e=0<e?e:0)-n.x,r=t-n.y,l=a*Math.cos(o)-r*Math.sin(o),s=a*Math.sin(o)+r*Math.cos(o);return{x:l+n.x-i.x,y:s+n.y-i.y}},setSize:function(){var t,i,n,o,e=this,a=e.getRefPoints(),r=e.getBBox(),l=null;if(!(a.length<2)){t=i=a[0].x,n=o=a[0].y,a.forEach(function(e){e.x>t&&(t=e.x),e.x<i&&(i=e.x),e.y>n&&(n=e.y),e.y<o&&(o=e.y)}),a.forEach(function(e){e.x-=i,e.y-=o});var s=t-i,d=n-o;if(0===s&&0===d?l=null:0===i&&t!==r.width&&0!==o&&n===r.height?l="top-right":0===i&&t!==r.width&&0===o&&n===r.height?l="right":0!==i&&t===r.width&&0!==o&&n===r.height?l="top-left":0===i&&t===r.width&&0!==o&&n===r.height?l="top":0!==i&&t===r.width&&0===o&&n!==r.height?l="bottom-left":0!==i&&t===r.width&&0===o&&n===r.height?l="left":0===i&&t!==r.width&&0===o&&n!==r.height?l="bottom-right":0===i&&t===r.width&&0===o&&n!==r.height&&(l="bottom"),e.prop("refPoints",a),l){var c=this.get("size");switch(l){case"left":case"right":d=c.height;break;case"top":case"bottom":s=c.width}var p=y.normalizeAngle(this.get("angle")||0),g={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[l],h=r[["bottomLeft","corner","topRight","origin"][g]](),u=y.point(h).rotate(r.center(),-p),f=Math.sqrt(s*s+d*d)/2,m=g*Math.PI/2;m+=Math.atan(g%2==0?d/s:s/d),m-=y.toRad(p);var _=y.point.fromPolar(f,m,u),v=y.point(_).offset(s/-2,d/-2);this.set("size",{width:s,height:d}),this.position(v.x,v.y,{preventSetGridPoint:!0})}else e._isSetSize=!0,e.position(r.x+i,r.y+o,{preventSetGridPoint:!0}),e.resize(t-i,n-o,{preventSetGridPoint:!0}),e._isSetSize=!1}},setAttrRefPoints:function(){var e=this.getRefPoints(),t="";e.forEach(function(e){t+=e.x+","+e.y+" "}),t=t.trim(),this.attr("body/refPoints",t)},flipRefPoints:function(e){var t,i,n=this.getBBox(),o="x"===e?n.width:n.height,a=this.getRefPoints(),r=a.length;for(t=0;t<r;t++)(i=a[t])[e]=o-i[e];this.prop("refPoints",a),this.setAttrRefPoints()},getRefPoints:function(){return $.extend(!0,[],this.prop("refPoints"))},resize:function(t,i,e){var n=this,o=this.getBBox(),a=o.width,r=o.height;n.startBatch("change:size"),e=$.extend(!0,e,{preventSetGridPoint:!0}),f.prototype.resize.call(this,t,i,e),0==t&&(t=1),0==i&&(i=1);var l=this.getRefPoints();l.length<2||(l.forEach(function(e){n._isSetSize||(e.x=0<a?e.x*t/a:e.x,e.y=0<r?e.y*i/r:e.y)}),n.prop("refPoints",l),n._isSetSize||n.setAttrRefPoints(),n.stopBatch("change:size"))},setBindingData:function(e){f.prototype.setBindingData.call(this,e);var t=e.sourceMarker,i=e.targetMarker,n=e.strokeDasharray;this.prop("binding/sourceMarker",t),this.prop("binding/targetMarker",i),this.prop("binding/strokeDasharray",n)},getGraphicBindingPopupData:function(){var e=f.prototype.getGraphicBindingPopupData.call(this),t=this.prop("binding");return e.sourceMarker=t.sourceMarker,e.targetMarker=t.targetMarker,e.strokeDasharray=t.strokeDasharray,e}},{defaultBindingProp:{type:"Line",minWidth:0,minHeight:0,strokeWidth:1,strokeColor:"#000000",strokeDasharray:"0",opacity:1,sourceMarker:{fill:"transparent",points:"0,0"},targetMarker:{fill:"transparent",points:"0,0"}},getCursor:function(){return"cursor_line.png"}}),w=S.define("hmi.Straight",{},{}),L=S.define("hmi.Curve",{},{initialize:function(e){p.prototype.initialize.apply(this,arguments);var t=e.refPoints||[];this.prop("refPoints",t),this.setSize(),this.setAttrRefPoints()},getBezierCurvePoint:function(e,t){var i=new y.Line(new y.Point(e.x,e.y),new y.Point(t.x,t.y));return 80<=i.length()?i.pointAtLength(40):i.midpoint()},convertCurveToPolyline:function(){var l=this,s=l.getRefPoints(),d=s.length,c=[];if(s.forEach(function(e,t){var i,n,o,a,r;0===t?c.push(new y.Point(e.x,e.y)):t<d-1?(i=s[t-1],n=s[t+1],o=l.getBezierCurvePoint(e,i),a=l.getBezierCurvePoint(e,n),r=new y.Curve(o,new y.Point(e.x,e.y),new y.Point(e.x,e.y),a).toPolyline().points,c=c.concat(r)):(i=s[t-1],o=l.getBezierCurvePoint(e,i),c.push(new y.Point(o.x,o.y),new y.Point(e.x,e.y)))}),1<c.length){var e=new y.Polyline(c).bbox();l.set("size",{width:e.width,height:e.height})}return l.prop("polylineRefPoints",c),c},setSize:function(){var t,i,n,o,e=this,a=e.getRefPoints(),r=e.getPolylineRefPoints(),l=new y.Polyline(r),s=e.convertCurveToPolyline(),d=e.getBBox(),c=l.bbox(),p=null;if(!(a.length<2)){t=i=s[0].x,n=o=s[0].y,s.forEach(function(e){e.x>t&&(t=e.x),e.x<i&&(i=e.x),e.y>n&&(n=e.y),e.y<o&&(o=e.y)}),a.forEach(function(e){e.x-=i,e.y-=o}),s.forEach(function(e){e.x-=i,e.y-=o});var g=new y.Polyline(s).bbox(),h=g.width,u=g.height;if(0===h&&0===u?p=null:0===i&&t!==d.width&&0!==o&&n===d.height?p="top-right":0===i&&t!==d.width&&0===o&&n===d.height?p="right":0!==i&&t===d.width&&0!==o&&n===d.height?p="top-left":0===i&&t===d.width&&0!==o&&n===d.height?p="top":0!==i&&t===d.width&&0===o&&n!==d.height?p="bottom-left":0!==i&&t===d.width&&0===o&&n===d.height?p="left":0===i&&t!==d.width&&0===o&&n!==d.height?p="bottom-right":0===i&&t===d.width&&0===o&&n!==d.height&&(p="bottom"),e.prop("refPoints",a),p){var f=c;switch(p){case"left":case"right":u=f.height;break;case"top":case"bottom":h=f.width}var m=y.normalizeAngle(this.get("angle")||0),_={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[p],v=d[["bottomLeft","corner","topRight","origin"][_]](),b=y.point(v).rotate(d.center(),-m),T=Math.sqrt(h*h+u*u)/2,C=_*Math.PI/2;C+=Math.atan(_%2==0?u/h:h/u),C-=y.toRad(m);var E=y.point.fromPolar(T,C,b),I=y.point(E).offset(h/-2,u/-2);this.set("size",{width:h,height:u}),this.position(I.x,I.y,{preventSetGridPoint:!0})}else e._isSetSize=!0,e.position(d.x+i,d.y+o,{preventSetGridPoint:!0}),e.resize(h,u,{preventSetGridPoint:!0}),e._isSetSize=!1;e.prop("polylineRefPoints",s)}},setAttrRefPoints:function(){var e=this.getPolylineRefPoints(),t="";e.forEach(function(e){t+=e.x+","+e.y+" "}),t=t.trim(),this.attr("body/refPoints",t)},flipRefPoints:function(e){var t,i,n=this.getBBox(),o="x"===e?n.width:n.height,a=this.getRefPoints(),r=a.length;for(t=0;t<r;t++)(i=a[t])[e]=o-i[e];this.prop("refPoints",a),this.convertCurveToPolyline(),this.setAttrRefPoints()},getPolylineRefPoints:function(){return $.extend(!0,[],this.prop("polylineRefPoints"))}},{getCursor:function(){return"cursor_curve.png"}}),x=n(de.shapes.standard.Record,"hmi.Table",{padding:0,attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"transparent",fill:"transparent",event:"element:table-boundary:click"},itemBodies:{stroke:"#000000",strokeWidth:1,strokeDasharray:"0",event:"element:table-cell:click",fill:"#ffffff"},itemLabels:{textAnchor:"start",textVerticalAnchor:"middle",event:"element:table-cell:click"},rowHandles:{event:"element:table-resize:click"},columnHandles:{event:"element:table-resize:click"}},itemOffset:0,itemOverflow:!0},{markup:[{tagName:"image",selector:"info_0"},{tagName:"image",selector:"info_1"},{tagName:"rect",selector:"body"}],initialize:function(){p.prototype.initialize.apply(this,arguments),this.on("change",this.onChange,this),this.buildMarkup()},attachEvent:function(){var r=this;r.on("change:binding",function(e,t,i){var n=i.propertyPath,o=r.getPropertyValue(n,i.propertyValue);"binding/fillColor"==n?r.attr("itemBodies/fill",o):"binding/strokeColor"==n?r.attr("itemBodies/stroke",o):"binding/strokeWidth"==n?r.attr("itemBodies/strokeWidth",o):"binding/strokeDasharray"==n?r.attr("itemBodies/strokeDasharray",o):"binding/fontColor"==n?r.attr("itemLabels/fill",o):"binding/fontSize"==n?r.attr("itemLabels/fontSize",o):"binding/fontType"==n?r.attr("itemLabels/fontFamily",o):"binding/fontStyle"==n?r.attr("itemLabels/fontStyle",o):"binding/fontWeight"==n&&r.attr("itemLabels/fontWeight",o)}),r.on("element:table-cell:click",function(){r.$cellSelection=r.getCellSelection()}),r.on("element:table-resize:click",function(e,t){var i=$(t.target),n=i.attr("joint-selector");-1===n.indexOf("columnHandle")&&-1===n.indexOf("rowHandle")||(r._isResizeDragging=!0,r._dragStartX=t.clientX,r._dragStartY=t.clientY,r._resizingId=i.attr("resize-id"))}),r.on("event:pointermove",function(e,t){if(r._isResizeDragging){var i=t.clientX,n=t.clientY,o=i-r._dragStartX,a=n-r._dragStartY;r._dragStartX=i,r._dragStartY=n,r.onResizeColumnRow(o,a)}}),r.on("event:pointerup",function(){r._isResizeDragging?r._isResizeDragging=!1:r._isCellDragging&&(r._isCellDragging=!1),r._dragStartCell=null}),r.on("change:size change:position",function(){r.updateCellSelectionBox()}),r.on("change:markup",r.buildMarkup.bind(r)),r.on("remove",r.onRemove.bind(r))},setFillColor:function(t){var i,n=this,e=this.getHighlightedCells();0==e.length&&(e=n.getCellsIds()),e.forEach(function(e){i=e.id,n.attr("itemBody_"+i+"/fill",t)})},setFontColor:function(t){var i,n=this,e=this.getHighlightedCells();0==e.length&&(e=n.getCellsIds()),e.forEach(function(e){i=e.id,n.attr("itemLabel_"+i+"/fill",t)})},getFillColor:function(){var t,i,n=this,e=this.getHighlightedCells(),o=b.DEFAULT_FILL_COLOR;return 0==e.length&&(e=n.getCellsIds()),e.forEach(function(e){t=e.id,(i=n.attr("itemBody_"+t+"/fill"))!=b.DEFAULT_FILL_COLOR&&(o=i)}),o},getFontColor:function(){var t,i,n=this,e=this.getHighlightedCells(),o=b.DEFAULT_TEXT_FILL_COLOR;return 0==e.length&&(e=n.getCellsIds()),e.forEach(function(e){t=e.id,(i=n.attr("itemLabel_"+t+"/fill"))!=b.DEFAULT_TEXT_FILL_COLOR&&(o=i)}),o},setFontStyle:function(t){var i,n,o=this,e=this.getHighlightedCells();0==e.length&&(e=o.getCellsIds()),e.forEach(function(e){i=e.id,"Italic"==t?(n=o.attr("itemLabel_"+i+"/fontStyle"),o.attr("itemLabel_"+i+"/fontStyle",n==t?"Normal":t)):o.attr("itemLabel_"+i+"/fontStyle","Normal")})},setFontWeight:function(t){var i,n,o=this,e=this.getHighlightedCells();0==e.length&&(e=o.getCellsIds()),e.forEach(function(e){i=e.id,"Bold"==t?(n=o.attr("itemLabel_"+i+"/fontWeight"),o.attr("itemLabel_"+i+"/fontWeight",n==t?"Normal":t)):o.attr("itemLabel_"+i+"/fontWeight","Normal")})},getFontStyle:function(){var t,i=this,e=this.getHighlightedCells(),n="Normal";return 0==e.length&&(e=i.getCellsIds()),e.forEach(function(e){t=e.id,"Italic"==i.attr("itemLabel_"+t+"/fontStyle")&&(n="Italic")}),n},getFontWeight:function(){var t,i=this,e=this.getHighlightedCells(),n="Normal";return 0==e.length&&(e=i.getCellsIds()),e.forEach(function(e){t=e.id,"Bold"==i.attr("itemLabel_"+t+"/fontWeight")&&(n="Bold")}),n},setTextAlign:function(e,t){var i,n,o=this,a=o.getHighlightedCells(),r=e.split("/")[1],l="binding/vAlign"==e?"/textVerticalAnchor":"/textAnchor";switch(t){case"right":n="end";break;case"left":n="start";break;case"center":n="middle";break;default:n=t}0==a.length&&(a=o.getCellsIds());var s,d,c,p,g,h=$.extend(!0,[],o.attributes.items),u=0,f=o._columnWidth.length,m=a[u++];for(s=0;s<f;s++){for(c=(p=h[s]).length,d=0;d<c&&((i=(g=p[d]).id)!=m.id||(g[r]=n,o.attr("itemLabel_"+i+l,n),m=a[u++]));d++);if(!m)break}o.set("items",h)},getTextAlign:function(e){var t,i,n=this,o=n.getHighlightedCells();0==o.length&&(o=n.getCellsIds());var a="vAlign"==e,r=a?"/textVerticalAnchor":"/textAnchor",l=a?"middle":"start",s=l;switch(o.forEach(function(e){t=e.id,(i=n.attr("itemLabel_"+t+r))&&i!=l&&(s=i)}),s){case"start":s="left";break;case"end":s="right";break;case"middle":s=a?s:"center";break;default:s=s}return s},getCellsIds:function(){var t=[],e=this.metrics?this.metrics.items:{};return $.each(e,function(e){t.push({id:e})}),t},isMergeable:function(){return 1<this.getHighlightedCells().length},isUnmergeable:function(){for(var e=this.getHighlightedCells(),t=0;t<e.length;t++)if(1<e[t].mergeColumn||1<e[t].mergeRow)return!0;return!1},getCellSelection:function(){if(this.$cellSelection)return this.$cellSelection;var e,t=this.getBBox();e=this.graph?this.graph._paper.scale():{sx:1,sy:1};var i=$("<div/>",{class:"joint-cell-selection no-selected",css:{position:"absolute",left:(t.x+2)*e.sx,top:(t.y+2)*e.sy,width:(t.width-2)*e.sx,height:(t.height-2)*e.sy}});return $("<div/>",{class:"cell-highlighted",css:{position:"absolute"}}).appendTo(i),i.on("mousedown",this.mousedownCellEvt.bind(this)),i.on("mousemove",this.mousemoveCellEvt.bind(this)),i.on("mouseup",this.mouseupCellEvt.bind(this)),this.graph._paper.$el.append(i),i},mousedownCellEvt:function(e){var t=this,i=t.graph._paper.snapToGrid(e.clientX,e.clientY),n=t.getItemIdWithPosition(i.x,i.y),o=t.getHighlightedCells();1==o.length&&o[0].id==n?t.addTextareaOnCellSelection(o[0]):(t._isCellDragging=!0,t._dragStartCell=n,t.updateCellSelectionBox(n))},mousemoveCellEvt:function(e){if(this._isCellDragging){var t=this.graph._paper.snapToGrid(e.clientX,e.clientY),i=this.getItemIdWithPosition(t.x,t.y);this.updateCellSelectionBox(this._dragStartCell,i)}},mouseupCellEvt:function(e){this._isCellDragging&&(this._isCellDragging=!1,this._updateHighlightedCells()),this._dragStartCell=null},addTextareaOnCellSelection:function(e){if(!this.prop("binding/locked")){var t=this.$cellSelection.find(".cell-highlighted");if(!(0<t.children("textarea").length)){var i=$("<textarea/>").css("backgroundColor",e.fill).val(e.label);this._textareaTarget=e.id,t.append(i),setTimeout(function(){i.focus()},0)}}},updateCellSelectionBox:function(e,t){var i,n=this,o=(n.metrics||{}).items||{};if(e){var a=[$.extend(!0,{id:e},o[e])];t&&a.push($.extend(!0,{id:t},o[t])),i=n._selectedBox=n.getCellsBox(a)}else i=n._selectedBox;var r,l=n.getBBox();r=n.graph?n.graph._paper.scale():{sx:1,sy:1};var s=n.$cellSelection;if(s&&(s.css({left:(l.x+2)*r.sx,top:(l.y+2)*r.sy,width:(l.width-2)*r.sx,height:(l.height-2)*r.sy}),i)){var d=!(i.col.min>i.col.max);d&&s.hasClass("no-selected")?s.removeClass("no-selected"):d||s.hasClass("no-selected")||s.addClass("no-selected");var c,p=s.find(".cell-highlighted"),g=n._columnWidth,h=n._rowHeight,u=0,f=0,m=0,_=0;for(c=0;c<g.length&&(c+1<i.col.min&&(u+=g[c]),c+1>=i.col.min&&c+1<=i.col.max&&(m+=g[c]),!(c+1>i.col.max));c++);for(c=0;c<h.length&&(c+1<i.row.min&&(f+=h[c]),c+1>=i.row.min&&c+1<=i.row.max&&(_+=h[c]),!(c+1>i.row.max));c++);var v=p.find("textarea");0<v.length&&n._textareaTarget&&(n.changeLabel(n._textareaTarget,v.val()),n._textareaTarget=null,p.empty()),p.hasClass("selected")||p.addClass("selected"),p.css({left:(u-4)*r.sx,top:(f-4)*r.sy,width:m*r.sx,height:_*r.sy})}},getCellsBox:function(e){if("string"==typeof e){var t=this.metrics.items[e];e=[{id:e,mergeRow:t.mergeRow,mergeColumn:t.mergeColumn}]}var i,n,o,a,r={col:{min:b.DEFAULT_TABLE_ROW_COLUMN_MAX_COUNT,max:0},row:{min:b.DEFAULT_TABLE_ROW_COLUMN_MAX_COUNT,max:0}};for(n=0;n<e.length;n++)o=(i=this.getColumnRowIndexById(e[n].id)).col-1+e[n].mergeColumn,a=i.row-1+e[n].mergeRow,r.col.min=i.col<r.col.min?i.col:r.col.min,r.col.max=o>r.col.max?o:r.col.max,r.row.min=i.row<r.row.min?i.row:r.row.min,r.row.max=a>r.row.max?a:r.row.max;return r},getHighlightedCells:function(){return this._highlighted||[]},_updateHighlightedCells:function(){var t,i,n=this,e=n.attributes.items,o=n._highlighted=[],a=n._selectedBox,r={};if(!a)return o;e.forEach(function(e){e.forEach(function(e){if(t=n.getColumnRowIndexById(e.id),1<e.mergeColumn)for(i=t.row;i<t.row+e.mergeRow;i++)r[i]={min:t.col,max:t.col+e.mergeColumn-1};t.col>=a.col.min&&t.col<=a.col.max&&t.row>=a.row.min&&t.row<=a.row.max&&!(r[t.row]&&t.col>r[t.row].min&&t.col<=r[t.row].max)&&o.push(e)})}),this.graph&&this.graph._paper.trigger("element:table-selection:changed")},getItemIdWithPosition:function(e,t){var i=this.position(),n=e-i.x,o=t-i.y,a=this.attributes.items;Array.isArray(a)||(a=[]);var r,l,s,d,c,p,g,h=0,u=0,f=0,m=0,_=this._rowHeight||[],v=this._columnWidth||[];for(r=0;r<_.length;r++)if(o<(u+=_[r])){f=r;break}for(l=0;l<v.length;l++)if(n<(h+=v[l])){m=l;break}if(_.length<=f||v.length<=m)return null;for(r=0;r<=m;r++)for(d=a[r],s=Math.min(f,d.length-1),l=0;l<=s;l++)if(c=d[l],g=this.getColumnRowIndexById(c.id),p=Number(c.mergeColumn)+g.col-2,f<=Number(c.mergeRow)+g.row-2&&m<=p)return c.id;return null},clearHighlighted:function(){if(this.$cellSelection){var e=this.$cellSelection.find("textarea");0<e.length&&this._textareaTarget&&(this.changeLabel(this._textareaTarget,e.val()),this._textareaTarget=null),this.$cellSelection.remove()}this.$cellSelection=null,this._selectedBox={col:{min:b.DEFAULT_TABLE_ROW_COLUMN_MAX_COUNT,max:0},row:{min:b.DEFAULT_TABLE_ROW_COLUMN_MAX_COUNT,max:0}},this._highlighted=[]},isSingleHighlightedCell:function(e){var t=this.getHighlightedCells();return 1==t.length&&t[0].id==e},changeLabel:function(e,t){var i=$.extend(!0,[],this.attributes.items),n=this.getColumnRowIndexById(e),o=i[n.col-1][n.row-1];o.label!=t&&(this.startBatch("change:item"),o.label=t,this.set("items",i),this.stopBatch("change:item"))},getColumnRowIndexById:function(e){if(!e)return{col:0,row:0};var t,i,n=e.split("-");return t=n[0].split("col")[1],i=n[1].split("row")[1],{col:Number(t),row:Number(i)}},onResizeColumnRow:function(e,t){var i,n,o,a,r,l,s,d=this.attributes.items,c=[],p=[],g=d.length,h=0,u=this._resizingId.split("-resize-"),f=u[0],m=Number(u[1]),_=this._rowHeight,v=this._columnWidth;for("col"===f?v[m-1]+e<5?e=5-v[m-1]:v[m]-e<5&&(e=v[m]-5):"row"===f&&(_[m-1]+t<5?t=5-_[m-1]:_[m]-t<5&&(t=_[m]-5)),o=0;o<g;o++){for(p=[],h=(n=d[o]).length,a=0;a<h;a++)i=n[a],s=this.getColumnRowIndexById(i.id),"col"===f?(l=i.height,r=s.col==m?i.width+e:s.col==m+1?i.width-e:i.width):"row"===f&&(r=i.width,l=s.row==m?i.height+t:s.row==m+1?i.height-t:i.height),p.push({label:i.label,width:r,height:l,path:i.path,visible:i.visible,parent:i.parent,group:i.group,hasSubItems:i.hasSubItems,highlighted:i.highlighted,collapsed:i.collapsed,mergeRow:i.mergeRow,mergeColumn:i.mergeColumn});c.push(p)}this.set("items",c)},resize:function(t,i,e){var n=this,o=this.get("items");if((e=$.extend(!0,e,{preventSetGridPoint:!0})).record===this.id)return f.prototype.resize.call(this,t,i,e);var a,r=this.getBBox(),l=$.extend(!0,[],o),s=this.prop("binding/minWidth"),d=this.prop("binding/minHeight");t=Math.max(s,t),i=Math.max(d,i);var c=n._rowHeightRatio,p=n._columnWidthRatio;l.forEach(function(e){e.forEach(function(e){a=n.getColumnRowIndexById(e.id),e.height=i*c[a.row-1],e.width=t*p[a.col-1]})}),this.set("items",l);var g=0,h=0,u=e.trueDirection||"bottom-right";return-1!=u.indexOf("top")&&(h=r.height-i),-1!=u.indexOf("left")&&(g=r.width-t),0==g&&0==h||this.translate(g,h,e),this},mergeCell:function(){var e=this.getHighlightedBox();if(e){this.startBatch("merge-cell"),this.unmergeCell();var t,i,n=this.attributes.items,o=(n=$.extend(!0,[],n))[e.col.min-1];for(t=0;t<o.length;t++)if(i=o[t],this.getColumnRowIndexById(i.id).row==e.row.min){i.mergeRow=e.row.max-e.row.min+1,i.mergeColumn=e.col.max-e.col.min+1,1<i.mergeRow&&o.splice(t+1,i.mergeRow-1);break}this.set("items",n),this.stopBatch("merge-cell"),this._updateHighlightedCells()}},unmergeCell:function(){var e=this.getHighlightedBox();if(e){this.startBatch("seperate-cell");var t=this.attributes.items;t=$.extend(!0,[],t);var i,n,o,a,r,l,s,d=this._rowHeight,c=this._columnWidth;for(r=e.col.min-1;r<e.col.max;r++)for(l=(i=t[r]).length-1;0<=l;l--)if(n=i[l],!((o=this.getColumnRowIndexById(n.id)).row<e.row.min||o.row>e.row.max)&&(n.mergeColumn=1)!=(a=n.mergeRow||1)){for(s=0;s<a-1;s++)i.splice(l+1,0,{label:"",width:c[r],height:d[l]});n.mergeRow=1}this.set("items",t),this.stopBatch("seperate-cell"),this._updateHighlightedCells()}},getHighlightedBox:function(){var e=this.getHighlightedCells();if(!(e.length<1)){var t,i,n,o,a={col:{min:30,max:0},row:{min:30,max:0}};for(i=0;i<e.length;i++)n=(t=this.getColumnRowIndexById(e[i].id)).col-1+e[i].mergeColumn,o=t.row-1+e[i].mergeRow,a.col.min=t.col<a.col.min?t.col:a.col.min,a.col.max=n>a.col.max?n:a.col.max,a.row.min=t.row<a.row.min?t.row:a.row.min,a.row.max=o>a.row.max?o:a.row.max;return a}},addRow:function(e,i){var t=this,n=t.getHighlightedCells();if(1==n.length){var o=n[0],a=t.getColumnRowIndexById(o.id).row;if("above"==e?--a:"below"==e&&(a+=o.mergeRow-1),i=i||1,!(t._rowHeight.length+i>b.DEFAULT_TABLE_ROW_COLUMN_MAX_COUNT)){t.startBatch("add-row");var r,l=t._columnWidth,s=$.extend(!0,[],t.attributes.items);s.forEach(function(e,t){for(r=0;r<i;r++)e.splice(a,0,{label:"",width:l[t],height:o.height||b.DEFAULT_TABLE_ROW_HEIGHT})}),t.set("items",s),t.stopBatch("add-row"),this._updateHighlightedCells()}}},removeRow:function(){var e=this,t=e.getHighlightedCells();if(1==t.length){var i=t[0],n=e.getColumnRowIndexById(i.id).row-1,o=i.mergeRow;if(e._rowHeight.length-o!=0){e.startBatch("remove-row");var a,r,l,s,d,c=$.extend(!0,[],e.attributes.items),p=0,g=n+o;c.forEach(function(e){for(p=a=0;p<e.length;p++){if(l=e[p].mergeRow,r=a+l,a<n&&g<=r){e[p].mergeRow-=o;break}if(1<l&&1<o&&n<=r-1&&r<g){e[p].mergeRow-=r-n,e.splice(p+1,g-r);break}if(a==n){for(d=Math.min(p+o,e.length),s=p;s<d;)l=e[s].mergeRow,a+l<=g?(e.splice(s,1),d-=l,a+=l):(e[s].mergeRow-=g-a,s+=l);break}if(n<a)break;a+=l}}),e.set("items",c),e.stopBatch("remove-row"),this._updateHighlightedCells()}}},addColumn:function(e,t){var i=this,n=i.getHighlightedCells();if(1==n.length){var o=n[0],a=i.getColumnRowIndexById(o.id).col;if("left"==e?--a:"right"==e&&(a+=o.mergeColumn-1),t=t||1,!(i._columnWidth.length+t>b.DEFAULT_TABLE_ROW_COLUMN_MAX_COUNT)){i.startBatch("add-column");for(var r=i._rowHeight,l=$.extend(!0,[],i.attributes.items),s=[],d=0;d<r.length;d++)s.push({label:"",width:o.width||b.DEFAULT_TABLE_COLUMN_WIDTH,height:r[d]});for(var c=0;c<t;c++)l.splice(a,0,s);i.set("items",l),i.stopBatch("add-column"),this._updateHighlightedCells()}}},removeColumn:function(){var t=this,e=t.getHighlightedCells()[0],i=t.getColumnRowIndexById(e.id).col-1,n=e.mergeColumn;if(t._columnWidth.length-n!=0){t.startBatch("remove-column");var o,a,r,l,s,d,c,p=$.extend(!0,[],t.attributes.items),g=i+n;for(o=0;o<g;o++)for(s=p[o],a=0;a<s.length;a++)if(r=o+(l=(e=s[a]).mergeColumn),1!=l)if(o<=i&&g<=r)e.mergeColumn-=n;else if(i<r&&r<g)e.mergeColumn-=r-i;else if(i<o&&g<r){if(d=t.getColumnRowIndexById(e.id).row,1==(c=r-g))continue;p[g].forEach(function(e){d==t.getColumnRowIndexById(e.id).row&&(e.mergeColumn=c)})}p.splice(i,n),t.set("items",p),t.stopBatch("remove-column"),this._updateHighlightedCells()}},onChange:function(e,t){t.record!==this.id&&this.hasChanged("markup")&&!t.commandManager&&ce("Markup can not be modified."),this.anyHasChanged(this.markupAttributes)&&this.buildMarkup(t)},buildMarkup:function(e){if(this.isBuildingMarkup=!0,3==arguments.length){var t=arguments[2];e=de.util.assign({relativeDirection:t.relativeDirection,trueDirection:t.trueDirection,direction:t.direction},e)}var i=this.metrics={},n=i.items={},o=this.attributes,a=o.itemHeight,r=o.itemOffset,l=!!o.itemOverflow,s=o.items;Array.isArray(s)||(s=[]);var d=s.length,c=0,p=0,g=de.util.cloneDeep(this.markup);Array.isArray(g)||ce("Expects Prototype JSON Markup.");var h,u,f=de.util.normalizeSides(o.padding),m=0,_=0,v=[],b=[];this.setCellInfo();for(var T=0;T<d;T++){for(var C=[],E=[],I=[],y=[],A=[],D=Array.from(s[T]),S=this.createQueue(D,0,[],null),w=0,L=0,x=0,O=0;0<S.length;){var N=S.pop(),R=N.path,B=N.level,M=N.item,P=N.parent;0===B&&R.splice(1,0,T);var H,F,k=M.id,U=-1!==B,G=M.height||a,V=M.width||0,W=M.icon,z=M.items,Y=!!M.highlighted,X=!!M.collapsed,$=M.vAlign||"middle",Z=M.hAlign||"start",j=Array.isArray(z)&&0<z.length;H=M.mergeRow?M.mergeRow:M.mergeRow=1,F=M.mergeColumn?M.mergeColumn:M.mergeColumn=1,k||ce("Item id required."),n.hasOwnProperty(k)&&ce("Duplicated item id.");var K=n[k]={path:R,visible:U,parent:P,label:M.label,height:G,width:V,group:T,fill:M.fill,hasSubItems:j,highlighted:Y,collapsed:X,mergeRow:H,mergeColumn:F,vAlign:$,hAlign:Z};if(j&&(K.children=z.map(function(e){return e.id}),Array.prototype.push.apply(S,this.createQueue(z,X||!U?-1:B+1,R,k))),U){var J=r*B;if(K.x=J+r,K.y=w,K.cx=J+r/2,K.cy=w+G/2,K.span=M.span||1,k){var q=this.getItemBodyMarkup(M,J,w,T,l&&0===T?f.left:0);C.push(q);var Q=this.getItemLabelMarkup(M,J,w,T);E.push(Q),j&&(I.push(this.getButtonMarkup(M,J,w,T)),X||A.push(k)),W&&(y.push(this.getIconMarkup(M,J,w,T)),K.x+=o.itemIcon.width+o.itemIcon.padding)}x=Math.max(x,V);for(var ee=O;ee<O+H;ee++)w+=this._rowHeight[ee];L=Math.max(L,V),O+=H}}m=Math.max(x,m),_=Math.max(_,O),c=Math.max(c,w),p+=L,o.items=s;var te=[];g.splice(3,0,{tagName:"g",selector:this.getSelector("group",T),groupSelector:"groups",attributes:{"record-group":T},children:te}),te.push({tagName:"g",selector:this.getSelector("bodiesGroup",T),groupSelector:"bodiesGroups",children:C},{tagName:"g",selector:this.getSelector("labelsGroup",T),groupSelector:"labelsGroups",children:E}),0<A.length&&te.push({tagName:"g",selector:this.getSelector("forksGroup",T),groupSelector:"forksGroups",children:A.map(this.getForkMarkup,this)}),0<I.length&&te.push({tagName:"g",selector:this.getSelector("buttonsGroup",T),groupSelector:"buttonsGroups",children:I}),0<y.length&&te.push({tagName:"g",selector:this.getSelector("iconsGroup",T),groupSelector:"iconsGroups",children:y})}i.padding=f,i.groupsCount=d,i.overflow=l,i.minHeight=c+f.top+f.bottom,i.minWidth=p+f.left+f.right;var ie=0,ne=0,oe=this._columnWidth,ae=this._rowHeight;if(1<d){g.push({tagName:"g",selector:this.getSelector("columnHandleGroup",0),groupSelector:"columnHandleGroups",children:v});for(var re=1;re<d;re++)ie+=oe[re-1],h=this.getColumnHandleMarkup(ie,c,re),v.push(h)}if(1<_){g.push({tagName:"g",selector:this.getSelector("rowHandleGroup",0),groupSelector:"rowHandleGroups",children:b});for(var le=1;le<ae.length;le++)ne+=ae[le-1],u=this.getRowHandleMarkup(ne,p,le),b.push(u)}var se=de.util.assign({record:this.id},e);this.set("markup",g,se),this.autoresize(se),this.isBuildingMarkup=!1},autoresize:function(e){var t=this.getMinimalSize();e=$.extend(!0,{preventSetGridPoint:!0},e),this.resize(t.width,t.height,e)},setCellInfo:function(){var e=this.attributes.items,t=e.length;if(0!=t){var i,n,o,a,r,l=this._rowHeight=[],s=this._rowHeightRatio=[],d=0,c=this._columnWidth=[],p=this._columnWidthRatio=[],g=0,h=1/0,u=1/0;for(o=0;o<t;o++)r=e[o],i=0,r.forEach(function(e){n=e.mergeRow||1,e.id="col"+(o+1)+"-row"+(i+1),c[o]=e.width,l[i]=e.height,i+=n,e.fill=e.fill||"#ffffff",e.width<h&&(h=e.width),e.height<u&&(u=e.height)});for(o=0;o<c.length;o++)g+=c[o];for(a=0;a<l.length;a++)d+=l[a];for(o=0;o<c.length;o++)p.push(c[o]/g);for(a=0;a<l.length;a++)s.push(l[a]/d);this.prop("binding/minWidth",g*b.GRAPHIC_MIN_WIDTH/h),this.prop("binding/minHeight",d*b.GRAPHIC_MIN_HEIGHT/u)}},getColumnHandleMarkup:function(e,t,i){var n="col-resize-"+i,o={x:e,y:0,height:t,width:1,stroke:"transparent","resize-id":n,cursor:"e-resize",fill:"transparent"};return{tagName:"rect",selector:this.getSelector("columnHandle",n),groupSelector:this.getGroupSelector("columnHandles",i),className:"column-resize",attributes:o}},getRowHandleMarkup:function(e,t,i){var n="row-resize-"+i,o={x:0,y:e,height:1,width:t,stroke:"transparent","resize-id":n,cursor:"n-resize",fill:"transparent"};return{tagName:"rect",selector:this.getSelector("rowHandle",n),groupSelector:this.getGroupSelector("rowHandles",i),className:"row-resize",attributes:o}},getItemLabelMarkup:function(e,t,i,n){var o=this.getColumnRowIndexById(e.id),a=this.attributes,r=a.itemOffset,l=e.height||a.itemHeight;if(1<e.mergeRow)for(var s=o.row;s<o.row+e.mergeRow-1;s++)l+=this._rowHeight[s];var d=e.width||0;if(1<e.mergeColumn)for(var c=o.col;c<o.col+e.mergeColumn-1;c++)d+=this._columnWidth[c];var p=e.id,g=t+r;e.icon&&(g+=a.itemIcon.width+2*a.itemIcon.padding);var h=i,u=e.vAlign||"middle",f=e.hAlign||"start";return"middle"==u?h+=l/2:"bottom"==u&&(h+=l),"middle"==f?g+=d/2:"end"==f&&(g+=d),{tagName:"text",className:"record-item-label",selector:this.getSelector("itemLabel",p),groupSelector:this.getGroupSelector("itemLabels",n,e.group),attributes:{x:g,y:h,"item-id":p,text:e.label,width:d-2*r,height:l}}},getItemBodyMarkup:function(e,t,i,n,o){var a=this.getColumnRowIndexById(e.id),r=e.height||this.attributes.itemHeight;if(1<e.mergeRow)for(var l=a.row;l<a.row+e.mergeRow-1;l++)r+=this._rowHeight[l];var s=e.width||0;if(1<e.mergeColumn)for(var d=a.col;d<a.col+e.mergeColumn-1;d++)s+=this._columnWidth[d];var c=e.fill||"#ffffff",p=0;o&&(p-=o);var g={x:p,y:i,height:r,width:s,"item-id":e.id,fill:c,cursor:"default"},h=e.span;return h&&(g["item-span"]=h),{tagName:"rect",selector:this.getSelector("itemBody",e.id),groupSelector:this.getGroupSelector("itemBodies",n,e.group),className:"record-item-body",attributes:g}},onRemove:function(){this.clearHighlighted()}},{defaultBindingProp:{type:"Table",fillColor:"#ffffff",strokeColor:"#000000",strokeWidth:1,strokeDasharray:"0",fontType:b.DEFAULT_FONT_TYPE,fontSize:b.DEFAULT_FONT_SIZE,fontStyle:b.DEFAULT_FONT_STYLE,fontColor:b.DEFAULT_FONT_COLOR},getCursor:function(){return"cursor_table.png"},attributes:{itemText:{set:function(e,t,i,n){if(!de.util.isPlainObject(e))return null;var o=this.model,a=i.getAttribute("item-id"),r=o.metrics.items[a];if(r){var l=r.label,s=o.getColumnRowIndexById(a),d=o._columnWidth,c=r.x,p=2*-c+d[s.col-1];if(1<r.mergeColumn)for(var g=s.col;g<s.col+r.mergeColumn-1;g++)p+=d[g];var h,u,f=new y.Rect(c,r.y,p,r.height);u=e.textWrap?(h="textWrap",{text:l,ellipsis:e.ellipsis}):(h="text",l),this.getAttributeDefinition(h).set.call(this,u,f,i,n)}}},itemHighlight:{set:function(e,t,i,n){if(!de.util.isPlainObject(e))return null;var o=this.model,a=i.getAttribute("item-id");switch(o.getItemCacheAttribute(a,"highlighted")){case!0:return e;case null:case!1:return Object.keys(e).reduce(function(e,t){return!(n.hasOwnProperty(t)||n.hasOwnProperty(de.util.camelCase(t)))&&i.getAttribute(t)&&(e[t]=null),e},{})}}},groupWidth:{set:function(e,t,i){var n=this.model.metrics,o=i.getAttribute("item-id"),a=n.items[o],r=this.model.getColumnRowIndexById(o),l=a.width||0;if(1<(a.mergeColumn||1))for(var s=r.col;s<r.col+a.mergeColumn-1;s++)l+=this.model._columnWidth[s];return{width:l}}},groupPosition:{position:function(e,t,i){var n,o=Number(i.getAttribute("record-group")),a=this.model.metrics,r=a.padding,l=a.items,s={};for(var d in l)(n=d.split("-")[0]).split("col")[1]>o||(s[n]=l[d].width);var c=0;for(n in s)c+=s[n];var p=r.left+c,g=r.top;return new y.Point(p,g)}}}}),O=_.define("hmi.HyperLink",{attrs:{body:{rx:10,ry:10,strokeWidth:1,stroke:b.DEFAULT_STROKE_COLOR,strokeDasharray:"0",fill:"#ffffff",width:160,height:40},label:{fontSize:b.DEFAULT_FONT_SIZE,text:"",cursor:"default",refY2:0,event:"event:hyperlink:click",textDecoration:"underline"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],attachEvent:function(){var a=this;p.prototype.attachEvent.apply(a,arguments),a.once("graph:add",function(){a.isEditableCanvas()||a.attr("label",{cursor:"pointer"})}),a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/label"==n?a.setLabel(o):"binding/fontStyle"==n?a.attr("label/fontStyle",o):"binding/fontWeight"==n?a.attr("label/fontWeight",o):"binding/fontType"==n?a.attr("label/fontFamily",o):"binding/fontSize"==n?a.attr("label/fontSize",o):"binding/fontColor"==n?a.attr("label/fill",o):"binding/vAlign"!=n&&"binding/hAlign"!=n||a.updateAlign()})},setTextAlign:function(e,t){this.prop(e,t)},getTextAlign:function(e){return this.prop("binding/"+e)},setLabel:function(e){this.attr("label/text",e),setTimeout(this.autoResize.bind(this),0)},getLabel:function(){return this.prop("binding/label")},setFile:function(e){this.prop("binding/file",e)},getFile:function(){return this.prop("binding/file")},autoResize:function(){var e=this.getCurrentView();if(e){var t=e.findBySelector("label")[0];if(t){var i=b.DEFAULT_TEXT_PADDING,n=t.getBBox(),o=this.size(),a=n.width+i,r=n.height+i;a<o.width&&(a=o.width),r<o.height&&(r=o.height),this.resize(a,r)}}},setBindingData:function(e){f.prototype.setBindingData.call(this,e);var t=e.file,i=e.label;t&&this.prop("binding/file",t),this.prop("binding/label",i)},getGraphicBindingPopupData:function(){var e=f.prototype.getGraphicBindingPopupData.call(this),t=this.prop("binding");return e.label=t.label,e.file=t.file,e},updateAlign:function(){var e,t,i,n,o=this,a=o.prop("binding/vAlign"),r=o.prop("binding/hAlign");"top"==a?(t=0,n=b.DEFAULT_TEXT_LABEL_PADDING,o.attr("label/textVerticalAnchor","top")):"bottom"==a?(t="100%",n=-b.DEFAULT_TEXT_LABEL_PADDING,o.attr("label/textVerticalAnchor","bottom")):(t="50%",n=0,o.attr("label/textVerticalAnchor","middle")),"right"==r?(e="100%",i=-b.DEFAULT_TEXT_LABEL_PADDING,o.attr("label/textAnchor","end")):"left"==r?(e=0,i=b.DEFAULT_TEXT_LABEL_PADDING,o.attr("label/textAnchor","start")):(e="50%",i=0,o.attr("label/textAnchor","middle")),o.attr("label",{refX:e,refY:t,refX2:i,refY2:n})}},{defaultBindingProp:{type:"HyperLink",strokeWidth:1,strokeColor:b.DEFAULT_STROKE_COLOR,fillColor:"#ffffff",opacity:1,fontStyle:"normal",fontType:b.DEFAULT_FONT_TYPE,fontColor:"#000000",file:{id:0,name:"-"},label:"-",vAlign:"middle",hAlign:"center"}}),N=n(de.shapes.standard.Polygon,"hmi.Zone",{attrs:{body:{fill:b.DEFAULT_ZONE_COLOR_ALPHA,stroke:b.DEFAULT_ZONE_COLOR,refPoints:"0,0 0,1 1,1 1,0",event:"event:zoneclick"}}},{markup:[{tagName:"polygon",selector:"body"}],initialize:function(e){p.prototype.initialize.apply(this,arguments);var t=e.refPoints||[{x:0,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:0}];this.prop("refPoints",t),this.initializeOptions(e,{size:{width:b.DEFAULT_ZONE_WIDTH,height:b.DEFAULT_ZONE_HEIGHT}});var i=this.prop("binding");this.setColor(i.fillColor)},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/fillColor"==n?a.setColor(o):"binding/strokeColor"==n?a.attr("body/stroke",o):"binding/strokeWidth"==n?a.attr("body/strokeWidth",o):"binding/strokeDasharray"==n?a.attr("body/strokeDasharray",o):"binding/fontSize"==n?(a.attr("label/fontSize",o),a.setZoneName()):"binding/fontType"==n?(a.attr("label/fontFamily",o),a.setZoneName()):"binding/fontStyle"==n?(a.attr("label/fontStyle",o),a.setZoneName()):"binding/fontWeight"==n?(a.attr("label/fontWeight",o),a.setZoneName()):"binding/fontColor"==n&&a.attr("label/fill",o)})},setColor:function(e){var t=1;9==e.length&&(t=Math.round(100*parseInt(e.slice(7,9),16))/100,e=e.slice(0,7));var i=window.kendo.parseColor(e),n=this._isSelected?b.DEFAULT_ZONE_COLOR_ALPHA_SELECTED:b.DEFAULT_ZONE_COLOR_ALPHA;this.attr("body/fill","rgba("+i.r+","+i.g+","+i.b+","+t*n+")")},getIndoorsInnerZone:function(){var t=this,e=t.graph.getCells(),i=[],n=[];e.forEach(function(e){"Indoor"==e.prop("binding/type")&&i.push(e)});var o,a,r=t.position();return i.forEach(function(e){o=e.getBBox(),a={x:o.x-r.x+o.width/2,y:o.y-r.y+o.height/2},t.isContainsPoint(a.x,a.y)&&n.push(e)}),n},toggleZoneSelect:function(){var e=this,t=e._isSelected=!e._isSelected;e.setColor(e.prop("binding/fillColor"));var i=e.getIndoorsInnerZone(),n=e.getCanvas();i.forEach(function(e){e.setSelected(t),n&&n.selectIndoorDevice()})},setZoneSelectedByInnerIndoorsSelected:function(){var t,e=this.getIndoorsInnerZone(),i=!0;e.forEach(function(e){t=e.prop("binding/selected"),i=i&&t}),this._isSelected=i,this.setColor(this.prop("binding/fillColor"))},isContainsPoint:function(e,t){var i,n=this.getRefPoints(),o=n.length,a=o-1,r=!1;for(i=0;i<o;i++)n[i].y>t!=n[a].y>t&&e<n[i].x+(n[a].x-n[i].x)*(t-n[i].y)/(n[a].y-n[i].y)&&(r=!r),a=i;return r},addPoint:function(e,t){var i=this.getRefPoints();this.startBatch("add:refPoint");var n=this.getRefByOffset(e.offsetX,e.offsetY);i.splice(t+1,0,{x:n.x,y:n.y}),this.prop("refPoints",i),this.setSize(),this.setAttrRefPoints(),this.stopBatch("add:refPoint")},changeRefPoint:function(e,t){for(var i=this.getRefPoints(),n=i.length;t<0;)t+=n;this.startBatch("change:refPoints"),this._isChangingPoint=!0;var o=this.getRefByOffset(e.offsetX,e.offsetY);i[t].x=o.x,i[t].y=o.y,this.prop("refPoints",i),this.setSize(),this.setAttrRefPoints(),this._isChangingPoint=!1,this.stopBatch("change:refPoints")},removeRefPoint:function(e){var t=this.getRefPoints(),i=t.length;if(!(i<4)){for(;e<0;)e+=i;this.startBatch("remove:refPoint"),t.splice(e,1),this.prop("refPoints",t),this.setSize(),this.setAttrRefPoints(),this.stopBatch("remove:refPoint")}},getRefByOffset:function(e,t){var i=this.getBBox(),n=i.center(),o=this.get("angle");o=o*Math.PI/-180,t=0<t?t:0;var a=(e=0<e?e:0)-n.x,r=t-n.y,l=a*Math.cos(o)-r*Math.sin(o),s=a*Math.sin(o)+r*Math.cos(o);return{x:l+n.x-i.x,y:s+n.y-i.y}},getRefPoints:function(){return $.extend(!0,[],this.prop("refPoints"))},setSize:function(){var t,i,n,o,e=this,a=e.getRefPoints(),r=e.getBBox(),l=null;if(!(a.length<3)){t=i=a[0].x,n=o=a[0].y,a.forEach(function(e){e.x>t&&(t=e.x),e.x<i&&(i=e.x),e.y>n&&(n=e.y),e.y<o&&(o=e.y)}),a.forEach(function(e){e.x-=i,e.y-=o});var s=t-i,d=n-o,c="";if(c+=0!=o?"top-":"bottom-",c+=0!=i?"left":"right",0===s&&0===d?l=null:0===i&&t!==r.width&&0!==o&&n===r.height?l="top-right":0===i&&t!==r.width&&0===o&&n===r.height?l="right":0!==i&&t===r.width&&0!==o&&n===r.height?l="top-left":0===i&&t===r.width&&0!==o&&n===r.height?l="top":0!==i&&t===r.width&&0===o&&n!==r.height?l="bottom-left":0!==i&&t===r.width&&0===o&&n===r.height?l="left":0===i&&t!==r.width&&0===o&&n!==r.height?l="bottom-right":0===i&&t===r.width&&0===o&&n!==r.height&&(l="bottom"),e.prop("refPoints",a),l){var p=this.get("size");switch(l){case"left":case"right":d=p.height;break;case"top":case"bottom":s=p.width}var g=y.normalizeAngle(this.get("angle")||0),h={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[l],u=r[["bottomLeft","corner","topRight","origin"][h]](),f=y.point(u).rotate(r.center(),-g),m=Math.sqrt(s*s+d*d)/2,_=h*Math.PI/2;_+=Math.atan(h%2==0?d/s:s/d),_-=y.toRad(g);var v=y.point.fromPolar(m,_,f),b=y.point(v).offset(s/-2,d/-2);this.set("size",{width:s,height:d}),this.position(b.x,b.y,{preventSetGridPoint:!0})}else e._isSetSize=!0,e.translate(i,o),e.resize(s,d,{trueDirection:c}),e._isSetSize=!1}},setAttrRefPoints:function(){var e=this.getRefPoints(),t="";e.forEach(function(e){t+=e.x+","+e.y+" "}),t=t.trim(),this.attr("body/refPoints",t)},resize:function(t,i,e){var n=this,o=this.getBBox(),a=o.width,r=o.height;this.startBatch("change:size"),e=$.extend(!0,e,{preventSetGridPoint:!0}),f.prototype.resize.call(n,t,i,e);var l=this.getRefPoints();l.length<3||(l.forEach(function(e){n._isSetSize||(e.x=0<a?e.x*t/a:e.x,e.y=0<r?e.y*i/r:e.y)}),n.prop("refPoints",l),n.stopBatch("change:size"))},isPointAroundContainsPoints:function(t){var e=this.getRefPoints(),i=!1;return t=this.getRefByOffset(t.x,t.y),e.forEach(function(e){new y.Point(e.x,e.y).distance(t)<7&&(i=!0)}),i},isPointOnLine:function(e){var t=this.getBBox(),i=!1;if(!new y.Rect(t.x-2,t.y-2,t.width+4,t.height+4).containsPoint(e))return i;e=this.getRefByOffset(e.x,e.y);var n,o,a,r,l,s=this.getRefPoints(),d=s.length;for(n=0;n<d;n++)if(o=new y.Point(s[n].x,s[n].y),a=new y.Point(s[(n+1)%d].x,s[(n+1)%d].y),r=this.getShortestLengthBetweenPointAndLine(o,a,e),l=new y.Line(o,a).length()+3,r.length<=3&&r.point.distance(o)<l&&r.point.distance(a)<l){i=!0;break}return i?{sp:n,cp:r.point}:i},getShortestLengthBetweenPointAndLine:function(e,t,i){var n,o,a,r=t.y-e.y,l=-(t.x-e.x),s=(t.x-e.x)*e.y-(t.y-e.y)*e.x;return{point:0==r&&0==l?(n=i.distance(new y.Point(e.x,e.y)),new y.Point(e.x,e.y)):(n=Math.abs(r*i.x+l*i.y+s)/Math.sqrt(r*r+l*l),o=(l*l*i.x-r*l*i.y-r*s)/(r*r+l*l),a=0==l?i.y:(r*r*i.y-r*l*i.x)/(r*r+l*l)+r*r*s/(r*r+l*l)/l-s/l,new y.Point(o,a)),length:n}}},{defaultBindingProp:{type:"Zone",initHeight:b.DEFAULT_ZONE_HEIGHT,initWidth:b.DEFAULT_ZONE_WIDTH,fillColor:b.DEFAULT_ZONE_COLOR,strokeColor:b.DEFAULT_ZONE_COLOR,strokeWidth:1,strokeDasharray:"0",fontColor:"#ffffff",fontStyle:b.DEFAULT_FONT_STYLE,fontType:b.DEFAULT_FONT_TYPE,fontSize:b.DEFAULT_FONT_SIZE}}),R=n(de.shapes.standard.Image,"hmi.Image",{attrs:{image:null,side:{refX:0,refY:0,refWidth:1,refHeight:1,strokeWidth:0,stroke:"transparent",strokeDasharray:"0",fill:"transparent"},label:{fontSize:b.DEFAULT_FONT_SIZE,fontFamily:b.DEFAULT_FONT_TYPE,fontStyle:b.DEFAULT_FONT_STYLE,refY2:0}}},{markup:[{tagName:"rect",selector:"side"},{tagName:"image",selector:"body"},{tagName:"text",selector:"label"}],initialize:function(e){f.prototype.initialize.apply(this,arguments);var t=e.paletteItem;this.initializeOptions(e,{size:this.getInitialImageSize(t.value,e.widthFactor,e.heightFactor),attrs:{"body/href":g.addBuildDateQuery(t.imageUrl)}}),this.setImageTransform(),this._attachImageResizeEvt()},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/state/on/graphicColor"==n||"binding/state/off/graphicColor"==n||"binding/value"==n||"binding/reverse"==n?this.updateBindingValue():"binding/visible"==n?a._setVisible(o):"binding/vFliped"==n||"binding/hFliped"==n?(a.setImageTransform(),a.flipAngle(n)):"binding/device"==n?a.setDevice(o):"binding/fontType"==n?a.attr("label/fontFamily",o):"binding/fontSize"==n?a.attr("label/fontSize",o):"binding/fontStyle"==n?a.attr("label/fontStyle",o):"binding/fontWeight"==n?a.attr("label/fontWeight",o):"binding/strokeColor"==n?a.attr("side/stroke",o):"binding/strokeWidth"==n?a.attr("side/strokeWidth",o):"binding/strokeDasharray"==n&&a.attr("side/strokeDasharray",o)})},_attachImageResizeEvt:function(){var i=this;i.on("change:size",function(e,t){i.setImageTransform(t.width,t.height)})},_updateImageColorFromState:function(e){var t,i=this,n=i.prop("binding/graphicColor");"off"==e||"stop"==e?n=i.prop("binding/state/off/graphicColor"):"on"!=e&&"rotate"!=e||(n=i.prop("binding/state/on/graphicColor")),t="transparent"==n?(i.setVisible(!1),i.getImageUrl("gray")):(i.setVisible(!0),i.getImageUrl(n)),i.attr("body/href",g.addBuildDateQuery(t))},updateBindingValue:function(){var e=this.getValue(),t=this.getCurrentState(e);this._updateImageColorFromState(t)},getImageUrl:function(e){var t=this.getPaletteItem(),i=t.imageUrl;return t.images&&t.images[e]&&(i=t.images[e]),i},getInitialImageSize:function(e,t,i){t=t||2,i=i||2,"number"==typeof e&&(e=""+e),"HMI_DUCT_CROSS"==e?i=t=8:"HMI_DUCT_H"==e?(t=7.845,i=6.86):"HMI_DUCT_HOLE"==e?i=t=3.74:"HMI_DUCT_HORZSTRAIGHT"==e?(t=7.72,i=2.24):"HMI_DUCTS_HORZSTRAIGHT_HARF"==e?(t=3.26,i=2.24):"HMI_DUCT_L_DOWN_LEFT"==e||"HMI_DUCT_L_DOWN_RIGHT"==e||"HMI_DUCTS_L_UP_LEFT"==e||"HMI_DUCTS_L_UP_RIGHT"==e?t=i=5.06:"HMI_DUCT_SEPARATION_2_LEFT"==e?(t=7.44,i=4.06):"HMI_DUCT_SEPARATION_3_LEFT"==e?(t=8.02,i=5.9):"HMI_DUCTS_SEPARATION_3RIGHT"==e?(t=8.02,i=5.9):"HMI_DUCTS_SEPERATE_2RIGHT"==e?(t=8.02,i=4.08):"HMI_DUCTS_T_DOWN"==e?(t=8.08,i=5.04):"HMI_DUCTS_T_UP"==e?(t=8.08,i=5.04):"HMI_DUCTS_T_LEFT"==e?(i=7.82,t=5.22):"HMI_DUCTS_T_RIGHT"==e?(i=7.82,t=5.22):"HMI_DUCTS_VERTSTRAIGHT"==e?(i=7.86,t=2.52):"HMI_DUCTS_VERTSTRAIGHT_HARF"==e?(t=2.52,i=3.28):e.includes("ARROW")?i=t=1:e.includes("HMI_BOILER")?i=t=5.5:e.includes("HMI_CHILLER1")||e.includes("HMI_CHILLER2")?(t=4.44,i=2.54):"HMI_DUCTSVENTILATING"==e?i=t=2.75:e.includes("CONNECTPIPES_DOWNR")||e.includes("CONNECTPIPES_DOWNL")||e.includes("CONNECTPIPES_UPR")||e.includes("CONNECTPIPES_UPL")||e.includes("PIPES_L")?i=t=1.2:"HMI_BUTTON"==e?i=t=.8:-1!==e.indexOf("HMI_LED")?i=t=1.2:"HMI_POWER_GRAPHIC_TEXT"==e&&(i=t=4);var n=b.DEFAULT_NODE_WIDTH*t,o=b.DEFAULT_NODE_HEIGHT*i,a=this.getPaletteItem(),r=D.getKeepRatioSize(a.imageWidth,a.imageHeight,n,o);return n=r.width,o=r.height,this.prop("binding/initWidthRatio",n),this.prop("binding/initHeightRatio",o),{width:n=l(n),height:o=l(o)}},setBindingData:function(e){f.prototype.setBindingData.call(this,e);var t=e.graphicColorOn,i=e.graphicColorOff,n=e.graphicColor,o=e.reverse,a=e.visible;n&&this.prop("binding/graphicColor",n),t&&this.prop("binding/state/on/graphicColor",t),i&&this.prop("binding/state/off/graphicColor",i),this.prop("binding/reverse",o),this.prop("binding/visible",a)},getGraphicBindingPopupData:function(){var e=f.prototype.getGraphicBindingPopupData.call(this),t=this.prop("binding");return e.graphicColor=t.graphicColor,e.graphicColorOn=this.prop("binding/state/on/graphicColor"),e.graphicColorOff=this.prop("binding/state/off/graphicColor"),e},setImageTransform:function(e,t){var i=this.getBBox();e=e||i.width,t=t||i.height;var n=this.prop("binding"),o=n.initWidthRatio,a=n.initHeightRatio,r=1,l=1,s=0,d=n.hFliped?-1:1,c=n.vFliped?-1:1;a/o<t/e?l=t/e*o/a:r=e/t*a/o,r*=c*d,s=c*d==-1?i.width:s,this.attr("body",{refWidth:Math.abs(100/r)+"%",refHeight:Math.abs(100/l)+"%",transform:"translate("+s+",0) scale("+r+","+l+")"})}},{defaultBindingProp:{type:"Image",graphicColor:"gray",state:{off:{graphicColor:"gray",text:"",svgTextColor:"#ffffff"},on:{graphicColor:"red",text:"",svgTextColor:"#ffffff"}},strokeWidth:0,strokeColor:"transparent",strokeDasharray:"0"}}),B=R.define("hmi.ImportImage",{},{},{defaultBindingProp:{type:"ImportImage"},getCursor:function(){return null}}),M=R.define("hmi.Animation",{attrs:{}},{initialize:function(e){R.prototype.initialize.apply(this,arguments),this.updateBindingValue()},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n?a._setVisible(o):"binding/device"==n?a.setDevice(o):"binding/reverse"==n||"binding/value"==n||"binding/graphicColor"==n||"binding/state/on/graphicColor"==n||"binding/state/off/graphicColor"==n||"binding/gauge"==n||"binding/minValue"==n||"binding/maxValue"==n?(this.updateBindingValue(),this._onBindingValueTrigger()):"binding/vFliped"==n||"binding/hFliped"==n?(a.setImageTransform(),a.flipAngle(n)):"binding/fontType"==n?a.attr("label/fontFamily",o):"binding/fontSize"==n?a.attr("label/fontSize",o):"binding/fontStyle"==n?a.attr("label/fontStyle",o):"binding/fontWeight"==n&&a.attr("label/fontWeight",o)})},control:function(){this.isEditableCanvas()||this.patchDigitalTypeControlValue().always(function(){})},getImageUrl:function(e,t){var i,n=this.getPaletteItem();t&&e&&(i=e+"_"+t);var o=n.imageUrl,a=n.images;return a&&(a[i]?o=a[i]:a[t]?o=a[t]:a[e]&&(o=a[e])),o},updateBindingValue:function(){var e,t,i=this,n=i.getValue(),o=i.prop("binding/categoryName"),a=1;"Gauge"==o&&(a=i.prop("binding/gauge")),D.isMultiLevelGraphic(o)&&(e=i.prop("binding/minValue"),t=i.prop("binding/maxValue"));var r=i.getCurrentState(n,a,e,t);i._updateImageColorFromState(r)},_onBindingValueTrigger:function(){var e,t,i,n=this,o=n.getValue(),a=n.prop("binding/categoryName");"Gauge"==a&&(e=n.prop("binding/gauge")),D.isMultiLevelGraphic(a)&&(t=n.prop("binding/minValue"),i=n.prop("binding/maxValue"));var r=n.getCurrentState(o,e,t,i),l=n.prop("binding/visible"),s=n.prop("binding/device");if(n.isEditableCanvas())"Alarm"==a?n._setVisible(!0):"Wind"==a&&null!=o&&l&&("on"==r?n._setVisible(!0):n._setVisible(!1));else if("Wind"==a)"off"==r?n._setVisible(!1):l&&n._setVisible(!0);else if("Alarm"==a){var d=n.prop("binding/minValue"),c=n.prop("binding/maxValue");l&&(D.isDigitalType(s.type)?"on"==r?(n._setVisible(!0),n._updateImageColorFromState("on"),b.SoundPlayer.playing()||b.SoundPlayer.play()):(n._updateImageColorFromState("off"),n._setVisible(!1),b.SoundPlayer.stop()):null!=o&&(o<d||c<o)?(n._setVisible(!0),n._updateImageColorFromState("on"),b.SoundPlayer.playing()||b.SoundPlayer.play()):(n._updateImageColorFromState("off"),n._setVisible(!1),b.SoundPlayer.stop()))}},_updateImageColorFromState:function(e){var t,i=this,n=i.prop("binding/graphicColor");"off"==e||"stop"==e?n=i.prop("binding/state/off/graphicColor"):"on"!=e&&"rotate"!=e||(n=i.prop("binding/state/on/graphicColor")),t="transparent"==n?(i.setVisible(!1),i.getImageUrl("gray",e)):(i.setVisible(!0),i.getImageUrl(n,e)),i.attr("body/href",g.addBuildDateQuery(t))},setBindingData:function(e){R.prototype.setBindingData.call(this,e);var t=e.gauge,i=e.minValue,n=e.maxValue;this.prop("binding/gauge",t),this.prop("binding/minValue",i),this.prop("binding/maxValue",n)},getGraphicBindingPopupData:function(){var e=R.prototype.getGraphicBindingPopupData.call(this);return e.minValue=this.prop("binding/minValue"),e.maxValue=this.prop("binding/maxValue"),e.gauge=this.prop("binding/gauge"),e}},{defaultBindingProp:{type:"Animation",gauge:1,minValue:0,maxValue:100}}),P=M.define("hmi.Button",{},{attachEvent:function(){M.prototype.attachEvent.apply(this,arguments);var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/textLocation"==n||"binding/buttonType"==n||"binding/state/on/svgTextColor"==n||"binding/state/off/svgTextColor"==n||"binding/state/on/text"==n||"binding/state/off/text"==n?this.updateBindingValue():"binding/fontColor"==n&&this.setFontColor(o)}),a.on("event:pointerdown",a.controlPointerDown.bind(a)),a.on("event:pointerup",a.controlPointerUp.bind(a))},controlPointerDown:function(){var e=this;if(!e.isEditableCanvas()){var t=e.prop("binding/buttonType");if("Push"==t||"Momentary"==t){var i=e.getValue(),n=e.getCurrentState(i);e._pushButtonState=n}e.patchDigitalTypeControlValue().always(function(){})}},controlPointerUp:function(){var e=this;if(!e.isEditableCanvas()){var t=e.prop("binding/buttonType");"Push"!=t&&"Momentary"!=t||e._pushButtonState&&e._updateImageColorFromState(e._pushButtonState),"Momentary"==t&&e.patchDigitalTypeControlValue(!1,!0).always(function(){})}},setFontColor:function(e){var t=this.getValue();"on"==this.getCurrentState(t)?this.prop("binding/state/on/svgTextColor",e):this.prop("binding/state/off/svgTextColor",e)},getFontColor:function(){var e=this.getValue();return"on"==this.getCurrentState(e)?this.prop("binding/state/on/svgTextColor"):this.prop("binding/state/off/svgTextColor")},_updateImageColorFromState:function(e){M.prototype._updateImageColorFromState.call(this,e),this.updateTextFromState(e)},setBindingData:function(e){var t=this;M.prototype.setBindingData.call(this,e);var i,n,o,a,r=e.buttonType,l=e.textLocation;r&&t.prop("binding/buttonType",r),e.svgTextOn&&(i=e.svgTextOn.svgTextColorOn,o=e.svgTextOn.textOn),e.svgTextOff&&(n=e.svgTextOff.svgTextColorOff,a=e.svgTextOff.textOff),t.prop("binding/state/on/svgTextColor",i),t.prop("binding/state/off/svgTextColor",n),t.prop("binding/state/on/text",o),t.prop("binding/state/off/text",a),t.prop("binding/textLocation",l)},getGraphicBindingPopupData:function(){var e=this,t=M.prototype.getGraphicBindingPopupData.call(e);return t.buttonType=e.prop("binding/buttonType"),t.textLocation=e.prop("binding/textLocation"),t.svgTextColorOn=e.prop("binding/state/on/svgTextColor"),t.svgTextColorOff=e.prop("binding/state/off/svgTextColor"),t.textOn=e.prop("binding/state/on/text"),t.textOff=e.prop("binding/state/off/text"),t}},{defaultBindingProp:{type:"Button",state:{off:{text:"",svgTextColor:"#000000",graphicColor:"gray"},on:{text:"",svgTextColor:"#000000",graphicColor:"red"}},buttonType:null,textLocation:null}}),H=f.define("hmi.SVGButton",{attrs:{}},{initialize:function(e){f.prototype.initialize.apply(this,arguments)},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n?a._setVisible(o):"binding/device"==n?a.setDevice(o):"binding/reverse"==n||"binding/value"==n||"binding/buttonType"==n||"binding/textLocation"==n||"binding/state/on/svgGraphicColor"==n||"binding/state/off/svgGraphicColor"==n||"binding/state/on/svgTextColor"==n||"binding/state/off/svgTextColor"==n||"binding/state/on/text"==n||"binding/state/off/text"==n?this.updateBindingValue():"binding/fontType"==n?a.attr("label/fontFamily",o):"binding/fontSize"==n?a.attr("label/fontSize",o):"binding/fontColor"==n?a.setFontColor(o):"binding/fontStyle"==n?a.attr("label/fontStyle",o):"binding/fontWeight"==n?a.attr("label/fontWeight",o):"binding/fillColor"==n?a.setFillColor(o):"binding/strokeWidth"==n?a.attr("body/strokeWidth",o):"binding/strokeColor"==n?a.attr("body/stroke",o):"binding/strokeDasharray"==n&&a.attr("body/strokeDasharray",o)}),a.on("event:pointerdown",a.controlPointerDown.bind(a)),a.on("event:pointerup",a.controlPointerUp.bind(a))},controlPointerDown:function(){var e=this;if(!e.isEditableCanvas()){var t=e.prop("binding/buttonType"),i=!1;if("Push"==t||"Momentary"==t){var n=e.getValue(),o=e.getCurrentState(n);e._pushButtonState=o,n=e.getDigitalTypeControlValue(),o=e.getCurrentState(n),e.updateRectColorFromState(o),e.updateTextFromState(o),i=!0}e.patchDigitalTypeControlValue(i).always(function(){})}},controlPointerUp:function(){var e=this;if(!e.isEditableCanvas()){var t=e.prop("binding/buttonType");"Push"!=t&&"Momentary"!=t||e._pushButtonState&&(e.updateRectColorFromState(e._pushButtonState),e.updateTextFromState(e._pushButtonState)),"Momentary"==t&&e.patchDigitalTypeControlValue(!1,!0).always(function(){})}},setFontColor:function(e){var t=this.getValue();"on"==this.getCurrentState(t)?this.prop("binding/state/on/svgTextColor",e):this.prop("binding/state/off/svgTextColor",e)},setFillColor:function(e){var t=this.getValue();"on"==this.getCurrentState(t)?this.prop("binding/state/on/svgGraphicColor",e):this.prop("binding/state/off/svgGraphicColor",e)},getFontColor:function(){var e=this.getValue();return"on"==this.getCurrentState(e)?this.prop("binding/state/on/svgTextColor"):this.prop("binding/state/off/svgTextColor")},getFillColor:function(){var e=this.getValue();return"on"==this.getCurrentState(e)?this.prop("binding/state/on/svgGraphicColor"):this.prop("binding/state/off/svgGraphicColor")},updateBindingValue:function(){var e=this.getValue(),t=this.getCurrentState(e);this.updateRectColorFromState(t),this.updateTextFromState(t)},updateRectColorFromState:function(e){var t;t="on"==e?this.prop("binding/state/on/svgGraphicColor"):this.prop("binding/state/off/svgGraphicColor"),this.attr("body/fill",t)},setBindingData:function(e){var t=this;f.prototype.setBindingData.call(t,e);var i,n,o,a,r=e.svgGraphicColorOn,l=e.svgGraphicColorOff,s=e.reverse,d=e.textLocation,c=e.buttonType;e.svgTextOn&&(i=e.svgTextOn.svgTextColorOn,o=e.svgTextOn.textOn),e.svgTextOff&&(n=e.svgTextOff.svgTextColorOff,a=e.svgTextOff.textOff),c&&t.prop("binding/buttonType",c),t.prop("binding/textLocation",d),t.prop("binding/state/on/svgGraphicColor",r),t.prop("binding/state/off/svgGraphicColor",l),t.prop("binding/state/on/svgTextColor",i),t.prop("binding/state/off/svgTextColor",n),t.prop("binding/state/on/text",o),t.prop("binding/state/off/text",a),this.prop("binding/reverse",s)},getGraphicBindingPopupData:function(){var e=this,t=f.prototype.getGraphicBindingPopupData.call(e);return t.buttonType=e.prop("binding/buttonType"),t.textLocation=e.prop("binding/textLocation"),t.svgGraphicColorOn=e.prop("binding/state/on/svgGraphicColor"),t.svgGraphicColorOff=e.prop("binding/state/off/svgGraphicColor"),t.svgTextColorOn=e.prop("binding/state/on/svgTextColor"),t.svgTextColorOff=e.prop("binding/state/off/svgTextColor"),t.textOn=e.prop("binding/state/on/text"),t.textOff=e.prop("binding/state/off/text"),t}},{defaultBindingProp:{type:"SVGButton",state:{off:{text:"",svgGraphicColor:"#d4d3d4",svgTextColor:"#000000"},on:{text:"",svgGraphicColor:"#ff0000",svgTextColor:"#ffffff"}},buttonType:null,textLocation:null}}),F=H.define("hmi.RectangleButton",{attrs:{body:{strokeWidth:1,stroke:"#000000",fill:"#d4d3d4",refWidth:"100%",refHeight:"100%"},label:{fontSize:b.DEFAULT_FONT_SIZE,textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fill:"#000000"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],initialize:function(e){H.prototype.initialize.apply(this,arguments),this.initializeOptions(e,{size:{width:b.DEFAULT_RECT_GRAPHIC_WIDTH,height:b.DEFAULT_RECT_GRAPHIC_HEIGHT}}),this.updateBindingValue()}},{defaultBindingProp:{type:"RectangleGraphic"}}),k=H.define("hmi.RoundButton",{attrs:{body:{strokeWidth:1,stroke:"#000000",fill:"#d4d3d4",refCx:"50%",refCy:"50%",refRx:"50%",refRy:"50%"},label:{fontSize:b.DEFAULT_FONT_SIZE,textVerticalAnchor:"middle",textAnchor:"middle",refX:"50%",refY:"50%",fill:"#000000"}}},{markup:[{tagName:"ellipse",selector:"body"},{tagName:"text",selector:"label"}],initialize:function(e){f.prototype.initialize.apply(this,arguments),this.initializeOptions(e,{size:{width:b.DEFAULT_ROUND_BUTTON_SIZE,height:b.DEFAULT_ROUND_BUTTON_SIZE}}),this.updateBindingValue()}},{defaultBindingProp:{type:"RectangleGraphic"}}),U=_.define("hmi.Text",{attrs:{body:{strokeDasharray:"0",strokeWidth:1,stroke:"transparent",fill:"transparent"},label:{fontSize:b.DEFAULT_FONT_SIZE,textWrap:{separator:/(\s+)/,width:-(2*b.DEFAULT_TEXT_LABEL_PADDING+2),text:"",hyphen:/[^\n]/},fill:b.DEFAULT_FONT_COLOR,lineHeight:"auto",cursor:"text",textAnchor:"start",refX:0,refX2:b.DEFAULT_TEXT_LABEL_PADDING,refY2:0}}},{initialize:function(e){_.prototype.initialize.apply(this,arguments),this.initializeOptions(e,{size:{width:b.DEFAULT_RECT_GRAPHIC_WIDTH,height:b.DEFAULT_RECT_GRAPHIC_HEIGHT}})},isTextElement:function(e){var t=e.tagName.toUpperCase();return"TEXT"===t||"TSPAN"==t||"TEXTPATH"==t},isEditable:function(){var e=this.prop("binding/propertyType"),t=this.prop("binding/device");return"READ"!=e&&!(!this.isEditableCanvas()||null!==t.id&&void 0!==t.id)},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n?a._setVisible(o):"binding/fontType"==n?a.attr("label/fontFamily",o):"binding/fontSize"==n?a.attr("label/fontSize",o):"binding/fontStyle"==n?a.attr("label/fontStyle",o):"binding/fontWeight"==n?a.attr("label/fontWeight",o):"binding/fontColor"==n?a.attr("label/fill",o):"binding/strokeWidth"==n?a.attr("body/strokeWidth",o):"binding/strokeColor"==n?a.attr("body/stroke",o):"binding/strokeDasharray"==n?a.setDasharray(o):"binding/fillColor"==n?a.attr("body/fill",o):"binding/vAlign"!=n&&"binding/hAlign"!=n||a.updateAlign()}),a.on("event:pointerclick",function(e,t){var i=t.target,n=a.prop("binding/locked");a.isEditableCanvas()&&!n&&a.edit(e,i)}),a.on("event:texteditorclose",function(e){var t=a.attr("label/textWrap/text");""==t?a.remove():a.setValue(t)})},setTextAlign:function(e,t){this.prop(e,t)},getTextAlign:function(e){return this.prop("binding/"+e)},autoResize:function(){var e=this.getCurrentView();if(e){var t=e.findBySelector("label")[0];if(t){var i=t.getBBox(),n=this.size(),o=i.height;o>n.height&&this.resize(n.width,o)}}},edit:function(e,t){this.isTextElement(t)||(t=$(t).find("text")[0]),t=c.getTextElement(t);var i=this.prop("binding/value"),n={tabindex:1},o=this.isEditableCanvas();o||(n.rows=1),c.edit(t,{cellView:e,model:this,textProperty:"attrs/label/textWrap/text",textareaAttributes:n,isEditableCanvas:o}),c.setCaret(i.length)},setText:function(e){this.attr("label/textWrap/text",e)},updateAlign:function(){var e,t,i,n,o=this,a=o.prop("binding/vAlign"),r=o.prop("binding/hAlign");"top"==a?(t=0,n=b.DEFAULT_TEXT_LABEL_PADDING,o.attr("label/textVerticalAnchor","top")):"bottom"==a?(t="100%",n=-b.DEFAULT_TEXT_LABEL_PADDING,o.attr("label/textVerticalAnchor","bottom")):(t="50%",n=0,o.attr("label/textVerticalAnchor","middle")),"right"==r?(e="100%",i=-b.DEFAULT_TEXT_LABEL_PADDING,o.attr("label/textAnchor","end")):"left"==r?(e=0,i=b.DEFAULT_TEXT_LABEL_PADDING,o.attr("label/textAnchor","start")):(e="50%",i=0,o.attr("label/textAnchor","middle")),o.attr("label",{refX:e,refY:t,refX2:i,refY2:n})},setBindingData:function(e){f.prototype.setBindingData.call(this,e);var t=e.value;t&&this.prop("binding/value",t)},getGraphicBindingPopupData:function(){var e=f.prototype.getGraphicBindingPopupData.call(this);return e.value=this.prop("binding/value"),e},setVAlign:function(e){this.prop("binding/vAlign",e)},setHAlign:function(e){this.prop("binding/hAlign",e)}},{defaultBindingProp:{type:"Label",value:s.prop("HMI_TEXT"),fontSize:b.DEFAULT_FONT_SIZE,fontColor:b.DEFAULT_FONT_COLOR,fillColor:"transparent",strokeColor:"transparent",vAlign:"middle",hAlign:"left"},getCursor:function(){return"cursor_text.png"}}),G=_.define("hmi.ExtendText",{attrs:{body:null,input:{strokeWidth:1,stroke:"#000000",fill:"transparent",refX:0,refY:0,refWidth:"100%",refHeight:"100%"},label:{fontSize:b.DEFAULT_FONT_SIZE,text:s.prop("HMI_TEXT"),cursor:"text",refX:0,refX2:b.DEFAULT_RADIO_BUTTON_ITEM_MARGIN,textAnchor:"start",textVerticalAnchor:"middle",refY2:0},button:{strokeWidth:1,stroke:"#000000",fill:"#e6e6e6",refX:"100%",refX2:-b.DEFAULT_TEXT_BOX_BUTTON_WIDTH,width:b.DEFAULT_TEXT_BOX_BUTTON_WIDTH,refHeight:"100%",cursor:"pointer"},buttonText:{fontSize:b.DEFAULT_FONT_SIZE,text:s.prop("HMI_BUTTON_SEND"),textAnchor:"middle",textVerticalAnchor:"middle",refX:"100%",refX2:-b.DEFAULT_TEXT_BOX_BUTTON_WIDTH/2,refY:"50%",cursor:"pointer"}}},{markup:[{tagName:"rect",selector:"input"},{tagName:"text",selector:"label"},{tagName:"rect",selector:"button"},{tagName:"text",selector:"buttonText"}],initialize:function(e){_.prototype.initialize.apply(this,arguments),this.initializeOptions(e,{size:{width:b.DEFAULT_COMBOBOX_BOX_WIDTH,height:b.DEFAULT_COMBOBOX_BOX_HEIGHT}}),this.updateButtonState(),this.updateBindingValue()},setTextAlign:function(e,t){this.prop(e,t)},getTextAlign:function(e){return this.prop("binding/"+e)},updateButtonState:function(){var e=this,t=e.prop("binding");if(t.hasButton&&"READ"!=t.propertyType){e.attr("input",{refWidth2:-(b.DEFAULT_TEXT_BOX_BUTTON_WIDTH+b.DEFAULT_TEXT_BOX_MARGIN)}),e.attr("button",{opacity:1,width:b.DEFAULT_TEXT_BOX_BUTTON_WIDTH}),e.attr("buttonText",{opacity:1}),e.prop("binding/minWidth",b.DEFAULT_TEXT_BOX_WITH_BUTTON_MIN_WIDTH);var i=e.size();i.width<b.DEFAULT_TEXT_BOX_WITH_BUTTON_MIN_WIDTH&&(i.width=b.DEFAULT_TEXT_BOX_WITH_BUTTON_MIN_WIDTH,e.resize(i.width,i.height))}else e.attr("input",{refWidth2:null}),e.attr("button",{opacity:0,width:0}),e.attr("buttonText",{opacity:0}),e.prop("binding/minWidth",b.DEFAULT_TEXT_BOX_MIN_WIDTH);"READ"==t.propertyType?(e.attr("label",{cursor:"default"}),e.attr("button",{cursor:"default"}),e.attr("buttonText",{cursor:"default"})):(e.attr("label",{cursor:"text"}),e.attr("button",{cursor:"pointer"}),e.attr("buttonText",{cursor:"pointer"}))},isTextElement:function(e){var t=e.tagName.toUpperCase();return"TEXT"===t||"TSPAN"==t||"TEXTPATH"==t},isEditable:function(){var e=this.prop("binding/propertyType"),t=this.prop("binding/device");return"READ"!=e&&!(!this.isEditableCanvas()||null!==t.id&&void 0!==t.id)},isControlable:function(){var e=this.prop("binding/propertyType");this.prop("binding/device");return"READ"!==e&&!this.isEditableCanvas()},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n?a._setVisible(o):"binding/device"==n?a.setDevice(o):"binding/value"==n?a.updateBindingValue():"binding/hasButton"==n||"binding/propertyType"==n?(a.updateButtonState(),a.updateAlign()):"binding/highlightColor"==n?a.attr("button/fill",o):"binding/fontType"==n?(a.attr("label/fontFamily",o),a.attr("buttonText/fontFamily",o)):"binding/fontSize"==n?(a.attr("label/fontSize",o),a.attr("buttonText/fontSize",o)):"binding/fontStyle"==n?(a.attr("label/fontStyle",o),a.attr("buttonText/fontStyle",o)):"binding/fontWeight"==n?(a.attr("label/fontWeight",o),a.attr("buttonText/fontWeight",o)):"binding/fontColor"==n?(a.attr("label/fill",o),a.attr("buttonText/fill",o)):"binding/strokeWidth"==n?a.attr("input/strokeWidth",o):"binding/strokeColor"==n?a.attr("input/stroke",o):"binding/strokeDasharray"==n?a.attr("input/strokeDasharray",o):"binding/fillColor"==n?a.attr("input/fill",o):"binding/vAlign"!=n&&"binding/hAlign"!=n||a.updateAlign()}),a.on("event:pointerdown",function(e,t){var i=t.target,n=a.prop("binding/locked");if(a.isControlable()){"tspan"==i.tagName&&(i=$(i).closest("text"));var o=$(i).attr("joint-selector");"button"==o||"buttonText"==o?(c.close(),r.open(),a.patchAnalogTypeControlValue().always(function(){r.close()})):n||a.edit(e,$(i).get(0))}}),a.on("event:texteditorclose",function(e,t){a._isEditing=!1;this.prop("binding/hasButton");var i=a.attr("label/text");a.setValue(i),a.updateBindingValue(),a.patchAnalogTypeControlValue().always(function(){})})},autoResize:function(){var e=this.getCurrentView();if(e){var t=e.findBySelector("label")[0];if(t){var i=b.DEFAULT_TEXT_PADDING,n=t.getBBox(),o=this.size(),a=n.width+i;a<=o.width&&(a=o.width),this.resize(a,n.height+i)}}},updateBindingValue:function(){var e=this.getValue();this._isEditing||(this.setText(e),this.updateAlign())},getValue:function(){var e=this.prop("binding/value"),t=this.prop("binding/device");return t.id&&D.isDigitalType(t.type)&&(1<e&&(e=1),e<0&&(e=0),e=Math.floor(e)),isNaN(Number(e))||(e=g.convertNumberFormat(e)),e},edit:function(e,t){var i,n=this;n.isTextElement(t)||(t=0<(i=$(t).find("text")).length?i.get(0):0<(i=$(t).siblings("text[joint-selector='label']")).length?i.get(0):null),t=c.getTextElement(t);var o,a,r=n.prop("binding/value"),l=n.prop("binding/hasButton"),s=n.prop("binding/device");a=D.isDigitalType(s.type)?(o=0,1):(o=n.prop("binding/minValue"),n.prop("binding/maxValue"));var d=n.isEditableCanvas();n._isEditing=!0,c.edit(t,{cellView:e,textProperty:"attrs/label/text",textareaAttributes:{tabindex:1,rows:1},isEditableCanvas:d,hasButton:l,isAllowDot:!0,textValidation:n._validationText.bind(n),min:o,max:a}),r+="",c.setCaret(r.length)},_validationText:function(e){var t=this.prop("binding/device");if(e=e.replace(/[\a-z\u3131-\u314e\u314f-\u3163\uac00-\ud7a3]/g,""),t.id&&D.isDigitalType(t.type))e=e.replace(/((?!(0|1)).)*$/g,""),((e=Number(e))<0||10==e)&&(e=0),1<e&&(e=1),e+="";else if(!isNaN(Number(e))){var i=e.split(".");1<i.length&&1<i[1].length&&(e=m.toString(Number(e),"00.0"))}return e},setText:function(e){this.attr("label/text",e)},updateAlign:function(){var e,t,i=this,n=i.prop("binding/vAlign"),o=i.prop("binding/hAlign"),a=i.prop("binding/hasButton"),r=(i.attr("input/refWidth2"),0);"top"==n?(t=0,i.attr("label/textVerticalAnchor","top")):"bottom"==n?(t="100%",i.attr("label/textVerticalAnchor","bottom")):(t="50%",i.attr("label/textVerticalAnchor","middle")),"right"==o?(e="100%",r=a?-(b.DEFAULT_TEXT_BOX_BUTTON_WIDTH+b.DEFAULT_RADIO_BUTTON_ITEM_MARGIN+b.DEFAULT_TEXT_BOX_MARGIN):-b.DEFAULT_RADIO_BUTTON_ITEM_MARGIN,i.attr("label/textAnchor","end")):"left"==o?(e=0,r=b.DEFAULT_RADIO_BUTTON_ITEM_MARGIN,i.attr("label/textAnchor","start")):(e="50%",r=a?-(b.DEFAULT_TEXT_BOX_BUTTON_WIDTH/2+b.DEFAULT_TEXT_BOX_MARGIN/2):0,i.attr("label/textAnchor","middle")),i.attr("label",{refX:e,refX2:r,refY:t})},setBindingData:function(e){var t=this;f.prototype.setBindingData.call(t,e);var i=e.propertyType,n=e.controlValue,o=e.highlightColor,a=e.minValue,r=e.maxValue,l=e.hasButton;l=!1!==l&&"false"!=l,t.prop("binding/propertyType",i),t.prop("binding/highlightColor",o),t.prop("binding/hasButton",l),n&&t.prop("binding/value",n),a&&t.prop("binding/minValue",a),r&&t.prop("binding/maxValue",r)},getGraphicBindingPopupData:function(){var e=this,t=f.prototype.getGraphicBindingPopupData.call(e);return t.propertyType=e.prop("binding/propertyType"),t.highlightColor=e.prop("binding/highlightColor"),t.hasButton=e.prop("binding/hasButton"),t.value=t.controlValue=e.prop("binding/value"),t.minValue=e.prop("binding/minValue"),t.maxValue=e.prop("binding/maxValue"),t},setVAlign:function(e){this.prop("binding/vAlign",e)},setHAlign:function(e){this.prop("binding/hAlign",e)}},{defaultBindingProp:{type:"ExtLabel",propertyType:"WRITE",hasButton:!0,fillColor:"transparent",strokeWidth:1,strokeColor:"#000000",value:0,minValue:0,maxValue:100,highlightColor:"#e6e6e6",vAlign:"middle",hAlign:"left"},getCursor:function(){return"cursor_text.png"}}),V=_.define("hmi.Progressbar",{attrs:{progress:{refWidth:"0%",refHeight:"0%",fill:"#0000FF"},body:{refWidth:"100%",refHeight:"100%",stroke:"#000000",strokeDasharray:"0",fill:"transparent"},label:{refY:0,fontType:b.DEFAULT_FONT_TYPE}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"progress"},{tagName:"text",selector:"label"}],initialize:function(e){_.prototype.initialize.apply(this,arguments);var t={},i={},n={};-1!=this.prop("binding/key").indexOf("VERTICAL")?(n.direction="vertical",t.width=b.DEFAULT_PROGRESSBAR_HEIGHT,t.height=b.DEFAULT_PROGRESSBAR_WIDTH,i.progress={refWidth:"100%",refHeight:"0%",refY:"100%"}):(n.direciton="horizontal",t.width=b.DEFAULT_PROGRESSBAR_WIDTH,t.height=b.DEFAULT_PROGRESSBAR_HEIGHT,i.progress={refWidth:"0%",refHeight:"100%"}),this.initializeOptions(e,{size:t,attrs:i,binding:n}),this.updateBindingValue()},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n?a._setVisible(o):"binding/device"==n?a.setDevice(o):"binding/value"==n||"binding/minValue"==n||"binding/prefix"==n||"binding/suffix"==n||"binding/maxValue"==n||"binding/textLocation"==n?this.updateBindingValue():"binding/fontType"==n?a.attr("label/fontFamily",o):"binding/fontSize"==n?a.attr("label/fontSize",o):"binding/fontStyle"==n?a.attr("label/fontStyle",o):"binding/fontWeight"==n?a.attr("label/fontWeight",o):"binding/fontColor"==n?a.attr("label/fill",o):"binding/strokeWidth"==n?a.attr("body/strokeWidth",o):"binding/strokeColor"==n?a.attr("body/stroke",o):"binding/strokeDasharray"==n?a.attr("body/strokeDasharray",o):"binding/fillColor"==n?a.attr("body/fill",o):"binding/highlightColor"==n&&a.attr("progress/fill",o)})},updateBindingValue:function(){var e=this,t=e.prop("binding/direction"),i=e.getPercentage();this.updateTextFromState(),e.updateText(i);var n=i+"%",o=e.prop("binding/highlightColor");if(e.attr("progress/fill",o),"vertical"==t){var a=100-i+"%";e.transition("attrs/progress/refY",a,{duration:1e3,valueFunction:de.util.interpolate.unit,timingFunction:de.util.timing.linear}),e.transition("attrs/progress/refHeight",n,{duration:1e3,valueFunction:de.util.interpolate.unit,timingFunction:de.util.timing.linear})}else e.transition("attrs/progress/refWidth",n,{duration:1e3,valueFunction:de.util.interpolate.unit,timingFunction:de.util.timing.linear})},getPercentage:function(){var e=this.getValue(),t=this.prop("binding/minValue"),i=this.prop("binding/maxValue");e<t&&(e=t),i<e&&(e=i);var n=(e-t)/(i-t)*100;return g.convertNumberFormat(n)},updateText:function(e){e=e||this.getPercentage();var t=this.prop("binding/prefix"),i=this.prop("binding/suffix"),n=e;t&&(n=t+n),i&&(n+=i),this.attr("label/text",n)},updateTextFromState:function(){var e=this.getRefPosFromTextLocation();e?this.attr("label",{opacity:1,textVerticalAnchor:e.textVerticalAnchor,textAnchor:e.textAnchor,refX:e.refX,refX2:e.refX2,refY:e.refY,refY2:e.refY2}):this.attr("label",{opacity:0})},setBindingData:function(e){var t=this;f.prototype.setBindingData.call(t,e);var i=e.value,n=e.prefix,o=e.suffix,a=e.textLocation,r=e.minValue,l=e.maxValue,s=e.highlightColor;t.prop("binding/prefix",n),t.prop("binding/suffix",o),t.prop("binding/textLocation",a),t.prop("binding/highlightColor",s),"string"==typeof r&&(r=Number(r)),"string"==typeof l&&(l=Number(l)),t.prop("binding/minValue",r),t.prop("binding/maxValue",l),t.prop("binding/value",i)},getGraphicBindingPopupData:function(){var e=this,t=f.prototype.getGraphicBindingPopupData.call(e);return t.direction=e.prop("binding/direction"),t.prefix=e.prop("binding/prefix"),t.suffix=e.prop("binding/suffix"),t.textLocation=e.prop("binding/textLocation"),t.highlightColor=e.prop("binding/highlightColor"),t.minValue=e.prop("binding/minValue"),t.maxValue=e.prop("binding/maxValue"),t.value=e.prop("binding/value"),t}},{defaultBindingProp:{type:"ProgressBar",value:0,prefix:null,suffix:null,minValue:0,maxValue:100,direction:b.DEFAULT_PROGRESSBAR_DIRECTION,highlightColor:"#0000FF",strokeColor:"#000000",fillColor:"transparent",textLocation:null}}),W=_.define("hmi.Scalebar",{attrs:{body:{refWidth:"100%",refHeight:"100%",stroke:"#000000",strokeDasharray:"0",fill:"#d3d3d3"},inner:{refWidth:"0%",refHeight:"0%",stroke:"#bebebe",fill:"#00007f"},label:{refY:0,fontType:b.DEFAULT_FONT_TYPE},marker:{strokeWidth:1,stroke:"#000000",fill:"#00007f"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"inner"},{tagName:"rect",selector:"marker"},{tagName:"text",selector:"label"}],initialize:function(e){_.prototype.initialize.apply(this,arguments);var t={},i={},n={};-1!=this.prop("binding/key").indexOf("VERTICAL")?(n.direction="vertical",t.width=b.DEFAULT_SCALEBAR_HEIGHT,t.height=b.DEFAULT_SCALEBAR_WIDTH,i.marker={refWidth:"120%",height:5,refX:"0%",refX2:"-10%",refY:"50%",refY2:-2.5},i.inner={refWidth:"100%",refHeight:"50%",refY:"100%",refY2:"-50%",refX:"0%"}):(n.direction="horizontal",t.width=b.DEFAULT_SCALEBAR_WIDTH,t.height=b.DEFAULT_SCALEBAR_HEIGHT,i.marker={width:5,refHeight:"120%",refX:"50%",refX2:-2.5,refY:"0%",refY2:"-10%"},i.inner={refHeight:"100%",refWidth:"50%",refY:"0%",refX:"0%"}),this.initializeOptions(e,{size:t,attrs:i,binding:n}),this.updateBindingValue(),this.updateMarkerCursor()},attachEvent:function(){var r=this;r.on("change:binding",function(e,t,i){var n=i.propertyPath,o=r.getPropertyValue(n,i.propertyValue);"binding/visible"==n?r._setVisible(o):"binding/device"==n?r.setDevice(o):"binding/value"==n||"binding/minValue"==n||"binding/prefix"==n||"binding/suffix"==n||"binding/maxValue"==n||"binding/textLocation"==n?this.updateBindingValue():"binding/highlightColor"==n?(r.attr("inner/fill",o),r.attr("inner/stroke",o),r.attr("marker/fill",o)):"binding/fontType"==n?r.attr("label/fontFamily",o):"binding/fontSize"==n?r.attr("label/fontSize",o):"binding/fontStyle"==n?r.attr("label/fontStyle",o):"binding/fontWeight"==n?r.attr("label/fontWeight",o):"binding/fontColor"==n?r.attr("label/fill",o):"binding/strokeWidth"==n?r.attr("body/strokeWidth",o):"binding/strokeColor"==n?(r.attr("body/stroke",o),r.attr("marker/stroke",o)):"binding/strokeDasharray"==n?r.attr("body/strokeDasharray",o):"binding/fillColor"==n&&r.attr("body/fill",o)}),r.on("change:angle",function(e,t,i){r.updateMarkerCursor(t)}),r.on("event:pointerdown",function(e,t){var i=$(t.target),n=r.prop("binding");"marker"==i.attr("joint-selector")&&"READ"!=n.propertyType&&(r._isDragging=!0,r._draggingValue=r.getScaledValue(),r._dragStartX=t.clientX,r._dragStartY=t.clientY)}),r.on("event:pointermove",function(e,t){if(r._isDragging){var i=t.clientX,n=t.clientY,o=i-r._dragStartX,a=n-r._dragStartY;r.onMoveMarker(o,a)}}),r.on("event:pointerup",function(e,t){if(r._isDragging){r._isDragging=!1,r._draggingValue=null;var i=r.prop("binding");if(!r.isEditableCanvas()&&"READ"!=i.propertyType){var n=r.getScaledValue();r.patchAnalogTypeControlValue(n).always(function(){})}}})},onMoveMarker:function(e,t){var i=this,n=i.angle(),o=i.prop("binding/direction");"vertical"==o&&(n+=90);var a=i.getCanvas().getZoomLevel();a/=100;var r=i.size(),l=r.width,s=r.height,d=i.prop("binding/minValue"),c=i.prop("binding/maxValue"),p=c-d;n<0?n+=360:360<n&&(n-=360);var g,h=i._draggingValue,u=i.attr("marker/cursor");c<(g="horizontal"==o?(e=e/a*p/l,t=t/a*p/l,"ns-resize"==u?112.5<n&&n<=292.5?h-t:h+t:112.5<n&&n<=292.5?h-e:h+e):(e=e/a*p/s,t=t/a*p/s,"ns-resize"==u?112.5<n&&n<=292.5?h+t:h-t:112.5<n&&n<=292.5?h+e:h-e))&&(g=c),g<d&&(g=d),i.updateMarkerPosition(g);var f=Number(m.toString(g,"0"));i.prop("binding").value=f,f=i.getScaledValue(),i.updateText(f)},updateMarkerCursor:function(e){var t;void 0===e&&(e=this.angle()),"vertical"==this.prop("binding/direction")&&(e+=90),e<0?e+=360:360<e&&(e-=360),0<=e&&e<=22.5||337.5<e&&e<=360?t="ew-resize":22.5<e&&e<=67.5||202.5<e&&e<=247.5?t="nwse-resize":67.5<e&&e<=112.5||247.5<e&&e<=292.5?t="ns-resize":112.5<e&&e<157.5||292.5<e&&e<=337.5?t="nesw-resize":(157.5<e&&e<=180||180<e&&e<=202.5)&&(t="ew-resize"),this.attr("marker/cursor",t)},updateText:function(e){var t=this.prop("binding/prefix"),i=this.prop("binding/suffix");t&&(e=t+e),i&&(e+=i),this.updateTextFromState(e)},updateBindingValue:function(){var e=this.getScaledValue();this.updateMarkerPosition(e),this.updateText(e)},getScaledValue:function(e){e=e||this.getValue();var t=this.prop("binding/minValue"),i=this.prop("binding/maxValue");return e<t&&(e=t),i<e&&(e=i),null===e&&(e=0),g.convertNumberFormat(e)},getValuePositionRatio:function(e){var t=this.prop("binding/direction"),i=this.prop("binding/minValue"),n=this.prop("binding/maxValue");return"vertical"==t?1-(e-i)/(n-i):(e-i)/(n-i)},getMarkerPosition:function(){var e;return e="vertical"==this.prop("binding/direction")?this.attr("inner/refHeight"):this.attr("marker/refX"),e=Number(e.replace("%",""))},updateMarkerPosition:function(e){var t=this,i=t.prop("binding/direction"),n=t.prop("binding/highlightColor"),o={refX:null,refY:null,fill:n},a={refWidth:null,refHeight:null,fill:n,stroke:n},r=100*t.getValuePositionRatio(e),l=r+"%";if("vertical"==i){var s=100-r+"%";o.refX="0%",o.refY=l,a.refWidth="100%",a.refHeight=s,a.refY2="-"+s}else r=100*t.getValuePositionRatio(e),o.refY="0%",o.refX=l,a.refHeight="100%",a.refWidth=l;t.attr("marker",o),t.attr("inner",a)},updateTextFromState:function(e){var t=this.getRefPosFromTextLocation();t?this.attr("label",{opacity:1,text:e,textVerticalAnchor:t.textVerticalAnchor,textAnchor:t.textAnchor,refX:t.refX,refX2:t.refX2,refY:t.refY,refY2:t.refY2}):this.attr("label",{opacity:0})},setBindingData:function(e){var t=this;f.prototype.setBindingData.call(t,e);var i=e.value,n=e.textLocation,o=e.minValue,a=e.maxValue,r=e.highlightColor,l=e.propertyType,s=e.prefix,d=e.suffix;t.prop("binding/prefix",s),t.prop("binding/suffix",d),t.prop("binding/textLocation",n),t.prop("binding/propertyType",l),t.prop("binding/highlightColor",r),"string"==typeof o&&(o=Number(o)),"string"==typeof a&&(a=Number(a)),t.prop("binding/minValue",o),t.prop("binding/maxValue",a),t.prop("binding/value",i)},getGraphicBindingPopupData:function(){var e=this,t=f.prototype.getGraphicBindingPopupData.call(e);return t.textLocation=e.prop("binding/textLocation"),t.propertyType=e.prop("binding/propertyType"),t.highlightColor=e.prop("binding/highlightColor"),t.direction=e.prop("binding/direction"),t.minValue=e.prop("binding/minValue"),t.maxValue=e.prop("binding/maxValue"),t.prefix=e.prop("binding/prefix"),t.suffix=e.prop("binding/suffix"),t.value=e.prop("binding/value"),t}},{defaultBindingProp:{type:"ScaleBar",minValue:0,maxValue:100,prefix:null,suffix:null,direction:b.DEFAULT_PROGRESSBAR_DIRECTION,propertyType:"WRITE",strokeColor:"#000000",fillColor:"#d3d3d3",highlightColor:"#00007f",textLocation:null}}),z=_.define("hmi.CheckBox",{type:"hmi.CheckBox",attrs:{body:{strokeWidth:1,stroke:"#000000",fill:"#e6e6e6",strokeDasharray:"0"},label:{fontSize:b.DEFAULT_FONT_TYPE,text:"",textAnchor:"start",refX:"0%",refX2:b.DEFAULT_CHECKBOX_PADDING,refY:"50%",refY2:0},checkboxWrapper:{strokeWidth:1,stroke:"#000000",fill:"#ffffff",width:b.DEFAULT_CHECKBOX_WRAPPER_SIZE,height:b.DEFAULT_CHECKBOX_WRAPPER_SIZE,refX:"100%",refX2:-b.DEFAULT_CHECKBOX_PADDING,refY:"50%",refY2:-b.DEFAULT_CHECKBOX_WRAPPER_SIZE/2,cursor:"default"},checkbox:{fill:"transparent",stroke:"transparent",strokeWidth:0,width:b.DEFAULT_CHECKBOX_CHECK_SIZE,height:b.DEFAULT_CHECKBOX_CHECK_SIZE,refX:"100%",refX2:-(b.DEFAULT_CHECKBOX_PADDING-b.DEFAULT_CHECKBOX_CHECK_SIZE/2),refY:"50%",refY2:-b.DEFAULT_CHECKBOX_CHECK_SIZE/2,cursor:"default"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"},{tagName:"rect",selector:"checkboxWrapper"},{tagName:"rect",selector:"checkbox"}],initialize:function(e){_.prototype.initialize.apply(this,arguments),this.initializeOptions(e,{size:{width:b.DEFAULT_CHECKBOX_OBJECT_WIDTH,height:b.DEFAULT_CHECKBOX_OBJECT_HEIGHT}}),this.updateBindingValue(),this.updateText(this.prop("binding/checkboxLabel"))},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n?a._setVisible(o):"binding/device"==n?a.setDevice(o):"binding/value"==n||"binding/highlightColor"==n||"binding/reverse"==n?this.updateBindingValue():"binding/propertyType"==n?"READ"!=o?(a.attr("checkboxWrapper",{cursor:"pointer"}),a.attr("checkbox",{cursor:"pointer"})):(a.attr("checkboxWrapper",{cursor:"default"}),a.attr("checkbox",{cursor:"default"})):"binding/checkboxLabel"==n?this.updateText(o):"binding/fontType"==n?a.attr("label/fontFamily",o):"binding/fontSize"==n?a.attr("label/fontSize",o):"binding/fontStyle"==n?a.attr("label/fontStyle",o):"binding/fontWeight"==n?a.attr("label/fontWeight",o):"binding/fontColor"==n?a.attr("label/fill",o):"binding/strokeWidth"==n?a.attr("body/strokeWidth",o):"binding/strokeColor"==n?a.attr("body/stroke",o):"binding/strokeDasharray"==n?a.attr("body/strokeDasharray",o):"binding/fillColor"==n&&a.attr("body/fill",o)}),a.on("event:pointerdown",a.control.bind(a))},control:function(e,t){var i=this.prop("binding");if(!this.isEditableCanvas()&&"READ"!=i.propertyType){var n=$(t.target).attr("joint-selector");"checkbox"!=n&&"checkboxWrapper"!=n||this.patchDigitalTypeControlValue().always(function(){})}},updateBindingValue:function(){var e=this.getValue();this.isReverse()&&(e=D.getReverseValue(e)),this.setChecked(1==e)},setChecked:function(e){var t=this.prop("binding").highlightColor;e?this.attr("checkbox",{fill:t,stroke:t}):this.attr("checkbox",{fill:"transparent",stroke:"transparent"})},updateText:function(e){var t,i=this;if(""==e||null==e){i.prop("binding/minWidth",b.DEFAULT_CHECKBOX_OBJECT_MIN_WIDTH),i.attr("label",{text:"",opacity:0}),i.attr("checkboxWrapper",{refX:"50%",refX2:-b.DEFAULT_CHECKBOX_WRAPPER_SIZE/2}),i.attr("checkbox",{refX:"50%",refX2:-b.DEFAULT_CHECKBOX_CHECK_SIZE/2});var n=(t=i.size()).width>b.DEFAULT_CHECKBOX_OBJECT_MIN_WIDTH?b.DEFAULT_CHECKBOX_OBJECT_MIN_WIDTH:t.width,o=t.height>b.DEFAULT_CHECKBOX_OBJECT_MIN_HEIGHT?b.DEFAULT_CHECKBOX_OBJECT_MIN_HEIGHT:t.height;i.resize(n,o)}else i.prop("binding/minWidth",b.DEFAULT_DROPDOWN_MIN_WIDTH),(t=i.size()).width<b.DEFAULT_DROPDOWN_MIN_WIDTH&&(t.width=b.DEFAULT_DROPDOWN_MIN_WIDTH,i.resize(t.width,t.height)),i.attr("label",{text:e,opacity:1}),i.attr("checkboxWrapper",{refX:"100%",refX2:-b.DEFAULT_CHECKBOX_PADDING}),i.attr("checkbox",{refX:"100%",refX2:-(b.DEFAULT_CHECKBOX_PADDING-b.DEFAULT_CHECKBOX_CHECK_SIZE/2)})},setBindingData:function(e){var t=this;f.prototype.setBindingData.call(t,e);var i=e.value,n=e.checkboxLabel,o=e.propertyType,a=e.highlightColor,r=e.reverse;t.prop("binding/checkboxLabel",n),t.prop("binding/value",i),t.prop("binding/propertyType",o),t.prop("binding/highlightColor",a),t.prop("binding/reverse",r)},getGraphicBindingPopupData:function(){var e=this,t=f.prototype.getGraphicBindingPopupData.call(e);return t.checkboxLabel=e.prop("binding/checkboxLabel"),t.value=e.prop("binding/value"),t.propertyType=e.prop("binding/propertyType"),t.highlightColor=e.prop("binding/highlightColor"),t.reverse=e.prop("binding/reverse"),t}},{defaultBindingProp:{type:"ToggleButton",reverse:!1,propertyType:"WRITE",fillColor:"#e6e6e6",strokeWidth:1,strokeColor:"#000000",strokeDasharray:"0",highlightColor:"#000000",checkboxLabel:"",minWidth:b.DEFAULT_CHECKBOX_OBJECT_MIN_WIDTH,minHeight:b.DEFAULT_CHECKBOX_OBJECT_MIN_HEIGHT}}),Y=_.define("hmi.RadioButton",{attrs:{body_0:{fill:"#e6e6e6",refWidth:"100%",refHeight:"100%",strokeWidth:1,stroke:"#000000"},label_0:{text:"",textVerticalAnchor:"middle",textAnchor:"start",fontSize:b.DEFAULT_FONT_SIZE,refX:"0%",refX2:b.DEFAULT_CHECKBOX_PADDING,refY:"50%",refY2:0}}},{markup:[{tagName:"rect",selector:"body_0"},{tagName:"text",selector:"label_0"}],initialize:function(e){_.prototype.initialize.apply(this,arguments);var t={};-1!=this.prop("binding/key").indexOf("VERTICAL")?t.direction="vertical":t.direction="horizontal",this.initializeOptions(e,{size:{width:b.DEFAULT_RADIO_BUTTON_ITEM_WIDTH,height:b.DEFAULT_RADIO_BUTTON_ITEM_HEIGHT},binding:t}),this.updateBindingValue()},_defaultAddEvt:function(e){this.updateBindingValue()},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n?a._setVisible(o):"binding/device"==n?a.setDevice(o):"binding/value"==n||"binding/optionValues"==n||"binding/highlightColor"==n?this.updateBindingValue():"binding/fontType"==n?a.setAllFontType(o):"binding/fontSize"==n?a.setAllFontSize(o):"binding/fontStyle"==n?a.setAllFontStyle(o):"binding/fontWeight"==n?a.setAllFontWeight(o):"binding/fontColor"==n?a.setAllFontColor(o):"binding/fontColor"==n?a.setAllFillColor(o):"binding/strokeWidth"==n?a.setAllStrokeWidth(o):"binding/strokeColor"==n?a.setAllStrokeColor(o):"binding/strokeDasharray"==n?a.setAllStrokeDasharray(o):"binding/fillColor"==n&&a.setAllFillColor(o)}),a.on("event:pointerdown",a.control.bind(a))},control:function(e,t){var i=this,n=i.prop("binding");if(!i.isEditableCanvas()&&"READ"!=n.propertyType){"tspan"==t.target.tagName&&(t.target=$(t.target).closest("text"));var o=$(t.target).attr("joint-selector");if(o&&(-1!=o.indexOf("body")||-1!=o.indexOf("label"))){var a=o.split("_"),r=Number(a[1]),l=i.prop("binding/optionValues")[r];l&&(i.setValue(l.value),i.patchAnalogTypeControlValue().always(function(){}))}}},updateBindingValue:function(){var e=this.prop("binding/optionValues");this.updateOptionValues(e)},updateOptionValues:function(e){this._updateMarkupFromOptionValues(e);var t=this.getValue();null!=t&&(t=Math.floor(t));var i,n=e.length;for(i=0;i<n;i++)if(e[i].value==t)return void this.setSelected(i)},_updateMarkupFromOptionValues:function(e){var t,i,n=de.util.cloneDeep(f.markup),o={},a=e.length;for(i=0;i<a;i++)t=e[i],n=n.concat(this._createRadioButtonMarkUp(i)),o=$.extend(o,this._createRadioButtonAttr(i,t));this.attr(o),this.set("markup",n)},_createRadioButtonMarkUp:function(e){return[{tagName:"rect",selector:"body_"+e},{tagName:"text",selector:"label_"+e}]},_createRadioButtonAttr:function(e,t){var i=this,n=t.value,o=t.text,a=i.getValue(),r={};t=t||"";var l=i.prop("binding/direction"),s=i.prop("binding/fontSize"),d=i.prop("binding/fontStyle"),c=i.prop("binding/fontWeight"),p=i.prop("binding/fontType"),g=i.prop("binding/fontColor");g=g||"#000000";var h=i.prop("binding/fillColor");h=h||"#e6e6e6";var u=i.prop("binding/highlightColor");h=a==n?u:h;var f=i.prop("binding/strokeColor");f=f||"#000000";var m=i.prop("binding/strokeWidth");m=m||1;var _=i.prop("binding/strokeDasharray");_=_||"0";var v="0%",b="0%";return"vertical"==l?0<e&&(v=100*e,v+="%"):0<e&&(b=100*e,b+="%"),r["body_"+e]={fill:h,stroke:f,strokeWidth:m,strokeDasharray:_,refWidth:"100%",refHeight:"100%",refY:v,refY2:0,refX:b,refX2:0},"vertical"==l?(v=0<e?(v=100*e)+50+"%":"50%",b="50%"):(b=0<e?(b=100*e)+50+"%":"50%",v="50%"),r["label_"+e]={text:o,textAnchor:"middle",textVerticalAnchor:"middle",refX:b,refX2:0,refY:v,refY2:0,fontSize:s,fontStyle:d,fontWeight:c,fontFamily:p,fill:g},r},setSelected:function(e){var t,i,n=this,o=n.prop("binding/optionValues"),a=n.prop("binding/highlightColor"),r=n.prop("binding/fillColor"),l=n.prop("binding/strokeColor"),s=o.length;for(t=0;t<s;t++)i="body_"+t,e==t?n.attr(i,{fill:a,stroke:l}):n.attr(i,{fill:r,stroke:l})},_setAllAttr:function(e,t,i){var n,o,a=this.prop("binding/optionValues"),r=a.length;e=e||"body_0";var l,s=this.getValue();for(o=0;o<r;o++)n=a[o],i&&n.value==s||(l=e+"_"+o,this.attr(l,t))},setAllFontSize:function(e){this._setAllAttr("label",{fontSize:e})},setAllFontType:function(e){this._setAllAttr("label",{fontFamily:e})},setAllFontStyle:function(e){this._setAllAttr("label",{fontStyle:e})},setAllFontWeight:function(e){this._setAllAttr("label",{fontWeight:e})},setAllFontColor:function(e){this._setAllAttr("label",{fill:e})},setAllFillColor:function(e){this._setAllAttr("body",{fill:e},!0)},setAllStrokeWidth:function(e){this._setAllAttr("body",{strokeWidth:e})},setAllStrokeColor:function(e){this._setAllAttr("body",{stroke:e})},setAllStrokeDasharray:function(e){this._setAllAttr("body",{strokeDasharray:e})},setBindingData:function(e){f.prototype.setBindingData.call(this,e);var t=e.value,i=e.optionValues,n=e.highlightColor,o=e.propertyType;this.prop("binding/optionValues",i,{rewrite:!0}),this.prop("binding/value",t),this.prop("binding/highlightColor",n),this.prop("binding/propertyType",o)},getGraphicBindingPopupData:function(){var e=f.prototype.getGraphicBindingPopupData.call(this);return e.optionValues=this.prop("binding/optionValues"),e.value=this.prop("binding/value"),e.highlightColor=this.prop("binding/highlightColor"),e.propertyType=this.prop("binding/propertyType"),e}},{defaultBindingProp:{type:"RadioButton",propertyType:"WRITE",strokeColor:"#000000",fillColor:"#e6e6e6",highlightColor:"#0081c6",minWidth:b.DEFAULT_RADIO_BUTTON_ITEM_WIDTH,minHeight:b.DEFAULT_RADIO_BUTTON_ITEM_HEIGHT,optionValues:[{value:0,text:""}]}}),X=_.define("hmi.Combobox",{attrs:{body:{fill:"#e6e6e6",refWidth:"100%",refHeight:"100%",strokeWidth:1,stroke:"#000000"},label:{text:"",textVerticalAnchor:"middle",textAnchor:"start",fontSize:b.DEFAULT_FONT_SIZE,refX:"0%",refX2:b.DEFAULT_CHECKBOX_PADDING,refY:"50%",refY2:0},button:{strokeWidth:1,stroke:"#000000",fill:"#000000",points:b.DEFAULT_COMBOBOX_BUTTON_PATH,refX:"100%",refX2:-b.DEFAULT_CHECKBOX_PADDING,refY:"50%",refY2:-b.DEFAULT_COMBOBOX_BUTTON_HEIGHT/2}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"},{tagName:"polygon",selector:"button"}],initialize:function(e){_.prototype.initialize.apply(this,arguments),this.initializeOptions(e,{size:{width:b.DEFAULT_COMBOBOX_BOX_WIDTH,height:b.DEFAULT_COMBOBOX_BOX_HEIGHT}}),this.updateBindingValue()},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n?a._setVisible(o):"binding/device"==n?a.setDevice(o):"binding/value"==n||"binding/optionValues"==n||"binding/highlightColor"==n?this.updateBindingValue():"binding/fontType"==n?a.setAllFontType(o):"binding/fontSize"==n?a.setAllFontSize(o):"binding/fontStyle"==n?a.setAllFontStyle(o):"binding/fontWeight"==n?a.setAllFontWeight(o):"binding/fontColor"==n?a.setAllFontColor(o):"binding/strokeWidth"==n?a.setAllStrokeWidth(o):"binding/strokeColor"==n?a.setAllStrokeColor(o):"binding/strokeDasharray"==n?a.setAllStrokeDasharray(o):"binding/fillColor"==n&&a.setAllFillColor(o)}),a.on("event:pointerdown",a.control.bind(a))},control:function(e,t){var i=this.prop("binding");if(!this.isEditableCanvas()&&"READ"!=i.propertyType){var n=$(t.target).attr("joint-selector");if(n){var o=n.split("_");if(1<o.length){var a=Number(o[1]),r=this.prop("binding/optionValues")[a];r&&(this.setValue(r.value),this.patchAnalogTypeControlValue().always(function(){})),this.close()}else this._isOpened?this.close():this.open()}}},updateBindingValue:function(){var e=this.prop("binding/optionValues");this.updateOptionValues(e)},updateOptionValues:function(e){this._updateMarkupFromOptionValues(e),this._isOpened&&this.open();var t=this.getValue();null!=t&&(t=Math.floor(t));var i,n=e.length;for(i=0;i<n;i++)if(e[i].value==t)return void this.setSelected(i);this.setSelected(null)},_updateMarkupFromOptionValues:function(e){var t,i,n={},o=de.util.cloneDeep(f.markup).concat([{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"},{tagName:"polygon",selector:"button"}]),a=e.length;for(i=0;i<a;i++)t=e[i],o=o.concat(this._createComboboxMarkUp(i)),n=$.extend(n,this._createComboboxAttr(i,t));this.attr(n),this.set("markup",o)},_createComboboxMarkUp:function(e){return[{tagName:"rect",selector:"body_"+e},{tagName:"text",selector:"label_"+e}]},_createComboboxAttr:function(e,t){var i=this,n="display:none;",o={},a=i.getValue(),r=t.value,l=t.text,s=i.prop("binding/fontSize"),d=i.prop("binding/fontStyle"),c=i.prop("binding/fontWeight"),p=i.prop("binding/fontType"),g=i.prop("binding/fontColor");g=g||"#000000";var h=i.prop("binding/fillColor");h=h||"#e6e6e6";var u=i.prop("binding/highlightColor");h=a==r?u:h;var f=i.prop("binding/strokeColor");f=f||"#000000";var m=i.prop("binding/strokeWidth");m=m||1;var _=i.prop("binding/strokeDasharray");_=_||"0";var v=100*(e+1);return v+="%",o["body_"+e]={fill:h,stroke:f,strokeWidth:m,strokeDasharray:_,refWidth:"100%",refHeight:"100%",refY2:v,style:n},o["label_"+e]={text:l,textAnchor:"start",textVerticalAnchor:"middle",refX:"0%",refX2:b.DEFAULT_CHECKBOX_PADDING,refY:"50%",refY2:v,fontSize:s,fontStyle:d,fontWeight:c,fontFamily:p,fill:g,style:n},o},setSelected:function(e){if(null===e)this.attr("label/text","-");else{var t=this.prop("binding/optionValues")[e];this.attr("label/text",t.text)}},_setAllAttr:function(e,t,i,n){var o,a,r=this.prop("binding/optionValues"),l=r.length;i||this.attr(e,t);var s,d=this.getValue();for(a=0;a<l;a++)s=e+"_"+a,o=r[a],n&&o.value==d||this.attr(s,t)},setAllFontSize:function(e){this._setAllAttr("label",{fontSize:e})},setAllFontType:function(e){this._setAllAttr("label",{fontFamily:e})},setAllFontColor:function(e){this._setAllAttr("label",{fill:e})},setAllFontStyle:function(e){this._setAllAttr("label",{fontStyle:e})},setAllFontWeight:function(e){this._setAllAttr("label",{fontWeight:e})},setAllFillColor:function(e){this._setAllAttr("body",{fill:e},!1,!0)},setAllStrokeWidth:function(e){this._setAllAttr("body",{strokeWidth:e})},setAllStrokeColor:function(e){this._setAllAttr("body",{stroke:e})},setAllStrokeDasharray:function(e){this._setAllAttr("body",{strokeDasharray:e})},open:function(){this._setAllAttr("body",{style:"display:block;"},!0),this._setAllAttr("label",{style:"display:block;"},!0);var e=this.getCurrentView();if(e){var t=e.$el.find("[joint-selector=button]")[0],i=h(t),n=i.getBBox(),o=n.x+n.width/2,a=n.y+n.height/2;i.rotate(180,o,a),this._isOpened=!0}else console.error("there is no view")},close:function(){this._setAllAttr("body",{style:"display:none;"},!0),this._setAllAttr("label",{style:"display:none;"},!0);var e=this.getCurrentView();if(e){var t=e.$el.find("[joint-selector=button]")[0],i=h(t),n=i.getBBox(),o=n.x+n.width/2,a=n.y+n.height/2;i.rotate(0,o,a),this._isOpened=!1}else console.error("there is no view")},setBindingData:function(e){f.prototype.setBindingData.call(this,e);var t=e.value,i=e.optionValues,n=e.highlightColor,o=e.propertyType;this.prop("binding/optionValues",i,{rewrite:!0}),this.prop("binding/value",t),this.prop("binding/highlightColor",n),this.prop("binding/propertyType",o)},getGraphicBindingPopupData:function(){var e=f.prototype.getGraphicBindingPopupData.call(this);return e.optionValues=this.prop("binding/optionValues"),e.value=this.prop("binding/value"),e.highlightColor=this.prop("binding/highlightColor"),e.propertyType=this.prop("binding/propertyType"),e}},{defaultBindingProp:{type:"Combobox",propertyType:"WRITE",strokeColor:"#000000",fillColor:"#e6e6e6",highlightColor:"#0081c6",minWidth:b.DEFAULT_DROPDOWN_MIN_WIDTH,minHeight:b.DEFAULT_DROPDOWN_MIN_HEIGHT,optionValues:[{value:0,text:""}]}}),Z=n(de.shapes.chart.Plot,"hmi.Chart",{series:[{name:"value",showLegend:!1,data:[]}],axis:{"x-axis":de.util.cloneDeep(b.DEFAULT_CHART_X_AXIS_60_MIN),"y-axis":de.util.cloneDeep(b.DEFAULT_CHART_Y_AXIS)},attrs:{".value path":{stroke:"#0000FF","stroke-width":2},".point circle":{stroke:"#0000FF",fill:"#0000FF",opacity:1},".background rect":{fill:"transparent"},".y-axis .tick text":{"font-size":10,fontType:b.DEFAULT_FONT_TYPE},".x-axis .tick text":{"font-size":10,fontType:b.DEFAULT_FONT_TYPE},".foreground .caption":{"ref-y":"100%","y-alignment":"top",refY2:30,fontType:b.DEFAULT_FONT_TYPE}}},{initialize:function(e){f.prototype.initialize.apply(this,arguments),this.initializeOptions(e,{size:{width:b.DEFAULT_CHART_WIDTH,height:b.DEFAULT_CHART_HEIGHT}})},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/highlightColor"==n?a._setHighlightColor(o):"binding/timeRange"==n||"binding/count"==n||"binding/minValue"==n||"binding/maxValue"==n?a.updateTimeRange():"binding/visible"==n?a._setVisible(o):"binding/device"==n?a.setDevice(o):"binding/fillColor"==n?a._setFillColor(o):"binding/fontColor"==n?a._setFontColor(o):"binding/fontSize"==n?a._setFontSize(o):"binding/fontType"==n?a._setFontType(o):"binding/fontStyle"==n?a._setFontStyle(o):"binding/fontWeight"==n?a._setFontWeight(o):"binding/strokeColor"==n?a._setStrokeColor(o):"binding/strokeWidth"==n?a._setStrokeWidth(o):"binding/strokeDasharray"==n&&a._setStrokeDasharray(o)});var e=a._addEvt.bind(a);a.on("add",e),a.on("graph:add",e),a.on("remove",function(){a.stopIntervalUpdate()})},_setHighlightColor:function(e){this.attr(".value path",{stroke:e}),this.attr(".point circle",{stroke:e,fill:e})},_setFillColor:function(e){this.attr(".background rect",{fill:e})},_setFontColor:function(e){this.attr(".foreground .caption",{fill:e}),this.attr(".y-axis .ticks .tick text",{fill:e}),this.attr(".x-axis .ticks .tick text",{fill:e})},_setFontSize:function(e){this.attr(".foreground .caption",{fontSize:e}),this.attr(".y-axis .ticks .tick text",{fontSize:e}),this.attr(".x-axis .ticks .tick text",{fontSize:e})},_setFontType:function(e){this.attr(".foreground .caption",{fontFamily:e}),this.attr(".y-axis .ticks .tick text",{fontFamily:e}),this.attr(".x-axis .ticks .tick text",{fontFamily:e})},_setFontStyle:function(e){this.attr(".foreground .caption",{fontStyle:e}),this.attr(".y-axis .ticks .tick text",{fontStyle:e}),this.attr(".x-axis .ticks .tick text",{fontStyle:e})},_setFontWeight:function(e){this.attr(".foreground .caption",{fontWeight:e}),this.attr(".y-axis .ticks .tick text",{fontWeight:e}),this.attr(".x-axis .ticks .tick text",{fontWeight:e})},_setStrokeColor:function(e){this.attr(".y-axis path",{stroke:e}),this.attr(".y-axis .ticks .tick line",{stroke:e}),this.attr(".x-axis path",{stroke:e}),this.attr(".x-axis .ticks .tick line",{stroke:e})},_setStrokeWidth:function(e){this.attr(".y-axis path",{strokeWidth:e}),this.attr(".y-axis .ticks .tick line",{strokeWidth:e}),this.attr(".x-axis path",{strokeWidth:e}),this.attr(".x-axis .ticks .tick line",{strokeWidth:e}),this.attr(".value path",{strokeWidth:e}),this.attr(".point circle",{strokeWidth:e})},_setStrokeDasharray:function(e){this.attr(".y-axis path",{strokeDasharray:e}),this.attr(".y-axis .ticks .tick line",{strokeDasharray:e}),this.attr(".x-axis path",{strokeDasharray:e}),this.attr(".x-axis .ticks .tick line",{strokeDasharray:e}),this.attr(".value path",{strokeDasharray:e})},_addEvt:function(){var e,t=this.get("series");this.isEditableCanvas()&&!t[0].data.length&&((e=v()).hours(0),e.minutes(0),e.seconds(0),e.milliseconds(0),this.addPoint({x:e.toDate().getTime(),y:0},"value"),this.updateXAxisMinMax()),this.isEditableCanvas()||this._isStartedInterval||(this.set("series",[{name:"value",showLegend:!1,data:[]}]),this.startIntervalUpdate())},updateTimeRange:function(){var e={},t=this.prop("binding/timeRange");"string"==typeof t&&(t=Number(t));var i=this.prop("binding/count");e.tickStep=t,e.ticks=i,e.tickFormat=b.DEFAULT_CHART_X_AXIS_60_MIN.tickFormat,this.setAxis(e,{}),this.updateXAxisMinMax()},setAxis:function(e,t,i){var n=this.get("axis");if(n=de.util.cloneDeep(n),e){var o=n["x-axis"];n["x-axis"]=i?e:$.extend(o,e)}if(t){var a=n["y-axis"];n["y-axis"]=i?t:$.extend(a,t)}this.set("axis",n)},updateBindingValue:function(){var e=this,t=e.getValue(),i=e.prop("binding/minValue"),n=e.prop("binding/maxValue");n<t?t=n:t<i&&(t=i);var o=e.prop("binding/timeRange"),a=this.get("axis"),r=a["x-axis"],l=a["y-axis"],s=r.ticks,d=r.max,c=r.min,p=t,g=e.lastPoint("value");if(g){var h=g.x,u=v(h),f=e.getTimeRangeInfo(o);u.add(1*f.min,"minutes");var m=u.toDate().getTime();e.get("series")[0].data.length>=s&&d&&c&&(delete(r=de.util.cloneDeep(r)).max,delete r.min,e.setAxis(r,null,!0)),e.updateYAxisMinMax(p),e.addPoint({x:m,y:p},"value",{maxLen:s})}else{p=l.min,e.updateYAxisMinMax(p);var _=v();e.addPoint({x:_.toDate().getTime(),y:p},"value"),e.updateXAxisMinMax()}},getXAxisMinMax:function(e,t){var i=this.prop("binding/timeRange"),n=this.get("axis")["x-axis"].ticks;e=e||this.lastPoint("value").x;var o,a=e,r=v(e);if(t)o=t;else{var l=this.getTimeRangeInfo(i);r.add(n*l.min,"minutes"),o=r.toDate().getTime()}return{max:o,min:a}},getTimeRangeInfo:function(e){var t;for(t in b.CHART_MINUTES)if(b.CHART_MINUTES[t].value==e)return b.CHART_MINUTES[t];return b.CHART_MINUTES.ONE},updateXAxisMinMax:function(e){var t=this.getXAxisMinMax(e);this.setAxis(t)},updateYAxisMinMax:function(e){var t=this.get("axis")["y-axis"],i=t.max,n=t.min,o=t.ticks,a=this.getYAxisTickStep(n,i,o);i<e?(i=e,this.setAxis(null,{max:e,tickStep:a})):e<n&&(n=e,this.setAxis(null,{min:n,tickStep:a}))},getYAxisTickStep:function(e,t,i){var n=(t-e)/i;return n=Number(de.util.format.number("f",n))},updateTimeCaption:function(){var e=this.getTimeCaption();e=s.prop("COMMON_TIME")+" : "+e,this.updateCaption(e)},updateCaption:function(e){this.attr(".caption/text",e)},getTimeCaption:function(){return v().format("YYYY-MM-DD | HH:mm:ss")},startIntervalUpdate:function(){this._isStartedInterval=!0;var e=this.prop("binding/timeRange");this._intervalUpdate(),this._intervalTimer=setInterval(this._intervalUpdate.bind(this),e)},_intervalUpdate:function(){this.updateBindingValue(),this.updateTimeCaption()},stopIntervalUpdate:function(){clearTimeout(this._intervalTimer),this._isStartedInterval=!1},setBindingData:function(e){f.prototype.setBindingData.call(this,e);var t=e.highlightColor,i=e.timeRange,n=e.count,o=(e.textLocation,e.prefix,e.suffix,e.minValue),a=e.maxValue;this.prop("binding/count",n),this.prop("binding/highlightColor",t),this.prop("binding/timeRange",i),this.prop("binding/maxValue",a),this.prop("binding/minValue",o)},getGraphicBindingPopupData:function(){var e=f.prototype.getGraphicBindingPopupData.call(this),t=this.prop("binding");return e.count=t.count,e.highlightColor=t.highlightColor,e.timeRange=t.timeRange,e.minValue=t.minValue,e.maxValue=t.maxValue,e}},{defaultBindingProp:{type:"Chart",timeRange:6e4,highlightColor:"#0000FF",fillColor:"transparent",strokeColor:"#000000",fontColor:"#000000",fontSize:10,fontType:b.DEFAULT_FONT_TYPE,minValue:0,maxValue:100,count:1}}),j=o(de.shapes,"hmi.ChartView",de.shapes.chart.PlotView,{},{}),K=M.define("hmi.CustomComponent",{},{initialize:function(){var e=this;R.prototype.initialize.apply(e,arguments),e.attr("body/href",null);var r=e.prop("binding/custom"),l=r.id,t=window.HmiApi;e._imageDfd=t.getComponentImages(l).done(function(e){var t,i,n=r.images,o=e.length,a="/dms/hmi/components/"+l+"/images/{name}";for(i=0;i<o;i++)t=e[i],n[i].name=t.name,n[i].image=a.replace("{name}",t.name)}).always(function(){e.updateBindingValue()})},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n?a._setVisible(o):"binding/device"==n?a.setDevice(o):"binding/reverse"==n||"binding/value"==n||"binding/custom/controlType"==n||"binding/custom/type"==n?this.updateBindingValue():"binding/vFliped"==n||"binding/hFliped"==n?(a.setImageTransform(),a.flipAngle(n)):"binding/fontType"==n?a.attr("label/fontFamily",o):"binding/fontSize"==n?a.attr("label/fontSize",o):"binding/fontStyle"==n?a.attr("label/fontStyle",o):"binding/fontWeight"==n&&a.attr("label/fontWeight",o)}),a.on("event:pointerdown",a.controlPointerDown.bind(a)),a.on("event:pointerup",a.controlPointerUp.bind(a))},getCurrentState:function(e){var t=this.prop("binding"),i=t.device.type;i=i||("Multi"==t.custom.type?"ControlPoint.AI":"ControlPoint.DI");var n=this.getCurrentStateItem(i,e).value;return this.isReverse()&&(n=D.getReverseState(n)),n},isReverse:function(){if("Multi"==this.prop("binding/custom/type"))return!1;var e=this.prop("binding/reverse");return"true"==e||!0===e},getCurrentStateItem:function(e,t){var i=this.prop("binding/custom"),n=i.type,o=i.images;if(t=null!=t?Number(t):0,"Multi"!=n)return 1==t?{value:"on",text:s.prop("HMI_STATE_ON")}:{value:"off",text:s.prop("HMI_STATE_OFF")};var a,r,l=o.length;for(r=0;r<l;r++)if(t>=(a=o[r]).min&&t<=a.max)return this.prop("binding/custom/invalid",!1),{value:r,text:s.prop("HMI_STATE_LEVEL",r)};return this.prop("binding/custom/invalid",!0),{value:0,text:s.prop("HMI_STATE_LEVEL",0)}},controlPointerDown:function(){var e=this;if(!e.isEditableCanvas()&&"Controlled"==e.prop("binding/custom/type")){var t=!1,i=e.prop("binding/custom/controlType");if("Push"==i||"Momentary"==i){var n=e.getValue(),o=e.getCurrentState(n);e._pushState=o,n=e.getDigitalTypeControlValue(),o=e.getCurrentState(n),e._updateImageFromState(o),t=!0}e.patchDigitalTypeControlValue(t).always(function(){})}},controlPointerUp:function(){if(!this.isEditableCanvas()&&"Controlled"==this.prop("binding/custom/type")){var e=this.prop("binding/custom/controlType");"Push"!=e&&"Momentary"!=e||this._pushState&&this._updateImageFromState(this._pushState),"Momentary"==e&&this.patchDigitalTypeControlValue(!1,!0).always(function(){})}},updateBindingValue:function(){var e=this.getValue(),t=this.getCurrentState(e);this._updateImageFromState(t)},_updateImageFromState:function(o){var a=this,r=a.prop("binding/custom"),l=r.type;a._imageDfd.always(function(){var e,t,i=r.images;t="Multi"==l?i[o]:"on"==o?i[1]:i[0],e=t.image;var n=new window.Image;n.onload=function(){a.attr("body/href",g.addBuildDateQuery(e))},n.onerror=function(e){a.attr("body/href",g.addBuildDateQuery(b.DEFAULT_LIBRARY_NO_IMAGE_URL))},n.src=e})},setBindingData:function(e){f.prototype.setBindingData.call(this,e);var t=e.reverse,i=e.buttonType;this.prop("binding/reverse",t),i&&this.prop("binding/custom/controlType",i)},getGraphicBindingPopupData:function(){var e=f.prototype.getGraphicBindingPopupData.call(this),t=this.prop("binding"),i=t.custom;return i.controlType&&(e.buttonType=i.controlType),e.custom=t.custom,e.reverse=t.reverse,e}},{defaultBindingProp:{type:"Custom",custom:{id:1,name:"",type:"Controlled",controlType:"Push",images:[{id:1,name:null,status:"OFF"},{id:2,name:null,status:"ON"}],invalid:!1},graphicColor:null,state:null,gauge:null,minValue:null,maxValue:null}}),J=_.define("hmi.StatisticsBuildingOperation",{attrs:{body:{stroke:b.DEFAULT_STROKE_COLOR,fill:"#ffffff"},title:{refX:.05,refY:.1,text:s.prop("HMI_STATISTICS_INDOOR_BUILDING")},scheduleWrapper:{refWidth:1,refHeight:.18,refY:.28},titleSchedule:{refX:.05,text:s.prop("DASHBOARD_BUILDING_OPERATION_STATUS_SCHEDULES")},countSchedule:{refX:.4},barWrapper:{refX:.05,refY:.48,refWidth:b.DEFAULT_STATISTICS_CARD_WIDTH_RATIO,refHeight:.07},bar:{refY:0,refHeight:.07},barOn:{refX:0,refWidth:0,fill:b.DEFAULT_STATISTICS_COLOR_ON},barOff:{refX:0,refWidth:b.DEFAULT_STATISTICS_CARD_WIDTH_RATIO,fill:b.DEFAULT_STATISTICS_COLOR_OFF},barCritical:{refX:b.DEFAULT_STATISTICS_CARD_WIDTH_RATIO,refWidth:0,fill:b.DEFAULT_STATISTICS_COLOR_CRITICAL},barWarning:{refX:b.DEFAULT_STATISTICS_CARD_WIDTH_RATIO,refWidth:0,fill:b.DEFAULT_STATISTICS_COLOR_WARNING},stateWrapper:{refX:.05,refY:.69,refWidth:b.DEFAULT_STATISTICS_CARD_WIDTH_RATIO,refHeight:.26},state:{refWidth:.225,refHeight:.26},stateArea:{refWidth:.225,refHeight:.26,fill:"transparent"},stateOn:{refWidth:.225,refX:.1},stateOff:{refWidth:.225,refX:.325},stateCritical:{refWidth:.225,refX:.55},stateWarning:{refWidth:.21,refX:.775},stateTitle:{textAnchor:"middle"},stateCount:{refY:.12,textAnchor:"middle"},titleOn:{text:s.prop("FACILITY_DEVICE_STATUS_ON")},titleOff:{text:s.prop("FACILITY_DEVICE_STATUS_OFF")},titleCritical:{text:s.prop("FACILITY_DEVICE_STATUS_CRITICAL")},titleWarning:{text:s.prop("FACILITY_DEVICE_STATUS_WARNING")}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"title"},{tagName:"g",selector:"scheduleWrapper",children:[{tagName:"text",selector:"titleSchedule"},{tagName:"text",selector:"countSchedule"}]},{tagName:"g",selector:"barWrapper",children:[{tagName:"rect",selector:"barOn",groupSelector:"bar"},{tagName:"rect",selector:"barOff",groupSelector:"bar"},{tagName:"rect",selector:"barCritical",groupSelector:"bar"},{tagName:"rect",selector:"barWarning",groupSelector:"bar"}]},{tagName:"g",selector:"stateWrapper",children:[{tagName:"g",selector:"stateOn",groupSelector:"state",children:[{tagName:"rect",groupSelector:"stateArea"},{tagName:"text",selector:"titleOn",groupSelector:"stateTitle"},{tagName:"text",selector:"countOn",groupSelector:"stateCount"}]},{tagName:"g",selector:"stateOff",groupSelector:"state",children:[{tagName:"rect",groupSelector:"stateArea"},{tagName:"text",selector:"titleOff",groupSelector:"stateTitle"},{tagName:"text",selector:"countOff",groupSelector:"stateCount"}]},{tagName:"g",selector:"stateCritical",groupSelector:"state",children:[{tagName:"rect",groupSelector:"stateArea"},{tagName:"text",selector:"titleCritical",groupSelector:"stateTitle"},{tagName:"text",selector:"countCritical",groupSelector:"stateCount"}]},{tagName:"g",selector:"stateWarning",groupSelector:"state",children:[{tagName:"rect",groupSelector:"stateArea"},{tagName:"text",selector:"titleWarning",groupSelector:"stateTitle"},{tagName:"text",selector:"countWarning",groupSelector:"stateCount"}]}]}],textAttrsSelector:["title","titleSchedule","countSchedule","stateTitle","stateCount"],initialize:function(e){_.prototype.initialize.apply(this,arguments),this.initializeOptions(e,{size:{width:b.DEFAULT_STATISTICS_CARD_WIDTH,height:b.DEFAULT_STATISTICS_CARD_HEIGHT},binding:{building:{id:0,name:null}}}),0!=this.prop("binding").building.id&&this.startIntervalUpdate()},attachEvent:function(){var r=this;_.prototype.attachEvent.apply(r,arguments),r.on("remove",r.onRemove.bind(r)),r.on("change:binding",function(e,t,i){var n=i.propertyPath,o=r.getPropertyValue(n,i.propertyValue),a=r.textAttrsSelector;"binding/building"==n&&o?r.startIntervalUpdate():"binding/fontSize"==n?a.forEach(function(e){r.attr(e+"/fontSize",o)}):"binding/fontColor"==n?a.forEach(function(e){r.attr(e+"/fill",o)}):"binding/fontStyle"==n?a.forEach(function(e){r.attr(e+"/fontStyle",o)}):"binding/fontWeight"==n&&a.forEach(function(e){r.attr(e+"/fontWeight",o)})})},getGraphicBindingPopupData:function(){var e=p.prototype.getGraphicBindingPopupData.call(this),t=this.prop("binding");return e.building=t.building,e},setBindingData:function(e){p.prototype.setBindingData.call(this,e);var t=e.building;this.prop("binding/building",t)},stopIntervalUpdate:function(){clearTimeout(this._intervalTimer),this._isStartedInterval=!1},startIntervalUpdate:function(){var e=this.prop("binding").building;0!=e.id&&(this.stopIntervalUpdate(),this._isStartedInterval=!0,this.getStatisticsData(e.id),this._intervalTimer=setInterval(this.getStatisticsData.bind(this,e.id),b.DEFAULT_STATISTICS_TIMEOUT))},getStatisticsData:function(e){$.ajax({url:"/dms/devices/statisticView/AirConditioner?foundation_space_buildings_id="+e+"&exposeFloors=false"}).done(this.onDataRefresh.bind(this)).fail(function(){}).always(function(){})},onDataRefresh:function(e){e=e[0]||{};var t=b.DEFAULT_STATISTICS_CARD_WIDTH_RATIO,i=e.numberOfOnIndoorDevices||0,n=e.numberOfOffIndoorDevices||0,o=e.numberOfCriticalDevices||0,a=e.numberOfWarningDevices||0,r=e.numberOfSchedules||0,l=e.foundation_space_buildings_name||this.prop("binding/building/name"),s=i+n+o+a;this.stopCanvasListening(),this.attr({title:{text:l},countSchedule:{text:r},countOn:{text:i},countOff:{text:n},countCritical:{text:o},countWarning:{text:a},barOn:{refWidth:0<s?i/s*t:0},barOff:{refX:i/s*t,refWidth:0<s?n/s*t:t},barCritical:{refX:(i+n)/s*t,refWidth:0<s?o/s*t:0},barWarning:{refX:(i+n+o)/s*t,refWidth:0<s?a/s*t:0}}),this.startCanvasListening()},onRemove:function(){this.stopIntervalUpdate()}},{defaultBindingProp:{type:"Statistics",initWidth:b.DEFAULT_STATISTICS_CARD_WIDTH,initHeight:b.DEFAULT_STATISTICS_CARD_HEIGHT,strokeWidth:0,strokeColor:b.DEFAULT_STROKE_COLOR,strokeDasharray:"0",fillColor:"#ffffff",opacity:1,fontType:b.DEFAULT_FONT_TYPE,fontSize:b.DEFAULT_FONT_SIZE,fontColor:b.DEFAULT_FONT_COLOR,fontStyle:b.DEFAULT_FONT_STYLE,building:{id:0,name:null}}}),q=u(de.shapes.chart.Pie,"hmi.StatisticsFacilityOperation",{series:[{data:[{value:25,label:s.prop("DASHBOARD_BUILDING_OPERATION_STATUS_ON"),fill:b.DEFAULT_STATISTICS_COLOR_ON},{value:25,label:s.prop("DASHBOARD_BUILDING_OPERATION_STATUS_OFF"),fill:b.DEFAULT_STATISTICS_COLOR_OFF},{value:25,label:s.prop("DASHBOARD_BUILDING_OPERATION_STATUS_CRITICAL"),fill:b.DEFAULT_STATISTICS_COLOR_CRITICAL},{value:25,label:s.prop("DASHBOARD_BUILDING_OPERATION_STATUS_WARNING"),fill:b.DEFAULT_STATISTICS_COLOR_WARNING}]}],pieHole:.7,serieDefaults:{startAngle:270,showLegend:!1},sliceDefaults:{onHoverEffect:null},attrs:{title:{text:s.prop("HMI_STATISTICS_INDOOR"),refX:.05,refY:.08,fill:"#000000"},".background > rect":{opacity:1,stroke:b.DEFAULT_STROKE_COLOR},".foreground > rect":{fill:"white",stroke:"#e5e5e5",opacity:0,"pointer-events":"none"},".foreground .caption":{fill:"black",text:"",ref:".foreground > rect","ref-x":2,"ref-y":6,"text-anchor":"start","y-alignment":"middle","font-size":14},".foreground .subcaption":{fill:"black",text:"",ref:".foreground > rect","ref-x":2,"ref-y":18,"text-anchor":"start","y-alignment":"middle","font-size":10},".data":{ref:".background","ref-x":.5,"ref-y":.37,"ref-width":.4},".slice":{cursor:"pointer"},".slice > .slice-fill":{stroke:"#ffffff","stroke-width":1,"fill-opacity":1},".slice.hover > .slice-fill":{"fill-opacity":.8},".slice > .slice-border":{"stroke-width":6,"stroke-opacity":.4,"fill-opacity":1,fill:"none",display:"none"},".slice.hover > .slice-border":{display:"none"},".slice > .slice-inner-label":{"text-anchor":"middle","font-size":"12",stroke:"none","stroke-width":"0",fill:"#000000","ref-x":0,"ref-y":0,display:"none"},".slice.hover > .slice-inner-label":{display:"block"},".slice > .slice-inner-label > tspan":{dy:"1em"},".slice > .slice-inner-label > tspan:first-child":{dy:"-1em"},".device-legend-unit text":{fill:"#323232","font-size":13,textAnchor:"end"},".device-legend":{"ref-x":.05,"ref-y":.6,"ref-width":b.DEFAULT_STATISTICS_CARD_WIDTH_RATIO},'.device-legend-item[data-slice="0"]':{"ref-y":.07},'.device-legend-item[data-slice="1"]':{"ref-y":.14},'.device-legend-item[data-slice="2"]':{"ref-y":.21},'.device-legend-item[data-slice="3"]':{"ref-y":.28},".device-legend-item > rect":{width:12,height:12},".device-legend-item text":{fill:"#000000","font-size":b.DEFAULT_FONT_SIZE,textVerticalAnchor:"middle"},".device-legend-item .device-state":{textAnchor:"start"},".device-legend-item .device-count":{textAnchor:"end"}}},{markup:[{tagName:"g",selector:"body",className:"roatatable",children:[{tagName:"g",className:"scalable"},{tagName:"g",className:"background",children:[{tagName:"rect"},{tagName:"text"}]},{tagName:"text",selector:"title"},{tagName:"g",selector:"data",className:"data"},{tagName:"g",selector:"foreground",className:"foreground",children:[{tagName:"rect"},{tagName:"text",className:"caption"},{tagName:"text",className:"subcaption"},{tagName:"g",className:"legend",children:[{tagName:"g",className:"legend-items"}]},{tagName:"g",className:"device-legend",children:[{tagName:"g",className:"device-legend-items"}]}]}]}],deviceLegendUnitMarkup:'<g class="device-legend-unit"><text/></g>',deviceLegendMarkup:'<g class="device-legend-item"><rect/><text class="device-state"/><text class="device-count"/></g>',textAttrsSelector:["title",".foreground .caption",".foreground .subcaption",".slice > .slice-inner-label",".device-legend-unit text",".device-legend-item text"],initialize:function(e){p.prototype.initialize.apply(this,arguments),this.initializeOptions(e,{size:{width:b.DEFAULT_STATISTICS_CARD_WIDTH,height:2*b.DEFAULT_STATISTICS_CARD_HEIGHT}}),this.startIntervalUpdate()},attachEvent:function(){var r=this;r.on("remove",r.onRemove.bind(r)),r.on("change:binding",function(e,t,i){var n=i.propertyPath,o=r.getPropertyValue(n,i.propertyValue),a=r.textAttrsSelector;"binding/fontSize"==n?a.forEach(function(e){r.attr(e+"/fontSize",o)}):"binding/fontColor"==n?a.forEach(function(e){r.attr(e+"/fill",o)}):"binding/fontStyle"==n?a.forEach(function(e){r.attr(e+"/fontStyle",o)}):"binding/fontWeight"==n?a.forEach(function(e){r.attr(e+"/fontWeight",o)}):"binding/strokeWidth"==n?r.attr(".background rect/strokeWidth",o):"binding/strokeColor"==n?r.attr(".background rect/stroke",o):"binding/fillColor"==n?r.attr(".background rect/fill",o):"binding/opacity"==n?r.attr(".background rect/opacity",o):"binding/strokeDasharray"==n&&r.setDasharray(o)})},stopIntervalUpdate:function(){clearTimeout(this._intervalTimer),this._isStartedInterval=!1},startIntervalUpdate:function(){this.stopIntervalUpdate(),this._isStartedInterval=!0,this.getStatisticsData(),this._intervalTimer=setInterval(this.getStatisticsData.bind(this),b.DEFAULT_STATISTICS_TIMEOUT)},getStatisticsData:function(){$.ajax({url:"/dms/devices/statisticView/AirConditioner?foundation_space_buildings_id=0"}).done(this.onDataRefresh.bind(this)).fail(function(){}).always(function(){})},onDataRefresh:function(e){var t=(e=e[0]).numberOfOnIndoorDevices,i=e.numberOfOffIndoorDevices,n=e.numberOfCriticalDevices,o=e.numberOfWarningDevices;this.stopCanvasListening(),this.set("series",[{data:[{value:t,label:s.prop("DASHBOARD_BUILDING_OPERATION_STATUS_ON"),fill:b.DEFAULT_STATISTICS_COLOR_ON},{value:i,label:s.prop("DASHBOARD_BUILDING_OPERATION_STATUS_OFF"),fill:b.DEFAULT_STATISTICS_COLOR_OFF},{value:n,label:s.prop("DASHBOARD_BUILDING_OPERATION_STATUS_CRITICAL"),fill:b.DEFAULT_STATISTICS_COLOR_CRITICAL},{value:o,label:s.prop("DASHBOARD_BUILDING_OPERATION_STATUS_WARNING"),fill:b.DEFAULT_STATISTICS_COLOR_WARNING}]}]),this.startCanvasListening()},onRemove:function(){this.stopIntervalUpdate()}},{defaultBindingProp:{type:"Statistics",initWidth:b.DEFAULT_STATISTICS_CARD_WIDTH,initHeight:2*b.DEFAULT_STATISTICS_CARD_HEIGHT,strokeWidth:0,strokeColor:b.DEFAULT_STROKE_COLOR,strokeDasharray:"0",fillColor:"#ffffff",opacity:1,fontType:b.DEFAULT_FONT_TYPE,fontSize:b.DEFAULT_FONT_SIZE,fontColor:b.DEFAULT_FONT_COLOR,fontStyle:b.DEFAULT_FONT_STYLE}}),Q=de.shapes.chart.PieView,ee=o(de.shapes,"hmi.StatisticsFacilityOperationView",Q,{renderMarkup:function(){Q.prototype.renderMarkup.apply(this,arguments),this.elDeviceLegendUnit=h(this.model.deviceLegendUnitMarkup),this.elDeviceLegendItems=this.$(".device-legend-items")[0],this.elDeviceLegend=h(this.model.deviceLegendMarkup)},calculateSeries:function(i){var l=window._,e=de.util.cloneDeep(this.model.get("series")),s=this.model.get("serieDefaults"),d=this.model.get("sliceDefaults"),t=this.model.get("size"),n=Math.min(t.width*b.DEFAULT_STATISTICS_CARD_PIE_WIDTH_RATIO,t.height*b.DEFAULT_STATISTICS_CARD_PIE_HEIGHT_RATIO)/2,o=this.model.get("pieHole"),c=n,p=(n-(o=1<o?o:n*o))/e.length;return this._series=e.map(function(e,n){if(void 0!==i&&i!==n)return e;var o=(e=l.defaults(e,s)).startAngle,t=e.data.reduce(function(e,t){return e+t.value},0),a=e.degree/t||0,r=100/t;return e.data=e.data.map(function(e,t){(e=l.defaults(e,l.omit(d,"offset","onClickEffect","onHoverEffect"))).outerRadius=c,e.innerRadius=c-p,n||((e=l.defaults(e,l.pick(d,"offset","onClickEffect","onHoverEffect"))).isOuter=!0,e.offset=1<e.offset?e.offset:e.offset*e.outerRadius,e.onClickEffect.offset=1<e.onClickEffect.offset?e.onClickEffect.offset:e.onClickEffect.offset*e.outerRadius),e.serieIndex=n,e.sliceIndex=t,e.innerLabelMargin=e.innerLabelMargin<-1||1<e.innerLabelMargin?e.innerLabelMargin:e.innerLabelMargin*e.outerRadius,e.percentage=e.value*r;var i=e.value*a;return e.degree={angle:i,start:o,end:i+o},e.rad={angle:y.toRad(e.degree.angle,!0),start:y.toRad(e.degree.start,!0),end:y.toRad(e.degree.end,!0)},e.middleangle=(e.rad.start+e.rad.end)/2,o=e.degree.end,e}),c-=p,e}),this._series},updateSlice:function(e){var t=this.elSlice.clone();h(this.elPie).append(t);var i=this.elSliceFill.clone(),n=this.getSliceFillColor(e.sliceIndex,e.serieIndex);i.attr({fill:n,d:h.createSlicePathData(e.innerRadius,e.outerRadius,e.rad.start,e.rad.end)}),t.append(i),de.util.isObject(n)&&this.applyGradient("#"+i.attr("id"),"fill",n);var o=this.elSliceBorder.clone(),a=parseInt(this.model.attr(".slice > .slice-border/stroke-width"),10),r=y.point.fromPolar(e.outerRadius+a/2,-e.rad.start,y.point(0,0)),l=y.point.fromPolar(e.outerRadius+a/2,-e.rad.end,y.point(0,0));o.attr({stroke:n,d:this.drawArc(r,l,e.outerRadius+a/2,e.rad.start,e.rad.end)}),t.append(o),de.util.isObject(n)&&this.applyGradient("#"+o.attr("id"),"stroke",n);var s=this.elSliceInnerLabel.clone(),d=de.util.format.string(e.innerLabel,e);s.text(d+"\r\n"+e.label),t.append(s);var c=s.bbox(),p=e.outerRadius-c.width/2-e.innerLabelMargin;s.translate(p*Math.cos(-e.middleangle),-p*Math.sin(-e.middleangle)),t.attr({"data-serie":e.serieIndex,"data-slice":e.sliceIndex,"data-value":e.value});var g=this._series[e.serieIndex].name;return g&&t.addClass(g),e.name&&t.addClass(e.name),t.addClass("serie-"+e.serieIndex+" slice-"+e.sliceIndex),e.isOuter&&(t.addClass("outer"),e.offset&&(t.addClass("clicked"),this.effectOnSlice(t,e,{type:"offset",offset:e.offset}))),t},updateLegend:function(){var r=this;Q.prototype.updateLegend.apply(r,arguments);var e=r._series;r.elDeviceLegendItems.textContent="";var l=r.model.getBBox().width*b.DEFAULT_STATISTICS_CARD_WIDTH_RATIO;de.util.toArray(e).forEach(function(e,a){var t=r.elDeviceLegendUnit.clone();t.findOne("text").text("(EA)").translate(l,0);h(this.elDeviceLegendItems).append(t),de.util.forIn(e.data,function(e,t){var i=r.elDeviceLegend.clone(),n=r.getSliceFillColor(t,a);e.name&&i.addClass(e.name),i.attr({"data-serie":a,"data-slice":t}),i.findOne(".device-state").text(e.label).translate(25,0);var o=e.value.toString();i.findOne(".device-count").text(o).translate(l,0),de.util.isObject(n)?r.applyGradient(i.findOne("rect"),"fill",n):i.findOne("rect").attr({fill:n}),h(r.elDeviceLegendItems).append(i)})},r)}},{}),te=M.define("hmi.Indoor",{attrs:{box:{refWidth:"100%",refHeight:"100%",rx:10,ry:10,fill:"rgba(50,50,50,.9)",stroke:"rgba(50,50,50,.9)",strokeWidth:1},device:{refX:0,refY:0,refX2:"-18.75%",refY2:"-63%",refWidth:"39.5%",refHeight:"126%"},name:{refX:"29.3%",refY:"12%",fontSize:b.DEFAULT_FONT_SIZE,fill:"#ffffff",textAnchor:"start",textVerticalAnchor:"top",text:s.prop("HMI_DEVNAME")},status_0:{refX:"1%",refY:"50%",refWidth:"13.15%",refHeight:"42%"},status_1:{refX:"1%",refX2:"13%",refY:"50%",refWidth:"13.15%",refHeight:"42%"},operation_color:{refX:"3%",refX2:"26.3%",refY:"50%",refCx:"6.9%",refCy:"21%",refRCircumscribed:"6.3%",fill:"#b2b2b2"},operation_img:{refX:"3%",refX2:"26.3%",refY:"50%",refWidth:"13.15%",refHeight:"42%"},current:{refX:"6.9%",refX2:"39.45%",refY:"50%",refY2:"10%",refWidth:"26.7%",fontSize:15,fontWeight:600,textAnchor:"start",textVerticalAnchor:"top",fill:"#25b3ff",text:"--.-\xb0"},desired:{refX:"6.9%",refX2:"66.15%",refY:"50%",refY2:"10%",refWidth:"26.7%",fontSize:15,textAnchor:"start",textVerticalAnchor:"top",text:"--.-\xb0",fill:"#ffffff"},alarm:{refX:0,refY:0,refX2:"-12%",refY2:"-36%",refWidth:"24%",refHeight:"72%"}}},{markup:[{tagName:"rect",selector:"box"},{tagName:"image",selector:"device"},{tagName:"text",selector:"name"},{tagName:"image",selector:"status_0"},{tagName:"image",selector:"status_1"},{tagName:"circle",selector:"operation_color"},{tagName:"image",selector:"operation_img"},{tagName:"text",selector:"current"},{tagName:"text",selector:"desired"},{tagName:"image",selector:"alarm"}],initialize:function(e){M.prototype.initialize.apply(this,arguments);var t=this.prop("binding/key"),i={};-1!=t.indexOf("SUMMARY")?i.cardType="summary":-1!=t.indexOf("GENERAL")&&(i.cardType="general"),this.initializeOptions(e,{size:{width:b.DEFAULT_INDOOR_WIDTH,height:b.DEFAULT_INDOOR_HEIGHT},binding:i}),this.setSummaryType("summary"==i.cardType)},_defaultAddEvt:function(){M.prototype._defaultAddEvt.apply(this,arguments);var e=this.getCanvas();if(e){var t=e.getZoomLevel();t/=100,this.trigger("element:changeZoom",{zoom:t})}},attachEvent:function(){var a=this;a.on("change:binding",function(e,t,i){var n=i.propertyPath,o=a.getPropertyValue(n,i.propertyValue);"binding/visible"==n?a._setVisible(o):"binding/device"==n?a.setDevice(o):"binding/projection"==n?a.setProjection(o):"binding/selected"==n?a._setSelected(o):"binding/vFliped"!=n&&"binding/hFliped"!=n||(a.setImageTransform(),a.flipAngle(n))}),a.on("event:pointerdown",a.controlPointerDown.bind(a)),a.on("element:changeZoom",function(e){var t=a.prop("binding");if(t.cardType)a.setSummaryType("summary"==t.cardType);else{var i=e.zoom,n=i<1.5;a.setSummaryType(n,i)}})},setDevice:function(e){var t=this;if(e.id){var i=e.name,n=g.getStatus(e);n=n.toLowerCase().replace(/\./gi,"-");var o=e.temperatures,a=e.modes,r=e.operations,l=e.airConditioner,s=t.prop("binding/projection");if(i&&t.setName(i),l){var d=l.indoorUnitType;t.setIndoorType(d,s,n)}a&&r&&n&&t.setModes(a,r,n),o&&a&&t.setTemperature(o,a),t.setEtcStatus()}else t.attr("device/href",null),t.attr("alarm",{href:null,opacity:0});var c=t.getCanvas();if(c){var p=c.getZoomLevel();p/=100,t.trigger("element:changeZoom",{zoom:p})}},setProjection:function(e){var t=this.prop("binding/device");if(t.id){var i=t.airConditioner,n=g.getStatus(t);if(n=n.toLowerCase().replace(/\./gi,"-"),i){var o=i.indoorUnitType;this.setIndoorType(o,e,n)}}},_setSelected:function(e){e?this.attr("box",{stroke:"#0081c6",strokeWidth:2}):this.attr("box",{stroke:"rgba(50,50,50,.9)",strokeWidth:1})},setSelected:function(e){this.prop("binding/selected",e)},setIndoorType:function(e,t,i){if(e){var n,o,a,r=e.split("."),l=r[r.length-1],s=d.indoorDeviceImages;for(n in s)if(-1!=l.indexOf(n)){(a=s[n][t])&&(o="normal-off"==i?a[i]:a["normal-on"]);break}o&&this.attr("device/href",g.addBuildDateQuery(o))}},setName:function(e){var t=this.prop("binding/fontSize");this.attr("name/title",e),e=de.util.breakText(e,{width:107,height:21.5},{"font-size":t},{hyphen:/[^\n]/,ellipsis:!0}),this.attr("name/text",e)},setTemperature:function(e,t){var i="--.-\xb0",n="--.-\xb0",o=this.prop("binding/device");if(t=t||o.modes,e&&0<e.length){if(i=(e=e[0]).current?e.current.toFixed(1):"--.-",n=e.desired?e.desired.toFixed(1):"--.-",t){var a=$.grep(t,function(e){return"AirConditioner.Indoor.General"==e.id&&"Fan"==e.mode});a&&a.length&&(n="--.-")}null!=i&&(i=m.toString(g.convertNumberFormat(i),"00.0"),i+="\xb0"),null!=n&&(n=m.toString(g.convertNumberFormat(n),"00.0"),n+="\xb0")}this.attr("current/text",i),this.attr("desired/text",n)},setModes:function(e,t,i){var n=this.prop("binding/device");t=t||n.operations,i=i||(i=g.getStatus(n)).toLowerCase().replace(/\./gi,"-");var o=g.getDisplayMode(e,t),a=d.indoorModeImages[o];a&&this.attr("operation_img/href",g.addBuildDateQuery(a));var r=d.deviceStatusColors[i];"alarm-warning"==i?(r=d.deviceStatusColors["normal-on"],this.attr("alarm",{href:g.addBuildDateQuery("../../src/main/resources/static-dev/images/icon/mark-warning.png"),opacity:1})):"alarm-critical"==i?(r=d.deviceStatusColors["normal-on"],this.attr("alarm",{href:g.addBuildDateQuery("../../src/main/resources/static-dev/images/icon/mark-critical.png"),opacity:1})):this.attr("alarm",{href:null,opacity:0}),r=r||d.deviceStatusColors["normal-off"],this.attr("operation_color",{fill:r})},setEtcStatus:function(){},controlPointerDown:function(e,t){if(!this.isEditableCanvas()){var i=this.prop("binding/device");if(D.isInvalidDevice(i))return;var n=this.prop("binding/selected");this.prop("binding/selected",!n);i=this.prop("binding/device");var o=this.getCanvas();o&&o.selectIndoorDevice(i)}},updateBindingValue:function(){var e=this.prop("binding/device");this.setDevice(e)},setBindingData:function(e){f.prototype.setBindingData.call(this,e);var t=e.projection;t&&this.prop("binding/projection",t)},getGraphicBindingPopupData:function(){var e=f.prototype.getGraphicBindingPopupData.call(this),t=this.prop("binding");return e.projection=t.projection,e},setSummaryType:function(e,t){var i=this,n={opacity:0},o={opacity:1};e?(i.attr("device",n),i.attr("status_0",n),i.attr("status_1",n),i.attr("name",n),i.attr("desired",n),i.attr("operation_color",{refX:0,refX2:null,refY:"25%",refY2:"-21%",refCx:"50%",refCy:"25%",refRCircumscribed:"14.82%"}),i.attr("operation_img",{refX:"50%",refY:"50%",refX2:"-21%",refY2:"-42%",refWidth:"42%",refHeight:"42%"}),i.attr("alarm",{refX:"50%",refY:"50%",refX2:"-34%",refY2:"-34%",refWidth:"68%",refHeight:"68%"}),i.attr("current",{refX:"50%",refY:"75%",refX2:null,refY2:null,textAnchor:"middle",textVerticalAnchor:"middle"}),1==i.attr("alarm/opacity")?(i.attr("operation_color",n),i.attr("operation_img",n),i.attr("current",n)):(i.attr("operation_color",o),i.attr("operation_img",o),i.attr("current",o)),i.resize(b.DEFAULT_INDOOR_HEIGHT,b.DEFAULT_INDOOR_HEIGHT)):(i.attr("device",o),i.attr("status_0",o),i.attr("status_1",o),i.attr("name",o),i.attr("desired",o),i.attr("operation_color",o),i.attr("operation_img",o),i.attr("current",o),i.attr("operation_color",{refX:"3%",refX2:"26.3%",refY:"50%",refY2:null,refCx:"6.9%",refCy:"21%",refRCircumscribed:"6.3%"}),i.attr("operation_img",{refX:"3%",refY:"50%",refX2:"26.3%",refY2:null,refWidth:"13.15%",refHeight:"42%"}),i.attr("alarm",{refX:0,refY:0,refX2:"-12%",refY2:"-36%",refWidth:"24%",refHeight:"72%"}),i.attr("current",{refX:"6.9%",refY:"50%",refX2:"39.45%",refY2:"10%",textAnchor:"start",textVerticalAnchor:"top"}),i.resize(b.DEFAULT_INDOOR_WIDTH,b.DEFAULT_INDOOR_HEIGHT))},setScale:function(e){var t=this,i=t.prop("binding/fontSize"),n=t.position(),o=i*e,a=t.angle()||0;if(a){var r=t.getBBox().bbox(a);n.x=r.x,n.y=r.y}t.scale(e,e,n,{preventSetGridPoint:!0});var l=10*e;t.attr("box/rx",l),t.attr("box/ry",l),t.attr("name/fontSize",o),t.attr("current/fontSize",o),t.attr("desired/fontSize",o)}},{defaultBindingProp:{type:"Indoor",projection:"Perspective",selected:!1,fontSize:15,fontWeight:600}}),ie={Group:a,Rectangle:_,RoundRectangle:T,Parallelogram:C,Trapezoid:E,Triangle:I,Circle:A,Line:S,Straight:w,Curve:L,Table:x,HyperLink:O,Zone:N,Image:R,ImportImage:B,Animation:M,Button:P,RectangleButton:F,RoundButton:k,Text:U,ExtendText:G,ProgressBar:V,ScaleBar:W,CheckBox:z,RadioButton:Y,ComboBox:X,Chart:Z,ChartView:j,CustomComponent:K,StatisticsBuildingOperation:J,StatisticsFacilityOperation:q,StatisticsFacilityOperationView:ee,Indoor:te};return window.RappidElement=ie}),define("hmi/config/rappid-extended-class",["hmi/hmi-common"],function(D){window._;var g=window.joint,S=window.g,d=window.V,c=window.Util,l=window.kendo,p=g.dia.Graph,t=g.dia.Paper,w=g.util.normalizeEvent,e=p.extend({initialize:function(e){p.prototype.initialize.apply(this,arguments)},toJSON:function(){var e=p.prototype.toJSON.apply(this,arguments),t=this._paper;if(t&&t._canvas){var i=t._canvas,n=i.backgroundImageData;n&&(e.backgroundImageData=n);var o=i.version;o?e.orginalVersion=o:e.version=D.CURRENT_HMI_VERSION}return e},fromJSON:function(e,t){var i=this._paper;if(i&&i._canvas){var n=i._canvas,o=e.backgroundImageData;o&&n.setBackground(o);var a=e.version?e.version:e.originalVersion;a&&n.setVersion(a)}var r,l,s,d,c=p.prototype.fromJSON.apply(this,arguments).get("cells");if(c)for(l=(d=c.models).length,r=0;r<l;r++)(s=d[r]).trigger("graph:add",s,s.collection,{add:!0,remove:!1,merge:!1})},getCellsBBox:function(e,o){return o=o||{},g.util.toArray(e).reduce(function(e,t){var i=t.getBBox(o);if(!i)return e;var n=t.angle();return n&&!o.ignoreRotate&&(i=i.bbox(n)),e?e.union(i):i},null)}}),i=t.extend({initialize:function(e){t.prototype.initialize.call(this,e)},sortViewsExact:function(){var e=$(this.cells).children("[model-id]"),r=this.model.get("cells");g.util.sortElements(e,function(e,t){var i=r.get(e.getAttribute("model-id")),n=r.get(t.getAttribute("model-id"));if(!i||!n)return 0;var o=i.attributes.z||0,a=n.attributes.z||0;return o===a?0:o<a?-1:1})}}),h=g.ui.FreeTransform.extend({events:{"mousedown .resize":"startResizing","mousedown .rotate":"startRotating","touchstart .resize":"startResizing","touchstart .rotate":"startRotating","mousedown .change":"startPointChanging","touchstart .change":"startPointChanging","mousedown .new-point":"addNewZonePoint"},renderHandles:function(){var e,t,i=$("<div/>").prop("draggable",!1),n=i.clone().addClass("rotate"),o=this.options.cell,a=(o.get("binding")||{}).key;if(e=this.POSITIONS.map(function(e){return i.clone().addClass("resize").attr("data-position",e)}),"HMI_POLY_LINE"===a||"HMI_CURVE"===a||"HMI_STRAIGHT"===a||"SPACE_ZONE"===a){var r=o.getRefPoints(),l=o.getBBox();t=r.map(function(e,t){return i.clone().addClass("change").attr("data-index",t).css({left:"calc("+e.x/l.width*100+"% - 5px)",top:"calc("+e.y/l.height*100+"% - 5px)"})}),e=e.concat(t)}"HMI_TABLE"===a?this.$el.empty().append(e):this.$el.empty().append(e,n)},update:function(){var e=this.options.paper.matrix(),t=this.options.cell.getBBox();t.x*=e.a,t.x+=e.e,t.y*=e.d,t.y+=e.f,t.width*=e.a,t.height*=e.d;var i=S.normalizeAngle(this.options.cell.get("angle")||0),n="rotate("+i+"deg)";this.$el.css({width:t.width-2,height:t.height-2,left:t.x,top:t.y,transform:n,"-webkit-transform":n,"-ms-transform":n});var o=Math.floor(i*(this.DIRECTIONS.length/360));if(o!=this._previousDirectionsShift){var a=this.DIRECTIONS.slice(o).concat(this.DIRECTIONS.slice(0,o));this.$(".resize").removeClass(this.DIRECTIONS.join(" ")).each(function(e,t){$(t).addClass(a[e])}),this._previousDirectionsShift=o}var r=this.options.cell,l=(r.get("binding")||{}).key;if("HMI_POLY_LINE"===l||"HMI_CURVE"===l||"HMI_STRAIGHT"===l||"SPACE_ZONE"===l){var s=r.getRefPoints(),d=r.getBBox(),c=this.$el.find(".change");s.map(function(e,t){c.eq(t).css({left:"calc("+e.x/d.width*100+"% - 5px)",top:"calc("+e.y/d.height*100+"% - 5px)"})})}},renderZoneNewPointHandle:function(e){var t=this.options.cell.getBBox(),i=$("<div/>").addClass("new-point").attr("data-index",e.sp).css({left:"calc("+e.cp.x/t.width*100+"% - 5px)",top:"calc("+e.cp.y/t.height*100+"% - 5px)"});this.$el.append(i)},removeZoneNewPointHandle:function(){this.$el.find(".new-point").remove()},addNewZonePoint:function(e){var t=this.options.cellView.model;if(!t.prop("binding/locked")){var i=this.options.paper.snapToGrid(e.clientX,e.clientY),n=$(e.target).data("index");t.addPoint({offsetX:i.x,offsetY:i.y},n),this.renderHandles()}},startResizing:function(e){var t=this.options.cellView.model;u.close();var i=t.prop("binding");i.locked||"Indoor"==i.type||g.ui.FreeTransform.prototype.startResizing.call(this,e)},startRotating:function(e){var t=this.options.cellView.model;u.close(),t.prop("binding/locked")||g.ui.FreeTransform.prototype.startRotating.call(this,e)},startPointChanging:function(e){if(u.close(),!this.options.cellView.model.prop("binding/locked")){e.stopPropagation(),this.options.graph.startBatch("free-transform",{freeTransform:this.cid});var t=this.options.cellView.model,i=$(e.target).data("index");if("Zone"==t.prop("binding/type")&&e.shiftKey)return t.removeRefPoint(i),void this.renderHandles();this._initial={index:i},this._action="change",this.startOp(e.target)}},remove:function(){this.options.createView&&this.options.createView.getColorPickerOpenedState&&this.options.createView.getColorPickerOpenedState()||g.ui.FreeTransform.prototype.remove.apply(this,arguments)},onRemove:function(){$(document.body).off("mousemove touchmove",this.pointermove),$(document).off("mouseup touchend",this.pointerup),h.unregisterInstanceFromPaper(this,this.options.paper)},pointermove:function(e){var t=(e=w(e)).shiftKey,i=this.options,n=i.paper.snapToGrid({x:e.clientX,y:e.clientY}),o=i.cell;if(this._action){var a=t?1:i.paper.options.gridSize,r=this._initial;switch(this._action){case"resize":var l,s,d=o.getBBox(),c=S.point(n).rotate(d.center(),r.angle).difference(d[r.selector]()),p=r.resizeX?c.x*r.resizeX:d.width,g=r.resizeY?c.y*r.resizeY:d.height;p=S.snapToGrid(p,a),g=S.snapToGrid(g,a),l=void 0!==i.minWidth&&null!==i.minWidth?i.minWidth:a,s=void 0!==i.minHeight&&null!==i.minHeight?i.minHeight:a,p=Math.max(p,l),g=Math.max(g,s),p=Math.min(p,i.maxWidth),g=Math.min(g,i.maxHeight);var h=d.width-p,u=d.height-g,f=-1!=r.relativeDirection.indexOf("-");if(i.preserveAspectRatio||t&&f){var m=d.width*g/d.height,_=d.height*p/d.width;p<m?g=_:p=m}var v=t&&!f;if((d.width!=p||d.height!=g)&&(o.resize(p,g,{freeTransform:this.cid,direction:r.direction,relativeDirection:r.relativeDirection,trueDirection:r.trueDirection,ui:!0,minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight,preserveAspectRatio:i.preserveAspectRatio||t,preventSetGridPoint:t||0!==r.angle}),v)){l=o.prop("binding/minWidth"),s=o.prop("binding/minHeight"),null==l&&(l=D.GRAPHIC_MIN_WIDTH),null==s&&(s=D.GRAPHIC_MIN_HEIGHT);var b=l-h<p?d.x+h/2:d.x,T=s-u<g?d.y+u/2:d.y;o.position(b,T,{preventSetGridPoint:!0})}break;case"rotate":n=i.paper.clientToLocalPoint(e.clientX,e.clientY);var C=r.startAngle-S.point(n).theta(r.centerRotation),E=S.snapToGrid(r.modelAngle+C,t?i.rotateAngleGrid:1);o.rotate(E,!0),o.trigger("transform:rotate",o,E);break;case"change":o.changeRefPoint({offsetX:n.x,offsetY:n.y},r.index);var I=o.getRefPoints(),y=o.getBBox();this.$el.find(".change").each(function(e,t){$(t).css({left:"calc("+I[e].x/y.width*100+"% - 5px)",top:"calc("+I[e].y/y.height*100+"% - 5px)"})})}}else if(o&&"Zone"==o.prop("binding/type")&&(this.removeZoneNewPointHandle(),!o.isPointAroundContainsPoints(n))){var A=o.isPointOnLine(n);A&&this.renderZoneNewPointHandle(A)}},stopOp:function(){if(g.ui.FreeTransform.prototype.stopOp.call(this),"resize"==this._action){var e=(this.options||{}).cell;if(!e)return;var t=e.getRestrictedAreaWithRotate(),i=e.angle()||0,n=e.getBBox(),o=n.bbox(i),a=n.x,r=n.y;a<t.x&&(a=t.x),r<t.y&&(r=t.y),o.x+o.width>t.x+t.width&&(a=2*t.x+t.width-o.width),o.y+o.height>t.y+t.height&&(r=2*t.y+t.height-o.height),n.x==a&&n.y==r||e.position(a,r,{preventSetGridPoint:!0})}}},{removeInstancesForPaper:function(e){this.removeActiveStatusFromPaper(e),g.util.invoke(this.getInstancesForPaper(e),"remove")},removeActiveStatusFromPaper:function(e){var t=this.getActiveInstancesFromPaper(e);t&&(t.$el.removeClass("active"),t.options.cellView.$el.removeClass("active"))},registerInstanceToPaper:function(e,t){var i,n=this.instancesByPaper;n[t.cid]||(n[t.cid]={}),i=n[t.cid],this.removeActiveStatusFromPaper(t),i[e.cid]=e,this.setActiceStatusFromPaperInstance(n,e)},getActiveInstancesFromPaper:function(e){var t;if(!(t=this.instancesByPaper[e.cid]))return null;var i,n=null;for(i in t)if((n=t[i])&&n.$el&&n.$el.hasClass("active"))break;return n},setActiceStatusFromPaperInstance:function(e,t){t||Object.entries(e).forEach(function(e){e[1]&&(t=e[1])}),t&&(t.$el.addClass("active"),t.options.cellView.$el.addClass("active"))},unregisterInstanceFromPaper:function(e,t){var i=this.instancesByPaper[t.cid];i&&(this.removeActiveStatusFromPaper(t),i[e.cid]=null,this.setActiceStatusFromPaperInstance(i))}}),n=g.ui.Selection.extend({events:{"mousedown .selection-box":"onSelectionBoxPointerDown","touchstart .selection-box":"onSelectionBoxPointerDown","mousedown .handle":"onHandlePointerDown","touchstart .handle":"onHandlePointerDown","mouseup .selection-box":"onSelectionMouseEvents","dblclick .selection-box":"onSelectionMouseEvents","click .selection-box":"onSelectionMouseEvents","contextmenu .selection-box":"onSelectionMouseEvents","hover .selection-box":"onSelectionMouseEvents","mousemove .selection-box":"onSelectionMouseEvents","mouseenter .selection-box":"onSelectionMouseEvents","mouseleave .selection-box":"onSelectionMouseEvents"},translateSelectedElements:function(i,n){var o={};this.model.each(function(e){if(!o[e.id]&&!e.prop("binding/locked")){var t={selection:this.cid};e.translate(i,n,t),e.getEmbeddedCells({deep:!0}).forEach(function(e){o[e.id]=!0}),this.options.graph.getConnectedLinks(e).forEach(function(e){o[e.id]||(e.translate(i,n,t),o[e.id]=!0)})}}.bind(this))},stopSelecting:function(e){var t,i=this.options.paper;switch(this._action){case"selecting":var n=this.$el.offset(),o=this.$el.width(),a=this.$el.height();t=i.pageToLocalPoint(n.left,n.top);var r=i.scale();o/=r.sx,a/=r.sy;var l=S.rect(t.x,t.y,o,a),s=this.getElementsInSelectedArea(l),d=this.options.filter;Array.isArray(d)?s=s.filter(function(e){return!d.includes(e.model)&&!d.includes(e.model.get("type"))}):g.util.isFunction(d)&&(s=s.filter(function(e){return!d(e.model)})),s=s.filter(function(e){return!e.model.parent()});var c=this.options.createView,p=s.map(function(e){return new h({cellView:e,clearAll:!1,createView:c}).render(),e.model});this.model.reset(p,{ui:!0});break;case"translating":this.options.graph.stopBatch("selection-translate"),t=i.snapToGrid({x:e.clientX,y:e.clientY}),this.notify("selection-box:pointerup",e,t.x,t.y);break;default:this._action||this.cancelSelection()}this._action=null},cancelSelection:function(){h.clear(this.options.paper),this.options.paper.trigger("selection:cancelSelection"),g.ui.Selection.prototype.cancelSelection.call(this)},onSelectionBoxPointerDown:function(e){e.stopPropagation(),e=w(e),this.options.allowTranslate&&this.startTranslatingSelection(e);var t=this.getCellView(e.target);this.eventData(e,{activeElementView:t});var i=this.options.paper.snapToGrid(e.clientX,e.clientY);this.notify("selection-box:pointerdown",e,i.x,i.y),t&&t.model&&t.model.prop("binding/locked")&&e.shiftKey||this.delegateDocumentEvents(null,e.data);var n=this._activeElementView;if(n){var o=n&&n.findView&&n.findView(this.options.paper);i=this.options.paper.snapToGrid(e.clientX,e.clientY),n.trigger("event:pointerdown",o,e,i)}},onSelectionMouseEvents:function(e){var t,i=e.type;"mouseup"==i?t="event:pointerup":"click"==i?t="event:pointerclick":"dblclick"==i?t="event:pointerdblclick":"contextmenu"==i?t="event:contextmenu":"mousemove"==i?t="event:pointermove":"hover"==i?t="event:mouseover":"mouseenter"==i?t="event:mouseenter":"mouseleave"==i&&(t="event:mouseout");var n=this.getCellView(e.target),o=this.options.paper.snapToGrid(e.clientX,e.clientY);if(t&&n){var a=n.model;a&&(e.target=n.el,a.trigger(t,n,e,o)),"event:pointerdblclick"===t&&this.options.paper.trigger("element:pointerdblclick",n,e,o)}},adjustSelection:function(e){var t,i;e=w(e);var n=this.eventData(e),o=n.action;switch(o){case"selecting":t=e.clientX-n.clientX,i=e.clientY-n.clientY;var a=parseInt(this.$el.css("left"),10),r=parseInt(this.$el.css("top"),10);this.$el.css({left:t<0?n.offsetX+t:a,top:i<0?n.offsetY+i:r,width:Math.abs(t),height:Math.abs(i)});break;case"translating":var l=this.options.paper.snapToGrid(e.clientX,e.clientY),s=Math.max(0,l.x),d=Math.max(0,l.y);if(this._activeElementView&&"hmi.Table"==this._activeElementView.attributes.type)break;t=s-n.snappedClientX,i=d-n.snappedClientY;var c=this.options.paper.getRestrictedArea();if(c){var p=this.model.toArray(),g=this.options.graph.getCellsBBox(p),h=c.x-g.x,u=c.y-g.y,f=c.x+c.width-(g.x+g.width),m=c.y+c.height-(g.y+g.height);t<h&&(t=h),i<u&&(i=u),f<t&&(t=f),m<i&&(i=m)}if(t||i){if(this.translateSelectedElements(t,i),this.boxesUpdated)1<this.model.length&&this.updateSelectionBoxes();else{var _=this.options.paper.scale();this.$el.children(".selection-box").add(this.$selectionWrapper).css({left:"+="+t*_.sx,top:"+="+i*_.sy})}n.snappedClientX=s,n.snappedClientY=d}this.notify("selection-box:pointermove",e,s,d);break;default:o&&this.pointermove(e)}this.boxesUpdated=!1,e.preventDefault()},onRemoveElement:function(e){g.ui.Selection.prototype.onRemoveElement.apply(this,arguments),this._activeElementView=null,this.options.paper.trigger("selection:changed")},onResetElements:function(e){g.ui.Selection.prototype.onResetElements.apply(this,arguments),this.options.paper.trigger("selection:changed")},onAddElement:function(e){g.ui.Selection.prototype.onAddElement.apply(this,arguments),this.options.paper.trigger("selection:changed")}}),o=g.dia.CommandManager.extend({defaults:{cmdBeforeAdd:null,cmdNameRegex:/^(?:add|remove|change:\w+)$/,applyOptionsList:["propertyPath"],revertOptionsList:["propertyPath"],createView:null},initialize:function(e){g.util.bindAll(this,"initBatchCommand","storeBatchCommand"),this.graph=e.graph,this.createView=e.createView,this.reset(),this.listen()},push:function(e){if("hmi.Table"==(e.data&&e.data.type||"")&&-1!=(e.options&&e.options.propertyPath||"").indexOf("highlighted"))return;-1==(e.action||"").indexOf("version")&&(this.redoStack=[],e.batch?(this.lastCmdIndex=Math.max(this.lastCmdIndex,0),this.trigger("batch",e)):(this.undoStack.push(e),this.createView&&this.createView.updateUndoRedoButtonState(this.hasUndo(),this.hasRedo()),this.trigger("add",e)))},storeBatchCommand:function(){if(this.batchCommand&&this.batchLevel<=0){var e=this.filterBatchCommand(this.batchCommand);0<e.length&&(this.redoStack=[],this.undoStack.push(e),this.createView&&this.createView.updateUndoRedoButtonState(this.hasUndo(),this.hasRedo()),this.trigger("add",e)),this.batchCommand=null,this.lastCmdIndex=null,this.batchLevel=null}else this.batchCommand&&0<this.batchLevel&&this.batchLevel--},undo:function(e){var t=this.undoStack.pop();if(t){this.revertCommand(t,e),this.redoStack.push(t),this.createView&&this.createView.updateUndoRedoButtonState(this.hasUndo(),this.hasRedo());var i=this.getModelsFromCommand(t);this.graph._paper.trigger("afterCommand",i)}},redo:function(e){var t=this.redoStack.pop();if(t){this.applyCommand(t,e),this.undoStack.push(t),this.createView&&this.createView.updateUndoRedoButtonState(this.hasUndo(),this.hasRedo());var i=this.getModelsFromCommand(t);this.graph._paper.trigger("afterCommand",i)}},getModelsFromCommand:function(e){var t,i,n,o=[],a=this.graph,r=e.length,l={};for(i=0;i<r;i++)(n=e[i]).data&&n.data.id&&(l[n.data.id]=!0);return $.each(l,function(e){(t=a.getCell(e))&&o.push(t)}),o}}),u=g.ui.TextEditor.extend({render:function(e){var i=this,o=i.options,a=o.min,r=o.max,t=o.isEditableCanvas;this.$caret=$("<div>",{class:"caret"}),this.$selection=$("<div>"),this.$selectionBox=$("<div>",{class:"char-selection-box"}),this.$el.append(this.$caret,this.$selection),this.$textareaContainer=$("<div>",{class:"textarea-container"}),this.$textarea=$("<textarea>",this.options.textareaAttributes),this.textarea=this.$textarea[0],o.model&&"Label"==o.model.prop("binding/type")?this._textContent=this.textarea.value=o.model.prop("binding/beforeWrapText"):this._textContent=this.textarea.value=this.getTextContent(),this._textareaValueBeforeInput=this.textarea.value,this.$textareaContainer.append(this.textarea),this.options.focus&&this.$el.append(this.$textareaContainer),$(e||document.body).append(this.$el);var n=d(this.options.text).bbox();this.$textareaContainer.css({left:n.x,top:n.y}),this.focus(),d(this.options.text).attr("cursor","text"),this.selectAll();if(t){if(o.model){"Label"==o.model.prop("binding").type&&(i.$textarea.off("keydown"),i.$textarea.on("keydown",function(e){var t=this.value,i=c.getStringLength(t),n=e.which?e.which:event.keyCode;if(27==n&&u.close(),i>=D.DEFAULT_TEXT_MAX_LENGTH)return n<=l.keys.DOWN||n==l.keys.DELETE||!(!e.ctrlKey&&0!=n||67!=n&&88!=n)}))}}else i.$textarea.off("keydown"),i.$textarea.on("keydown",function(e){var t=e.which?e.which:event.keyCode;27==t&&u.close();var i=this.value;if(!isNaN(Number(i))){var n=Number(i);a<=n&&n<=r&&(this._beforeValue=i)}if(189==t&&0<i.length)return!1;if(190==t){if(0==i.length)return!1;if(-1!=i.indexOf("."))return!1}return 13==t&&u.close(!0),!!(46==t||o.isAllowNegative&&189==t||o.isAllowDot&&190==t)||!(27<t&&(t<48||57<t&&t<96||105<t))}),i.$textarea.off("keyup"),i.$textarea.on("keyup",function(e){var t=this.value;if(o.isAllowDot&&t.indexOf(".")==t.length-1)return!0;if(o.isAllowNegative&&"-"==t)return!0;isNaN(Number(t))?(this.value=$.trim(this._beforeValue),i.setCaret(this.value.length)):Number(t)<a?(this.value=a,i.setCaret(this.value.length)):Number(t)>r&&(this.value=r,i.setCaret(this.value.length))});return this},setCaret:function(e,t){g.util.isObject(e)&&(t=e,e=void 0),t=t||{};var i,n=this.options.text,o=this.getNumberOfChars(),a=this.selection.start,r=this.textarea.value;void 0!==e&&(e=Math.min(Math.max(e,0),o),a=this.selection.start=this.selection.end=e),t.silent||this.trigger("caret:change",a),this.setTextAreaSelection(a,a),this.options.debug&&console.log("setCaret(",e,t,")","selectionStart",a,"isLineEnding",this.isLineEnding(a),"isEmptyLineUnderSelection",this.isEmptyLineUnderSelection(a),"svgCharNum",this.selectionStartToSvgCharNum(a),"nonEmptyLinesBefore",this.nonEmptyLinesBefore(a));try{var l;i=this.isEmptyLineUnderSelection(a)||!this.isLineEnding(a)&&r.length!==a?(l=this.selectionStartToSvgCharNum(a),n.getStartPositionOfChar(l)):(l=this.selectionStartToSvgCharNum(a)-1,n.getEndPositionOfChar(l))}catch(e){this.trigger("caret:out-of-range",a),i={x:0,y:0}}var s=this.localToScreenCoordinates(i),d=this.getTextTransforms(),c=d.rotation,p=this.getFontSize()*d.scaleY;return this.options.placeholder&&this.$caret.toggleClass("placeholder",0===o),this.$caret.css({left:s.x,top:s.y-p,height:p,"line-height":p+"px","font-size":p+"px","-webkit-transform":"rotate("+c+"deg)","-webkit-transform-origin":"0% 100%","-moz-transform":"rotate("+c+"deg)","-moz-transform-origin":"0% 100%"}).attr({"text-anchor":this.getTextAnchor()}).show(),this.$textareaContainer.css({left:s.x,top:s.y+(o?-p:0)}),this.focus(),this}},{edit:function(e,r){var l=this,t=!1!==(r=r||{}).update;this.options=g.util.assign({},r,{update:t});var s=this.getTextElement(e);if(s){var i;if(this.close(),this.ed=new u(g.util.assign({text:s},r)),this.ed.on("all",this.trigger,this),r.cellView){if(i=r.cellView.paper.el,this.cellViewUnderEdit=r.cellView,this.cellViewUnderEditInteractiveOption=this.cellViewUnderEdit.options.interactive,this.cellViewUnderEdit.options.interactive=!1,r.annotationsProperty&&!this.ed.getAnnotations()){var n=this.cellViewUnderEdit.model.prop(r.annotationsProperty);n&&this.ed.setAnnotations(this.deepCloneAnnotations(n))}}else i=d(s).svg().parentNode;return t&&this.ed.on("text:change",function(e,t,i){if(r.cellView){var n=null;if(r.textProperty){if(r.cellView.model.isLink()&&"labels"===r.textProperty.substr(0,"labels".length)&&(n=d($(d(s).node).closest(".label")[0]).index()),r.textValidation&&$.isFunction(r.textValidation)&&(e=r.textValidation(e),l.ed.textarea.value=e),r.model){var o=r.model.prop("binding");if(o&&"Label"==o.type)c.getStringLength(e)>=D.DEFAULT_TEXT_MAX_LENGTH&&(e=e.substring(0,D.DEFAULT_TEXT_MAX_LENGTH),l.ed.textarea.value=e)}r.cellView.model.prop(r.textProperty,e,{textEditor:this.ed.cid})}if(r.annotationsProperty&&r.cellView.model.prop(r.annotationsProperty,this.deepCloneAnnotations(i),{rewrite:!0,textEditor:this.ed.cid}),null!==n){var a=d(r.cellView.el).find(".label");s=a[n].findOne("text"),this.ed.setTextElement(s.node)}}else d(s).text(e,i)},this),this.ed.render(i),this}this.options.debug&&console.log("ui.TextEditor: cannot find a text element.")},close:function(e){var t=this.ed;g.ui.TextEditor.close.apply(this,arguments);var i=this.options;if(i&&t){var n=i.cellView;if(n&&n.model)n.model.trigger("event:texteditorclose",this,e)}}}),a=g.ui.PaperScroller.extend({events:{"mousewheel .paper-scroller-background":"onMousewheel"},onMousewheel:function(e){this.trigger("scroller:mousewheel",e)},stopPanning:function(e){$(document.body).off(".panning"),$(window).off(".panning"),this.$el.removeClass("is-panning"),this.trigger("pan:stop",{scrollTop:this.el.scrollTop,scrollLeft:this.el.scrollLeft})},onResize:function(){}});return{Graph:e,Paper:i,FreeTransform:h,Selection:n,CommandManager:o,TextEditor:u,PaperScroller:a}}),define("hmi/hmi-canvas",["hmi/hmi-common","hmi/hmi-api","hmi/hmi-util","hmi/config/popup-config","hmi/config/rappid-canvas"],function(a,r,e,t,i){var c=window.kendo,l=window.moment,p=(window.Util,window.I18N),s=(window.Mousetrap,t.confirmDialog),d=t.msgDialog,g=t.refreshConfirmDialog,n=i.RappidCanvas,o=window.Howl,h=e.Loading,u=window.localStorage;return c.Class.extend({options:{canvasClass:n,soundPlayerClass:o,wrapper:null,createView:null,editable:!1,width:a.DEFAULT_CANVAS_WIDTH,height:a.DEFAULT_CANVAS_HEIGHT},init:function(e,t){var i=this;i.options=$.extend(!0,{},i.options,t),i.element=$(e);var n=$(i.element).attr("id");n||(n="hmi-canvas-"+c.guid(),i.element.attr("id",n)),i.isEditable=i.options.editable,i.createView=i.options.createView,i.wrapper=i.options.wrapper,i.noGraphicWrapper=i.wrapper.find(".hmi-no-graphic-wrapper"),i.width=i.options.width,i.height=i.options.height;var o=i.options.canvasClass;(i.options.baseCanvas=i).canvas=new o(i.element,n,i.options);var a=$(".hmi-monitoring-file-control-wrapper .hmi-monitoring-file-list");i.fileList=a.data("kendoHmiFileList");var r,l,s,d=u.getItem("hmiCanvas")||"{}";(d=JSON.parse(d))[n]={},u.setItem("hmiCanvas",JSON.stringify(d)),i.wrapper.append(c.template((r=i.isEditable,l="<li><i class='ic ic-device-on'></i>"+p.prop("HMI_LEGEND_DEVICE_ON")+"</li><li><i class='ic ic-device-off'></i>"+p.prop("HMI_LEGEND_DEVICE_OFF")+"</li><li><i class='ic ic-critical'></i>"+p.prop("FACILITY_DEVICE_STATUS_CRITICAL")+"</li><li class='vertical'><i class='ic ic-warning'></i>"+p.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li><li><i class='ic ic-very-bad'></i>"+p.prop("HMI_LEGEND_VERY_BAD")+"</li><li><i class='ic ic-bad'></i>"+p.prop("HMI_LEGEND_BAD")+"</li><li><i class='ic ic-normal'></i>"+p.prop("HMI_LEGEND_NORMAL")+"</li><li class='vertical'><i class='ic ic-good'></i>"+p.prop("HMI_LEGEND_GOOD")+"</li><li><i class='ic ic-connected-contact'></i>"+p.prop("HMI_LEGEND_CONNECTED_CONTACT")+"</li><li><i class='ic ic-disconnected-contact'></i>"+p.prop("HMI_LEGEND_DISCONNECTED_CONTACT")+"</li>",s="<li><i class='ic ic-warning'></i>"+p.prop("HMI_BINDING_ERROR")+"</li>","<div class='hmi-legend-wrapper'><i class='ic ic-help'></i>"+p.prop("COMMON_LEGEND")+"<div class='hmi-legend'><ul class='hmi-legend-list'>"+(r?s:l)+"</ul></div></div>"))),i.legend=i.wrapper.find(".hmi-legend-wrapper"),i.isEditable||i.hide()},attachBeforeUnloadEvt:function(){var t=this.createView;window.onbeforeunload=function(e){if(!t._isSaved)return!1}},detachBeforeUnloadEvt:function(){window.onbeforeunload=null},load:function(e,t){var i=this;i.stopPolling(),a.SoundPlayer.stop(),i.canvas.clear(),i.canvas.setBackground(null),i.isEditable&&(i.attachBeforeUnloadEvt(),i.canvas.attachKeyboardEvt()),i.canvas.isCreate=!1,i.canvas.load(e,t);var n=i.getGraphicDeviceInfo();i.isEditable?(n=i.getGraphicDeviceInfo(),i.pollingEvt()):0<n.cntBindingObjects?i.startPolling():i.stopPolling()},create:function(){var e=this.canvas;this.stopPolling(),a.SoundPlayer.stop(),e.clear(),e.setBackground(null),e.isCreate=!0,this.isEditable&&(this.attachBeforeUnloadEvt(),e.attachKeyboardEvt())},save:function(e,t){var n,o=this,a=new $.Deferred,r=o.fileList;return s.message(p.prop("COMMON_CONFIRM_DIALOG_EDIT_SAVE")),s.setConfirmActions({yes:function(){h.open(),o.canvas.save().done(function(i){e?n=r.apiPutFile({id:e,name:t},i):console.error("no file id to save."),n.done(function(t){o.canvas.isCreate&&(o.canvas.isCreate=!1,require(["hmi/hmi-create"],function(e){e.setGraphicFileInfo(i,t)})),a.resolve()}).fail(function(e){-1!=e.indexOf("41332")&&(e=p.prop("HMI_DUPLICATED_FILE_NAME",t)),d.message(e),d.open(),a.reject()}).always(function(){h.close()})})},no:function(){}}),s.open(),a.promise()},setBackground:function(e){this.canvas.setBackground(e)},import:function(e){var t=new $.Deferred;return this.canvas.import(e).done(function(){t.resolve()}).fail(function(){t.reject()}),t.promise()},export:function(e){this.canvas.export(e)},clear:function(){this.canvas.clear()},getColor:function(e){return this.canvas.getColor(e.name)},changeColor:function(e,t){this.canvas.changeColor(e.name,t)},createbasicShape:function(e){this.canvas.createbasicShape(e)},textAlign:function(e){this.canvas.textAlign(e)},setLineWidth:function(e){this.canvas.setLineWidth(e)},onResize:function(){var e=this.element.width(),t=this.element.height();this.canvas.setDimension(e,t)},onDrop:function(e){this.canvas.onDrop(e)},onPaletteDoubleClick:function(e){this.canvas.onPaletteDoubleClick(e)},onPaletteClick:function(e){this.canvas.onPaletteClick(e)},hasGraphicElements:function(){var e=this.canvas.lines,t=this.canvas.figures;return 0<e.getSize()||0<t.getSize()},getToolbarButtonDisabledState:function(){return this.canvas.getToolbarButtonDisabledState()},getGraphicDeviceInfo:function(){var e=this.canvas.getGraphicDeviceInfo();return this.graphicDeviceInfo=e},startPolling:function(e){var t=this;t.stopPolling(),e?t.pollingInterval=setInterval(t.pollingEvt.bind(t),5e3):(h.open(),t.pollingEvt().done(function(){t.pollingInterval=setInterval(t.pollingEvt.bind(t),5e3),h.close()}))},stopPolling:function(){clearInterval(this.pollingInterval)},pollingEvt:function(){var e=new $.Deferred,t=this,i=t.graphicDeviceInfo.ids;0<i.length?r.getDevicesForPolling(i).done(function(e){t.canvas.updateCanvasInPolling(e)}).always(function(){e.resolve()}):e.resolve();var n=l().hour(),o=window.localStorage.getItem("hmiRefreshConfirmOpened");return n!=a.REFRESH_CONFIRM_HOURS||null!==o&&"false"!=o?n!=a.REFRESH_CONFIRM_HOURS&&"true"==o&&window.localStorage.setItem("hmiRefreshConfirmOpened",!1):(window.localStorage.setItem("hmiRefreshConfirmOpened",!0),g.message(p.prop("HMI_REFRESH_CONFIRM_MSG")),g.setConfirmActions({yes:function(){},no:function(){clearTimeout(t._refreshConfirmTimeout)}}),g.open(),t._refreshConfirmTimeout=setTimeout(function(){window.location.reload(!0)},a.REFRESH_CONFIRM_TIMEOUT)),e.promise()},changeToBackground:function(e){var t,i,n=this.canvas,o=$(this.element).attr("id");if(n._isBackground=e,t=u.getItem("hmiCanvas")||"{}",t=JSON.parse(t),e)i=n.graph.toJSON(),t[o]=i,u.setItem("hmiCanvas",JSON.stringify(t));else if(i=t[o],n.graph.fromJSON(i),this.isEditable){var a=n.commandManager;this.createView.updateUndoRedoButtonState(a.hasUndo(),a.hasRedo()),n.attachKeyboardEvt()}},hasModels:function(){var e=this.canvas;return!!e.graph&&0!=e.graph.getCells().length},setZoomLevel:function(e){var t=this.canvas;if(!t.graph)return!1;t.setZoomLevel(e)},panningScroll:function(){this.canvas.panningScroll()},canvasCenterAlign:function(e){e=e||"x",this.canvas.canvasCenterAlign(e)},hide:function(){this.noGraphicWrapper.show(),this.canvas.hide(),this.legend.hide()},show:function(){this.noGraphicWrapper.hide(),this.canvas.show(),this.legend.show()},destroy:function(){a.SoundPlayer.stop(),this.stopPolling()}})}),define("hmi/view-model/base-vm",[],function(){function e(e,t){return e=e||{},t=t||{},$.extend(!0,{},e,t)}var i=window.kendo,t=(window.I18N,{type:"button",id:"",name:"",disabled:!1,invisible:!1,text:"",color:"#000",dropDownList:null,click:function(){},setState:function(){}});return{ButtonConfig:t,ToolbarButtonConfig:e(t,{type:"toolbar-button",title:"",cssClass:"",template:"",hasVerticalLine:!1}),DropDownListConfig:{type:"dropdownlist",id:"",name:"",title:"",invisible:!1,disabled:!1,template:null,dataTextField:"name",dataValueField:"id",popupClass:"",optionLabel:"",dataSource:[],value:"",select:function(){},close:function(){},open:function(){},hasVerticalLine:!1},ValidatorConfig:{type:"validator",id:"",name:"",invisible:!1,disabled:!1,value:"",placeholder:"",validatorOptions:{type:"",required:!1}},extendConfig:e,BaseViewModelClass:i.Class.extend({viewModel:{filters:[],actions:[]},options:{type:"monitoring"},_isFullScreen:!1,init:function(e,t){this.element=$(e),this.options=$.extend(!0,{},this.options,t),this.viewModel=i.observable(this.viewModel),this._tabCanvasInfo={},i.bind(e,this.viewModel),this.initTab(),this.element.css("position","relative"),this.attachEvent(),this.attachTabEvent()},initTab:function(){var e,t=this.options;e="monitoring"==t.type?this.element.find("#hmi-tab-area"):this.element.find("#hmi-create-tab-area"),this.tab=e.kendoHmiTabStrip({useScrollButton:!1,type:t.type}).data("kendoHmiTabStrip")},initCanvas:function(){},attachEvent:function(){},attachTabEvent:function(){var e=this,t=e.tab;t.bind("orderChanged",e.afterTabOrderChangeEvt.bind(e)),t.bind("beforeActivate",e.beforeTabChangeEvt.bind(e)),t.bind("activate",e.afterTabChangeEvt.bind(e)),t.bind("add",e.addTabEvt.bind(e)),t.bind("added",e.addedTabEvt.bind(e)),t.bind("delete",e.deleteTabEvt.bind(e)),t.bind("deleted",e.deletedTabEvt.bind(e))},getViewModelWidget:function(e){var t=this.getFilterViewModel(e);if(null===t&&(t=this.getActionViewModel(e)),null===t)return null;var i=t.type,n=t.id,o="";if("dropdownlist"==i)o="kendoDropDownList";else if("dropdowncheckbox"==i)o="kendoDropDownCheckBox";else if("button"==i)o="kendoButton";else if("combobox"==i)o="kendoCombobox";else{if("validator"!=i)return $("#"+n);o="kendoCommonValidator"}return $("#"+n).data(o)},getFilterViewModel:function(e){var t=this.viewModel.filters;return this._getFilterOrAction(e,t)},getActionViewModel:function(e){var t=this.viewModel.actions;return this._getFilterOrAction(e,t)},_getFilterOrAction:function(e,t){var i,n=t.length;for(i=0;i<n;i++)if(t[i].name==e)return t[i];return null},bind:function(e,t,i){var n=this.getFilterViewModel(t);null===n&&(n=this.getActionViewModel(t)),null!==n&&n.bind(e,i)},unbind:function(e,t,i){var n=this.getFilterViewModel(t);null===n&&(n=this.getActionViewModel(t)),null!==n&&n.unbind(e,i)},trigger:function(e,t,i){var n=this.getFilterViewModel(t);null===n&&(n=this.getActionViewModel(t)),null!==n&&n.trigger(e,i)},afterTabOrderChangeEvt:function(){},beforeTabChangeEvt:function(e){this._isChangeTab=!0;var t=this._tabCanvasInfo[e.id]&&this._tabCanvasInfo[e.id].canvas||void 0;t&&(t.changeToBackground(!0),t.clear())},afterTabChangeEvt:function(e){var t=this.tab.getCurrentTabCanvasInfo();this.setCanvasInfoCurrentTab(t);var i,n=this._tabCanvasInfo[t.id];n&&((i=n.canvas).changeToBackground(!1),i.setZoomLevel(t.zoomLevel)),this._isChangeTab=!1},addTabEvt:function(e){},addedTabEvt:function(e){this.initCanvas(),this.setCanvasInfo(e),this.setCanvasInfoCurrentTab(e)},deleteTabEvt:function(e){},deletedTabEvt:function(e){var t=this._tabCanvasInfo[e].canvas;t.destroy&&t.destroy(),this.removeTabCanvasInfo(e)},getCanvasInfo:function(e){return e=e||this.tab.getCurrentTabCanvasInfo().id,this._tabCanvasInfo[e]||{}},setCanvasInfo:function(e){this._tabCanvasInfo[e.id]={canvas:this.canvas}},setCanvasInfoCurrentTab:function(e){var t=this._tabCanvasInfo[e.id]||{};this.canvas=t.canvas,this.loadedGraphicId=e.id,this.loadedGraphicName=e.name,e.zoomLevel||(e.zoomLevel=100),0==this.tab.length()&&this.tab.addTab(),this.tab.setCurrentTabCanvasInfo(e)},removeTabCanvasInfo:function(e){var t=this._tabCanvasInfo[e];t&&(t.canvas.clear(),delete this._tabCanvasInfo[e])},clearTabCanvasInfo:function(){var e=this._tabCanvasInfo;for(var t in e)delete e[t]},setCurrentTabZoomLevel:function(e){this._isChangeTab||this.tab.changeTabZoomLevel(this.tab.getCurrentTabIndex(),e)}})}}),define("hmi/view-model/hmi-vm",["device/common/device-constants","device/common/device-api","hmi/model/hmi-model","hmi/view-model/base-vm","hmi/config/popup-config","hmi/hmi-common","hmi/hmi-util","hmi/hmi-api","hmi/hmi-canvas"],function(p,g,n,t,e,l,s,d,o){function i(e){return t.extendConfig(t.ToolbarButtonConfig,e)}var a=window.kendo,c=window.I18N,r=(window.Util,window.Session),h=new window.CommonLoadingPanel,u=l.toastPopup,f=e.msgDialog,m=e.confirmDialog,_=e.folderDeleteConfirmDialog,v=t.BaseViewModelClass,b=e.monitoringDetailPopup,T=e.bindingDetailPoup,C=r.getUserRole(),E=window.Cookies;return{ViewModelClass:v.extend({viewModel:{filters:[t.extendConfig(t.DropDownListConfig,{id:"hmi-file-select",name:"file",optionLabel:c.prop("HMI_SELECT_FILE"),popupClass:"hmi-file-select"}),t.extendConfig(t.ButtonConfig,{id:"hmi-monitoring-fullscreen",name:"fullscreen",text:c.prop("COMMON_FULL_SCREEN")})],actions:[t.extendConfig(t.ButtonConfig,{id:"hmi-create-btn",name:"create",text:c.prop("COMMON_BTN_CREATE")}),t.extendConfig(t.ButtonConfig,{id:"hmi-edit-btn",name:"edit",text:c.prop("COMMON_BTN_EDIT"),disabled:!0}),t.extendConfig(t.ButtonConfig,{id:"hmi-delete-btn",name:"delete",text:c.prop("COMMON_BTN_DELETE"),disabled:!0}),t.extendConfig(t.ButtonConfig,{id:"hmi-detail-btn",name:"detail",text:c.prop("COMMON_BTN_DETAIL"),disabled:!0}),t.extendConfig(t.ButtonConfig,{id:"hmi-fold-btn",name:"fold",text:"",disabled:!0})],buttons:[i({id:"hmi-tool-fullscreen",name:"fullscreen",cssClass:"ic-map-full-screen",disabled:!1,title:c.prop("COMMON_FULL_SCREEN")}),i({id:"hmi-tool-zoomin",name:"zoomin",cssClass:"ic-map-zoom-in",disabled:!0,title:c.prop("HMI_TOOLBAR_ZOOM_IN")}),i({id:"hmi-tool-zoomout",name:"zoomout",cssClass:"ic-map-zoom-out",disabled:!0,title:c.prop("HMI_TOOLBAR_ZOOM_OUT")}),i({id:"hmi-tool-defaultzoom",name:"defaultzoom",cssClass:"ic-map-default-zoom",disabled:!0,title:c.prop("HMI_DEFAULT_ZOOM")})]},init:function(e){var n=this;this._isInit=!0,v.fn.init.call(n,e),n.initFileListAndControlPanel(e),n.getGraphicFiles().always(function(){n.initCanvas(),n.attachToolbarEvt();var e=n.tab.getCurrentTabCanvasInfo();n.setCanvasInfo(e),n.setCanvasInfoCurrentTab(e);var t=n.fileList.getFiles(),i=E.get(l.DEFAULT_COOKIE_FILE_LIST_KEY);i=s.parseCookieDataToExpandInfo(i,!0),n.fileList.setExpandedData(i),d.getUserSettings().done(function(e){e.panelFolded&&n.trigger("click","fold"),e.activeTab.id?n.setUserSettings(e):0<t.length&&(n._isInit=!1)}).fail(function(e){f.message(e),f.open()})})},initFileListAndControlPanel:function(e){this.panelElement=e=$(".hmi-monitoring-file-control-wrapper"),this.initFileControlTab(e),this.panelElement.show(),this.initFileList(e),this.initControlPanel(e)},initFileControlTab:function(e){var t=$(e).find(".hmi-monitoring-file-control-tab");this.fileControlTab=t.kendoCommonTabStrip({isTopMenu:!1,useScrollButton:!1}).data("kendoCommonTabStrip"),this.fileControlTab.activateTab(t.find(".k-first")),this.fileControlTab.disableTab(1,!0)},initControlPanel:function(e){var t=$(e).find(".hmi-monitoring-control");this.controlTab=t.kendoControlTab({change:this._changeControlPanelEvt.bind(this)}).data("kendoControlTab");var i=this.expandCollapseControlEvt.bind(this);this.controlTab.bind("expand",i),this.controlTab.bind("collapse",i),this.controlPanelTimer=[];var n=E.get(l.DEFAULT_COOKIE_CONTROL_PANEL_KEY);n=s.parseCookieDataToExpandInfo(n),this.controlTab.setExpandedData(n)},_changeControlPanelEvt:function(e){var t=e.item,i=e.index,n=e.subIndex,o=e.mode,a=[],r=p.controlSet[i];void 0!==n&&(r=r[n],i=10*i+n);var l=this.controlPanelTimer;l[i]&&(clearTimeout(l[i]),l[i]=void 0);var s,d={};r.id?(d.id=r.id,o&&(d.id=r[o]),d[r.parameter]=t.value,(s=[]).push(d)):(r.underParameter?(d[r.parameter]={},d[r.parameter][r.underParameter]=t.value):d[r.parameter]=t.value,s=d);var c=this.getSelectedIndoorDevices();l[i]=setTimeout(function(){var e,t,i,n=c.length;if(1===n)t=c[0].id,a.push(g.patchGroupAttr(t,r.apiName,s));else{for((i={dms_devices_ids:[],control:{}}).control[r.apiName]=s,e=0;e<n;e++)i.dms_devices_ids.push(c[e].id);a.push(g.multiControl(i))}$.when.apply($,a).always(function(){})},p.TIME_OUT)},getSelectedIndoorDevices:function(e){return this.canvas.canvas.getSelectedIndoorDevices()},onSelectIndoorDevice:function(e){var t=e.items,i=this.element,n=this.panelFolded;this.controlTab.setDataSource(t),this.fileControlTab.activateTabFromIndex(1),n&&i.removeClass("fold"),t.length<1?(this.fileControlTab.activateTabFromIndex(0),this.fileControlTab.disableTab(1,!0),n&&i.addClass("fold")):this.fileControlTab.disableTab(1,!1)},initFileList:function(e){var t=this,i=$(e).find(".hmi-monitoring-file-list");t.fileList=i.kendoHmiFileList().data("kendoHmiFileList"),t.fileList.bind("change",t.changeTreeList.bind(t)),t.fileList.bind("edit",t.clickEditBtnEvt.bind(t)),t.fileList.bind("delete",t.clickDeleteBtnEvt.bind(t)),t.fileList.bind("detail",t.clickDetailBtnEvt.bind(t)),t.fileList.bind("create",t.createFileTreeListEvt.bind(t)),t.fileList.bind("dragend",t.dragEndTreeListEvt.bind(t));var n=t.expandCollapseFileListEvt.bind(t);t.fileList.bind("expand",n),t.fileList.bind("collapse",n)},getGraphicFiles:function(){var i=this;return h.open(),d.getFiles().done(function(e){if(e.length<1&&"Manager"!=C&&(f.message(c.prop("HMI_NO_GRAPHICS")),f.open()),i.fileList.setDataSource(n.createTreeDataSource(e)),h.close(),i.canvas&&i.loadedGraphicId&&i.loadedGraphicName!=c.prop("HMI_EMPTY_TAB")){var t=i.fileList.treeList.dataSource.get(i.loadedGraphicId);t&&i.fileList.select(t,!0)}}).fail(function(e){f.message(e),f.open()})},setUserSettings:function(e){var i,n=this,o=$.extend(!0,[],e.openedTab),t=[],a=0;if(h.open(),n._isAddTabWithFile=!0,o.forEach(function(e){t.push(d.getFile(e.id)),a++}),0==a)return h.close(),n._isInit=!1,void(n._isAddTabWithFile=!1);$.when.apply(n,t).done(function(){$(n.tab.scrollbar.scrollArea[0]).find(".ic-close").eq(0).trigger("click"),1<a?$.each(arguments,function(e,t){"object"==typeof t&&(Array.isArray(t)&&(t=t[0]),i=o[e],n.tab.addTab(i.name,i.id,i.zoomLevel),n.canvas.load(i.name,t),n.canvas.setZoomLevel(i.zoomLevel))}):1==a&&(i=o[0],n.tab.addTab(i.name,i.id,i.zoomLevel),n.canvas.load(i.name,arguments[0]),n.canvas.setZoomLevel(i.zoomLevel)),n.tab.selectById(e.activeTab.id),n.fileList.selectById(e.activeTab.id),n._isInit=!1,n._isAddTabWithFile=!1}).fail(function(e){n._isInit=!1,n._isAddTabWithFile=!1,n.checkNoFileError(e),f.message(e),f.open()}).always(function(){h.close()})},initCanvas:function(){var e=this.tab.getCurrentTabIndex(),t=this.element.find(".hmi-monitoring-canvas").eq(e),i=t.closest(".hmi-monitoring-canvas-wrapper");this.canvas=new o(t,{editable:!1,createView:this,wrapper:i})},attachEvent:function(){var e=this,t=e.getFilterViewModel("file");t.set("select",e.selectFileDropDownListEvt.bind(e)),t.set("open",e.openFileDropDownListEvt.bind(e)),e.getFilterViewModel("fullscreen").set("click",e.clickFullScreenBtnEvt.bind(e));var i=e.getActionViewModel("create");i.set("click",e.clickCreateBtnEvt.bind(e)),i.set("disabled","Manager"==C),b.bind("onSaved",e.detailDialogSaveEvt.bind(e)),b.bind("onDeleted",e.clickDeleteBtnEvt.bind(e)),b.element.on("click",".ic-info.binding",e.clickDetailBindingEvt.bind(e))},attachToolbarEvt:function(){var e=this,t=e.getToolbarViewModel("fullscreen");t.set("click",e.clickFullScreenBtnEvt.bind(e)),(t=e.getToolbarViewModel("zoomin")).set("click",function(){e.canvas.canvas.zoomIn()}),(t=e.getToolbarViewModel("zoomout")).set("click",function(){e.canvas.canvas.zoomOut()}),(t=e.getToolbarViewModel("defaultzoom")).set("click",function(){e.canvas.canvas.defaultZoom(),e.canvasCenterAlign("all")})},getToolbarViewModel:function(e){var t,i,n,o=this.viewModel.buttons;for(n=o.length,i=0;i<n;i++)if((t=o[i]).name==e)return t},clickFullScreenBtnEvt:function(e){this.setFullScreen(!this._isFullScreen)},setFullScreen:function(e){(this._isFullScreen=e)?this.element.addClass("full-screen"):this.element.removeClass("full-screen"),this.canvas&&this.canvas.canvasCenterAlign("all")},refreshToolbarBtnState:function(){var e=this.getToolbarViewModel("zoomin");e.set("disabled",!this.isAbleZoom("zoomin")),(e=this.getToolbarViewModel("zoomout")).set("disabled",!this.isAbleZoom("zoomout")),(e=this.getToolbarViewModel("defaultzoom")).set("disabled",!this.isAbleZoom("defaultzoom"))},isAbleZoom:function(e){if(!this.isSelectedFile())return!1;var t=this.canvas.canvas.getZoomLevel();return"zoomin"==e?l.DEFAULT_MAX_ZOOM_LEVEL>t:"zoomout"==e?l.DEFAULT_MIN_ZOOM_LEVEL<t:"defaultzoom"==e},isSelectedFile:function(){var e=this.loadedGraphicId;return void 0!==e&&("string"!=typeof e||-1==e.indexOf(l.DEFAULT_EMPTY_TAB_PREFIX))},clickCreateBtnEvt:function(e){l.SoundPlayer.stop(),this.stopPolling(),this.trigger("click","create",e)},clickEditBtnEvt:function(e){var t=e.item;if(t)if(t.isFolder)this.editFolderEvt(e);else{var i=t.id;l.SoundPlayer.stop(),this.stopPolling(),this.trigger("click","edit",{id:i,file:t})}},clickDeleteBtnEvt:function(e){var t,i=e.result,n=e.item,o=!n.isFolder,a=this.deleteFile.bind(this,n,i,!1),r=this.deleteFile.bind(this,n,i,!0);o?((t=m).message(c.prop("HMI_FILE_DELETE_POPUP")),t.setConfirmActions({yes:a})):((t=_).message(c.prop("HMI_CONFIRM_DELETE_FOLDER")),t.setActions(1,{action:r}),t.setActions(2,{action:a})),t.open()},deleteFile:function(e,t,i){var n=this,o=n.fileList;h.open(),o.apiDeleteFile(e,i).done(function(e){n.selectFileDropDownListEvt({dataItem:{id:null,name:null}}),n.resetCurrentTab(),t&&b.close(),f.message(e),f.open()}).fail(function(e){n.checkNoFileError(e),f.message(e),f.open()}).always(function(){h.close()})},clickDetailBtnEvt:function(e){var o=e.item;h.open(),d.getFile(o.id).done(function(e){var t=e.cells?e.cells:[],i=s.getGraphicDeviceInfo(t);o instanceof a.data.ObservableObject&&(o=o.toJSON());var n=$.extend(!0,{},o);n.graphicDeviceInfo=i,b.setDataSource([n]),b.open()}).always(function(){h.close()})},clickDetailBindingEvt:function(e){var t=b.getSelectedData().graphicDeviceInfo.devices;t instanceof a.data.ObservableArray&&(t=t.toJSON()),T.setDataSource(t),T.open()},detailDialogSaveEvt:function(e){var t=this,i=e.result,n=e.sender,o=i.id,a=i.name;h.open();var r=t.fileList.treeList.dataSource;a=a&&$.trim(a),d.patchFile({id:o,name:a}).done(function(){n.success();var e=r.get(o);e&&e.set("name",a),u.show(c.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED"))}).fail(function(e){t.checkNoFileError(e),f.message(e),f.open()}).always(function(){h.close()})},changeTreeList:function(e){var t=e.item;if(!t.isFolder){if(e.isDoubleClick){if(this.tab.getTabLiById(t.id))return void this.selectFileDropDownListEvt({dataItem:t});if(this._isAddTabWithFile=!0,!this.tab.addTab())return u.show(c.prop("HMI_TAB_MAX_REACHED")),void(this._isAddTabWithFile=!1);this._isAddTabWithFile=!1}this.selectFileDropDownListEvt({dataItem:t})}},createFileTreeListEvt:function(e){var i=this,t=e.item;h.open(),i.fileList.apiPostFile(t).done(function(e){if(!e.isFolder){var t={id:e.id,name:e.name,file:e,isNew:!0};i.clickCreateBtnEvt(t)}}).fail(function(e){i.checkNoFileError(e),f.message(e),f.open()}).always(function(){h.close()})},editFolderEvt:function(t){var e=t.item;return h.open(),d.patchFile(e).done(function(e){t.success()}).fail(function(e){t.fail(),f.message(e),f.open()}).always(function(){h.close()})},dragEndTreeListEvt:function(e){var t=this,i=t.fileList;h.open(),i.apiPatchReOredredFiles().done(function(){}).fail(function(e){t.checkNoFileError(e),f.message(e),f.open()}).always(function(){h.close()})},afterTabOrderChangeEvt:function(){this.putUserSettings()},beforeTabChangeEvt:function(e){v.fn.beforeTabChangeEvt.call(this,e)},afterTabChangeEvt:function(e){v.fn.afterTabChangeEvt.call(this,e);var t=this.tab.getCurrentTabCanvasInfo();if(!this._isAddTabWithFile){var i=t.id;"string"==typeof i&&-1!=i.indexOf("empty")?(this.fileList.treeList.clearSelection(),this.fileList.editButton.prop("disabled",!0),this.fileList.deleteButton.prop("disabled",!0)):this.fileList.selectById(i)}this.refreshToolbarBtnState(),this.canvas&&this.canvas.panningScroll(),this.putUserSettings()},addedTabEvt:function(e){v.fn.addedTabEvt.call(this,e),this._isAddTabWithFile?(this.canvas.show(),this.refreshToolbarBtnState()):(this.fileList.treeList.clearSelection(),this.fileList.editButton.prop("disabled",!0),this.fileList.deleteButton.prop("disabled",!0))},deletedTabEvt:function(e,t){v.fn.deletedTabEvt.call(this,e,t),t||this.putUserSettings()},resetCurrentTab:function(){var e=this,t=e.tab,i=t.getCurrentTabCanvasInfo();e.removeTabCanvasInfo(i.id);var n={id:t.getEmptyId(),name:c.prop("HMI_EMPTY_TAB")};e.canvas.clear(),e.canvas.hide(),e.setCanvasInfo(n),e.setCanvasInfoCurrentTab(n),e.refreshToolbarBtnState(),e.fileList.treeList.clearSelection(),e.fileList.editButton.prop("disabled",!0),e.fileList.deleteButton.prop("disabled",!0)},selectFileDropDownListEvt:function(e){var t=this,i=e.dataItem.id,n=e.dataItem.name,o=e.dataItem.zoomLevel||100,a=""===i||null==i,r=t.getActionViewModel("edit");"Manager"==C?r.set("disabled",!0):r.set("disabled",a);var l=t.getActionViewModel("delete");if("Manager"==C?l.set("disabled",!0):l.set("disabled",a),t.getActionViewModel("detail").set("disabled",a),null!==i||null!==n){var s=t.tab.getTabLiById(i);if(s)t.tab.selectById($(s).data("id"));else{t._isChangeTab=!0;var d=t.loadedGraphicId;t.removeTabCanvasInfo(d);var c={id:i,name:n,zoomLevel:o};t.tab.setCurrentTabCanvasInfo(c),t.setCanvasInfo(c),t.canvas.show(),t.canvas.clear(),t.loadedGraphicId=i,t.loadedGraphicName=n,a||t.getFile(i,n),t.refreshToolbarBtnState(),t.putUserSettings(),t._isChangeTab=!1}}},putUserSettings:function(){if(!this._isInit){var e=this.tab.getCurrentOpenedTabInfo();d.putUserSettings({panelFolded:this.panelFolded,tabInfo:e})}},onHyperLinkClickEvt:function(e){this.fileList.selectById(e.id),this.selectFileDropDownListEvt({dataItem:e})},openFileDropDownListEvt:function(e){var t=e.sender,i=this.canvas.element.closest(".hmi-content-view").height();t.setOptions({height:i}),t.popup.element.css("max-height",i),t.list.css("max-height",i);var n=t.list.find(".k-list-scroller");n.css("max-height",i-36-10),n.css("height","auto"),t.ul.css("height","auto")},getFile:function(e,t){var i=this;h.open(),d.getFile(e).done(function(e){i.canvas.clear(),i.canvas.load(t,e)}).fail(function(e){i.checkNoFileError(e),f.message(e),f.open()}).always(function(){h.close()})},startPolling:function(){var e,t,i=this._tabCanvasInfo;for(var n in i)(e=i[n].canvas)&&(e.stopPolling(),t=e.getGraphicDeviceInfo(),e.isEditable||(0<t.cntBindingObjects?e.startPolling():e.stopPolling()))},stopPolling:function(){var e,t=this._tabCanvasInfo;for(var i in t)(e=t[i].canvas)&&e.stopPolling()},canvasCenterAlign:function(e){e=e||"x";var t=this.canvas;t&&t.canvasCenterAlign(e)},panelFoldEvt:function(e){this.panelFolded=e,this.putUserSettings()},checkNoFileError:function(e){-1!=e.indexOf(c.prop("HMI_NOT_EXIST_FILE_ERROR"))&&(this.resetCurrentTab(),this.putUserSettings())},hide:function(){this.canvas&&this.canvas.clear(),this.element.hide(),this.tab.hide(),this.panelElement.hide()},show:function(n,o,a){var r=this;r.getGraphicFiles().always(function(){if(r.element.show(),r.tab.show(),r.panelElement.show(),r.isSelectedFile()){var e,t=r.fileList;!t.treeList.dataSource.get(n)&&a&&(e=t.getRecentSelectedFile(),n=e.id,o=e.name),r.loadedGraphicId==n?r.getFile(n,o):"string"==typeof n&&-1!=n.indexOf(l.DEFAULT_EMPTY_TAB_PREFIX)?r.getFile(r.loadedGraphicId,r.loadedGraphicName):(r.fileList.selectById(n),r.selectFileDropDownListEvt({dataItem:{id:n,name:o}}))}var i=E.get(l.DEFAULT_COOKIE_FILE_LIST_KEY);i=s.parseCookieDataToExpandInfo(i,!0),r.fileList.setExpandedData(i),r.startPolling()})},clear:function(){this.canvas.clear()},expandCollapseControlEvt:function(e){var t=e.expandedData;t=s.convertExpandInfoToCookieData(t);var i=l.DEFAULT_COOKIE_CONTROL_PANEL_KEY;E.set(i,t)},expandCollapseFileListEvt:function(e){var t=e.expandedData;t=s.convertExpandInfoToCookieData(t);var i=l.DEFAULT_COOKIE_FILE_LIST_KEY;E.set(i,t)},setCurrentTabZoomLevel:function(e){v.fn.setCurrentTabZoomLevel.call(this,e),this._isChangeTab||this.putUserSettings()}})}}),define("hmi/view-model/hmi-create-vm",["hmi/hmi-common","hmi/hmi-util","hmi/model/hmi-model","hmi/hmi-api","hmi/config/popup-config","hmi/config/palette-config","hmi/view-model/base-vm","hmi/hmi-canvas"],function(s,r,i,n,e,o,t,a){function l(e){return t.extendConfig(t.ToolbarButtonConfig,e)}var d=window.I18N,c=window.Util,p=e.msgDialog,g=e.confirmDialog,h=s.toastPopup,u=t.BaseViewModelClass,f=o.getIconUrl,m=new window.CommonLoadingPanel,_=[{id:"left",name:d.prop("HMI_TOOLBAR_TEXT_ALIGN_HORIZONTAL_LEFT"),className:"ic-text-align-left",selected:!1},{id:"center",name:d.prop("HMI_TOOLBAR_TEXT_ALIGN_HORIZONTAL_CENTER"),className:"ic-text-align-center",selected:!1},{id:"right",name:d.prop("HMI_TOOLBAR_TEXT_ALIGN_HORIZONTAL_RIGHT"),className:"ic-text-align-right",selected:!1}],v=[{id:"top",name:d.prop("HMI_TOOLBAR_TEXT_ALIGN_VERTICAL_TOP"),className:"ic-text-align-top",selected:!1},{id:"middle",name:d.prop("HMI_TOOLBAR_TEXT_ALIGN_VERTICAL_MIDDLE"),className:"ic-text-align-middle",selected:!1},{id:"bottom",name:d.prop("HMI_TOOLBAR_TEXT_ALIGN_VERTICAL_BOTTOM"),className:"ic-text-align-bottom",selected:!1}],b=s.lineWidthDataSource,T=[{id:"left",name:d.prop("HMI_TOOLBAR_TABLE_INSERTION_COLUMN_LEFT"),className:"ic-table-insert-left"},{id:"right",name:d.prop("HMI_TOOLBAR_TABLE_INSERTION_COLUMN_RIGHT"),className:"ic-table-insert-right"},{id:"above",name:d.prop("HMI_TOOLBAR_TABLE_INSERTION_ROW_ABOVE"),className:"ic-table-insert-above"},{id:"below",name:d.prop("HMI_TOOLBAR_TABLE_INSERTION_ROW_BELOW"),className:"ic-table-insert-below"}],C=[{id:"column",name:d.prop("HMI_TOOLBAR_TABLE_DELETE_COLUMN"),className:"ic-table-delete-col"},{id:"row",name:d.prop("HMI_TOOLBAR_TABLE_DELETE_ROW"),className:"ic-table-delete-row"},{id:"table",name:d.prop("HMI_TOOLBAR_TABLE_DELETE_TABLE"),className:"ic-table-delete-table"}];return{ViewModelClass:u.extend({viewModel:{buttons:{0:[l({id:"hmi-tool-undo",name:"undo",cssClass:"ic-undo group",disabled:!0,title:d.prop("HMI_TOOLBAR_UNDO")}),l({id:"hmi-tool-redo",name:"redo",cssClass:"ic-redo",disabled:!0,title:d.prop("HMI_TOOLBAR_REDO")}),l({id:"hmi-tool-binding",name:"binding",cssClass:"ic-clip",disabled:!0,title:d.prop("HMI_TOOLBAR_BINDING")}),l({id:"hmi-tool-lock",name:"lock",cssClass:"ic-lock",disabled:!0,title:d.prop("HMI_TOOLBAR_LOCK")}),l({id:"hmi-tool-template",name:"background",cssClass:"ic-template",disabled:!1,title:d.prop("HMI_TOOLBAR_BACKGROUND"),hasVerticalLine:!0}),l({id:"hmi-tool-fill",name:"fill",cssClass:"ic-fill",disabled:!0,title:d.prop("HMI_TOOLBAR_FILL")}),l({id:"hmi-tool-linecolor",name:"lineColor",cssClass:"ic-linecolor",disabled:!0,title:d.prop("HMI_TOOLBAR_LINE_COLOR")}),l({id:"hmi-tool-linewidth",name:"lineWidth",cssClass:"ic-linewidth",hasVerticalLine:!0,disabled:!0,title:d.prop("HMI_TOOLBAR_LINE_WIDTH"),dropDownList:t.extendConfig(t.DropDownListConfig,{id:"hmi-tool-line-width-drop",name:"line-width-dropdown",value:null,dataSource:b,invisible:!0,template:"hmi-line-width-dropdownlist-template"})}),l({id:"hmi-tool-select",name:"select",cssClass:"ic-select",title:d.prop("HMI_TOOLBAR_SELECT"),hasVerticalLine:!0}),l({id:"hmi-tool-group",name:"group",cssClass:"ic-group group",disabled:!0,title:d.prop("HMI_TOOLBAR_GROUP")}),l({id:"hmi-tool-ungroup",name:"ungroup",cssClass:"ic-ungroup group",disabled:!0,title:d.prop("HMI_TOOLBAR_UNGROUP")}),l({id:"hmi-tool-zone",name:"zone",cssClass:"ic-group-bundle",title:d.prop("SPACE_ZONE"),value:"SPACE_ZONE",hasVerticalLine:!0}),l({id:"hmi-tool-text",name:"text",cssClass:"ic-basic-text group",title:d.prop("HMI_TEXT"),value:"HMI_TEXT"}),l({id:"hmi-tool-rect",name:"rect",cssClass:"ic-basic-rect group",title:d.prop("HMI_RECTANGLE"),value:"HMI_RECTANGLE"}),l({id:"hmi-tool-rounded",name:"rounded",cssClass:"ic-basic-rounded group",title:d.prop("HMI_ROUNDED_RECTANGLE"),value:"HMI_ROUNDED_RECTANGLE"}),l({id:"hmi-tool-parall",name:"parall",cssClass:"ic-basic-parall group",title:d.prop("HMI_PARALLELOGRAM"),value:"HMI_PARALLELOGRAM"}),l({id:"hmi-tool-trapez",name:"trapez",cssClass:"ic-basic-trapez group",title:d.prop("HMI_TRAPEZOID"),value:"HMI_TRAPEZOID"}),l({id:"hmi-tool-tri",name:"tri",cssClass:"ic-basic-tri group",title:d.prop("HMI_TRIANGLE"),value:"HMI_TRIANGLE"}),l({id:"hmi-tool-circle",name:"circle",cssClass:"ic-basic-circle group",title:d.prop("HMI_ELLIPSE"),value:"HMI_ELLIPSE"}),l({id:"hmi-tool-straight",name:"straight",cssClass:"ic-basic-straight group",title:d.prop("HMI_STRAIGHT"),value:"HMI_STRAIGHT"}),l({id:"hmi-tool-line",name:"line",cssClass:"ic-basic-line group",title:d.prop("HMI_POLY_LINE"),value:"HMI_POLY_LINE"}),l({id:"hmi-tool-curve",name:"curve",cssClass:"ic-basic-curve",title:d.prop("HMI_CURVE"),value:"HMI_CURVE",hasVerticalLine:!0}),l({id:"hmi-tool-table",name:"table",cssClass:"ic-basic-table group",title:d.prop("HMI_TABLE"),value:"HMI_TABLE"}),l({id:"hmi-tool-picture",name:"picture",cssClass:"ic-basic-picture group",title:d.prop("HMI_IMAGE"),value:"HMI_IMAGE"}),l({id:"hmi-tool-link",name:"link",cssClass:"ic-basic-link",title:d.prop("HMI_LINK"),value:"HMI_LINK",hasVerticalLine:!0}),l({id:"hmi-tool-zoomin",name:"zoomin",cssClass:"ic-zoomin group",title:d.prop("HMI_TOOLBAR_ZOOM_IN")}),l({id:"hmi-tool-zoomout",name:"zoomout",cssClass:"ic-zoomout group",title:d.prop("HMI_TOOLBAR_ZOOM_OUT")}),l(t.extendConfig(t.DropDownListConfig,{id:"hmi-tool-zoomlevel",name:"zoomlevel",cssClass:"toolbar-zoomlevel",value:s.DEFAULT_ZOOM_LEVEL,dataSource:[{id:200,name:"200%"},{id:175,name:"175%"},{id:150,name:"150%"},{id:125,name:"125%"},{id:100,name:"100%"},{id:75,name:"75%"},{id:50,name:"50%"},{id:25,name:"25%"}],title:d.prop("HMI_TOOLBAR_ZOOM_LEVEL"),dataValueField:"id"})),l({id:"hmi-tool-create-fullscreen",name:"fullscreen",cssClass:"ic-map-full-screen",title:d.prop("COMMON_FULL_SCREEN")})],1:[t.extendConfig(t.DropDownListConfig,{id:"hmi-tool-fontsize",name:"fontSize",cssClass:"toolbar-fontsize",dataTextField:"",dataValueField:"",dataSource:s.fontSizeDataSource,value:s.DEFAULT_FONT_SIZE,disabled:!0,title:d.prop("HMI_TOOLBAR_FONT_SIZE")}),l({id:"hmi-tool-bold",name:"bold",cssClass:"ic-bold",disabled:!0,title:d.prop("HMI_TOOLBAR_FONT_BOLD")}),l({id:"hmi-tool-italic",name:"italic",cssClass:"ic-italic",disabled:!0,title:d.prop("HMI_TOOLBAR_FONT_ITALIC")}),l({id:"hmi-tool-fontcolor",name:"fontColor",cssClass:"ic-textcolor",disabled:!0,hasVerticalLine:!0,title:d.prop("HMI_TOOLBAR_FONT_COLOR")}),l({id:"hmi-tool-text-Halign",name:"textHAlign",cssClass:"ic-text-align-left group",disabled:!0,title:d.prop("HMI_TOOLBAR_TEXT_ALIGN_HORIZONTAL"),dropDownList:t.extendConfig(t.DropDownListConfig,{id:"hmi-tool-text-halign-drop",name:"text-halign-dropdown",value:null,dataSource:_,invisible:!0,template:"hmi-text-align-dropdownlist-template"})}),l({id:"hmi-tool-text-Valign",name:"textVAlign",cssClass:"ic-text-align-top",disabled:!0,title:d.prop("HMI_TOOLBAR_TEXT_ALIGN_VERTICAL"),hasVerticalLine:!0,dropDownList:t.extendConfig(t.DropDownListConfig,{id:"hmi-tool-text-valign-drop",name:"text-valign-dropdown",value:null,dataSource:v,invisible:!0,template:"hmi-text-align-dropdownlist-template"})}),l({id:"hmi-tool-bring-foward",name:"bringTop",cssClass:"ic-above-all group",disabled:!0,title:d.prop("HMI_TOOLBAR_BRING_TOP")}),l({id:"hmi-tool-send-backward",name:"sendBottom",cssClass:"ic-below-all group",disabled:!0,title:d.prop("HMI_TOOLBAR_SEND_BOTTOM")}),l({id:"hmi-tool-bring-top",name:"bringForward",cssClass:"ic-above group",disabled:!0,title:d.prop("HMI_TOOLBAR_BRING_FORWARD")}),l({id:"hmi-tool-send-bottom",name:"sendBackward",cssClass:"ic-below",disabled:!0,title:d.prop("HMI_TOOLBAR_SEND_BACKWARD"),hasVerticalLine:!0}),l({id:"hmi-tool-match-size",name:"matchSize",cssClass:"ic-justify-both group",disabled:!0,title:d.prop("HMI_TOOLBAR_MATCH_SIZE")}),l({id:"hmi-tool-match-width",name:"matchWidth",cssClass:"ic-justify-horz group",disabled:!0,title:d.prop("HMI_TOOLBAR_MATCH_WIDTH")}),l({id:"hmi-tool-match-height",name:"matchHeight",cssClass:"ic-justify-vert",disabled:!0,title:d.prop("HMI_TOOLBAR_MATCH_HEIGHT"),hasVerticalLine:!0}),l({id:"hmi-tool-align-left",name:"alignLeft",cssClass:"ic-align-left group",disabled:!0,title:d.prop("HMI_TOOLBAR_ALIGH_LEFT")}),l({id:"hmi-tool-align-hcenter",name:"alignHcenter",cssClass:"ic-align-center group",disabled:!0,title:d.prop("HMI_TOOLBAR_ALIGH_HCENTER")}),l({id:"hmi-tool-align-right",name:"alignRight",cssClass:"ic-align-right group",disabled:!0,title:d.prop("HMI_TOOLBAR_ALIGH_RIGHT")}),l({id:"hmi-tool-align-top",name:"alignTop",cssClass:"ic-align-top group",disabled:!0,title:d.prop("HMI_TOOLBAR_ALIGH_TOP")}),l({id:"hmi-tool-align-vcenter",name:"alignVcenter",cssClass:"ic-align-middle group",disabled:!0,title:d.prop("HMI_TOOLBAR_ALIGH_VCENTER")}),l({id:"hmi-tool-align-bottom",name:"alignBottom",cssClass:"ic-align-bottom",disabled:!0,title:d.prop("HMI_TOOLBAR_ALIGH_BOTTOM"),hasVerticalLine:!0}),l({id:"hmi-tool-align-hgap",name:"alignHGap",cssClass:"ic-equal-gap-h group",disabled:!0,title:d.prop("HMI_TOOLBAR_ALIGN_HGAP")}),l({id:"hmi-tool-align-vgap",name:"alignVGap",cssClass:"ic-equal-gap-v",disabled:!0,title:d.prop("HMI_TOOLBAR_ALIGN_VGAP"),hasVerticalLine:!0}),l({id:"hmi-tool-filp-v",name:"flipV",cssClass:"ic-align-flip-v group",disabled:!0,title:d.prop("HMI_TOOLBAR_FLIP_H")}),l({id:"hmi-tool-filp-h",name:"flipH",cssClass:"ic-align-flip-h group",disabled:!0,title:d.prop("HMI_TOOLBAR_FLIP_V")}),l({id:"hmi-tool-rotation-right",name:"rotationRight",cssClass:"ic-rotate-right group",disabled:!0,title:d.prop("HMI_TOOLBAR_ROTATION_RIGHT")}),l({id:"hmi-tool-rotation-left",name:"rotationLeft",cssClass:"ic-rotate-left",disabled:!0,title:d.prop("HMI_TOOLBAR_ROTATION_LEFT"),hasVerticalLine:!0}),l({id:"hmi-tool-rotation",name:"rotation",cssClass:"ic-rotate",disabled:!0,title:d.prop("HMI_TOOLBAR_ROTATION"),hasVerticalLine:!0,popupInvisible:!0,change:function(){},onClose:function(){},template:"<div class='hmi-tool-popup hmi-tool-rotation' data-bind='invisible:popupInvisible'><div class='hmi-tool-title'>"+d.prop("HMI_TOOLBAR_ROTATION")+"</div><div class='hmi-tool-body'><input class='hmi-tool-rotation-numeric' data-role='numerictextbox' data-bind='events:{change : change, spin : change}' type='number' min='0' max='360' data-format='#\xb0' class='hmi-tool-rotation' placeholder='"+d.prop("HMI_TOOLBAR_INPUT_ANGLE")+"'/></div></div>"}),l({id:"hmi-tool-table-insertion",name:"tableInsertion",cssClass:"ic-table-insert group",disabled:!0,title:d.prop("HMI_TOOLBAR_TABLE_INSERTION"),dropDownList:t.extendConfig(t.DropDownListConfig,{id:"hmi-tool-table-insertion-drop",name:"table-insertion-dropdown",value:null,dataSource:T,invisible:!0,template:"hmi-table-dropdownlist-template"})}),l({id:"hmi-tool-table-delete",name:"tableDelete",cssClass:"ic-table-delete",disabled:!0,title:d.prop("HMI_TOOLBAR_TABLE_DELETE"),dropDownList:t.extendConfig(t.DropDownListConfig,{id:"hmi-tool-table-delete-drop",name:"table-delete-dropdown",value:null,dataSource:C,invisible:!0,template:"hmi-table-dropdownlist-template"})}),l({id:"hmi-tool-table-merge-cell",name:"mergeCell",cssClass:"ic-table-merge group",disabled:!0,title:d.prop("HMI_TOOLBAR_TABLE_MERGE_CELL")}),l({id:"hmi-tool-table-unmerge-cell",name:"unmergeCell",cssClass:"ic-table-unmerge",disabled:!0,title:d.prop("HMI_TOOLBAR_TABLE_UNMERGE_CELL")})]},filters:[t.extendConfig({type:"template",template:"<label class='hmi-create-label'>"+d.prop("HMI_FILE_NAME")+"</label>"}),t.extendConfig(t.ValidatorConfig,{id:"hmi-create-name",name:"name",placeholder:d.prop("HMI_FILE_NAME"),validatorOptions:{type:"hmiGraphicName",required:!0}})],actions:[t.extendConfig(t.ButtonConfig,{id:"hmi-create-export-btn",name:"export",text:d.prop("COMMON_BTN_EXPORT")}),t.extendConfig(t.ButtonConfig,{id:"hmi-create-import-btn",name:"import",text:d.prop("COMMON_BTN_IMPORT")}),t.extendConfig(t.ButtonConfig,{id:"hmi-create-save-btn",name:"save",text:d.prop("COMMON_BTN_SAVE"),disabled:!0}),t.extendConfig(t.ButtonConfig,{id:"hmi-create-exit-btn",name:"exit",text:d.prop("COMMON_BTN_EXIT"),invisible:!0}),t.extendConfig(t.ButtonConfig,{id:"hmi-create-exit-btn",name:"cancel",text:d.prop("COMMON_BTN_EXIT")})],backgroundImages:{invisible:!0,images:[{name:"remove",src:c.addBuildDateQuery(f("backgroundthumb/blank.jpg"))},{name:"1",src:c.addBuildDateQuery(f("backgroundthumb/1.png"))},{name:"2",src:c.addBuildDateQuery(f("backgroundthumb/2.png"))},{name:"3",src:c.addBuildDateQuery(f("backgroundthumb/3.png"))},{name:"4",src:c.addBuildDateQuery(f("backgroundthumb/4.png"))},{name:"5",src:c.addBuildDateQuery(f("backgroundthumb/5.png"))}],size:"",clickSelectBackground:function(){}}},init:function(e){var t=this;u.fn.init.call(t,e,{type:"create"}),t.initCanvas(),t.initPalette().always(function(){n.getComponents({includeComponent:!0}).done(function(e){e=i.createLibraryDataSource(e),t.libraryPanelBar=t.libraryPanelBar.kendoHmiLibraryPalette({canvas:t.canvas,dataSource:e}).data("kendoHmiLibraryPalette"),t.initColorPicker(),t.attachPaletteEvt(),t.attachToolbarEvt(),t.attachBackgroundSelectorEvt()})})},initCanvas:function(){var e=this.tab.getCurrentTabIndex(),t=this.element.find(".hmi-create-canvas").eq(e),i=t.parent();this.canvas=new a(t,{editable:!0,createView:this,wrapper:i})},initPalette:function(){var t=this;return t.panelElement=$(".hmi-create-panel-wrapper"),t.panelTab=t.panelElement.find(".hmi-create-panel-tab").kendoCommonTabStrip({isTopMenu:!1,useScrollButton:!1}).data("kendoCommonTabStrip"),t.elementPanelBar=t.panelElement.find(".hmi-create-palette"),t.libraryPanelBar=t.panelElement.find(".hmi-create-library"),t.bindingPanelBar=t.panelElement.find(".hmi-create-binding"),t.monitoringPanelElement=$(".hmi-monitoring-file-control-wrapper"),t.fileList=t.monitoringPanelElement.find(".hmi-monitoring-file-list").data("kendoHmiFileList"),o.getPaletteDataSource().done(function(e){t.elementPanelBar=t.elementPanelBar.kendoHmiPalette({canvas:t.canvas,dataSource:e}).data("kendoHmiPalette"),t.bindingPanelBar=t.bindingPanelBar.kendoHmiBinding().data("kendoHmiBinding")})},initColorPicker:function(){this.colorPicker=$("<div id='hmi-create-colorpicker'/>").kendoCommonColorPicker({hasTransparent:!0,opacity:!0}).data("kendoCommonColorPicker")},attachPaletteEvt:function(){var e=this,t=e.drop.bind(e),i=e.onPaletteDoubleClick.bind(e),n=e.onPaletteClick.bind(e);e.elementPanelBar.bind("drop",t),e.elementPanelBar.bind("dblclick",i),e.elementPanelBar.bind("click",n),e.libraryPanelBar.bind("drop",t),e.libraryPanelBar.bind("dblclick",i),e.libraryPanelBar.bind("save",e.librarySaveEvt.bind(e)),e.libraryPanelBar.bind("delete",e.libraryDeleteEvt.bind(e)),e.libraryPanelBar.bind("sort",e.librarySortEvt.bind(e)),e.panelTab.bind("select",e._selectPanelTabEvt.bind(e))},_selectPanelTabEvt:function(e){var t=e.item;if(t){var i=$(t).index(),n=this.canvas.canvas;n&&2==i&&n.binding()}},enableBindingTab:function(e){if(this.panelTab.disableTab(2,!e),2==this.panelTab.getActivatedTabIndex()&&e){var t=this.canvas.canvas;t&&t.binding()}},activateBindingTab:function(){this.panelTab.activateTabFromIndex(2)},attachBackgroundSelectorEvt:function(){this.element.find(".hmi-create-background-selector").on("click",".hmi-create-background-images .hmi-create-background-selector-item",this.clickBuiltInBgImgEvt.bind(this)),this.viewModel.backgroundImages.set("clickSelectBackground",this.clickBackgroundBtnEvt.bind(this))},clickBuiltInBgImgEvt:function(e){var t=this,i=$(e.target),n=t.viewModel.backgroundImages,o=i.closest(".hmi-create-background-selector-item").find("img");if("remove"==o.data("name"))return t.canvas.setBackground(null),n.set("size",""),void n.set("invisible",!0);var a=o.attr("src");r.getImageInfoFromUrl(a).always(function(e){t.setBackground(e)})},clickBackgroundBtnEvt:function(e){var t=this;t.viewModel.backgroundImages.set("invisible",!1),r.getImageInfoFromFile("background-select",10485760).done(function(e){t.setBackground(e)}).fail(function(e){p.message(e),p.open()})},setBackground:function(e){var t=this.viewModel.backgroundImages,i=e.width,n=e.height,o=e.dataUrl;i<this.canvas.width&&(i=this.canvas.width),n<this.canvas.height&&(n=this.canvas.height);var a=d.prop("HMI_SIZE")+" : "+i+" x "+n;t.set("size",a),this.canvas.setBackground(o),t.set("invisible",!0)},drop:function(e){this.canvas.onDrop(e)},onPaletteClick:function(e){this.canvas.onPaletteClick(e)},onPaletteDoubleClick:function(e){this.canvas.onPaletteDoubleClick(e)},librarySortEvt:function(e){var t=e.item,i=e.reOrderedItems;m.open(),n.patchComponents([t].concat(i)).done(function(){e.success()}).fail(function(){e.fail()}).always(function(){m.close()})},librarySaveEvt:function(e){var t=e.item,i=this.libraryPanelBar;m.open(i.popup.element),(t._isNew?i.apiPostComponent(t):i.apiPutComponent(t)).done(function(e){i.closePopup(),h.show(d.prop("HMI_LIBRARY_SAVED"))}).fail(function(e){p.message(e),p.open()}).always(function(){m.close()})},libraryDeleteEvt:function(t){var e=t.item;g.message(d.prop("HMI_LIBRARY_DELETE_POPUP")),g.setConfirmActions({yes:function(){m.open(),n.deleteComponent(e.id).done(function(){t.success(),h.show(d.prop("HMI_LIBRARY_DELETE_CONFIRM_POPUP"))}).fail(function(e){t.fail(),p.message(e),p.open()}).always(function(){m.close()})},no:function(){}}),g.open()},load:function(e,t,i){this.setFileName(e.name,!0),this.tab.setCurrentTabCanvasInfo({id:e.id,name:e.name}),this._tabCanvasInfo[e.id]={canvas:this.canvas},this.canvas.load(e,t),this.canvas._isNew=i,this.updateUndoRedoButtonState(!1,!1)},setFileName:function(e,t){this.getViewModelWidget("name").element.val(e),this._currentFileName=e,this.updateEditState(t)},create:function(e,t){this.tab.setCurrentTabCanvasInfo({id:e.id,name:e.name}),this.setFileName(e.name,!0),this.canvas.create(),this.canvas._isNew=t},save:function(e){var t=this,i=t.getViewModelWidget("name").element.val();i=i&&$.trim(i),t.canvas.save(e,i).done(function(){t.setFileName(i,!0),t.tab.setCurrentTabCanvasInfo({id:e,name:i}),h.show(d.prop("HMI_FILE_SAVED")),t.canvas._isNew=!1,t.canvas._isSaved=!0})},clear:function(){this.canvas.clear(),this.clearTabCanvasInfo(),this.elementPanelBar&&this.elementPanelBar.collapse(".k-item",!1)},attachEvent:function(){var e=this;e.getActionViewModel("export").set("click",e.clickExportBtnEvt.bind(e)),e.getActionViewModel("import").set("click",e.clickImportBtnEvt.bind(e)),e.getActionViewModel("save").set("click",e.clickSaveBtnEvt.bind(e)),e.getActionViewModel("exit").set("click",e.clickExitBtnEvt.bind(e)),e.getActionViewModel("cancel").set("click",e.clickCancelBtnEvt.bind(e)),e.getViewModelWidget("name").element.on("keyup",e.updateSaveButtonState.bind(e))},attachToolbarEvt:function(){var e=this,t=e.getToolbarViewModel("undo");t.set("click",e.callInnerCanvasFunction.bind(e,"undo")),(t=e.getToolbarViewModel("redo")).set("click",e.callInnerCanvasFunction.bind(e,"redo")),(t=e.getToolbarViewModel("binding")).set("click",e.callInnerCanvasFunction.bind(e,"binding",null)),(t=e.getToolbarViewModel("lock")).set("click",e.lock.bind(e,"lock")),t.set("setState",e.setButtonState.bind(e)),(t=e.getToolbarViewModel("background")).set("click",e.clickBackgroundToolBtnEvt.bind(e)),t.set("closePopup",e.closeBackgroundToolBtnEvt.bind(e)),(t=e.getToolbarViewModel("fill")).set("click",e.clickColorPickerToolBtnEvt.bind(e,"fill")),t.set("setState",e.setButtonState.bind(e)),(t=e.getToolbarViewModel("select")).set("click",e.callInnerCanvasFunction.bind(e,"select")),(t=e.getToolbarViewModel("textHAlign")).set("click",e.clickDropDownToolBtnEvt.bind(e,"textHAlign")),t.set("setState",e.setButtonState.bind(e)),t.dropDownList.set("select",e.selectTextAlignEvt.bind(e)),t.dropDownList.set("close",e.closeDropDownEvt.bind(e)),(t=e.getToolbarViewModel("textVAlign")).set("click",e.clickDropDownToolBtnEvt.bind(e,"textVAlign")),t.set("setState",e.setButtonState.bind(e)),t.dropDownList.set("select",e.selectTextAlignEvt.bind(e)),t.dropDownList.set("close",e.closeDropDownEvt.bind(e)),(t=e.getToolbarViewModel("text")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"text")),(t=e.getToolbarViewModel("rect")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"rect")),(t=e.getToolbarViewModel("rounded")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"rounded")),(t=e.getToolbarViewModel("parall")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"parall")),(t=e.getToolbarViewModel("trapez")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"trapez")),(t=e.getToolbarViewModel("tri")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"tri")),(t=e.getToolbarViewModel("circle")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"circle")),(t=e.getToolbarViewModel("straight")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"straight")),(t=e.getToolbarViewModel("line")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"line")),(t=e.getToolbarViewModel("curve")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"curve")),(t=e.getToolbarViewModel("table")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"table")),(t=e.getToolbarViewModel("picture")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"picture")),(t=e.getToolbarViewModel("link")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"link")),(t=e.getToolbarViewModel("zone")).set("click",e.clickBasicShapeToolBtnEvt.bind(e,"zone")),(t=e.getToolbarViewModel("zoomin")).set("click",e.callInnerCanvasFunction.bind(e,"zoomIn")),(t=e.getToolbarViewModel("zoomout")).set("click",e.callInnerCanvasFunction.bind(e,"zoomOut")),(t=e.getToolbarViewModel("zoomlevel")).set("select",e.callInnerCanvasFunction.bind(e,"setZoomLevel")),t.set("close",e.callInnerCanvasFunction.bind(e,"setDefaultZoomLevel")),(t=e.getToolbarViewModel("fullscreen")).set("click",e.clickFullScreenBtnEvt.bind(e)),(t=e.getToolbarViewModel("fontSize")).set("select",e.callInnerCanvasFunction.bind(e,"setFontSize")),t.set("setState",e.setButtonState.bind(e)),(t=e.getToolbarViewModel("bold")).set("click",e.bold.bind(e,"bold")),t.set("setState",e.setButtonState.bind(e)),(t=e.getToolbarViewModel("italic")).set("click",e.italic.bind(e,"italic")),t.set("setState",e.setButtonState.bind(e)),(t=e.getToolbarViewModel("fontColor")).set("click",e.clickColorPickerToolBtnEvt.bind(e,"fontColor")),t.set("setState",e.setButtonState.bind(e)),(t=e.getToolbarViewModel("lineColor")).set("click",e.clickColorPickerToolBtnEvt.bind(e,"lineColor")),t.set("setState",e.setButtonState.bind(e)),(t=e.getToolbarViewModel("lineWidth")).set("click",e.clickDropDownToolBtnEvt.bind(e,"lineWidth")),t.set("setState",e.setButtonState.bind(e)),t.dropDownList.set("select",e.selectLineWidthEvt.bind(e)),t.dropDownList.set("close",e.closeDropDownEvt.bind(e)),(t=e.getToolbarViewModel("bringTop")).set("click",e.callInnerCanvasFunction.bind(e,"bringToTop")),(t=e.getToolbarViewModel("sendBottom")).set("click",e.callInnerCanvasFunction.bind(e,"sendToBottom")),(t=e.getToolbarViewModel("bringForward")).set("click",e.callInnerCanvasFunction.bind(e,"increaseZOrder")),(t=e.getToolbarViewModel("sendBackward")).set("click",e.callInnerCanvasFunction.bind(e,"decreaseZOrder")),(t=e.getToolbarViewModel("matchSize")).set("click",e.callInnerCanvasFunction.bind(e,"matchSize")),(t=e.getToolbarViewModel("matchWidth")).set("click",e.callInnerCanvasFunction.bind(e,"matchWidth")),(t=e.getToolbarViewModel("matchHeight")).set("click",e.callInnerCanvasFunction.bind(e,"matchHeight")),(t=e.getToolbarViewModel("alignLeft")).set("click",e.callInnerCanvasFunction.bind(e,"alignFigure","left")),(t=e.getToolbarViewModel("alignRight")).set("click",e.callInnerCanvasFunction.bind(e,"alignFigure","right")),(t=e.getToolbarViewModel("alignTop")).set("click",e.callInnerCanvasFunction.bind(e,"alignFigure","top")),(t=e.getToolbarViewModel("alignBottom")).set("click",e.callInnerCanvasFunction.bind(e,"alignFigure","bottom")),(t=e.getToolbarViewModel("alignHcenter")).set("click",e.callInnerCanvasFunction.bind(e,"alignFigure","center_h")),(t=e.getToolbarViewModel("alignVcenter")).set("click",e.callInnerCanvasFunction.bind(e,"alignFigure","center_v")),(t=e.getToolbarViewModel("alignHGap")).set("click",e.callInnerCanvasFunction.bind(e,"equalGap","horizontal")),(t=e.getToolbarViewModel("alignVGap")).set("click",e.callInnerCanvasFunction.bind(e,"equalGap","vertical")),(t=e.getToolbarViewModel("flipV")).set("click",e.callInnerCanvasFunction.bind(e,"vFlip")),(t=e.getToolbarViewModel("flipH")).set("click",e.callInnerCanvasFunction.bind(e,"hFlip")),(t=e.getToolbarViewModel("group")).set("click",e.callInnerCanvasFunction.bind(e,"group")),(t=e.getToolbarViewModel("ungroup")).set("click",e.callInnerCanvasFunction.bind(e,"ungroup")),(t=e.getToolbarViewModel("rotationRight")).set("click",e.callInnerCanvasFunction.bind(e,"rotation","right")),(t=e.getToolbarViewModel("rotationLeft")).set("click",e.callInnerCanvasFunction.bind(e,"rotation","left")),(t=e.getToolbarViewModel("rotation")).set("click",e.clickRotationToolBtnEvt.bind(e,"rotation")),t.set("change",e.callInnerCanvasFunction.bind(e,"rotation")),t.set("onClose",e.onCloseRotationToolBtnEvt.bind(e,"rotation")),e.attachKeyupEvtRotationToolBtn(t),t.set("closePopup",e.closeToolbarPopupEvt.bind(t)),(t=e.getToolbarViewModel("tableInsertion")).set("click",e.clickDropDownToolBtnEvt.bind(e,"tableInsertion")),t.dropDownList.set("select",e.selectTableInsertionEvt.bind(e)),t.dropDownList.set("close",e.closeDropDownEvt.bind(e)),(t=e.getToolbarViewModel("tableDelete")).set("click",e.clickDropDownToolBtnEvt.bind(e,"tableDelete")),t.dropDownList.set("select",e.selectTableDeleteEvt.bind(e)),t.dropDownList.set("close",e.closeDropDownEvt.bind(e)),(t=e.getToolbarViewModel("mergeCell")).set("click",e.callInnerCanvasFunction.bind(e,"tableAction","mergeCell")),(t=e.getToolbarViewModel("unmergeCell")).set("click",e.callInnerCanvasFunction.bind(e,"tableAction","unmergeCell"))},callInnerCanvasFunction:function(e,t,i){var n=this.canvas.canvas,o=n[e];o?("zoomIn"!=e&&"zoomOut"!=e||(t=null),o.call(n,t,i)):console.error("There is no function '"+e+"' in canvas.")},clickDropDownToolBtnEvt:function(e){var t=this.getToolbarViewModel(e);this._openDropDownList(t)},clickBasicShapeToolBtnEvt:function(e){var t=this.getToolbarViewModel(e),i=t.get("value"),n=o.getData(i);this._activeBasicShapeBtn&&this.clearBasicShapeBtnActive(),this._activeBasicShapeBtn=$("#"+t.id).addClass("active"),this.canvas.onPaletteClick({item:n,buttonName:e})},clearBasicShapeBtnActive:function(){this._activeBasicShapeBtn&&(this._activeBasicShapeBtn.removeClass("active"),this._activeBasicShapeBtn=null)},selectTextAlignEvt:function(e){var t=e.dataItem;this.canvas.textAlign(t.id);var i,n=t.id,o=t.className;i="left"==n||"center"==n||"right"==n?this.getToolbarViewModel("textHAlign"):this.getToolbarViewModel("textVAlign"),this.switchButtonClass(i.id,"text-align",o),this.selectDropDownListData(i,"ic-text-align-"+n)},selectBasicShapeEvt:function(e){var t=e.dataItem;this.canvas.createbasicShape(t.id)},closeDropDownEvt:function(e){e.sender.select(-1)},_openDropDownList:function(e){var t=$("#"+e.id),i=$("#"+e.dropDownList.id).data("kendoDropDownList"),n=t.offset(),o=t.height();n.top=n.top+o+10,i.open(n)},selectLineWidthEvt:function(e){var t=e.dataItem;this.canvas.setLineWidth(t.id),this.selectDropDownListData(e.data,t.id)},selectTableInsertionEvt:function(e){var t=e.dataItem,i=(this.canvas||{}).canvas;i?i.tableAction("add",t.id):console.error("There is no Canvas Instance.")},selectTableDeleteEvt:function(e){var t=e.dataItem,i=(this.canvas||{}).canvas;i?i.tableAction("remove",t.id):console.error("There is no Canvas Instance.")},clickRotationToolBtnEvt:function(e){var t=this.getToolbarViewModel(e);return t.set("popupInvisible",!1),this._closeToolbarPopupEvt=this.closeToolbarPopupEvt.bind(t),$(document).on("click",this._closeToolbarPopupEvt),!1},onCloseRotationToolBtnEvt:function(e){var t=this.getToolbarViewModel(e).id;$("#"+t).closest("li").find(".hmi-tool-rotation-numeric[data-role='numerictextbox']").data("kendoNumericTextBox").value(null)},attachKeyupEvtRotationToolBtn:function(o){var e=o.id,a=$("#"+e).closest("li").find(".hmi-tool-rotation-numeric[data-role='numerictextbox']").data("kendoNumericTextBox");a.element.on("keyup",function(e){var t=a.options.max,i=a.options.min,n=$(this).val();t<(n=Number(n))?($(this).val(t),n=t):n<i&&($(this).val(i),n=i),clearTimeout(o.timeout),o.timeout=setTimeout(function(){o.change(n)},500)})},closeToolbarPopupEvt:function(e){return $(e.target).closest(".hmi-tool-popup").length<1&&(this.set("popupInvisible",!0),$(document).off("click",this._closeToolbarPopupEvt),this.onClose&&this.onClose({sender:this}),!0)},clickColorPickerToolBtnEvt:function(e){var i=this,n=i.getToolbarViewModel(e),t=i.canvas.getColor(n),o=$("#"+n.id),a=i.colorPicker;this.setColorPickerOpenState(!0),a.close(),a.value(t),n.set("color",t),a.unbind("change"),a.bind("change",function(e){var t=e.value;n.set("color",t),i.canvas.changeColor(n,t)}),i._closeColorPickerEvt||(i._closeColorPickerEvt=i.closeColorPickerEvt.bind(i)),a.unbind("close",i._closeColorPickerEvt),a.bind("close",i._closeColorPickerEvt);var r=o.offset(),l=o.height(),s=r.left,d=r.top+l+10;return a.position({top:d,left:s}),a.open(),!1},clickBackgroundToolBtnEvt:function(e){return this.viewModel.backgroundImages.set("invisible",!1),this._closeBgSelector=this.closeBackgroundSelector.bind(this),$(document).on("click",this._closeBgSelector),!1},closeBackgroundToolBtnEvt:function(e){var t=this.viewModel.backgroundImages;t.invisible||t.set("invisible",!0)},closeBackgroundSelector:function(e){var t=this.viewModel.backgroundImages,i=$(e.target);return!!i.hasClass("image-info-input")||i.closest(".hmi-create-background-selector").length<1&&(t.set("invisible",!0),$(document).off("click",this._closeBgSelector),!0)},setColorPickerOpenState:function(e){this._isOpenedColorPicker=e},closeColorPickerEvt:function(e){this.setColorPickerOpenState(!1)},getColorPickerOpenedState:function(){return this._isOpenedColorPicker},clickFullScreenBtnEvt:function(e){this.setFullScreen(!this._isFullScreen)},setFullScreen:function(e){var t=this.getToolbarViewModel("fullscreen");(this._isFullScreen=e)?(this.element.addClass("full-screen"),t.set("title",d.prop("HMI_FULL_SCREEN_END"))):(this.element.removeClass("full-screen"),t.set("title",d.prop("HMI_FULL_SCREEN_START")))},clickExportBtnEvt:function(){var e=this.getViewModelWidget("name").element.val();this.canvas.export(e)},clickImportBtnEvt:function(){var e=this,t=e.getViewModelWidget("name"),i=e.canvas;i.hasModels()?(g.message(d.prop("HMI_IMPORT_NEW_TAB")),g.setConfirmActions({yes:function(){e._isImportFile=!0,e.tab.addTab()},no:function(){i.import(t).done(function(){e.updateEditState(!1)})}}),g.open()):i.import(t).done(function(){e.updateEditState(!1)})},clickExitBtnEvt:function(){var e=this,t=e.getViewModelWidget("name");e._isSaved?(e.trigger("click","exit"),t.hideMessages()):(g.message(d.prop("HMI_CANCEL_MSG")),g.setConfirmActions({yes:function(){e.trigger("click","exit"),t.hideMessages()},no:function(){}}),g.open())},clickCancelBtnEvt:function(e){var t=this,i=t.tab,n="number"==typeof e.index?e.index:i.getCurrentTabIndex(),o=$(i.scrollbar.scrollArea[0]).find(".ic-close").eq(n),a=e.id||i.getCurrentTabCanvasInfo().id,r=t.getCanvasInfo(a),l=r?r.canvas._isSaved:t._isSaved,s=r?r.canvas._isNew:t.canvas._isNew;l?o.trigger("click"):(g.message(d.prop("HMI_CANCEL_MSG")),g.setConfirmActions({yes:function(){s?t.deleteFileBeforeCloseTab(o,a):(r?r.canvas._isSaved=!0:t.updateEditState(!0),o.trigger("click"))},no:function(){}}),g.open())},clickSaveBtnEvt:function(){var e=this.tab.getCurrentTabCanvasInfo();this.trigger("click","save",e)},deleteFileBeforeCloseTab:function(t,i){var n=this;m.open(),n.fileList.apiDeleteFile({id:i}).done(function(){n._tabCanvasInfo[i].canvas._isNew=!1;var e=n.getCanvasInfo(i);e.canvas._isNew=!1,e.canvas._isSaved=!0,t.trigger("click")}).fail(function(e){p.message(e),p.open()}).always(function(){m.close()})},getToolbarViewModel:function(e){var t,i,n,o,a,r=this.viewModel.buttons;for(t in r)if(o=r[t],!isNaN(Number(t)))for(n=o.length,i=0;i<n;i++)if((a=o[i]).name==e)return a;return null},updateEditState:function(e){if(this.isAbleChangeButtonState()){this._isSaved=e,this.getActionViewModel("save").set("disabled",e);var t=this.getActionViewModel("cancel"),i=e?d.prop("COMMON_BTN_EXIT"):d.prop("COMMON_BTN_CANCEL");t.set("text",i);var n=this.tab.getCurrentTabCanvasInfo().id;this.getCanvasInfo(n).canvas._isSaved=e}},updateSaveButtonState:function(){var e=this.getViewModelWidget("name"),t=this.getActionViewModel("save"),i=e.validate(),n=e.element.val(),o=i&&this._currentFileName!=n;this.isAbleChangeButtonState()&&(o?(this._currentFileName=n,this.updateEditState(!o)):t.set("disabled",!(!this._isSaved&&i)))},isAbleChangeButtonState:function(){var e=this.canvas;if(!e)return!1;var t=e.canvas;return!(t._isGraphicLoading||t._isPollingUpdate||t._isClearing)},updateToolbarButtonState:function(){var e=this.canvas;if(e){var t=e.getToolbarButtonDisabledState();this.updateButtonDisableState(t),this.colorPicker.close()}},updateUndoRedoButtonState:function(e,t){var i=this.canvas.canvas||{};if(!i._isGraphicLoading&&!i._isPollingUpdate){var n=this.getToolbarViewModel("undo");n.set("disabled",!e),(n=this.getToolbarViewModel("redo")).set("disabled",!t)}},updateButtonDisableState:function(e){var t,i,n,o;for(i in e)(t=this.getToolbarViewModel(i))&&(n=t.get("disabled"),"object"==typeof(o=e[i])?t.setState(t,o):n!=o&&t.set("disabled",o),t.closePopup&&t.closePopup({sender:t}))},setButtonState:function(e,t){var i=e.name,n=t.disabled,o=t.value,a=e.id;if(e.set("disabled",n),"textVAlign"==i||"textHAlign"==i)o="ic-text-align-"+(o=o||("textVAlign"==i?"top":"left")),this.switchButtonClass(a,"text-align",o),this.selectDropDownListData(e,o);else if("fontSize"==i)o=o||s.DEFAULT_FONT_SIZE,e.set("value",o);else if("bold"==i||"italic"==i||"lock"==i){var r,l;o?l="active":r="active",this.switchButtonClass(a,r,l)}else"lineWidth"==i?this.selectDropDownListData(e,o):"fill"!=i&&"lineColor"!=i&&"fontColor"!=i||e.set("color",this.canvas.getColor(e))},setZoomButtonState:function(e){var t=this.getToolbarViewModel("zoomlevel");t&&t.set("value",e)},selectDropDownListData:function(e,t){e.dropDownList.dataSource.forEach(function(e){e.set("selected",e.className==t||e.id==t?"k-state-selected":"")})},lock:function(e){var t=this.getToolbarViewModel(e).id;$("#"+t).toggleClass("active");var i=this.canvas.canvas;i.lock.call(i)},bold:function(e){var t,i=this.getToolbarViewModel(e).id,n=$("#"+i);t=n.hasClass("active")?(n.removeClass("active"),!1):(n.addClass("active"),!0);var o=this.canvas.canvas;o.bold.call(o,t)},italic:function(e){var t,i=this.getToolbarViewModel(e).id,n=$("#"+i);t=n.hasClass("active")?(n.removeClass("active"),!1):(n.addClass("active"),!0);var o=this.canvas.canvas;o.italic.call(o,t)},switchButtonClass:function(e,t,i){var n,o,a;if(o=(a=$("#"+e).get(0).classList).length,t)for(n=0;n<o;n++)if(-1!=a[n].indexOf(t)){a.remove(a[n]);break}i&&a.add(i)},beforeTabChangeEvt:function(e){u.fn.beforeTabChangeEvt.call(this,e);var t=this.getActionViewModel("save").get("disabled"),i=this._tabCanvasInfo[e.id]||{};i.saveBtnDisabled=t,i.currentFileName=this._currentFileName||i.name},afterTabChangeEvt:function(e){u.fn.afterTabChangeEvt.call(this,e);var t=this.tab.getCurrentTabCanvasInfo(),i=this._tabCanvasInfo[t.id]||{},n=i.saveBtnDisabled;void 0===n&&(n=!0),this.setFileName(i.currentFileName,n),this.elementPanelBar&&this.elementPanelBar.updateDroppableCanvas(),this.libraryPanelBar&&this.libraryPanelBar.updateDroppableCanvas()},setCanvasInfoCurrentTab:function(e){this._isInitCreateCanvas=!0,u.fn.setCanvasInfoCurrentTab.call(this,e);var t=this.getCanvasInfo(e.id);t.canvas&&(t.canvas._isNew=e.isNew),this._isInitCreateCanvas=!1},addTabEvt:function(e){var t=this;if(!t._isInitCreateCanvas&&!t._isAddNewFile){e.preventDefault(),t._isAddNewFile=!0;var i=t.fileList,n=i.addFile();m.open(),i.apiPostFile(n).done(function(e){t.tab.addTab(e.name,e.id),t.canvas._isNew=!0,t._isAddNewFile=!1}).fail(function(e){p.message(e),p.open()}).always(function(){m.close()})}},addedTabEvt:function(e){var t=this;if(u.fn.addedTabEvt.call(t,e),t.setFileName(e.name,!1),t._isImportFile){var i=t.canvas,n=t.getViewModelWidget("name");i.import(n).done(function(){t.updateEditState(!1)}),t._isImportFile=!1}},deleteTabEvt:function(e){u.fn.deleteTabEvt.call(this,e);var t=this.getCanvasInfo(e.id),i=t.canvas._isSaved,n=t.canvas._isNew;if(!i)return e.preventDefault(),void this.clickCancelBtnEvt(e);n&&(e.preventDefault(),this.deleteFileBeforeCloseTab($(e.currentTarget),e.id))},deletedTabEvt:function(e){u.fn.deletedTabEvt.call(this,e),0==this.tab.contentElements.length&&this.trigger("click","exit")},setCurrentTabZoomLevel:function(e){u.fn.setCurrentTabZoomLevel.call(this,e),this.setZoomButtonState(e)},show:function(){this.element.show(),this.tab.show(),this.panelElement.show(),this.setZoomButtonState(100)},hide:function(){this.element.hide(),this.tab.hide(),this.panelElement.hide()}})}}),define("hmi/hmi-create",["hmi/hmi-util","hmi/config/popup-config","hmi/view-model/hmi-create-vm","hmi/hmi-common"],function(e,t,i,l){window.kendo;function n(e){v()}function o(e){var t=e.id;"string"==typeof t&&-1!=t.indexOf(l.DEFAULT_EMPTY_TAB_PREFIX)&&(t=null),c.save(t)}function a(){c.hide()}function s(){c.show()}var d,c,p,g,r=window.MAIN_WINDOW,h=window.I18N,u=(t.confirmDialog,t.msgDialog,$("#hmi-create-tab")),f=$("#hmi-create-close-btn"),m=function(){c=new i.ViewModelClass(u,{editable:!0})},_=function(){f.on("click",c.clickExitBtnEvt.bind(c))},v=function(){c.clear(),d.setFullScreen(c._isFullScreen),a(),d.show(p,g)},b=function(e){T()},T=function(){c.bind("click","exit",n),c.bind("click","save",o)};return{init:function(){r.disableFloorNav(!0),m(),b(0),_(),require(["hmi/hmi"],function(e){d=e})},hide:a,show:s,open:function(e,t,i,n){var o;c.clear(),p=null,d.hide(),c.setFullScreen(d.monitoringViewModel._isFullScreen),s();var a=e||l.DEFAULT_EMPTY_TAB_PREFIX+"1",r=t.name?t.name:h.prop("HMI_NEW_FILE")+" 1";o={id:p=a,name:g=r,isNew:n,zoomLevel:100},c.setCanvasInfo(o),c.setCanvasInfoCurrentTab(o),r&&i?c.load(t,i,n):c.create(t,n)},close:v,load:function(e,t){c.load(e,t)},setFullScreen:function(e){c.setFullScreen(e)},setGraphicFileInfo:function(e,t){c.tab.getCurrentTabCanvasInfo().id==p&&(p=t.id,g=t.name);var i={id:t.id,name:t.name};c.setCanvasInfo(i),c.setCanvasInfoCurrentTab(i)}}}),define("hmi/hmi",["hmi/hmi-util","hmi/config/popup-config","hmi/hmi-api","hmi/view-model/hmi-vm","hmi/hmi-create","hmi/model/hmi-model"],function(e,t,n,i,o,a){window.kendo;var r,l=window.MAIN_WINDOW,s=(window.Util,window.I18N,t.msgDialog),d=(t.confirmDialog,$("#hmi-tab")),c=($("#hmi-monitoring-canvas"),$(".monitoring-fold-btn")),p=($(".hmi-monitoring-file-list"),$("#hmi-monitoring-tab-template"),e.Loading),g=!1,h=function(){r=new i.ViewModelClass(d)},u=function(e){m(r)},f=function(){d.bind("activate",function(e){}),c.on("click",_)},m=function(e){e.bind("click","edit",v),e.bind("click","create",b),e.bind("click","fold",_)},_=function(e){var t=!d.hasClass("fold");d.toggleClass("fold"),r.panelFoldEvt(t)},v=function(e){var t=e.id,i=(e.name,e.file);g=e.isNew,p.open(),n.getFile(t).done(function(e){r.clear(),o.open(t,i,e,g)}).fail(function(e){s.message(e),s.open()}).always(function(){p.close()})},b=function(e){var t=e.id,i=e.file;g=e.isNew,o.open(t,i,null,g)};return l.disableFloorNav(!0),window.localStorage.removeItem("hmiCanvas"),h(),f(),u(0),c.show(),o.init(),{show:function(e,t){r.show(e,t,g),c.show()},hide:function(){r.hide(),c.hide()},setFullScreen:function(e){r.setFullScreen(e)},monitoringViewModel:r}});