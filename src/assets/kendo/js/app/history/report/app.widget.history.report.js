!function(e,i){var a=e.kendo,s=a.ui.Widget,r=["width","dataSource","columns","height","hasCheckedModel","isGroupListMode"],u={logic:"and",filters:[{field:"assigned",operator:"eq",value:!1}]},t=s.extend({options:{name:"ReportGroupList",width:null,height:373,columns:null,data:[],group:[],filter:null,showFields:[],hideAllColumns:!0,groupHeaderTemplate:null,showEditListHeader:!0,hasCheckedModel:!0,isGroupListMode:!0,checkedLimit:!1,headerTitleText:{assigned:"Selected Item",deassigned:"Unselected Item"},onceExpandParentLevel:1,showNormalMode:!0,events:["change"]},init:function(e,t){s.fn.init.call(this,e,t),this.options.columns||(this.options.columns=[]),this._gridOptions=this._createGridOpts(this.options),this.wrapper=this.element,this.dataSource=null,this._data=this.options.data,this._old=[],this.columns=this.options.columns,this._group=this.options.group,this._filter={},this.normalGroupList=null,this.assignedGroupList=null,this.deAssignedGroupList=null,this._assignedDataSource=null,this._deAssignedDataSource=null,this._hideAllCollumns=this.options.hideAllColumns,this._showEditListHeader=this.options.showEditListHeader,this._buttons=[],this._showNormalMode=this.options.showNormalMode,this._parseDataSource(),this._initDOM(),this._initComponent(),this._attachEvent()},_createGridOpts:function(e){var t,i={},s="";for(t=0;t<r.length;t++)"dataSource"!=(s=r[t])&&(i[s]=e[s]);return i},_parseDataSource:function(){for(var e=this._data,t=[],i=[],s=0;s<e.length;s++)e[s].hasOwnProperty("assigned")||(e[s].assigned=!1),e[s].checked=!1,e[s].assigned&&!e[s].deassigned&&t.push(e[s]),e[s].deassigned&&(e[s].assigned=!0),i.push(e[s]);this._assignedDataSource instanceof a.data.ObservableObject?this._assignedDataSource.data(t):this._assignedDataSource=t,this._deAssignedDataSource instanceof a.data.ObservableObject?this._deAssignedDataSource.data(i):this._deAssignedDataSource=new a.data.TreeListDataSource({data:i,filter:u,schema:{model:{id:"id",parentId:"parent_id",fields:{parent_id:{type:"string",nullable:!0}}}}})},_initDOM:function(){var e=this.options,t={};this.element.append(i("<div class='container'><div class='contents normal hide-header'><div class='group-list'></div></div><div class='contents edit'><div class='content unselected'><div class='inner'><div class='group-list'></div></div></div><div class='content btn-group'><div class='inner'><div><button class='k-button assign' data-event='assign'>\u25b6</button></div><div><button class='k-button deassign' data-event='deassign'>\u25c0</button></div></div></div><div class='content selected'><div class='inner'><div class='group-list'></div></div></div></div></div>")),this.wrapper.addClass("common-group-list"),t.height=e.height,e.width&&(t.width=e.width),this.wrapper.css(t)},_initComponent:function(){this._initNormalGroupList(),this._initSelectedGroupList(),this._initUnSelectedGroupList(),this._initButton()},_initNormalGroupList:function(){var e=this.wrapper.find(".contents.normal"),t=e.find(".group-list"),i={};this._hideAllCollumns?e.addClass("hide-header"):e.removeClass("hide-header"),t.empty(),i={width:this.options.width,height:this.options.height,hasCheckedModel:!1,isGroupListMode:!0,columns:this.options.columns},null!==this.options.onceExpandParentLevel&&(i.onceExpandParentLevel=this.options.onceExpandParentLevel),this.normalGroupList=t.kendoReportTreeList(i).data("kendoReportTreeList"),this.normalGroupList.setDataSource(this._assignedDataSource)},_initSelectedGroupList:function(){var e=this.wrapper.find(".contents.edit"),t=this.wrapper.find(".content.selected").find(".group-list"),i={};this._showEditListHeader?e.removeClass("hide-header"):e.addClass("hide-header"),t.empty(),i={height:this.options.height,hasCheckedModel:!0,isGroupListMode:!0,checkedLimit:this.options.checkedLimit,columns:this.options.columns},null!==this.options.onceExpandParentLevel&&(i.onceExpandParentLevel=this.options.onceExpandParentLevel),this.assignedGroupList=t.kendoReportTreeList(i).data("kendoReportTreeList"),this.assignedGroupList.setDataSource(this._assignedDataSource),this._setMainDataSource()},_initUnSelectedGroupList:function(){var e=this.wrapper.find(".content.unselected").find(".group-list"),t={};e.empty(),t={height:this.options.height,hasCheckedModel:!0,isGroupListMode:!0,checkedLimit:this.options.checkedLimit,columns:this.options.columns},null!==this.options.onceExpandParentLevel&&(t.onceExpandParentLevel=this.options.onceExpandParentLevel),this.deAssignedGroupList=e.kendoReportTreeList(t).data("kendoReportTreeList"),this.deAssignedGroupList.setDataSource(this._deAssignedDataSource)},_initButton:function(){var e=this.wrapper,t=e.find(".k-button.deassign").kendoButton(),i=e.find(".k-button.assign").kendoButton();this._buttons=[i,t]},_setMainDataSource:function(){this.dataSource=this.assignedGroupList.dataSource},setButtonState:function(e,t){if(void 0!==t)this._buttons[t].data("kendoButton").enable(e);else for(var i=0;i<this._buttons.length;i++)this._buttons[i].data("kendoButton").enable(e)},_attachEvent:function(){var e=this,t=e.wrapper,i=t.find(".k-button.deassign"),s=t.find(".k-button.assign");i.on("click",e._deAssignItems.bind(e)),s.on("click",e._assignItems.bind(e))},_setDefaultButtonState:function(){var e=this.getDeAssignedItems().length,t=this.getAssignedItems().length,i=this._buttons[0].data("kendoButton"),s=this._buttons[1].data("kendoButton");i.enable(!(0==e)),s.enable(!(0==t))},_deAssignItems:function(){console.time("dataChange");var e,t,i,s,a=this.deAssignedGroupList.dataSource,r=this.assignedGroupList.dataSource,d=this.assignedGroupList.getUncheckedData(),o=this.assignedGroupList.getCheckedData(),n=[];for(t=0,i=o.length;t<i;t++)(e=a.get(o[t].id)).assigned=!1,e.hasCheckedChild&&(e.hasCheckedChild=!1),e.checked=!1;for(t=0,i=d.length;t<i;t++)(s=d[t]).dms_devices_id&&n.push({dms_devices_id:s.dms_devices_id,dms_devices_name:s.dms_devices_name,dms_devices_type:s.dms_devices_type,foundation_space_buildings_id:s.foundation_space_buildings_id,foundation_space_floors_id:s.foundation_space_floors_id,dms_reports_view_properties:s.dms_reports_view_properties,id:s.id,assigned:!0,checked:!1});a.filter(u),r.fetch(),this.normalGroupList.setDataSource(n),this.assignedGroupList.setDataSource(n),this._setDefaultButtonState(),this.trigger("change",{assignedItems:this.getAssignedItems(),deassignedItems:this.getDeAssignedItems()}),console.timeEnd("dataChange")},_assignItems:function(){console.time("dataChange");var e,t,i,s,a=this.deAssignedGroupList.dataSource,r=a.data(),d=this.deAssignedGroupList.getCheckedAllData(),o=this.assignedGroupList.getUncheckedData(),n=d.concat(o);for(t=0,i=r.length;t<i;t++)((e=r[t]).checked||e.hasCheckedChild)&&(e.assigned=!0),e.hasCheckedChild&&(e.hasCheckedChild=!1),e.checked=!1;var l=new Array(r.length);for(t=0,i=n.length;t<i;t++)if((s=n[t]).dms_devices_id)for(var h=0,c=r.length;h<c;h++)s.id===r[h].id&&(l[h]={dms_devices_id:s.dms_devices_id,dms_devices_name:s.dms_devices_name,dms_devices_type:s.dms_devices_type,foundation_space_buildings_id:s.foundation_space_buildings_id,foundation_space_floors_id:s.foundation_space_floors_id,dms_reports_view_properties:s.dms_reports_view_properties,id:s.id,assigned:!0,checked:!1});l=l.filter(function(e){return void 0!==e}),a.filter(u),this.normalGroupList.setDataSource(l),this.assignedGroupList.setDataSource(l),this._setDefaultButtonState(),this.trigger("change",{assignedItems:this.getAssignedItems(),deassignedItems:this.getDeAssignedItems()}),console.timeEnd("dataChange")},uncheckAll:function(){this.assignedGroupList.uncheckAll(),this.deAssignedGroupList.uncheckAll()},uncheckAllAssignList:function(){this.assignedGroupList.uncheckAll()},uncheckAllDeAssignList:function(){this.deAssignedGroupList.uncheckAll()},_getAggregateOption:function(){for(var e,t=this._group,i=[],s=0;s<t.length;s++)e=t[s],i.push({field:e.field,aggregate:"count"});return i},_getGroupOption:function(){for(var e,t=[],i=this._group,s=0;s<i.length;s++)e=i[s],t.push({field:e.field,aggregates:[{field:e.field,aggregate:"count"}]});return t},_createOldData:function(e){return JSON.parse(JSON.stringify(e.data()))},_createNewDataSource:function(e,t){var i=new a.data.DataSource({data:e,group:this._group});return i.filter(this._filter[t]),i},_changeDataSources:function(){this.assignedGroupList.setDataSource(this._assignedDataSource),this.deAssignedGroupList.setDataSource(this._deAssignedDataSource)},_renewDataSources:function(){this._showNormalMode&&this.normalGroupList.setDataSource(this._assignedDataSource),this.assignedGroupList.setDataSource(this._assignedDataSource),this.deAssignedGroupList.setDataSource(this._deAssignedDataSource)},data:function(e){if(console.time("render time"),!e)return this._data;this._data=e,this._parseDataSource(),this._renewDataSources(),this._setDefaultButtonState(),console.timeEnd("render time")},setDataSource:function(e,t){e||(e=[]),t||(t=[]),this._data=e,this._group=t,this._parseDataSource(),this._renewDataSources(),this._setDefaultButtonState()},showEditMode:function(){this.wrapper.addClass("edit-mode")},hideEditMode:function(e,t){e?("cancelChanged"==t?this.normalGroupList.setDataSource(this._old):this.normalGroupList.setDataSource(this._assignedDataSource),this.wrapper.removeClass("edit-mode")):(this._old=this._assignedDataSource,this.wrapper.addClass("edit-mode"))},setOptions:function(e){this.normalGroupList.setOptions(e),this.assignedGroupList.setOptions(e),this.deAssignedGroupList.setOptions(e)},hideAllColumns:function(e){if(e!=this._hideAllCollumns){var t=this.wrapper.find(".contents.normal"),i=this.normalGroupList;this._hideAllCollumns=e,(this.options.hideAllColumns=e)?t.addClass("hide-header"):t.removeClass("hide-header"),i.destroy(),this._initNormalGroupList()}},showHeader:function(e){if(e!=this._showEditListHeader){var t=this.wrapper.find(".contents.edit");this._showEditListHeader=e,(this.options.showEditListHeader=e)?t.removeClass("hide-header"):t.addClass("hide-header")}},getAssignedItems:function(){var e,t=this.assignedGroupList.dataSource.data(),i=[];t=new a.data.Query(t).filter({logic:"and",filters:[{field:"hasChildren",operator:"eq",value:!1}]}).toArray();for(var s=0;s<t.length;s++)(e=t[s]).assigned&&i.push(e);return i},getDeAssignedItems:function(){var e,t=this.deAssignedGroupList.dataSource.data(),i=[];t=new a.data.Query(t).filter({logic:"and",filters:[{field:"hasChildren",operator:"eq",value:!1}]}).toArray();for(var s=0;s<t.length;s++)(e=t[s]).assigned||i.push(e);return i},group:function(e){var t=this;if(!e)return this._group;this._group=e,t.normalGroupList.destroy(),t.assignedGroupList.destroy(),t.deAssignedGroupList.destroy(),t._parseDataSource(),t._initNormalGroupList(),t._initSelectedGroupList(),t._initUnSelectedGroupList()}});a.ui.plugin(t)}(window,window.kendo.jQuery),function(a,G){var M=a.kendo,e=M.ui,t=e.TreeList,r=e.DataBoundWidget,d=G.extend,i=M.dom,o=i.element,s=i.text,n=i.html,l=M.data.TreeListDataSource,I=G.proxy,h=G.map,c="change",u="progress",T={wrapper:"k-treelist k-grid k-widget",header:"k-header",button:"k-button",alt:"k-alt",editCell:"k-edit-cell",group:"k-treelist-group",gridToolbar:"k-grid-toolbar",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",gridContentWrap:"k-grid-content",gridFilter:"k-grid-filter",footerTemplate:"k-footer-template",loading:"k-i-loading",refresh:"k-i-reload",retry:"k-request-retry",selected:"k-state-selected",status:"k-status",link:"k-link",withIcon:"k-with-icon",filterable:"k-filterable",icon:"k-icon",iconFilter:"k-i-filter",iconCollapse:"k-i-collapse",iconExpand:"k-i-expand",iconHidden:"k-i-none",iconPlaceHolder:"k-icon k-i-none",input:"k-input",dropPositions:"k-i-insert-up k-i-insert-down k-i-plus k-i-insert-middle",dropTop:"k-i-insert-up",dropBottom:"k-i-insert-down",dropAdd:"k-i-plus",dropMiddle:"k-i-insert-middle",dropDenied:"k-i-cancel",dragStatus:"k-drag-status",dragClue:"k-drag-clue",dragClueText:"k-clue-text"};var p=e.TreeList=t.extend({options:{name:"ReportTreeList",hasSelectedModel:!1,enableShiftSelection:!1,setSelectedAttribute:!1,hasCheckedModel:!1,setCheckedAttribute:!1,hasRadioModel:!1,checkedLimit:!1,selectedLimit:!1,isGroupListMode:!1,onceExpandParentLevel:null,hasDoubleClickEvt:!1,isOnlySelection:!1,isOnlyChildrenSelectable:!1,groups:[],events:["checked","checkedLimit"]},_draggable:function(){var e=this.options.editable;e&&e.move&&(this._dragging=new M.ui.HierarchicalDragAndDrop(this.wrapper,{$angular:this.$angular,autoScroll:!0,filter:"tbody>tr",itemSelector:"tr",allowedContainers:this.wrapper,hintText:function(e){return e.children("td").map(function(){return G(this).text()}).toArray().join("<span class='k-header k-drag-separator' />")},contains:I(function(e,t){var i=this.dataItem(t),s=this.dataItem(e);return s==i||this.dataSource.contains(s,i)},this),itemFromTarget:function(e){var t=e.closest("tr");return{item:t,content:t}},dragstart:I(function(e){this.wrapper.addClass("k-treelist-dragging");var t=this.dataItem(e);return this.trigger("dragstart",{source:t})},this),drag:I(function(e){e.source=this.dataItem(e.source),this.trigger("drag",e)},this),drop:I(function(e){return e.source=this.dataItem(e.source),e.destination=this.dataItem(e.destination),this.wrapper.removeClass("k-treelist-dragging"),this.trigger("drop",e)},this),dragend:I(function(e){var t=this.dataItem(e.destination),i=this.dataItem(e.source);this.options.customDragEndEvent||i.set("parentId",t?t.id:null),e.source=i,e.destination=t,this.trigger("dragend",e)},this),reorderable:!1,dropHintContainer:function(e){return e.children("td:eq(1)")},dropPositionFrom:function(e){return 0<e.prevAll(".k-i-none").length?"after":"before"}}))},init:function(e,t){if(void 0===t.messages||void 0===t.messages.noRows){var i=a.I18N;t.messages||(t.messages={}),t.messages.noRows=i.prop("COMMON_NO_DATA_AVAILABLE_GRID")}if(this._createCheckedColumn(t),this.totalParentIds={},r.fn.init.call(this,e,t),this.options.isGroupListMode&&(this._currentExpandedModel={}),this.lastParentLevel=2,this._dataSource(this.options.dataSource),this._columns(),this._layout(),this._selectable(),this._sortable(),this._resizable(),this._filterable(),this._attachEvents(),this._toolbar(),this._scrollable(),this._reorderable(),this._columnMenu(),this._minScreenSupport(),this._draggable(),this.options.autoBind&&this.dataSource.fetch(),this._hasLockedColumns){var s=this;this.wrapper.addClass("k-grid-lockedcolumns"),this._resizeHandler=function(){s.resize()},G(a).on("resize.kendoTreeList",this._resizeHandler)}M.notify(this),this._createCheckedModel()},_columns:function(){var e=this.options.columns||[];this.columns=h(e,function(e){return d({encoded:!0},e="string"==typeof e?{field:e}:e)});var t=this._lockedColumns();0<t.length&&(this._hasLockedColumns=!0,this.columns=t.concat(this._nonLockedColumns())),this._ensureExpandableColumn(),this._columnTemplates(),this._columnAttributes()},_createCheckedColumn:function(e){if((e.hasCheckedModel||e.hasRadioModel)&&e.columns){var t,i,s,a=e.columns,r=!1;for(i=a.length,t=0;t<i;t++)if("checked"==(s=a[t]).field){r=!0;break}r?s=this._setCheckedModelColumn(s,e):(s=this._setCheckedModelColumn({},e),a.unshift(s))}},_createCheckedModel:function(e,t){var i=(t=this.options).hasCheckedModel,s=t.hasRadioModel,a=t.setCheckedAttribute,r=this.dataSource;if(i||s){this.checkedIds=[];var d,o=r.data();if(a)for(d=0;d<void 0;d++)o[d].checked=!1;this._attachCheckedModelEvt()}},_attachCheckedModelEvt:function(){var o=this,e=G(this.element);e.off("click"),e.on("click","tr:not(.k-treelist-group) .grid-checkbox-cell .k-checkbox",function(e){var t,i=G(this),s=o._findItemFromCheckbox(i),a=i.prop("checked"),r=o.options.checkedLimit;if(!1!==r&&0!=r&&a&&o.getCheckedData().length>=r)return!1;s.checked=a,s&&s.parent_id&&(t=o.dataSource.get(s.parent_id),o.setGroupCheckbox(t)),o.setHeaderCheckbox(),o.trigger("checked",{isHeader:!1,item:s,checkbox:i})}),e.on("click",".grid-checkbox-header .k-checkbox",function(e){var t=G(this),i=t.prop("checked"),s=o.options.checkedLimit;if(!1!==s&&0!=s&&i&&o.getCheckedData().length>=s)return!1;o.trigger("dataBinding"),i?o.checkAll(!0):o.uncheckAll(),o.trigger("checked",{isHeader:!0,item:null,checkbox:t})}),e.on("click","tr.k-treelist-group .grid-checkbox-cell .k-checkbox",function(e){console.time("checked time");var t,i=G(this),s=o._findItemFromCheckbox(i),a=i.prop("checked"),r=o.options.checkedLimit;if(!1!==r&&0!=r&&a&&o.getCheckedData().length>=r)return!1;s.checked=a,o.checkedDataLength=new M.data.Query(o.dataSource.data()).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:!0},{field:"hasChildren",operator:"eq",value:!1}]}).toArray().length,t=o.checkGroup(!0,s,a),t=new M.data.Query(t).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:a},{field:"hasChildren",operator:"eq",value:!1}]}),o.refresh();var d={isGroupHeader:!0,parent:parent,item:t,checkbox:i,checked:a};o.trigger("dataBound",d),o.trigger("checked",d),console.timeEnd("checked time")}),this.bind("dataBound",function(e){this.setHeaderCheckbox()})},_findItemFromCheckbox:function(e){var t=this.dataSource,i=e.closest("tr").attr("data-id");return t.get(i)},_setCheckedModelColumn:function(e,t){return e||(e={}),e.field||(e.field="checked"),e.width||(e.width=37),e.attributes||(e.attributes={class:"grid-checkbox-cell"}),e.template||(t.hasCheckedModel?e.template=this._checkedModelTemplate:t.hasRadioModel&&(e.template=this._radioModelTemplate)),e.headerAttributes||(e.headerAttributes={class:"grid-checkbox-header k-header"}),e.headerTemplate||(t.hasCheckedModel?e.headerTemplate=this._checkedModelHeaderTemplate:t.hasRadioModel&&(e.headerTemplate="")),void 0===e.sortable&&(e.sortable=!1),void 0===e.editable&&(e.editable=!1),e},_checkedModelTemplate:function(e){var t=e.id,i=e.uid;return'<input type="checkbox" id="check_'+t+"_"+i+'" class="k-checkbox" '+(e.checked?"checked":"")+'><label for="check_'+t+"_"+i+'" class="k-checkbox-label"></label>'},_checkedModelHeaderTemplate:function(){var e=M.guid();return'<input type="checkbox" id="check_header_'+e+'" class="k-checkbox"><label for="check_header_'+e+'" class="k-checkbox-label"></label>'},checkAll:function(e,t){var i=this.dataSource,s=i.data();if(e)if(i.pageSize()){var a=new M.data.Query(i.data()),r=i.filter();r&&(a=a.filter(r));var d=i.sort();d&&(a=a.sort(d)),s=a.toArray()}else s=i.flatView();var o=this.options.checkedLimit;!1!==o&&0!=o&&(t=o);var n,l=new M.data.Query(s).filter({field:"hasChildren",operator:"eq",value:!1}).toArray(),h=l.length,c=new M.data.Query(l).filter({field:"checked",operator:"eq",value:!0}).toArray();c.length&&t&&(t-=c.length);var u,p,g,f=(t=h<=t?h:t)||h,k=[];for(u=0;u<f;u++)(n=l[u]).checked=!0,-1==k.indexOf(n.parent_id)&&k.push(n.parent_id);for(f=k.length,u=0;u<f;u++)p=k[u],(g=i.get(p))&&this.setSubGroupCheckbox(g,!0);i.fetch()},checkByIds:function(e,t,i,s){var a=this.dataSource,r=a.data();if(s)if(a.pageSize()){var d=new M.data.Query(a.data()),o=a.filter();o&&(d=d.filter(o));var n=a.sort();n&&(d=d.sort(n)),r=d.toArray()}else r=a.flatView();var l=this.options.checkedLimit;!1!==l&&0!=l&&(i=l);var h,c=new M.data.Query(r).filter({field:"hasChildren",operator:"eq",value:!1}).toArray(),u=c.length,p=new M.data.Query(c).filter({field:"checked",operator:"eq",value:!0}).toArray();p.length&&i&&(i-=p.length);var g,f,k,_,v=(i=u<=i?u:i)||u,m=e.length,C=[];for(g=0;g<v;g++)for(h=c[g],f=0;f<m;f++)h.id==e[f]&&(h.checked=t,-1==C.indexOf(h.parent_id)&&C.push(h.parent_id));for(v=C.length,g=0;g<v;g++)k=C[g],(_=a.get(k))&&this.setSubGroupCheckbox(_,!0);a.fetch()},checkById:function(e,t){var i=this,s=i.dataSource,a=i.options.checkedLimit;if(!1!==a&&0!=a&&t&&i.getCheckedData().length>=a)return!1;var r,d=s.get(e);d.checked=t,i.element.find("tr[data-id='"+e+"'] .grid-checkbox-cell .k-checkbox").prop("checked",t),d&&d.parent_id&&(r=i.dataSource.get(d.parent_id),i.setGroupCheckbox(r)),i.setHeaderCheckbox()},checkByData:function(e,t){var i,s=this,a=e.id,r=s.options.checkedLimit;if(!1!==r&&0!=r&&t&&s.getCheckedData().length>=r)return!1;e.checked=t,this.element.find("tr[data-id='"+a+"'] .grid-checkbox-cell .k-checkbox").prop("checked",t),e&&e.parent_id&&(i=s.dataSource.get(e.parent_id),s.setGroupCheckbox(i)),s.setHeaderCheckbox()},uncheckAll:function(e){var t=this.dataSource,i=t.data();if(e)if(t.pageSize()){var s=new M.data.Query(t.data()),a=t.filter();a&&(s=s.filter(a));var r=t.sort();r&&(s=s.sort(r));var d=t.group();d&&(s=s.group(d)),i=s.toArray()}else i=t.flatView();var o,n=i.length;for(o=0;o<n;o++)i[o].hasCheckedChild&&(i[o].hasCheckedChild=!1),i[o].checked=!1;t.fetch()},isAllChecked:function(e){var t=this.dataSource,i=!0,s=t.data();if(e)if(t.pageSize()){var a=new M.data.Query(t.data()),r=t.filter();r&&(a=a.filter(r));var d=t.sort();d&&(a=a.sort(d));var o=t.group();o&&(a=a.group(o)),s=a.toArray()}else s=t.flatView();var n,l=s.length;if(0==l)return!1;var h=this.options.checkedLimit;if(!1!==h&&0!=h)this.getCheckedData().length<h&&(i=!1);else for(n=0;n<l;n++)if(!s[n].checked){i=!1;break}return i},setHeaderCheckbox:function(){var e=this.isAllChecked(!0),t=this.element.find(".grid-checkbox-header .k-checkbox");e?t.prop("checked",!0):t.prop("checked",!1)},setGroupCheckbox:function(e){this.setSubGroupCheckbox(e)},setSubGroupCheckbox:function(e,t){var i,s,a,r,d,o,n=this.dataSource,l=e.id,h=e.parent_id;s=(i=this.isCheckedAllGroup(e)).isCheckedAll,a=i.hasCheckedChild,e.checked=s,t||((r=this.getGroupCheckbox(l)).prop("checked",s),d=r.closest("tr"),a?d.addClass("has-checked-child"):d.removeClass("has-checked-child")),h&&(o=n.get(h),this.setSubGroupCheckbox(o,t))},getGroupCheckbox:function(e){return this.element.find("tr.k-treelist-group[data-id='"+e+"'] .grid-checkbox-cell .k-checkbox")},findParentItem:function(e,t){for(var i,s=[],a=0,r=e.length;a<r;a++)(i=e[a]).parent_id===t&&s.push(i);return s},isCheckedAllGroup:function(e){var t,i,s=e.id,a=this.dataSource.flatView(),r=this.findParentItem(a,s),d=this.options.checkedLimit;!1!==d&&0!=d&&(i=d),t=r.length;var o,n=!0,l=!1,h=new M.data.Query(r).filter({field:"checked",operator:"eq",value:!0}).toArray(),c=new M.data.Query(r).filter({field:"hasCheckedChild",operator:"eq",value:!0}).toArray();return(0<(o=h.length)||0<c.length)&&(l=!0),i||o==t||(n=!1),i&&o<(t=i>=r.length?r.length:i)&&(n=!1),{isCheckedAll:n,hasCheckedChild:e.hasCheckedChild=l}},checkGroup:function(e,t,i,s){var a,r,d,o=t.id,n=this.dataSource;if(e)if(n.pageSize()){var l=new M.data.Query(n.data()),h=n.filter();h&&(l=l.filter(h));var c=n.sort();c&&(l=l.sort(c)),d=l.toArray()}else d=n.flatView();else d=n.data();var u=this.findParentItem(d,o),p=this.options.checkedLimit;if(!1!==p&&0!=p&&(s=p),s&&i&&s<=this.checkedDataLength)return this.trigger("checkedLimit",{length:s}),[];if(s&&i){r=(s-=this.checkedDataLength)>=u.length?u.length:s;var g=u.length,f=0;for(a=0;a<g&&(u[a].hasChildren?(this.checkGroup(e,u[a],i,s),this.setSubGroupCheckbox(u[a],!0)):(u[a].checked=i,f++,this.checkedDataLength++),!(r<=f));a++);0<f&&(t.hasCheckedChild=i,this.setSubGroupCheckbox(t,!0))}else{for(r=u.length,a=0;a<r;a++)u[a].hasChildren?(this.checkGroup(e,u[a],i,s),this.setSubGroupCheckbox(u[a],!0)):u[a].checked=i;t.hasCheckedChild=i,this.setSubGroupCheckbox(t,!0)}return d},hasSelectedChild:function(e){var t=this.dataSource.data();return 0<new M.data.Query(t).filter({logic:"and",filters:[{field:"parent_id",operator:"eq",value:e.id},{logic:"or",filters:[{field:"selected",operator:"eq",value:!0},{field:"hasCheckedChild",operator:"eq",value:!0}]}]}).toArray().length},updateParentSelected:function(e){var t,i=this.element,s=this.dataSource.parentNode(e);s&&(t=i.find("tr[data-id='"+s.id+"']"),this.hasSelectedChild(s)?(s.hasCheckedChild=!0,t.addClass("has-checked-child")):(s.hasCheckedChild=!1,t.removeClass("has-checked-child")),s.parent_id&&this.updateParentSelected(s))},_selectable:function(){var e,t,i=this.options.selectable,s=this.options.isOnlyChildrenSelectable,a=this.table,h=this;i&&(i=M.ui.Selectable.parseOptions(i),this._hasLockedColumns&&(a=a.add(this.lockedTable),t=i.multiple&&i.cell),e=">tbody>tr:not(.k-footer-template)"+(i.multiple||s?":not(.k-treelist-group)":""),i.cell&&(e+=">td"),this.selectable=new M.ui.Selectable(a,{filter:e,aria:!0,multiple:i.multiple,hasSelectedModel:h.options.hasSelectedModel,enableShiftSelection:h.options.enableShiftSelection,hasDoubleClickEvt:h.options.hasDoubleClickEvt,isOnlySelection:h.options.isOnlySelection,change:function(e){var t={};if(h.options.hasSelectedModel){var i,s=G(e.sender.userEvents.currentTarget),a=s.data("uid");if(a&&(i=h.dataSource.getByUid(a)),i){var r,d=s.hasClass("k-state-selected");if(d&&h.options.selectedLimit){var o=h.dataSource.data();if((r=new M.data.Query(o).filter({field:"selected",operator:"eq",value:!0}).toArray()).length>=h.options.selectedLimit)return(s=G(e.sender.userEvents.currentTarget)).removeClass("k-state-selected"),!1}if(!this.options.multiple){var n,l=(r=h.getSelectedData()).length;for(n=0;n<l;n++)r[n].selected=!1}i.selected=d,h.updateParentSelected(i),t.item=i}}t.isDoubleClick=this._isDblClick,h.trigger(c,t)},useAllItems:t,continuousItems:I(this._continuousItems,this,e,i.cell),relatedTarget:!i.cell&&this._hasLockedColumns?I(this._selectableTarget,this):void 0}))},_flushCache:function(){this._templateColumns().length&&(this._contentTree.render([]),this._hasLockedColumns&&this._lockedContentTree.render([]))},_render:function(e){e=e||{};var t,i=this.options.messages,s=this.options.hasSelectedModel,a=this.options.hasCheckedModel,r=this.dataSource.rootNodes(),d=M.attr("uid");t=s||a?[]:this.select().removeClass("k-state-selected").map(function(e,t){return G(t).attr(d)}),this._absoluteIndex=0,this._angularItems("cleanup"),this._angularFooters("cleanup"),this._flushCache(),e.error?this._showStatus(M.template("#: messages.requestFailed # <button class='#= buttonClass #'>#: messages.retry #</button>")({buttonClass:[T.button,T.retry].join(" "),messages:i})):r.length?(this._hideStatus(),this._contentTree.render(this._trs({columns:this._nonLockedColumns(),aggregates:e.aggregates,selected:t,data:r,visible:!0,level:0})),this._hasLockedColumns&&(this._absoluteIndex=0,this._lockedContentTree.render(this._trs({columns:this._lockedColumns(),aggregates:e.aggregates,selected:t,data:r,visible:!0,level:0})))):this._showStatus(M.htmlEncode(i.noRows)),this._touchScroller&&this._touchScroller.contentResized(),this._muteAngularRebind(function(){this._angularItems("compile"),this._angularFooters("compile")}),s||a||this.items().filter(function(){return 0<=G.inArray(G(this).attr(d),t)}).addClass("k-state-selected"),this._adjustRowsHeight()},_toggleChildren:function(e){var t=G(e.currentTarget),i=this.options,s=this.dataItem(t),a=s.expanded?"collapse":"expand";if(!this.trigger(a,{model:s})){var r=i.onceExpandParentLevel?i.onceExpandParentLevel:this.lastParentLevel;if(i.isGroupListMode&&s.level>=r){var d=this._currentExpandedModel,o=s.level;if(d[o]&&d[o]!==s){var n,l,h=this.dataSource;for(d[o].expanded=!1,l=d[o]=s,n=o-1;0<=n;n--)l=h.parentNode(l),d[n]!==l&&(d[n].expanded=!1,d[n]=l)}}this._toggle(s)}e.preventDefault()},_trs:function(e){var t,i,s,a,r,d,o,n,l,h,c,u,p,g,f,k=[],_=this.options,v=_.hasSelectedModel,m=_.hasCheckedModel,C=_.isGroupListMode,b=this._currentExpandedModel,S=void 0!==_.onceExpandParentLevel?_.onceExpandParentLevel:this.lastParentLevel,L=e.level,w=e.data,x=this.dataSource,A=x.flatView(),D=x.aggregates()||{},y=e.columns;for(d=0,h=w.length;d<h;d++){if(s=[],a=(r=(t=w[d]).loaded()&&x.childNodes(t))&&r.length,(i={role:"row"})[M.attr("uid")]=t.uid,t.id&&(i["data-id"]=t.id),void 0!==t.level&&null!==t.level&&(i["data-level"]=t.level),t.parent_id&&(s.push("child"),0==d&&s.push("children-first-item"),d==h-1&&s.push("children-last-item")),a&&(i["aria-expanded"]=!!t.expanded,t.field&&(i["data-field"]=t.field),t.value&&(i["data-value"]=t.value),c=t.hasCheckedChild,(m||v)&&c&&s.push("has-checked-child"),f=t.aggregates,g=t.field,f&&f[g]&&f[g].count)){if(p=A.indexOf(t),n=A.length,l=0,-1!==p)for(o=p+1;o<n;o++)if(A[o].hasChildren){if(A[o].level==t.level)break}else l++;f[g].count=l}if(e.visible?(this._absoluteIndex%2!=0&&s.push(T.alt),this._absoluteIndex++):i.style={display:"none"},v?t.selected&&s.push("k-state-selected"):m?t.checked&&s.push("k-state-checked"):0<=G.inArray(t.uid,e.selected)&&s.push(T.selected),a&&s.push(T.group),t._edit&&s.push("k-grid-edit-row"),i.className=s.join(" "),k.push(this._tds({model:t,attr:i,level:L},y,I(this._td,this))),a){if(b&&(u=b[t.level]),C&&S<=t.level&&(!u||u.field!==t.field||u.value!==t.value))continue;k=k.concat(this._trs({columns:y,aggregates:D,selected:e.selected,visible:e.visible&&!!t.expanded,data:r,level:L+1}))}}return this._hasFooterTemplate()&&(i={className:T.footerTemplate,"data-parentId":t.parentId},e.visible||(i.style={display:"none"}),k.push(this._tds({model:D[t.parentId],attr:i,level:L},y,this._footerTd))),k},_td:function(e){var t,i=[],s=e.model,a=e.column,r={role:"gridcell",style:!0===a.hidden?{display:"none"}:{}};return s._edit&&a.field&&s.editable(a.field)?r[M.attr("container-for")]=a.field:(a.expandable&&(i=function(e){for(var t=[],i=e.className,s=0,a=e.level;s<a;s++)t.push(o("span",{className:i}));return t}({level:e.level,className:T.iconPlaceHolder}),t=[T.icon],s.hasChildren?t.push(s.expanded?T.iconCollapse:T.iconExpand):t.push(T.iconHidden),s._error?t.push(T.refresh):!s.loaded()&&s.expanded&&t.push(T.loading),i.push(o("span",{className:t.join(" ")})),r.style["white-space"]="nowrap"),a.attributes&&d(!0,r,a.attributes),a.command?i=s._edit?this._buildCommands(["update","canceledit"]):this._buildCommands(a.command):i.push(this._cellContent(a,s))),o("td",r,i)},_cellContent:function(e,t){var i;return e.template?i=e.template(t):e.field&&null!==(i=t.get(e.field))&&e.format&&(i=M.format(e.format,i)),null==i&&(i=""),e.template||!e.encoded?n(i):s(i)},setDataSource:function(e,t){this._dataSource(e,t),this._sortable(),this._filterable(),this._contentTree.render([]),this.options.autoBind&&this.refresh()},setTotalParentIds:function(e){this.totalParentIds=e},_dataSource:function(e,t){var i=this.dataSource,s=this.options,a=s.isGroupListMode;if(e&&a&&e instanceof M.data.DataSource&&!t?(e=e).fetch():e&&(e=e=this.createTreeListDataSource(e)),i&&(i.unbind(c,this._refreshHandler),i.unbind("error",this._errorHandler),i.unbind(u,this._progressHandler)),this._refreshHandler=I(this.refresh,this),this._errorHandler=I(this._error,this),this._progressHandler=I(this._progress,this),i=this.dataSource=l.create(e),a){var r=this._currentExpandedModel[this.lastParentLevel];r?this.expandModel(r):this.expandModel()}i.bind(c,this._refreshHandler),s.hasCheckedModel&&i.bind(c,this._updateCheckboxEvt),i.bind("error",this._errorHandler),i.bind(u,this._progressHandler),this._dataSourceFetchProxy=I(function(){this.dataSource.fetch()},this)},setColumnWidth:function(e,t){var i,s=this.options.columns,a=s.length;for(i=0;i<a&&s[i].field!=e;i++);var r=this.element.find(".k-grid-header table colgroup"),d=this.element.find(".k-grid-content table colgroup"),o=r.find("col").eq(i);o.css("width",t),(o=d.find("col").eq(i)).css("width",t)},_updateCheckboxEvt:function(e){var t,i,s,a=e.action,r=e.items,d=e.field;if("itemchange"==a&&"checked"==d){for(i=r.length,t=0;t<i;t++)(s=r[t]).hasChildren&&this.setGroupCheckbox(s);this.setHeaderCheckbox()}},createGroupToTreeDs:function(e,t,i,s,a,r){t||(t=null),null==i&&(i=0);var d,o,n,l,h,c,u,p,g=e.length,f=[];for(d=0;d<g;d++)if(p=e[d],(l={}).field=p.field,l.value=p.value,l.aggregates=p.aggregates,l.parent_id=t,l.parent_value=r,l.id=M.guid(),l.level=i,(!this.lastParentLevel||this.lastParentLevel<i)&&(this.lastParentLevel=i),l.treeGroup=!0,f.push(l),p.hasSubgroups)n=this.createGroupToTreeDs(p.items,l.id,i+1,s,a,l.value),f=f.concat(n);else for(c=(o=p.items).length,h=0;h<c;h++)(u=o[h]).level=i+1,u.parent_id=l.id,u.id||(u.id=M.guid()),u instanceof M.data.ObservableObject&&(u=u.toJSON()),f.push(u);return f},createTreeListDataSource:function(e){var t,i=e instanceof M.data.DataSource?e.data():e,s=[{field:"foundation_space_buildings_id"},{field:"foundation_space_floors_id"},{field:"dms_devices_id"}];t=0<s.length?new M.data.Query(i).group(s).toArray():[];var a=this.createGroupToTreeDs(t),r=new M.data.TreeListDataSource({data:a,schema:{model:{id:"id",parentId:"parent_id",fields:{parent_id:{type:"string",nullable:!0}}}}});return r.read(),r},expandModel:function(e){var t,i,s=this,a=this.dataSource,r=a.flatView(),d=r.length,o=s.lastParentLevel;if(e){for(t=0;t<d;t++)if(r[t].field==e.field&&r[t].value==e.value&&r[t].parent_value==e.parent_value)return null!==r[t].parent_id&&(i=a.get(r[t].parent_id),s.expandModel(i)),s._currentExpandedModel[r[t].level]=r[t],void(r[t].expanded=!0);s.expandModel(null)}else for(t=0;t<d;t++)if(r[t].field&&r[t].treeGroup&&r[t].level==o&&s.hasChildrenInView(r[t],a))return e=r[t],null!==(s._currentExpandedModel[r[t].level]=e).parent_id&&(i=a.get(e.parent_id),s.expandModel(i)),void(r[t].expanded=!0)},hasChildrenInView:function(e,t){if(!t.filter())return!0;var i,s,a=t.view(),r=a.length;for(i=0;i<r;i++)if(a[i]===e)return!((s=i+1)<r&&a[s]&&a[s].treeGroup);return!1},getSelectedData:function(){var e=this.dataSource.data();return new M.data.Query(e).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray()},getCheckedData:function(){var e=this.dataSource.data();return new M.data.Query(e).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:!0},{field:"hasChildren",operator:"eq",value:!1}]}).toArray()},getCheckedAllData:function(){var e=this.dataSource.data();return new M.data.Query(e).filter({logic:"or",filters:[{field:"checked",operator:"eq",value:!0},{field:"hasCheckedChild",operator:"eq",value:!0}]}).toArray()},getUncheckedData:function(){var e=this.dataSource.data();return new M.data.Query(e).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:!1},{field:"hasChildren",operator:"eq",value:!1}]}).toArray()},getUncheckedAllData:function(){var e=this.dataSource.data();return new M.data.Query(e).filter({logic:"or",filters:[{field:"checked",operator:"eq",value:!1},{field:"hasCheckedChild",operator:"eq",value:!0}]}).toArray()},_setAllSelectedModel:function(e,t,i){var s,a,r=this.dataSource;if(t)if(r.pageSize()){var d=new M.data.Query(r.data()),o=r.filter();o&&(d=d.filter(o));var n=r.sort();n&&(d=d.sort(n));var l=r.group();l&&(d=d.group(l)),a=d.toArray()}else a=r.flatView();else a=r.data();i&&(i=i>=a.length?s.length:i);var h,c=i||a.length;for(h=0;h<c;h++)(s=a[h]).selected=e,(s.hasChildren||s.treeGroup)&&(s.hasCheckedChild=e);r.fetch()},selectAll:function(e,t){if(this.options.hasSelectedModel){var i=this.options.selectedLimit;!1!==i&&0!=i&&(t=i),this._setAllSelectedModel(!0,e,t)}},unselectAll:function(){this.clearSelection()},clearSelection:function(){this.selectable&&this.selectable.clear(),this.options.hasSelectedModel&&this._setAllSelectedModel(!1)},selectByData:function(e){var t,i,s,a=e.length,r=this.dataSource,d=this.options.hasSelectedModel;for(t=0;t<a;t++)i=e[t],(s=r.get(i.id))&&(d?(s.selected=!0,this.updateParentSelected(s)):this.element.find("tr[data-uid='"+s.uid+"']").addClass("k-state-selected"));d&&r.fetch()}});M.ui.plugin(p)}(window,jQuery);