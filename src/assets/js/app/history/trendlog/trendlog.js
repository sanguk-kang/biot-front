define("history/trendlog/config/trendlog-common",[],function(){var e,t=$("<div/>"),i=$("<div/>");return e=t.kendoCommonDialog().data("kendoCommonDialog"),{MSG:{TXT_SELECT_ALL:"Select All",TXT_UNSELECT_ALL:"Deselect All",TXT_CREATE_SCHEDULE:"Create New Schedule",TXT_EDIT_SCHEDULE:"Edit Schedule",TXT_DELETE_SCHEDULE:"Do you want to delete the selected Schedule?",TXT_DELETE_EXCEPTIONAL_DAY:"Do you want to delete the selected Exceptional Day?",TXT_DELETE_SCHEDULE_RESULT:"The selected Schedule has been deleted",TXT_DELETE_SCHEDULE_MULTI_RESULT:"The selected {0} Schedule has been deleted",TXT_DELETE_EXCEPTIONAL_DAY_RESULT:"The selected Exceptional Day has been deleted",TXT_DELETE_EXCEPTIONAL_DAY_MULTI_RESULT:"The selected {0} Exceptional Day has been deleted",TXT_CREATE_SCHEDULE_CONFIRM:"Do you want to Create schedule?",TXT_CANCEL_SCHEDULE_CONFIRM:"Do you want to cancel changes?",TXT_CREATE_SCHEDULE_RESULT:"Saved.",TXT_DELETED:"Deleted."},createNewWidget:function(e,t,i){return new t($("<div/>").attr("id",e),i)},confirmDialog:i.kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog"),msgDialog:e}}),define("history/trendlog/config/trendlog-template",[],function(){function o(e){var t,i,o=e.devices,n=3;if(e.activated){if(o&&0<o.length){var d,a=o.length;for(i=t=!1,d=0;d<a;d++)-1!=o[d].dms_devices_type.indexOf("AirConditioner")&&(t=!0),-1!=o[d].dms_devices_type.indexOf("Light")&&(i=!0)}n=t&&i?2:t?0:i?1:3}else n=4;var r=l[n],s={type:n};return r&&(s.text=r.displayText,s.className=r.className),s}function n(e){var t="",i=o(e);return i.className&&(t=i.className),t}var i=window.Util,l=(window.I18N,[{className:"indoor",displayText:"SAC Indoor"},{className:"light",displayText:"Light"},{className:"indoorlight",displayText:"SAC Indoor + Light"},{className:"others",displayText:"Others"},{className:"pause",displayText:"Pause"}]),t=function(e){e.name=e.name||e.title,e.title=e.name;var t=e.name;return"<span class='td-padding-left'>"+i.decodeHtml(t)+"</span>"};return{scheduleDetailListTemplate:function(e){return t(e)},scheduleDetailNameTemplate:t,executionTimeListTemplate:function(e){var t,i="-",o=e.executionTimes,n=o.length;return 0<n&&(i=t=(t=(t=o[0]).split(":"))[0]+":"+t[1],1<n&&(i+=" (+"+(n-1)+")")),e.times=i},getEventTemplateClass:n,checkboxCellTemplate:function(e){var t=n(e),i=e.uid;return'<div class="schedule-checkbox-cell '+t+'"><span class="checkbox-wrapper"><input type="checkbox" data-id='+e.id+' id="check_'+i+'" class="k-checkbox" '+(e.checked?"checked":"")+'/><label for="check_'+i+'" class="k-checkbox-label"></label></span></div>'},getEventTemplateType:o,trendLogDetailListTemplate:function(e){return t(e)}}}),define("history/trendlog/trendlog-util",function(){"use strict";var n=window.I18N,d=window.moment;function a(e){var t;return{type:{D:"day",H:"hour",M:"minutes"}[e[e.length-1]],value:(t=e.replace(/[^0-9]/g,""),Number(t))}}return{intervalToString:function(e,t){var i;if(-1!=t.indexOf("M"))return i=e.minutes(),n.prop("FACILITY_TRENDLOG_PERIOD_MINUTE",i);if(-1==t.indexOf("H"))return t.indexOf("D")?(i=e.days(),n.prop("FACILITY_TRENDLOG_PERIOD_DAY",i)):"-";i=e.hours();var o=e.days();return 0==i&&1==o?n.prop("FACILITY_TRENDLOG_PERIOD_HOUR",24):n.prop("FACILITY_TRENDLOG_PERIOD_HOUR",i)},dataInspection:function(e,t,i){var o=a(i),n=d(e).subtract(1e3*o.value,o.type);return d(n).isBefore(t,"minute")}}}),define("history/trendlog/trendlog-model",function(){"use strict";function l(e,t){u=[{type:"circle",cx:59,cy:12,r:6},{type:"polygon",points:[{x:53,y:16},{x:59,y:4},{x:65,y:16}]},{type:"rect",x:54,y:6,width:10,height:10},{type:"polygon",points:[{x:53,y:11},{x:59,y:5},{x:65,y:11},{x:59,y:17}]},{type:"polygon",points:[{x:54,y:8},{x:59,y:5},{x:64,y:8},{x:64,y:14},{x:59,y:17},{x:54,y:14}]},{type:"polygon",points:f(59,12,5,8,4),transform:"rotate(-16,55,10)"},{type:"polygon",points:[{x:52,y:9},{x:59,y:3},{x:66,y:9},{x:63,y:17},{x:55,y:17}]},{type:"polygon",points:[{x:53,y:5},{x:59,y:17},{x:65,y:5}]},{type:"polygon",points:f(59,12,4,8,3),transform:"rotate(-44,58,12)"},{type:"polygon",points:f(59,12,3,8,2),transform:"rotate(-90, 58, 12)"},{type:"polygon",points:[{x:62,y:5},{x:54,y:5},{x:51,y:13},{x:58,y:19},{x:65,y:13}]},{type:"polygon",points:f(59,12,6,8,3),transform:"rotate(-90, 58, 12)"}];var i="svg-appender-"+e+"-"+t,o=$("#"+i);$("<div/>").addClass("lines").appendTo(o);var n,d,a,r,s=c.select("#"+i+" .lines");d=g[e],(r=v[t])&&(n=T({selector:s,width:118,height:24,lineWidth:2,lineColor:d,dashType:r})),(a=u[t])&&y({selector:n,shape:a,lineColor:d,shapeColor:d,lineWidth:0})}var d,r,e,c=window.d3,_=window.kendo,p=window.I18N,n=window.Util,v=[[0,0],[25,5],[40,8],[12,6],[6,4],[2,4],[10,4,2,4],[8,4,4,4],[8,4,8,4,23,4],[3,4,25,4],[4,10,15,10],[2,3,2,3,30,2]],u=[],g=["#2c81db","#08b5d4","#68ba11","#feac5a","#f0824f","#eb5b6c","#33cc00","#99cc99","#3300cc","#9900cc","#ff3366","#cc9900"],m=function(e){for(var t,i=0;i<d.length;++i){var o=d[i].list,n=d[i].properties;if(o)for(t=0;t<o.length;++t)if(e==o[t].key)return o[t].name;if(n)for(t=0;t<n.length;++t)if(e==n[t].key)return n[t].name}return""},f=function(e,t,i,o,n){for(var d,a=[],r=Math.PI/i,s=0;s<2*i;s++){var l=0==(1&s)?o:n;d={x:e+Math.cos(s*r)*l,y:t+Math.sin(s*r)*l},a.push(d)}return a},h=c.line().x(function(e){return e.x}).y(function(e){return e.y}).curve(c.curveLinear),T=function(e){var t=e.selector,i=e.width,o=e.height,n=e.lineColor,d=e.lineWidth,a=e.dashType,r=o/2-d/2,s=[{x:0,y:r},{x:i,y:r}],l=t.append("svg").classed("svg-line-legends",!0).attr("width",i).attr("height",o);return l.append("path").attr("d",h(s)).attr("stroke",n).attr("stroke-width",d).attr("stroke-dasharray",a.join(",")).attr("fill","none"),l},y=function(e){var t,i=e.selector,o=e.shape,n=e.lineWidth,d=e.lineColor,a=e.shapeColor,r=o.type,s=o.transform;if("circle"==r){var l=o.cx,c=o.cy,p=o.r;t=i.append("circle").attr("cx",l).attr("cy",c).attr("r",p).attr("stroke",d).attr("stroke-width",n).attr("fill",a)}else if("rect"==r){var v=o.x,u=o.y,g=o.width,_=o.height;t=i.append("rect").attr("x",v).attr("y",u).attr("width",g).attr("height",_).attr("stroke",d).attr("stroke-width",n).attr("fill",a)}else{var m=o.points;m=m.map(function(e){return[e.x,e.y].join(",")}).join(" "),t=i.append("polygon").attr("points",m).attr("stroke",d).attr("stroke-width",n).attr("fill",a)}return s&&t.attr("transform",s),t},o=function(e){var t=e.j,i=e.rect,o=e.shapeColor,n=_.drawing,d=_.geometry,a=i.center(),r=a.x,s=a.y-10,l=[{type:"circle",cx:r,cy:10+s,r:6},{type:"polygon",points:[{x:r-6,y:16+s},{x:r,y:4+s},{x:r+6,y:16+s}]},{type:"rect",x:r-5,y:5+s,width:10,height:10},{type:"polygon",points:[{x:r-6,y:11+s},{x:r,y:5+s},{x:r+6,y:11+s},{x:r,y:17+s}]},{type:"polygon",points:[{x:r-5,y:s-4+11},{x:r,y:s-7+11},{x:r+5,y:s-4+11},{x:r+5,y:12+s},{x:r,y:15+s},{x:r-5,y:12+s}]},{type:"polygon",points:f(r,10+s,5,8,4),transform:-16},{type:"polygon",points:[{x:r-7,y:s-3+11},{x:r,y:s-9+11},{x:r+7,y:s-3+11},{x:r+4,y:5+s+11},{x:r-4,y:5+s+11}]},{type:"polygon",points:[{x:r-6,y:5+s},{x:r,y:17+s},{x:r+6,y:5+s}]},{type:"polygon",points:f(r,16+s,4,8,3),transform:-44},{type:"polygon",points:f(r-8,s,3,8,2),transform:-90},{type:"polygon",points:[{x:r+3,y:s-7+10},{x:r-5,y:s-7+10},{x:r-8,y:1+s+10},{x:r-1,y:7+s+10},{x:r+6,y:1+s+10}]},{type:"polygon",points:f(r-10,s,6,8,3),transform:-90}][t],c=l.type,p=l.transform;if("circle"==c)return new n.Circle(new d.Circle([l.cx,l.cy],l.r),{fill:{color:o},stroke:{color:o}});if("rect"==c)return new n.Path.fromRect(new d.Rect(new d.Point(l.x,l.y),new d.Size(l.width,l.height)),{fill:{color:o},stroke:{color:o}});for(var v=l.points,u=new n.Path({fill:{color:o},stroke:{color:o}}),g=0;g<v.length;++g)0==g&&u.moveTo(v[g].x,v[g].y),u.lineTo(v[g].x,v[g].y);return u.close(),p&&u.transform(d.transform().rotate(p,[i.origin.x,i.origin.y])),u},t=[],i=[],a=[],s=59;for(e=1;e<=s;e++)t.push({text:e,value:e,selectable:!0});for(s=23,e=1;e<=s;e++)i.push({text:e,value:e,selectable:!0});for(s=30,e=1;e<=s;e++)a.push({text:e,value:e,selectable:!0});return{createDetailModel:function(e,t){for(var i="",o=t.devices,n=0;n<o.length;++n){i+="<li class='opened trendlog-collapse' style='border-bottom-width:2px;border-bottom-style:solid;border-bottom-color:rgb(222, 222, 222);padding-bottom:15px;'><a class='subjectBox'><div class='blank'></div><div class='name'>"+o[n].dms_devices_name+"</div><div class='added'><span id='trendlog-expander' class='k-icon t-i-expand'></span></div></a><div class='dvcList' style='display: block;'><div class='subjectBox'><div class='icon' style='padding-right:40px;'>"+p.prop("FACILITY_TRENDLOG_PROPERTY")+"</div><div class='name'>";for(var d=0;d<o[n].dms_trendLogs_properties_list_keys.length;++d)0!=d&&(i+=", "),i+=m(o[n].dms_trendLogs_properties_list_keys[d]);i+="</div></div></div></li>"}e.append(i)},getPropertiesNameByKey:m,setPropertiesModel:function(e){d=e},createMultiDetailModel:function(e,t){for(var i="",o=0;o<t.length;++o){for(var n=0,d=0;d<t[o].devices.length;++d)n+=t[o].devices[d].dms_trendLogs_properties_list_keys.length;i+="<li class='opened trendlog-collapse' style='border-bottom-width:2px;border-bottom-style:solid;border-bottom-color:rgb(222, 222, 222);padding-bottom:15px;'><a class='subjectBox'><div id='trendlog-details-name' class='name'>"+t[o].name+"</div><div id='trendlog-details-status' class='status'>"+(t[o].enabled?"Operating":"Pause")+"</div><div class='added'><button type='button' data-id='"+t[o].id+"' class='trendlog-details-icon commonBtn icOnly ic "+(t[o].enabled?"ic-action-play":"ic-action-pause")+"'></button></div><div class='added'><span id='trendlog-expander' class='k-icon t-i-expand'></span></div></a><div class='dvcList' style='display: block;'><div><div class='popScroller mCustomScrollbar _mCS_6 mCS-autoHide mCS_no_scrollbar'><div id='mCSB_6' class='mCustomScrollBox mCS-light mCSB_vertical mCSB_inside' tabindex='0' style='max-height: none;'><div id='mCSB_6_container' class='mCSB_container mCS_y_hidden mCS_no_scrollbar_y' style='position:relative; top:0; left:0;' dir='ltr'><div class='detailBox'><ul class='statusList'><li><div class='name btxt' style='width:210px;'>Last update</div><div id='trendlog-details-lastupdate' class='detail' style='width:210px;'></div></li><li><div class='name btxt' style='width:210px;'>Log interval</div><div id='trendlog-details-loginterval' class='detail' style='width:210px;'></div></li><li style='padding-bottom:0px;'><div class='name btxt' style='width:210px;vertical-align:top;'>Logging property</div><div id='trendlog-details-total' class='detail' style='border-bottom-width: 2px;border-bottom-style: solid;border-bottom-color:rgb(222, 222, 222);padding-bottom:15px;'>Total ("+n+")</div></li><li class='dvc' style='padding-top:0px;'><div class='name btxt' style='width:210px;vertical-align:top;'></div><div class='detail' style='vertical-align:top;'><ul id='trendlog-details-ul' class='dvcDetailList'>";for(var a=t[o].devices,r=0;r<a.length;++r){i+="<li class='opened trendlog-collapse-child' style='border-bottom-width:2px;border-bottom-style:solid;border-bottom-color:rgb(222, 222, 222);padding-bottom:15px;'><a class='subjectBox'><div class='blank'></div><div class='name'>"+a[r].dms_devices_name+"</div><div class='added'><span id='trendlog-expander-child' class='k-icon t-i-expand'></span></div></a><div class='dvcList-child' style='display: block;'><div class='subjectBox'><div class='icon' style='padding-right:40px;'>Property</div><div class='name'>";for(var s=0;s<a[r].dms_trendLogs_properties_list_keys.length;++s)0!=s&&(i+=", "),i+=m(a[r].dms_trendLogs_properties_list_keys[s]);i+="</div></div></div></li>"}i+="</ul></div></li></ul></div></div></div></div></div></div></li>"}e.append(i)},createHistoryPanelNameModel:function(e,t){var i="";e.empty();for(var o=0;o<t.length;++o)i+="<li><span class='disc' style='background-color:"+g[o]+"'></span>"+t[o].dms_devices_name+"</li>";e.append(i)},createHistoryPanelPropertyModel:function(e,t,i){var o,n,d="";e.empty(),i=[];for(var a=0;a<t.length;++a)for(var r=0;r<t[a].dms_trendLogs_properties_list_keys.length;++r){n=m(t[a].dms_trendLogs_properties_list_keys[r]),n=p.prop("FACILITY_TRENDLOG_PROPERTY_"+n.toUpperCase())||n,d="<li><span class='checkLabel'><input type='checkbox' checked='checked' data-dms_devices_id='"+(o=t[a].dms_devices_id)+"' data-dms_trendLogs_properties_list_key='"+t[a].dms_trendLogs_properties_list_keys[r]+"' id='"+o+"_"+n+"' class='k-checkbox checkbox history-checkbox'><label class='k-checkbox-label' for='"+o+"_"+n+"' style='padding-left:22px;'>"+n+"</label></span><div class='lineVisual' id='svg-appender-"+a+"-"+r+"'></div></li>",e.append(d),l(a,r);var s={};s.dms_devices_id=t[a].dms_devices_id,s.dms_property_name=t[a].dms_trendLogs_properties_list_keys[r],s.i=a,s.j=r,s.color=g[a],s.shape=u[r],i.push(s)}return i},appendMarker:function(e,t,i){if(0==t||t)return o({j:t,rect:i,lineColor:e,shapeColor:e,lineWidth:0})},getPropertiesUnitByKey:function(e){for(var t,i=0;i<d.length;++i){var o=d[i].list,n=d[i].properties;if(o)for(t=0;t<o.length;++t)if(e==o[t].key)return o[t].unit;if(n)for(t=0;t<n.length;++t)if(e==n[t].key)return n[t].unit}return""},setScalesModel:function(e){r=e},getCalculatedValue:function(e,t){for(var i,o,n=0;n<r.length;++n)if(r[n].unit==t){var d=r[n].maximumValue,a=r[n].minimumValue;return a=a||r[n].minimunValue,"string"==typeof e&&(e=Number(e)),o=d-a,0!=(i=e-a)&&0!=o?i/o*100:0}return 0},unitModel:{Celsius:"\u2103",Percent:"%",KilowattHour:"KW/h",Liter:"L",CubicMeter:"\u33a5",Kilocalorie:"kcal",NotDefined:"",Minute:"m",Hertz:"hz",Fahrenheit:"\xb0F"},minPeriodDataSource:t,hourPeriodDataSource:i,dayPeriodDataSource:a,getPropertyValue:function(e,t){var i,o;return"string"!=typeof t?"-":(o=t.toUpperCase(),-1!=e.indexOf("fan_speed")?i=p.prop("FACILITY_INDOOR_CONTROL_"+o):-1!=e.indexOf("sac_indoor:")||-1!=e.indexOf("sac_outdoor:")?i=!0===t||"true"===t?p.prop("FACILITY_DEVICE_STATUS_ON"):!1===t||"false"===t?p.prop("FACILITY_DEVICE_STATUS_OFF"):p.prop("FACILITY_INDOOR_MODE_"+o):"device:status"==e?i=p.prop("FACILITY_DEVICE_STATUS_"+o):"light:power"==e!=-1?!0===t||"true"===t?i=p.prop("FACILITY_DEVICE_STATUS_ON"):!1!==t&&"false"!==t||(i=p.prop("FACILITY_DEVICE_STATUS_OFF")):"device_sensor_motion:detected"==e&&(!0===t||"true"===t?i=p.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"):!1!==t&&"false"!==t||(i=p.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE"))),t=n.convertNumberFormat(t),i||t)}}}),define("history/trendlog/viewmodel/trendlog-vm",[],function(){var e,t,i=window.kendo,o=window.I18N,n=window.Util,d=[{text:o.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR"),value:"AirConditioner."},{text:o.prop("FACILITY_DEVICE_TYPE_SAC_OUTDOOR"),value:"AirConditionerOutdoor"},{text:o.prop("FACILITY_DEVICE_TYPE_LIGHT"),value:"Light"},{text:o.prop("FACILITY_DEVICE_TYPE_TEMPERATURE_SENSOR"),value:"Sensor.Temperature"},{text:o.prop("FACILITY_DEVICE_TYPE_HUMIDITY_SENSOR"),value:"Sensor.Humidity"},{text:o.prop("FACILITY_DEVICE_TYPE_MOTION_SENSOR"),value:"Sensor.Motion"},{text:o.prop("FACILITY_DEVICE_TYPE_POINT"),value:"ControlPoint"}];for(e=d.length-1;0<=e;e--)t=(t=d[e]).value,n.isInstalledType(t,!0)||d.splice(e,1);return{MainViewModel:i.observable({searchField:{invisible:!1,value:"",click:function(){},keydown:function(){}},actions:[{type:"template",id:"spanSelectedCount",template:"<span class='text-view'><span data-bind='text: options.selectedNum, attr: { id : id }'></span></span>",options:{selectedNum:o.prop("COMMON_SELECTED")+" : 0"}},{type:"button",id:"trendlog-create-btn",text:o.prop("COMMON_BTN_CREATE"),invisible:!1,disabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"trendlog-delete-btn",text:o.prop("COMMON_BTN_DELETE"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"trendlog-detail-btn",text:o.prop("COMMON_BTN_DETAIL"),invisible:!1,disabled:!0,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}}],category:{invisible:!0,selected:{num:0,active:!1,click:function(){}},all:{num:0,text:"All",active:!1,click:function(){}},group:{num:0,invisible:!0,active:!1,click:function(){}}}}),Views:{list:{routeUrl:"/list",view:null,widget:null,show:null},search:{routeUrl:"/search",view:null,widget:null,show:null,name:"Search Results"}},typeFilterDataSource:d,typeQuery:["AirConditioner.*","AirConditionerOutdoor","ControlPoint.*","Sensor.*","Light"],excelExpotViewModel:i.observable({actions:[{type:"button",id:"history-view-btn",text:o.prop("COMMON_BTN_VIEW"),options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}},{type:"button",id:"trendlog-excel-export",text:o.prop("COMMON_BTN_EXPORT"),isEnabled:!1,options:{click:function(){},dbclick:function(){},mouseover:function(){},mouseout:function(){}}}]})}}),define("history/trendlog/config/popup-config",["history/trendlog/config/trendlog-template","history/trendlog/trendlog-util","history/trendlog/trendlog-model"],function(e,o,r){var s=window.I18N,n=window.Util,d=window.moment,t=$("<div/>").kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog"),i=$("#popup-create-trendlog"),a=$("#popup-add-trendlog"),l=$("#popup-detail-single-trendlog"),c=$("#popup-detail-multi-trendlog"),p=$("#popup-history-single-trendlog"),v=$("#trendlog-detail-popup"),u={id:"id",fields:{}},g={title:s.prop("FACILITY_TRENDLOG_CREATE_NEW_TRENDLOG"),width:1260,height:800,isOnlyMulti:!1,buttonsIndex:{CLOSE:0,SAVE:1,EDITSAVE:2},headerTemplate:"",contentTemplate:"<div class='detail-dialog-content'><div id='trendlog-trendlogname-box' class='trendlog-create-header'><div class='tbc' style='width:210px;'><span class='btxt textBlock'>"+s.prop("FACILITY_TRENDLOG_NAME")+"</span></div><div class='tbc'><div class='blockFrm'><input type='text' style='color:black;' id='trendlog-name-input' editmode='hide' class='popup-input k-input common-validator textInput' data-role='commonvalidator'></div></div></div><div id='trendlog-loginterval-box' class='trendlog-create-header trendlog-edit-box'><div id='log-interval-wrapper' style='width:210px; float:left;'><span class='btxt textBlock'>"+s.prop("FACILITY_TRENDLOG_LOG_INTERVAL")+"</span></div><div class='dropdownwrapper' style='display:table;float:left;margin-top:10px;margin-right:8px;width:100px;'><input id='trendlog-number-dropdown' type='text' data-event='numberdrop' data-role='dropdownlist' style='display:none;'></div><div class='dropdownwrapper' style='display:table;margin-top:10px;'><input id='trendlog-period-dropdown' type='text' data-event='perioddrop' data-role='dropdownlist' style='display:none;'></div></div><div id='trendlog-loginterval-box' class='trendlog-create-header trendlog-edit-box' style='border-bottom:none;'><span class='btxt textBlock'>"+s.prop("FACILITY_TRENDLOG_LOGGING_PROPERTY")+"</span></div><div class='blank10'></div><div class='top-block-box trendlog-edit-box' style='height:75px;'><div id='trendlog-create-grid-count' class='subject btxt textBlock' style='float:left;'>"+s.prop("COMMON_TOTAL")+" (0)</div><div class='listBtns' style='float:right;'><span style='margin-right:20px;color:#0081c6;font-size:14px;font-weight:600;'>("+s.prop("FACILITY_TRENDLOG_TOTAL_NUMBER_OF_LOGGING_PROPERTY")+") \u2264 12</span><button id='trendlog-create-add-btn' class='k-button' style='width:79px;margin-right:10px;'>"+s.prop("COMMON_BTN_ADD")+"</button><button id='trendlog-create-delete-btn' class='k-button' style='width:79px;margin-right:10px;'>"+s.prop("COMMON_BTN_DELETE")+"</button></div></div><div id='trendlog-create-grid-elem' class='trendlog-edit-box'></div></div>",isCustomActions:!0,actions:[{text:s.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){return e.sender.trigger("onClose"),!1}},{text:s.prop("COMMON_BTN_SAVE"),visible:!0,action:function(e){return e.sender.trigger("onSave",{sender:e.sender}),!1}},{text:s.prop("COMMON_BTN_SAVE"),visible:!0,action:function(e){return e.sender.trigger("onEditSave",{sender:e.sender}),!1}}],onTypeChange:function(e){var t=e.sender.BTN,i=e.sender;i.setActions(t.CLOSE,{disabled:!1}),i.setActions(t.SAVE,{disabled:!1})},scheme:u},_={title:s.prop("FACILITY_TRENDLOG_ADD_PROPERTY"),width:554,height:820,isOnlyMulti:!1,buttonsIndex:{CLOSE:0,PREV:1,NEXT:2,SAVE:3,EDITSAVE:4},headerTemplate:"",contentTemplate:"<div id='trendlog-device-panel' class='detail-dialog-content'><div id='trendlog-trendlogname-box' class='trendlog-create-header'><div class='tbc' style='width:210px;'><span id='trendlog-add-device-cnt' class='btxt textBlock'>"+s.prop("COMMON_SELECTED")+" : 0</span></div></div><div id='trendlog-loginterval-box' style='border-bottom:none;' class='trendlog-create-header'><div id='log-interval-wrapper'><input type='text' data-event='typedrop' data-role='dropdownlist' style='display:none;'></div></div><div class='search-box' style='width:100%;' data-bind='invisible: searchField.invibisible'><input id='trendlog-add-input' type='text' class='k-textbox' placeholder='"+s.prop("COMMON_ENTER_SEARCH_TERMS")+"'/><button id='trendlog-add-search-btn' class='search-btn ic ic-bt-input-search'>"+s.prop("COMMON_BTN_SEARCH")+"</button></div><div id='trendlog-device-grid-elem' style='margin-top:10px;'></div></div><div id='trendlog-property-panel' class='detail-dialog-content'><div id='trendlog-trendlogname-box' class='trendlog-create-header'><div class='tbc' style='width:210px;'><span id='trendlog-add-property-cnt' class='btxt textBlock'>"+s.prop("COMMON_SELECTED")+" : 0</span></div></div><div id='trendlog-loginterval-box' style='border-bottom:none;' class='trendlog-create-header'><div id='log-interval-wrapper'><input type='text' data-event='typedropcopy' data-role='dropdownlist' style='display:none;'></div></div><div class='search-box' style='width:100%;' data-bind='invisible: searchField.invibisible'><input id='trendlog-property-input' type='text' class='k-textbox' placeholder='"+s.prop("COMMON_ENTER_SEARCH_TERMS")+"'/><button id='trendlog-property-search-btn' class='search-btn ic ic-bt-input-search'>"+s.prop("COMMON_BTN_SEARCH")+"</button></div><div id='trendlog-property-grid-elem' style='margin-top:10px;overflow:auto;'></div></div>",isCustomActions:!0,actions:[{text:s.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed");var t=e.sender.BTN;e.sender.setActions(t.NEXT,{visible:!0}),e.sender.setActions(t.NEXT,{disabled:!0}),e.sender.setActions(t.PREV,{disabled:!0}),e.sender.setActions(t.SAVE,{visible:!1}),$("#trendlog-device-panel").show(),$("#trendlog-property-panel").hide()}},{text:s.prop("COMMON_BTN_PREV"),visible:!0,disabled:!0,action:function(e){var t=e.sender.BTN;return e.sender.setActions(t.NEXT,{visible:!0}),e.sender.setActions(t.PREV,{disabled:!0}),e.sender.setActions(t.SAVE,{visible:!1}),e.sender.trigger("onPrev"),!1}},{text:s.prop("COMMON_BTN_NEXT"),visible:!0,disabled:!0,action:function(e){var t=e.sender.BTN;return e.sender.setActions(t.NEXT,{visible:!1}),e.sender.setActions(t.SAVE,{visible:!0}),e.sender.setActions(t.PREV,{disabled:!1}),e.sender.trigger("onNext"),!1}},{text:s.prop("COMMON_BTN_SAVE"),id:"trendlog-add-save-btn",visible:!1,disabled:!0,action:function(e){var t=e.sender.BTN,i=$("#trendlog-device-grid-elem").data("kendoDeviceTabGroupGrid"),o=$("#trendlog-property-grid-elem").data("kendoGrid"),n=i.getSelectedData(),d=o.getCheckedData();return e.sender.trigger("onSave",{checkedDeviceData:n,checkedPropertyData:d}),e.sender.close(),e.sender.setActions(t.NEXT,{disabled:!0}),!1}},{text:s.prop("COMMON_BTN_SAVE"),id:"trendlog-add-editsave-btn",visible:!1,disabled:!0,action:function(e){var t=e.sender.BTN,i=$("#trendlog-property-grid-elem").data("kendoGrid").getCheckedData(),o=e.sender.dataSource._data[0];return e.sender.trigger("onEditSave",{originalData:o,checkedPropertyData:i}),e.sender.setActions(t.NEXT,{disabled:!0}),!1}}],onTypeChange:function(e){var t=e.type,i=e.sender.BTN,o=e.sender;"edit"==t?(o.setActions(i.PREV,{visible:!1}),o.setActions(i.NEXT,{visible:!1}),o.setActions(i.SAVE,{visible:!1}),o.setActions(i.SAVE,{disabled:!0}),o.setActions(i.EDITSAVE,{visible:!0}),o.setActions(i.EDITSAVE,{disabled:!0})):"create"==t&&(o.setActions(i.PREV,{visible:!0}),o.setActions(i.NEXT,{visible:!0}),o.setActions(i.SAVE,{visible:!1}),o.setActions(i.SAVE,{disabled:!0}),o.setActions(i.EDITSAVE,{visible:!1}),o.setActions(i.EDITSAVE,{disabled:!0}))},close:function(e){var t=e.sender.BTN;e.sender.setActions(t.NEXT,{visible:!0}),e.sender.setActions(t.PREV,{disabled:!0}),e.sender.setActions(t.SAVE,{visible:!1}),$("#trendlog-device-panel").show(),$("#trendlog-property-panel").hide()},scheme:u},m={title:s.prop("FACILITY_HISTORY_DETAIL"),width:652,height:690,isOnlyMulti:!1,buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2},headerTemplate:"",contentTemplate:"<div id='trendlog-detail-single-panel' class='detail-dialog-content' style='overflow:auto;height:530px;'><div class='popBody'><div class='subjectBox'><div id='trendlog-details-name' class='name'>Trend log name 1</div><div id='trendlog-details-status' class='status'>Operating</div><div class='added'><button type='button' id='trendlog-details-icon' class='commonBtn icOnly ic ic-action-pause'></button></div></div><div class='popScroller mCustomScrollbar _mCS_6 mCS-autoHide mCS_no_scrollbar'><div id='mCSB_6' class='mCustomScrollBox mCS-light mCSB_vertical mCSB_inside' tabindex='0' style='max-height: none;'><div id='mCSB_6_container' class='mCSB_container mCS_y_hidden mCS_no_scrollbar_y' style='position:relative; top:0; left:0;' dir='ltr'><div class='detailBox'><ul class='statusList'><li><div class='name btxt' style='width:210px;'>"+s.prop("FACILITY_TRENDLOG_LAST_UPDATE")+"</div><div id='trendlog-details-lastupdate' class='detail' style='width:210px;'></div></li><li><div class='name btxt' style='width:210px;'>"+s.prop("FACILITY_TRENDLOG_LOG_INTERVAL")+"</div><div id='trendlog-details-loginterval' class='detail' style='width:210px;'></div></li><li style='padding-bottom:0px;'><div class='name btxt' style='width:210px;vertical-align:top;'>"+s.prop("FACILITY_TRENDLOG_LOGGING_PROPERTY")+"</div><div id='trendlog-details-total' class='detail' style='border-bottom-width: 2px;border-bottom-style: solid;border-bottom-color:rgb(222, 222, 222);padding-bottom:15px;'>"+s.prop("COMMON_TOTAL")+" (0)</div></li><li class='dvc' style='padding-top:0px;'><div class='name btxt' style='width:210px;vertical-align:top;'></div><div class='detail' style='vertical-align:top;'><ul id='trendlog-details-ul' class='dvcDetailList'></ul></div></li></ul></div></div></div></div></div></div>",isCustomActions:!0,actions:[{text:s.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}},{text:s.prop("COMMON_BTN_DELETE"),visible:!0,disabled:!1,action:function(e){return t.message(s.prop("FACILITY_TRENDLOG_CHECK_DELETE_TRENDLOG")),t.setConfirmActions({yes:function(){e.sender.trigger("onDelete",{e:e})}}),t.open(),!1}},{text:s.prop("COMMON_BTN_EDIT"),visible:!0,disabled:!1,action:function(e){return e.sender.trigger("onEdit",{e:e}),$("#trendlog-device-panel").hide(),$("#trendlog-property-panel").show(),!1}}],onTypeChange:function(e){},close:function(e){var t=e.sender.BTN;e.sender.setActions(t.EDIT,{disabled:!0})},scheme:u},f={title:"Details",width:652,height:690,isOnlyMulti:!0,buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2},headerTemplate:"",contentTemplate:"<div class='detail-dialog-content'><div class='subjectBox'><div id='trendlog-details-cnt' class='name' style='border-bottom-width: 2px;border-bottom-style: solid;border-bottom-color: rgb(222, 222, 222);' >Selected : 1</div></div><ul id='trendlog-detail-multi-panel' style='overflow:auto;height:490px;'></ul></div>",isCustomActions:!0,actions:[{text:s.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}}],onTypeChange:function(e){},close:function(e){var t=e.sender.BTN;e.sender.setActions(t.EDIT,{disabled:!0})},scheme:u},h={title:s.prop("FACILITY_TRENDLOG_TRENDLOG_HISTORY"),width:1294,height:900,isOnlyMulti:!0,buttonsIndex:{CLOSE:0},headerTemplate:"",contentTemplate:"<div id='trendlog-history-single-panel' class='detail-dialog-content' style='overflow:auto;height:770px;'><div class='popBody'><div class='subjectBox'><div id='trendlog-history-name' class='name'>Trend log name 1</div></div><div class='historyHead'><div class='subject' style='height:40px;'>"+s.prop("FACILITY_TRENDLOG_HISTORY_OPTION")+"</div></div><div class='historyHead graphHeadBox'><ul><li class='opened trendlog-collapse' style='border-bottom-width:2px;border-bottom-style:solid;border-bottom-color:rgb(222, 222, 222);padding-bottom:15px;'><div class='tb'><div class='tbc title' style='width:193px;'>"+s.prop("FACILITY_HISTORY_PERIOD")+"</div><div class='tbc'><div class='dateFrm'><label>"+s.prop("FACILITY_SCHEDULE_START_DATE")+"</label><div class='blockFrm date' ><input id='trendlog-start-datepicker' data-role='commondatepicker' type='text'><a href='#' class='btCalendar'></a></div><div class='blockFrm time' style='margin-left:50px;'><input id='trendlog-start-timepicker' data-role='commontimepicker' type='text'><a href='#' class='btClock'></a></div></div></div><div class='tbc'><div class='dateFrm'><label>"+s.prop("FACILITY_SCHEDULE_END_DATE")+"</label><div class='blockFrm date'><input id='trendlog-end-datepicker' data-role='commondatepicker' type='text'><a href='#' class='btCalendar'></a></div><div class='blockFrm time' style='margin-left:50px;'><input id='trendlog-end-timepicker' data-role='commontimepicker' type='text'><a href='#' class='btClock'></a></div></div></div><div data-template='excelexport-action-filter-template' data-bind='source:actions'></div><div class='added'><span id='trendlog-expander' class='k-icon t-i-collapse'></span></div></div></li></ul></div><div class='detailBox graphHeadBox' id='trendlog-history-propertybox'><div class='historyHead'><div class='logHistoryLabelBox'><div class='graphTitle'>"+s.prop("FACILITY_TRENDLOG_LOGGING_PROPERTY")+"</div><div class='graphColor'><ul id='trendlog-history-name-ul'></ul></div><div class='graphLine'><ul id='trendlog-history-property-ul'></ul></div><div class='blanktbc'></div></div></div></div><div class='historyHead listHeadBox' style='height: 120px;border-bottom: none;display:none;'><div class='tb' style='height:60px;'><div class='tbc' style='width:50%'><span class='titletext'>"+s.prop("FACILITY_TRENDLOG_PERIOD")+"</span><span id='trendlog-history-list-period' class='detail'>2016-07-01</span></div><div class='tbc'><span class='titletext'>"+s.prop("FACILITY_TRENDLOG_LOGGING_PROPERTY")+"</span><span id='trendlog-history-properties-cnt' class='detail'>12 Properties</span></div><div class='tbc arr'></div></div></div><div id='trendlogBtnGroups' style='display:none;height: 60px;border-top: 1px solid #d6d6d6;margin-top: 20px;'><div class='top-block-box'><div class='trendlogBtns'><span class='chart-sub-desc'>"+s.prop("FACILITY_TRENDLOG_POPUP_NOT_DISPLAY_CHAR_ATTRIBUTE_GRAPH")+"</span><ul class=''><li><button id='trendlog-history-list' class='ic ic-view-list'></button></li><li><button id='trendlog-history-graph' class='ic ic-view-graph active'></button></li></ul></div></div></div><div class='graphHeadBox'><div id='trendlog-history-chart'></div></div><div class='listHeadBox'><div id='trendlog-history-grid-elem'></div></div></div></div>",isCustomActions:!0,actions:[{text:s.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose"),e.sender.trigger("onClosed")}}],onTypeChange:function(e){},close:function(e){},scheme:u},T={id:"id",fields:{name:{type:"text",name:s.prop("COMMON_NAME"),editable:!0,validator:{type:"name",required:!0},hasInputRemoveBtn:!0,editCss:{width:"100%"}},updatedTime:{type:"text",name:s.prop("FACILITY_TRENDLOG_LAST_UPDATE"),template:function(e){var t="-";return e.updatedTime&&(t=e.updatedTime,t=d(t).format("LLL").replace(/\./g,"-")),t}},interval:{type:"text",name:s.prop("FACILITY_TRENDLOG_LOG_INTERVAL"),template:function(e){var t="-";if(e.originalInterval){var i=e.originalInterval;t=o.intervalToString(d.duration(i),i)}return t}},devices:{type:"grid",name:s.prop("FACILITY_TRENDLOG_LOGGING_PROPERTY"),gridDataSource:function(e){return e.devices},gridOptions:$.extend({},{height:"100%",scrollable:!0,sortable:!1,filterable:!1,pageable:!1},{hideHeader:!0,columns:[{field:"dms_devices_name",template:function(e){var t="-";if(e.dms_trendLogs_properties_list_keys){var i,o,n=e.dms_trendLogs_properties_list_keys,d=n.length,a="";for(i=0;i<d;i++)o=(o=r.getPropertiesNameByKey(n[i]))||"-",a+=o=s.prop("FACILITY_TRENDLOG_PROPERTY_"+o.toUpperCase())||o,i!=d-1&&(a+=", ");t=a}return t},groupHeaderTemplate:function(e){var t=e.value,i="-";return t&&(i=n.decodeHtml(t)),i}}],group:[{field:"dms_devices_name"}]})}}},y={title:s.prop("FACILITY_HISTORY_DETAIL"),width:652,height:690,buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2,CANCEL:3,SAVE:4},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type"></span></div><div class="detail-dialog-detail-content-field-list"></div>',listTemplate:e.trendLogDetailListTemplate,headerTemplate:"<span>"+s.prop("COMMON_SELECTED")+": <span>#:count #</span></span>",isCustomActions:!0,onTypeChange:function(e){var t=e.type,i=e.sender,o=e.sender.BTN,n=e.sender.getSelectedData();"single"==t?(i.setActions(o.CLOSE,{visible:!0}),i.setActions(o.DELETE,{visible:!0}),i.setActions(o.EDIT,{visible:!0}),n.enabled,i.setActions(o.DELETE,{disabled:!1}),i.setActions(o.EDIT,{disabled:!1}),i.setActions(o.SAVE,{visible:!1}),i.setActions(o.CANCEL,{visible:!1})):"edit"==t?(i.setEditable(!0),i.setActions(o.SAVE,{visible:!0}),i.setActions(o.CANCEL,{visible:!0}),i.setActions(o.EDIT,{visible:!1}),i.setActions(o.CLOSE,{visible:!1}),i.setActions(o.DELETE,{visible:!1})):"multi"==t&&(i.setActions(o.SAVE,{visible:!1}),i.setActions(o.CANCEL,{visible:!1}),i.setActions(o.EDIT,{visible:!1}),i.setActions(o.CLOSE,{visible:!0}),i.setActions(o.DELETE,{visible:!1}))},actions:[{text:s.prop("COMMON_BTN_CLOSE"),visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1),e.sender.trigger("onClosed")}},{text:s.prop("COMMON_BTN_DELETE"),visible:!0,action:function(e){var t,i;return t=e.sender.getSelectedData(),1<e.sender.dataSource.total()&&(i=e.sender.dataSource.data()),e.sender.trigger("onDelete",{result:t,results:i}),!1}},{text:s.prop("COMMON_BTN_EDIT"),visible:!0,action:function(e){return e.sender.trigger("onEdit"),e.sender.trigger("onEdited"),!1}},{text:s.prop("COMMON_BTN_CANCEL"),visible:!1,action:function(e){e.sender.confirmDialog.message(s.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL"));function t(){e.sender.trigger("onCancel"),e.sender.cancelDataSource(),e.sender.setEditable(!1),e.sender.setDialogType(e.sender.dialogType),e.sender.hideInvalidMessage(),e.sender.hideRemoveBtn(),e.sender.trigger("onCanceled")}return e.sender.hasChanged?(e.sender.confirmDialog.setConfirmActions({yes:function(){t()}}),e.sender.confirmDialog.open()):t(),!1}},{text:s.prop("COMMON_BTN_SAVE"),visible:!1,disabled:!0,action:function(e){var t,i,o;return e.sender.trigger("onSave"),o=e.sender.getSelectedData(),!1===(t=e.sender.save())||(t.id=o.id,1<e.sender.dataSource.total()&&(i=e.sender.saveAll(null,!0)),e.sender.trigger("onSaved",{sender:e.sender,result:t,results:i}),e.sender.setEditable(!1)),!1}}],scheme:T};return{getTrendlogCreatePopup:function(){return i.kendoDetailDialog(g).data("kendoDetailDialog")},getTrendlogAddPopup:function(){return a.kendoDetailDialog(_).data("kendoDetailDialog")},getTrendlogSingleDetailPopup:function(){return l.kendoDetailDialog(m).data("kendoDetailDialog")},getTrendlogMultiDetailPopup:function(){return c.kendoDetailDialog(f).data("kendoDetailDialog")},getTrendlogHistoryPopup:function(){return p.kendoDetailDialog(h).data("kendoDetailDialog")},getTrendlogDetailPopup:function(){return v.kendoDetailDialog(y).data("kendoDetailDialog")}}}),define("history/trendlog/trendlog",["history/core","history/trendlog/viewmodel/trendlog-vm","history/trendlog/trendlog-model","history/trendlog/config/trendlog-common","history/trendlog/config/popup-config","history/trendlog/config/trendlog-template","history/trendlog/trendlog-util"],function(e,y,L,i,t,c,T){function o(){N={name:"",enabled:!0,interval:"PT5M",devices:[],total:0};var e=$("#trendlog-period-dropdown").data("kendoDropDownList"),t=$("#trendlog-number-dropdown").data("kendoDropDownList");e.select(1),t.select(0),u.close()}var n,u,p,d,g,E,_,O=window.I18N,x=window.moment,b=window.kendo,a=window.CommonLoadingPanel,k=window.Util,D=new a,s=y.MainViewModel,C=y.Views,r=new b.Router,l=new b.Layout("<div id='trendlog-main-view-content' class='trendlog-main-view-content k-scheduler'></div>"),v=$("#trendlog-common-tab"),m=$("#trendlog-main-view"),I=i.msgDialog,f=i.confirmDialog,h=!1,A=[],N={name:"",enabled:!0,interval:"PT5M",devices:[],total:0},S={},w={},R=!0,M=!1,P=function(){n=v.kendoCommonTabStrip().data("kendoCommonTabStrip")},F=function(e){r.bind("init",ge),C.list.widget=_e(e),C.list.view=new b.View(C.list.widget.wrapper),r.route(C.list.routeUrl,Pe.bind(r,C.list.view)),r.start(),d=t.getTrendlogSingleDetailPopup(),E=t.getTrendlogHistoryPopup(),u=t.getTrendlogCreatePopup(),p=t.getTrendlogAddPopup(),g=t.getTrendlogDetailPopup(),p.bind("onClosed",H),p.bind("onSave",ee),p.bind("onEditSave",V),p.bind("onPrev",G),p.bind("onNext",B),g.bind("onDelete",J),g.bind("onSaved",j),g.bind("onEdit",X),u.bind("onClose",Y),u.setCloseAction(Y),u.bind("onSave",z),u.bind("onEditSave",W),u.bind("onClosed",Y),u.closeBtn.on("click",Y),p.closeBtn.on("click",H)},Y=function(e){var t=e.isSave;h&&!t?(f.message(O.prop("FACILITY_CREATE_TRENDLOG_CLOSE_CONFIRM")),f.setConfirmActions({yes:function(){o()}}),f.open()):o()},G=function(e){$("#trendlog-device-panel").show(),$("#trendlog-property-panel").hide(),$("input[data-event=typedrop]").data("kendoDropDownList").enable(!0)},B=function(e){$("#trendlog-device-panel").hide(),$("#trendlog-property-panel").show(),$("input[data-event=typedrop]").data("kendoDropDownList").enable(!1);var t,i,o,n,d,a=$("#trendlog-device-grid-elem").data("kendoDeviceTabGroupGrid"),r=$("#trendlog-property-grid-elem").data("kendoGrid"),s=a.getSelectedData();n=s.length,d={logic:"and",filters:[]};var l=[];for(t=0;t<n;t++)-1!=(i=(o=s[t]).dms_devices_mainType).indexOf("ControlPoint")&&(i="ControlPoint"),l.push(o.dms_devices_id),d.filters.push({field:"dms_devices_type",operator:"contains",value:i});l.sort();var c,p=!1;if(r.beforeIdList){if(n=r.beforeIdList.length,l.length!=n)p=!0,r.beforeIdList=l;else for(t=0;t<n;t++)if(c=r.beforeIdList[t],-1==l.indexOf(c)){p=!0,r.beforeIdList=l;break}}else r.beforeIdList=l;p&&r.uncheckAll(),r.dataSource.filter(d)},V=function(e){var i=e.checkedPropertyData,o=e.originalData;return f.message(O.prop("FACILITY_TRENDLOG_EDIT_PROPERTY_CONFIRM")),f.setConfirmActions({yes:function(){p.close();for(var e=0;e<N.devices.length;++e)if(N.devices[e].dms_devices_id==o.dms_devices_id){N.devices[e].dms_trendLogs_properties_list_keys=[],N.devices[e].names=[];for(var t=0;t<i.length;++t)N.devices[e].dms_trendLogs_properties_list_keys.push(i[t].key),N.devices[e].names.push(i[t].name);break}R&&(N.devices=Be(N.devices,"dms_devices_name"),R=!1),Ee(N,!0),h=!0,U(),I.message(O.prop("FACILITY_TRENDLOG_EDIT_PROPERTY_RESULT")),I.open()}}),f.open(),!1},H=function(){U()},U=function(){$("#trendlog-property-grid-elem").data("kendoGrid").uncheckAll(),$("#trendlog-add-device-cnt").text(O.prop("COMMON_SELECTED")+" : 0"),$("#trendlog-add-property-cnt").text(O.prop("COMMON_SELECTED")+" : 0"),$("input[data-event=typedrop]").data("kendoDropDownList").enable(!0);var e=p.BTN;p.setActions(e.SAVE,{visible:!1}),p.setActions(e.EDITSAVE,{visible:!1})},j=function(e){var t=e.result;D.open(d.element),g.success(),$.ajax({url:"/dms/trendLogs/"+t.id,method:"PATCH",data:t}).done(function(){I.message(O.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED")),I.open(),d.close()}).fail(function(e){g.fail(),Ge(e)}).always(function(){var e=C.list.widget.dataSource.get(t.id);e&&e.set("name",t.name),D.close()})},X=function(e){S={},w={};var t,i,o=e.sender.getSelectedData(),n=[],d=o.devices.length;for(i=0;i<d;i++)(t=o.devices[i])instanceof b.data.ObservableObject&&(t=t.toJSON()),n.push(t);for(N={name:o.name,enabled:o.enabled,interval:o.originalInterval,devices:n,total:o.devices.length,id:o.id},i=0;i<N.devices.length;++i){N.devices[i].names=[];for(var a=0;a<N.devices[i].dms_trendLogs_properties_list_keys.length;++a)N.devices[i].names.push(L.getPropertiesNameByKey(N.devices[i].dms_trendLogs_properties_list_keys[a]))}_=$.extend(!0,{},N),R=!0;var r=O.prop("FACILITY_TRENDLOG_EDIT_TRENDLOG");he(r);var s=u.BTN;u.setActions(s.SAVE,{visible:!1}),u.setActions(s.EDITSAVE,{visible:!0}),Ee(N),Te(o.name),K(o.originalInterval)},K=function(e){var t,i=$("#trendlog-period-dropdown").data("kendoDropDownList"),o=$("#trendlog-number-dropdown").data("kendoDropDownList");-1!=e.indexOf("M")?(i.select(0),t=L.minPeriodDataSource):-1!=e.indexOf("H")?(i.select(1),t=L.hourPeriodDataSource):-1!=e.indexOf("D")&&(i.select(2),t=L.dayPeriodDataSource);var n=e.match(/\d/g);n=n.join(""),o.setDataSource(t),o.select(1*n-1)},z=function(e){var t=$("#trendlog-name-input").val(),i=$("#trendlog-period-dropdown").val(),o=$("#trendlog-number-dropdown").val(),n="P";n+="Day"==i?o+"D":"Hour"==i?"T"+o+"H":"Minute"==i?"T"+o+"M":"T"+o+"S",N.name=t,N.interval=n;if(q(i)){for(var d=[],a=0;a<N.devices.length;++a){var r={};r.dms_devices_id=N.devices[a].dms_devices_id,r.dms_trendLogs_properties_list_keys=[];for(var s=0;s<N.devices[a].dms_trendLogs_properties_list_keys.length;++s)r.dms_trendLogs_properties_list_keys.push(N.devices[a].dms_trendLogs_properties_list_keys[s]);d.push(r)}f.message(O.prop("FACILITY_TRENDLOG_CREATE_CONFIRM")),f.setConfirmActions({yes:function(){D.open(u.element),$.ajax({url:"/dms/trendLogs/",method:"POST",data:{name:N.name,enabled:N.enabled,interval:N.interval,devices:d,total:N.total}}).done(function(){}).fail(function(e){Ge(e)}).always(function(){D.close(),N={name:"",enabled:!0,interval:"PT5M",devices:[],total:0},e.sender.close(),e.sender.trigger("onClose",{isSave:!0}),D.open(),$.ajax({url:"/dms/trendLogs"}).done(function(e){pe(e)}).fail(function(e){Ge(e)}).always(function(){D.close()})})}}),f.open()}},W=function(e){var t=$("#trendlog-name-input").val(),i=$("#trendlog-period-dropdown").val(),o=$("#trendlog-number-dropdown").val(),n="P";if(n+="Day"==i?o+"D":"Hour"==i?"T"+o+"H":"Minute"==i?"T"+o+"M":"T"+o+"S",N.name=t,N.interval=n,q(i)){var d=!1;if(N.interval!==_.interval&&(d=!0),N.devices.length!==_.devices.length)d=!0;else if(N.devices.length===_.devices.length)for(var a=0,r=N.devices.length;a<r;a++)$.each(N.devices[a],function(e,t){"uniqueId"!==e&&(t instanceof Array?void 0!==$(t).not(_.devices[a][e]).get()[0]&&(d=!0):t!==_.devices[a][e]&&(d=!0))});for(var s,l=[],c=0;c<N.devices.length;++c){var p={};p.dms_devices_id=N.devices[c].dms_devices_id,p.dms_devices_type=N.devices[c].dms_devices_type,p.dms_devices_name=N.devices[c].dms_devices_name,p.dms_trendLogs_properties_list_keys=[];for(var v=0;v<N.devices[c].dms_trendLogs_properties_list_keys.length;++v)p.dms_trendLogs_properties_list_keys.push(N.devices[c].dms_trendLogs_properties_list_keys[v]);l.push(p)}s=d?O.prop("FACILITY_CREATE_TRENDLOG_DATA_DELETE_SAVE_CONFIRM"):O.prop("FACILITY_CREATE_TRENDLOG_SAVE_CONFIRM"),f.message(s),f.setConfirmActions({yes:function(){var t=g.getSelectedData(),e=N.id;D.open(u.element),$.ajax({url:"/dms/trendLogs/"+e,method:"PATCH",data:{name:N.name,enabled:N.enabled,interval:N.interval,devices:l,total:N.total}}).fail(function(e){Ge(e)}).always(function(){t.name=N.name,t.enabled=N.enabled;var e=N.interval;t.originalInterval=e,t.interval=T.intervalToString(x.duration(e),e),t.devices=l,t.total=N.total,g.close(),g.setDataSource(t),g.open(),u.close(),I.message(O.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED")),I.open(),N={name:"",enabled:!0,interval:"PT5M",devices:[],total:0},Z(),D.close()})}}),f.open()}},Z=function(){return D.open(),$.ajax({url:"/dms/trendLogs"}).done(function(e){pe(e)}).fail(function(e){Ge(e)}).always(function(){D.close()})},q=function(e){var t,i=0;if(N.devices)for(var o=0;o<N.devices.length;++o)N.devices[o].dms_trendLogs_properties_list_keys&&(i+=N.devices[o].dms_trendLogs_properties_list_keys.length);return N.total=i,!$("#trendlog-name-input").data("kendoCommonValidator").validate("invalidCharacter")||""==N.name||30<N.name.length?(t=O.prop("FACILITY_TRENDLOG_CHECK_TRENDLOG_NAME"),I.message(t),I.open(),!1):"Period"==e?(t=O.prop("FACILITY_TRENDLOG_CHECK_LOG_INTERVAL"),I.message(t),I.open(),!1):!N.devices||N.devices.length<1?(t=O.prop("FACILITY_TRENDLOG_CHECK_NO_PROPERTY"),I.message(t),I.open(),!1):!(12<i)||(t=O.prop("FACILITY_TRENDLOG_CHECK_OVER_PROPERTY"),I.message(t),I.open(),!1)},Q=function(){var e=$("#trendlog-main-grid").data("kendoGrid");e?e.bind("checked",function(e){for(var t=0,i=e.sender.dataSource._data,o=0;o<i.length;++o)i[o].checked&&t++;0<t?(s.actions[2].set("disabled",!1),s.actions[3].set("disabled",!1)):(s.actions[2].set("disabled",!0),s.actions[3].set("disabled",!0)),s.actions[0].options.set("selectedNum",O.prop("COMMON_SELECTED")+" : "+t)}):setTimeout(Q,300)},J=function(o){var n=o.result.id,e="/dms/trendLogs/"+n;f.message(O.prop("FACILITY_TRENDLOG_DELETE_TRENDLOG_CONFIRM")),f.setConfirmActions({yes:function(){D.open(g.element),$.ajax({url:e,method:"DELETE"}).done(function(){}).fail(function(e){Ge(e)}).always(function(){D.close(),o.sender.close();var e=$("#trendlog-main-grid");e.data("kendoGrid").uncheckAll(),s.actions[0].options.set("selectedNum",O.prop("COMMON_SELECTED")+" : 0");var t=e.data("kendoGrid").dataSource,i=t.get(n);t.remove(i),t.sync(),I.message(O.prop("FACILITY_TRENDLOG_DELETE_TRENDLOG_RESULT")),I.open()})}}),f.open()},ee=function(e){var t,i,o,n,d,a,r,s,l,c,p=e.checkedDeviceData,v=e.checkedPropertyData,u=N.devices;for(R&&(N.devices=Be(N.devices,"dms_devices_name"),R=!1),t=0;t<p.length;++t){for(n=p[t].dms_devices_id,d=p[t].dms_devices_name,a=p[t].dms_devices_type,"ControlPoint"!=(r=p[t].dms_devices_mappedType)&&(a=r||a),s=!1,i=0;i<u.length;i++)if(u[i].dms_devices_id==n)for(s=!0,u[i].dms_trendLogs_properties_list_keys=[],u[i].names=[],o=0;o<v.length;o++)(c=v[o].dms_devices_type)&&-1==c.indexOf(a)||(u[i].dms_trendLogs_properties_list_keys.push(v[o].key),u[i].names.push(v[o].name));if(!s){for((l={}).dms_devices_id=n,l.dms_devices_name=d,l.dms_devices_type=a,l.dms_devices_mappedTypes=r,l.dms_trendLogs_properties_list_keys=[],l.names=[],i=0;i<v.length;++i)c=v[i].dms_devices_type,-1!=a.indexOf("ControlPoint")&&(a="ControlPoint"),c&&-1==c.indexOf(a)||(l.dms_trendLogs_properties_list_keys.push(v[i].key),l.names.push(v[i].name));N.devices.push(l)}}N.devices.length&&(N.total=N.devices.length),Ee(N,h=!0),U()},te=[],ie=function(){s.actions[1].options.set("click",fe),s.actions[2].options.set("click",Se),s.actions[3].options.set("click",Me),C.list.widget.element.on("click",".ic.ic-info",function(){var e,t=$(this).closest("tr").data("uid"),i=C.list.widget.dataSource,o=i.getByUid(t);if(!o){e=$(this).data("id");for(var n=0;n<i._data.length;++n)if(i._data[n].id==e){o=i._data[n];break}}g.setDataSource(o),g.setDialogType("single"),g.open()}),C.list.widget.element.on("click",".trendlog-history",function(){var t,e=$(this).closest("tr").data("uid"),i=C.list.widget.dataSource,o=i.getByUid(e);if(!o){t=$(this).data("id");for(var n=0;n<i._data.length;++n)if(i._data[n].id==t){o=i._data[n];break}}E.setDataSource(o),E.setDialogType("single"),E.open(),ne();var d=y.excelExpotViewModel;d.actions[1].set("isEnabled",!1),b.bind($(".historyHead.graphHeadBox"),d),$("#trendlog-history-name").text(o.name);var a=$("#trendlog-history-graph"),r=$("#trendlog-history-list");t=o.id,$(".history-checkbox").off("click").on("click",function(){$(this).attr("checked")?$(this).removeAttr("checked"):$(this).attr("checked","checked")});var p,v,u,g,s,l,_,c=$("#trendlogBtnGroups"),m=$("#trendlog-start-datepicker"),f=$("#trendlog-end-datepicker"),h=$("#trendlog-start-timepicker"),T=$("#trendlog-end-timepicker");d.actions[0].options.set("click",function(){p=m.val(),v=f.val(),u=x(h.data("kendoCommonTimePicker").value()),g=x(T.data("kendoCommonTimePicker").value()),s=x(u).format().split("T")[1],l=x(g).format().split("T")[1];var e="/dms/trendLogs/"+t+"/view?startTime="+(p+"T"+s)+"&endTime="+(v+"T"+l);te=[],$(".history-checkbox").each(function(){var e=$(this);if(e.attr("checked")){var t={};t.dms_devices_id=e.attr("data-dms_devices_id"),t.dms_trendLogs_properties_list_key=e.attr("data-dms_trendLogs_properties_list_key"),te.push(t)}}),D.open(E.element),$.ajax({url:e}).done(function(e){re(e),ae(e),oe(),0<(_=e).times.length?d.actions[1].set("isEnabled",!0):d.actions[1].set("isEnabled",!1)}).fail(function(e){Ge(e)}).always(function(){D.close(),c.show(),le(),"block"===E.element.find("#trendlog-history-propertybox").css("display")&&E.element.find(".trendlog-collapse .added").click()})}),d.actions[1].options.set("click",function(){var e,t,i,o=E.options.dataSource.data()[0],n=[{cells:[{value:O.prop("ENERGY_INQUIRED_PERIOD"),background:"#4E4E4E",color:"#FFFFFF",vAlign:"center",hAlign:"center"},{value:p+" "+x(u).format("HH:mm")+" ~ "+v+" "+x(g).format("HH:mm"),colSpan:3,vAlign:"center"}]}];n.push({cells:[{value:O.prop("COMMON_NAME"),background:"#4E4E4E",color:"#FFFFFF",vAlign:"center",hAlign:"center"},{value:o.name,colSpan:3,vAlign:"center"}]}),n.push({}),n.push({cells:[{value:O.prop("FACILITY_TRENDLOG_TIME_POINT"),background:"#4E4E4E",color:"#FFFFFF",vAlign:"center",hAlign:"center",rowSpan:2}]});var d=_.times,a=d.length;for(n.push({cells:[{background:"#4E4E4E",color:"#FFFFFF",vAlign:"center",hAlign:"center",value:Ve(L.getPropertiesNameByKey(d[0].devices[0].properties[0].dms_trendLogs_properties_list_key))}]}),e=0;e<d[0].devices.length;e++)for(t=0;t<d[0].devices[e].properties.length;t++)n[i=n.length-2].cells.push({value:d[0].devices[e].dms_devices_name,background:"#4E4E4E",color:"#FFFFFF",vAlign:"center",hAlign:"center"}),i=n.length-1,(0<t||0<e)&&n[i].cells.push({value:Ve(L.getPropertiesNameByKey(d[0].devices[e].properties[t].dms_trendLogs_properties_list_key)),background:"#4E4E4E",color:"#FFFFFF",vAlign:"center",hAlign:"center"});for(var r=0;r<a;r++){n.push({cells:[{value:x(d[r].time).format("YYYY-MM-DD HH:mm"),background:"#4E4E4E",color:"#FFFFFF",vAlign:"center",hAlign:"center"}]});var s="";for(e=0;e<d[0].devices.length;e++)for(t=0;t<d[0].devices[e].properties.length;t++)i=n.length-1,void 0!==d[r].devices&&(s=L.getPropertyValue(d[r].devices[e].properties[t].dms_trendLogs_properties_list_key,d[r].devices[e].properties[t].value)),n[i].cells.push({value:s,vAlign:"center",hAlign:"center"})}var l=[];for(t=0;t<n[3].cells.length;t++)l.push({width:200});var c=new b.ooxml.Workbook({sheets:[{title:O.prop("FACILITY_TRENDLOG_TRENDLOG_HISTORY"),rows:n,columns:l}]});b.saveAs({dataURI:c.toDataURL(),fileName:O.prop("FACILITY_TRENDLOG_TRENDLOG_HISTORY")+"_"+x().format("L")+".xlsx"})}),a.off("click").on("click",function(){1!=a.hasClass("active")&&le()}),r.off("click").on("click",function(){1!=r.hasClass("active")&&ce()}),E.element.find(".trendlog-collapse .added").off("click").on("click",function(){$("#trendlog-history-propertybox").slideToggle("fast"),$("#trendlog-expander",$(this)).hasClass("t-i-expand")?($("#trendlog-expander",$(this)).addClass("t-i-collapse"),$("#trendlog-expander",$(this)).removeClass("t-i-expand")):($("#trendlog-expander",$(this)).addClass("t-i-expand"),$("#trendlog-expander",$(this)).removeClass("t-i-collapse"))}),$(".detail-dialog-grid").remove()}),s.searchField.set("click",function(e){var t=$(e.target),i=t.val()?t.val():s.searchField.get("keywords");i=i||"",$("#trendlog-main-grid").data("kendoGrid").dataSource.filter({field:"name",operator:function(e){return-1!==e.indexOf(i)}})}),s.searchField.set("keydown",function(e){console.info(e),13==e.keyCode&&s.searchField.click(e)})},oe=function(){var e=$("#trendlog-start-datepicker"),t=$("#trendlog-end-datepicker"),i=$("#trendlog-start-timepicker"),o=$("#trendlog-end-timepicker"),n=e.val(),d=t.val(),a=x(i.data("kendoCommonTimePicker").value()),r=x(o.data("kendoCommonTimePicker").value()),s=n+"T"+x(a).format().split("T")[1],l=d+"T"+x(r).format().split("T")[1],c=$("#trendlog-history-list-period"),p=$("#trendlog-history-properties-cnt");s=x(s).format("YYYY-MM-DD hh:mm"),l=x(l).format("YYYY-MM-DD hh:mm"),c.text(s+" ~ "+l);var v=$(".history-checkbox").length;v<=1?p.text(v+" "+O.prop("FACILITY_TRENDLOG_PROPERTY")):p.text(v+" "+O.prop("FACILITY_TRENDLOG_PROPERTIES"))},ne=function(){var e=$("#trendlog-history-property-ul"),t=$("#trendlog-history-name-ul"),i=E.dataSource._data[0],o=i.devices,n=i.id;L.createHistoryPanelNameModel(t,o),A=L.createHistoryPanelPropertyModel(e,o,A);var d=$("#trendlog-end-datepicker").data("kendoCommonDatePicker"),a=$("#trendlog-start-datepicker").data("kendoCommonDatePicker"),r=$("#trendlog-start-timepicker").data("kendoCommonTimePicker"),s=$("#trendlog-end-timepicker").data("kendoCommonTimePicker"),l=new Date,c=a.value(),p=d.value();r.value(new Date);var v=r.value();s.value(new Date);var u=s.value(),g=new Date(c);g.setHours(v.getHours()),g.setMinutes(v.getMinutes()),g.setSeconds(v.getSeconds());var _,m=new Date(p);m.setHours(u.getHours()),m.setMinutes(u.getMinutes()),m.setSeconds(u.getSeconds());function f(e){var t=E.dataSource.data()[0].originalInterval;T.dataInspection(new Date,g,t)||(I.message(O.prop("FACILITY_TRENDLOG_POPUP_DATA_1000_OVER")),I.open(),_=new Date(e.endTime),d.value(_),p=_,s.value(_),m=u=_)}var h=!1;a.bind("change",function(){var e=this.value();v=r.value();var t=new Date(v);t.setFullYear(e.getFullYear()),t.setMonth(e.getMonth()),t.setDate(e.getDate()),h=!1,de(g=c=t,m)||(this.value(t),d.value(t),r.value(t),s.value(t),de(m=u=p=c=t,l)||(this.value(l),d.value(l),r.value(l),s.value(l),m=u=c=p=l),I.message(O.prop("FACILITY_TRENDLOG_POPUP_START_DATE_OVER")),I.open(),h=!0),D.open(E.element);var i=x(g).format("YYYY-MM-DDTHH:mm:ssZ");$.ajax({url:"/dms/trendLogs/"+n+"/endTime?startTime="+i}).done(function(e){if(h)return _=new Date(e.endTime),0;if(m){var t=x(m),i=x(e.endTime);if(de(t,i))return}f(e)}).fail(function(e){Ge(e)}).always(function(){D.close()})}),d.bind("change",function(){var e=p,t=this.value();u=s.value();var i=new Date(u);return i.setFullYear(t.getFullYear()),i.setMonth(t.getMonth()),i.setDate(t.getDate()),de(g,i)?de(i,l)?_&&!de(i,_)?(I.message(O.prop("FACILITY_TRENDLOG_POPUP_DATA_1000_OVER")),I.open(),this.value(_),s.value(_),void(m=p=_)):void(m=u=p=i):(I.message(O.prop("FACILITY_TRENDLOG_POPUP_END_DATE_OVER")),I.open(),void this.value(e)):(I.message(O.prop("FACILITY_TRENDLOG_POPUP_START_DATE_OVER")),I.open(),void this.value(e))}),r.bind("change",function(){var e=v,t=this.value();c=a.value();var i=new Date(c);if(i.setHours(t.getHours()),i.setMinutes(t.getMinutes()),i.setSeconds(t.getSeconds()),h=!1,!de(i,m))return I.message(O.prop("FACILITY_TRENDLOG_POPUP_START_DATE_OVER")),I.open(),void this.value(e);v=g=c=i,D.open(E.element);var o=x(g).format("YYYY-MM-DDTHH:mm:ssZ");$.ajax({url:"/dms/trendLogs/"+n+"/endTime?startTime="+o}).done(function(e){if(m){var t=x(m),i=x(e.endTime);if(t.isSame(i))return}f(e)}).fail(function(e){Ge(e)}).always(function(){D.close()})}),s.bind("change",function(){var e=u,t=this.value();p=d.value();var i=new Date(p);return i.setHours(t.getHours()),i.setMinutes(t.getMinutes()),i.setSeconds(t.getSeconds()),de(g,i)?de(i,l)?_&&!de(i,_)?(I.message(O.prop("FACILITY_TRENDLOG_POPUP_DATA_1000_OVER")),I.open(),this.value(_),d.value(_),void(m=u=_)):void(m=u=p=i):(I.message(O.prop("FACILITY_TRENDLOG_POPUP_END_DATE_OVER")),I.open(),void this.value(e)):(I.message(O.prop("FACILITY_TRENDLOG_POPUP_START_DATE_OVER")),I.open(),void this.value(e))}),a.trigger("change")},de=function(e,t){var i=x(e),o=x(t);return!(o.isBefore(i,"second")&&!o.isSame(i,"second"))},ae=function(e){var n=["d1","d2","d3","d4","d5","d6","d7","d8","d9","d10","d11","d12"];L.setScalesModel(e.scales);var t=(e=se(e)).categorySize;e=e.data;var i=100*t;i<1244&&(i=1244);var o=$("#trendlog-history-chart");o.css({width:i});var d=new b.data.DataSource({data:e,group:{field:"key"},sort:[{field:"time",dir:"asc"}]});o.kendoChart({width:i,legend:{visible:!1},chartArea:{background:"#ebebeb"},seriesDefaults:{type:"line",labels:{visible:!0,background:"transparent"}},dataSource:d,series:[{type:"line",field:"value",colorField:"Color",labels:{visible:!0,template:"#= Util.convertNumberFormat(dataItem.original_value) # #= dataItem.unittext #"},highlight:{toggle:function(e){e.preventDefault()}},markers:{visual:function(e){var t=e.rect,i=e.dataItem,o=i.Color,n=i.j;return L.appendMarker(o,n,t)}},groupColor:function(e){var t=e.series;t.color=t.data[e.index].Color;var i=t.data;if(i&&0<i.length){var o=i[0].j;t.dashType=n[o]}}}],valueAxis:{majorGridLines:{visible:!1},visible:!1},categoryAxis:{field:"time",axisCrossingValues:[0,0,100,100],minorGridLines:{visible:!1}},selectionTooltip:{isVisible:!0,top:80,width:350,seriesKeysForRowName:["name"],rowGroupNames:[],rowTemplate:function(e){for(var t=e.data.shape.type,i=$("#trendlog-history-property-ul li .lineVisual .lines svg >"+t+":last-child"),o=($("#trendlog-history-property-ul li .lineVisual .lines svg"),0),n=0,d=i.length;n<d;n++)"circle"==t?i[n].getAttribute("cx")==e.data.shape.cx&&i[n].getAttribute("cy")==e.data.shape.cy&&i[n].getAttribute("fill")==e.data.Color&&(o=n):"rect"==t?i[n].getAttribute("x")==e.data.shape.x&&i[n].getAttribute("y")==e.data.shape.y&&i[n].getAttribute("fill")==e.data.Color&&(o=n):i[n].getAttribute("points")==e.data.shape.points.map(function(e){return[e.x,e.y].join(",")}).join(" ")&&i[n].getAttribute("fill")==e.data.Color&&(o=n);var a=i[o].parentElement;a=a.cloneNode(!0),(a=$(a).attr("class","svg-selection-icon "+t)[0]).removeChild(a.childNodes[0]);var r=a.outerHTML,s=$("#trendlog-history-chart").data("kendoChart");void 0!==s._plotArea.charts[0].categorySlots[0]&&(s.options.selectionTooltip.margin=-(s._plotArea.charts[0].categorySlots[0].width()/2-25));var l={groupName:"",content:"",priority:0},c=k.convertNumberFormat(e.data.original_value);if(void 0!==e.data.dms_devices_name){var p=O.prop("FACILITY_TRENDLOG_PROPERTY_"+L.getPropertiesNameByKey(e.data.dms_property_name).toUpperCase());void 0!==e.data.unittext&&(c+=e.data.unittext),l.content+=r+"<span class='history-trendlog-graph-tooltip-content-name'>"+e.data.dms_devices_name+"</span><span class='history-trendlog-graph-tooltip-content-property'> : "+p+"</span><span class='history-trendlog-graph-tooltip-content-data'>"+c+"</span>",l.priority=1}else l.content="",l.priority=0,l.groupName="";return l}}});var a=$("#trendlog-history-chart").data("kendoChart");a.options.selectionTooltip.top=15*a.dataSource.view().length+14},re=function(e){var t,i,o,r,n,d,a,s,l,c,p,v,u,g,_,m,f=e.times,h=f.length,T=[],y=[],E=[],b=te.length;for(s=0;s<h;s++)if(o=(t=f[s]).devices){for(p=o.length,y=[],l=0;l<p;l++){for(m=(i=o[l]).dms_devices_id,_=!1,c=0;c<b;c++)if(te[c].dms_devices_id==m){_=!0;break}if(_){for((g={}).id=m,g.name=i.dms_devices_name,v=(n=i.properties).length,c=0;c<v;c++)d=(r=n[c]).dms_trendLogs_properties_list_key,-1==E.indexOf(d)&&E.push(d),a=r.value,g[d]=a;y.push(g)}}for(p=E.length,v=y.length,l=0;l<p;l++){for(r=E[l],_=!1,c=0;c<b;c++)if(te[c].dms_trendLogs_properties_list_key==r){_=!0;break}if(_){for((u={}).time=x(t.time).format("YYYY-MM-DD HH:mm"),u.property=r,c=0;c<v;c++)i=y[c],r=(r=i[u.property])||"-",u[i.id]=r;T.push(u)}}}var D=[{field:"time",title:O.prop("FACILITY_TRENDLOG_TIME_POINT")},{field:"property",title:O.prop("FACILITY_TRENDLOG_PROPERTY")}];for(h=y.length,s=0;s<h;s++)i=y[s],D.push({field:i.id,title:i.name});var C=$("#trendlog-history-grid-elem");C.empty(),C.kendoGrid({columns:D,dataSource:T,height:500,scrollable:!0,rowTemplate:function(e){var t,i,o,n,d="<tr data-uid="+e.uid+" role='row'>",a=D.length;for(t=0;t<a;t++)o="",n=null!=(n=e[i=D[t].field])?n:"-","property"==i?"-"!=n&&(n=L.getPropertiesNameByKey(n),n=O.prop("FACILITY_TRENDLOG_PROPERTY_"+n.toUpperCase())||n):"time"==i?o="time-cell":("null"==n&&(n="-"),r=e.property?e.property:"-",n=L.getPropertyValue(r,n)),d+="<td role='gridcell' class='"+o+"'>"+k.convertNumberFormat(n)+"</td>";return d+="</tr>"},dataBound:function(e){var t,i,o,n,d,a,r=e.sender.element.find(".k-grid-content tbody > tr td.time-cell"),s=r.length;for(i=0;i<s;i++)t=r[i],o!=(d=(t=$(t)).text())?(n&&(n.attr("rowspan",a),n=null),n||(a=1,o=d,n=t)):(t.remove(),a++,i==s-1&&n.attr("rowSpan",a))}})},se=function(e){for(var t,i=[],o=0,n=e.times,d=0;d<n.length;++d){var a=n[d].devices;if(t=n[d].time,a){o++;for(var r=0;r<a.length;++r)for(var s=a[r].properties,l=0;l<s.length;++l){var c={};if(c.dms_trendLogs_properties_list_key=a[r].properties[l].dms_trendLogs_properties_list_key,c.dms_trendLogs_properties_name=L.getPropertiesNameByKey(a[r].properties[l].dms_trendLogs_properties_list_key),c.original_value=s[l].value,$.isNumeric(c.original_value)){var p;for(c.unit=L.getPropertiesUnitByKey(a[r].properties[l].dms_trendLogs_properties_list_key),c.value=L.getCalculatedValue(c.original_value,c.unit),c.time=x(t).format("YYYY-MM-DD HH:mm"),c.key=c.dms_trendLogs_properties_name+"/"+a[r].dms_devices_id,c.Color="#000000",c.dms_devices_id=a[r].dms_devices_id,c.dms_devices_name=a[r].dms_devices_name,c.dms_property_name=a[r].properties[l].dms_trendLogs_properties_list_key,c.unittext=L.unitModel[c.unit],p=0;p<A.length;++p)c.dms_devices_id==A[p].dms_devices_id&&c.dms_property_name==A[p].dms_property_name&&(c.Color=A[p].color,c.shape=A[p].shape,c.j=A[p].j);for(p=0;p<te.length;++p)if(te[p].dms_trendLogs_properties_list_key==c.dms_trendLogs_properties_list_key&&te[p].dms_devices_id==c.dms_devices_id){i.push(c);break}}}}}return{data:i,categorySize:o}},le=function(e){var t=$("#trendlog-history-graph"),i=$("#trendlog-history-list"),o=$(".listHeadBox");$(".graphHeadBox"+(M?"":":not(#trendlog-history-propertybox)")).show(),o.hide(),t.addClass("active"),i.removeClass("active")},ce=function(e){var t=$("#trendlog-history-graph"),i=$("#trendlog-history-list"),o=$(".listHeadBox"),n=$(".graphHeadBox");M="none"!==$("#trendlog-history-propertybox").css("display"),n.hide(),o.show(),i.addClass("active"),t.removeClass("active")},pe=function(e){me(e);var t=new b.data.DataSource({data:e});$("#trendlog-main-grid").data("kendoGrid").setDataSource(t)},ve=function(){ue(!1),r.navigate(C.list.routeUrl)},ue=function(e){s.actions[2].set("disabled",!e),s.actions[3].set("disabled",!e)},ge=function(){l.render(m),Q()},_e=function(e){var d;me(e);var t={columns:[{field:"id",title:"id",hidden:!0},{field:"checked",headerTemplate:'<input type="checkbox" id="grid-header-chkbox" class="k-checkbox grid-header-checkbox"><label class="k-checkbox-label grid-header-checkbox-label" for="grid-header-chkbox"></label>',template:function(e){var t=e.id;return'<input type="checkbox" id="check_'+t+'" data-id="'+t+'" class="k-checkbox grid-body-checkbox" '+(e.checked?"checked":"")+'><label for="check_'+t+'" data-id="'+t+'" class="k-checkbox-label grid-body-checkbox-label"></label>'},width:37},{field:"name",title:O.prop("COMMON_NAME"),width:100},{field:"enabled",title:O.prop("COMMON_STATUS"),template:function(e){return 1==e.enabled?O.prop("COMMON_OPERATING"):O.prop("COMMON_PAUSE")},width:100},{field:"device",title:O.prop("FACILITY_DEVICE_DEVICE"),template:function(e){var t,i="";e.devices[0]&&(-1!=(t=e.devices[0].dms_devices_mappedTypes||e.devices[0].dms_devices_type).indexOf("ControlPoint")&&(t=e.devices[0].dms_devices_type),i="<span class='detail-img reg selected "+k.getDisplayClassType(t)+"'></span>",d=1==e.devices.length?"":"(+"+(e.devices.length-1)+")");return i+d},width:100},{field:"property",title:O.prop("FACILITY_TRENDLOG_PROPERTY"),template:function(e){for(var t=0,i=0;i<e.devices.length;++i)t+=e.devices[i].dms_trendLogs_properties_list_keys.length;var o="";if(e.devices[0]){o=(o=L.getPropertiesNameByKey(e.devices[0].dms_trendLogs_properties_list_keys[0]))||"-";var n=O.prop("FACILITY_TRENDLOG_PROPERTY_"+o.toUpperCase());o=n||o,d=1==t?"":" (+"+(t-1)+")"}return o+d},width:100},{field:"interval",title:O.prop("FACILITY_TRENDLOG_LOG_INTERVAL"),width:100},{field:"originalInterval",hidden:!0},{field:"lastupdate",title:O.prop("FACILITY_TRENDLOG_LAST_UPDATE"),width:100},{field:"history",template:function(e){return"<button data-id='"+e.id+"' class='k-button trendlog-history' style='width:79px;margin-right:15px;'>"+O.prop("FACILITY_TRENDLOG_HISTORY")+"</button>"},title:O.prop("FACILITY_TRENDLOG_HISTORY"),width:100},{field:"devices",title:"Device",hidden:!0},{title:O.prop("FACILITY_HISTORY_DETAIL"),width:78,template:function(e){return"<span class='ic ic-info' data-id='"+e.id+"' data-uid='"+e.uid+"'></span>"}}],dataSource:e,height:$(".trendlog-create-content").height()-130,scrollable:!0,groupable:!1,sortable:!1,filterable:!1,pageable:!1,hasCheckedModel:!0,setCheckedAttribute:!0};return i.createNewWidget("trendlog-main-grid",b.ui.Grid,t)},me=function(e){for(var t,i=0;i<e.length;++i){t=e[i].interval,e[i].originalInterval=t,e[i].interval=T.intervalToString(x.duration(t),t);var o=e[i].updatedTime,n=x(o).format("YYYY-MM-DD HH:mm:ss");e[i].lastupdate=n,e[i].device=e[i].devices,e[i].property=e[i].devices}},fe=function(e){var t=O.prop("FACILITY_TRENDLOG_CREATE_NEW_TRENDLOG");he(t)},he=function(e){R=!0,u.setDialogType("single"),h=!1,u.open();var t=u.BTN;u.setActions(t.SAVE,{visible:!0}),u.setActions(t.EDITSAVE,{visible:!1}),u.wrapper.find(".k-dialog-title").text(e),Te(),Ee([]),be(),De(),ye()},Te=function(e){var t,i=$("#trendlog-name-input");if(e)t=e;else{for(var o=$("#trendlog-main-grid").data("kendoGrid").getOptions().dataSource.data,n=0,d=0,a=0;a<o.length;a++)-1!==o[a].name.indexOf("Trend log name")&&(n=o[a].name.replace(/[^0-9]/g,""),Number(d)<Number(n)&&(d=n));t="Trend log name "+ ++d}i.attr("value",t),i.val(t)},ye=function(){var e=$("#trendlog-name-input");e.kendoCommonValidator({type:"name",maxLength:30,minLength:1}).data("kendoCommonValidator"),e.on("change",function(){h=!0})};N={name:"",enabled:!0,interval:"PT5M",devices:[],total:0};var Ee=function(e,t){var s=$("#trendlog-create-grid-elem");s.empty();var i=s.kendoGrid({columns:[{field:"checked",hidden:!0,template:c.checkboxCellTemplate,width:37,sortable:!1},{field:"uniqueId",hidden:!0,groupHeaderTemplate:function(e){var t,i=e.field,o=e.value,n=w[e.value];return t="string"==typeof e.value?e.value:S[e.value],"<div class=\"grid-group-row\"><input type='checkbox' id='check_"+i+"_"+o+"' data-field='"+i+"' data-value='"+e.value+"' class='k-checkbox grid-group-row-checkbox'><label for=\"check_"+i+"_"+o+'" class="k-checkbox-label grid-group-row-checkbox-label"></label><span class="grid-group-row-text">'+t+"</span><button data-id='"+n+"' class='trendlog-create-editbtn k-button' style='width:79px;margin-right:75px;float:right;'>"+O.prop("COMMON_BTN_EDIT")+"</button></div>"}},{field:"names",title:O.prop("FACILITY_TRENDLOG_PROPERTY"),width:750,template:function(e){for(var t,i="",o=0;o<e.names.length;++o)0!=o&&(i+=", "),t=e.names[o],i+=t=O.prop("FACILITY_TRENDLOG_PROPERTY_"+t.toUpperCase())||t;return i}}],dataSource:[],autoBind:!1,height:300,scrollable:!0,hasCheckedModel:!0,setCheckedAttribute:!0}).data("kendoGrid"),o=[{field:"uniqueId"}];if(s.data("kendoGrid").dataSource.group(o),void 0!==e.devices){for(var n=0;n<e.devices.length;n++)e.devices[n].uniqueId=!0===t?n:e.devices[n].dms_devices_name,S[n]=e.devices[n].dms_devices_name,w[e.devices[n].uniqueId]=e.devices[n].dms_devices_id;var d=new b.data.DataSource({data:e.devices});d.read(),d.group(o),i.setDataSource(d),i.uncheckAll()}var a=$("#trendlog-create-delete-btn");if(a.prop("disabled",!0),i.bind("checked",function(e){0<e.sender.getCheckedData().length?a.prop("disabled",!1):a.prop("disabled",!0)}),e.total){for(var r=0,l=0;l<e.devices.length;l++)r+=e.devices[l].dms_trendLogs_properties_list_keys.length;$("#trendlog-create-grid-count").text(O.prop("COMMON_TOTAL")+" ("+r+")")}else $("#trendlog-create-grid-count").text(O.prop("COMMON_TOTAL")+" (0)");s.find(".k-grid-header").hide(),s.find(".k-grid-content").on("click",".trendlog-create-editbtn",function(e){for(var n,d,t=$(this).data("id"),i=s.data("kendoGrid").dataSource,o=0;o<i._data.length;++o)if(i._data[o].dms_devices_id==t){n=i._data[o],d=i._data[o].dms_devices_mappedTypes||i._data[o].dms_devices_type;break}p.setDataSource(n),p.setDialogType("edit");var a=$("#trendlog-device-grid-elem"),r=$("#trendlog-property-grid-elem");a.hide(),a.empty(),r.hide(),r.empty(),p.open(),D.open(p.element),$("#trendlog-property-panel").show(),$("#trendlog-device-panel").hide(),$.ajax({url:"/dms/devices/trendLogView"}).done(function(e){Ce(e),Ne(),Le(),Oe();var t=$("input[data-event=typedropcopy]");t=t.data("kendoDropDownList");var i=d;-1!=d.indexOf("AirConditioner.")?i="AirConditioner.":-1!=d.indexOf("ControlPoint")&&(i="ControlPoint"),t.value(i),a.show(),$.ajax({url:"/dms/trendLogs/properties"}).done(function(e){ke(e),Ae();var t=$("#trendlog-property-grid-elem").data("kendoGrid");t.dataSource.filter({logic:"and",filters:[{field:"dms_devices_type",operator:"contains",value:d}]});for(var i=0;i<n.names.length;i++)for(var o=0;o<t.dataSource.total();o++)t.dataSource.view()[o].name===n.names[i]&&t.checkById(t.dataSource.view()[o].id,!0);r.show()}).fail(function(e){Ge(e)}).always(function(){D.close()})}).fail(function(e){Ge(e)}).always(function(){D.close()})})},be=function(){var e=[{text:O.prop("FACILITY_TRENDLOG_MINUTE"),value:"Minute",selectable:!0},{text:O.prop("FACILITY_TRENDLOG_HOUR"),value:"Hour",selectable:!0},{text:O.prop("FACILITY_TRENDLOG_DAY"),value:"Day",selectable:!0}],o=$("input[data-event=numberdrop]"),t=$("input[data-event=perioddrop]"),i=o.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:L.minPeriodDataSource,select:function(e){!1!==e.dataItem.selectable||e.preventDefault()},template:b.template($("#peroid-dropdown-template").html())}).data("kendoDropDownList"),n=t.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:e,value:"Minute",select:function(e){if(!1!==e.dataItem.selectable){var t=e.dataItem.value,i=o.data("kendoDropDownList");"Period"==t?i.enable(!1):i.enable(!0),"Minute"==t?i.dataSource.data(L.minPeriodDataSource):"Hour"==t?i.dataSource.data(L.hourPeriodDataSource):"Day"==t&&i.dataSource.data(L.dayPeriodDataSource)}else e.preventDefault()},template:b.template($("#peroid-dropdown-template").html())}).data("kendoDropDownList");n.dataSource.data(e),i.bind("change",function(){h=!0}),n.bind("change",function(){h=!0,o.data("kendoDropDownList").select(0)})},De=function(){var e=$("#trendlog-create-add-btn");$("#trendlog-create-delete-btn").off("click").on("click",function(){var d,e=$("#trendlog-create-grid-elem").data("kendoGrid"),a=e.dataSource,r=e.getCheckedData(),s=r.length;d=1<s?O.prop("FACILITY_TRENDLOG_DELETE_PROPERTY_MULTI_CONFIRM",s):O.prop("FACILITY_TRENDLOG_DELETE_PROPERTY_CONFIRM"),f.message(d),f.setConfirmActions({yes:function(){var e,t,i=N.devices;for(e=s-1;0<=e;e--){for(t=i.length-1;0<=t;t--)r[e].dms_devices_id==i[t].dms_devices_id&&i.splice(t,1);a.remove(r[e])}var o=a.total();N.total=o,$("#trendlog-create-grid-count").text(O.prop("COMMON_TOTAL")+" ("+o+")"),d=1<s?O.prop("FACILITY_TRENDLOG_DELETE_PROPERTY_MULTI_RESULT",s):O.prop("FACILITY_TRENDLOG_DELETE_PROPERTY_RESULT");var n=$("#trendlog-create-grid-elem").data("kendoGrid");n.trigger("checked",{sender:n}),I.message(d),I.open()}}),f.open()}),e.off("click").on("click",function(){p.setDialogType("create");var t=$("#trendlog-device-grid-elem"),i=$("#trendlog-property-grid-elem");t.hide(),t.empty(),i.hide(),i.empty(),p.open(),D.open(p.element),$.ajax({url:"/dms/devices/trendLogView"}).done(function(e){Ce(e),Ne(),Le(),Oe(),t.show(),D.close(),D.open(p.element),$.ajax({url:"/dms/trendLogs/properties"}).done(function(e){ke(e),Ae(),i.show()}).fail(function(e){Ge(e)}).always(function(){D.close()}),$("#trendlog-device-panel").show(),$("#trendlog-property-panel").hide()}).fail(function(e){Ge(e)}).always(function(){D.close()})})},Ce=function(e){var t=xe(e),i=$("#trendlog-device-grid-elem").kendoDeviceTabGroupGrid({dataSource:[],hasNewDataSource:!1,hasSelectedModel:!0,type:"hybrid",hideTab:!0,filterTab:[{hideHeader:!0,template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",listStyle:"treeList",widgetOptions:{selectedLimit:12,height:500},listOptions:{column:{template:function(e){if(e.treeGroup&&e.field){if(-1!=e.field.indexOf("buildings_name"))return Fe(e);if(-1!=e.field.indexOf("floors_name"))return Ye(e);if(-1!=e.field.indexOf("zones_name"))return $e(e)}return e.dms_devices_name}},group:[{field:"foundation_space_buildings_name",aggregates:[{field:"foundation_space_buildings_name",aggregate:"count"}]},{field:"foundation_space_floors_name",aggregates:[{field:"foundation_space_floors_name",aggregate:"count"}]},{field:"foundation_space_zones_name",aggregates:[{field:"foundation_space_zones_name",aggregate:"count"}]}]}}]}).data("kendoDeviceTabGroupGrid"),o=new b.data.DataSource({data:t});o.read(),o.sort([{field:"dms_devices_name",dir:"asc"}]),i.setDataSource(o),i.bind("change",function(e){var t,i=e.sender.dataSource;e.item&&(t=i.get(e.item.id))&&t.set("selected",e.item.selected);var o=this.getSelectedData(),n=$("#trendlog-add-device-cnt"),d=o.length;if(12<d)return console.error("limit select size"),e.item.set("selected",!1),t&&t.set("selected",!1),!1;var a=p.BTN;0==d?p.setActions(a.NEXT,{disabled:!0}):p.setActions(a.NEXT,{disabled:!1}),n.text(O.prop("COMMON_SELECTED")+" : "+d)}),$("#trendlog-device-grid-elem .k-grid-header").hide()},Le=function(){var e=$("input[data-event=typedrop]");e.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:y.typeFilterDataSource,select:function(e){var t=e.dataItem.value;$("input[data-event=typedropcopy]").data("kendoDropDownList").value(t);var i=$("#trendlog-device-grid-elem").data("kendoDeviceTabGroupGrid");i.unselectAll();var o=i.dataSource;i.trigger("change"),o.filter({logic:"or",filters:[{field:"dms_devices_mainType",operator:"contains",value:t},{field:"dms_devices_mappedType",operator:"contains",value:t}]});var n=$("#trendlog-device-grid-elem .k-grid-content");n&&n.scrollTop(0)}});var t=e.data("kendoDropDownList");t.select(0);var i=t.dataItem();t.trigger("select",{dataItem:i})},Oe=function(){var t=$("#trendlog-add-search-btn");t.off("click").on("click",function(){var e=$("#trendlog-add-input").val(),t=$("#trendlog-device-grid-elem").data("kendoDeviceTabGroupGrid"),i={logic:"and",filters:[{field:"dms_devices_name",operator:"contains",value:e},{field:"dms_devices_mainType",operator:"contains",value:$("input[data-event=typedropcopy]").data("kendoDropDownList").value()}]};t.dataSource.filter(i)}),$("#trendlog-add-input").keydown(function(e){console.info(e),13==e.keyCode&&t.click()})},xe=function(e){for(var t,i=[],o=0;o<e.length;++o)for(var n=e[o].floors,d=0;d<n.length;++d){for(var a=n[d].zones,r=0;r<a.length;++r)for(var s=a[r].registeredDevices,l=0;l<s.length;++l)(t={}).id=t.dms_devices_id=s[l].dms_devices_id,t.dms_devices_name=s[l].dms_devices_name,t.dms_devices_type=s[l].dms_devices_type,t.dms_devices_mappedType=s[l].dms_devices_mappedType,t.dms_devices_mainType=t.dms_devices_mappedType||t.dms_devices_type,t.foundation_space_buildings_name=e[o].foundation_space_buildings_name,t.foundation_space_floors_name=t.foundation_space_buildings_name+"/"+n[d].foundation_space_floors_name+n[d].foundation_space_floors_type,t.foundation_space_zones_name=t.foundation_space_buildings_name+"/"+t.foundation_space_floors_name+"/"+a[r].foundation_space_zones_name,t.numberOfRegisteredDeviceZones=s.length,t.numberOfRegisteredDeviceFloors=n[d].numberOfRegisteredDevices,t.numberOfRegisteredDeviceBuilding=e[o].numberOfRegisteredDevices,t.id=t.dms_devices_id,i.push(t);for(var c=n[d].outOfZoneRegisteredDevices,p=0;p<c.length;++p)(t={}).id=t.dms_devices_id=c[p].dms_devices_id,t.dms_devices_name=c[p].dms_devices_name,t.dms_devices_type=c[p].dms_devices_type,t.dms_devices_mappedType=c[p].dms_devices_mappedType,t.dms_devices_mainType=t.dms_devices_mappedType||t.dms_devices_type,t.foundation_space_buildings_name=e[o].foundation_space_buildings_name,t.foundation_space_floors_name=t.foundation_space_buildings_name+"/"+n[d].foundation_space_floors_name+n[d].foundation_space_floors_type,t.foundation_space_zones_name=t.foundation_space_buildings_name+"/"+t.foundation_space_floors_name+"/NoZone",t.numberOfRegisteredDeviceFloors=n[d].numberOfRegisteredDevices,t.numberOfRegisteredDeviceBuilding=e[o].numberOfRegisteredDevices,t.numberOfRegisteredDeviceZones=c.length,t.id=t.dms_devices_id,i.push(t)}return i},ke=function(e){var t=Ie(e);$("#trendlog-property-grid-elem").kendoGrid({columns:[{field:"id",hidden:!0},{field:"checked",template:c.checkboxCellTemplate,width:37,sortable:!1},{field:"value",hidden:!0},{field:"name",title:O.prop("FACILITY_DEVICE_DEVICE_NAME"),width:200,template:function(e){var t=e.name?e.name:"-";if(t){var i=O.prop("FACILITY_TRENDLOG_PROPERTY_"+t.toUpperCase());t=i||t}return t}},{field:"key",hidden:!0},{field:"dms_devices_type",hidden:!0},{field:"dataType",hidden:!0}],checkedLimit:12,dataSource:t,height:500,scrollable:!0,hasCheckedModel:!0,setCheckedAttribute:!0}).data("kendoGrid").bind("checked",function(e){for(var t=$("#trendlog-add-property-cnt"),i=0,o=e.sender.dataSource._data,n=0;n<o.length;++n)o[n].checked&&i++;var d=p.BTN;i<1?(p.setActions(d.SAVE,{disabled:!0}),p.setActions(d.EDITSAVE,{disabled:!0})):(p.setActions(d.SAVE,{disabled:!1}),p.setActions(d.EDITSAVE,{disabled:!1})),12<i?e.item&&(e.item.checked=!1,e.sender.dataSource.fetch()):(d=p.BTN,p.setActions(d.SAVE,{disabled:!1}),t.text(O.prop("COMMON_SELECTED")+" : "+i))}),$("#trendlog-property-grid-elem .k-grid-header").hide(),$("#trendlog-property-grid-elem > div.k-grid-content.k-auto-scrollable").css("overflow","hidden")},Ie=function(e){var t,i,o,n,d,a,r,s=[],l=0;for(o=0;o<e.length;o++)if(e[o].list)for(n=0;n<e[o].list.length;n++){for(t={},i=e[o].list[n].key,a=!1,d=0;d<s.length;d++)if(s[d].key==i){r=s[d],a=!0;break}if(a)for(d=0;d<e[o].dms_devices_types.length;d++)r.dms_devices_type+=e[o].dms_devices_types[d];else{for(t.key=i,t.name=e[o].list[n].name,t.label=O.prop("FACILITY_TRENDLOG_PROPERTY_"+e[o].list[n].name.toUpperCase()),t.dataType=e[o].list[n].dataType,e[o].list[n].unit&&(t.unit=e[o].list[n].unit),t.dms_devices_type="",d=0;d<e[o].dms_devices_types.length;d++)t.dms_devices_type+=e[o].dms_devices_types[d];t.id=l++,s.push(t)}}else if(e[o].properties)for(n=0;n<e[o].properties.length;n++){for(t={},i=e[o].properties[n].key,a=!1,d=0;d<s.length;d++)if(s[d].key==i){r=s[d],a=!0;break}if(a)for(d=0;d<e[o].dms_devices_types.length;d++)r.dms_devices_type+=e[o].dms_devices_types[d];else{for(t.key=i,t.name=e[o].properties[n].name,t.label=O.prop("FACILITY_TRENDLOG_PROPERTY_"+e[o].properties[n].name.toUpperCase()),t.dataType=e[o].properties[n].dataType,e[o].properties[n].unit&&(t.unit=e[o].properties[n].unit),t.dms_devices_type="",d=0;d<e[o].dms_devices_types.length;d++)t.dms_devices_type+=e[o].dms_devices_types[d];t.id=l++,s.push(t)}}return s},Ae=function(){var t=$("#trendlog-property-search-btn");t.off("click").on("click",function(){var t=$("#trendlog-property-input").val(),e=$("#trendlog-property-grid-elem").data("kendoGrid"),i=$("input[data-event=typedropcopy]").data("kendoDropDownList").value();e.filterForSearch({logic:"and",filters:[{field:"dms_devices_type",operator:"contains",value:i},{field:"label",operator:function(e){return-1!==e.indexOf(t)}}]}),$("#trendlog-property-grid-elem > div.k-grid-content.k-auto-scrollable").css("overflow","auto")}),$("#trendlog-property-input").keydown(function(e){console.info(e),13==e.keyCode&&t.click()})},Ne=function(){$("input[data-event=typedropcopy]").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:y.typeFilterDataSource,select:function(e){},enable:!1})},Se=function(e){var t,i=Re(),o=i.length;t=1<o?O.prop("FACILITY_TRENDLOG_DELETE_TRENDLOG_MULTI_CONFIRM",o):O.prop("FACILITY_TRENDLOG_DELETE_TRENDLOG_CONFIRM"),f.message(t),f.setConfirmActions({yes:function(){we(i)}}),f.open()},we=function(e){var t,i,o=e.length,n=[];for(D.open(),t=0;t<o;t++)if(i=e[t]){n.push($.ajax({url:"/dms/trendLogs/"+i.id,method:"DELETE"}));var d=$("#trendlog-main-grid").data("kendoGrid");d.uncheckAll(),s.actions[0].options.set("selectedNum",O.prop("COMMON_SELECTED")+" : 0");var a=d.dataSource,r=a.get(i.id);a.remove(r),d.setDataSource(a)}$.when.apply(this,n).done(function(){1<o?I.message(O.prop("FACILITY_TRENDLOG_DELETE_TRENDLOG_MULTI_RESULT",o)):I.message(O.prop("FACILITY_TRENDLOG_DELETE_TRENDLOG_RESULT")),I.open()}).fail(function(){}).always(function(){D.close(),C.list.widget.uncheckAll(),s.actions[0].options.set("selectedNum",O.prop("COMMON_SELECTED")+" : 0"),s.actions[2].set("disabled",!0),s.actions[3].set("disabled",!0)})},Re=function(){return C.list.widget.getCheckedData()},Me=function(){var e=Re(),t="single";t=1<e.length?"multi":"single",g.setDataSource(e),g.setDialogType(t),g.open()},Pe=function(e){l.showIn("#trendlog-main-view-content",e),e===C.list.view&&setTimeout(function(){b.bind(e.render(),C.list.widget._model)},10)},Fe=function(e){var t=e.value?e.value:"-",i="",o=e.aggregates;return o&&o.foundation_space_buildings_name&&o.foundation_space_buildings_name.count&&(i=o.foundation_space_buildings_name.count),'<div class="grid-group-row"><span class="grid-group-row-text">'+t+" ("+i+")</span></div>"},Ye=function(e){var t=e.value?e.value:"-",i="",o=e.aggregates;return o&&o.foundation_space_floors_name&&o.foundation_space_floors_name.count&&(i=o.foundation_space_floors_name.count),"-"!=t&&(t=(t=t.split("/"))[t.length-1]),'<div class="grid-group-row"><span class="grid-group-row-text">'+t+" ("+i+")</span></div>"},$e=function(e){var t=e.value?e.value:"-",i="",o=e.aggregates;if(o&&o.foundation_space_zones_name&&o.foundation_space_zones_name.count&&(i=o.foundation_space_zones_name.count),"-"!=t)if(-1!=(t=e.value).indexOf("NoZone"))t="-";else{var n=e.value.split("/");t=n[n.length-1]}return'<div class="grid-group-row"><span class="grid-group-row-text">'+t+" ("+i+")</span></div>"},Ge=function(e){var t=e.status;if(403===t)I.message(O.prop("FACILITY_TRENDLOG_POPUP_PERMISSION_ERROR"));else if(201==t)I.message(O.prop("FACILITY_TRENDLOG_MESSAGE_NOTI_NEW_TRENDLOG_CREATED"));else{var i=k.parseFailResponse(e);I.message(i)}I.open()};function Be(e,i){return e.sort(function(e,t){return e[i]<t[i]?-1:e[i]>t[i]?1:0})}function Ve(e){return"string"==typeof e?O.prop("FACILITY_TRENDLOG_PROPERTY_"+e.toUpperCase()):"-"}!function(){window.MAIN_WINDOW.disableFloorNav(!0),P();var t=n.contentElement(0);D.open(),$.ajax({url:"/dms/trendLogs/properties"}).done(function(e){L.setPropertiesModel(e),$.ajax({url:"/dms/trendLogs"}).done(function(e){F(e),b.bind($(t),s),ie(),ve()}).fail(function(e){Ge(e)}).always(function(){D.close()})}).fail(function(e){Ge(e)}).always(function(){D.close()})}()});