define("device/common/device-model",[],function(){"use strict";var e=window.kendo;return{Device:e.data.Model.define({id:"id",fields:{alarms:{type:"object",editType:null},networks:{type:"object"},parentId:{type:"string"},winds:{type:"object"},registrationStatus:{type:"string",options:[{text:"NotRegistered",value:"0"},{text:"Registered",value:"1"},{text:"Deleted",value:"1"}]},name:{type:"string"},information:{type:"object"},subordinateIds:{type:"object"},operations:{type:"object"},mappedType:{type:"string",options:[{text:"ControlPoint",value:"0"},{text:"Light",value:"1"},{text:"Meter.WattHour",value:"2"},{text:"Sensor.Humidity",value:"3"},{text:"Sensor.Motion",value:"4"},{text:"Sensor.Temperature",value:"5"}]},representativeStatus:{type:"string",options:[{text:"Normal.On",value:"0"},{text:"Normal.Off",value:"1"},{text:"Alarm.Critical",value:"2"},{text:"Alarm.Warning",value:"3"},{text:"Alarm.NetworkError",value:"4"},{text:"Disconnected",value:"5"},{text:"LowBattery",value:"6"},{text:"OutOfBounds",value:"7"}]},modes:{type:"object"},controlPoint:{type:"object"},groups:{type:"object"},configuration:{type:"object"},light:{type:"object"},type:{type:"string"},id:{type:"string"},schedules:{type:"object"},description:{type:"string"},locations:{type:"object"},airConditioner:{type:"object"},temperatures:{type:"object"}}}),DevicePopup:e.data.Model.define({id:"id",fields:{id:{name:"Device ID",type:"string",editType:null},name:{name:"Device NAME",type:"string",editType:"input"},representativeStatus:{name:"Status",type:"string",editType:null},modes:{name:"Operation Mode",type:"string",editType:null},temperatureS:{name:"Set Temperature",type:"string",editType:null},temperatureC:{name:"Current Temperature",type:"string",editType:null},locations:{name:"Location",type:"string",editType:"select"},groups:{name:"Group",type:"string",editType:null},"control-point":{name:"Remote Control",type:"string",editType:"input"},model:{name:"Model",type:"string",editType:null},type:{name:"Type",type:"string",editType:null},version:{name:"Firmware Version",type:"string",editType:null},description:{name:"Description",type:"string",editType:"input"}}})}}),define("device/common/device-api",["device/common/device-model"],function(e){"use strict";function n(e){var t="/dms/devices/"+e;return $.ajax({url:t,method:"DELETE"})}function s(e){return $.ajax({url:"/dms/devices",method:"PATCH",data:e})}var F=window.MAIN_WINDOW,x=e.Device,k={"AirConditioner.Indoor":["AirConditioner.*"],AirConditionerOutdoor:["AirConditionerOutdoor"],ControlPoint:["ControlPoint.*"],Meter:["Meter*"],"Sensor.Temperature_Humidity":["Sensor.Temperature_Humidity","Sensor.Temperature","Sensor.Humidity"],Light:["Light"],SmartPlug:["SmartPlug"],"Sensor.Motion":["Sensor.Motion"],Gateway:["Gateway"],Beacon:["Beacon"],CCTV:["CCTV"]},V={ControlPoint:{mappedTypes:"ControlPoint"},Meter:{types:"ControlPoint.*"},"Sensor.Temperature_Humidity":{types:"ControlPoint.*"}},P={"ControlPoint.*":{mappedTypes:["ControlPoint"]},Light:{types:["ControlPoint.*"],mappedTypes:["Light"]},"Meter*":{types:["ControlPoint.*"],mappedTypes:["Meter*"]},"Sensor.Temperature_Humidity":{types:["ControlPoint.*"],mappedTypes:["Sensor.Humidity","Sensor.Temperature","Sensor.Temperature_Humidity"]},"Sensor.Motion":{types:["ControlPoint.*"],mappedTypes:["Sensor.Motion"]}},W={On:{representativeStatuses:"Normal.On"},Off:{representativeStatuses:"Normal.Off"},Critical:{representativeStatuses:"Alarm.Critical"},Warning:{representativeStatuses:"Alarm.Warning"},Normal:{representativeStatuses:"Normal"},"Alarm.Critical":{representativeStatuses:"Alarm.Critical"},"Alarm.Warning":{representativeStatuses:"Alarm.Warning"}};return{getStatisticByKey:function(e){var t;switch(e){case"AirConditioner.Indoor":t="/dms/devices/statisticView/AirConditioner";break;case"Meter":t="/dms/devices/statisticView/Meter";break;case"Sensor.Temperature_Humidity":t="/dms/devices/statisticView/Sensor.Temperature_Humidity";break;case"Light":t="/dms/devices/statisticView/Light";break;case"Sensor.Motion":t="/dms/devices/statisticView/Sensor.Motion";break;case"Gateway":t="/dms/devices/statisticView/Gateway";break;case"CCTV":t="/dms/devices/statisticView/CCTV";break;case"Beacon":t="/dms/devices/statisticView/Beacon";break;case"Asset":t="/dms/devices/statisticView/Asset";break;case"SmartPlug":t="/dms/devices/statisticView/SmartPlug"}return F.getCurrentFloor().building.id==F.FLOOR_NAV_BUILDING_TOTAL_ID&&(t+="?exposeFloors=false"),$.ajax({url:t}).then(function(e){return e=e||[]})},getDeviceWithType:function(e,t,i,a,n){var o;o=$.isArray(e)?e:k[e]?k[e]:[];var s,r,l,d,c,p,u,m,g=new $.Deferred,f="/dms/devices",v="",_={},T={},E=!1,b="",I="",C=(n=n||{}).type,h=n.mode||{},y=n.statuses||[],A=n.zones||[],w=n.name&&n.name.replace(/\s/g,"+")||null;if(C&&"Beacon"!=o[0])r=V[e]&&V[e].types,l=V[e]&&V[e].mappedTypes,_.types=C,l&&(_.mappedTypes=l),r&&(T.types=r,T.mappedTypes=C);else if(o){for(c=0,p=o.length;c<p;c++)s=o[c],!E&&P[s]&&(E=!0,r=P[s].types,l=P[s].mappedTypes,r?(b=f+"?types="+(r=r.join(","))+"&mappedTypes="+(l=l.join(",")),T.types=r,T.mappedTypes=l):l=l.join(",")),v+=s,v+=",";_.types=v.substr(0,v.length-1)}if(0<y.length){for(c=0,p=y.length;c<p;c++)(d=W[d=y[c]]).representativeStatuses&&-1==I.indexOf(d.representativeStatuses)&&(I+=d.representativeStatuses+",");I&&I.lastIndexOf(",")===I.length-1&&(I=I.substr(0,I.length-1)),_.representativeStatuses=I}h.value&&h.id&&(_.equals=h.value,_.equalsAttribute="modes-"+h.id+"-mode"),0<A.length&&(_.foundation_space_zones_id=A.join(",")),w&&(_.contains=w,_.containsAttributes="id,name,controlPoint-tagName");var S=F.getCurrentFloor(),D=S.building,O=S.floor;D.id&&D.id!=F.FLOOR_NAV_BUILDING_TOTAL_ID&&(u=D.id),O.id&&O.id!=F.FLOOR_NAV_FLOOR_ALL_ID&&(m=O.id),t?t=t.join(","):(t="Registered,NotRegistered",-1==f.indexOf("Beacon")||a||(t+=",Blocked")),-1!=t.indexOf("NotRegistered")&&(m=u=null),u&&(_.foundation_space_buildings_id=u),m&&(_.foundation_space_floors_id=m),_.registrationStatuses=t,$.isEmptyObject(T)||(T.registrationStatuses=t,T.foundation_space_buildings_id=u,T.foundation_space_floors_id=m,I&&(T.representativeStatuses=I),h.value&&h.id&&(T.equals=h.value,T.equalsAttribute="modes-"+h.id+"-mode"),0<A.length&&(T.foundation_space_zones_id=A.join(",")),w&&(T.contains=w,T.containsAttributes="id,name,controlPoint-tagName")),E&&!b&&(_.mappedTypes=l),i&&(i.typeQuery&&(_=$.extend(_,i.typeQuery)),i.mappedTypeQuery&&(T=$.extend(T,i.mappedTypeQuery)));var N,L,R=[],M=[],B=[];return T.registrationStatuses&&(f="/dms/devices",T.types&&(f+="?types="+T.types,delete T.types),T.mappedTypes&&(f+=-1!=f.indexOf("?")?"&":"?",f+="mappedTypes="+T.mappedTypes,delete T.mappedTypes),T.representativeStatuses&&(f+=-1!=f.indexOf("?")?"&":"?",f+="representativeStatuses="+T.representativeStatuses,delete T.representativeStatuses),T.foundation_space_zones_id&&(f+=-1!=f.indexOf("?")?"&":"?",f+="foundation_space_zones_id="+T.foundation_space_zones_id,delete T.foundation_space_zones_id),R.push($.ajax({url:f,data:T}).then(function(e){e.page?(M=e.data,N=e.page):M=e}).fail(function(e){g.reject(e)}))),f="/dms/devices",_.types&&(f+="?types="+_.types,"Beacon"==_.types&&C&&(f+="&equals="+C+"&equalsAttribute=configuration-mobilityType"),delete _.types),_.mappedTypes&&(f+=-1!=f.indexOf("?")?"&":"?",f+="mappedTypes="+_.mappedTypes,delete _.mappedTypes),1<_.registrationStatuses.split(",").length&&(f+=-1!=f.indexOf("?")?"&":"?",f+="registrationStatuses="+_.registrationStatuses,delete _.registrationStatuses),_.representativeStatuses&&(f+=-1!=f.indexOf("?")?"&":"?",f+="representativeStatuses="+_.representativeStatuses,delete _.representativeStatuses),_.foundation_space_zones_id&&(f+=-1!=f.indexOf("?")?"&":"?",f+="foundation_space_zones_id="+_.foundation_space_zones_id,delete _.foundation_space_zones_id),R.push($.ajax({url:f,data:_}).then(function(e){B=e.page?(L=e.page,e.data):e}).fail(function(e){g.reject(e)})),$.when.apply(this,R).always(function(){var e,t,i,a,n,o,s=!1;for(i=B.length,a=M.length,e=0;e<a;e++){for(o=M[e],s=!1,t=0;t<i;t++)if(n=B[t],o.id==n.id){s=!0;break}s||B.push(o)}i=B.length;var r=[];for(e=0;e<i;e++)(n=B[e]).locations&&!n.locations[0]&&(n.locations[0]={}),n.assets||(n.assets=[]),n.selected=!1,n=new x(n),r.push(n);if(L||N){var l={data:r,total:0};L&&(l.typePage=L,l.total+=L.totalElements),N&&(l.mappedTypePage=N,l.total+=N.totalElements),g.resolve(l)}else g.resolve(r)}),g.promise()},getDeviceWithID:function(e){var t="/dms/devices/"+e;return $.ajax({url:t})},getDeviceWithMultipleID:function(e){var t="/dms/devices";if(e){for(var i="",a=0,n=e.length;a<n;a++)i+=e[a],i+=",";t+="?ids="+i.substr(0,i.length-1)}return $.ajax({url:t})},patchDevice:function(e,t){var i="/dms/devices/"+e;return $.ajax({url:i,method:"PATCH",data:t})},patchDevices:s,deleteDevice:n,multiControl:function(e){return $.ajax({url:"/dms/devices/multiControl",method:"PUT",data:e})},patchGroupAttr:function(e,t,i){var a="/dms/devices/"+e+"/"+t+"/";return $.ajax({url:a,method:"PATCH",data:i})},deleteDevices:function(e){var t,i=e.length,a=[];for(t=0;t<i;t++)a.push(n(e[t]));return $.when.apply(this,a)},patchOutdoorCurrentLimit:function(e){var t=e.value,i=e.item;return $.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{electricCurrentControl:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.electricCurrentControl&&(i.airConditioner.outdoorUnit.electricCurrentControl=t)})},patchOutdoorHeatingCapacityCalibration:function(e){var t=e.value,i=e.item;$.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{heatingCapacityCalibration:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.heatingCapacityCalibration&&(i.airConditioner.outdoorUnit.heatingCapacityCalibration=t)})},patchOutdoorCoolingCapacityCalibration:function(e){var t=e.value,i=e.item;$.ajax({url:"/dms/devices/"+i.id+"/airConditioner",method:"PATCH",data:{outdoorUnit:{coolingCapacityCalibration:t}}}).done(function(){i.airConditioner&&i.airConditioner.outdoorUnit&&i.airConditioner.outdoorUnit.coolingCapacityCalibration&&(i.airConditioner.outdoorUnit.coolingCapacityCalibration=t)})},getZone:function(e,t){return $.ajax({url:"/foundation/space/zones?foundation_space_floors_id="+e}).then(function(e){return(e=e||[]).sort(function(e,t){return e.sortOrder-t.sortOrder}),t&&e.unshift({id:void 0,name:"No Zone"}),e})},patchRegistrationStatus:function(e,t){var i,a,n=[],o=e.length;for(a=0;a<o;a++)(i={id:e[a].id}).registrationStatus=t,n.push(i);return s(n)},patchControlPointValue:function(e,t){return"number"==typeof t&&(t=t.toString()),$.ajax({url:"/dms/devices/"+e+"/controlPoint",method:"PATCH",data:{value:t}})}}}),define("device/common/device-constants",[],function(){"use strict";var e=window.I18N;return{TIME_OUT:1500,ALL_TIME_INTERVAL:4e4,PANEL_REFRESH_TIME:1e3,BEACON_TIME_INTERVAL:5e3,DISPLAY_NAME_MAX:6,INDOOR_TYPE:["AirConditioner.Indoor","AirConditioner.AHU","AirConditioner.Chiller","AirConditioner.EHS","AirConditioner.ERV","AirConditioner.ERVPlus",["AirConditioner.FCU","AirConditioner.SFCU"],"AirConditioner.DuctFresh"],OUTDOOR_TYPE:["AirConditioneromOutdoor"],POINT_TYPE:["ControlPoint.AI","ControlPoint.AO","ControlPoint.DI","ControlPoint.DO","ControlPoint.AV","ControlPoint.DV"],ENERGY_TYPE:["Meter.WattHour","Meter.Gas","Meter.Water","Meter.Calorimeter"],SENSOR_TEMP_HUM_TYPE:["Sensor.Temperature_Humidity","Sensor.Humidity","Sensor.Temperature"],STATUS:["Normal.On","Normal.Off","Alarm.Critical","Alarm.Warning"],BEACON_STATUS:["Normal","Disconnected","WrongLocation","LowBattery"],BEACON_ACTION:{BLOCK:1,DELETE:2,REGISTER:3,DETAIL:4},BEACON_LOCATION_TYPE:["Fixed","Movable"],ASSET_FILTER:{TYPE:0,LOCATION:1,STATUS:2,ZONE:3,SELECTALL:4},ASSET_ACTION:{ASSET_TYPE:1,EXPORT:2,IMPORT:3,REGISTER:4,DELETE:5,DETAIL:6},ONOFF:["On","Off"],MODE:[{mode:"Auto",id:"AirConditioner.Indoor.General"},{mode:"Cool",id:"AirConditioner.Indoor.General"},{mode:"Heat",id:"AirConditioner.Indoor.General"},{mode:"Dry",id:"AirConditioner.Indoor.General"},{mode:"Fan",id:"AirConditioner.Indoor.General"},{mode:"CoolStorage",id:"AirConditioner.Indoor.General"},{mode:"HeatStorage",id:"AirConditioner.Indoor.General"},{mode:"vAuto",id:"AirConditioner.Indoor.Ventilator"},{mode:"HeatExchange",id:"AirConditioner.Indoor.Ventilator"},{mode:"ByPass",id:"AirConditioner.Indoor.Ventilator"},{mode:"Sleep",id:"AirConditioner.Indoor.Ventilator"},{mode:"Eco",id:"AirConditioner.Indoor.DHW"},{mode:"Standard",id:"AirConditioner.Indoor.DHW"},{mode:"Power",id:"AirConditioner.Indoor.DHW"},{mode:"Force",id:"AirConditioner.Indoor.DHW"}],TEXT:{SELECTALL:e.prop("COMMON_BTN_SELECT_ALL"),DESELECTALL:e.prop("COMMON_BTN_DESELECT_ALL"),REGISTER:e.prop("COMMON_BTN_REGISTER"),DEREGISTER:e.prop("COMMON_BTN_DEREGISTER"),VIEW:e.prop("COMMON_BTN_VIEW"),DELETE:e.prop("COMMON_BTN_DELETE")},FILTER:{TYPE:0,STATUS:1,MODE:2,ZONE:3,SELECTALL:4,REGEND:5},ACTION:{REGISTER:1,DETAIL:2},NW_ACTION:{DELETE:1,REGISTER:2,DETAIL:3,VIEW:4},VIEW:{STATISTIC:0,MAP:1,LIST:2,GRID:3},SEARCH:{EDIT:0,BUTTON:1},displayShort:[{value:"CoolStorage",display:"CoolSt"},{value:"HeatStorage",display:"HeatSt"},{value:"HeatExchange",display:"HeatEx"}],controlSet:[[{apiName:"operations",id:"AirConditioner.Indoor.General",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.Ventilator",parameter:"power"},{apiName:"operations",id:"AirConditioner.Indoor.DHW",parameter:"power"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.General.Speed",parameter:"wind"},{},{apiName:"modes",id:"AirConditioner.Indoor.ModeLimit",parameter:"mode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"enabled"}],[{apiName:"configuration",parameter:"remoteControl"},{apiName:"airConditioner",parameter:"filterResetRequired"},{apiName:"airConditioner",parameter:"spi"},{apiName:"airConditioner",parameter:"stillAir"}],{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"winds",id:"AirConditioner.Indoor.General.Direction",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.Ventilator",parameter:"mode"},{apiName:"winds",id:"AirConditioner.Indoor.Ventilator.Speed",parameter:"wind"},{apiName:"modes",id:"AirConditioner.Indoor.DHW",parameter:"mode"},[{apiName:"airConditioner",parameter:"chiller",underParameter:"waterLaw"},{apiName:"airConditioner",parameter:"chiller",underParameter:"quiet"},{apiName:"airConditioner",parameter:"chiller",underParameter:"forcedFan"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demand"}],{apiName:"airConditioner",parameter:"chiller",underParameter:"mccMode"},[{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.Room.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Cool.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet.Heat.Limit",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW.Limit",parameter:"desired"}],[{apiName:"temperatures",id:"AirConditioner.Indoor.Room",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.WaterOutlet",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"desired",Heat:"AirConditioner.Indoor.DischargeAir.Heat",Cool:"AirConditioner.Indoor.DischargeAir.Cool"},{apiName:"temperatures",id:"AirConditioner.Indoor.DHW",parameter:"desired"},{apiName:"temperatures",id:"AirConditioner.Indoor.DischargeAir",parameter:"enabled"}],{apiName:"modes",id:"AirConditioner.Indoor.General",parameter:"mode"},{apiName:"airConditioner",parameter:"chiller",underParameter:"demandLevel"}],outdoorControlConfig:{electricCurrentControl:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:50,text:"50%"},{value:55,text:"55%"},{value:60,text:"60%"},{value:65,text:"65%"},{value:70,text:"70%"},{value:75,text:"75%"},{value:80,text:"80%"},{value:85,text:"85%"},{value:90,text:"90%"},{value:95,text:"95%"},{value:100,text:"100%"}],coolingCapacityCalibration:{Celsius:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"5~7\xb0C"},{value:"7~9",text:"7~9\xb0C"},{value:"9~11",text:"9~11\xb0C"},{value:"10~12",text:"10~12\xb0C"},{value:"11~13",text:"11~13\xb0C"},{value:"12~14",text:"12~14\xb0C"},{value:"13~15",text:"13~15\xb0C"}],Fahrenheit:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:"5~7",text:"41~45\xb0F"},{value:"7~9",text:"45~48\xb0F"},{value:"9~11",text:"48~52\xb0F"},{value:"10~12",text:"50~54\xb0F"},{value:"11~13",text:"52~55\xb0F"},{value:"12~14",text:"54~57\xb0F"},{value:"13~15",text:"55~59\xb0F"}]},heatingCapacityCalibration:[{value:"SelfControl",text:e.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL")},{value:25,text:"25kg/cm\xb2"},{value:26,text:"26kg/cm\xb2"},{value:27,text:"27kg/cm\xb2"},{value:28,text:"28kg/cm\xb2"},{value:29,text:"29kg/cm\xb2"},{value:30,text:"30kg/cm\xb2"},{value:31,text:"31kg/cm\xb2"},{value:32,text:"32kg/cm\xb2"},{value:33,text:"33kg/cm\xb2"}]},INNER_LAYOUT:{MONITORING:0,REGISTRATION:1},FILTER_NAME:{SELECTALL:"selectAll",ZONE:"zone",STATUS:"status",TYPE:"type",MODE:"mode",ASSET_TYPE:"assetType"},ACTION_NAME:{DETAIL:"detail",REGISTER:"register",DELETE:"delete",BLOCK:"block",SELECTEDTEXT:"selectedText",VIEW:"view",ASSET_TYPE:"assetType"},REGISTRATION_STATUS_BUTTONS:{REGISTER:0,UNREGISTER:1},LIGHT_CONTROL:{POWER:0,DIMMING:1}}}),define("device/common/device-util",["device/common/device-constants"],function(r){"use strict";function l(){for(var e=y.getDefaultViewType(),t=e.length,i="statistic",a=0;a<t;a++)if("Facility.Device"==e[a].menu){i=(i=e[a].view).toLowerCase();break}return i}function i(e){var t=e.locations,i="-";if(void 0!==e.assets_types_id)return D(e);if(t&&0<t.length){i="";var a=t[0];if(a.description)return a.description;a.foundation_space_buildings_id&&(i+=a.foundation_space_buildings_id+" "),a.foundation_space_floors_id&&(i+=a.foundation_space_floors_id)}return i}function a(e){var t=e.groups,i="-";if(t){var a=t.length;0<a&&(i="",(i=t[0].dms_groups_name)&&1<a&&(i+="(+"+(a-1)+")"))}return A.decodeHtml(i)}function n(e,t){var i,a,n,o,s=e.temperatures,r=e.airConditioner,l="-",d="-",c=!1;r&&r.temperatureReference&&-1<r.temperatureReference.indexOf("WaterOutlet")&&(c=!0),!s||0<s.length&&(c&&(o=$.grep(s,function(e){return"AirConditioner.Indoor.WaterOutlet"==e.id}))&&o.length&&void 0!==(o=o[0]).desired&&(d=o.desired.toFixed(1)),(o=$.grep(s,function(e){return"AirConditioner.Indoor.Room"==e.id}))&&o.length&&(o=o[0],c||void 0!==o.desired&&(d=o.desired.toFixed(1)),void 0!==o.current&&(l=o.current.toFixed(1))),(o=$.grep(s,function(e){return"AirConditioner.Indoor.DHW"==e.id}))&&o.length&&(void 0!==(o=o[0]).desired&&(i=o.desired.toFixed(1)),void 0!==o.current&&(a=o.current.toFixed(1))),(o=$.grep(s,function(e){return"AirConditioner.Outdoor"==e.id}))&&o.length&&(void 0!==(o=o[0]).desired&&(d=o.desired.toFixed(1)),void 0!==o.current&&(l=o.current.toFixed(1))));var p=e.modes;return p&&(o=$.grep(p,function(e){return"AirConditioner.Indoor.General"==e.id&&"Fan"==e.mode}))&&o.length&&(d="-"),n="Celsius"===y.getTemperature().unit?"\xb0C":"\u2109","-"!==d&&t&&(d+=n),"-"!==l&&t&&(l+=n),i&&t&&(i+=n),a&&t&&(a+=n),{isWaterout:c,desired:d,current:l,unit:n,dhwDesired:i,dhwCurrent:a}}function o(e,n,t){var o;return"vAuto"===t&&(o="AirConditioner.Indoor.Ventilator",t="Auto"),{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){var i,a=e.length;if("undefined"==t){for(i=0;i<a;i++)if(void 0===e[i][n])return!0}else for(i=0;i<a;i++)if(e[i][n]==t)return!o||(o===e[i].id||void 0)}},value:t}}function s(e,n,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){for(var i=e.length,a=0;a<i;a++)if(e[a][n]!=t)return;return!0}},value:t}}function d(e){return{field:e,operator:function(e){if(e)return 0===e.length||void 0}}}function c(e){var t,i,a,n,o="-";if(i=e.meters){for(o="",a=i.length,t=0;t<a;t++)(n=i[t].category)&&("AirConditionerAll"==n&&(n="SAC"),o+=n,t!=a-1&&(o+=", "));o=(o=o||"Others").toUpperCase(),o=w.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_"+o)}return o}function p(e){var t="-",i=e.type;return i&&(-1!=i.indexOf("ControlPoint")&&(i=e.mappedType),t=(t=(t=A.getDisplayType(i))||"WattHour").toUpperCase(),t=(t=w.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_"+t))||w.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATTHOUR")),t}function u(e){var t,i,a,n,o="",s=e.type;if(s&&-1!=s.indexOf("ControlPoint")){var r=e.controlPoint;r&&void 0!==r.value&&(o=A.convertNumberFormat(r.value))}else if(i=e.meters)for(a=i.length,t=0;t<a;t++)null!=(n=A.convertNumberFormat(i[t].reading))&&(o+=n,t!=a-1&&(o+=", "));return o=""!=o?o:"-"}function m(e){var t,i="-",a=e.networks;return a&&a[0]&&(a=a[0],e.type,a[t="ethernet"]&&(i=(i=a[t].ipAddress)||"-")),i}function g(e){var t,i="-",a=e.networks;return a&&a[0]&&(a=a[0],e.type,a[t="ethernet"]&&(i=(i=a[t].macAddress)||"-")),i}function f(e){var t,i,a="-",n=e.networks;return n&&n[1]&&((n=n[1]).connected?(t=e.alarms)&&0<t.length?(t.sort(function(e,t){return e=e.alarms_event?e.alarms_event:"-",(t=t.alarms_event?t.alarms_event:"-").localeCompare(e)}),"Critical"==(i=t[0].alarms_type)?a="Connected (Poor)":"Warning"==i&&(a="Connected (Fair)")):a="Connected (Good)":a="Disconnected",a=a||"-"),a}function v(e,t,i,a){var n,o,s,r=0;if((n=e.networks)&&n[0])for(s=n.length,o=0;o<s;o++)if(n[o].type==t){if(!i)return n[o];if(n[o].ble&&n[o].ble.role==i){if(void 0===a)return n[o];if(a==r)return n[o];r++}}return{}}function _(e,t){var i,a,n,o="-",s=e.networks;if(s&&s[0]){for(a=s.length,i=0;i<a;i++)if(s[i].ble){n=s[i].ble;break}n&&(o=(o=n[t])||"-")}return o}function T(e){return _(e,"macAddress")}function E(e){return _(e,"uuid")}function b(e){var t="-",i=e.rules;return i&&(t=0<i.length?"O":"X"),t}function I(e){var t="-",i=e.schedules;return i&&(t=0<i.length?"O":"X"),t}function t(e,t){var i,a="-",n=e.information;if(n&&n.versions){var o,s=(i=n.versions).length;for(o=0;o<s;o++)if(i[o].type==t){a=i[o].number?i[o].number:a;break}}return a}function C(e){var t="-";return e.controlPoint&&e.controlPoint.tagName&&(t=e.controlPoint.tagName),t}var h=window.MAIN_WINDOW,y=window.GlobalSettings,A=window.Util,w=window.I18N,S=window.kendo,D=function(e){var t="-",i=e.location;if(i){if(i.description)return i.description;t="",i.foundation_space_buildings_id&&(t+=i.foundation_space_buildings_id+" "),i.foundation_space_floors_id&&(t+=i.foundation_space_floors_id)}return t};return{isAllFloorCheck:function(){var e=!1,t=h.getCurrentFloor();return t&&t.floor&&"ALL"==t.floor.value&&(e=!0),e},getDefaultView:l,goClick:function(e,t,i,a){var n,o={};if(void 0===a){var s=window.localStorage.getItem("deviceViewType");s?(n=r.VIEW[s],window.localStorage.removeItem("deviceViewType")):n=r.VIEW[l().toUpperCase()]}else n=a;return e?t?i==h.FLOOR_NAV_BUILDING_TOTAL_ID||i==h.FLOOR_NAV_FLOOR_ALL_ID?n===r.VIEW.MAP&&(n=r.VIEW.STATISTIC):n===r.VIEW.STATISTIC&&(n=r.VIEW.MAP):n===r.VIEW.MAP?i==h.FLOOR_NAV_BUILDING_TOTAL_ID?o.building=!0:i==h.FLOOR_NAV_FLOOR_ALL_ID&&(o.floor=!0):n===r.VIEW.STATISTIC&&i!=h.FLOOR_NAV_BUILDING_TOTAL_ID&&i!=h.FLOOR_NAV_FLOOR_ALL_ID&&(o.floor=!1):(i==h.FLOOR_NAV_BUILDING_TOTAL_ID?o.building=!0:i==h.FLOOR_NAV_FLOOR_ALL_ID&&(o.floor=!0),n=r.VIEW.MAP),o.floor&&!h.getCurrentFloorList().length&&(o.floor=!1,o.noFloor=!0),o.view=n,o},getStatus:function(e){return A.getStatus(e)},getLocation:i,getCurrentLocation:function(e){var t,i,a=e.locations,n="-";if(a)for(i=a.length,t=0;t<i;t++)if("Measured"==a[t].id){n="";var o=a[t];if(o.description)return o.description;o.foundation_space_buildings_id&&(n+=o.foundation_space_buildings_id+" "),o.foundation_space_floors_id&&(n+=o.foundation_space_floors_id);break}return n},locations:i,getGroup:a,group:a,getGridIcon:function(e){var t=0,i=[],a=e.airConditioner;if(a){var n=a.peakPowerControl;n&&"On"===n&&t<5&&(i[t++]="ic-peak")}var o=e.configuration;if(o){var s=o.remoteControl;s&&"NotAllowed"===s&&t<5&&(i[t++]="ic-rc-disable")}var r=e.modes;if(r){var l=$.grep(r,function(e){return"AirConditioner.Indoor.ModeLimit"==e.id}),d=l[0]?l[0].mode:void 0;d&&("HeatOnly"===d||"CoolOnly"===d)&&t<5&&(i[t++]="ic-rock")}var c=e.temperatures;if(c){var p=[];p.push($.grep(c,function(e){return"AirConditioner.Indoor.Room.Cool.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.Room.Heat.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.WaterOutlet.Cool.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.WaterOutlet.Heat.Limit"==e.id})),p.push($.grep(c,function(e){return"AirConditioner.Indoor.DHW.Limit"==e.id}));for(var u=!1,m=p.length,g=0;g<m;g++){var f=p[g][0];if(f&&f.enabled){u=!0;break}}u&&t<5&&(i[t++]="ic-thurmo")}if(a){var v=a.defrost;v&&"On"===v&&t<5&&(i[t++]="ic-deforest"),a.filterResetRequired&&t<5&&(i[t++]="ic-filter")}var _=e.schedules;if(_&&0<_.length&&t<5&&(i[t++]="ic-schedule"),a){var T=a.spi;T&&"On"===T&&t<5&&(i[t++]="ic-spi");var E=a.chiller;if(E){var b=E.freezeProtection;b&&"On"===b&&t<5&&(i[t++]="ic-antifreeze")}}return i},getTemperatures:n,curTemperatures:function(e){var t=n(e,!0),i=t.dhwCurrent;return i?t.current+", "+i:t.current},setTemperatures:function(e){var t=n(e,!0),i=t.dhwDesired;return i?t.desired+", "+i:t.desired},curOutdoorTemperature:function(e){return n(e,!0).current},columnMode:function(e){var t=$("<div/>"),i=$("<span/>"),a=e.modes;return a=a&&a.length?a[0].mode:"-",i.text(a).appendTo(t),t.html()},filter0Depth:function(e,t,i){return{field:e,operator:t,value:i}},filter0DepthEmptyList:function(e){return{field:e,operator:function(e){if(e&&e.length)return!0}}},filter1Depth:o,filter1DepthNone:s,filter1DepthNull:d,filter1DepthObj:function(e,i,t){return{field:e,operator:function(e,t){if(""==t)return!0;if(e)if("undefined"==t){if(void 0===e[i])return!0}else if(e[i]==t)return!0},value:t}},filterStatusNoAlarm:function(e,t,i,a){var n=[];return"On"===i?n.push(o(e,t,i)):n.push(s(e,t,i)),n.push(d(a)),{logic:"and",filters:n}},filter2Depth:function(e,l,d,c){return{field:e,operator:function(e,t){if(""==t)return!0;if(e&&e.length){c="undefined"==c?void 0:c;var i,a,n,o,s,r=e.length;for(i=0;i<r;i++){if(!(o=e[i][l])||!o.length)return;for(n=o.length,a=0;a<n;a++)if(void 0!==(s=o[a][d])&&($.isFunction(t)&&(t=t(s)),s==t))return!0}}},value:c}},convertStatistic:function(e,t,i){var a,n,o,s=[];if(e==h.FLOOR_NAV_BUILDING_TOTAL_ID)for(a=0,n=t.length;a<n;a++)o={},$.each(t[a],function(e,t){"foundation_space_buildings_id"===e?e="id":"foundation_space_buildings_name"===e&&(e="name"),o[e]=t}),s.push(o);else for(a=0,n=t.length;a<n;a++)if(e==t[a].foundation_space_buildings_id){for(var r=t[a].floors,l=0,d=r.length;l<d;l++)if(o={},$.each(r[l],function(e,t){if("foundation_space_floors_id"===e)e="id";else if("foundation_space_floors_name"===e){e="name";var i=o.type;"B"===i?t=i+t:"F"==i&&(t+=i)}else"foundation_space_floors_type"===e&&(e="type");o[e]=t}),s.push(o),i){var c,p=r[l].assetTypes;if(p){var u,m,g,f,v,_=p.length;for(u=0;u<_;u++)for(c=p[u].assets_types_name,g=(f=p[u].subAssetTypes).length,m=0;m<g;m++)(v=$.extend({},o,f[m])).isSubAsset=!0,v.assets_types_name=c,s.push(v)}}var T=$.extend({},t[a]);T.id=T.foundation_space_buildings_id,T.name="All",s.push(T);break}return s},convertDisplayName:function(e){return e&&e.length>r.DISPLAY_NAME_MAX?e.substr(0,r.DISPLAY_NAME_MAX):e},getAccureFilter:function(e,t,i,a,n){var o;if(o=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length){var s={logic:"and",filters:t};o.filters.push(s)}if(i&&i.length){var r={logic:"or",filters:i};o.filters.push(r)}if(a&&a.length){var l={logic:"or",filters:a};o.filters.push(l)}if(n&&n.length){var d={logic:"or",filters:n};o.filters.push(d)}return o},getAccureFilterOlder:function(e,t,i,a,n){var o;o=e&&e.length?{logic:"and",filters:e}:{logic:"and",filters:[]},t&&t.length&&(o={logic:"and",filters:[o,{logic:"and",filters:t}]});i&&i.length&&(o={logic:"and",filters:[o,{logic:"or",filters:i}]});a&&a.length&&(o={logic:"and",filters:[o,{logic:"or",filters:a}]});n&&n.length&&(o={logic:"and",filters:[o,{logic:"or",filters:n}]});return o},calcScreenBySelect:function(e,t,i){var a=e.length;return 0<a?w.prop("FACILITY_DEVICE_SELECTED",a):void 0===t||void 0===i?"":w.prop("FACILITY_DEVICE_NO_SELECTED_TOTAL",t,i)},calcScreenByOnlySelect:function(e){var t=e.length;return 0<t?w.prop("FACILITY_DEVICE_SELECTED",t):w.prop("FACILITY_DEVICE_NO_SELECTED")},getTempHumiTemperature:function(e,t){var i="-",a=e.temperatures,n=e.type;if(n&&-1!=n.indexOf("ControlPoint")){var o=e.mappedType;if(o&&-1!=o.indexOf("Temperature")){var s=e.controlPoint;s&&void 0!==s.value&&(i=s.value)}}else a&&a[0]&&(i=(a=a[0]).current);"-"==(i=A.convertNumberFormat(i))||t||(i+="Celsius"===y.getTemperature().unit?"\xb0C":"\u2109");return i},getTempHumiHumidity:function(e,t){var i="-",a=e.humidities,n=e.type;if(n&&-1!=n.indexOf("ControlPoint")){var o=e.mappedType;if(o&&-1!=o.indexOf("Humidity")){var s=e.controlPoint;s&&void 0!==s.value&&(i=s.value)}}else a&&a[0]&&(i=(a=a[0]).current);return"-"==(i=A.convertNumberFormat(i))||t||(i+="%"),i},getMotionPresence:function(e){var t="-",i=e.presences;return i&&i[0]&&(t=(t=(i=i[0]).detected)?w.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"):w.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE")),t},getMacAddress:g,getIpAddress:m,getWifiIpAddress:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.ipAddress)||"-"),t},getWifiMacAddress:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.macAddress)||"-"),t},getWifiChannel:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.channel)||"-"),t},getWifiRssi:function(e){var t="-",i=e.networks;return i&&i[1]&&(i=i[1]).wifi&&(t=(t=i.wifi.rssi)||"-"),t},getCCTVWifiStatus:f,getCCTVDataStatus:function(e){var t="Off",i=e.cctvs;return i&&i[0]&&"On"==(i=i[0]).dataStatus&&(t="On"),t},getCCTVWifiTxPower:function(e){var t="-",i=e.wifi;return i&&(t=(t=i.txPower)||"-"),t},getCCTVWifiType:function(e){var t="-",i=e.networks;return i&&i[1]&&("WiFi2.4GHz"==(i=i[1]).type?t="2.4GHz":"WiFi5GHz"==i.type&&(t="5GHz"),t=t||"-"),t},getCCTVWifiTotal:function(e){var t="-",i=e.wifi;return(i=i&&i.statistics)&&i.channelUtilization&&(t=(t=i.channelUtilization.total)||"-"),t},getCCTVWifiNoneWifi:function(e){var t="-",i=e.wifi;return(i=i&&i.statistics)&&i.channelUtilization&&(t=(t=i.channelUtilization["non802.11"])||"-"),t},getCCTVWifiInterfererDataSource:function(e){var t=[],i=e.wifi;return(i=i&&i.statistics)&&i.interferers&&(t=i.interferers),t},getBleObject:_,getBleMacAddress:T,getBleUUID:E,getBleMajor:function(e){return _(e,"major")},getBleMinor:function(e){return _(e,"minor")},getBleTxPower:function(e){var t=_(e,"txPower");return"999"!=t&&999!=t||(t="-"),t},getBle1mRssi:function(e){return _(e,"calibratedTxPower")},getBleSignalLevel:function(e){var t=_(e,"rssi");return"-"!=t&&(t+=" dBm"),t},getBleBatteryLevel:function(e){var t,i="-",a=e.information;return a&&a.power&&(t=a.power.batteryLevel)&&(i=t||"-"),i},getBleWritable:function(e){var t=_(e,"writable");return t="-"==t?"READ Only":"READ / WRITE"},getBleAdvertisingName:function(e){return _(e,"advertisingName")},getBleAdvertisingInterval:function(e){return _(e,"advertisingInterval")},getNetworkInterface:v,getNetworkInterfaceIndex:function(e,t,i,a,n){var o,s,r,l=0;if((o=e.networks)&&o[0])for(r=o.length,s=0;s<r;s++)if(o[s].type==t){if(!i)return s;if(o[s].ble&&o[s].ble.role==i){if(null==a)return s;if(a==l)return s;l++}}return n?-1:0},getBleObjectFromNetwork:function(e,t){var i="-";return e&&e.ble&&(i=void 0!==(i=e.ble[t])?i:"-"),i},getWifiObjectFromNetwork:function(e,t){var i="-";return e&&e.wifi&&(i=void 0!==(i=e.wifi[t])?i:"-"),i},getZigbeeStatus:function(e){return v(e,"Zigbee").enabled?"Normal.On":"Normal.Off"},getBleStatus:function(e){return v(e,"BLE","Scanner").enabled?"Normal.On":"Normal.Off"},getBleInterfaceStatus:function(e,t){return v(e,"BLE","Advertiser",t).enabled?"Normal.On":"Normal.Off"},getHasSchedule:I,getHasRule:b,getDescription:function(e){var t="-",i=e.description;return i&&(t=i),A.decodeHtml(t)},getFirmwareVersion:function(e){return t(e,"Firmware")},getZigbeeFirmwareVersion:function(e){return t(e,"Firmware.Zigbee")},getBleFirmwareVersion:function(e){return t(e,"Firmware.BLE")},getBleAppVersion:function(e){return t(e,"Application.BLE")},getHardwareVersion:function(e){return t(e,"Hardware")},getSoftwareVersion:function(e){return t(e,"Software")},getApiVersion:function(e){return t(e,"API")},getPowerAvailableSource:function(e){var t="-",i=e.information;return i&&i.power&&((t=i.power.availableSources||"-")instanceof S.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},getPowerCurrentSource:function(e){var t="-",i=e.information;return i&&i.power&&((t=i.power.currentSource||"-")instanceof S.data.ObservableArray||$.isArray(t))&&(t=t.join(", ")),t},sortableLocation:function(e,t){return e=(e=i(e))||"-",t=(t=i(t))||"-",e.localeCompare(t)},sortableGroup:function(e,t){return e=(e=a(e))||"-",t=(t=a(t))||"-",e.localeCompare(t)},getLocationSort:function(){var e=h.getCurrentFloor(),t=!0;return e.building.id!=h.FLOOR_NAV_BUILDING_TOTAL_ID&&e.floor.id!=h.FLOOR_NAV_FLOOR_TOTAL_ID||(t=!1),t?[{field:"locations",dir:"asc",compare:function(e,t){var i,a;i=e.locations,a=t.locations;var n="-",o="-";return i=i&&i[0]?i[0]:"-",a=a&&a[0]?a[0]:"-","-"!=i&&(i.foundation_space_zones_id||(n="\u03a9"+(n=e.name))),"-"!=a&&(a.foundation_space_zones_id||(o="\u03a9"+(o=t.name))),n.localeCompare(o)}}]:[]},getPointTagName:C,sortablePointTagName:function(e,t){return e=C(e),t=C(t),e.localeCompare(t)},sortablePointValue:function(e,t){var i,a;return e.controlPoint&&(i=e.controlPoint.value),t.controlPoint&&(a=t.controlPoint.value),i-a},sortableMeterType:function(e,t){var i,a;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return i=p(e),a=p(t),i.localeCompare(a)},sortableMeterCategoryType:function(e,t){var i,a;if(e.meters&&e.meters[0]&&t.meters&&t.meters[0])return i=c(e),a=c(t),i.localeCompare(a)},sortableMacAddress:function(e,t){return e=(e=g(e))||"-",t=(t=g(t))||"-",e.localeCompare(t)},sortableBleMacAddress:function(e,t){return e=T(e),t=T(t),e.localeCompare(t)},sortableIpAddress:function(e,t){return e=(e=m(e))||"-",t=(t=m(t))||"-",e.localeCompare(t)},sortableHasSchedule:function(e,t){return e=I(e),t=I(t),e.localeCompare(t)},sortableHasRule:function(e,t){return e=b(e),t=b(t),e.localeCompare(t)},sortableBeaconUUID:function(e,t){return e=E(e),t=E(t),e.localeCompare(t)},sortableCCTVWifiStatus:function(e,t){return e=f(e),t=f(t),e.localeCompare(t)},getIndoorMode:function(e){var t="-",i=A.getRecentAlarm(e);return t=i?(t=i.type,w.prop("FACILITY_DEVICE_STATUS_"+t.toUpperCase())||t):A.getDisplayModeI18N(e.modes,e.operations,!0," / ")},getAssetType:function(e){return(e.assets_types_name?e.assets_types_name:"-")+" / "+(e.subAssetType?e.subAssetType:"-")},getAssetLocation:D,getAssetUsers:function(e){var t="-",i=e.users;if(i&&i[0]){t="";var a,n=i.length;for(a=0;a<n;a++)t+=i[a].ums_users_name,a!=n-1&&(t+=", ")}return t},getMeterCategoryType:c,getMeterType:p,getMeterCurrentConsumption:u,getMeterCurrentConsumptionUnit:function(e){var t=e.type,i=e.mappedType,a="",n=window.Util;return a="Meter.Gas"==t||"Meter.Gas"==i?n.CHAR.Gas:"Meter.WattHour"==t||"Meter.WattHour"==i?n.CHAR.WattHour:"Meter.Water"==t||"Meter.Water"==i?n.CHAR.Water:"",u(e)+a},getDimmingLevel:function(e){var t,i="-",a=e.lights||e.light;return a&&a[0]&&(i=void 0===(t=(a=a[0]).dimmingLevel)?"-":Math.round(t)+"%"),i},getTempWeatherStation:function(e){var t="-",i=e.configuration;return i&&i.locationType&&(t=i.locationType),t},getTempWeatherStationOx:function(e){var t="-",i=e.configuration;return i&&i.locationType&&(t="Outdoor"==(t=i.locationType)?"O":"X"),t},getPointValue:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.value&&(t=i.value),t},getAssetUserName:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_name),t},getAssetUserID:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_id),t},getAssetUserEmail:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_email),t},getAssetUserOrganization:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_organization?i[0].ums_users_organization:"-"),t},getAssetUserWorkPhoneNumber:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_workPhoneNumber?i[0].ums_users_workPhoneNumber:"-"),t},getAssetUserMobilePhoneNumber:function(e){var t="-",i=e.users;return i&&i[0]&&(t=i[0].ums_users_mobilePhoneNumber?i[0].ums_users_mobilePhoneNumber:"-"),t},getAssetDeviceID:function(e){var t="-",i=e.devices;return i&&i[0]&&(t=i[0].dms_devices_id),t},getAssetDeviceName:function(e){var t="-",i=e.devices;return i&&i[0]&&(t=i[0].dms_devices_name),t},getEnergyMappingOutdoorList:function(c){var p,u=new $.Deferred,m=h.getCurrentBuildingList();return $.ajax({url:"/foundation/space/floors"}).done(function(e){p=e,$.ajax({url:"/dms/devices?types=AirConditionerOutdoor&registrationStatuses=Registered&attributes=id,name,locations"}).done(function(e){var t,i,a,n,o,s,r,l,d=e.length;for(s=0;s<d;s++){if((t=e[s]).locations&&t.locations[0]){for(n=t.locations[0].foundation_space_buildings_id,o=t.locations[0].foundation_space_floors_id,l=m.length,r=0;r<l;r++)if(n==(i=m[r]).id){t.building_group_value=S.toString(i.sortOrder,"0000")+"_"+i.id+"_"+i.name;break}for(l=p.length,r=0;r<l;r++)if(o==(a=p[r]).id){t.floor_group_value=S.toString(a.sortOrder,"0000")+"_"+a.id+"_"+A.getFloorName(a);break}}for(t.assigned=!1,l=c.length,r=0;r<l;r++)if(t.id==c[r].dms_devices_id){t.assigned=!0;break}}u.resolve(e)}).fail(function(e){u.reject(e)})}).fail(function(e){u.reject(e)}),u.promise()},isEnableEnergyMappingType:function(e){var t,i,a=e.mappedType||e.type,n=e.meters;if(!n)return!1;var o,s=n.length;for(o=0;o<s;o++)"AirConditionerAll"==n[o].category&&(t=n[o].category),"AirConditionerOutdoor"==n[o].connectedDeviceType&&(i=n[o].connectedDeviceType);return!("Meter.WattHour"!=a||!t||!i)},getEnergyMappingFieldName:function(e){var t=0,i=e.meters;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("AirConditionerAll"==i[a].category&&"AirConditionerOutdoor"==i[a].connectedDeviceType){t=a;break}}return"meters["+t+"].connectedDevices"},getMeterConnectedDevices:function(e){var t=0,i=e.meters;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("AirConditionerAll"==i[a].category&&"AirConditionerOutdoor"==i[a].connectedDeviceType){t=a;break}}return i[t]&&i[t].connectedDevices?i[t].connectedDevices:null},getDeviceRegistrationFailMsg:function(e){return 406==e.status&&-1!=e.responseText.indexOf("Count")?w.prop("FACILITY_DEVICE_COUNT_EXCEEDED"):A.parseFailResponse(e)},getConnectedDevicesConsumptionTypeList:function(e){var t={AirConditionerAll:{name:w.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_SAC"),id:"AirConditionerAll"},Light:{name:w.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_LIGHT"),id:"Light"},Others:{name:w.prop("FACILITY_DEVICE_ENERGY_METER_CATEGORY_TYPE_OTHERS"),id:"Others"}},i=[];return i.push(t.AirConditionerAll),"Meter.WattHour"===e&&i.push(t.Light),i.push(t.Others),i},getConnectedDevicesConnectionTypeList:function(e,t){var i={None:{name:"None",id:"None"},AirConditioner:{name:A.getDetailDisplayTypeDeviceI18N("SAC Indoor"),id:"AirConditioner"},AirConditionerOutdoor:{name:A.getDetailDisplayTypeDeviceI18N("SAC Outdoor"),id:"AirConditionerOutdoor"},Boiler:{name:A.getDetailDisplayTypeDeviceI18N("Boiler"),id:"Boiler"},CoolingTower:{name:A.getDetailDisplayTypeDeviceI18N("CoolingTower"),id:"CoolingTower"},Pump:{name:A.getDetailDisplayTypeDeviceI18N("Pump"),id:"Pump"},WaterTank:{name:A.getDetailDisplayTypeDeviceI18N("WaterTank"),id:"WaterTank"}},a=[];return"AirConditionerAll"===t&&("Meter.WattHour"===e?a.push(i.AirConditioner,i.AirConditionerOutdoor,i.Pump,i.CoolingTower,i.Boiler):"Meter.Gas"===e?a.push(i.Boiler):"Meter.Water"===e&&a.push(i.WaterTank)),a.push(i.None),a},filterHasListAttrItem:function(e,t){return{field:e,operator:function(e){return e&&e.length?t:!t}}}}}),define("device/common/device-template",["device/common/device-util","device/common/device-constants"],function(N,c){"use strict";function t(e,t,i){var a=e.sender,n=a.dataSource.view(),o=$.grep(n,function(e){return"all"==e.name.toLowerCase()});if(o&&o.length){var s=a.element;s.find(".customStatisticRowStyles").remove();var r=a.items().first().clone();r.attr("data-uid",""),r.data("uid","");var l=r.find("td[role='gridcell']");if(!l.length)return;var d;if(o=o[0],a.dataSource.remove(o),d=o.name,$(l.get(0)).html(d),t){var c=void 0!==o.numberOfSubAssetTypes?o.numberOfSubAssetTypes:"-",p=void 0!==o.numberOfRegisteredAssets?o.numberOfRegisteredAssets:"-",u=void 0!==o.numberOfNormalDevices?o.numberOfNormalDevices:"-",m=void 0!==o.numberOfDisconnectedDevices?o.numberOfDisconnectedDevices:"-",g=void 0!==o.numberOfLowBatteryDevices?o.numberOfLowBatteryDevices:"-",f=void 0!==o.numberOfOutOfBoundsDevices?o.numberOfOutOfBoundsDevices:"-";$(l.get(1)).html(c),$(l.get(2)).html(p),$(l.get(3)).html(u),$(l.get(4)).html(m),$(l.get(5)).html(g).addClass("text-err"),$(l.get(6)).html(f).addClass("text-err")}else if(i)$(l.get(1)).html(W(o)),$(l.get(2)).html(U(o)),$(l.get(3)).html(Y(o)),$(l.get(4)).html(G(o)),$(l.get(5)).html(z(o)),$(l.get(6)).html(H(o)),$(l.get(7)).html(j(o)),$(l.get(8)).html(Z(o));else{var v=x(o),_=F(o),T=B(o),E=V(o),b=P(o);$(l.get(1)).html(v);var I,C,h,y,A,w,S,D=l.length;if(7==D)I=void 0!==o.numberOfOnIndoorDevices?o.numberOfOnIndoorDevices:"-",C=void 0!==o.numberOfOnVentilatorDevices?o.numberOfOnVentilatorDevices:"-",h=void 0!==o.numberOfOnDHWDevices?o.numberOfOnDHWDevices:"-",y=void 0!==o.numberOfOffIndoorDevices?o.numberOfOffIndoorDevices:"-",A=void 0!==o.numberOfOffVentilatorDevices?o.numberOfOffVentilatorDevices:"-",w=void 0!==o.numberOfOffDHWDevices?o.numberOfOffDHWDevices:"-",S=void 0!==o.numberOfSchedules?o.numberOfSchedules:"-",$(l.get(2)).html(I+"/"+C+"/"+h),$(l.get(3)).html(y+"/"+A+"/"+w),$(l.get(4)).html(_).addClass("text-err"),$(l.get(5)).html(T).addClass("text-err"),$(l.get(6)).html(S);else if(6==D)$(l.get(2)).html(E),$(l.get(3)).html(b),$(l.get(4)).html(_).addClass("text-err"),$(l.get(5)).html(T).addClass("text-err");else if(5==D){var O;O=k(o),$(l.get(2)).html(O),$(l.get(3)).html(_).addClass("text-err"),$(l.get(4)).html(T).addClass("text-err")}}r.addClass("customStatisticRowStyles"),s.find(".k-grid-header table thead").append(r)}}var e=window.kendo,L=window.Util,R=window.I18N,y=window.GlobalSettings,M=y.getLocale(),p=y.getTemperature().unit,B=function(e){return'<span class="text-err">'+(void 0!==e.numberOfWarningDevices?e.numberOfWarningDevices:"-")+"</span>"},F=function(e){return'<span class="text-err">'+(void 0!==e.numberOfCriticalDevices?e.numberOfCriticalDevices:"-")+"</span>"},x=function(e){return void 0!==e.numberOfRegisteredDevices?e.numberOfRegisteredDevices:"-"},k=function(e){return void 0!==e.numberOfNormalDevices?e.numberOfNormalDevices:"-"},V=function(e){return void 0!==e.numberOfOnDevices?e.numberOfOnDevices:"-"},P=function(e){return void 0!==e.numberOfOffDevices?e.numberOfOffDevices:"-"},W=function(e){return"<div class='tb beacon'><span class='tbc col-1'>"+x(e)+"</span></div>"},U=function(e){var t=void 0!==e.numberOfFixedDevices?e.numberOfFixedDevices:"-",i=void 0!==e.numberOfMovableDevices?e.numberOfMovableDevices:"-";return"<div class='tb beacon'><span class='tbc col-2'>"+R.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED_TYPE")+"</span><span class='tbc col-3'>"+t+"</span></div><div class='tb beacon'><span class='tbc col-2'>"+R.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE_TYPE")+"</span><span class='tbc col-3'>"+i+"</span></div>"},Y=function(e){return"<div class='tb beacon'><span class='tbc col-4'>"+(void 0!==e.numberOfFixedNormalDevices?e.numberOfFixedNormalDevices:"-")+"</span></div><div class='tb beacon'><span class='tbc col-4'>"+(void 0!==e.numberOfMovableNormalDevices?e.numberOfMovableNormalDevices:"-")+"</span></div>"},G=function(e){return"<div class='tb beacon'><span class='tbc col-5'>"+(void 0!==e.numberOfFixedCriticalDevices?e.numberOfFixedCriticalDevices:"-")+"</span></div><div class='tb beacon'><span class='tbc col-5'>"+(void 0!==e.numberOfMovableCriticalDevices?e.numberOfMovableCriticalDevices:"-")+"</span></div>"},z=function(e){return"<div class='tb text-err beacon'><span class='tbc col-6'>"+(void 0!==e.numberOfFixedWarningDevices?e.numberOfFixedWarningDevices:"-")+"</span></div><div class='tb text-err beacon'><span class='tbc col-6'>"+(void 0!==e.numberOfMovableWarningDevices?e.numberOfMovableWarningDevices:"-")+"</span></div>"},H=function(e){return"<div class='tb text-err beacon'><span class='tbc col-7'>"+(void 0!==e.numberOfFixedLowBatteryDevices?e.numberOfFixedLowBatteryDevices:"-")+"</span></div><div class='tb text-err beacon'><span class='tbc col-7'>"+(void 0!==e.numberOfMovableLowBatteryDevices?e.numberOfMovableLowBatteryDevices:"-")+"</span></div>"},j=function(e){return"<div class='tb beacon'><span class='tbc col-8'>"+(void 0!==e.numberOfFixedSchedules?e.numberOfFixedSchedules:"-")+"</span></div><div class='tb beacon'><span class='tbc col-8'>"+(void 0!==e.numberOfMovableSchedules?e.numberOfMovableSchedules:"-")+"</span></div>"},Z=function(e){return"<div class='tb beacon'><span class='tbc col-9'>"+(void 0!==e.numberOfFixedRules?e.numberOfFixedRules:"-")+"</span></div><div class='tb beacon'><span class='tbc col-9'>"+(void 0!==e.numberOfMovableRules?e.numberOfMovableRules:"-")+"</span></div>"},i='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</li><li><span class="disc r"></span>'+R.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+R.prop("FACILITY_DEVICE_STATUS_WARNING")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-peak"></Label>'+R.prop("FACILITY_INDOOR_STATUS_PEAK")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-deforest"></Label>'+R.prop("FACILITY_INDOOR_STATUS_DEFROST")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-filter" ></Label>'+R.prop("FACILITY_INDOOR_STATUS_FILTER_WARNING")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-rc-disable"></Label>'+R.prop("FACILITY_INDOOR_STATUS_RC_OFF")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-rock"></Label>'+R.prop("FACILITY_INDOOR_STATUS_OPERATION_LIMIT")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-thurmo"></Label>'+R.prop("FACILITY_INDOOR_TEMPERATURE_LIMIT")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-schedule"></Label>'+R.prop("FACILITY_DEVICE_SAC_INDOOR_SCHEDULE")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-spi"></Label>'+R.prop("FACILITY_INDOOR_CONTROL_SPI")+'</li><li data-bind="invisible : hideIndoorLegend"><Label class="ic-antifreeze"></Label>'+R.prop("FACILITY_INDOOR_STATUS_FREEZE_PROTECTION")+"</li></ul></div>",a='<div class="flyoutBox lg"><ul class="legendList"><li><span class="disc g"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</li><li class="no-block"><span class="disc r"></span>'+R.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li class="no-block"><span class="disc y"></span>'+R.prop("FACILITY_DEVICE_STATUS_WARNING")+'</li></ul><ul class="legendList"><li><span class="disc gr"></span>'+R.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED")+'</li><li><span class="disc measured gr"></span>'+R.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE")+"</li></ul></div>",n='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+"</li></ul></div>",o='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</li><li><span class="disc r"></span>'+R.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+R.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li></ul></div></div>",s='<div class="flyoutBox"><ul class="legendList"><li><span class="disc g"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</li><li><span class="disc m"></span>'+R.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</li><li><span class="disc r"></span>'+R.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</li><li><span class="disc y"></span>'+R.prop("FACILITY_DEVICE_STATUS_WARNING")+"</li></ul></div></div>",u=e.template('<span title="" class="k-widget k-dropdown k-header common-grid-dropdown sac-indoor-dropdownlist"unselectable="on" role="listbox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-owns="" aria-disabled="false" aria-busy="false"aria-activedescendant="80142285-e564-4717-88fa-3dd3d64ad025" data-field="#=field#"><span unselectable="on" class="k-dropdown-wrap #if(disabled){#k-state-disabled#}else{#k-state-default#}#"><span unselectable="on" class="k-input">#=text#</span><span unselectable="on" class="k-select" aria-label="select"><span class="k-icon k-i-arrow-60-down"></span></span></span><input class="sac-indoor-dropdownlist current-limit" data-value="#=value#" style="display: none;"></span>');return{mapListTemplate:function(e){var t=!1,i=e.operations,a=e.type,n=e.modes,o=e.mappedType,s=e.name,r=e.id,l=L.getStatus(e);l&&"Alarm"==(l=1<(l=l.split(".")).length?(L.isOnlyNormalType(e)&&l[0],l[1]):"Off")[0]&&(t=!0);var d=e.modes;t?d=l[0]:d&&0<d.length&&(d=L.getDisplayMode(n,i));return'<div class="device-map-panel-list-item">'+("<span class='detail-img "+l+" "+d+"' data-status='"+l+"' data-mode='"+d+"' data-type='"+a+"' data-mapped-type='"+o+"'></span>")+("<div class='detail-text'><span class='id'>"+r+"</span><span class='name'>"+L.decodeHtml(s)+"</span></div>")+("<span class='ic ic-info' data-id='"+r+"'></span>")+"</div>"},multiDetailListTemplate:function(e,t){var i="",a="",n="",o="",s=e.operations,r=e.modes;n=e.name;var l=!1;(a=L.getStatus(e))&&"Alarm"==(a=1<(a=a.split(".")).length?(o=a[0],L.isOnlyNormalType(e)&&"Alarm"!=a[0]||(o+="("+a[1]+")"),a[1]):(o=a[0],"Off"))[0]&&(l=!0),i=e.modes,l?i=a[0]:i&&0<i.length&&(i=L.getDisplayMode(r,s));var d="",c=e.type;return t&&c&&-1==c.indexOf("AirConditioner.")&&(d=L.getDisplayClassType(e)),"<span class='detail-img "+a+" "+i+" "+d+"'></span>"+(n="<span data-bind='text: name'>"+L.decodeHtml(n)+"</span>")+(a="<span class='panel-item-temp'><span>"+L.getStatusI18N(o)+"</span></span>")},detailPopupGroupListTemplate:function(e){var t=e.dms_devices_name,i=e.dms_devices_id,a=e.dms_devices_type,n=e.dms_devices_mappedType;return"ControlPoint"!=n&&(a=n||a),'<div class="device-detail-popup-group-list-item">'+("<span class='detail-img reg selected "+(a=L.getDisplayClassType(a))+"'></span>")+("<div class='detail-text'><span class='id'>"+i+"</span><span class='name'>"+L.decodeHtml(t)+"</span></div>")+"</div>"},multiDetailRegisterListTemplate:function(e){var t="",i="",a="",n="",o=e.operations,s=e.modes;e.type;a=e.name;var r=!1,l="unreg";return"Registered"==e.registrationStatus&&(l="reg"),(i=L.getStatus(e))&&"Alarm"==(i=1<(i=i.split(".")).length?(n=i[0],L.isOnlyNormalType(e)&&"Alarm"!=i[0]||(n+="("+i[1]+")"),i[1]):(n=i[0],"Off"))[0]&&(r=!0),"Alarm"==i[0]&&(r=!0),r?t=i[0]:t&&0<t.length&&(t=L.getDisplayMode(s,o)),"<span class='detail-img "+l+" "+L.getDisplayClassType(e)+"'></span>"+(a="<span data-bind='text: name'>"+L.decodeHtml(a)+"</span>")+(i="<span class='panel-item-temp'><span>"+n+"</span></span>")},multiDetailListDualTemplate:function(e,t,i){var a="",n="",o="",s="",r=e.operations,l=e.modes,d=void 0!==e.assets_types_id,c="name";d?void 0!==e.number&&null!==e.number&&""!==e.number?(o=e.number,c="number"):e.devices&&e.devices[0]&&(o=e.devices[0].dms_devices_name,c="devices[0].dms_devices_name"):o=e.name;var p=!1;(n=L.getStatus(e))&&"Alarm"==(n=1<(n=n.split(".")).length?(s=n[0],L.isOnlyNormalType(e)&&"Alarm"!=n[0]||(s+="("+n[1]+")"),n[1]):(s=n[0],"Off"))[0]&&(p=!0),a=e.modes,p?a=n[0]:a&&0<a.length&&(a=L.getDisplayMode(l,r));var u=e.type,m="",g=L.getPositionType(e);return m=d?t?"-"!=g&&"Movable"==g?"asset "+e.assets_types_name.toLowerCase()+" movable-reg":"asset "+e.assets_types_name.toLowerCase()+" reg":("-"!=g&&"Movable"==g&&(m="asset "+e.assets_types_name.toLowerCase()+" "+n+" movable"),"asset "+e.assets_types_name.toLowerCase()+" "+n):t?"-"!=g&&"Movable"==g?L.getDisplayClassType(e)+" movable-reg":L.getDisplayClassType(e)+" reg":-1!=u.indexOf("AirConditioner.")?n+" "+a:"-"!=g&&"Movable"==g?n+" "+a+" "+L.getDisplayClassType(e)+" movable":n+" "+a+" "+L.getDisplayClassType(e),i&&(m+=" selected"),"<span class='detail-img "+m+"'></span>"+(o="<span data-bind='text: "+c+"'>"+L.decodeHtml(o)+"</span>")+(n="<span class='panel-item-temp'><span>"+L.getStatusI18N(s)+"</span></span>")},mapListRegTemplate:function(e){var t=!1,i=e.operations,a=e.type,n=e.modes,o=e.mappedType,s=e.name,r=e.id,l=L.getStatus(e);l&&"Alarm"==(l=1<(l=l.split(".")).length?(L.isOnlyNormalType(e)&&l[0],l[1]):"Off")[0]&&(t=!0);var d=e.modes;t?d=l[0]:d&&0<d.length&&(d=L.getDisplayMode(n,i)),a=e.type;return'<div class="device-map-panel-list-item">'+("<span class='detail-img reg "+L.getDisplayClassType(e)+"' data-status='"+l+"' data-mode='"+d+"' data-type='"+a+"' data-mapped-type='"+o+"'></span>")+("<div class='detail-text'><span class='id'>"+r+"</span><span class='name'>"+L.decodeHtml(s)+"</span></div>")+("<span class='ic ic-info' data-id='"+r+"'></span>")+"</div>"},mapListDualTemplate:function(e,t){var i=!1,a=e.operations,n=e.type,o=e.modes,s=e.mappedType,r=e.name,l=e.id,d=L.getStatus(e);d&&"Alarm"==(d=1<(d=d.split(".")).length?(L.isOnlyNormalType(e)&&d[0],d[1]):"Off")[0]&&(i=!0);var c=e.modes;i?c=d[0]:c&&0<c.length&&(c=L.getDisplayMode(o,a)),n=e.type;var p=L.getPositionType(e);return'<div class="device-map-panel-list-item">'+("<span class='detail-img "+(t?"-"!=p&&"Movable"==p?L.getDisplayClassType(e)+" movable-reg":L.getDisplayClassType(e)+" reg":-1!=n.indexOf("AirConditioner.")?d+" "+c:"-"!=p&&"Movable"==p?d+" "+c+" "+L.getDisplayClassType(e)+" movable":d+" "+c+" "+L.getDisplayClassType(e))+"' data-status='"+d+"' data-mode='"+c+"' data-type='"+n+"' data-mapped-type='"+s+"'></span>")+("<div class='detail-text'><span class='id'>"+l+"</span><span class='name'>"+L.decodeHtml(r)+"</span></div>")+("<span class='ic ic-info' data-id='"+l+"'></span>")+"</div>"},getDeviceCardTemplate:function(e){var t=L.getStatus(e);t=t.replace(".","-");var i=N.getLocation(e),a=$("<div/>"),n=$("<div/>").addClass("engCardWrap").attr("data-uid",e.uid).attr("data-id",e.id);e.selected&&n.addClass("k-state-selected");var o=$("<div/>").addClass("engCard "+t),s=$("<div/>").addClass("tb icon"),r=$("<div/>").addClass("bound"),l=e.type,d=e.mappedType,c=void 0!==e.assets_types_id,p="ic-energy";l?-1!=l.indexOf("Light")||d&&-1!=d.indexOf("Light")?p="ic-light":-1!=l.indexOf("SmartPlug")?p="ic-smartplug":-1!=l.indexOf("Temperature")||-1!=l.indexOf("Humidity")||d&&-1!=d.indexOf("Temperature")||d&&-1!=d.indexOf("Humidity")?p="ic-temperature":-1!=l.indexOf("Gateway")?p="ic-gateway":-1!=l.indexOf("Beacon")?p="ic-beacon":-1!=l.indexOf("CCTV")?p="ic-cctv":(-1!=l.indexOf("Motion")||d&&-1!=d.indexOf("Motion"))&&(p="ic-motion"):c&&(p="asset "+e.assets_types_name.toLowerCase());var u=$("<span/>").addClass("dvcic "+p);r.append(u),s.append(r),o.append(s);var m=$("<div/>").addClass("txtwrap"),g=t.split("-"),f="";if("Normal"==g[0]){var v;l&&-1!=l.indexOf("Meter")||d&&-1!=d.indexOf("Meter")?(v="Meter.Gas"==l||"Meter.Gas"==d?L.CHAR.Gas:"Meter.WattHour"==l||"Meter.WattHour"==d?L.CHAR.WattHour:"Meter.Water"==l||"Meter.Water"==d?L.CHAR.Water:"",t=N.getMeterCurrentConsumption(e),t+="<span class='unit'>"+v+"</span>"):l&&-1!=l.indexOf("Temperature")||d&&-1!=d.indexOf("Temperature")?(t=N.getTempHumiTemperature(e,!0),t+="<span class='unit'>"+(v=L.CHAR[y.getTemperature().unit])+"</span>"):l&&-1!=l.indexOf("Humidity")||d&&-1!=d.indexOf("Humidity")?(v=L.CHAR.Humidity,t=N.getTempHumiHumidity(e,!0),t+="<span class='unit'>"+v+"</span>"):l&&-1!=l.indexOf("Motion")||d&&-1!=d.indexOf("Motion")?t=N.getMotionPresence(e):(t=g[0],L.isOnlyNormalType(e)&&"Alarm"!=t[0]||(t+="("+g[1]+")"))}else{t=g[1];var _=L.getRecentAlarm(e);_&&(f=c||l&&("Beacon"==l||"Gateway"==l||"CCTV"==l)?L.getAlarmDescription(_.name):"Code "+_.name)}var T=$("<p/>").addClass("cardName ellp").html(L.getStatusI18N(t)),E=$("<p/>").addClass("cardDesc ellp").text(f),b=$("<p/>").addClass("loc ellp").text(i),I="";I=c?e.number:e.name;var C=$("<p/>").addClass("dvc ellp").text(I),h=$("<i/>").addClass("ic ic-info").attr("data-id",e.id);return m.append(T),m.append(E),m.append(b),m.append(C),m.append(h),o.append(m),n.append(o),a.append(n),a.html()},statisticNumberOfCritical:F,statisticNumberOfWarning:B,statisticNumberOfRegisteredDevice:x,statisticNumberOfNormalDevices:k,statisticNumberOfOnDevices:V,statisticNumberOfOnIndoorDevices:function(e){return(void 0!==e.numberOfOnIndoorDevices?e.numberOfOnIndoorDevices:"-")+"/"+(void 0!==e.numberOfOnVentilatorDevices?e.numberOfOnVentilatorDevices:"-")+"/"+(void 0!==e.numberOfOnDHWDevices?e.numberOfOnDHWDevices:"-")},statisticNumberOfOffDevices:P,statisticNumberOfOffIndoorDevices:function(e){return(void 0!==e.numberOfOffIndoorDevices?e.numberOfOffIndoorDevices:"-")+"/"+(void 0!==e.numberOfOffVentilatorDevices?e.numberOfOffVentilatorDevices:"-")+"/"+(void 0!==e.numberOfOffDHWDevices?e.numberOfOffDHWDevices:"-")},getStatusTemplate:function(e){var t=L.getStatus(e);return"<div><span class='circle-icon "+(t=t.replace(".","-"))+"'></span></div>"},getStatisticRow:t,getAssetStatusTemplate:function(e){var t=L.getAssetStatus(e);return"<div><span class='circle-icon "+(t=t.replace(".","-"))+"'></span></div>"},assetMapListRegTemplate:function(e){var t=e.assets_types_name,i=e.number,a=e.id,n=e.subAssetType;n&&(t+=" / "+n);var o=L.getStatus(e);o&&(o=1<(o=o.split(".")).length?(L.isOnlyNormalType(e)&&o[0],o[1]):"Off")[0];var s=L.getPositionType(e);return'<div class="device-map-panel-list-item">'+("<span class='detail-img asset "+o+" "+("-"!=s&&"Movable"==s?L.getDisplayClassType(e)+" movable":L.getDisplayClassType(e))+"' data-status='"+o+"'></span>")+("<div class='detail-text'><span class='id'>"+i+"</span><span class='name'>"+L.decodeHtml(t)+"</span></div>")+("<span class='ic ic-info' data-id='"+a+"'></span>")+"</div>"},getStatisticRowAsset:function(e){t(e,!0)},getStatisticRowBeacon:function(e){t(e,!1,!0)},statisticAssetFloor:function(e){return e.isSubAsset?"":e.name?e.name:"-"},statisticAssetTypes:function(e){var t="-";e.isSubAsset?t=(void 0!==e.assets_types_name?e.assets_types_name:"-")+(void 0!==e.assets_subAssetType?" / "+e.assets_subAssetType:""):t=void 0!==e.numberOfSubAssetTypes?e.numberOfSubAssetTypes:"-";return t},statisticAssetRegisteredAssets:function(e){return void 0!==e.numberOfRegisteredAssets?e.numberOfRegisteredAssets:"-"},statisticAssetNormalDevices:function(e){return void 0!==e.numberOfNormalDevices?e.numberOfNormalDevices:"-"},statisticAssetCriticalDevices:function(e){return void 0!==e.numberOfCriticalDevices?e.numberOfCriticalDevices:"-"},statisticAssetWarningDevices:function(e){return void 0!==e.numberOfWarningDevices?e.numberOfWarningDevices:"-"},statisticAssetDisconnectedDevices:function(e){return void 0!==e.numberOfDisconnectedDevices?e.numberOfDisconnectedDevices:"-"},statisticAssetLowBatteryDevices:function(e){return"<span class='text-err'>"+(void 0!==e.numberOfLowBatteryDevices?e.numberOfLowBatteryDevices:"-")+"</span>"},statisticAssetOutOfBoundsDevices:function(e){return"<span class='text-err'>"+(void 0!==e.numberOfOutOfBoundsDevices?e.numberOfOutOfBoundsDevices:"-")+"</span>"},assetTypeListTemplate:function(e){var t=e.name;return"<span class='detail-img asset "+t.toLowerCase()+"'></span>"+("<span data-bind='text: name'>"+L.decodeHtml(t)+"</span>")+"<span class='panel-item-temp'><span></span></span>"},statisticBeaconRegister:W,statisticBeaconPositionType:U,statisticBeaconNormal:Y,statisticBeaconDisconnected:G,statisticBeaconWrongLocation:z,statisticBeaconLowBattery:H,statisticBeaconSchdules:j,statisticBeaconRules:Z,detailStatusIconTemplate:function(e){var t=L.getStatus(e),i=t.split("."),a="<span class='circle-icon detail-popup "+i[0]+"-"+i[1]+"'></span>";if(-1<t.indexOf("Alarm")){var n=$("<div/>");t=t.replace(".","-");var o=L.getRecentAlarm(e),s=o.type,r=R.prop("FACILITY_DEVICE_STATUS_POPUP_"+s.toUpperCase());s=r||s;var l=$("<span/>").addClass(t).text(s+" "+R.prop("COMMON_CODE")+" "+o.name),d=$("<span/>").text(L.getAlarmDescription(o.name));return n.append(a),n.append(l),n.append("<br>"),n.append(d),n.html()}var c=i[0];return L.isOnlyNormalType(e)&&"Alarm"!=t[0]||(c+="("+i[1]+")"),a+L.getStatusI18N(c)},detailIconTemplateById:function(e){return'<span class="ic ic-info" data-num="detail" data-id='+e.id+' data-event="devicedetail"></span>'},indoorLegendTemplate:i,beaconLegendTemplate:a,pointLegendTemplate:n,baseLegendTemplate:o,legendTemplate:s,indoorTemperatureListTemplate:function(e){var t,i=$("<div/>"),a=$("<div/>"),n=L.getRecentAlarm(e),o=L.getStatus(e).replace(".","-");if(n){var s=R.prop("COMMON_CODE")+" "+n.name;t=$("<span/>").addClass(o).text(s),a.append(t),i.append(a)}else{var r,l,d=N.getTemperatures(e,!0);r=d.current,l=d.desired,t=$("<span/>").addClass(o).addClass("current").text(r);var c=$("<span/>").addClass(o).addClass("set").text(l);if(a.append(c),a.append(" / "),a.append(t),i.append(a),d.dhwDesired||d.dhwCurrent){var p=$("<div/>"),u=$("<span/>").addClass(o).addClass("current").text(d.dhwCurrent),m=$("<span/>").addClass(o).addClass("set").text(d.dhwDesired);p.append(m),p.append(" / "),p.append(u),i.append(p)}}return i.html()},indoorCardTemplate:function(e){var t,i=L.getDisplayMode(e.modes,e.operations),a=L.getStatus(e);a=a.replace(".","-"),e.information&&e.information.modelName&&(t="I"+e.information.modelName.toUpperCase().replace(/\s/gi,"").replace("+","PLUS"));var n=$("<div/>"),o=$("<div/>").addClass("card-item").attr("data-uid",e.uid).attr("data-id",e.id);e.selected&&o.addClass("k-state-selected");var s=$("<div/>"),r=$("<div/>").addClass("icon-line"),l=$("<div/>").addClass("card-info"),d=$("<div/>").addClass("left"),c=$("<div/>").addClass("right"),p=$("<span/>").addClass("type").addClass(a),u=$("<div/>").addClass("item-bottom"),m=e.name;m&&10<m.length&&(m=m.substring(0,10),m+="...");var g,f=$("<span/>").addClass("device-type-img "+t).text(m),v=L.getRecentAlarm(e);if(v){g="error",s.addClass("card-back "+a),p.text(" "),r.append("<div class='icon empty'/>");var _=a.split("-")[1];_="<span class='error'>"+(_=R.prop("FACILITY_INDOOR_MODE_"+_.toUpperCase()))+"</p><p>"+R.prop("COMMON_CODE")+" "+v.name+"</p>";var T=$("<span/>").addClass("error "+a).html(_);c.append(T),u.addClass("error")}else{var E;"HotWater"===i&&(i="HeatStorage"),g=N.convertDisplayName(i),"HeatStorage"===(E="ko"==M?L.getModeToI18N(i):g)?p.text("H.Water"):p.text(E);var b,I,C,h=N.getGridIcon(e),y=N.getTemperatures(e);if(b=y.current,I=y.desired,C=y.unit,h.length)for(var A=0,w=h.length;A<w;A++)r.append('<div class="icon '+h[A]+'"/>');else r.append("<div class='icon empty'/>");var S=$("<span/>").addClass(a).addClass("set");y.isWaterout&&$("<div/>").addClass("icon ic-dhwtemp-card").appendTo(S),$("<em/>").text(R.prop("FACILITY_INDOOR_SET")).appendTo(S),S.append(I),S.attr("data-content",C);var D=$("<span/>").addClass(a).addClass("current");$("<em/>").text(R.prop("FACILITY_INDOOR_CURRENT")).appendTo(D),D.append(b),D.attr("data-content",C),c.append(S),c.append(D)}var O=$("<span/>").addClass("device-img "+g+" "+a);return d.append(p),d.append(O),l.append(d),l.append(c),u.append(f),u.append('<i class="ic ic-info" data-id='+e.id+">"),s.append(r),s.append(l),s.append(u),o.append(s),n.append(o),n.html()},outdoorDropDownListTemplate:u,outdoorCurrentLimitTemplate:function(e){var t,i,a="-",n=e.airConditioner;n&&(i=n.outdoorUnit)&&(t=a=(a=i.electricCurrentControl)||"-",isNaN(a)?t=R.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"):t+="%");var o=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").text(R.prop("FACILITY_INDOOR_CURRENT")+": "+t).appendTo(o);var s=e.airConditioner,r=!1;return s&&(i=s.outdoorUnit),i&&(r=!i.electricCurrentControlSupported),"-"==a&&(a=c.outdoorControlConfig.electricCurrentControl[0].value),$(u({value:a,text:t,disabled:r,field:"electricCurrentControl"})).addClass("outdoor-dropdownlist").appendTo(o),o.html()},outdoorHeatingCapacityCalibrationTemplate:function(e){var t,i,a="-",n=e.airConditioner;n&&(i=n.outdoorUnit)&&(t=a=(a=i.heatingCapacityCalibration)||"-",isNaN(a)?t=R.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL"):t+="kg/cm\xb2");var o=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").text(R.prop("FACILITY_INDOOR_CURRENT")+": "+t).appendTo(o);var s=e.airConditioner,r=!1;return s&&(i=s.outdoorUnit),i&&(r=!i.heatingCapacityCalibrationSupported),"-"==a&&(a=c.outdoorControlConfig.heatingCapacityCalibration[0].value),$(u({value:a,text:t,disabled:r,field:"heatingCapacityCalibration"})).addClass("outdoor-dropdownlist").appendTo(o),o.html()},outdoorCoolingCapacityCalibrationTemplate:function(e){var t,i,a="-",n=e.airConditioner;if(n&&(i=n.outdoorUnit))if("SelfControl"!=(a=(a=i.coolingCapacityCalibration)||"-")){var o=c.outdoorControlConfig.coolingCapacityCalibration[p],s=$.grep(o,function(e){return e.value==a});t=s[0]?s[0].text:"-"}else t=R.prop("FACILITY_DEVICE_SAC_OUTDOOR_SELF_CONTROL");var r=$("<div/>");$("<span/>").addClass("sac-indoor-span-left").appendTo(r).text(R.prop("FACILITY_INDOOR_CURRENT")+": "+t);var l=e.airConditioner,d=!1;return l&&(i=l.outdoorUnit),i&&(d=!i.coolingCapacityCalibrationSupported),"-"==a&&(a=c.outdoorControlConfig.coolingCapacityCalibration[p][0].value),$(u({value:a,text:t,disabled:d,field:"coolingCapacityCalibration"})).addClass("cooling-capacity-calibaration-dropdownlist").addClass("outdoor-dropdownlist").appendTo(r),r.html()},pointTypeTemplate:function(e){return e.type.replace("ControlPoint.","")},pointValueTemplate:function(e){if(!e.controlPoint)return"-";var t=e.controlPoint.value,i=e.type;return-1!=i.indexOf("AO")||-1!=i.indexOf("AV")?'<input class="device-point-numeric" data-type="aoav" value="'+t+'" style="width:50%; text-align:center;"/><button class="device-point-sendbtn">'+R.prop("COMMON_BTN_SEND")+"</button>":-1!=i.indexOf("DO")||-1!=i.indexOf("DV")?'<input class="device-point-numeric" data-type="dodv" value="'+t+'" style="width:50%; text-align:center;"/><button class="device-point-sendbtn">'+R.prop("COMMON_BTN_SEND")+"</button>":t},gatewayListZigbeeTemplate:function(e){var t=N.getZigbeeStatus(e).split(".");return"<span class='circle-icon detail-popup "+t[0]+"-"+t[1]+"'></span>"},gatewayListBleTemplate:function(e){var t=N.getBleStatus(e).split(".");return"<span class='circle-icon detail-popup "+t[0]+"-"+t[1]+"'></span>"},gatewayListBleInterfaceTemplate:function(e){var t,i,a="";for(t=0;t<3;t++)a+="<span class='beacon-status'><span class='circle-icon detail-popup "+(i=N.getBleInterfaceStatus(e,t).split("."))[0]+"-"+i[1]+"'></span></span>";return a},bleMacAddressTemplate:function(e){return"<span class='ellipse'>"+N.getBleMacAddress(e)+"</span>"},bleUUIDTemplate:function(e){return"<span class='ellipse'>"+N.getBleUUID(e)+"</span>"}}}),define("asset/monitoring/asset-api",[],function(){"use strict";function n(e){return $.ajax({url:"/assets",method:"POST",data:e})}function t(e){return $.ajax({url:"/assets/"+e})}function o(e){return $.ajax({url:"/assets/"+e,method:"DELETE"})}var s=window.MAIN_WINDOW;return{getAssets:function(e){var t,i;e=e||{};var a=s.getCurrentFloor(),n=a.floor,o=a.building;return o.id&&o.id!=s.FLOOR_NAV_BUILDING_TOTAL_ID&&(t=o.id),n.id&&n.id!=s.FLOOR_NAV_FLOOR_ALL_ID&&(i=n.id),t&&(e.foundation_space_buildings_id=t),i&&(e.foundation_space_floors_id=i),$.ajax({url:"/assets",data:e})},postAssets:function(e){var t,i=[],a=e.length;for(t=0;t<a;t++)i.push(n(e[t]));return $.when.apply(this,i)},postAsset:n,patchAssets:function(e){return $.ajax({url:"/assets",method:"PATCH",data:e})},getAsset:t,getAssetWithMultipleID:function(e){return 1==e.length?t(e[0]).then(function(e){return[e]}):(e=e&&"?ids="+e.join(","),$.ajax({url:"/assets"+e}))},patchAsset:function(e,t){return $.ajax({url:"/assets/"+e,method:"PATCH",data:t}).then(function(){})},deleteAsset:o,deleteAssets:function(e){var t,i=[],a=e.length;for(t=0;t<a;t++)i.push(o(e[t]));return $.when.apply(this,i)},getAssetTypes:function(){return $.ajax({url:"/assets/types"})},patchAssetTypes:function(e){return $.ajax({url:"/assets/types",data:e,method:"PATCH"})},getAssetType:function(e){return $.ajax({url:"/assets/types/"+e})},patchAssetType:function(e,t){return $.ajax({url:"/assets/types/"+e,data:t,method:"PATCH"})},getStatistic:function(){return $.ajax({url:"/assets/statisticView"})}}}),define("asset/monitoring/model/asset-model",function(){"use strict";function s(){var e=new o;return e.set("location",{}),e.set("users",[]),e.set("devices",[]),e}var o=window.kendo.data.Model.define({id:"id",fields:{assets_types_id:{type:"number"},assets_types_name:{type:"string"},subAssetType:{type:"string"},description:{type:"string"},number:{type:"string"},modelName:{type:"string"},serialNumber:{type:"string"},managementOrganization:{type:"string"},mobilityType:{type:"string"},purchaseDate:{type:"datetime"},originalCost:{type:"number"},bookValue:{type:"number"},location:{type:"object"},users:{type:"object"},devices:{type:"object"}}});return{MockDataStatistic:[{foundation_space_buildings_id:1,foundation_space_buildings_name:"A Tower",floors:[{foundation_space_floors_id:5,foundation_space_floors_type:"F",foundation_space_floors_name:"4",numberOfSubAssetTypes:7,numberOfRegisteredAssets:1067,numberOfRegisteredAssetsWithDevices:1016,numberOfRegisteredAssetsWithoutDevices:51,numberOfNormalDevices:867,numberOfDisconnectedDevices:50,numberOfLowBatteryDevices:67,numberOfOutOfBoundsDevices:63,assetTypes:[{assets_types_name:"Computer",subAssetTypes:[{assets_subAssetType:"Server",numberOfRegisteredAssets:32,numberOfRegisteredAssetsWithDevices:32,numberOfRegisteredAssetsWithoutDevices:0,numberOfNormalDevices:29,numberOfDisconnectedDevices:2,numberOfLowBatteryDevices:1,numberOfOutOfBoundsDevices:0},{assets_subAssetType:"Desktop",numberOfRegisteredAssets:395,numberOfRegisteredAssetsWithDevices:383,numberOfRegisteredAssetsWithoutDevices:12,numberOfNormalDevices:327,numberOfDisconnectedDevices:27,numberOfLowBatteryDevices:41,numberOfOutOfBoundsDevices:2},{assets_subAssetType:"Laptop",numberOfRegisteredAssets:351,numberOfRegisteredAssetsWithDevices:333,numberOfRegisteredAssetsWithoutDevices:18,numberOfNormalDevices:272,numberOfDisconnectedDevices:8,numberOfLowBatteryDevices:12,numberOfOutOfBoundsDevices:49},{assets_subAssetType:"Tablet",numberOfRegisteredAssets:152,numberOfRegisteredAssetsWithDevices:151,numberOfRegisteredAssetsWithoutDevices:1,numberOfNormalDevices:140,numberOfDisconnectedDevices:5,numberOfLowBatteryDevices:3,numberOfOutOfBoundsDevices:7}]},{assets_types_name:"Communication",subAssetTypes:[{assets_subAssetType:"Router",numberOfRegisteredAssets:3,numberOfRegisteredAssetsWithDevices:3,numberOfRegisteredAssetsWithoutDevices:0,numberOfNormalDevices:3,numberOfDisconnectedDevices:0,numberOfLowBatteryDevices:0,numberOfOutOfBoundsDevices:0},{assets_subAssetType:"Switch",numberOfRegisteredAssets:49,numberOfRegisteredAssetsWithDevices:49,numberOfRegisteredAssetsWithoutDevices:0,numberOfNormalDevices:47,numberOfDisconnectedDevices:1,numberOfLowBatteryDevices:1,numberOfOutOfBoundsDevices:0},{numberOfRegisteredAssets:85,numberOfRegisteredAssetsWithDevices:65,numberOfRegisteredAssetsWithoutDevices:20,numberOfNormalDevices:49,numberOfDisconnectedDevices:7,numberOfLowBatteryDevices:9,numberOfOutOfBoundsDevices:5}]}]},{foundation_space_floors_id:6,foundation_space_floors_type:"F",foundation_space_floors_name:"5",numberOfSubAssetTypes:5,numberOfRegisteredAssets:44,numberOfRegisteredAssetsWithDevices:43,numberOfRegisteredAssetsWithoutDevices:1,numberOfNormalDevices:38,numberOfDisconnectedDevices:1,numberOfLowBatteryDevices:1,numberOfOutOfBoundsDevices:4,assetTypes:[{assets_types_name:"Computer",subAssetTypes:[{assets_subAssetType:"Desktop",numberOfRegisteredAssets:16,numberOfRegisteredAssetsWithDevices:16,numberOfRegisteredAssetsWithoutDevices:0,numberOfNormalDevices:15,numberOfDisconnectedDevices:0,numberOfLowBatteryDevices:1,numberOfOutOfBoundsDevices:0},{assets_subAssetType:"Laptop",numberOfRegisteredAssets:14,numberOfRegisteredAssetsWithDevices:14,numberOfRegisteredAssetsWithoutDevices:0,numberOfNormalDevices:11,numberOfDisconnectedDevices:1,numberOfLowBatteryDevices:0,numberOfOutOfBoundsDevices:3},{assets_subAssetType:"Tablet",numberOfRegisteredAssets:9,numberOfRegisteredAssetsWithDevices:8,numberOfRegisteredAssetsWithoutDevices:1,numberOfNormalDevices:7,numberOfDisconnectedDevices:0,numberOfLowBatteryDevices:0,numberOfOutOfBoundsDevices:1}]},{assets_types_name:"Communication",subAssetTypes:[{assets_subAssetType:"Switch",numberOfRegisteredAssets:2,numberOfRegisteredAssetsWithDevices:2,numberOfRegisteredAssetsWithoutDevices:0,numberOfNormalDevices:2,numberOfDisconnectedDevices:0,numberOfLowBatteryDevices:0,numberOfOutOfBoundsDevices:0},{numberOfRegisteredAssets:3,numberOfRegisteredAssetsWithDevices:3,numberOfRegisteredAssetsWithoutDevices:0,numberOfNormalDevices:3,numberOfDisconnectedDevices:0,numberOfLowBatteryDevices:0,numberOfOutOfBoundsDevices:0}]}]}]}],MockData:[{id:1,assets_types_id:1,assets_types_name:"Computer",subAssetType:"Laptop",description:"[Computer.Laptop] A Tower - 21th Floor - B Zone",number:"2030445678",modelName:"NT900X3D-A54",serialNumber:"MJ03PFGS",managementOrganization:"Building Management Group",mobilityType:"Movable",purchaseDate:"2015-01-16T00:00:00+09:00",originalCost:1851500,bookValue:1583e3,location:{description:"USpaceB, 4F, New Zone 1",foundation_space_buildings_id:1,foundation_space_floors_id:5,foundation_space_zones_id:8,geometry:{type:"Point",coordinates:[151.36,652.781]}},users:[{ums_users_id:"david.kim",ums_users_role:"Manager",ums_users_name:"David Kim",ums_users_nickname:"Dave",ums_users_employeeId:"11097865",ums_users_mobilePhoneNumber:"+82-10-6732-8861",ums_users_workPhoneNumber:"+82-2-751-8861",ums_users_email:"david.kim@samsung.com",ums_users_organization:"Building Management Group",ums_users_position:"Senior Manager",ums_users_responsibility:"Air conditioning system management."}],devices:[{dms_devices_id:"b1ca25a7-1755-b1ca-25a7-1755b1ca25a7",dms_devices_name:"[Beacon] A:21F:B",dms_devices_type:"Beacon",dms_devices_description:"[Beacon] A Tower - 21th Floor - B Zone",dms_devices_representativeStatus:"Alarm.Critical",dms_devices_locations:[{id:"Fixed",description:"A Tower, 15F, C Zone",foundation_space_buildings_id:1,foundation_space_floors_id:45,foundation_space_zones_id:102,geometry:{type:"Point",coordinates:[191.354,296.47]}}],dms_devices_alarms:[{alarms_id:81,alarms_name:"DEVICE_LOW_BATTERY",alarms_type:"Warning",alarms_eventTime:"2017-06-08T21:59:06+09:00"},{alarms_id:82,alarms_name:"DEVICE_WRONG_LOCATION",alarms_type:"Critical",alarms_eventTime:"2017-06-08T22:11:41+09:00"}],dms_devices_information:{updatedTime:"2017-06-08T22:29:22+09:00",power:{batteryLevel:58}},dms_devices_networks:[{id:1,name:"BLE External Beacon",type:"BLE",description:"This beacon is solely used for the asset management service.",ble:{macAddress:"B1:CA:25:A7:17:55",uuid:"288ef86f-4ca0-4d93-9551-fc66adec8612",mode:"AdvertisingAndConnect",writable:!1,major:34956,minor:5854,advertisingName:"Asset Management Service Beacon",advertisingInterval:400,txPower:8,calibratedTxPower:-55,rssi:-72}}]}]},{id:2,assets_types_id:2,assets_types_name:"Communication",subAssetType:"Router",description:"[Communication.Router] A Tower - 15th Floor - A Zone",number:"3010735824",modelName:"Cisco 892FSP",serialNumber:"PSJ1420HG0",managementOrganization:"Building Management Group",mobilityType:"Fixed",purchaseDate:"2016-07-10T00:00:00+09:00",originalCost:1416500,bookValue:1274800,location:{description:"USpaceB, 4F, New Zone 1",foundation_space_buildings_id:1,foundation_space_floors_id:5,foundation_space_zones_id:8,geometry:{type:"Point",coordinates:[345.51,612.609]}},users:[{ums_users_id:"williams.john",ums_users_role:"Manager",ums_users_name:"John Williams",ums_users_nickname:"Liam",ums_users_employeeId:"08141745",ums_users_mobilePhoneNumber:"+82-10-6692-6601",ums_users_workPhoneNumber:"+82-2-751-6601",ums_users_email:"williams.john@samsung.com",ums_users_organization:"Building Management Group",ums_users_position:"Principal Manager",ums_users_responsibility:"Network infrastructure management"}],devices:[{dms_devices_id:"e3adc20f-0981-e3ad-c20f-0981e3adc20f",dms_devices_name:"[Beacon] A:15F:A",dms_devices_type:"Beacon",dms_devices_description:"[Beacon] A Tower - 15th Floor - A Zone",dms_devices_representativeStatus:"Alarm.Critical",dms_devices_locations:[{id:"Measured",description:"A Tower, 15F, A Zone",foundation_space_buildings_id:1,foundation_space_floors_id:45,foundation_space_zones_id:100,geometry:{type:"Point",coordinates:[344.987,612.005]}}],dms_devices_alarms:[{alarms_id:87,alarms_name:"DEVICE_LOST",alarms_type:"Critical",alarms_eventTime:"2017-06-08T22:15:59+09:00"}],dms_devices_information:{updatedTime:"2017-06-08T22:27:45+09:00",power:{batteryLevel:58}},dms_devices_networks:[{id:1,name:"BLE External Beacon",type:"BLE",description:"This beacon is solely used for the asset management service.",ble:{macAddress:"E3:AD:C2:0F:09:81",uuid:"0d855591-38ab-43d0-8d16-d70e16109e40",mode:"AdvertisingAndConnect",writable:!1,major:30589,minor:1795,advertisingName:"Asset Management Service Beacon",advertisingInterval:450,txPower:8,calibratedTxPower:-55,rssi:-68}}]}]},{id:3,assets_types_id:1,assets_types_name:"Computer",subAssetType:"Laptop",description:"[Computer.Laptop] A Tower - 21th Floor - B Zone",number:"2030445678",modelName:"NT900X3D-A54",serialNumber:"MJ03PFGS",managementOrganization:"Building Management Group",mobilityType:"Movable",purchaseDate:"2015-01-16T00:00:00+09:00",originalCost:1851500,bookValue:1583e3,location:{description:"USpaceB, 4F, New Zone 1",foundation_space_buildings_id:1,foundation_space_floors_id:5,foundation_space_zones_id:8,geometry:{type:"Point",coordinates:[151.36,652.781]}},users:[{ums_users_id:"david.kim",ums_users_role:"Manager",ums_users_name:"David Kim",ums_users_nickname:"Dave",ums_users_employeeId:"11097865",ums_users_mobilePhoneNumber:"+82-10-6732-8861",ums_users_workPhoneNumber:"+82-2-751-8861",ums_users_email:"david.kim@samsung.com",ums_users_organization:"Building Management Group",ums_users_position:"Senior Manager",ums_users_responsibility:"Air conditioning system management."}],devices:[{dms_devices_id:"b1ca25a7-1755-b1ca-25a7-1755b1ca25a7",dms_devices_name:"[Beacon] A:21F:B",dms_devices_type:"Beacon",dms_devices_description:"[Beacon] A Tower - 21th Floor - B Zone",dms_devices_representativeStatus:"Normal",dms_devices_locations:[{id:"Fixed",description:"A Tower, 15F, C Zone",foundation_space_buildings_id:1,foundation_space_floors_id:45,foundation_space_zones_id:102,geometry:{type:"Point",coordinates:[191.354,296.47]}}],dms_devices_alarms:[],dms_devices_information:{updatedTime:"2017-06-08T22:29:22+09:00",power:{batteryLevel:58}},dms_devices_networks:[{id:1,name:"BLE External Beacon",type:"BLE",description:"This beacon is solely used for the asset management service.",ble:{macAddress:"B1:CA:25:A7:17:55",uuid:"288ef86f-4ca0-4d93-9551-fc66adec8612",mode:"AdvertisingAndConnect",writable:!1,major:34956,minor:5854,advertisingName:"Asset Management Service Beacon",advertisingInterval:400,txPower:8,calibratedTxPower:-55,rssi:-72}}]}]}],createDataSource:function(e,t){var i,a,n=e.length;for(n=e.length,a=0;a<n;a++)i=e[a],t&&(i.selected=!1),e[a]=new o(i);return e},createAssetModel:s,convertBeaconToAssetModel:function(e){var t,i,a,n=e.length,o=[];for(t=0;t<n;t++)i=e[t],(a=s()).devices.push({dms_devices_id:i.id,dms_devices_name:i.name,dms_devices_type:i.type,dms_devices_description:i.description,dms_devices_representativeStatus:i.representativeStatus,dms_devices_locations:i.locations,dms_devices_alarms:i.alarms,dms_devices_information:i.information,dms_devices_networks:i.networks}),o.push(a);return 0==n&&(a=s(),o.push(a)),o},getAssetDeviceInfo:function(e,t){var i,a,n,o,s,r=[],l=e.length;for(o=0;o<l;o++)n=e[o],s=n,"register"==t&&(delete s.assets_types,s.id||delete s.id,s.subAssetType||delete s.subAssetType,s.assets_types_id||(s.assets_types_id=1),s.managementOrganization||delete s.managementOrganization,s.description||delete s.description),s.location&&(s.location.foundation_space_zones_id||delete s.location.foundation_space_zones_id,s.location.geometry&&0==s.location.geometry.coordinates.length&&delete s.location.geometry),""==s.mobilityType&&(s.mobilityType="Fixed"),s.users&&s.users[0]&&(s.users[0].ums_users_id&&"-"!=s.users[0].ums_users_id||delete s.users),s.devices&&s.devices[0]&&"-"==s.devices[0].dms_devices_id&&delete s.devices,(a=e.devices)&&a[0]&&(i=a[0]).dms_devices_name&&i.dms_devices_description&&r.push({id:i.dms_devices_id,name:i.dms_devices_name,description:i.dms_devices_description});return r}}}),define("asset/monitoring/model/asset-type-model",function(){"use strict";var o=window.kendo.data.Model.define({id:"id",fields:{name:{type:"string"},subAssetTypes:{type:"object"}}});return{MockData:[{id:1,name:"Computer",subAssetTypes:["Server","Desktop","Laptop","Tablet"]},{id:2,name:"Communication",subAssetTypes:["Router","Switch"]},{id:3,name:"Office",subAssetTypes:[]},{id:4,name:"Medical",subAssetTypes:[]},{id:5,name:"HVAC",subAssetTypes:["System Air Conditioner - Indoor Unit","System Air Conditioner - Outdoor Unit"]},{id:6,name:"Power",subAssetTypes:["Electricity Meter"]},{id:7,name:"Fire",subAssetTypes:[]},{id:8,name:"Security",subAssetTypes:[]},{id:9,name:"Etc",subAssetTypes:[]}],createDataSource:function(e,t){var i,a,n=e.length;for(i=0;i<n;i++)a=e[i],t&&(a.selected=!1),e[i]=new o(a);return e},createAssetTypePopupModel:function(e){var t,i,a,n,o,s,r=e.length;for(t=0;t<r;t++)for((a=e[t]).selected=!1,n=(s=a.subAssetTypes).length,i=0;i<n;i++)o=s[i],s[i]={name:o,checked:!1};return e}}}),define("device/common/config/base-config",[],function(){var t=window.kendo,i=window.I18N,e={widget:t.ui.Grid,routeUrl:"/statistic",widgetOptions:{dataSource:[],height:"100%",scrollable:!0,sortable:!0,filterable:!1,pageable:!1}},a={widget:t.ui.CommonMapView,routeUrl:"/map",widgetOptions:{dataSource:[]}},n={widget:t.ui.Grid,routeUrl:"/list",widgetOptions:{hasSelectedModel:!0,dataSource:[],selectable:"multiple, row",height:"100%",scrollable:{virtual:!0},sortable:!0,filterable:!1,pageable:!1}},o={routeUrl:"/grid",widget:t.ui.Grid,noRecords:!0,widgetOptions:{hasSelectedModel:!0,dataSource:[],selectable:"multiple, row",scrollable:{virtual:!0},cardHeight:206,cardNum:5}},s={invisible:!1,disabled:!1,dataTextField:"text",dataValueField:"value",animation:!1,value:null,open:function(){},close:function(){},change:function(){},select:function(){}},r={id:"device-type-filter",name:"type",type:"dropdownlist",liClassName:"",options:s},l={type:"dropdowncheckbox",liClassName:"",options:$.extend(!0,{},s,{selectionChanged:function(){},isAbleUnselectAll:!0})},d=$.extend(!0,{},l,{id:"device-status-filter",name:"status",options:{emptyText:i.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY"),selectAllText:i.prop("FACILITY_DEVICE_ALL_STATUS"),dataSource:[{text:i.prop("FACILITY_DEVICE_STATUS_NORMAL"),value:1},{text:i.prop("FACILITY_DEVICE_STATUS_CRITICAL"),value:3},{text:i.prop("FACILITY_DEVICE_STATUS_WARNING"),value:4}]}}),c=$.extend(!0,{},d,{options:{dataSource:[{text:i.prop("FACILITY_DEVICE_STATUS_NORMAL_ON"),value:1},{text:i.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF"),value:2},{text:i.prop("FACILITY_DEVICE_STATUS_CRITICAL"),value:3},{text:i.prop("FACILITY_DEVICE_STATUS_WARNING"),value:4}]}}),p=$.extend(!0,{},l,{id:"device-zone-filter",name:"zone",options:{emptyText:i.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY_ZONE"),selectAllText:i.prop("FACILITY_DEVICE_ALL_ZONE"),dataTextField:"name",dataValueField:"id"}}),u={type:"button",name:"selectAll",id:"device-select-all",text:i.prop("COMMON_BTN_SELECT_ALL"),liClassName:"",options:{invisible:!1,disabled:!1,click:function(){}}},m={type:"template",name:"selectedText",id:"device-selected-text",template:"<span class='text-view'><span data-bind='text: options.selectedText'></span></span>",liClassName:"",options:{selectedText:i.prop("FACILITY_DEVICE_NO_SELECTED")}},g={type:"button",id:"device-register-btn",name:"register",text:i.prop("COMMON_BTN_REGISTER"),liClassName:"",options:{invisible:!0,disabled:!0,click:function(){}}},f={type:"button",id:"device-detail-btn",name:"detail",text:i.prop("COMMON_BTN_DETAIL"),liClassName:"",options:{invisible:!1,disabled:!0,click:function(){}}},v={type:"button",id:"device-delete-btn",name:"delete",text:i.prop("COMMON_BTN_DELETE"),liClassName:"",options:{invisible:!1,disabled:!0,click:function(){}}},_={type:"button",id:"device-view-btn",name:"view",text:i.prop("COMMON_BTN_SHOW"),liClassName:"",options:{invisible:!1,disabled:!0,click:function(){}}},T={name:i.prop("FACILITY_DEVICE_MONITORING"),layoutName:"monitoring",active:!0,disabled:!1,invisible:!1,routeUrl:"/monitoring",dataLayout:{list:n}},E={name:i.prop("FACILITY_DEVICE_REGISTRATION"),layoutName:"registration",active:!1,disabled:!1,invisible:!1,routeUrl:"/registration",dataLayout:{map:a,list:n}};return{deviceTabConfig:{name:"Tab Name",routeUrl:"/device-type",viewModel:{viewButtons:[{buttonClass:"ic ic-statistic",viewName:"statistic"},{buttonClass:"ic ic-location",viewName:"map"},{buttonClass:"ic ic-view-list",viewName:"list"},{buttonClass:"ic ic ic-view-2x2",viewName:"grid"}],registrationStatusButtons:[{name:i.prop("FACILITY_DEVICE_REGISTERED"),active:!0,disabled:!1,count:0,click:function(){}},{name:i.prop("FACILITY_DEVICE_UNREGISTERED"),active:!1,disabled:!1,count:0,click:function(){}}],searchFieldPlaceHolder:i.prop("COMMON_ENTER_SEARCH_TERMS"),searchFieldValue:"",searchKeyDown:function(){},searchClick:function(){},enableSearch:!0,hideSearch:!1,hideSelectArea:!1,hideFilterArea:!1,hideActionArea:!1,hideRegisterArea:!0,hideRightPanel:!0,hideMapPanel:!0,hideControlPanel:!1,hideLightControlPanel:!1,hideMonitoringMapPanel:!0,hideRegistrationMapPanel:!1,filters:[],actions:[m,g,f]},innerLayout:[T,E]},statisticViewConfig:e,mapViewConfig:a,listViewConfig:n,gridViewConfig:o,dropDownListConfig:r,dropDownCheckBoxListConfig:l,baseStatusFilterConfig:d,statusFilterConfig:c,zoneFilterConfig:p,selectAllButtonConfig:u,legendTemplate:function(e){return{type:"template",id:"device-legend",liClassName:"",template:t.template('<div class="legendNote"><div><Label class="ic-help"></Label><p>'+i.prop("FACILITY_DEVICE_LEGEND")+'</p></div><div class="flyout"><Label class="flyTail ic-flyout-legends "></Label>#=legendHtml#</div></div>')({legendHtml:e})}},selectedTextActionConfig:m,registerBtnActionConfig:g,detailBtnActionConfig:f,deleteBtnActionConfig:v,viewBtnActionConfig:_,monitoringLayoutConfig:E}}),define("asset/monitoring/config/asset-config",["device/common/config/base-config","device/common/device-util","device/common/device-template"],function(o,e,t){var i=window.I18N,s=(window.Util,window.MENU_TABS_ENABLED?window.MENU_TABS_ENABLED:{}),a=(window.GlobalSettings,$.extend(!0,{},o.listViewConfig,{widgetOptions:{columns:[{field:"id",title:i.prop("FACILITY_DEVICE_DEVICE_ID"),width:300,format:""},{field:"name",title:i.prop("FACILITY_DEVICE_DEVICE_NAME"),width:300,format:""},{field:"detail",title:i.prop("COMMON_BTN_DETAIL"),width:80,sortable:!1,template:t.detailIconTemplateById}]}})),n=$.extend(!0,{},o.dropDownListConfig,{id:"asset-type-filter",name:"assetType",options:{optionLabel:i.prop("FACILITY_DEVICE_ALL_ASSET"),dataTextField:"name",dataValueField:"id",dataSource:[]}}),r=$.extend(!0,{},o.dropDownListConfig,{id:"asset-position-type-filter",options:{optionLabel:i.prop("FACILITY_DEVICE_ALL_POSITION_TYPE"),dataSource:[{text:i.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED"),value:"Fixed"},{text:i.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE"),value:"Movable"}]}}),l=$.extend(!0,{},o.dropDownListConfig,{id:"asset-status-filter",name:"status",options:{optionLabel:i.prop("FACILITY_DEVICE_ALL_STATUS"),dataSource:[{text:i.prop("FACILITY_DEVICE_STATUS_NORMAL"),value:"Normal"},{text:i.prop("FACILITY_DEVICE_STATUS_CRITICAL"),value:"Alarm.Critical"},{text:i.prop("FACILITY_DEVICE_STATUS_WARNING"),value:"Alarm.Warning"}]}}),d={type:"button",id:"asset-type-btn",name:"assetType",text:i.prop("SERVICE_ASSET_TYPE"),options:{invisible:!1,disabled:!0,click:function(){}}},c={Asset:{name:i.prop("COMMON_MENU_SERVICE_ASSET"),routeUrl:"/asset",viewModel:{filters:[n,r,l,o.selectAllButtonConfig,o.legendTemplate(t.baseLegendTemplate)],actions:[o.selectedTextActionConfig,d,o.registerBtnActionConfig,o.deleteBtnActionConfig,o.detailBtnActionConfig]},innerLayout:[{dataLayout:{statistic:$.extend(!0,{},o.statisticViewConfig,{widgetOptions:{dataBound:t.getStatisticRowAsset,columns:[{field:"name",title:i.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR"),width:80,template:t.statisticAssetFloor},{field:"assets_types_name",title:i.prop("SERVICE_ASSET_TYPE"),width:80,template:t.statisticAssetTypes,sortable:!1},{field:"numberOfRegisteredDevices",title:i.prop("FACILITY_DEVICE_REGISTERED"),width:80,sortable:!1,template:t.statisticAssetRegisteredAssets},{title:i.prop("FACILITY_DEVICE_STATUS_NORMAL"),width:170,sortable:!1,template:t.statisticAssetNormalDevices},{field:"numberOfCriticalDevices",title:i.prop("FACILITY_DEVICE_STATUS_CRITICAL"),width:170,sortable:!1,template:t.statisticAssetCriticalDevices},{field:"numberOfWarningDevices",title:i.prop("FACILITY_DEVICE_STATUS_WARNING"),width:170,sortable:!1,template:t.statisticAssetWarningDevices}]}}),map:$.extend(!0,{},o.mapViewConfig,{widgetOptions:{canDragDeviceIcon:!1,isForcedShowDevice:!0}}),list:$.extend(!0,{},o.listViewConfig,{widgetOptions:{columns:[{field:"number",title:i.prop("SERVICE_ASSET_NUMBER"),width:"10%"},{field:"assets_types_name",title:i.prop("SERVICE_ASSET_TYPE"),width:"10%",template:e.getAssetType},{field:"status",title:i.prop("FACILITY_DEVICE_ENERGY_METER_STATUS"),width:80,sortable:!1,template:t.getAssetStatusTemplate},{field:"location",title:i.prop("COMMON_LOCATION"),width:100,template:e.getAssetLocation},{field:"modelName",title:i.prop("SERVICE_ASSET_MODEL_NAME"),width:80,sortable:!1},{field:"serialNumber",title:i.prop("SERVICE_ASSET_SERIAL_NUMBER"),width:80,sortable:!1},{field:"managementOrganization",title:i.prop("SERVICE_ASSET_MANAGEMENT_ORGANIZATION"),sortable:!1,width:80},{field:"users",title:i.prop("SERVICE_ASSET_USERS"),width:80,sortable:!1,template:e.getAssetUsers},{title:i.prop("COMMON_BTN_DETAIL"),width:"5%",sortable:!1,template:t.detailIconTemplateById}]}}),grid:$.extend(!0,{},o.gridViewConfig,{widgetOptions:{cardTemplate:t.getDeviceCardTemplate}})}},{dataLayout:{map:$.extend(!0,{},o.mapViewConfig,{widgetOptions:{canDragDeviceIcon:!1,isRegisterView:!0}}),list:a}}]}};return{getTabConfig:function(e){var t=c[e];return t?(t.key=e,t):(console.error("There is no configuration for type : "+e),null)},getTabConfigList:function(){var e,t,i,a,n=[];for(e in c)(t=c[e])&&!1!==s[e]&&n.push((i=e,(a=t).key=i,$.extend(!0,{},o.deviceTabConfig,a)));return n}}}),define("asset/monitoring/config/popup-config",["device/common/device-util","device/common/device-template","asset/monitoring/model/asset-model","asset/monitoring/model/asset-type-model","asset/monitoring/asset-api"],function(l,d,e,t,u){var f,m,i,g,c,p,v=window.I18N,n=window.MAIN_WINDOW,_=window.Util,a=window.CommonLoadingPanel,T=window.kendo,o=window.moment,E=new a,s=$("#asset-detail-popup"),r=$("#asset-detail-map-popup"),b=$("#asset-type-popup"),I=$("#asset-type-add-popup"),C=$("#asset-user-search-popup"),h=$("#asset-device-search-popup"),y=[];m=r.kendoCommonDialog({title:"Map",timeout:0,width:700,height:680,actions:[{text:v.prop("COMMON_BTN_CANCEL")},{text:v.prop("COMMON_BTN_SAVE")}]}).data("kendoCommonDialog"),c=C.kendoCommonDialog({title:v.prop("SERVICE_ASSET_USER_INFO"),timeout:0,width:652,height:830,actions:[{text:v.prop("COMMON_BTN_CANCEL")},{text:v.prop("COMMON_BTN_SAVE")}]}).data("kendoCommonDialog"),p=h.kendoCommonDialog({title:v.prop("SERVICE_ASSET_BEACON_INFO"),timeout:0,width:652,height:830,actions:[{text:v.prop("COMMON_BTN_CANCEL")},{text:v.prop("COMMON_BTN_SAVE")}]}).data("kendoCommonDialog");var A={height:"100%",scrollable:!0,sortable:!1,filterable:!1,pageable:!1};function w(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1),e.sender.trigger("onClosed")}function S(e){return e.sender.trigger("onEdit"),e.sender.setEditable(!0),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!1}),e.sender.setActions(e.sender.BTN.DEREGISTER,{visible:!1}),e.sender.trigger("onEdited"),!1}function D(e){e.sender.confirmDialog.message(v.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL"));function t(){e.sender.trigger("onCancel"),e.sender.cancelDataSource(),e.sender.setEditable(!1),e.sender.setDialogType(e.sender.dialogType),e.sender.hideInvalidMessage(),e.sender.hideRemoveBtn(),e.sender.trigger("onCanceled")}return e.sender.hasChanged?(e.sender.confirmDialog.setConfirmActions({yes:function(){t()}}),e.sender.confirmDialog.open()):t(),!1}function O(e){e.sender.trigger("onSave");var t,i,a=e.sender.dialogType;return(t=e.sender.save())&&(e.sender.isBlockEvt&&(delete e.sender.isBlockEvt,a="block"),"register"==a?(1<e.sender.dataSource.total()&&(i=e.sender.saveAll({registrationStatus:"Registered"})),t.registrationStatus="Registered",e.sender.trigger("onRegister",{sender:e.sender,result:t,results:i}),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!0}),void 0!==e.sender.BTN.BLOCK&&e.sender.setActions(e.sender.BTN.BLOCK,{visible:!0})):"block"==a?(1<e.sender.dataSource.total()&&(i=e.sender.saveAll({registrationStatus:"Blocked"})),t.registrationStatus="Blocked",e.sender.trigger("onBlock",{sender:e.sender,result:t,results:i}),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!0}),e.sender.setActions(e.sender.BTN.BLOCK,{visible:!0})):(1<e.sender.dataSource.total()&&(i=e.sender.saveAll(null,!0)),e.sender.trigger("onSaved",{sender:e.sender,result:t,results:i}),"deregister"==a?e.sender.setActions(e.sender.BTN.DEREGISTER,{visible:!0}):"delete"==a&&e.sender.setActions(e.sender.BTN.DELETE,{visible:!0})),e.sender.setEditable(!1),"delete"!=a&&e.sender.setActions(e.sender.BTN.DELETE,{visible:!1}),"register"!=a&&"block"!=a||e.sender.setActions(e.sender.BTN.EDIT,{visible:!1})),!1}function N(e){return e.sender.setEditable(!0),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!1}),void 0!==e.sender.BTN.BLOCK&&e.sender.setActions(e.sender.BTN.BLOCK,{visible:!1}),!1}function L(e){var t,i=e.sender.getSelectedData(),a={};if(a.registrationStatus="NotRegistered",1<e.sender.dataSource.total()){var n,o,s=(i=(i=e.sender.dataSource.data()).toJSON()).length;for(t=[],n=0;n<s;n++)(o={}).id=i[n].id,o.registrationStatus="NotRegistered",t.push(o)}return e.sender.trigger("onDeregister",{sender:e.sender,result:a,results:t}),!1}function R(e){var t,i=e.sender.getSelectedData(),a={},n=!1;if("register"==e.sender.dialogType&&(n=!0),n?i.devices&&i.devices[0]?a.id=i.devices[0].dms_devices_id:console.error("there is no device in asset."):a.id=i.id,1<e.sender.dataSource.total()){var o,s,r=(i=(i=e.sender.dataSource.data()).toJSON()).length;for(t=[],o=0;o<r;o++)s={},n?i[o].devices&&i[o].devices[0]?s.id=i[o].devices[0].dms_devices_id:console.error("there is no device in asset."):s.id=i[o].id,t.push(s)}return e.sender.trigger("onDelete",{sender:e.sender,result:a,results:t}),!1}var M={title:v.prop("SERVICE_ASSET_TYPE_MANAGEMENT"),width:788,height:830,buttonsIndex:{CLOSE:0,DELETE:1,ADD:2},gridOptions:{hasSelectedModel:!0,setSelectedAttribute:!0,selectable:"row multiple",columns:[{headerTemplate:"",template:d.assetTypeListTemplate}]},contentViewModel:{detailType:v.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type"></span></div><div data-bind="source:subAssetTypes" data-template="asset-sub-type-list" class="asset-sub-type-list"></div><div class="detail-dialog-detail-content-field-list"></div>',listTemplate:d.assetTypeListTemplate,headerTemplate:"<span>"+v.prop("SERVICE_ASSET_TYPE")+"</span>",isCustomActions:!0,initialCollapse:!1,actions:[{text:v.prop("COMMON_BTN_CLOSE"),visible:!0,action:w},{text:v.prop("COMMON_BTN_DELETE"),visible:!0,action:function(e){var t,i,a,n,o,s,r,l=[],d=e.sender.dataSource.data(),c=!1,p=d.length;for(n=0;n<p;n++){for(s=(i=(a=d[n]).subAssetTypes).length,r=null,(r={}).id=a.id,r.name=a.name,r.subAssetTypes=[],o=0;o<s;o++)(t=i[o]).checked?c=c||!0:r.subAssetTypes.push(t.name);r&&l.push(r)}return c||(l=[]),e.sender.trigger("onDelete",{results:l}),!1}},{text:v.prop("COMMON_BTN_ADD"),visible:!0,action:function(l){var d=l.sender.dataSource,e=d.data(),t='<div class="asset-type-add-wrapper"><div class="device-detail-header"><span class="device-detail-header-type">'+v.prop("SERVICE_ADD_ASSET_TYPE")+'</span></div><div class="asset-type-dropdown-wrapper"><span class="tbc">'+v.prop("SERVICE_ASSET_TYPE")+'</span><span class="tbc"><input data-role="dropdownlist" data-value-field="id" data-text-field="name" data-bind="source:assetTypeList, value:selectedAssetType"/></span></div><div class="asset-name-wrapper"><span class="tbc">'+v.prop("SERVICE_ASSET_NAME")+'</span><span class="tbc"><input class="k-input asset-type-name-validator" data-role="commonvalidator" data-required="true"/></span></div></div>';g.content(t);var i=g.element,c=T.observable({assetTypeList:e,selectedAssetType:e[0].id});T.unbind(i),T.bind(i,c),g.open();var p=i.find(".asset-type-name-validator");return p.val(""),g.setActions(1,{action:function(){if(!p.data("kendoCommonValidator").validate())return!1;var e=c.get("selectedAssetType"),t=d.get(e);t||console.error("no asset.");var i=t.toJSON();delete i.selected,delete i.id,delete i.name;var a,n=[],o=i.subAssetTypes,s=o.length;for(a=0;a<s;a++)n[a]=o[a].name;var r=p.val();n.push(r),o.push({name:r,checked:!1}),i.subAssetTypes=n,E.open(g.element),u.patchAssetType(e,i).done(function(){G.message(v.prop("SERVICE_ADD_ASSET_TYPE_RESULT")),G.open(l.sender.element)}).fail(function(e){var t=_.parseFailResponse(e);G.message(t),G.open(l.sender.element)}).always(function(){t.set("subAssetTypes",o),l.sender.getSelectedData()===t&&l.sender.contentViewModel.set("subAssetTypes",o),E.close()})}}),!1}}],isOnlyMulti:!0},B={title:v.prop("COMMON_BTN_DETAIL"),width:652,height:830,buttonsIndex:{CLOSE:0,EDIT:1,CANCEL:2,SAVE:3,REGISTER:4,DEREGISTER:5,DELETE:6},contentViewModel:{detailType:v.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',listTemplate:function(e){var t="register"==f.dialogType;return d.multiDetailListDualTemplate(e,t,!0)},headerTemplate:"<span>"+v.prop("FACILITY_DEVICE_SELECTED_DEVICE")+": <span>#:count #</span></span>",isCustomActions:!0,onTypeChange:function(e){var t=e.type,i=e.sender.BTN,a=e.sender.dataSource.data().length;"register"==t?(f.setActions(i.SAVE,{visible:!1}),f.setActions(i.CANCEL,{visible:!1}),f.setActions(i.EDIT,{visible:!1}),f.setActions(i.DEREGISTER,{visible:!1}),f.setActions(i.DELETE,{visible:!0}),f.setActions(i.CLOSE,{visible:!0}),f.setActions(i.REGISTER,{visible:!0})):(f.setActions(i.SAVE,{visible:!1}),f.setActions(i.CANCEL,{visible:!1}),f.setActions(i.DEREGISTER,{visible:!1}),f.setActions(i.REGISTER,{visible:!1}),f.setActions(i.DELETE,{visible:!0}),f.setActions(i.CLOSE,{visible:!0}),1<a?f.setActions(i.EDIT,{visible:!0,disabled:!0}):f.setActions(i.EDIT,{visible:!0,disabled:!1}))},actions:[{text:v.prop("COMMON_BTN_CLOSE"),visible:!0,action:w},{text:v.prop("COMMON_BTN_EDIT"),visible:!0,action:S},{text:v.prop("COMMON_BTN_CANCEL"),visible:!1,action:D},{text:v.prop("COMMON_BTN_SAVE"),visible:!1,disabled:!0,action:O},{text:v.prop("COMMON_BTN_REGISTER"),visible:!1,action:N},{text:v.prop("COMMON_BTN_DEREGISTER"),visible:!1,action:L},{text:v.prop("COMMON_BTN_DELETE"),visible:!0,action:R}],scheme:{id:"id",groupName:{users:{template:"<div class='group search'><span class='search-title'>"+v.prop("SERVICE_ASSET_USER_INFO")+"</span><span class='search-btn editable'><button class='k-button' data-bind='events:{click:clickUserSearchBtn}'>"+v.prop("SERVICE_ASSET_SEARCH_USER")+"</button></span></div>"},beacons:{template:"<div class='group search'><span class='search-title'>"+v.prop("SERVICE_ASSET_BEACON_INFO")+"</span><span class='search-btn editable'><button class='k-button' data-bind='events:{click:clickBeaconSearchBtn}'>"+v.prop("SERVICE_ASSET_SEARCH_BEACON")+"</button></span></div>"}},fields:{number:{type:"text",name:v.prop("SERVICE_ASSET_NUMBER"),validator:{required:!0},editCss:{width:"100%"},hasInputRemoveBtn:!0,editable:!0,isEditAll:!0},assets_types:{type:"text",name:v.prop("SERVICE_ASSET_TYPE"),template:function(e){var t="-";return e.assets_types_name&&(t=e.assets_types_name),t},editable:!0,editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.assets_types_id, source: assetList, events:{change:changeAssetType, dataBound:boundAsset}' style='width:218px;'/>"},editFieldName:"assets_types_id",editViewModel:{fields:{assets_types_id:null},init:function(){this.fields.assets_types_id||(this.fields.assets_types_id=1),this.assetList=y},assetList:y,boundAsset:function(e){this.changeAssetType(e,!0)},changeAssetType:function(e,t){var o;if(t){if(o=this.fields.get("assets_types_id"),e.sender.value(o),!o)return}else o=e.sender.value(),this.fields.set("assets_types_id",o);E.open(f.element),$.ajax({url:"/assets/types/"+o}).done(function(e){var t=e.subAssetTypes;f.editFields.subAssetType.viewModel.set("subAssets",t)}).fail(function(e){var t=_.parseFailResponse(e);f.msgDialog.message(t),f.msgDialog.open();var i,a=y.length;for(i=0;i<a;i++)if(y[i].id==o){var n=y[i].subAssetTypes;f.editFields.subAssetType.viewModel.set("subAssets",n);break}}).always(function(){E.close(),f.enableSaveBtn()})}},isEditAll:!0},subAssetType:{type:"text",name:v.prop("SERVICE_SUB_ASSET_TYPE"),template:function(e){var t="-";return e.subAssetType&&(t=e.subAssetType),t},editable:!0,editTemplate:function(){return"<input data-role='dropdownlist' data-bind='value:fields.subAssetType, source: subAssets, events:{change:changeSubAsset, dataBound:boundSubAsset}' style='width:218px;'/>"},editFieldName:"subAssetType",editViewModel:{fields:{subAssetType:null},init:function(){this.fields.subAssetType||(this.fields.subAssetType=null)},subAssets:[],boundSubAsset:function(e){this.changeSubAsset(e,!0)},changeSubAsset:function(e,t){var i;if(t){if(i=this.fields.get("subAssetType"),e.sender.value(i),!i)return}else i=e.sender.value(),this.fields.set("subAssetType",i);f.enableSaveBtn()}},isEditAll:!0},modelName:{type:"text",name:v.prop("SERVICE_ASSET_MODEL_NAME"),validator:{required:!0},editCss:{width:"100%"},hasInputRemoveBtn:!0,editable:!0,isEditAll:!0},serialNumber:{type:"text",name:v.prop("SERVICE_ASSET_SERIAL_NUMBER"),editCss:{width:"100%"},hasInputRemoveBtn:!0,editable:!0,isEditAll:!0},purchaseDate:{type:"text",name:v.prop("SERVICE_ASSET_PURCHASE_DATE"),editable:!0,editFieldName:"purchaseDate",editTemplate:'<input data-role="commondatepicker" data-bind="value: fields.purchaseDates,events:{change:change}" data-format="yyyy-MM-dd" title="datepicker"/>',editViewModel:{fields:{purchaseDates:new Date,purchaseDate:new Date},init:function(){this.fields.purchaseDate?this.fields.purchaseDates=this.fields.purchaseDate:this.fields.purchaseDates=this.fields.purchaseDate=new Date},change:function(e){var t=e.sender.value();this.fields.set("purchaseDate",t),this.fields.set("purchaseDates",t),f.enableSaveBtn()}},template:function(e){var t=e.purchaseDate;return t?t=o(t).format("L").replace(/\./g,"-"):"-"},isEditAll:!0},originalCost:{type:"text",name:v.prop("SERVICE_ASSET_PURCHASE_COST"),template:function(e){var t="-";return e.originalCost&&(t=T.toString(e.originalCost,"n0")),t},editable:!0,editFieldName:"originalCost",editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-spinners="false" data-bind="value : fields.originalCost, events:{change:change}" /></div>'},editViewModel:{fields:{originalCost:0},init:function(){null===this.fields.originalCost&&(this.fields.originalCost=0)},change:function(e){f.enableSaveBtn()}},isEditAll:!0},managementOrganization:{type:"text",name:v.prop("SERVICE_ASSET_MANAGEMENT_ORGANIZATION"),editCss:{width:"100%"},hasInputRemoveBtn:!0,editable:!0,isEditAll:!0},mobilityType:{type:"text",name:v.prop("FACILITY_DEVICE_BEACON_POSITION_TYPE"),template:function(e){var t="-";return e.mobilityType&&(t=(t=e.mobilityType)||"-"),t},editable:!0,editFieldName:"mobilityType",editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="positionType" id="position-fixed" checked="" value="Fixed" data-bind="checked:fields.mobilityType, click:clickRadio"><label class="k-radio-label" for="position-fixed" style="margin-right:51px;">Fixed</label><input type="radio" class="k-radio" name="positionType" id="position-movable" checked="" value="Movable" data-bind="checked:fields.mobilityType, click:clickRadio"><label class="k-radio-label" for="position-movable">Movable</label></div>'},editViewModel:{fields:{mobilityType:null},init:function(){this.fields.mobilityType||(this.fields.mobilityType="Fixed"),this.positionTypeChecked=this.fields.mobilityType},clickRadio:function(e){f.enableSaveBtn()}}},location:{type:"text",name:v.prop("COMMON_LOCATION"),editable:!0,template:l.getLocation,editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.foundation_space_buildings_id, source: buildingList, events:{change:changeBuildingList,  dataBound:dataBoundBuildingList}' style='width:95px;margin-right:10px;'/><input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.foundation_space_floors_id, source: floorList, events:{change:changeFloorList, dataBound:dataBoundFloorList}' style='width:95px;margin-right:10px;'/><input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.foundation_space_zones_id, source: zoneList, events:{change:changeZoneList, dataBound:dataBoundZoneList}' style='width:95px;margin-right:10px;'/><button type='button' class='ic-bt-map popup-btn k-button k-button-icon' data-bind='events:{click:onMapBtnClick}, disabled:isMapBtnDisabled'></button>"},editViewModel:{initialFieldsOnClose:function(e){this.fields.foundation_space_buildings_id=null,this.fields.foundation_space_floors_id=null,this.fields.foundation_space_zones_id=null},initialFieldsOnCloseBinded:null,init:function(){this.isMapBtnDisabled=!0;var e=n.getCurrentFloor(),t=e.building,i=e.floor,a=f.dialogType;this.isSetFloorList=!1,this.isSetZoneList=!1,this.initialFieldsOnCloseBinded||(this.initialFieldsOnCloseBinded=this.initialFieldsOnClose.bind(this)),f.unbind("onClose",this.initialFieldsOnCloseBinded),f.bind("onClose",this.initialFieldsOnCloseBinded),f.options.enableSaveBtnCondition="register"===a?function(){var e=this.editFields.location;if(e&&e.viewModel){var t=e.viewModel.fields.get("foundation_space_floors_id");if(null!=t)return!0}return!1}:null,"register"!=a&&this.fields.foundation_space_buildings_id||t.id==n.FLOOR_NAV_BUILDING_TOTAL_ID||(this.fields.foundation_space_buildings_id=t.id),"register"!=a&&this.fields.foundation_space_floors_id||i.id==n.FLOOR_NAV_FLOOR_ALL_ID||(this.fields.foundation_space_floors_id=i.id,(this.fields.foundation_space_zones_id=null)!==i.id&&void 0!==i.id&&f.enableSaveBtn())},fields:{id:"Fixed",foundation_space_buildings_id:null,foundation_space_floors_id:null,foundation_space_zones_id:null,description:null,geometry:null},checkBtnDisabled:function(e){var t=this.fields.get("foundation_space_buildings_id"),i=this.fields.get("foundation_space_floors_id");e&&(null===t||null===i?f.disableSaveBtn():f.enableSaveBtn()),null===i?this.set("isMapBtnDisabled",!0):this.set("isMapBtnDisabled",!1)},isSetFloorList:!1,isSetZoneList:!1,isMapBtnDisabled:!0,buildingList:n.getCurrentBuildingList(),floorList:[],zoneList:[],centerZoneId:0,centerCoordinate:[],setSelectedLocation:function(e,t,i,a){var n,o,s=f.selectedIndex,r=f.dataSource.data(),l=r.length;if(0==s)for(o=0;o<l;o++)(n=r[o])&&(n.location||(n.location={}),n.location.id||(n.location.id="Fixed"),n.location.foundation_space_buildings_id=e,n.location.foundation_space_floors_id=t,n.location.foundation_space_zones_id=i,n.location.description=a)},setLocationDescription:function(e,t,i){var a,n=this.fields.get("description");if(n){var o;for(a=n.split(", "),e&&(a[0]=e),a[1]=t||"",a[2]=i||"",o=a.length-1;0<=o;o--)a[o]||a.splice(o,1);n=a.join(", ")}else e&&t&&i?n=e+", "+t+", "+i:e&&t?n=e+", "+t:e&&(n=e);return this.fields.set("description",n),n},dataBoundBuildingList:function(e){this.changeBuildingList(e,!0)},changeBuildingList:function(e,t){var i,o=this;if(t){if(i=o.fields.get("foundation_space_buildings_id"),e.sender.value(i),!i)return}else i=e.sender.value(),o.fields.set("foundation_space_buildings_id",i);var a=e.sender.text();this.set("buildingText",a);var n=o.setLocationDescription(a);this.setSelectedLocation(i,null,null,n),E.open(f.element),$.ajax({url:"/foundation/space/floors?foundation_space_buildings_id="+i}).done(function(e){var t,i,a,n=e.length;for(e.sort(function(e,t){return e.sortOrder-t.sortOrder}),t=0;t<n;t++)i=e[t].type,a=e[t].name,e[t].name="F"==i?a+i:"B"==i?i+a:a;o.set("isSetFloorList",!0),o.set("floorList",e),e.length<1&&(o.fields.set("foundation_space_floors_id",null),o.set("zoneList",[]))}).fail(function(e){var t=_.parseFailResponse(e);f.msgDialog.message(t),f.msgDialog.open()}).always(function(){E.close();var e="register"==f.dialogType;o.checkBtnDisabled(e)})},dataBoundFloorList:function(e){this.changeFloorList(e,!0)},changeFloorList:function(e,n){var t,o=this,i=o.fields.get("foundation_space_buildings_id");if(n){t=o.fields.get("foundation_space_floors_id"),e.sender.value(t);var a=e.sender.value(),s=this.get("floorList"),r=this.get("isSetFloorList");if(t&&s&&r)new T.data.Query(s).filter({field:"id",operator:"eq",value:t}).toArray().length<1&&(t=null);if(t||a||o.fields.set("foundation_space_floors_id",null),!t)return}else t=e.sender.value(),o.fields.set("foundation_space_floors_id",t),f.hasChanged=!0;var l=e.sender.text();this.set("floorText",l);var d=o.setLocationDescription(this.get("buildingText"),l);this.setSelectedLocation(i,t,null,d),E.open(f.element),_.getFloorDataWithImage(t).always(function(a){$.ajax({url:"/foundation/space/zones?foundation_space_buildings_id="+i+"&foundation_space_floors_id="+t}).done(function(e){e.sort(function(e,t){return e.sortOrder-t.sortOrder});var t=_.getCenterMap(a.imageWidth,a.imageHeight),i=_.getCenterZoneId(e,t);o.set("centerZoneId",i),o.set("centerCoordinate",t),o.set("isSetZoneList",!0),o.set("zoneList",e),e.length<1?(o.fields.set("foundation_space_zones_id",null),n||o.fields.set("geometry",{type:"Point",coordinates:t})):o.fields.get("geometry")||o.fields.get("foundation_space_zones_id")||(o.fields.foundation_space_zones_id=i)}).fail(function(e){var t=_.parseFailResponse(e);f.msgDialog.message(t),f.msgDialog.open()}).always(function(){E.close(),n||o.checkBtnDisabled(!0)})})},dataBoundZoneList:function(e){this.changeZoneList(e,!0)},changeZoneList:function(e,t){var a=this,i=null,n=a.fields.get("foundation_space_buildings_id"),o=a.fields.get("foundation_space_floors_id");if(t){var s=a.fields.get("foundation_space_zones_id");e.sender.value(s);var r=e.sender.value(),l=this.get("zoneList"),d=this.get("isSetZoneList");if(s&&l&&d)new T.data.Query(l).filter({field:"id",operator:"eq",value:s}).toArray().length<1&&(i=s=null);if(!s&&!r)if(a.fields.get("geometry"))i=null,a.fields.set("foundation_space_zones_id",i);else{0==(i=a.get("centerZoneId"))&&(i=null),a.fields.set("foundation_space_zones_id",i);var c=a.get("centerCoordinate");a.fields.set("geometry",{type:"Point",coordinates:c})}}else{i=e.sender.value();var p=a.fields.get("geometry");a.fields.set("foundation_space_zones_id",i),f.hasChanged=!0;var u={coordinates:null,type:"Point"};a.fields.location?(a.fields.location.set("foundation_space_zones_id",i),a.fields.location.set("geometry",p)):a.fields.set("location",[{foundation_space_buildings_id:n,foundation_space_floors_id:o,foundation_space_zones_id:i,geometry:p}]),E.open(f.element),$.ajax({url:"/foundation/space/zones/"+i}).done(function(e){if(e.geometry&&e.geometry.coordinates&&e.geometry.coordinates[0]){var t=e.geometry.coordinates[0],i=_.getCentroid(t);u.coordinates=i,a.fields.set("geometry",u)}}).fail(function(e){console.error(e)}).always(function(){E.close()}),a.checkBtnDisabled(!0)}var m=e.sender.text();this.set("zoneText",m);var g=a.setLocationDescription(this.get("buildingText"),this.get("floorText"),m);this.setSelectedLocation(n,o,i,g)},onMapBtnClick:function(r){var l=$("<div/>").addClass("device-detail-map-view-box"),d=this,c=d.fields.get("foundation_space_buildings_id"),p=d.fields.get("foundation_space_floors_id"),u=(d.fields.get("foundation_space_zones_id"),d.fields.get("geometry"));E.open(f.element),_.getFloorDataWithImage(p).always(function(a){$.ajax({url:"/foundation/space/zones?foundation_space_buildings_id="+c+"&foundation_space_floors_id="+p}).done(function(e){var t=f.getSelectedData();s&&(t.location?(t.location.set("foundation_space_zones_id",s),t.location.set("geometry",u)):t.set("location",{id:"Fixed",foundation_space_buildings_id:c,foundation_space_floors_id:p,foundation_space_zones_id:s,geometry:u}));var i="register"==f.dialogType,n={coordinates:null,type:"Point"},o="",s=null;m.content(l),m.setActions(1,{action:function(){n.coordinates&&(d.fields.set("geometry",n),t.location.set("geometry",n),f.hasChanged=!0,s?d.fields.set("foundation_space_zones_id",Number(s)):d.fields.set("foundation_space_zones_id",null),o&&(d.set("zoneText",o),d.setLocationDescription(d.get("buildingText"),d.get("floorText"),o))),d.checkBtnDisabled(!0)}}),m.element.css("overflow","auto"),m.open(),l.kendoCommonMapView({dataSource:[t],zoneDataSource:e,floor:a,isForcedShowDevice:!0,isDetailPopupView:!0,canDragDeviceIcon:!0,isRegisterView:i,width:668,height:527}).data("kendoCommonMapView").bind("dragend",function(e){var t,i,a=e.devices[0];a?(a.nameDisplayCoordinate&&a.nameDisplayCoordinate,a.locations&&(t=a.locations[0],n.coordinates=t.geometry.coordinates,(s=t.foundation_space_zones_id)&&(i=r.sender.zoneDataSource.get(s),o=i.name))):console.error("device is not found when device move end")})}).fail(function(e){var t=_.parseFailResponse(e);f.msgDialog.message(t)}).always(function(){E.close()})})}}},currentLocations:{type:"text",name:v.prop("FACILITY_DEVICE_BEACON_CURRENT_LOCATION"),template:l.getCurrentLocation},description:{type:"text",name:v.prop("COMMON_DESCRIPTION"),editCss:{width:"100%"},editable:!0,hasInputRemoveBtn:!0,validator:!0,isEditAll:!0},ums_users_id:{groupName:"users",type:"object",name:v.prop("SERVICE_ASSET_USER_ID"),template:l.getAssetUserID,editable:!0,editTemplate:function(){return"<span style='line-height:36px;' data-bind='text: fields.ums_users_id'></span>"},editFieldName:"users[0]",editViewModel:{fields:{ums_users_id:null},init:function(){this.fields.ums_users_id||(this.fields.ums_users_id="-")}}},ums_users_name:{groupName:"users",type:"text",name:v.prop("SERVICE_ASSET_USER_NAME"),template:l.getAssetUserName},ums_users_organization:{groupName:"users",type:"text",name:v.prop("SERVICE_ASSET_USER_DEPARTMENT"),template:l.getAssetUserOrganization},ums_users_email:{groupName:"users",type:"text",name:v.prop("COMMON_EMAIL"),template:l.getAssetUserEmail},ums_users_workPhoneNumber:{groupName:"users",type:"text",name:v.prop("SERVICE_ASSET_USER_WORK_PHONE_NUMBER"),template:l.getAssetUserWorkPhoneNumber},ums_users_mobilePhoneNumber:{groupName:"users",type:"text",name:v.prop("SERVICE_ASSET_USER_PHONE"),template:l.getAssetUserMobilePhoneNumber},dms_devices_id:{groupName:"beacons",type:"object",name:v.prop("SERVICE_ASSET_DEVICE_ID"),template:l.getAssetDeviceID,editable:!0,editTemplate:function(){return"<span style='line-height:36px;' data-bind='text: fields.dms_devices_id'></span>"},editFieldName:"devices[0]",editViewModel:{fields:{dms_devices_id:null},init:function(){this.fields.dms_devices_id||(this.fields.dms_devices_id="-")}}},dms_devices_name:{groupName:"beacons",type:"object",name:v.prop("SERVICE_ASSET_DEVICE_NAME"),template:l.getAssetDeviceName,editable:!0,hasInputRemoveBtn:!0,editTemplate:function(){return"<form class='validator' data-role='commonvalidator' data-type='name'><input id='asset-device-name' class='k-input' style='line-height:36px; width:100%;' data-bind='value:fields.dms_devices_name'/><i class='ic ic-bt-input-remove'></i></form>"},editFieldName:"devices[0]",editViewModel:{fields:{dms_devices_name:null},init:function(){this.fields.dms_devices_name||(this.fields.dms_devices_name="")},change:function(e){}},validationRule:function(e,t){return t.find(".validator").data("kendoCommonValidator").validate()}},dms_devices_representativeStatus:{groupName:"beacons",type:"text",name:v.prop("COMMON_STATUS"),template:function(e){var t="-";if(e.devices&&e.devices[0]){var i={type:(e=e.devices[0]).dms_devices_type,mappedType:e.dms_devices_mappedType,representativeStatus:e.dms_devices_representativeStatus,alarms:e.dms_devices_alarms};t=d.detailStatusIconTemplate(i)}return t}},dms_devices_macAddress:{groupName:"beacons",type:"text",name:v.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:function(e){var t="-";if(e.devices&&e.devices[0]){var i={networks:(e=e.devices[0]).dms_devices_networks};t=l.getBleMacAddress(i)}return t}},dms_devices_lastEventTime:{groupName:"beacons",type:"text",name:v.prop("FACILITY_DEVICE_TEMP_HUM_LAST_EVENT_TIME"),template:function(e){var t="-";if(e.devices&&e.devices[0]){var i=(e=e.devices[0]).dms_devices_information;i&&i.updatedTime&&(t=o(i.updatedTime).format("LLL"))}return t}},dms_devices_signalLevel:{groupName:"beacons",type:"text",name:v.prop("FACILITY_DEVICE_BEACON_SIGNAL_LEVEL_RSSI"),template:function(e){var t="-";if(e.devices&&e.devices[0]){var i={networks:(e=e.devices[0]).dms_devices_networks};t=l.getBleSignalLevel(i)}return t}},dms_devices_batteryLevel:{groupName:"beacons",type:"text",name:v.prop("FACILITY_DEVICE_BEACON_BATTERY_LEVEL"),template:function(e){var t="-";if(e.devices&&e.devices[0]){var i={information:(e=e.devices[0]).dms_devices_information};"-"!=(t=l.getBleBatteryLevel(i))&&(t+=" %")}return t}},dms_devices_description:{groupName:"beacons",type:"object",name:v.prop("COMMON_DESCRIPTION"),template:function(e){var t="-";return e.devices&&e.devices[0]&&(t=e.devices[0].dms_devices_description),t},editable:!0,hasInputRemoveBtn:!0,editTemplate:function(){return"<form class='validator' data-role='commonvalidator' data-type='description'><input id='asset-device-description' class='k-input' style='line-height:36px; width:100%;' data-bind='value:fields.dms_devices_description'/><i class='ic ic-bt-input-remove'></i></form>"},editFieldName:"devices[0]",editViewModel:{fields:{dms_devices_description:null},init:function(){this.fields.dms_devices_description||(this.fields.dms_devices_description="")},change:function(e){}},validationRule:function(e,t){return t.find(".validator").data("kendoCommonValidator").validate()}}}},setAdditionalDetailData:function(e){console.error("set additional!"),console.error(this);var t=e.assets_types_id,i=e.devices[0];if(0!=t&&i&&i.dms_devices_id){E.open(this.element);var a=i.dms_devices_id;return $.ajax({url:"/dms/devices/"+a}).then(function(e){i.dms_devices_networks=e.networks,i.dms_devices_information=e.information,E.close()}).fail(function(){E.close()})}var n=new $.Deferred;return n.resolve(),n.promise()}},F='<div class="asset-search-wrapper"><div class="search-box"><input type="text" class="k-textbox search-field" placeholder="#=placeholder#" style="width:100%;"/><button class="search-btn ic ic-bt-input-search" data-bind="events:{ click : searchField.click }">'+v.prop("COMMON_SEARCH")+'</button></div><div class="asset-search-results-wrapper"></div><div class="asset-search-grid"></div></div>';B.contentViewModel.clickUserSearchBtn=function(e){var i=f.getSelectedData(),t=T.template(F);t=t({placeholder:v.prop("SERVICE_ASSET_SEARCH_USER")}),c.content(t);var a=c.element,n=a.find(".asset-search-grid"),o=$.extend({},A,{selectable:"row",hasSelectedModel:!0,setSelectedAttrute:!0,columns:[{field:"name",title:v.prop("COMMON_NAME"),width:80,sortable:!1},{field:"id",title:"ID",width:106,sortable:!1},{field:"email",title:v.prop("COMMON_EMAIL"),width:158,sortable:!1,template:function(e){var t="-";return e.email&&(t=e.email),t}},{field:"mobilePhoneNumber",title:v.prop("SERVICE_ASSET_USER_PHONE"),width:184,sortable:!1,template:function(e){var t="-";return e.mobilePhoneNumber&&(t=e.mobilePhoneNumber),t}}],dataSource:[]}),s=n.kendoGrid(o).data("kendoGrid"),r=a.find(".search-field"),l=a.find(".search-btn");r.on("keydown",function(e){13==e.keyCode&&l.click()}),l.on("click",function(){var e,t;e=r.val(),t="?",e&&(t+="contains="+e+"&"),t+="containsAttributes=id,name,organization,workPhoneNumber,mobilePhoneNumber&",t+="role=Tenant",E.open(c.element),$.ajax({url:"/ums/users"+t}).done(function(e){var t=new T.data.DataSource({data:e});t.read(),s.setDataSource(t)}).fail(function(e){var t=_.parseFailResponse(e);G.message(t),G.open()}).always(function(){E.close()})}),c.open(),c.setActions(1,{action:function(){var e=s.getSelectedData();if(e.length<1)return G.message(v.prop("SERVICE_ASSET_NO_SELECTED_USER")),G.open(),!1;var t=e[0];i.users[0]||i.users.push({}),i.users[0].set("ums_users_name",t.name),f.updateDisplayField("ums_users_name"),i.users[0].set("ums_users_id",t.id),f.updateDisplayField("ums_users_id"),f.editFields.ums_users_id.viewModel.fields.set("ums_users_id",t.id),i.users[0].set("ums_users_organization",t.organization),f.updateDisplayField("ums_users_organization"),i.users[0].set("ums_users_email",t.email),f.updateDisplayField("ums_users_email"),i.users[0].set("ums_users_mobilePhoneNumber",t.mobilePhoneNumber),f.updateDisplayField("ums_users_mobilePhoneNumber")}})},B.contentViewModel.clickBeaconSearchBtn=function(){var i=f.getSelectedData(),e=T.template(F);e=e({placeholder:v.prop("SERVICE_ASSET_SEARCH_BEACON")}),p.content(e);var t=p.element,a=t.find(".asset-search-grid"),n=$.extend({},A,{selectable:"row",hasSelectedModel:!0,setSelectedAttrute:!0,columns:[{field:"id",title:v.prop("FACILITY_DEVICE_DEVICE_ID"),width:106,sortable:!1},{field:"name",title:v.prop("FACILITY_DEVICE_DEVICE_NAME"),width:122,sortable:!1},{field:"macAddress",title:v.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),width:158,sortable:!1,template:l.getBleMacAddress},{field:"status",title:v.prop("COMMON_STATUS"),width:142,sortable:!1,template:d.detailStatusIconTemplate}],dataSource:[]}),o=a.kendoGrid(n).data("kendoGrid"),s=t.find(".search-field"),r=t.find(".search-btn");s.on("keydown",function(e){13==e.keyCode&&r.click()}),r.on("click",function(){var e,t;e=s.val(),t="?",e&&(t+="contains="+e+"&",t+="containsAttributes=id,name,networks--ble-macAddress&"),t+="types=Beacon&",t+="registrationStatuses=NotRegistered,Registered&",E.open(p.element),$.ajax({url:"/dms/devices"+t}).done(function(e){var t=new T.data.DataSource({data:e});t.read(),o.setDataSource(t)}).fail(function(e){var t=_.parseFailResponse(e);G.message(t),G.open()}).always(function(){E.close()})}),p.open(),p.setActions(1,{action:function(){var e=o.getSelectedData();if(e.length<1)return G.message(v.prop("SERVICE_ASSET_NO_SELECTED_BEACON")),G.open(),!1;var t=e[0];i.devices[0]||i.devices.push({}),i.devices[0].set("dms_devices_id",t.id),f.updateDisplayField("dms_devices_id"),f.editFields.dms_devices_id.viewModel.fields.set("dms_devices_id",t.id),i.devices[0].set("dms_devices_name",t.name),f.updateDisplayField("dms_devices_name"),f.editFields.dms_devices_name.viewModel.fields.set("dms_devices_name",t.name),f.editFields.dms_devices_name.find("[data-role='commonvalidator']").val(t.name),i.devices[0].set("dms_devices_type",t.type),i.devices[0].set("dms_devices_mappedType",t.mappedType),i.devices[0].set("dms_devices_representativeStatus",t.representativeStatus),i.devices[0].set("dms_devices_alarms",t.alarms),i.devices[0].set("dms_devices_networks",t.networks),i.devices[0].set("dms_devices_information",t.information),i.devices[0].set("dms_devices_locations",t.locations),f.updateDisplayField("dms_devices_representativeStatus"),f.updateDisplayField("dms_devices_macAddress"),f.updateDisplayField("dms_devices_lastEventTime"),f.updateDisplayField("dms_devices_signalLevel"),f.updateDisplayField("dms_devices_batteryLevel"),i.devices[0].set("dms_devices_description",t.description),f.updateDisplayField("dms_devices_description"),f.editFields.dms_devices_description.viewModel.fields.set("dms_devices_description",t.description),f.editFields.dms_devices_description.find("[data-role='commonvalidator']").val(t.description)}})};var x,k,V,P,W={Asset:["number","assets_types","subAssetType","modelName","serialNumber","purchaseDate","originalCost","bookValue","managementOrganization","mobilityType","location","currentLocations","description","ums_users_name","ums_users_id","ums_users_organization","ums_users_email","ums_users_mobilePhoneNumber","dms_devices_id","dms_devices_name","dms_devices_representativeStatus","dms_devices_macAddress","dms_devices_lastEventTime","dms_devices_signalLevel","dms_devices_batteryLevel","dms_devices_description"]},U={Asset:{buttonsIndex:{CLOSE:0,EDIT:1,CANCEL:2,SAVE:3,REGISTER:4,DEREGISTER:5,DELETE:6},onTypeChange:function(e){var t=e.sender.dataSource.data().length,i=e.type,a=e.sender.BTN;"register"==i?(f.setActions(a.SAVE,{visible:!1}),f.setActions(a.CANCEL,{visible:!1}),f.setActions(a.EDIT,{visible:!1}),f.setActions(a.DEREGISTER,{visible:!1}),f.setActions(a.DELETE,{visible:!0}),f.setActions(a.CLOSE,{visible:!0}),f.setActions(a.REGISTER,{visible:!0})):(f.setActions(a.SAVE,{visible:!1}),f.setActions(a.CANCEL,{visible:!1}),f.setActions(a.DEREGISTER,{visible:!1}),f.setActions(a.REGISTER,{visible:!1}),f.setActions(a.DELETE,{visible:!0}),f.setActions(a.CLOSE,{visible:!0}),1<t?f.setActions(a.EDIT,{visible:!0,disabled:!0}):f.setActions(a.EDIT,{visible:!0,disabled:!1}))},actions:[{text:v.prop("COMMON_BTN_CLOSE"),visible:!0,action:w},{text:v.prop("COMMON_BTN_EDIT"),visible:!0,action:S},{text:v.prop("COMMON_BTN_CANCEL"),visible:!1,action:D},{text:v.prop("COMMON_BTN_SAVE"),visible:!1,disabled:!0,action:O},{text:v.prop("COMMON_BTN_REGISTER"),visible:!1,action:N},{text:v.prop("COMMON_BTN_DEREGISTER"),visible:!1,action:L},{text:v.prop("COMMON_BTN_DELETE"),visible:!0,action:R}]}},Y={};for(V in W){for(P in k=W[V],(x=$.extend(!0,{},B)).scheme.fields)-1==k.indexOf(P)&&delete x.scheme.fields[P];Y[V]=x}for(V in U)x=Y[V],x=$.extend(!0,x,U[V]);var G,z,H=$("<div/>");return G=H.kendoCommonDialog().data("kendoCommonDialog"),z=$("<div/>").kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog"),i=b.kendoDetailDialog(M).data("kendoDetailDialog"),g=I.kendoCommonDialog({type:"confirm",title:v.prop("SERVICE_ASSET_TYPE_MANAGEMENT"),timeout:0,width:788,height:830,actions:[{text:v.prop("COMMON_BTN_CLOSE")},{text:v.prop("COMMON_BTN_ADD")}]}).data("kendoCommonDialog"),{getDetailPopup:function(e){return f=s.kendoDetailDialog(Y[e]).data("kendoDetailDialog")},messageDialog:G,confirmDialog:z,assetTypePopup:i,assetTypeAddPopup:g,setAssetTypes:function(e){y=e}}}),define("device/common/config/light-control-vm",[],function(){var t=window.CommonLoadingPanel,d=window.kendo,e=window.I18N;function c(e){var t,i=e.dataSource.data(),a=i.length,n=[];for(t=0;t<a;t++)n.push({id:i[t].id,type:i[t].type});return n}function p(e,t){var i,a,n,o,s,r=t.dataSource,l=e.length;for(s=0;s<l;s++)o=(n=e[s]).id,(a=r.get(o))&&(n.operations&&a.set("operations",n.operations),n.lights&&a.set("lights",n.lights),a.locations&&((i=a.locations)instanceof d.data.ObservableObject&&(i=i.toJSON()),n.locations=i));r.fetch(),e.length<=1&&t._renderHeaderTemplate(),t.trigger("onSaved",{sender:t,result:e[0],results:e,hideMessagePopup:!0})}return $("<div/>").kendoCommonDialog().data("kendoCommonDialog"),{lightControlTemplate:'<div class="group-control-dialog-control groupControl"><div class="controllerList noarr"><div class="horzline"></div><div class="typename">'+e.prop("FACILITY_DEVICE_TYPE_LIGHT")+'</div><div class="innerBox"><div class="innerSet"><button type="button" class="controlBtn" data-bind="events:{click:light.power.click}, css:{selected:light.power.active}, invisible:light.power.invisible"><span class="icwrap"><i class="ic power"></i><span data-bind="visible:light.power.active">ON<span data-bind="visible:light.power.mixed">/OFF</span></span><span data-bind="invisible:light.power.active">OFF</span></span></button><p class="bluetit" data-bind="invisible:light.invisible">'+e.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS")+' (0 ~ 100 %)</p><div class="tb slider" data-bind="invisible:light.invisible"><div class="tbc"><div class="customSlider"><input style="width:160px;" data-bind="value:light.value,events:{slide:light.slide}" data-role="slider" data-show-buttons="false" data-tooltip="{enabled:false, format:\'{0}\'}" data-tick-placement="none" data-min="0" data-max="100" data-small-step="1" data-large-step="1"/><span class="valTxt"><span data-bind="text:light.value"></span>%</span></div></div></div></div></div></div></div>',lightControlViewModel:d.observable({init:function(e){this.popup=e,this.popup.Loading=new t(this.popup.element),this.light.init()},popup:null,light:{init:function(){this.power.set("active",!1),this.power.set("invisible",!1),this.set("invisible",!1),this.set("value",50)},timeout:null,invisible:!1,value:50,power:{invisible:!1,active:!1,mixed:!1,click:function(e){var t=this.light,i=t.power.get("active");t.power.set("active",!i),t.power.set("mixed",!1),function(e,t){var i=e.Loading;i.open();var a=c(e),n={id:"General"};n.power=t.power.get("active")?"On":"Off";var o,s,r=a.length,l=[];for(o=0;o<r;o++)s={id:a[o].id,operations:[n]},l.push(s);p(l,e),i.close()}(this.popup,this.light)}},slide:function(e){var t=this.light,i=this.popup;t.set("value",e.value),t.timeout&&(clearTimeout(t.timeout),t.timeout=null),t.timeout=setTimeout(function(){!function(e,t){var i=e.Loading;i.open();var a=c(e),n=t.get("value"),o=[];o.push({id:1,dimmingLevel:n});var s,r,l=a.length,d=[];for(s=0;s<l;s++)r={id:a[s].id,lights:o},d.push(r);p(d,e),i.close()}(i,t)},500)}}})}}),define("device/common/config/smartplug-control-vm",[],function(){var t=window.CommonLoadingPanel,d=window.kendo,e=window.I18N;function c(e){var t,i=e.dataSource.data(),a=i.length,n=[];for(t=0;t<a;t++)n.push({id:i[t].id,type:i[t].type});return n}function p(e,t){var i,a,n,o,s,r=t.dataSource,l=e.length;for(s=0;s<l;s++)o=(n=e[s]).id,(a=r.get(o))&&(n.operations&&a.set("operations",n.operations),n.lights&&a.set("lights",n.lights),a.locations&&((i=a.locations)instanceof d.data.ObservableObject&&(i=i.toJSON()),n.locations=i));r.fetch(),e.length<=1&&t._renderHeaderTemplate(),t.trigger("onSaved",{sender:t,result:e[0],results:e,hideMessagePopup:!0})}return $("<div/>").kendoCommonDialog().data("kendoCommonDialog"),{smartPlugControlTemplate:'<div class="group-control-dialog-control groupControl"><div class="controllerList noarr"><div class="horzline"></div><div class="typename">'+e.prop("FACILITY_DEVICE_TYPE_SMART_PLUG")+'</div><div class="innerBox"><div class="innerSet"><button type="button" class="controlBtn" data-bind="events:{click:smartPlug.power.click}, css:{selected:smartPlug.power.active}, invisible:smartPlug.power.invisible"><span class="icwrap"><i class="ic power"></i><span data-bind="visible:smartPlug.power.active">ON</span><span data-bind="invisible:smartPlug.power.active">OFF</span></span></button></div></div></div></div>',smartPlugControlViewModel:d.observable({init:function(e){this.popup=e,this.popup.Loading=new t(this.popup.element),this.smartPlug.init()},popup:null,smartPlug:{init:function(){this.power.set("active",!1),this.power.set("invisible",!1),this.set("invisible",!1),this.set("value",50)},timeout:null,invisible:!1,value:50,power:{invisible:!1,active:!1,click:function(e){var t=this.smartPlug,i=t.power.get("active");t.power.set("active",!i),function(e,t){var i=e.Loading;i.open();var a=c(e),n={id:"General"};n.power=t.power.get("active")?"On":"Off";var o,s,r=a.length,l=[];for(o=0;o<r;o++)s={id:a[o].id,operations:[n]},l.push(s);p(l,e),i.close()}(this.popup,this.smartPlug)}},slide:function(e){var t=this.smartPlug,i=this.popup;t.set("value",e.value),t.timeout&&(clearTimeout(t.timeout),t.timeout=null),t.timeout=setTimeout(function(){!function(e,t){var i=e.Loading;i.open();var a=c(e),n=t.get("value"),o=[];o.push({id:1,dimmingLevel:n});var s,r,l=a.length,d=[];for(s=0;s<l;s++)r={id:a[s].id,lights:o},d.push(r);p(d,e),i.close()}(i,t)},500)}}})}}),define("device/common/config/popup-config",["device/common/device-util","device/common/device-template","device/common/config/light-control-vm","device/common/config/smartplug-control-vm"],function(T,n,E,f){var v,m,c,o=window.I18N,s=window.MAIN_WINDOW,b=window.Util,e=window.CommonLoadingPanel,I=window.kendo,p=window.moment,_=new e,t=$("#device-detail-popup"),i=$("#device-detail-map-popup"),a=$("#device-history-message-popup"),r=$("#device-history-confirm-popup"),d=[];m=i.kendoCommonDialog({title:"Map",timeout:0,width:700,height:680,actions:[{text:o.prop("COMMON_BTN_CANCEL")},{text:o.prop("COMMON_BTN_SAVE")}]}).data("kendoCommonDialog");var l={height:"100%",scrollable:!1,sortable:!1,filterable:!1,pageable:!1,rowHeaders:!0},u=o.prop("FACILITY_HISTORY"),g=o.prop("FACILITY_HISTORY_CONTROLLED_TIME"),C=o.prop("FACILITY_HISTORY_LOCATION"),h=o.prop("FACILITY_HISTORY_CONTROL_BY"),y=o.prop("FACILITY_HISTORY_CONTROL_TYPE"),A=o.prop("FACILITY_HISTORY_OPERATION"),w=o.prop("FACILITY_HISTORY_DETAIL"),S=o.prop("FACILITY_HISTORY_GROUP"),D={"b.IoT":o.prop("FACILITY_HISTORY_QUADURON"),Others:o.prop("FACILITY_HISTORY_OTHERS")},O={Manual:o.prop("FACILITY_HISTORY_MANUAL"),Rule:o.prop("FACILITY_HISTORY_RULE"),Schedule:o.prop("FACILITY_HISTORY_SCHEDULE")};c=a.kendoCommonDialog().data("kendoCommonDialog"),r.kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog");var N=$("#popup-history").kendoPopupSingleWindow({title:u,width:"1296px",deactivate:function(){$("<div class='k-overlay' style='dislay:block; z-index:10002; opacity:0.5;'></div>").appendTo($("body"))}});N.closest(".popup-window").addClass("popup-device-history");var L=I.data.Model.define({fields:{time:{name:g,type:"string"},location:{name:C,type:"string"},group:{name:S,type:"string"},systemOrigin:{name:h,type:"string"},serviceOrigin:{name:y,type:"string"},attributes:{name:A,type:"string"}}});$("#popup-history-detail").kendoPopupSingleWindow({model:L,title:w,width:"600px"});var R=[{field:"time",title:g,width:200,template:function(e){var t=e.time;return p(t).format("LLL").replace(/\./g,"-")}},{field:"location",title:C,width:200,sortable:!1},{field:"systemOrigin",title:h,width:200,sortable:!1,template:function(e){var t=D[e.systemOrigin];return t=t||o.prop("FACILITY_HISTORY_OTHERS")}},{field:"serviceOrigin",title:y,width:200,sortable:!1,template:function(e){var t=O[e.serviceOrigin];return t=t||o.prop("FACILITY_HISTORY_OTHERS")}},{field:"attributes",title:A,sortable:!1,template:function(e){var t,i,a,n,o="",s="",r=e.attributes,l=r.length;if(r)for(var d=0;d<r.length;d++){for(var c=r[d],p=(t=c.key.split("-")).length-1;0<=p;p--)s+=t[p];1<t.length&&(s=(s=t[t.length-2]+"_"+t[t.length-1]).replace(/-|\./g,"_")),s=s.toUpperCase(),i=c.value,-1<s.indexOf("DIMMINGLEVEL")&&(s="DIMMINGLEVEL"),a=b.getHistoryOperation(s),n=-1!=s.indexOf("VALUE")||-1!=s.indexOf("DESIRED")||-1!=s.indexOf("LEVEL")?b.getHistoryOperationValue("FACILITY_HISTORY_OPERATION_"+s+"_VALUE",i.toUpperCase()):(-1!=i.indexOf("~")&&(i=i.replace("~","_")),b.getHistoryOperationValue("FACILITY_HISTORY_OPERATION_"+s+"_"+i.toUpperCase())),o=1<l?"<div style='text-align:center;'>"+a+" / "+n+"<span> (+"+(l-1)+")</span></div>":"<div style='text-align:center;'>"+a+" / "+n+"</div>";break}else o="<div style='text-align:center;'><span>-<span></div>";return o}},{title:w,template:"<span class='ic ic-info' data-event='detail'></span>",sortable:!1,width:"66px"}],M=$(".popup-device-history .device-history-grid").kendoGrid({dataSource:[],scrollable:{virtual:!0},sortable:!0,height:"100%",columns:R});M.data("kendoGrid").dataSource.sort([{field:"time",dir:"desc"}]);var B=new Date,F=$("#popup-history").find("input.startdate"),x=$("#popup-history").find("input.enddate");function k(){var e=F.data("kendoCommonDatePicker").value(),t=x.data("kendoCommonDatePicker").value(),i=(t.getTime()-e.getTime())/864e5,a=e,n=e,o=new Date;365<i&&(t=new Date(e.getFullYear()+1,e.getMonth(),e.getDate())),t<e&&(e=a,0<(t=n)-o&&(e=new Date,t=new Date)),0<t-o&&(t=new Date),e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59),F.data("kendoCommonDatePicker").setDate(e),x.data("kendoCommonDatePicker").setDate(t)}function V(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1),e.sender.trigger("onClosed")}function P(e){return e.sender.trigger("onEdit"),e.sender.setEditable(!0),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!1}),e.sender.setActions(e.sender.BTN.DEREGISTER,{visible:!1}),e.sender.trigger("onEdited"),!1}function W(e){e.sender.confirmDialog.message(o.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL"));function t(){e.sender.trigger("onCancel"),e.sender.cancelDataSource(),e.sender.setEditable(!1),e.sender.setDialogType(e.sender.dialogType),e.sender.hideInvalidMessage(),e.sender.hideRemoveBtn(),e.sender.trigger("onCanceled")}return e.sender.hasChanged?(e.sender.confirmDialog.setConfirmActions({yes:function(){t()}}),e.sender.confirmDialog.open()):t(),!1}function U(e){e.sender.trigger("onSave");var t,i,a=e.sender.dialogType;return(t=e.sender.save())&&(e.sender.isBlockEvt&&(delete e.sender.isBlockEvt,a="block"),"register"==a?(1<e.sender.dataSource.total()&&(i=e.sender.saveAll({registrationStatus:"Registered"})),t.registrationStatus="Registered",e.sender.trigger("onRegister",{sender:e.sender,result:t,results:i}),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!0}),void 0!==e.sender.BTN.BLOCK&&e.sender.setActions(e.sender.BTN.BLOCK,{visible:!1})):"block"==a?(1<e.sender.dataSource.total()&&(i=e.sender.saveAll({registrationStatus:"Blocked"})),t.registrationStatus="Blocked",e.sender.trigger("onBlock",{sender:e.sender,result:t,results:i}),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!0}),e.sender.setActions(e.sender.BTN.BLOCK,{visible:!1})):(1<e.sender.dataSource.total()&&(i=e.sender.saveAll(null,!0)),e.sender.trigger("onSaved",{sender:e.sender,result:t,results:i}),"deregister"==a?e.sender.setActions(e.sender.BTN.DEREGISTER,{visible:!0}):"delete"==a&&e.sender.setActions(e.sender.BTN.DELETE,{visible:!0})),e.sender.setEditable(!1),void 0!==e.sender.BTN.BLOCK&&"delete"!=a&&e.sender.setActions(e.sender.BTN.DELETE,{visible:!1}),"register"!=a&&"block"!=a||e.sender.setActions(e.sender.BTN.EDIT,{visible:!1})),!1}function Y(e){return e.sender.setEditable(!0),e.sender.setActions(e.sender.BTN.REGISTER,{visible:!1}),void 0!==e.sender.BTN.BLOCK&&e.sender.setActions(e.sender.BTN.BLOCK,{visible:!1}),!1}function G(e){var t,i=e.sender.getSelectedData(),a={};if(a.registrationStatus="NotRegistered",1<e.sender.dataSource.total()){var n,o,s=(i=(i=e.sender.dataSource.data()).toJSON()).length;for(t=[],n=0;n<s;n++)(o={}).id=i[n].id,o.registrationStatus="NotRegistered",t.push(o)}else a.id=i.id;return e.sender.trigger("onDeregister",{sender:e.sender,result:a,results:t}),!1}function z(e){var t=e.type,i=e.sender.BTN;"register"==t?(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.EDIT,{visible:!1}),v.setActions(i.DEREGISTER,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.REGISTER,{visible:!0})):"deregister"==t?(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.REGISTER,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.EDIT,{visible:!0}),v.setActions(i.DEREGISTER,{visible:!0})):(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.DEREGISTER,{visible:!1}),v.setActions(i.REGISTER,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.EDIT,{visible:!0}))}F.kendoCommonDatePicker({value:new Date(B.getFullYear(),B.getMonth(),1,0,0,0),isStart:!0,isEnd:!1,okCallBack:k}),x.kendoCommonDatePicker({value:new Date(B.getFullYear(),B.getMonth(),B.getDate(),23,59,59),isStart:!1,isEnd:!0,okCallBack:k}),F.data("kendoCommonDatePicker").value(),x.data("kendoCommonDatePicker").value(),N.on("click","input[data-attr=All]",function(){var e=$(this),t=e.closest(".popup-window-single"),i=t.find("input.history-control-type"),a=t.find("button[data-event=view]");e.is(":checked")?(i.each(function(e,t){t.checked=!0}),a.data("kendoButton").enable(!0)):(i.each(function(e,t){t.checked=!1}),a.data("kendoButton").enable(!1))}),N.on("click","input.history-control-type",function(){var e=$(this),t=e.closest(".popup-window-single"),i=t.find("input[data-attr=All]"),a=t.find("input.history-control-type"),n=t.find(".toolbar-content.controlType").find(".history-control-type:checked"),o=t.find("button[data-event=view]");0==e.is(":checked")?(i.prop("checked",!1),0==n.length&&o.data("kendoButton").enable(!1)):(n.length==a.length&&i.prop("checked",!0),o.data("kendoButton").enable(!0))}),N.on("click","button[data-event=view]",function(){var e,i,t=$(this).closest(".popup-window-single"),a="",n=t.find("input.startdate").data("kendoCommonDatePicker").getDate(),o=t.find("input.enddate").data("kendoCommonDatePicker").getDate(),s=t.data("curDmsId"),r=t.find(".toolbar-content.controlType").find("input:checked");for(i=0;i<r.length;i++){var l=r.eq(i).attr("data-attr");"All"!==l&&(i<r.length-1?a+=l+",":a+=l)}e="/dms/controlHistories?dms_devices_id="+s+"&serviceOrigins="+a+"&startTime="+(n=n.replace("+","%2b"))+"&endTime="+(o=o.replace("+","%2b")),_.open(t),$.ajax({url:e}).done(function(e){if(e){for(i=e.length-1;0<=i;i--)null===e[i]&&e.splice(i,1);d=e}else d=[];var t=new I.data.DataSource({data:d,pageSize:30});t.read(),M.data("kendoGrid").setDataSource(t)}).fail(function(e){c.message(e.responseText),c.open()}).always(function(){_.close(t)})}),M.on("click","[data-event=detail]",function(e){var i,a,t=$(this),n=t.closest(".popup-window-single"),o=t.closest("tr").data("uid"),s=t.closest(".k-grid").data("kendoGrid").dataSource.getByUid(o),r=$("#popup-history-detail").data("kendoPopupSingleWindow"),l=$("#popup-history-detail").find(".popup-history-detail-map");for(var d in L.fields)""!=s[d]&&void 0!==s[d]||(s[d]="-"),"time"==d&&(s[d]=p(s.time).format("LLL").replace(/\./g,"-"));r.bindHistoryData(s),l.empty(),_.open(n),$.ajax({url:"/dms/devices/"+s.dms_devices_id}).done(function(e){i=e.locations[0].foundation_space_floors_id,a=e.locations[0].foundation_space_zones_id;var t=e;b.getFloorDataWithImage(i).always(function(e){r.openWindowPopup(),l.kendoCommonMapView({width:330,height:222,floor:e,zoneDataSource:[],dataSource:[t],showDeviceInfoCheckbox:!1,isForcedShowDevice:!0,isDetailPopupView:!0,hasFullScreenControl:!1,hasLegendControl:!1,hasZoomControl:!1,hasDefaultZoomControl:!1,hasColorPickerControl:!1,hasLayerControl:!1}),a?$.ajax({url:"/foundation/space/zones/"+a}).done(function(e){l.data("kendoCommonMapView").setZoneDataSource([e]),l.data("kendoCommonMapView").setDataSource([t])}).fail(function(e){c.message(b.parseFailResponse(e)),c.open()}).always(function(){_.close(n)}):_.close(n)}).fail(function(){r.openWindowPopup(),l.css({width:"330px",height:"220px"}),_.close(n)}).always(function(){})}).fail(function(e){_.close(n),c.message(e.responseText),c.open()}).always(function(){})});var H={height:200,columns:[{title:o.prop("FACILITY_DEVICE_TYPE"),field:"type",template:function(e){var t="-",i=e.type;return t=i||t}},{title:o.prop("FACILITY_DEVICE_NETWORK_RSSI"),field:"rssi",template:function(e){var t="-",i=e.rssi;return"-"!=(t=void 0!==i?i:t)&&(t+=" dBm"),t}},{title:o.prop("FACILITY_DEVICE_NETWORK_WIFI_FREQUENCY"),field:"frequency",template:function(e){var t="-",i=e.frequency;return t=i||t}},{title:o.prop("COMMON_TIME"),field:"scannedTime",template:function(e){var t="-",i=e.scannedTime;return i&&(t=(i=p(i)).format("LLL").replace(/\./g,"-")),t}}]},j={title:o.prop("COMMON_BTN_DETAIL"),width:652,height:830,gridOptions:{scrollable:{virtual:!0}},buttonsIndex:{CLOSE:0,EDIT:1,CANCEL:2,SAVE:3,REGISTER:4,DEREGISTER:5,DELETE:6},contentViewModel:{clickHistoryBtn:function(){var e=v.getSelectedData(),t=new Date,i=n(new Date(t.getFullYear(),t.getMonth(),1,0,0,0)),a=n(new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59));function n(e){var t=p(e).format("YYYY-MM-DDTHH:mm:ss");return t=(t+="+09:00").replace("+","%2b")}N.data("curDmsId",e.id),N.find("ul.toolbar-content.controlType").find("input").each(function(e,t){t.checked=!0}),F.data("kendoCommonDatePicker").value(i),x.data("kendoCommonDatePicker").value(a),M.data("kendoGrid").dataSource.data([]),N.kendoPopupSingleWindow("openWindowPopup")},detailType:o.prop("COMMON_GENERAL")},contentTemplate:'<div class="detail-dialog-content device-dialog-content"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>',detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span><button class="device-detail-header-history-btn k-button" data-bind="events: {click : clickHistoryBtn }">'+o.prop("FACILITY_HISTORY")+'</button></div><div class="detail-dialog-detail-content-field-list"></div>',listTemplate:function(e){var t=v.dialogType,i="register"==t||"deregister"==t,a="deregister"==t;return n.multiDetailListDualTemplate(e,i,a)},headerTemplate:"<span>"+o.prop("FACILITY_DEVICE_SELECTED_DEVICE")+": <span>#:count #</span></span>",isCustomActions:!0,onTypeChange:z,actions:[{text:o.prop("COMMON_BTN_CLOSE"),visible:!0,action:V},{text:o.prop("COMMON_BTN_EDIT"),visible:!0,action:P},{text:o.prop("COMMON_BTN_CANCEL"),visible:!1,action:W},{text:o.prop("COMMON_BTN_SAVE"),visible:!1,disabled:!0,action:U},{text:o.prop("COMMON_BTN_REGISTER"),visible:!1,action:Y},{text:o.prop("COMMON_BTN_DEREGISTER"),visible:!1,action:G}],scheme:{id:"id",fields:{type:{type:"text",name:o.prop("FACILITY_DEVICE_TYPE"),template:b.getDetailDisplayTypeDeviceI18N},tagName:{type:"text",name:o.prop("FACILITY_POINT_TAG_NAME"),template:function(e){var t="-";return e.controlPoint&&e.controlPoint.tagName&&(t=e.controlPoint.tagName),t}},id:{type:"text",name:o.prop("FACILITY_DEVICE_DEVICE_ID")},name:{type:"text",name:o.prop("FACILITY_DEVICE_DEVICE_NAME"),editCss:{width:"100%"},validator:{type:"name",required:!0},hasInputRemoveBtn:!0,editable:!0},meterType:{type:"text",name:o.prop("FACILITY_DEVICE_ENERGY_METER_TYPES"),template:T.getMeterType,editable:!0,editFieldName:"type",editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='displayType' data-value-field='type' data-bind='value:fields.type, source: typeList, events:{change:changeTypeList}, disabled:disabled' style='width:216px;'/>"},editViewModel:{fields:{type:null},disabled:!1,init:function(){"AirConditionerController.DMS"==v.getSelectedData().parentType?this.disabled=!0:this.disabled=!1},typeList:[{displayType:o.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATTHOUR"),type:"Meter.WattHour"},{displayType:o.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_GAS"),type:"Meter.Gas"},{displayType:o.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATER"),type:"Meter.Water"}],changeTypeList:function(e){var t=e.sender.value(),i=v.editFields.consumptionCategory.viewModel,a=v.editFields.sacConnectionType.viewModel;this.fields.set("type",t),i.set("meterType",t),i.fields.set("category","AirConditionerAll"),i.set("typeList",T.getConnectedDevicesConsumptionTypeList(t)),a.set("meterType",t),a.set("consumptionType","AirConditionerAll"),a.fields.set("connectedDeviceType","None"),a.set("disabled",!1),a.set("typeList",T.getConnectedDevicesConnectionTypeList(t,"AirConditionerAll")),v.setEditableFieldElem("connectedDevices",!1),v.enableSaveBtn()}}},pointMeterType:{type:"text",name:o.prop("FACILITY_DEVICE_ENERGY_METER_TYPES"),template:T.getMeterType,editable:!0,editFieldName:"mappedType",editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='displayType' data-value-field='type' data-bind='value:fields.mappedType, source: typeList, events:{change:changeTypeList}, disabled:disabled' style='width:216px;'/>"},editViewModel:{fields:{mappedType:null},disabled:!1,init:function(){"AirConditionerController.DMS"==v.getSelectedData().parentType?this.disabled=!0:this.disabled=!1},typeList:[{displayType:o.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATTHOUR"),type:"Meter.WattHour"},{displayType:o.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_GAS"),type:"Meter.Gas"},{displayType:o.prop("FACILITY_DEVICE_ENERGY_METER_TYPE_WATER"),type:"Meter.Water"}],changeTypeList:function(e){var t=e.sender.value(),i=v.editFields.consumptionCategory.viewModel,a=v.editFields.sacConnectionType.viewModel;this.fields.set("mappedType",t),i.set("meterType",t),i.fields.set("category","AirConditionerAll"),i.set("typeList",T.getConnectedDevicesConsumptionTypeList(t)),a.set("meterType",t),a.set("consumptionType","AirConditionerAll"),a.fields.set("connectedDeviceType","None"),a.set("disabled",!1),a.set("typeList",T.getConnectedDevicesConnectionTypeList(t,"AirConditionerAll")),v.setEditableFieldElem("connectedDevices",!1),v.enableSaveBtn()}}},consumptionCategory:{type:"object",name:o.prop("FACILITY_DEVICE_CONSUMPTION_CATEGORY_TYPE"),template:T.getMeterCategoryType,editable:!0,editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.category, source: typeList, events:{change:changeTypeList}, disabled:disabled' style='width:216px;'/>"},editFieldName:"meters[0]",editViewModel:{fields:{id:0,category:null},disabled:!1,meterType:null,init:function(){this.fields.category||(this.fields.category="Others");var e=v.getSelectedData();"AirConditionerController.DMS"==e.parentType?this.disabled=!0:this.disabled=!1;var t=e.meters;t&&t[0]&&(this.fields.id=t[0].id),this.meterType=e.mappedType||e.type,this.typeList=T.getConnectedDevicesConsumptionTypeList(this.meterType)},typeList:[],changeTypeList:function(e){var t=e.sender.value(),i=v.editFields.sacConnectionType.viewModel;this.fields.set("category",t);var a=T.getConnectedDevicesConnectionTypeList(this.meterType,t);i.set("typeList",a),i.set("consumptionType",t),i.fields.set("connectedDeviceType","None"),i.set("disabled","AirConditionerAll"!==t),v.setEditableFieldElem("connectedDevices",!1),v.enableSaveBtn()}}},sacConnectionType:{type:"object",name:o.prop("FACILITY_DEVICE_SAC_CONNECTION_TYPE"),template:function(e){var t,i,a,n,o="";if(i=e.meters)for(a=i.length,t=0;t<a;t++)(n=i[t].connectedDeviceType)&&(o+=b.getDetailDisplayType(n),t!=a-1&&(o+=", "));return o=o?b.getDetailDisplayTypeDeviceI18N(o):"None"},editable:!0,editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.connectedDeviceType, source: typeList, events:{change:changeTypeList}, disabled:disabled' style='width:216px;'/>"},editFieldName:"meters[0]",editViewModel:{fields:{id:0,connectedDeviceType:null},disabled:!1,meterType:null,consumptionType:null,init:function(){this.fields.connectedDeviceType||(this.fields.connectedDeviceType="None");var e=v.getSelectedData();this.meterType=e.mappedType||e.type,this.consumptionType=e.meters&&e.meters[0]&&e.meters[0].category||"None","AirConditionerController.DMS"==e.parentType?this.disabled=!0:this.disabled="AirConditionerAll"!==this.consumptionType;var t=e.meters;t&&t[0]&&(this.fields.id=t[0].id),this.typeList=T.getConnectedDevicesConnectionTypeList(this.meterType,this.consumptionType),v.setEditableFieldElem("connectedDevices","Meter.WattHour"===this.meterType&&"AirConditionerAll"===this.consumptionType&&"AirConditionerOutdoor"===this.fields.connectedDeviceType)},typeList:[],changeTypeList:function(e){var t=e.sender.value(),i="Meter.WattHour"===this.meterType&&"AirConditionerAll"===this.consumptionType&&"AirConditionerOutdoor"===t;this.fields.set("connectedDeviceType",t),v.setEditableFieldElem("connectedDevices",i),v.enableSaveBtn()}}},representativeStatus:{type:"text",name:o.prop("COMMON_STATUS"),template:n.detailStatusIconTemplate},configuration:{type:"object",name:o.prop("FACILITY_DEVICE_BEACON_POSITION_TYPE"),template:function(e){var t="-",i=e.configuration;return i&&i.mobilityType&&(t=(t=i.mobilityType)||"-"),t},editable:!0,editFieldName:"configuration",editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="positionType" id="position-fixed" checked="" value="Fixed" data-bind="checked:fields.mobilityType, click:clickRadio"><label class="k-radio-label" for="position-fixed" style="margin-right:51px;">Fixed</label><input type="radio" class="k-radio" name="positionType" id="position-movable" checked="" value="Movable" data-bind="checked:fields.mobilityType, click:clickRadio"><label class="k-radio-label" for="position-movable">Movable</label></div>'},editViewModel:{fields:{mobilityType:null},init:function(){this.fields.mobilityType||(this.fields.mobilityType="Fixed"),this.positionTypeChecked=this.fields.mobilityType},clickRadio:function(e){v.enableSaveBtn()}}},pointValue:{type:"text",name:o.prop("FACILITY_POINT_VALUE"),template:T.getPointValue},pointMode:{type:"text",name:o.prop("FACILITY_POINT_MODE"),template:function(e){var t="-",i=e.controlPoint;if(i&&void 0!==i.mode){var a=i.mode;1==a?t="Normal":2==a&&(t="Counter")}return t}},signalLogicStatus:{type:"text",name:o.prop("FACILITY_POINT_SIGNAL_LOGIC_STATUS"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.signalLogicStatus&&(t=i.signalLogicStatus),t}},signalReverse:{type:"text",name:o.prop("FACILITY_POINT_SIGNAL_REVERSE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.signalReverse&&(t=i.signalReverse?"Yes":"No"),t}},inputRange:{type:"text",name:o.prop("FACILITY_POINT_INPUT_RANGE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.inputRange&&("+-10V"==(t=i.inputRange)?t="+/- 10V":"+-2.5V"==t&&(t="+/- 2.5V")),t}},scaleType:{type:"text",name:o.prop("FACILITY_POINT_SCALE_TYPE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.scaleType&&(t=i.scaleType),t}},scale:{type:"text",name:o.prop("FACILITY_POINT_SCALE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.scale&&(t=i.scale),t}},bias:{type:"text",name:o.prop("FACILITY_POINT_BIAS"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.bias&&(t=i.bias),t}},maxValue:{type:"text",name:o.prop("FACILITY_POINT_MAX_VALUE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.maximumValue&&(t=i.maximumValue),t}},minValue:{type:"text",name:o.prop("FACILITY_POINT_MIN_VALUE"),template:function(e){var t="-",i=e.controlPoint;return i&&void 0!==i.minimumValue&&(t=i.minimumValue),t}},ioDescription:{type:"text",name:o.prop("FACILITY_POINT_IO_DESCRIPTION"),template:function(e){var t="-",i=e.controlPoint;return i&&i.ioDescription&&(t=i.ioDescription),t}},modes:{type:"text",name:o.prop("FACILITY_INDOOR_CONTROL_OPERATION_MODE"),template:function(e){var t=e.modes;return t&&0<t.length?b.getDisplayModeI18N(t,e.operations,!0):"-"}},outdoorTemperature:{type:"text",name:o.prop("FACILITY_DEVICE_OUTDOOR_TEMPERATURE"),template:T.curOutdoorTemperature},setTemperature:{type:"text",name:o.prop("FACILITY_INDOOR_SET_TEMPERATURE"),template:T.setTemperatures},currentTemperature:{type:"text",name:o.prop("FACILITY_INDOOR_CURRENT_TEMPERATURE"),template:T.curTemperatures},remoteControl:{type:"text",name:o.prop("FACILITY_INDOOR_REMOTE_CONTROL"),template:function(e){var t=e.configuration;return t&&t.remoteControl?"Allowed"===t.remoteControl?o.prop("FACILITY_INDOOR_REMOTE_CONTROL_ENABLE"):"NotAllowed"===t.remoteControl?o.prop("FACILITY_INDOOR_REMOTE_CONTROL_DISABLE"):o.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_CONDITIONAL"):"-"}},locations:{type:"array",name:o.prop("COMMON_LOCATION"),editable:!0,template:T.getLocation,editTemplate:function(){return"<input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.foundation_space_buildings_id, source: buildingList, events:{change:changeBuildingList, dataBound:dataBoundBuildingList}' style='width:95px;margin-right:10px;'/><input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.foundation_space_floors_id, source: floorList, events:{change:changeFloorList, dataBound:dataBoundFloorList}' style='width:95px;margin-right:10px;'/><input data-role='dropdownlist' data-text-field='name' data-value-field='id' data-bind='value:fields.foundation_space_zones_id, source: zoneList, events:{change:changeZoneList, dataBound:dataBoundZoneList}' style='width:95px;margin-right:10px;'/><button type='button' class='ic-bt-map popup-btn k-button k-button-icon' data-bind='events:{click:onMapBtnClick}, disabled:isMapBtnDisabled'></button>"},editViewModel:{initialFieldsOnClose:function(e){this.fields.foundation_space_buildings_id=null,this.fields.foundation_space_floors_id=null,this.fields.foundation_space_zones_id=null},initialFieldsOnCloseBinded:null,init:function(){this.isMapBtnDisabled=!0;var e=s.getCurrentFloor(),t=e.building,i=e.floor,a=v.dialogType;this.isSetFloorList=!1,this.isSetZoneList=!1,this.initialFieldsOnCloseBinded||(this.initialFieldsOnCloseBinded=this.initialFieldsOnClose.bind(this)),v.unbind("onClose",this.initialFieldsOnCloseBinded),v.bind("onClose",this.initialFieldsOnCloseBinded),v.options.enableSaveBtnCondition="register"==a?function(){var e=this.editFields.locations;if(e&&e.viewModel){var t=e.viewModel.fields.get("foundation_space_floors_id");if(null!=t)return!0}return!1}:null,"register"!=a&&this.fields.foundation_space_buildings_id||t.id==s.FLOOR_NAV_BUILDING_TOTAL_ID||(this.fields.foundation_space_buildings_id=t.id),"register"!=a&&this.fields.foundation_space_floors_id||i.id==s.FLOOR_NAV_FLOOR_ALL_ID||(this.fields.foundation_space_floors_id=i.id,"register"==a&&(this.fields.foundation_space_zones_id=null),null!==i.id&&void 0!==i.id&&v.enableSaveBtn())},fields:{nameDisplayCoordinate:null,id:"Fixed",foundation_space_buildings_id:null,foundation_space_floors_id:null,foundation_space_zones_id:null,description:null,geometry:null},checkBtnDisabled:function(e){var t=this.fields.get("foundation_space_buildings_id"),i=this.fields.get("foundation_space_floors_id");e&&(null===t||null===i?v.disableSaveBtn():v.enableSaveBtn()),null===i?this.set("isMapBtnDisabled",!0):this.set("isMapBtnDisabled",!1)},isSetFloorList:!1,isSetZoneList:!1,isMapBtnDisabled:!0,buildingList:s.getCurrentBuildingList(),floorList:[],zoneList:[],centerZoneId:0,centerCoordinate:[],setSelectedLocation:function(e,t,i,a){var n,o,s=v.selectedIndex,r=v.dataSource.data(),l=r.length;if(0==s)for(o=0;o<l;o++)(n=r[o])&&(n.locations||(n.locations=[]),n.locations[0]||n.locations.push({id:"Fixed"}),n.locations[0].foundation_space_buildings_id=e,n.locations[0].foundation_space_floors_id=t,n.locations[0].foundation_space_zones_id=i,n.locations[0].description=a)},setLocationDescription:function(e,t,i){var a,n=this.fields.get("description");if(n){var o;for(a=n.split(", "),e&&(a[0]=e),a[1]=t||"",a[2]=i||"",o=a.length-1;0<=o;o--)a[o]||a.splice(o,1);n=a.join(", ")}else e&&t&&i?n=e+", "+t+", "+i:e&&t?n=e+", "+t:e&&(n=e);return this.fields.set("description",n),n},dataBoundBuildingList:function(e){this.changeBuildingList(e,!0)},changeBuildingList:function(e,t){var i,o=this;if(t){if(i=o.fields.get("foundation_space_buildings_id"),e.sender.value(i),!i)return}else i=e.sender.value(),o.fields.set("foundation_space_buildings_id",i);var a=e.sender.text();this.set("buildingText",a);var n=o.setLocationDescription(a);this.setSelectedLocation(i,null,null,n),_.open(v.element),$.ajax({url:"/foundation/space/floors?foundation_space_buildings_id="+i}).done(function(e){var t,i,a,n=e.length;for(e.sort(function(e,t){return e.sortOrder-t.sortOrder}),t=0;t<n;t++)i=e[t].type,a=e[t].name,e[t].name="F"==i?a+i:"B"==i?i+a:a;o.set("isSetFloorList",!0),o.set("floorList",e),e.length<1&&(o.fields.set("foundation_space_floors_id",null),o.set("zoneList",[]))}).fail(function(e){var t=b.parseFailResponse(e);v.msgDialog.message(t),v.msgDialog.open()}).always(function(){_.close();var e="register"==v.dialogType;o.checkBtnDisabled(e)})},dataBoundFloorList:function(e){this.changeFloorList(e,!0)},changeFloorList:function(e,n){var t,o=this,i=o.fields.get("foundation_space_buildings_id");if(n){t=o.fields.get("foundation_space_floors_id"),e.sender.value(t);var a=e.sender.value(),s=this.get("floorList"),r=this.get("isSetFloorList");if(t&&s&&r)new I.data.Query(s).filter({field:"id",operator:"eq",value:t}).toArray().length<1&&(t=null);if(t||a||o.fields.set("foundation_space_floors_id",null),!t)return}else t=e.sender.value(),o.fields.set("foundation_space_floors_id",t),v.hasChanged=!0;var l=e.sender.text();this.set("floorText",l);var d=o.setLocationDescription(this.get("buildingText"),l);this.setSelectedLocation(i,t,null,d),_.open(v.element),b.getFloorDataWithImage(t).always(function(a){$.ajax({url:"/foundation/space/zones?foundation_space_buildings_id="+i+"&foundation_space_floors_id="+t}).done(function(e){e.sort(function(e,t){return e.sortOrder-t.sortOrder});var t=b.getCenterMap(a.imageWidth,a.imageHeight),i=b.getCenterZoneId(e,t);o.set("centerZoneId",i),o.set("centerCoordinate",t),o.set("isSetZoneList",!0),o.set("zoneList",e),e.length<1?(o.fields.set("foundation_space_zones_id",null),n||o.fields.set("geometry",{type:"Point",coordinates:t})):o.fields.get("geometry")||o.fields.get("foundation_space_zones_id")||(o.fields.foundation_space_zones_id=i)}).fail(function(e){var t=b.parseFailResponse(e);v.msgDialog.message(t),v.msgDialog.open()}).always(function(){_.close(),n||o.checkBtnDisabled(!0)})})},dataBoundZoneList:function(e){this.changeZoneList(e,!0)},changeZoneList:function(e,t){var a=this,i=null,n=a.fields.get("foundation_space_buildings_id"),o=a.fields.get("foundation_space_floors_id");if(t){var s=a.fields.get("foundation_space_zones_id");e.sender.value(s),i=s;var r=e.sender.value(),l=this.get("zoneList"),d=this.get("isSetZoneList");if(s&&l&&d)new I.data.Query(l).filter({field:"id",operator:"eq",value:s}).toArray().length<1&&(i=s=null);if(!s&&!r)if(a.fields.get("geometry"))i=0,a.fields.set("foundation_space_zones_id",i);else{i=a.get("centerZoneId"),a.fields.set("foundation_space_zones_id",i);var c=a.get("centerCoordinate");c.length&&a.fields.set("geometry",{type:"Point",coordinates:c})}}else{i=e.sender.value();var p=a.fields.get("geometry");a.fields.set("foundation_space_zones_id",i),v.hasChanged=!0;var u={coordinates:null,type:"Point"};a.fields.locations&&a.fields.locations[0]?(a.fields.locations[0].set("foundation_space_zones_id",i),a.fields.locations[0].set("geometry",p)):a.fields.set("locations",[{foundation_space_buildings_id:n,foundation_space_floors_id:o,foundation_space_zones_id:i,geometry:p}]),_.open(v.element),$.ajax({url:"/foundation/space/zones/"+i}).done(function(e){if(e.geometry&&e.geometry.coordinates&&e.geometry.coordinates[0]){var t=e.geometry.coordinates[0],i=b.getCentroid(t);u.coordinates=i,a.fields.set("geometry",u)}}).fail(function(){}).always(function(){_.close()}),a.checkBtnDisabled(!0)}var m=e.sender.text();this.set("zoneText",m);var g=a.setLocationDescription(this.get("buildingText"),this.get("floorText"),m);this.setSelectedLocation(n,o,i,g)},onMapBtnClick:function(e){var l=$("<div/>").addClass("device-detail-map-view-box"),d=this,c=d.fields.get("foundation_space_buildings_id"),p=d.fields.get("foundation_space_floors_id"),u=d.fields.get("geometry");_.open(v.element),b.getFloorDataWithImage(p).always(function(a){$.ajax({url:"/foundation/space/zones?foundation_space_buildings_id="+c+"&foundation_space_floors_id="+p}).done(function(e){var t=v.getSelectedData();s&&(t.locations&&t.locations[0]?(t.locations[0].set("foundation_space_zones_id",s),t.locations[0].set("geometry",u)):t.set("locations",[{foundation_space_buildings_id:c,foundation_space_floors_id:p,foundation_space_zones_id:s,geometry:u}]));var n,i="register"==v.dialogType,o={coordinates:null,type:"Point"},s=null,r="";m.content(l),m.setActions(1,{action:function(){o.coordinates&&(d.fields.set("geometry",o),t.locations||t.set("locations",[{}]),t.locations[0]||t.locations.push({}),t.locations[0].set("geometry",o),v.hasChanged=!0,s?d.fields.set("foundation_space_zones_id",Number(s)):d.fields.set("foundation_space_zones_id",0),r&&(d.set("zoneText",r),d.setLocationDescription(d.get("buildingText"),d.get("floorText"),r))),n&&d.fields.set("nameDisplayCoordinate",n),d.checkBtnDisabled(!0)}}),m.element.css("overflow","auto"),m.open(),l.kendoCommonMapView({dataSource:[t],zoneDataSource:e,floor:a,isForcedShowDevice:!0,isDetailPopupView:!0,canDragDeviceIcon:!0,isRegisterView:i,width:668,height:527,hasLegendControl:-1===t.type.indexOf("Outdoor")}).data("kendoCommonMapView").bind("dragend",function(e){var t,i,a=e.devices[0];a?(a.nameDisplayCoordinate&&(n=a.nameDisplayCoordinate),a.locations&&(t=a.locations[0],o.coordinates=t.geometry.coordinates,(s=t.foundation_space_zones_id)&&(i=e.sender.zoneDataSource.get(s),r=i.name))):console.error("device is not found when device move end")})}).fail(function(e){var t=b.parseFailResponse(e);console.error(t)}).always(function(){_.close()})})}}},currentLocations:{type:"text",name:o.prop("FACILITY_DEVICE_BEACON_CURRENT_LOCATION"),template:T.getCurrentLocation},groups:{type:"text",name:o.prop("FACILITY_GROUP_GROUP"),template:T.getGroup},weatherStation:{type:"object",name:o.prop("FACILITY_DEVICE_TEMP_HUM_WEATHER_STATION"),template:T.getTempWeatherStationOx,editable:!0,editFieldName:"configuration",editTemplate:function(e,t){var i=e.configuration,a="";if(i&&i.locationType){var n="checked"==(a="Outdoor"==i.locationType?"checked":"");t.checked=n}return"<div style='line-height:38px;'><input type='checkbox' id='weather-station' class='k-checkbox' data-bind='checked:checked, events:{click:clickChecked}'"+a+"/><label style='padding-left:20px;' class='k-checkbox-label' for='weather-station'>&nbsp;</label></div>"},editViewModel:{init:function(){},fields:{locationType:"Indoor"},checked:!1,clickChecked:function(e){var t=$(e.target).prop("checked");v.enableSaveBtn();var i=1==t?"Outdoor":"Indoor";this.fields.set("locationType",i)}}},parentId:{type:"text",name:"Parent ID",template:function(e){var t="-";return e.parentId&&(t=e.parentId),t}},macAddress:{type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:T.getMacAddress},ipAddress:{type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_IP_ADDRESS"),template:T.getIpAddress},brightness:{type:"text",name:o.prop("FACILITY_DEVICE_LIGHT_BRIGHTNESS"),template:T.getDimmingLevel},colorTemperature:{type:"text",name:o.prop("FACILITY_DEVICE_LIGHT_COLOR_TEMPERATURE"),template:function(){return"-"}},temperatureUnit:{type:"text",name:o.prop("FACILITY_DEVICE_TEMP_HUM_TEMPERATURE_UNIT"),template:function(e){var t,i="-",a=e.temperatures;return a&&a[0]&&(t=(a=a[0]).unit,i=(t=b.CHAR[t])||"-"),i}},sensorTemperature:{type:"text",name:o.prop("FACILITY_DEVICE_TEMP_HUMI_CURRENT_TEMPERATURE"),template:T.getTempHumiTemperature},humidity:{type:"text",name:o.prop("FACILITY_DEVICE_TEMP_HUM_CURRENT_HUMIDITY"),template:T.getTempHumiHumidity},dataStatus:{type:"text",name:o.prop("FACILITY_DEVICE_CCTV_DATA_STATUS"),template:T.getCCTVDataStatus},bleMacAddress:{type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:T.getBleMacAddress},signalLevel:{type:"text",name:o.prop("FACILITY_DEVICE_BEACON_SIGNAL_LEVEL_RSSI"),template:T.getBleSignalLevel},batteryLevel:{type:"text",name:o.prop("FACILITY_DEVICE_BEACON_BATTERY_LEVEL"),template:function(e){var t=T.getBleBatteryLevel(e);return"999"!=t&&999!=t||(t="-"),"-"!=t&&(t+=" %"),t}},lastEventTime:{type:"text",name:o.prop("FACILITY_DEVICE_TEMP_HUM_LAST_EVENT_TIME"),template:function(e){var t="-",i=e.information;return i&&i.updatedTime&&(t=p(i.updatedTime).format("LLL")),t}},presence:{type:"text",name:o.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE"),template:T.getMotionPresence},currentConsumption:{type:"text",name:o.prop("FACILITY_DEVICE_CURRENT_CONSUMPTION"),template:T.getMeterCurrentConsumptionUnit},totalConsumption:{type:"text",name:o.prop("FACILITY_DEVICE_TOTAL_CONSUMPTION"),template:function(e){var t,i,a,n,o="";if(i=e.meters)for(a=i.length,t=0;t<a;t++)null!=(n=i[t].reading)&&(o+=n,t!=a-1&&(o+=", "));return o=o||"-"}},manufacturer:{type:"text",name:o.prop("FACILITY_DEVICE_MANUFACTURER"),template:function(e){var t="-",i=e.information;return i&&i.manufacturer&&(t=i.manufacturer),t}},information:{type:"text",name:o.prop("FACILITY_DEVICE_MODEL"),template:function(e){var t="-",i=e.information;if(i&&i.modelName){t=i.modelName;var a=o.prop("FACILITY_DEVICE_STATUS_POPUP_MODEL_"+t.toUpperCase());t=a||t}return t}},firmwareVersion:{type:"text",name:o.prop("FACILITY_DEVICE_FIRMWARE_VERSION"),template:T.getFirmwareVersion},hardwareVersion:{type:"text",name:o.prop("FACILITY_DEVICE_HARDWARE_VERSION"),template:T.getHardwareVersion},softwareVersion:{type:"text",name:o.prop("FACILITY_DEVICE_SOFTWARE_VERSION"),template:T.getSoftwareVersion},apiVersion:{type:"text",name:o.prop("FACILITY_DEVICE_API_VERSION"),template:T.getApiVersion},powerAvailableSource:{type:"text",name:o.prop("FACILITY_DEVICE_POWER_AVAILABLE_SOURCE"),template:T.getPowerAvailableSource},powerCurrentSource:{type:"text",name:o.prop("FACILITY_DEVICE_POWER_CURRENT_SOURCE"),template:T.getPowerCurrentSource},schedule:{type:"text",name:o.prop("COMMON_MENU_FACILITY_SCHEDULE"),template:T.getHasSchedule},rule:{type:"text",name:o.prop("COMMON_MENU_FACILITY_RULE"),template:T.getHasRule},description:{type:"text",name:o.prop("COMMON_DESCRIPTION"),editCss:{width:"100%"},editable:!0,hasInputRemoveBtn:!0,validator:!0},wifiStatus:{groupName:"wifiInterface",name:o.prop("FACILITY_DEVICE_NETWORK_WIFI_STATUS"),template:T.getCCTVWifiStatus},wifiType:{groupName:"wifiInterface",name:o.prop("FACILITY_DEVICE_NETWORK_WIFI_FREQUENCY_BAND"),template:T.getCCTVWifiType},wifiChannel:{groupName:"wifiInterface",name:o.prop("FACILITY_DEVICE_NETWORK_WIFI_CHANNEL"),template:T.getWifiChannel},wifiRssi:{groupName:"wifiInterface",name:o.prop("FACILITY_DEVICE_NETWORK_RSSI"),template:T.getWifiRssi},cctvWifiMacAddress:{groupName:"wifiInterface",name:o.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:T.getWifiMacAddress},cctvWifiIPAddress:{groupName:"wifiInterface",name:o.prop("FACILITY_DEVICE_NETWORK_IP_ADDRESS"),template:T.getWifiIpAddress},cctvWifiTxPower:{groupName:"wifiInterfaceDetail",name:o.prop("FACILITY_DEVICE_NETWORK_TX_POWER"),template:T.getCCTVWifiTxPower},cctvWifiChannelUtilization:{groupName:"wifiInterfaceDetail",name:o.prop("FACILITY_DEVICE_NETWORK_CHANNEL_UTILIZATION"),template:function(){return""}},cctvWifiChannelUtilizationTotal:{groupName:"wifiInterfaceDetail",name:"<div style='margin-left:10px;'>"+o.prop("COMMON_TOTAL")+"</div>",template:function(e){var t=T.getCCTVWifiTotal(e);return"-"!=t&&(t+=" %"),t}},cctvWifiChannelUtilizationNonWifi:{groupName:"wifiInterfaceDetail",name:"<div style='margin-left:10px;'>"+o.prop("FACILITY_DEVICE_NETWORK_NONE_WIFI")+"</div>",template:function(e){var t=T.getCCTVWifiNoneWifi(e);return"-"!=t&&(t+=" %"),t}},cctvWifiInterferer:{groupName:"wifiInterfaceDetail",type:"grid",name:o.prop("FACILITY_DEVICE_NETWORK_WIFI_INTERFERER"),valueFieldDisplayType:"row",gridDataSource:T.getCCTVWifiInterfererDataSource,gridOptions:$.extend({},l,H)},writable:{groupName:"advertisement",type:"text",name:o.prop("FACILITY_DEVICE_BEACON_CONFIGURATION_TYPE"),template:T.getBleWritable},advertisingName:{groupName:"advertisement",type:"text",name:o.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME"),template:T.getBleAdvertisingName,validator:{type:"name"},editCss:{width:"100%"},customFieldKey:function(e){var t,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.advertisingName"}},advertisingInterval:{groupName:"advertisement",type:"text",name:o.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_INTERVAL"),template:function(e){var t=T.getBleAdvertisingInterval(e);return"-"!=t&&(t+=" msec"),t},editable:function(e){return"-"!=T.getBleObject(e,"writable")},customFieldKey:function(e){var t,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.advertisingInterval"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="100" data-max="10240" data-spinners="false" data-bind="value : fields.advertisingInterval, events:{change:change}" /></span><span style="margin-left:10px;">(100 ~ 10,240)</div>'},editViewModel:{fields:{advertisingInterval:100},init:function(){this.fields.advertisingInterval||(this.fields.advertisingInterval=100)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getBleObject(e,"advertisingInterval");return"-"==t&&(t=100),t},isEditAll:!0},uuid:{groupName:"advertisement",type:"text",name:"UUID",template:T.getBleUUID,editable:function(e){return"-"!=T.getBleObject(e,"writable")},validator:{type:"uuid_min"},editCss:{width:"100%"},customFieldKey:function(e){var t,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.uuid"},getEditableData:function(e){var t=T.getBleObject(e,"uuid");return"-"==t&&(t=""),t},isEditAll:!0},major:{groupName:"advertisement",type:"text",name:"Major",template:T.getBleMajor,editable:function(e){return"-"!=T.getBleObject(e,"writable")},customFieldKey:function(e){var t,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.major"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.major, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65,535)</div>'},editViewModel:{fields:{major:0},init:function(){this.fields.major||(this.fields.major=0)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getBleObject(e,"major");return"-"==t&&(t=0),t},isEditAll:!0},minor:{groupName:"advertisement",type:"text",name:"Minor",template:T.getBleMinor,editable:function(e){return"-"!=T.getBleObject(e,"writable")},customFieldKey:function(e){var t,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.minor"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.minor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65,535)</div>'},editViewModel:{fields:{minor:0},init:function(){this.fields.minor||(this.fields.minor=0)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getBleObject(e,"minor");return"-"==t&&(t=0),t},isEditAll:!0},txPower:{groupName:"advertisement",type:"text",name:"Tx Power",template:function(e){var t=T.getBleTxPower(e);return"999"!=t&&999!=t||(t="-"),"-"!=t&&(t+=" dBm"),t},editable:function(e){return"-"!=T.getBleObject(e,"writable")},customFieldKey:function(e){var t=0,i=e.networks;if(i&&i[0]){var a,n=i.length;for(a=0;a<n;a++)if("BLE"==i[a].type){t=a;break}}return"networks["+t+"].ble.txPower"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="-100" data-max="20" data-spinners="false" data-bind="value : fields.txPower, events:{change:change}" /></span><span style="margin-left:10px;">(-100 ~ 20)</div>'},editViewModel:{fields:{txPower:null},init:function(){this.fields.txPower||(this.fields.txPower=0)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getBleObject(e,"txPower");return"-"==t&&(t=0),t}},calibratedTxPower:{groupName:"advertisement",type:"text",name:"1m RSSI",template:function(e){var t=T.getBle1mRssi(e);return"-"!=t&&(t+=" dBm"),t}},gatewayZigbeeId:{groupName:"zigbeeInterface",type:"text",name:"ZigBee ID",template:function(e){var t="-",i=T.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=(t=i.zigbee.networkAddress)||"-"),t}},gatewayZigbeePower:{groupName:"zigbeeInterface",name:o.prop("FACILITY_DEVICE_NETWORK_POWER"),template:function(e){var t="-",i=T.getNetworkInterface(e,"Zigbee");return i&&(t=!0===i.enabled||"true"===i.enabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"Zigbee")+"].enabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="zigbee-power" id="zigbee-power-on" checked="" value="true" data-bind="checked:fields.gatewayZigbeePower, click:clickRadio"><label class="k-radio-label" for="zigbee-power-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="zigbee-power" id="zigbee-power-off" checked="" value="false" data-bind="checked:fields.gatewayZigbeePower, click:clickRadio"><label class="k-radio-label" for="zigbee-power-off">Off</label></div>'},editViewModel:{fields:{gatewayZigbeePower:null},init:function(){null===this.fields.gatewayZigbeePower&&(this.fields.gatewayZigbeePower=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=T.getNetworkInterface(e,"Zigbee");return i&&void 0!==i.enabled&&(t=i.enabled),t},isEditAll:!0},gatewayZigbeeFirmwareVersion:{groupName:"zigbeeInterface",type:"text",name:o.prop("FACILITY_DEVICE_FIRMWARE_VERSION"),template:T.getZigbeeFirmwareVersion},gatewayZigbeeChannel:{groupName:"zigbeeInterface",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_WIFI_CHANNEL"),template:function(e){var t="-",i=T.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=(t=i.zigbee.channel)||"-"),t},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"Zigbee")+"].zigbee.channel"},editTemplate:function(){return'<div><input data-role="dropdownlist" data-bind="source : channelList, value : fields.gatewayZigbeeChannel, events:{change:change}" /></div>'},editViewModel:{fields:{gatewayZigbeeChannel:null},channelList:["26","25","24","23","22","21","20","19","18","17","16","15","14","13","12","11"],init:function(){this.fields.gatewayZigbeeChannel||(this.fields.gatewayZigbeeChannel="26")},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t="26",i=T.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=i.zigbee.channel),t},isEditAll:!0},gatewayZigbeeTxPower:{groupName:"zigbeeInterface",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_TX_POWER"),template:function(e){var t="-",i=T.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=(t=i.zigbee.txPower)?t+" dBm":"-"),t},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"Zigbee")+"].zigbee.txPower"},editTemplate:function(){return'<div><input data-role="dropdownlist" data-bind="source : txPowerList, value : fields.gatewayZigbeeTxPower, events:{change:change}" /></div>'},editViewModel:{fields:{gatewayZigbeeTxPower:null},txPowerList:["9","-3","-15","-26"],init:function(){this.fields.gatewayZigbeeTxPower||(this.fields.gatewayZigbeeTxPower="9")},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t="9",i=T.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=i.zigbee.txPower),t},isEditAll:!0},gatewayZigbeePairingMode:{groupName:"zigbeeInterface",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_PAIRING_MODE"),template:function(e){var t="-",i=T.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=i.zigbee.pairing?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"Zigbee")+"].zigbee.pairing"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="zigbee-pairing" id="zigbee-pairing-on" value="true" data-bind="checked:fields.gatewayZigbeePairingMode, click:clickRadio"><label class="k-radio-label" for="zigbee-pairing-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="zigbee-pairing" id="zigbee-pairing-off" value="false" data-bind="checked:fields.gatewayZigbeePairingMode, click:clickRadio"><label class="k-radio-label" for="zigbee-pairing-off">Off</label></div>'},editViewModel:{fields:{gatewayZigbeePairingMode:null},init:function(){null===this.fields.gatewayZigbeePairingMode&&(this.fields.gatewayZigbeePairingMode=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=T.getNetworkInterface(e,"Zigbee");return i&&i.zigbee&&(t=i.zigbee.pairing),t},isEditAll:!0},gatewayBlePower:{groupName:"bleInterface",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_POWER"),template:function(e){var t="-",i=T.getNetworkInterface(e,"BLE","Scanner");return i&&(t=i.enabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].enabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power" id="ble-power-on" checked="" value="true" data-bind="checked:fields.gatewayBlePower, click:clickRadio"><label class="k-radio-label" for="ble-power-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power" id="ble-power-off" checked="" value="false" data-bind="checked:fields.gatewayBlePower, click:clickRadio"><label class="k-radio-label" for="ble-power-off">Off</label></div>'},editViewModel:{fields:{gatewayBlePower:null},init:function(){null===this.fields.gatewayBlePower&&(this.fields.gatewayBlePower=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=T.getNetworkInterface(e,"BLE","Scanner");return"undefined"!==i.enabled&&(t=i.enabled),t},isEditAll:!0},gatewayBleFirmwareVersion:{groupName:"bleInterface",type:"text",name:o.prop("FACILITY_DEVICE_FIRMWARE_VERSION"),template:T.getBleFirmwareVersion},gatewayBleAppVersion:{groupName:"bleInterface",type:"text",name:o.prop("FACILITY_DEVICE_APP_VERSION"),template:T.getBleAppVersion},gatewayBleScanReport:{groupName:"bleInterface",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_SCAN_REPORT"),template:function(e){var t="-",i=T.getNetworkInterface(e,"BLE","Scanner");return i&&i.ble&&(t=i.ble.scanlistReportEnabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].ble.scanlistReportEnabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-scan-report" id="ble-scan-report-on" checked="" value="true" data-bind="checked:fields.gatewayBleScanReport, click:clickRadio"><label class="k-radio-label" for="ble-scan-report-on" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-scan-report" id="ble-scan-report-off" checked="" value="false" data-bind="checked:fields.gatewayBleScanReport, click:clickRadio"><label class="k-radio-label" for="ble-scan-report-off">Off</label></div>'},editViewModel:{fields:{gatewayBleScanReport:null},init:function(){null===this.fields.gatewayBleScanReport&&(this.fields.gatewayBleScanReport=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=T.getNetworkInterface(e,"BLE","Scanner");return i&&i.ble&&(t=i.ble.scanlistReportEnabled),t},isEditAll:!0},gatewayBleScanReportInterval:{groupName:"bleInterface",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_SCAN_REPORT_INTERVAL"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Scanner"),i=T.getBleObjectFromNetwork(t,"scanlistReportInterval");return"-"!=i&&(i+=" msec"),i},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].ble.scanlistReportInterval"},editTemplate:function(){return'<div><input style="width: calc( 100% - 150px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="3000" data-max="120000" data-spinners="false" data-bind="value : fields.gatewayBleScanReportInterval, events:{change:change}" /></span><span style="margin-left:10px;">(3,000 ~ 120,000)</div>'},editViewModel:{fields:{gatewayBleScanReportInterval:null},init:function(){null===this.fields.gatewayBleScanReportInterval&&(this.fields.gatewayBleScanReportInterval=100)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Scanner"),i=T.getBleObjectFromNetwork(t,"scanlistReportInterval");return"-"==i&&(i=100),i},isEditAll:!0},gatewayBleScanWindow:{groupName:"bleInterface",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_SCAN_WINDOW"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Scanner"),i=T.getBleObjectFromNetwork(t,"scanWindow");return"-"!=i&&(i+=" msec"),i},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].ble.scanWindow"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="10240" data-spinners="false" data-bind="value : fields.gatewayBleScanWindow, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 10,240)</div>'},editViewModel:{fields:{gatewayBleScanWindow:null},init:function(){null===this.fields.gatewayBleScanWindow&&(this.fields.gatewayBleScanWindow=0)},change:function(e){var t,i=e.sender.value();if(void 0!==i){t=i;var a=v.editFields.gatewayBleScanInterval,n=a.find(".device-point-numeric[data-role='numerictextbox']");n.attr("data-min",t),a.find(".scan-interval-min").text(t);var o=n.data("kendoNumericTextBox"),s=o.value();o.min(t),s<t&&(o.value(t),a.viewModel.fields.set("gatewayBleScanInterval",t))}v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Scanner"),i=T.getBleObjectFromNetwork(t,"scanWindow");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleScanInterval:{groupName:"bleInterface",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_SCAN_INTERVAL"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Scanner"),i=T.getBleObjectFromNetwork(t,"scanInterval");return"-"!=i&&(i+=" msec"),i},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].ble.scanInterval"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="10240" data-spinners="false" data-bind="value : fields.gatewayBleScanInterval, events:{change:change}" /></span><span style="margin-left:10px;">(<span class="scan-interval-min">0</span> ~ 10,240)</div>'},editViewModel:{fields:{gatewayBleScanInterval:null},init:function(){var e=v.getSelectedData(),t=T.getNetworkInterface(e,"BLE","Scanner"),i=0,a=T.getBleObjectFromNetwork(t,"scanWindow");if("-"!=a){i<a&&(i=a);var n=v.editFields.gatewayBleScanInterval;n.find(".device-point-numeric").attr("data-min",i),n.find(".scan-interval-min").text(i)}null===this.fields.gatewayBleScanInterval&&(this.fields.gatewayBleScanInterval=0)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Scanner"),i=T.getBleObjectFromNetwork(t,"scanInterval");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleScanType:{groupName:"bleInterface",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_SCAN_TYPE"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Scanner");return T.getBleObjectFromNetwork(t,"scanType")},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Scanner")+"].ble.scanType"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-scan-type" id="ble-scan-type-on" checked="" value="Passive" data-bind="checked:fields.gatewayBleScanType, click:clickRadio"><label class="k-radio-label" for="ble-scan-type-on" style="margin-right:51px;">Passive</label><input type="radio" class="k-radio" name="ble-scan-type" id="ble-scan-type-off" checked="" value="Active" data-bind="checked:fields.gatewayBleScanType, click:clickRadio"><label class="k-radio-label" for="ble-scan-type-off">Active</label></div>'},editViewModel:{fields:{gatewayBleScanType:null},init:function(){null===this.fields.gatewayBleScanType&&(this.fields.gatewayBleScanType="Passive")},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Scanner"),i=T.getBleObjectFromNetwork(t,"scanType");return"-"==i&&(i="Passive"),i},isEditAll:!0},gatewayBleAdvertisementInterval:{groupName:"bleSetup",type:"text",name:o.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_INTERVAL"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser"),i=T.getBleObjectFromNetwork(t,"advertisingInterval");return"-"!=i&&(i+=" msec"),i},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser")+"].ble.advertisingInterval"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="100" data-max="5000" data-spinners="false" data-bind="value : fields.gatewayBleAdvertisementInterval, events:{change:change}" /></span><span style="margin-left:10px;">(100 ~ 5,000)</div>'},editViewModel:{fields:{gatewayBleAdvertisementInterval:null},init:function(){null===this.fields.gatewayBleAdvertisementInterval&&(this.fields.gatewayBleAdvertisementInterval=100)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser"),i=T.getBleObjectFromNetwork(t,"advertisingInterval");return"-"==i&&(i=100),i},isEditAll:!0},gatewayBleTxPower:{groupName:"bleSetup",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_TX_POWER"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser"),i=T.getBleObjectFromNetwork(t,"txPower");return"-"!=i&&(i+=" dBm"),i},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser")+"].ble.txPower"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="-20" data-max="8" data-spinners="false" data-bind="value : fields.gatewayBleTxPower, events:{change:change}" /></span><span style="margin-left:10px;">(-20 ~ 8)</div>'},editViewModel:{fields:{gatewayBleTxPower:null},init:function(){this.fields.gatewayBleTxPower||(this.fields.gatewayBleTxPower=0)},change:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser"),i=T.getBleObjectFromNetwork(t,"txPower");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleCalibration:{groupName:"bleSetup",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_CALIBRATION"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser"),i=T.getBleObjectFromNetwork(t,"txPowerAttenuation");return"-"!=i&&(i+=" dBm"),i},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser")+"].ble.txPowerAttenuation"},editTemplate:function(){return'<div><input  style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="-100" data-max="0" data-spinners="false" data-bind="value : fields.gatewayBleCalibration, events:{change:change}" /></span><span style="margin-left:10px;">(-100 ~ 0)</div>'},editViewModel:{fields:{gatewayBleCalibration:null},init:function(){null===this.fields.gatewayBleCalibration&&(this.fields.gatewayBleCalibration=-100)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser"),i=T.getBleObjectFromNetwork(t,"txPowerAttenuation");return"-"==i&&(i=-100),i},isEditAll:!0},gatewayBleMacAddress:{groupName:"bleSetup",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_MAC_ADDRESS"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser");return T.getBleObjectFromNetwork(t,"macAddress")}},gatewayBleFirstPower:{groupName:"bleFirst",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_POWER"),template:function(e){var t="-",i=T.getNetworkInterface(e,"BLE","Advertiser",0);return i&&(t=i.enabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",0)+"].enabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power-1" id="ble-power-on-1" checked="" value="true" data-bind="checked:fields.gatewayBleFirstPower, click:clickRadio"><label class="k-radio-label" for="ble-power-on-1" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power-1" id="ble-power-off-1" checked="" value="false" data-bind="checked:fields.gatewayBleFirstPower, click:clickRadio"><label class="k-radio-label" for="ble-power-off-1">Off</label></div>'},editViewModel:{fields:{gatewayBleFirstPower:null},init:function(){null===this.fields.gatewayBleFirstPower&&(this.fields.gatewayBleFirstPower=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=T.getNetworkInterface(e,"BLE","Advertiser",0);return i&&void 0!==i.enabled&&(t=i.enabled),t},isEditAll:!0},gatewayBleFirstAdvertiseName:{groupName:"bleFirst",type:"text",name:o.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",0);return T.getBleObjectFromNetwork(t,"advertisingName")},editable:!0,validator:{type:"name_16"},editCss:{width:"100%"},customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",0)+"].ble.advertisingName"},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",0),i=T.getBleObjectFromNetwork(t,"advertisingName");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleFirstUUID:{groupName:"bleFirst",type:"text",name:"UUID",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",0);return T.getBleObjectFromNetwork(t,"uuid")},validator:{type:"uuid"},editable:!0,editCss:{width:"100%"},customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",0)+"].ble.uuid"},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",0),i=T.getBleObjectFromNetwork(t,"uuid");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleFirstMajor:{groupName:"bleFirst",type:"text",name:"Major",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",0);return T.getBleObjectFromNetwork(t,"major")},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",0)+"].ble.major"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleFirstMajor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleFirstMajor:null},init:function(){null===this.fields.gatewayBleFirstMajor&&(this.fields.gatewayBleFirstMajor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",0),i=T.getBleObjectFromNetwork(t,"major");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleFirstMinor:{groupName:"bleFirst",type:"text",name:"Minor",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",0);return T.getBleObjectFromNetwork(t,"minor")},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",0)+"].ble.minor"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleFirstMinor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleFirstMinor:null},init:function(){null===this.fields.gatewayBleFirstMinor&&(this.fields.gatewayBleFirstMinor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",0),i=T.getBleObjectFromNetwork(t,"minor");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleFirstCalibratedTxPower:{groupName:"bleFirst",type:"text",name:"1m RSSI",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",0),i=T.getBleObjectFromNetwork(t,"calibratedTxPower");return"-"!=i&&(i+=" dBm"),i}},gatewayBleSecondPower:{groupName:"bleSecond",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_POWER"),template:function(e){var t="-",i=T.getNetworkInterface(e,"BLE","Advertiser",1);return i&&(t=i.enabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",1)+"].enabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power-2" id="ble-power-on-2" checked="" value="true" data-bind="checked:fields.gatewayBleSecondPower, click:clickRadio"><label class="k-radio-label" for="ble-power-on-2" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power-2" id="ble-power-off-2" checked="" value="false" data-bind="checked:fields.gatewayBleSecondPower, click:clickRadio"><label class="k-radio-label" for="ble-power-off-2">Off</label></div>'},editViewModel:{fields:{gatewayBleSecondPower:null},init:function(){null===this.fields.gatewayBleSecondPower&&(this.fields.gatewayBleSecondPower=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=T.getNetworkInterface(e,"BLE","Advertiser",1);return i&&void 0!==i.enabled&&(t=i.enabled),t},isEditAll:!0},gatewayBleSecondAdvertiseName:{groupName:"bleSecond",type:"text",name:o.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",1);return T.getBleObjectFromNetwork(t,"advertisingName")},editable:!0,validator:{type:"name_16"},editCss:{width:"100%"},customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",1)+"].ble.advertisingName"},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",1),i=T.getBleObjectFromNetwork(t,"advertisingName");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleSecondUUID:{groupName:"bleSecond",type:"text",name:"UUID",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",1);return T.getBleObjectFromNetwork(t,"uuid")},validator:{type:"uuid"},editable:!0,editCss:{width:"100%"},customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",1)+"].ble.uuid"},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",1),i=T.getBleObjectFromNetwork(t,"uuid");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleSecondMajor:{groupName:"bleSecond",type:"text",name:"Major",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",1);return T.getBleObjectFromNetwork(t,"major")},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",1)+"].ble.major"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleSecondMajor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleSecondMajor:null},init:function(){null===this.fields.gatewayBleSecondMajor&&(this.fields.gatewayBleSecondMajor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",1),i=T.getBleObjectFromNetwork(t,"major");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleSecondMinor:{groupName:"bleSecond",type:"text",name:"Minor",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",1);return T.getBleObjectFromNetwork(t,"minor")},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",1)+"].ble.minor"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleSecondMinor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleSecondMinor:null},init:function(){null===this.fields.gatewayBleSecondMinor&&(this.fields.gatewayBleSecondMinor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",1),i=T.getBleObjectFromNetwork(t,"minor");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleSecondCalibratedTxPower:{groupName:"bleSecond",type:"text",name:"1m RSSI",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",1),i=T.getBleObjectFromNetwork(t,"calibratedTxPower");return"-"!=i&&(i+=" dBm"),i}},gatewayBleThirdPower:{groupName:"bleThird",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_POWER"),template:function(e){var t="-",i=T.getNetworkInterface(e,"BLE","Advertiser",2);return i&&(t=i.enabled?"On":"Off"),t},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",2)+"].enabled"},editTemplate:function(){return'<div style="line-height:36px; margin-bottom : 10px;"><input type="radio" class="k-radio" name="ble-power-3" id="ble-power-on-3" checked="" value="true" data-bind="checked:fields.gatewayBleThirdPower, click:clickRadio"><label class="k-radio-label" for="ble-power-on-3" style="margin-right:51px;">On</label><input type="radio" class="k-radio" name="ble-power-3" id="ble-power-off-3" checked="" value="false" data-bind="checked:fields.gatewayBleThirdPower, click:clickRadio"><label class="k-radio-label" for="ble-power-off-3">Off</label></div>'},editViewModel:{fields:{gatewayBleThirdPower:null},init:function(){null===this.fields.gatewayBleThirdPower&&(this.fields.gatewayBleThirdPower=!1)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=!1,i=T.getNetworkInterface(e,"BLE","Advertiser",2);return i&&void 0!==i.enabled&&(t=i.enabled),t},isEditAll:!0},gatewayBleThirdAdvertiseName:{groupName:"bleThird",type:"text",name:o.prop("FACILITY_DEVICE_BEACON_ADVERTISEMENT_NAME"),template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",2);return T.getBleObjectFromNetwork(t,"advertisingName")},editable:!0,validator:{type:"name_16"},editCss:{width:"100%"},customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",2)+"].ble.advertisingName"},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",2),i=T.getBleObjectFromNetwork(t,"advertisingName");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleThirdUUID:{groupName:"bleThird",type:"text",name:"UUID",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",2);return T.getBleObjectFromNetwork(t,"uuid")},validator:{type:"uuid"},editable:!0,editCss:{width:"100%"},customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",2)+"].ble.uuid"},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",2),i=T.getBleObjectFromNetwork(t,"uuid");return"-"==i&&(i=""),i},isEditAll:!0},gatewayBleThirdMajor:{groupName:"bleThird",type:"text",name:"Major",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",2);return T.getBleObjectFromNetwork(t,"major")},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",2)+"].ble.major"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleThirdMajor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleThirdMajor:null},init:function(){null===this.fields.gatewayBleThirdMajor&&(this.fields.gatewayBleThirdMajor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",2),i=T.getBleObjectFromNetwork(t,"major");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleThirdMinor:{groupName:"bleThird",type:"text",name:"Minor",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",2);return T.getBleObjectFromNetwork(t,"minor")},editable:!0,customFieldKey:function(e){return"networks["+T.getNetworkInterfaceIndex(e,"BLE","Advertiser",2)+"].ble.minor"},editTemplate:function(){return'<div><input style="width: calc( 100% - 120px );" class="device-point-numeric" data-decimals="1" data-format="n0" data-role="numerictextbox" data-min="0" data-max="65535" data-spinners="false" data-bind="value : fields.gatewayBleThirdMinor, events:{change:change}" /></span><span style="margin-left:10px;">(0 ~ 65535)</div>'},editViewModel:{fields:{gatewayBleThirdMinor:null},init:function(){null===this.fields.gatewayBleThirdMinor&&(this.fields.gatewayBleThirdMinor=0)},clickRadio:function(e){v.enableSaveBtn()}},getEditableData:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",2),i=T.getBleObjectFromNetwork(t,"minor");return"-"==i&&(i=0),i},isEditAll:!0},gatewayBleThirdCalibratedTxPower:{groupName:"bleThird",type:"text",name:"1m RSSI",template:function(e){var t=T.getNetworkInterface(e,"BLE","Advertiser",2),i=T.getBleObjectFromNetwork(t,"calibratedTxPower");return"-"!=i&&(i+=" dBm"),i}},gatewayWifiFirstStatus:{groupName:"wifiFirst",type:"text",name:o.prop("COMMON_STATUS"),template:function(e){var t="-",i=T.getNetworkInterface(e,"WiFi2.4GHz");return i&&(t=i.enabled?"On":"Off"),t}},gatewayWifiFirstChannel:{groupName:"wifiFirst",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_WIFI_CHANNEL"),template:function(e){var t=T.getNetworkInterface(e,"WiFi2.4GHz");return T.getWifiObjectFromNetwork(t,"channel")}},gatewayWifiFirstTxPower:{groupName:"wifiFirst",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_TX_POWER"),template:function(e){var t="-",i=T.getNetworkInterface(e,"WiFi2.4GHz");return"-"!=(t=T.getWifiObjectFromNetwork(i,"txPower"))&&(t+=" dBm"),t}},gatewayWifiFirstChannelUtilization:{groupName:"wifiFirst",name:o.prop("FACILITY_DEVICE_NETWORK_CHANNEL_UTILIZATION"),template:function(){return""}},gatewayWifiFirstChannelUtilizationTotal:{groupName:"wifiFirst",name:"<div style='margin-left:10px;'>"+o.prop("COMMON_TOTAL")+"</div>",template:function(e){var t,i="-",a=T.getNetworkInterface(e,"WiFi2.4GHz");return a&&a.wifi&&((t=a.wifi.statistics)&&t.channelUtilization&&(i=(i=t.channelUtilization.total)||"-"),"-"!=i&&(i+=" %")),i}},gatewayWifiFirstChannelUtilizationNonWifi:{groupName:"wifiFirst",name:"<div style='margin-left:10px;'>"+o.prop("FACILITY_DEVICE_NETWORK_NONE_WIFI")+"</div>",template:function(e){var t,i="-",a=T.getNetworkInterface(e,"WiFi2.4GHz");return a&&a.wifi&&((t=a.wifi.statistics)&&t.channelUtilization&&(i=(i=t.channelUtilization["non802.11"])||"-"),"-"!=i&&(i+=" %")),i}},gatewayWifiFirstInterferer:{groupName:"wifiFirst",type:"grid",name:o.prop("FACILITY_DEVICE_NETWORK_WIFI_INTERFERER"),valueFieldDisplayType:"row",gridDataSource:function(e){var t,i=[],a=T.getNetworkInterface(e,"WiFi2.4GHz");return a&&a.wifi&&(t=a.wifi.statistics)&&t.interferers&&(i=t.interferers),i},gridOptions:$.extend({},l,H)},gatewayWifiSecondStatus:{groupName:"wifiSecond",type:"text",name:o.prop("COMMON_STATUS"),template:function(e){var t="-",i=T.getNetworkInterface(e,"WiFi5GHz");return i&&(t=i.enabled?"On":"Off"),t}},gatewayWifiSecondChannel:{groupName:"wifiSecond",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_WIFI_CHANNEL"),template:function(e){var t=T.getNetworkInterface(e,"WiFi5GHz");return T.getWifiObjectFromNetwork(t,"channel")}},gatewayWifiSecondTxPower:{groupName:"wifiSecond",type:"text",name:o.prop("FACILITY_DEVICE_NETWORK_TX_POWER"),template:function(e){var t="-",i=T.getNetworkInterface(e,"WiFi5GHz");return"-"!=(t=T.getWifiObjectFromNetwork(i,"txPower"))&&(t+=" dBm"),t}},gatewayWifiSecondChannelUtilization:{groupName:"wifiSecond",name:o.prop("FACILITY_DEVICE_NETWORK_CHANNEL_UTILIZATION"),template:function(){return""}},gatewayWifiSecondChannelUtilizationTotal:{groupName:"wifiSecond",name:"<div style='margin-left:10px;'>"+o.prop("COMMON_TOTAL")+"</div>",template:function(e){var t,i="-",a=T.getNetworkInterface(e,"WiFi5GHz");return a&&a.wifi&&((t=a.wifi.statistics)&&t.channelUtilization&&(i=(i=t.channelUtilization.total)||"-"),"-"!=i&&(i+=" %")),i}},gatewayWifiSecondChannelUtilizationNonWifi:{groupName:"wifiSecond",name:"<div style='margin-left:10px;'>"+o.prop("FACILITY_DEVICE_NETWORK_NONE_WIFI")+"</div>",template:function(e){var t,i="-",a=T.getNetworkInterface(e,"WiFi5GHz");return a&&a.wifi&&((t=a.wifi.statistics)&&t.channelUtilization&&(i=(i=t.channelUtilization["non802.11"])||"-"),"-"!=i&&(i+=" %")),i}},gatewayWifiSecondInterferer:{groupName:"wifiSecond",type:"grid",name:o.prop("FACILITY_DEVICE_NETWORK_WIFI_INTERFERER"),valueFieldDisplayType:"row",gridDataSource:function(e){var t,i=[],a=T.getNetworkInterface(e,"WiFi5GHz");return a&&a.wifi&&(t=a.wifi.statistics)&&t.interferers&&(i=t.interferers),i},gridOptions:$.extend({},l,H)},connectedDevices:{type:I.ui.CommonGroupList,name:o.prop("FACILITY_DEVICE_CONNECTION_DEVICE"),valueFieldDisplayType:"row",editable:T.isEnableEnergyMappingType,widgetOptions:{columns:[{field:"name",template:function(e){return"building_group_value"===e.field?e.value.split("_").slice(2):"floor_group_value"===e.field?e.value.split("_").slice(2):e.name}}],group:[{field:"building_group_value",dir:"asc",aggregates:[{field:"building_group_value",aggregate:"count"}]},{field:"floor_group_value",dir:"asc",aggregates:[{field:"floor_group_value",aggregate:"count"}]}],showEditListHeader:!1,checkedLimit:200},customFieldName:T.getEnergyMappingFieldName,widgetEditGetter:function(e){var t,i,a=e.widget,n=a.getAssignedItems(),o=[],s=n.length;for(i=0;i<s;i++)t=n[i],o.push({dms_devices_id:t.id.split("_edit")[0]});return a.hideEditMode(!0),o},widgetDisplaySetter:function(e){var t=e.sender,i=e.widget,a=T.getMeterConnectedDevices(e.data);t.hasConnectedDevices||(t.hasConnectedDevices={}),a?void 0===t.hasConnectedDevices[e.data.id]&&(t.hasConnectedDevices[e.data.id]=!0):(a=[],void 0===t.hasConnectedDevices[e.data.id]&&(t.hasConnectedDevices[e.data.id]=!1)),_.open(t.element),T.getEnergyMappingOutdoorList(a).done(function(e){i.data(e),i.hideEditMode(!0)}).fail(function(e){var t=b.parseFailResponse(e);se.message(t),se.open()}).always(function(){_.close()})},widgetEditSetter:function(e){var i=e.sender,a=e.widget,t=T.getMeterConnectedDevices(e.data);t=t||[],_.open(i.element),T.getEnergyMappingOutdoorList(t).done(function(e){for(var t=0;t<e.length;t++)e[t].id+="_edit";a.data(e),a.hideEditMode(!1),a.unbind("change"),a.bind("change",function(){i.enableSaveBtn()})}).fail(function(e){var t=b.parseFailResponse(e);se.message(t),se.open()}).always(function(){_.close()})}}}}},Z={All:[],"AirConditioner.Indoor":["type","id","name","representativeStatus","modes","setTemperature","currentTemperature","remoteControl","locations","groups","information","firmwareVersion","description"],AirConditionerOutdoor:["type","id","name","representativeStatus","modes","outdoorTemperature","locations","groups","information","firmwareVersion","description"],ControlPoint:["type","tagName","id","name","representativeStatus","pointValue","pointMode","signalLogicStatus","signalReverse","inputRange","scaleType","scale","bias","maxValue","minValue","ioDescription","locations","groups","description"],Meter:["type","id","name","meterType","pointMeterType","consumptionCategory","sacConnectionType","representativeStatus","locations","groups","currentConsumption","manufacturer","information","firmwareVersion","description","connectedDevices"],"Sensor.Temperature_Humidity":["type","weatherStation","id","name","representativeStatus","locations","groups","temperatureUnit","sensorTemperature","humidity","lastEventTime","manufacturer","information","firmwareVersion","description"],Light:["type","id","name","representativeStatus","locations","groups","brightness","lastEventTime","manufacturer","information","firmwareVersion","description"],SmartPlug:["type","id","name","representativeStatus","locations","groups","lastEventTime","manufacturer","information","firmwareVersion","description"],"Sensor.Motion":["type","id","name","representativeStatus","locations","groups","lastEventTime","presence","manufacturer","information","firmwareVersion","description"],Gateway:["type","id","name","representativeStatus","locations","groups","macAddress","ipAddress","lastEventTime","manufacturer","information","firmwareVersion","hardwareVersion","softwareVersion","apiVersion","powerAvailableSource","powerCurrentSource","schedule","rule","description","gatewayZigbeeId","gatewayZigbeePower","gatewayZigbeeFirmwareVersion","gatewayZigbeeChannel","gatewayZigbeeTxPower","gatewayZigbeePairingMode","gatewayBlePower","gatewayBleFirmwareVersion","gatewayBleAppVersion","gatewayBleScanReport","gatewayBleScanReportInterval","gatewayBleScanWindow","gatewayBleScanInterval","gatewayBleScanType","gatewayBleAdvertisementInterval","gatewayBleTxPower","gatewayBleCalibration","gatewayBleMacAddress","gatewayBleFirstPower","gatewayBleFirstAdvertiseName","gatewayBleFirstUUID","gatewayBleFirstMajor","gatewayBleFirstMinor","gatewayBleFirstCalibratedTxPower","gatewayBleSecondPower","gatewayBleSecondAdvertiseName","gatewayBleSecondUUID","gatewayBleSecondMajor","gatewayBleSecondMinor","gatewayBleSecondCalibratedTxPower","gatewayBleThirdPower","gatewayBleThirdAdvertiseName","gatewayBleThirdUUID","gatewayBleThirdMajor","gatewayBleThirdMinor","gatewayBleThirdCalibratedTxPower","gatewayWifiFirstStatus","gatewayWifiFirstChannel","gatewayWifiFirstTxPower","gatewayWifiFirstChannelUtilization","gatewayWifiFirstChannelUtilizationTotal","gatewayWifiFirstChannelUtilizationNonWifi","gatewayWifiFirstInterferer","gatewayWifiSecondStatus","gatewayWifiSecondChannel","gatewayWifiSecondTxPower","gatewayWifiSecondChannelUtilization","gatewayWifiSecondChannelUtilizationTotal","gatewayWifiSecondChannelUtilizationNonWifi","gatewayWifiSecondInterferer"],Beacon:["type","id","name","representativeStatus","configuration","locations","currentLocations","groups","parentId","lastEventTime","bleMacAddress","signalLevel","batteryLevel","schedule","rule","description","writable","advertisingName","advertisingInterval","uuid","major","minor","txPower","calibratedTxPower"],CCTV:["type","id","name","representativeStatus","locations","groups","parentId","macAddress","ipAddress","lastEventTime","dataStatus","schedule","rule","description","wifiStatus","wifiType","wifiChannel","wifiRssi","cctvWifiMacAddress","cctvWifiIPAddress","cctvWifiTxPower","cctvWifiChannelUtilization","cctvWifiChannelUtilizationTotal","cctvWifiChannelUtilizationNonWifi","cctvWifiInterferer"]},K=["advertisingName","advertisingInterval","uuid","major","minor","txPower"];function X(e,t){var i,a=K.length,n=!1;for(i=0;i<a;i++)if(void 0!==t[K[i]]){n=!0;break}if(console.error(t),n){var o,s={ble:{}},r=e.networks;if(r&&r[0])for(a=r.length,i=0;i<a;i++)if("BLE"==r[i].type){for(o in s.id=r[i].id,t)-1!=K.indexOf(o)&&(s.ble[o]=t[o],r[i].ble.set(o,t[o]),delete t[o]);break}t.networks?t.networks=s:(t.networks=[],t.networks.push(s))}}var q={zigbee:["gatewayZigbeePower","gatewayZigbeeChannel","gatewayZigbeeTxPower","gatewayZigbeePairingMode"],ble:["gatewayBlePower","gatewayBleScanReport","gatewayBleScanReportInterval","gatewayBleScanWindow","gatewayBleScanInterval","gatewayBleScanType"],bleFirst:["gatewayBleAdvertisementInterval","gatewayBleTxPower","gatewayBleCalibration","gatewayBleFirstPower","gatewayBleFirstAdvertiseName","gatewayBleFirstUUID","gatewayBleFirstMajor","gatewayBleFirstMinor"],bleSecond:["gatewayBleAdvertisementInterval","gatewayBleTxPower","gatewayBleCalibration","gatewayBleSecondPower","gatewayBleSecondAdvertiseName","gatewayBleSecondUUID","gatewayBleSecondMajor","gatewayBleSecondMinor"],bleThird:["gatewayBleAdvertisementInterval","gatewayBleTxPower","gatewayBleCalibration","gatewayBleThirdPower","gatewayBleThirdAdvertiseName","gatewayBleThirdUUID","gatewayBleThirdMajor","gatewayBleThirdMinor"]},Q={gatewayZigbeePower:"enabled",gatewayZigbeeChannel:"channel",gatewayZigbeeTxPower:"txPower",gatewayZigbeePairingMode:"pairing",gatewayBlePower:"enabled",gatewayBleScanReport:"scanlistReportEnabled",gatewayBleScanReportInterval:"scanlistReportInterval",gatewayBleScanWindow:"scanWindow",gatewayBleScanInterval:"scanInterval",gatewayBleScanType:"scanType",gatewayBleAdvertisementInterval:"advertisingInterval",gatewayBleTxPower:"txPower",gatewayBleCalibration:"txPowerAttenuation",gatewayBleFirstPower:"enabled",gatewayBleSecondPower:"enabled",gatewayBleThirdPower:"enabled",gatewayBleFirstAdvertiseName:"advertisingName",gatewayBleSecondAdvertiseName:"advertisingName",gatewayBleThirdAdvertiseName:"advertisingName",gatewayBleFirstUUID:"uuid",gatewayBleSecondUUID:"uuid",gatewayBleThirdUUID:"uuid",gatewayBleFirstMajor:"major",gatewayBleSecondMajor:"major",gatewayBleThirdMajor:"major",gatewayBleFirstMinor:"minor",gatewayBleSecondMinor:"minor",gatewayBleThirdMinor:"minor"};function J(e,t){var i,a,n,o=K.length,s=!1;for(a in q){for(o=(i=q[a]).length,n=0;n<o;n++)if(void 0!==t[i[n]]){s=!0;break}if(s)break}if(s){var r,l,d,c,p,u={},m=[],g=[];for(a in q)for(r in i=q[a],t)-1!=i.indexOf(r)&&(u[a]||(u[a]={}),"zigbee"==a?((d=T.getNetworkInterface(e,"Zigbee")).zigbee||(d.zigbee={}),p=d.zigbee,u[a].zigbee||(u[a].zigbee={}),c=u[a].zigbee):"ble"==a?((d=T.getNetworkInterface(e,"BLE","Scanner")).ble||(d.ble={}),p=d.ble,u[a].ble||(u[a].ble={}),c=u[a].ble):"bleFirst"==a?((d=T.getNetworkInterface(e,"BLE","Advertiser",0)).ble||(d.ble={}),p=d.ble,u[a].ble||(u[a].ble={}),c=u[a].ble):"bleSecond"==a?(c=d=T.getNetworkInterface(e,"BLE","Advertiser",1),d.ble||(d.ble={}),p=d.ble,u[a].ble||(u[a].ble={}),c=u[a].ble):"bleThird"==a&&((d=T.getNetworkInterface(e,"BLE","Advertiser",2)).ble||(d.ble={}),p=d.ble,u[a].ble||(u[a].ble={}),c=u[a].ble),u[a].id=d.id,"enabled"==(l=Q[r])?("true"==t[r]?t[r]=!0:"false"==t[r]&&(t[r]=!1),u[a][l]=t[r],d.set?d.set(l,t[r]):d[l]=t[r]):("true"==t[r]?t[r]=!0:"false"==t[r]&&(t[r]=!1),c[l]=t[r],p.set?p.set(l,t[r]):p[l]=t[r]),g.push(r));for(o=g.length,n=0;n<o;n++)delete t[g[n]];for(a in u)void 0!==u[a].id&&m.push(u[a]);t.networks=m}}var ee,te,ie,ae,ne={ControlPoint:{selectedDetailFilter:function(e){var t=e.type;if(t){if(-1!=t.indexOf("DI")||-1!=t.indexOf("DO")||-1!=t.indexOf("DV"))return["inputRange","scaleType","scale","bias","maxValue","minValue"];if(-1!=t.indexOf("AI")||-1!=t.indexOf("AO")||-1!=t.indexOf("AV"))return["pointMode","signalLogicStatus","signalReverse"]}}},Meter:{detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>',selectedDetailFilter:function(e){var t,i=e.type;return i&&(t=-1!=i.indexOf("ControlPoint")?["meterType"]:["pointMeterType"]),T.isEnableEnergyMappingType(e)||t.push("connectedDevices"),t}},"Sensor.Motion":{detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>'},"Sensor.Temperature_Humidity":{detailContentTemplate:'<div class="device-detail-header"><span class="device-detail-header-type" data-bind="text: detailType">General</span></div><div class="detail-dialog-detail-content-field-list"></div>'},Light:{width:932,height:888,gridOptions:{height:"calc(100% - 60px)",columns:[{headerTemplate:"",template:function(e){var t=v.dialogType,i="register"==t||"deregister"==t,a="deregister"==t;return n.multiDetailListDualTemplate(e,i,a)}}]},onTypeChange:function(e){z(e);var t,i,a,n=e.sender,o=!1,s=!1,r=!1,l=void 0,d=n.dataSource.data(),c=d.length,p=0,u=0,m=0;for(t=0;t<c;t++)if(i=(a=d[t]).type){-1!=i.indexOf("AO")&&(s=!0),-1!=i.indexOf("DO")&&(o=!0),"Light"==i&&(s=o=!0),"Normal.On"==b.getStatus(a)?(p=p<1?1:p,void 0===l?l="On":r||"Off"!==l||(r=!0)):(p=p<=0?0:p,void 0===l?l="Off":r||"On"!==l||(r=!0));var g=T.getDimmingLevel(a);"-"!=g&&-1==i.indexOf("AI")&&-1==i.indexOf("DI")&&(g=g.replace("%",""),u+=g=Number(g),m++)}0!=m&&(u=Math.round(u/m));var f=E.lightControlViewModel;f.init(n),p=1==p,f.light.power.set("active",p),f.light.power.set("mixed",r),f.light.set("value",u);var v=n.element.find(".group-control-dialog-control");if(!o&&!s||n.dialogType)n.element.find(".group-control-dialog").removeClass("group-control-dialog"),v.hide(),n.wrapper.css({width:652});else{n.wrapper.css({width:932}),I.unbind(v),I.bind(v,f);var _=f.get("light");_.power.set("invisible",!o),_.set("invisible",!s)}},contentTemplate:'<div class="group-control-dialog detail-dialog-content device-dialog-content" style="width:592px;"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>'+E.lightControlTemplate},Beacon:{parseSaveData:function(e,t){if(!t)return t;var i,a;if($.isArray(t))for(a=t.length,i=0;i<a;i++)X(e[i],t[i]);else X(e,t);return t},buttonsIndex:{CLOSE:0,EDIT:1,CANCEL:2,SAVE:3,REGISTER:4,DEREGISTER:5,BLOCK:6,DELETE:7},onTypeChange:function(e){var t=e.type,i=e.sender.BTN,a=e.sender.dataSource.data();"register"==t?(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.EDIT,{visible:!1}),v.setActions(i.DEREGISTER,{visible:!1}),v.setActions(i.DELETE,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.REGISTER,{visible:!0}),v.setActions(i.BLOCK,{visible:!1})):"deregister"==t?(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.REGISTER,{visible:!1}),v.setActions(i.DELETE,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.EDIT,{visible:!0}),v.setActions(i.DEREGISTER,{visible:!0}),v.setActions(i.BLOCK,{visible:!1})):"delete"==t?(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.BLOCK,{visible:!1}),v.setActions(i.DEREGISTER,{visible:!1}),v.setActions(i.REGISTER,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),v.setActions(i.EDIT,{visible:!0}),v.setActions(i.DELETE,{visible:!0})):(v.setActions(i.SAVE,{visible:!1}),v.setActions(i.CANCEL,{visible:!1}),v.setActions(i.DEREGISTER,{visible:!1}),v.setActions(i.REGISTER,{visible:!1}),v.setActions(i.BLOCK,{visible:!1}),v.setActions(i.DELETE,{visible:!1}),v.setActions(i.CLOSE,{visible:!0}),1<a.length?v.setActions(i.EDIT,{visible:!0,disabled:!0}):v.setActions(i.EDIT,{visible:!0,disabled:!1}))},actions:[{text:o.prop("COMMON_BTN_CLOSE"),visible:!0,action:V},{text:o.prop("COMMON_BTN_EDIT"),visible:!0,action:P},{text:o.prop("COMMON_BTN_CANCEL"),visible:!1,action:W},{text:o.prop("COMMON_BTN_SAVE"),visible:!1,disabled:!0,action:U},{text:o.prop("COMMON_BTN_REGISTER"),visible:!1,action:Y},{text:o.prop("COMMON_BTN_DEREGISTER"),visible:!1,action:G},{text:o.prop("COMMON_BTN_BLOCK"),visible:!1,action:function(e){var t,i=e.sender.getSelectedData(),a={registrationStatus:"Blocked"};if(1<e.sender.dataSource.total()){var n,o,s=(i=(i=e.sender.dataSource.data()).toJSON()).length;for(t=[],n=0;n<s;n++)(o={}).id=i[n].id,o.registrationStatus="Blocked",t.push(o)}return e.sender.trigger("onBlock",{sender:e.sender,result:a,results:t}),!1}},{text:o.prop("COMMON_BTN_DELETE"),visible:!1,action:function(e){var t,i=e.sender.getSelectedData(),a={};if(a.id=i.id,1<e.sender.dataSource.total()){var n,o,s=(i=(i=e.sender.dataSource.data()).toJSON()).length;for(t=[],n=0;n<s;n++)(o={}).id=i[n].id,t.push(o)}return e.sender.trigger("onDelete",{sender:e.sender,result:a,results:t}),!1}}],scheme:{groupName:{advertisement:{template:"<div class='group'>Advertisement</div>"}},fields:{description:{isEditAll:!0},configuration:{isEditAll:!0}}}},Gateway:{parseSaveData:function(e,t){if(!t)return t;var i,a;if($.isArray(t))for(a=t.length,i=0;i<a;i++)J(e[i],t[i]);else J(e,t);return t},selectedDetailFilter:function(e){var t=e.networks;if(!t||!t[0])return["wifiFirst","wifiSecond"];var i,a=t.length,n=["wifiFirst","wifiSecond"];for(i=0;i<a;i++)"WiFi2.4GHz"==t[i].type?n[0]=null:"WiFi5GHz"==t[i].type&&(n[1]=null);var o=T.getNetworkInterfaceIndex(e,"Zigbee",null,null,!0);return-1==o&&n.push("zigbeeInterface"),-1==(o=T.getNetworkInterfaceIndex(e,"BLE","Scanner",null,!0))&&n.push("bleInterface"),-1==(o=T.getNetworkInterfaceIndex(e,"BLE","Advertiser",0,!0))?(n.push("bleSetup"),n.push("bleFirst"),n.push("bleSecond"),n.push("bleThird")):(-1==(o=T.getNetworkInterfaceIndex(e,"BLE","Advertiser",2,!0))&&n.push("bleThird"),-1==(o=T.getNetworkInterfaceIndex(e,"BLE","Advertiser",1,!0))&&n.push("bleSecond")),n},scheme:{groupName:{zigbeeInterface:{template:"<div class='group'>ZigBee Interface</div>"},bleInterface:{template:"<div class='group'>BLE Interface</div>"},bleSetup:{template:"<div class='group'>Built-in Beacon Setup</div>"},bleFirst:{template:"<div class='group'>Built-in Beacon #1</div>"},bleSecond:{template:"<div class='group'>Built-in Beacon #2</div>"},bleThird:{template:"<div class='group'>Built-in Beacon #3</div>"},wifiFirst:{template:"<div class='group'>WIFI Interface (2.4GHz)</div>"},wifiSecond:{template:"<div class='group'>WIFI Interface (5GHz)</div>"}},fields:{description:{isEditAll:!0}}}},CCTV:{scheme:{groupName:{wifiInterface:{template:"<div class='group'>WIFI Interface</div>"},wifiInterfaceDetail:{template:"<div class='group'>Gateway WIFI Interface (<span data-bind='text: wifiFrequency'></span>)</div>"}},fields:{description:{isEditAll:!0}}},setAdditionalDetailData:function(n){console.error("set additional!"),console.error(this),_.open(this.element);var o,e=n.parentId,s=n.networks;if(s&&s[0]){if((o=s[0]).type)return $.ajax({url:"/dms/devices/"+e+"/networks"}).then(function(e){_.close();var t,i=e.length;if(e&&e[0]){var a=s[1];for(t=0;t<i;t++)if(e[t].type==a.type){e=e[t];break}o?o.wifi=e.wifi:s.push(e)}n.wifiFrequency=T.getCCTVWifiType(n),n.wifi=e.wifi}).fail(function(){_.close()})}else n.wifiFrequency="-";var t=new $.Deferred;return t.resolve(),_.close(),t.promise()},onTypeChange:function(e){var t=e.sender.dataSource.data().length,i=e.type,a=e.sender.BTN;"register"==i?(v.setActions(a.SAVE,{visible:!1}),v.setActions(a.CANCEL,{visible:!1}),v.setActions(a.EDIT,{visible:!1}),v.setActions(a.DEREGISTER,{visible:!1}),v.setActions(a.CLOSE,{visible:!0}),v.setActions(a.REGISTER,{visible:!0})):"deregister"==i?(v.setActions(a.SAVE,{visible:!1}),v.setActions(a.CANCEL,{visible:!1}),v.setActions(a.REGISTER,{visible:!1}),v.setActions(a.CLOSE,{visible:!0}),v.setActions(a.EDIT,{visible:!0}),v.setActions(a.DEREGISTER,{visible:!0})):(v.setActions(a.SAVE,{visible:!1}),v.setActions(a.CANCEL,{visible:!1}),v.setActions(a.DEREGISTER,{visible:!1}),v.setActions(a.REGISTER,{visible:!1}),v.setActions(a.CLOSE,{visible:!0}),1<t?v.setActions(a.EDIT,{visible:!0,disabled:!0}):v.setActions(a.EDIT,{visible:!0,disabled:!1}))}},SmartPlug:{width:932,height:888,gridOptions:{height:"calc(100% - 60px)",columns:[{headerTemplate:"",template:function(e){var t=v.dialogType,i="register"==t||"deregister"==t,a="deregister"==t;return n.multiDetailListDualTemplate(e,i,a)}}]},onTypeChange:function(e){var t,i,a,n=e.sender,o=!1,s=!1,r=n.dataSource.data(),l=r.length,d=0;for(t=0;t<l;t++){if(i=(a=r[t]).type)-1!=i.indexOf("AO")&&(s=!0),-1!=i.indexOf("DO")&&(o=!0),"SmartPlug"==i&&(o=!0),d="Normal.On"==b.getStatus(a)?d<1?1:d:d<=0?0:d}var c=e.type,p=e.sender.BTN;"register"==c?(v.setActions(p.SAVE,{visible:!1}),v.setActions(p.CANCEL,{visible:!1}),v.setActions(p.EDIT,{visible:!1}),v.setActions(p.DEREGISTER,{visible:!1}),v.setActions(p.CLOSE,{visible:!0}),v.setActions(p.REGISTER,{visible:!0})):"deregister"==c?(v.setActions(p.SAVE,{visible:!1}),v.setActions(p.CANCEL,{visible:!1}),v.setActions(p.REGISTER,{visible:!1}),v.setActions(p.CLOSE,{visible:!0}),v.setActions(p.EDIT,{visible:!0}),v.setActions(p.DEREGISTER,{visible:!0})):(v.setActions(p.SAVE,{visible:!1}),v.setActions(p.CANCEL,{visible:!1}),v.setActions(p.DEREGISTER,{visible:!1}),v.setActions(p.REGISTER,{visible:!1}),v.setActions(p.CLOSE,{visible:!0}),1<l?v.setActions(p.EDIT,{visible:!0,disabled:!0}):v.setActions(p.EDIT,{visible:!0,disabled:!1}));var u=f.smartPlugControlViewModel;u.init(n),d=1==d,u.smartPlug.power.set("active",d),u.smartPlug.set("value",0);var m=n.element.find(".group-control-dialog-control");if(o||s){n.wrapper.css({width:932}),I.unbind(m),I.bind(m,u);var g=u.get("smartPlug");g.power.set("invisible",!o),g.set("invisible",!s)}else n.element.find(".group-control-dialog").removeClass("group-control-dialog"),m.hide(),n.wrapper.css({width:652})},contentTemplate:'<div class="group-control-dialog detail-dialog-content device-dialog-content" style="width:592px;"><div class="detail-dialog-header device-dialog-header"></div><div class="detail-dialog-detail-content"></div></div>'+f.smartPlugControlTemplate},All:{buttonsIndex:{CLOSE:0},onTypeChange:function(e){var t=e.sender.BTN;v.setActions(t.CLOSE,{visible:!0}),v.setActions(t.EDIT,{visible:!1})},selectedDetailFilter:function(e){var t=e.mappedType||e.type,i=$.extend(!0,{},oe.All.scheme.fields),a=$.extend(!0,{},oe.All.scheme.groupName);-1!=(t=b.getGeneralType(t)).indexOf("Meter")?t="Meter":-1==t.indexOf("Humidity")&&-1==t.indexOf("Temperature")||(t="Sensor.Temperature_Humidity");var n=Z[t];n||console.error("there is no field this device "+t);var o,s=oe[t].scheme.groupName?oe[t].scheme.groupName:{},r=[];for(o in i)-1==n.indexOf(o)&&r.push(o);for(o in a)s[o]||r.push(o);var l=[];ne[t]&&ne[t].selectedDetailFilter&&(l=ne[t].selectedDetailFilter(e));var d,c,p=l.length;for(d=0;d<p;d++)-1!=(c=r.indexOf(l[d]))&&r.splice(c,1);return r},actions:[{text:o.prop("COMMON_BTN_CLOSE"),visible:!0,action:V}],scheme:{groupName:{}}}},oe={};for(ie in Z){if(te=Z[ie],ee=$.extend(!0,{},j),"All"!==ie)for(ae in ee.scheme.fields)-1==te.indexOf(ae)&&delete ee.scheme.fields[ae];oe[ie]=ee}for(ie in ne)"All"!==ie&&ne[ie].scheme&&ne[ie].scheme.groupName&&$.extend(ne.All.scheme.groupName,ne[ie].scheme.groupName);for(ie in ne)ee=oe[ie],ee=$.extend(!0,ee,ne[ie]);var se,re,le=$("<div/>");return se=le.kendoCommonDialog().data("kendoCommonDialog"),re=$("<div/>").kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog"),{getDetailPopup:function(e){return v=t.kendoDetailDialog(oe[e]).data("kendoDetailDialog")},messageDialog:se,confirmDialog:re}}),define("device/common/controller/base-controller",["device/common/device-api","device/common/device-util","device/common/device-constants","device/common/config/popup-config","device/common/device-template"],function(u,m,f,a,i){var g=window.kendo,v=window.MAIN_WINDOW,t=window.CommonLoadingPanel,_=a.messageDialog,d=a.confirmDialog,T=window.I18N;return g.Class.extend({init:function(e){this._createDataSource(),this.loadingPanel=new t,this.deviceTabPanel=e.sender,this.element=e.contentElement,this.tabIndex=e.selectedIdx,this.tabLayout=e.tabLayout,this.deviceTypeKey=this.tabLayout.key,this.innerLayouts=e.innerLayouts,this.viewModel=e.viewModel,this.nameFilter=[],this.typeFilter=[],this.statusFilter=[],this.zoneFilter=[],this.modeFilter=[],this.controlPanelElement=this.element.find(".device-control-panel"),this.registrationMapListElement=this.element.find(".device-registration-map-panel"),this.monitoringMapListElement=this.element.find(".device-monitoring-map-panel"),v.disableBuidingTotal(!1),v.disableFloorAllBtn(!1),this.initComponent(),this.attachEvent()},_createDataSource:function(){self.zoneDataSource=new g.data.DataSource({data:[]})},initComponent:function(){var e=this.getLayoutViewModel("registration");e&&(this.registrationMapView=e.dataViews.map);var t=this.deviceTypeKey;this.detailPopup=a.getDetailPopup(t);var i=this.getRegisterMapListOptions();this.registrationMapList=this.registrationMapListElement.kendoDeviceTabGroupGrid(i).data("kendoDeviceTabGroupGrid"),(i=this.getMonitoringMapListOptions())&&(this.monitoringMapList=this.monitoringMapListElement.kendoDeviceTabGroupGrid(i).data("kendoDeviceTabGroupGrid")),this.innerLayouts.length<2&&this.element.find(".device-panel-layout-buttons").hide()},attachEvent:function(){var e=this;e.deviceTabPanel.bind("changeInnerLayout",e.onChangeInnerLayout.bind(e)),e.deviceTabPanel.bind("changeDataLayout",e.onChangeDataLayout.bind(e)),e.registrationMapList&&(e.registrationMapListElement.on("click",".map-panel-list-container .k-grid-content.no-header .device-map-panel-list-item",e.initListDragDropEvt.bind(this)),e.registrationMapList.bind("expand",e.expandRegistrationMapListTab.bind(e)),e.registrationMapList.bind("change",e.onRegistrationMapListChangeSelection.bind(e))),e.registrationMapView&&e.registrationMapView.widget.bind("dragend",e.dragEndDeviceEvt.bind(e));var t=e.getFilterViewModel(f.FILTER_NAME.SELECTALL);t&&t.options.set("click",e.clickSelectAllEvt.bind(e));var i=e.getActionViewModel(f.ACTION_NAME.DETAIL);i&&i.options.set("click",e.clickDetailBtnEvt.bind(e)),$(".device-content-wrapper").on("click",".k-widget .ic-info",e.clickDetailIconEvt.bind(e));var a=e.viewModel.registrationStatusButtons;if(a){var n=a[f.REGISTRATION_STATUS_BUTTONS.REGISTER];n&&n.set("click",e.clickRegisterInRegistration.bind(e));var o=a[f.REGISTRATION_STATUS_BUTTONS.UNREGISTER];o&&o.set("click",e.clickUnregisterInRegistration.bind(e))}var s=e.getActionViewModel(f.ACTION_NAME.REGISTER);s&&s.options.set("click",e.clickRegisterBtnEvt.bind(e));var r=e.getActionViewModel(f.ACTION_NAME.DELETE);r&&r.options.set("click",e.clickDeleteBtnEvt.bind(e)),e.detailPopup&&(e.detailPopup.bind("onSaved",e.saveDetailPopupEvt.bind(e)),e.detailPopup.bind("onRegister",e.registerDetailPopupEvt.bind(e)),e.detailPopup.bind("onDeregister",e.deregisterDetailPopupEvt.bind(e))),e.refreshInterval=setInterval(e.intervalRefreshData.bind(e),f.ALL_TIME_INTERVAL),e.attachFilterEvt(),e.viewModel.set("searchKeyDown",e.keydownSearchEvt.bind(e)),e.viewModel.set("searchClick",e.clickSearchEvt.bind(e))},attachFilterEvt:function(){var o=this,e=o.getFilterViewModel(f.FILTER_NAME.ZONE);e&&e.options.set("selectionChanged",function(e){o.zoneFilter=[];var t=e.newValue,i=t.length,a=e.count;if(0===i)o.zoneFilter.push(m.filter1Depth("locations","foundation_space_zones_id",void 0));else if(i!==a&&0!==a)for(var n=0;n<i;n++)o.zoneFilter.push(m.filter1Depth("locations","foundation_space_zones_id",t[n]));o.applyCurrentFilter()})},keydownSearchEvt:function(e){13!=e.keyCode||this.keydownClickSearchTriggerEvt(e)},keydownClickSearchTriggerEvt:function(e){var t=$(e.target).val();this.viewModel.set("searchFieldValue",t),this.clickSearchEvt(e)},clickSearchEvt:function(e){this.viewModel.get("enableSearch")&&this.applyCurrentFilter()},intervalRefreshData:function(){var e=this;e.refreshTimeout&&(clearTimeout(e.refreshTimeout),e.refreshTimeout=null),e.refreshTimeout=setTimeout(e.onRefreshData.bind(e),2*f.TIMEOUT)},onRefreshData:function(){var e=this,t=e.getCurrentViewInfo(),i=t.innerLayoutName,a=t.dataViewWidget;e.isRefreshing||e.detailPopup&&e.detailPopup.isEditable||"monitoring"==i&&(e.loadingPanel.open(a.element),e.refreshDeviceData(!0).always(function(){e.loadingPanel.close()}))},saveDetailPopupEvt:function(e){this.patchInDetailPopupEvt(e,!0)},registerDetailPopupEvt:function(e){var t=this,i=e.sender;d.message(T.prop("FACILITY_DEVICE_REGISTER_CONFIRM")),d.setConfirmActions({yes:function(){t.patchInDetailPopupEvt(e)},no:function(){i.fail()}}),d.open()},deregisterDetailPopupEvt:function(e){var t=this,i=e.sender;d.message(T.prop("FACILITY_DEVICE_DEREGISTER_CONFIRM")),d.setConfirmActions({yes:function(){t.patchInDetailPopupEvt(e)},no:function(){i.fail()}}),d.open()},patchInDetailPopupEvt:function(e,t){var i=this,a=e.hideMessagePopup,n=e.sender,o=e.results?e.results:[e.result];if(o){var s=n.dialogType;i.loadingPanel.open(n.element),i.onPatchInDetailPopupEvt(o),u.patchDevices(o).done(function(){var e;n.success(),i.loadingPanel.close(),"register"==s||"deregister"==s&&!t?(e="register"==s?T.prop("FACILITY_DEVICE_REGISTER_RESULT"):T.prop("FACILITY_DEVICE_DEREGISTER_RESULT"),n.close(),_.message(e),_.open()):(e=T.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED"),_.message(e),a||_.open(n.element)),i.loadingPanel.open(),i.refreshDeviceData(!1).always(function(){i.loadingPanel.close()})}).fail(function(e){n.fail(),i.loadingPanel.close();var t=m.getDeviceRegistrationFailMsg(e);_.message(t),_.open(n.element)})}},onPatchInDetailPopupEvt:function(e){var t,i,a,n=e.length;for(i=0;i<n;i++)(a=(t=e[i]).locations)&&a[0]&&a[0].nameDisplayCoordinate&&(t.nameDisplayCoordinate=a[0].nameDisplayCoordinate,delete a[0].nameDisplayCoordinate)},clickRegisterInRegistration:function(e){var t=this,i=t.viewModel.registrationStatusButtons,a=i[f.REGISTRATION_STATUS_BUTTONS.REGISTER],n=i[f.REGISTRATION_STATUS_BUTTONS.UNREGISTER];a.get("active")||(a.set("active",!0),n.set("active",!1),t.getActionViewModel(f.ACTION_NAME.REGISTER).set("text",f.TEXT.DEREGISTER),t.onInitializeFilter(),t.loadingPanel.open(),t.refreshDeviceData(!1).always(function(){t.loadingPanel.close()}))},clickUnregisterInRegistration:function(e){var t=this,i=t.viewModel.registrationStatusButtons,a=i[f.REGISTRATION_STATUS_BUTTONS.REGISTER],n=i[f.REGISTRATION_STATUS_BUTTONS.UNREGISTER];n.get("active")||(n.set("active",!0),a.set("active",!1),t.getActionViewModel(f.ACTION_NAME.REGISTER).set("text",f.TEXT.REGISTER),t.onInitializeFilter(),t.loadingPanel.open(),t.refreshDeviceData(!1).always(function(){t.loadingPanel.close()}))},clickSelectAllEvt:function(e){var t=this.getFilterViewModel(f.FILTER_NAME.SELECTALL),i=t.get("text");i===f.TEXT.SELECTALL?(t.set("text",f.TEXT.DESELECTALL),this.selectAll()):i==f.TEXT.DESELECTALL&&(t.set("text",f.TEXT.SELECTALL),this.unselectAll())},clickRegisterBtnEvt:function(e){var t,i=this,a=i.getCurrentViewInfo(),n=a.registrationStatus,o=a.dataViewName,s=a.dataViewWidget,r=[],l=!1;if("map"==o&&"NotRegistered"==n)i.registrationMapList&&(r=i.registrationMapList.getSelectedData()),t="register",l=!0;else{if(r=s.getSelectedData(),"Registered"==n)return d.message(T.prop("FACILITY_DEVICE_DEREGISTER_CONFIRM")),d.setConfirmActions({yes:function(){i.loadingPanel.open(),u.patchRegistrationStatus(r,"NotRegistered").always(function(){i.refreshDeviceData(!1).always(function(){i.loadingPanel.close(),_.message(T.prop("FACILITY_DEVICE_DEREGISTER_RESULT")),_.open()})})}}),void d.open();t="register"}i.openDetailPopup(r,t,l)},clickDeleteBtnEvt:function(e){var n=this,t=n.getCurrentViewInfo(),i=t.registrationStatus,a=t.dataViewName,o=t.dataViewWidget,s=[];"map"==a&&"NotRegistered"==i?n.registrationMapList&&0==(s=n.registrationMapList.getSelectedData()).length&&(s=o.getSelectedData()):s=o.getSelectedData(),d.message(T.prop("FACILITY_DEVICE_DELETE_CONFIRM")),d.setConfirmActions({yes:function(){n.loadingPanel.open();var e,t,i=[],a=s.length;for(t=0;t<a;t++)e=s[t],i.push(e.id);u.deleteDevices(i).always(function(){n.refreshDeviceData(!1).always(function(){n.loadingPanel.close(),_.message(T.prop("FACILITY_DEVICE_DELETE_RESULT")),_.open()})})}}),d.open()},clickDetailIconEvt:function(e){var t=$(e.target).data("id");this.openDetailPopup([{id:t}])},clickDetailBtnEvt:function(e){var t,i=this,a=i.getCurrentViewInfo(),n=a.innerLayoutName,o=a.dataViewName,s=a.dataViewWidget,r=[];"registration"==n&&"map"==o&&i.registrationMapList&&i.registrationMapList.selectedIndex==f.REGISTRATION_STATUS_BUTTONS.UNREGISTER?0==(r=i.registrationMapList.getSelectedData()).length&&(r=s.getSelectedData(),t="deregister"):r=s.getSelectedData(),i.openDetailPopup(r,t)},openDetailPopup:function(e,i,a){var t,n,o=this,s=e.length,r=o.getCurrentViewInfo(),l=r.innerLayoutName,d=r.registrationStatus;if(i||"registration"==l&&(i="Registered"==d?"deregister":"register"),s){for(o.loadingPanel.open(),n=[],t=0;t<s;t++)n.push(e[t].id);u.getDeviceWithMultipleID(n).done(function(e){var t=new g.data.DataSource({data:e,pageSize:50});t.read(),o.detailPopup.setDialogType(i),o.detailPopup.setDataSource(t),o.detailPopup.open(i),a&&o.detailPopup.buttons[4].click()}).always(function(){o.loadingPanel.close()})}},onFloorChanged:function(e){var t=this,i=e.floor,a=e.building,n=i.id,o=a.id==v.FLOOR_NAV_BUILDING_TOTAL_ID,s=n==v.FLOOR_NAV_FLOOR_ALL_ID,r=t.getCurrentViewInfo(),l=r.innerLayoutName,d=r.dataViewName;t.viewModel.set("searchFieldValue",""),t.zoneFilter=[],t._getZoneData(n,o,s).always(function(){var e=d;"monitoring"==l?"map"==d&&(o||s)?e="statistic":"statistic"!=d||o||s||(e="map"):"registration"==l&&(e="map"),t.deviceTabPanel.trigger("changeInnerLayout",{viewName:e})})},_getZoneData:function(e,t,i){var a=new $.Deferred,n=this,o=n.getFilterViewModel(f.FILTER_NAME.ZONE);return t||i?(o&&(o.options.set("disabled",!0),o.options.set("dataSource",[{id:void 0,name:T.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY_ZONE")}])),n.zoneDataSource=new g.data.DataSource({data:[]}),a.resolve()):(o&&o.options.set("disabled",!1),n.loadingPanel.open(),u.getZone(e).done(function(e){if(o){var t=$.extend(!0,[],e);t.unshift({id:void 0,name:T.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY_ZONE")}),o.options.set("dataSource",t)}n.zoneDataSource=new g.data.DataSource({data:e}),n.zoneDataSource.read(),n.loadingPanel.close(),a.resolve()}).fail(function(){a.reject()})),a.promise()},onChangeInnerLayout:function(e){var t,i=this.getCurrentViewInfo().innerLayoutName,a=e.viewName;if(!a){var n=window.localStorage.getItem("deviceViewType");n?(a=n.toLowerCase(),window.localStorage.removeItem("deviceViewType")):a=m.getDefaultView()}"registration"==i?(t=this.onRegistrationLayout())&&(a=t):"monitoring"==i&&(t=this.onMonitoringLayout())&&(a=t),this.deviceTabPanel.changeDataLayout(a)},onMonitoringLayout:function(){var e=this;v.getCurrentFloor().building.id==v.FLOOR_NAV_BUILDING_TOTAL_ID?(v.disableBuidingTotal(!1),v.disableFloorAllBtn(!0)):(v.disableBuidingTotal(!1),v.disableFloorAllBtn(!1)),e.setViewBtnEnabled("grid",!0),e.setViewBtnEnabled("map",!0),e.setViewBtnEnabled("list",!0),e.setViewBtnEnabled("statistic",!0),e.viewModel.set("enableSearch",!0),e.getActionViewModel(f.ACTION_NAME.REGISTER).options.set("invisible",!0);var t=e.getFilterViewModel(f.FILTER_NAME.ZONE);return t&&t.options.set("invisible",!1),null},onRegistrationLayout:function(){var e=this;v.disableFloorAllBtn(!0),v.disableBuidingTotal(!0),e.setViewBtnEnabled("grid",!1),e.setViewBtnEnabled("statistic",!1),e.setViewBtnEnabled("map",!0);var t=e.getActionViewModel(f.ACTION_NAME.REGISTER);t.options.set("invisible",!1),t.set("text",f.TEXT.DEREGISTER);var i=e.getFilterViewModel(f.FILTER_NAME.ZONE);return i&&i.options.set("invisible",!0),e.viewModel.set("enableSearch",!0),"map"},onChangeDataLayout:function(e){var t=this,i=v.getCurrentFloor(),a=i.floor,n=i.building,o=a.id,s=n.id,r=v.getCurrentFloorList(),l=s==v.FLOOR_NAV_BUILDING_TOTAL_ID,d=o==v.FLOOR_NAV_FLOOR_ALL_ID,c=t.getCurrentViewInfo(),p=c.innerLayoutName,u=c.dataViewWidget,m=e.viewName;t.deviceTabPanel.setViewWidgetDatasource([]),t.deviceTabPanel.setStatisticDatasource([]),t.deviceTabPanel.setZoneDatasource([],{imageUrl:null});var g=0<r.length;if("monitoring"==p){if(!l&&!g)return t.setViewBtnEnabled("map",!1),void("map"==m&&(m="list",t.deviceTabPanel.changeDataLayout(m)));if("map"==m){if(l)return void v.clickTopBuilding(!1);if(d)return void v.clickTopFloor()}else if("statistic"==m&&!l&&!d)return void v.clickAllFloor()}else if("registration"==p){if(l)return void v.clickTopBuilding(!1);if(g&&d)return void v.clickTopFloor();if(!g)return _.message(T.prop("FACILITY_DEVICE_NO_FLOOR_MSG")),_.open(),t.onChangeDataView(p,m,u),t.viewModel.set("hideRegisterArea",!0),t.viewModel.set("hideRightPanel",!0),t.viewModel.set("hideControlPanel",!0),t.viewModel.set("hideLightControlPanel",!0),void t.viewModel.set("hideMapPanel",!0)}t.onChangeDataView(p,m,u),t.loadingPanel.open(),t.refreshDeviceData(!1,p,m,u).always(function(){"map"==m&&(t.monitoringMapList?"registration"==p?t.registrationMapList.selectTab(f.REGISTRATION_STATUS_BUTTONS.REGISTER,!0):"monitoring"==p&&t.monitoringMapList.selectTab(f.REGISTRATION_STATUS_BUTTONS.REGISTER,!0):t.registrationMapList&&t.registrationMapList.selectTab(f.REGISTRATION_STATUS_BUTTONS.REGISTER,!0)),t.loadingPanel.close()})},onChangeDataView:function(e,t,i){var a=this,n=a.viewModel;a.prevLayoutName==e&&a.prevViewName==t||a.onInitializeFilter(),a.prevLayoutName=e,a.prevViewName=t,n.set("hideRegisterArea",!0),n.set("hideRightPanel",!0),n.set("hideControlPanel",!0),n.set("hideLightControlPanel",!0),n.set("hideMapPanel",!0),"list"!=t||"monitoring"!=e&&(i.dataSource.sort([{field:"name",dir:"asc"}]),n.set("hideRegisterArea",!1),n.registrationStatusButtons[f.REGISTRATION_STATUS_BUTTONS.REGISTER].set("active",!0),n.registrationStatusButtons[f.REGISTRATION_STATUS_BUTTONS.UNREGISTER].set("active",!1),a.getActionViewModel(f.ACTION_NAME.REGISTER).set("text",f.TEXT.DEREGISTER));"statistic"==t?(n.set("hideSelectArea",!0),n.set("enableSearch",!1)):n.set("hideSelectArea",!1);var o=a.getFilterViewModel(f.FILTER_NAME.ZONE);if("map"==t){o&&o.options.set("invisible",!0),"monitoring"==e?(i.setOptions({isRegisterView:!1,canDragDeviceIcon:!1}),n.set("hideRegistrationMapPanel",!0),n.set("hideMonitoringMapPanel",!1)):"registration"==e&&(i.setOptions({isRegisterView:!0,canDragDeviceIcon:!0}),a.registrationMapList&&a.registrationMapList.selectTab(f.REGISTRATION_STATUS_BUTTONS.REGISTER),n.set("hideRegistrationMapPanel",!1),n.set("hideMonitoringMapPanel",!0)),n.set("hideRightPanel",!1),n.set("hideMapPanel",!1);var s=v.getCurrentFloor().floor;i.setFloor(s),i.setZoneDataSource(a.zoneDataSource)}else"monitoring"==e&&o&&o.options.set("invisible",!1);i.unbind("change"),i.bind("change",a.onWidgetChangeSelection.bind(a))},refreshDeviceData:function(n,o,s,r,e){var l=this,t=v.getCurrentFloor(),i=t.floor,a=t.building,d=i.id,c=a.id,p=new $.Deferred;l.isRefreshing=!0;var u=l.getCurrentViewInfo();return o=o||u.innerLayoutName,s=s||u.dataViewName,e=e||u.registrationStatus,r=r||u.dataViewWidget,"registration"==o&&"map"==s&&(e="Registered"),("statistic"==s?l.getStatisticData(c,d):l.getDeviceData({viewName:s,layoutName:o,widget:r,registrationStatus:e,isRefresh:n})).fail(function(e){var t=m.getDeviceRegistrationFailMsg(e);_.message(t),_.open()}).always(function(e){if(e){var t=r.dataSource,i=l.createDataSource(e,t);r.setDataSource(i);var a=[];"registration"==o&&a.push(l.getRegisteredDeviceNum()),$.when.apply(this,a).fail(function(e){var t=m.getDeviceRegistrationFailMsg(e);_.message(t),_.open()}).always(function(){l.onAfterRefreshData(n,o,s,r,i),p.resolve(),l.isRefreshing=!1})}else p.resolve()}),p.promise()},onAfterRefreshData:function(e,t,i,a,n){var o=this,s=a.getSelectedData();o.setSelectedDataNum(s),"map"==i&&(e?o.monitoringMapList?"monitoring"==t?o.monitoringMapList.setDataSource(n,!1,!0):"registration"==t&&o.registrationMapList.setDataSource(n,!1,!0):o.registrationMapList&&o.registrationMapList.selectedIndex==f.REGISTRATION_STATUS_BUTTONS.REGISTER&&o.registrationMapList.setDataSource(n,!1,!0):("monitoring"==t&&o.monitoringMapList&&o.monitoringMapList.selectTab(o.monitoringMapList.selectedIndex,!0),"registration"==t&&o.registrationMapList&&o.registrationMapList.selectTab(o.registrationMapList.selectedIndex,!0)))},onInitializeFilter:function(){var e=this,t=e.viewModel;e.typeFilter=[],e.statusFilter=[],e.zoneFilter=[],e.modeFilter=[],t.set("searchFieldValue","");var i,a,n,o=t.filters,s=o.length;for(n=0;n<s;n++)"dropdowncheckbox"==(i=(a=o[n]).type)?(a=$("#"+a.id).data("kendoDropDownCheckBox")).selectAll():"dropdownlist"==i&&a.options.set("value",-1)},getCurrentFilter:function(){var e=this,t=[],i=e.getCurrentViewInfo(),a=i.dataViewName,n=i.registrationStatus;if("registration"==i.innerLayoutName&&"list"==a&&"NotRegistered"==n)return[];t=m.getAccureFilter(t,e.typeFilter,e.statusFilter,e.zoneFilter,e.modeFilter);var o=e.viewModel.get("searchFieldValue");if(o){var s={logic:"or",filters:[]};s.filters.push(m.filter0Depth("id","contains",o)),s.filters.push(m.filter0Depth("name","contains",o)),s.filters.push(m.filter1Depth("controlPoint","tagName",o)),t.filters.push(s)}return 0==t.filters.length?[]:t},applyCurrentFilter:function(e){var t=this,i=t.getCurrentViewInfo(),a=t.getCurrentFilter(),n=i.dataViewWidget,o=i.dataViewName,s=i.registrationStatus,r=i.innerLayoutName,l=n.dataSource;t.unselectAll();var d=[];d.push(t.refreshDeviceData(!1)),t.loadingPanel.open(),$.when.apply(this,d).always(function(){t._isSelectingTab||t.loadingPanel.close(),"registration"==r&&"NotRegistered"==s?"map"==o?l.filter(a):"list"==o&&l.filter([]):l.filter(a),t.setSelectedDataNum([]),"map"==o&&("registration"==r&&t.registrationMapList&&t.registrationMapList.selectTab(t.registrationMapList.selectedIndex,!0,!0),"monitoring"==r&&t.monitoringMapList&&t.monitoringMapList.selectTab(f.REGISTRATION_STATUS_BUTTONS.REGISTER,!0),"monitoring"==r&&t.registrationMapList&&t.registrationMapList.element.is(":visible")&&t.registrationMapList.selectTab(f.REGISTRATION_STATUS_BUTTONS.REGISTER,!0))})},getStatisticData:function(t,e){var i=this,a=i.deviceTypeKey,n=new $.Deferred;return t==v.FLOOR_NAV_BUILDING_TOTAL_ID||e===v.FLOOR_NAV_FLOOR_ALL_ID?u.getStatisticByKey(a).done(function(e){i.deviceTabPanel.setStatisticDatasource(m.convertStatistic(t,e)),n.resolve()}).fail(function(){n.reject()}):n.resolve(),n.promise()},getDeviceData:function(e){var t,i=e.viewName,a=e.widget,n=e.registrationStatus,o=e.page,s=e.size,r=e.isRefresh,l=e.thenCallback,d=this.deviceTypeKey;if(o=o||1,s=s||(r?a.dataSource.data().length:50),r&&(this._isScrolling||0==s)){var c=new $.Deferred;return c.resolve(),c.promise()}("map"!=i||"map"==i&&"NotRegistered"==n)&&(t={typeQuery:{page:o,size:s},mappedTypeQuery:{page:o,size:s}});var p=u.getDeviceWithType(d,[n],t,null,this._getFilteredObj());return l&&p.then(l),p},_isPossibleScrolling:function(e,t,i,a){return!(e<=t)&&(!(i<a+1)&&!self._isScrolling)},_appendPaginationData:function(e,t,i){var a,n=t.data().toJSON(),o=i.data,s=o.length;for(a=0;a<s;a++)o[a].selected=!1;i.data=n.concat(o);var r=this.createDataSource(i,t);e.setDataSource(r)},scrollEndEvt:function(e){var i=this,a=e.sender,t=a.pageSize(),n=a.data().length,o=Math.ceil(n/50),s=a.pagingTotalPage,r=a.pagingTotal,l=e.grid;if(i._isPossibleScrolling(r,n,s,o)){i._isScrolling=!0,i.loadingPanel.open();var d=i.getCurrentViewInfo(),c=d.dataViewName,p=d.registrationStatus;i.getDeviceData({page:o+1,size:t,viewName:c,registrationStatus:p,widget:l,thenCallback:function(e){i._appendPaginationData(l,a,e);var t=l.getSelectedData();i.setSelectedDataNum(t),i.loadingPanel.close(),i._isScrolling=!1}})}},getRegisteredDeviceNum:function(){var t,i,e=this,a=e.deviceTypeKey,n=[],o=e.getCurrentViewInfo().dataViewWidget.dataSource,s=e.getCurrentFilter();if($.isArray(s))n.push(u.getDeviceWithType(a,["Registered"],{typeQuery:{page:1,size:5},mappedTypeQuery:{page:1,size:5}},null,e._getFilteredObj()).done(function(e){t=e.total}));else{var r=o.data(),l=new g.data.Query(r).filter(s).toArray();t=l.length}return n.push(u.getDeviceWithType(a,["NotRegistered"],{typeQuery:{page:1,size:5},mappedTypeQuery:{page:1,size:5}},null,e._getFilteredObj()).done(function(e){i=e.total})),$.when.apply(this,n).always(function(){e.setRegisteredNum(t,i)})},setRegisteredNum:function(e,t){var i=this.viewModel;i.registrationStatusButtons[f.REGISTRATION_STATUS_BUTTONS.REGISTER].set("count",e),i.registrationStatusButtons[f.REGISTRATION_STATUS_BUTTONS.UNREGISTER].set("count",t),this.registrationMapList&&(this.registrationMapList.tabViewModel[f.REGISTRATION_STATUS_BUTTONS.REGISTER].set("count",e),this.registrationMapList.tabViewModel[f.REGISTRATION_STATUS_BUTTONS.UNREGISTER].set("count",t))},createDataSource:function(e,t){var i,a;e.data&&(i=e.total,a=Math.ceil(i/50),e=e.data),void 0===e.length&&(e=[]);var n=t,o=this.getCurrentFilter(),s=n.sort(),r=new g.data.DataSource({data:e,pageSize:50});r.read();var l,d,c=new g.data.Query(n.data()).filter({field:"selected",operator:"eq",value:!0}).toArray(),p=c.length;for(d=0;d<p;d++)l=c[d],(l=r.get(l.id))&&(l.selected=!0);return o&&r.filter(o),s&&r.sort(s),r.bind("scrollend",this.scrollEndEvt.bind(this)),r.pagingTotal=i,r.pagingTotalPage=a,r},setSelectedDataNum:function(e){var t=this,i=t.deviceTabPanel,a=0<e.length;i.setEnableActions(!a);var n=t.getFilterViewModel(f.FILTER_NAME.SELECTALL);a?n.set("text",f.TEXT.DESELECTALL):n.set("text",f.TEXT.SELECTALL),t.getActionViewModel(f.ACTION_NAME.SELECTEDTEXT).options.set("selectedText",m.calcScreenBySelect(e,t.getTotalSize(),t.getDisplaySize()))},getTotalSize:function(){var e=this.getCurrentViewInfo(),t=e.innerLayoutName,i=e.dataViewName,a=e.dataViewWidget,n=e.registrationStatus;if("monitoring"!=t){if("map"==i){if("Registered"==n)return a.dataSource.data().length;if(this.registrationMapList)return this.registrationMapList.tabViewModel[f.REGISTRATION_STATUS_BUTTONS.UNREGISTER].get("count")}else if("list"==i)return a.dataSource.pagingTotal}else if("map"==i)return a.dataSource.data().length;return a.dataSource.pagingTotal},getDisplaySize:function(){var e,t,i,a=this.getCurrentViewInfo(),n=a.innerLayoutName,o=a.dataViewName,s=a.dataViewWidget,r=a.registrationStatus,l=s.dataSource,d=this.registrationMapList;if("monitoring"!=n&&("map"==o&&"NotRegistered"==r&&d))return d.tabGrids[f.REGISTRATION_STATUS_BUTTONS.UNREGISTER].dataSource.data().length;return e=l.filter(),t=l.data(),i=new g.data.Query(t),e&&(i=i.filter(e)),(i=i.toArray()).length},onWidgetChangeSelection:function(e){var t=this,i=e.sender.getSelectedData(),a=t.getCurrentViewInfo(),n=a.innerLayoutName,o=a.dataViewName,s=t.registrationMapList,r=t.getActionViewModel(f.ACTION_NAME.REGISTER),l=t.getActionViewModel(f.ACTION_NAME.BLOCK),d=t.getActionViewModel(f.ACTION_NAME.DELETE),c=t.getActionViewModel(f.ACTION_NAME.DETAIL),p=t.getActionViewModel(f.ACTION_NAME.VIEW),u=0<i.length;u&&"map"===o&&s.selectedIndex==f.REGISTRATION_STATUS_BUTTONS.UNREGISTER&&0<s.getSelectedData().length&&s.unselectAll();t.setSelectedDataNum(i),s.selectedIndex==f.REGISTRATION_STATUS_BUTTONS.UNREGISTER&&"registration"==n&&"map"==o?r.options.set("disabled",!0):r.options.set("disabled",!u),l&&l.options.set("disabled",!u),d&&d.options.set("disabled",!u),c.options.set("disabled",!u),p&&(1==i.length?p.options.set("disabled",!u):p.options.set("disabled",!0)),t.onWidgetChangeRegistrationMapList(o,n,i)},onWidgetChangeRegistrationMapList:function(e,t,i){var a=this.registrationMapList;a.unselectAll(),"map"===e&&"monitoring"!=t&&a.selectByData(i)},selectAll:function(){var e,t=this,i=t.getCurrentViewInfo(),a=i.innerLayoutName,n=i.dataViewName,o=i.dataViewWidget;return e="registration"==a&&"map"==n&&t.registrationMapList&&t.registrationMapList.selectedIndex==f.REGISTRATION_STATUS_BUTTONS.UNREGISTER?(t.registrationMapList.selectAll(),t.registrationMapListElement.find(".map-panel-list-container .k-grid-content.no-header .device-map-panel-list-item").each(function(){t.initListDragDropEvt({currentTarget:this})}),t.registrationMapList.getSelectedData()):(o.selectAll(!0),t.registrationMapList&&t.registrationMapList.selectAll(),t.monitoringMapList&&t.monitoringMapList.selectAll(),o.getSelectedData()),t.setSelectedDataNum(e),e},unselectAll:function(){var e=this;e.getCurrentViewInfo().dataViewWidget.unselectAll(),e.registrationMapList&&e.registrationMapList.unselectAll(),e.monitoringMapList&&e.monitoringMapList.unselectAll(),e.setSelectedDataNum([])},getRegisterMapListOptions:function(){var e=this;return{dataSource:[],hasNewDataSource:!1,hasSelectedModel:!0,type:"hybrid",filterTab:[{template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",listStyle:"treeList",widgetOptions:{enableShiftSelection:!0},listOptions:{column:{template:e._mapListRegisteredTabTemplate.bind(e),headerTemplate:v.getCurrentFloorName,groupHeaderTemplate:e._mapListGroupHeaderTemplate.bind(e)},group:[{field:"locations[0].foundation_space_zones_id",aggregate:"count"}]}},{template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",hideHeader:!0,widgetOptions:{scrollable:{virtual:!0}},listOptions:{column:{template:i.mapListRegTemplate},sort:[{field:"name",dir:"asc"}]}}],tabViewModel:[{name:T.prop("FACILITY_DEVICE_REGISTERED"),click:function(){},count:0},{name:T.prop("FACILITY_DEVICE_UNREGISTERED"),click:function(){},count:0}],activateTab:e.activateRegistrationMapListTab.bind(e)}},expandRegistrationMapListTab:function(e){var t=this.getCurrentViewInfo().dataViewWidget.dataSource,i=e.model;return e.sender.setDataSourceExpand(i,t),!1},activateRegistrationMapListTab:function(e){var t,i,a,n=e.index,o=e.sender,s=this,r=s.getCurrentViewInfo(),l=r.innerLayoutName,d=r.dataViewWidget,c=r.registrationStatus,p=s.getActionViewModel(f.ACTION_NAME.REGISTER);s._isSelectingTab=!0,s.loadingPanel.open(),n==f.REGISTRATION_STATUS_BUTTONS.REGISTER?(p.set("text",f.TEXT.DEREGISTER),i=new $.Deferred,a=d.dataSource.data(),i.resolve(a),t=i.promise()):n==f.REGISTRATION_STATUS_BUTTONS.UNREGISTER&&(p.set("text",f.TEXT.REGISTER),t=s.getDeviceData({viewName:"map",layoutName:l,widget:o,registrationStatus:c})),t.always(function(e){if(s._isSelectingTab=!1,e){s.unselectAll();var t=o.dataSource,i=s.createDataSource(e,t);o.setDataSource(i,!1,!0),s.setSelectedDataNum([]),s.loadingPanel.close()}})},onRegistrationMapListChangeSelection:function(e){var t,i=e.sender,a=this.getCurrentViewInfo().dataViewWidget;if(i.selectedIndex==f.REGISTRATION_STATUS_BUTTONS.REGISTER){t=i.getSelectedData(),a.unselectAll();var n,o,s=t.length;for(n=0;n<s;n++)o=t[n],a.selectDevice(o.id,o.selected)}else a.unselectAll(),t=i.getSelectedData();this.setSelectedDataNum(t)},getMonitoringMapListOptions:function(){return null},_mapListRegisteredTabTemplate:function(e){if(e.treeGroup)return this._mapListGroupHeaderTemplate(e);if(e.isDummy)return i.mapListRegTemplate(e);var t=this.getCurrentViewInfo();return i.mapListDualTemplate(e,"monitoring"!==t.innerLayoutName)},_mapListGroupHeaderTemplate:function(e){var t,i,a=this.zoneDataSource.data(),n="-";return i=e.value,(t=new g.data.Query(a).filter({value:i,operator:"eq",field:"id"}).toArray()).length&&(n=t[0].name),n},initListDragDropEvt:function(e){var t=$(e.currentTarget),i=this.registrationMapList,a=i.select(),n=i.getSelectedData(),o=t.find(".detail-img"),s=this.registrationMapView.widget;s.deviceDragDrop({selectedRows:a,deviceIconElem:o,selectedData:n}),s.unbind("drop"),s.bind("drop",this.dropEndDeviceEvt.bind(this))},dropEndDeviceEvt:function(e){var i=this,t=e.devices,a=e.deviceIcon;i.loadingPanel.open(),u.patchDevices(t).done(function(){i.refreshDeviceData(!1).always(function(){})}).fail(function(e){i.loadingPanel.close(),i.registrationMapView.widget._removeDeviceIcon(a);var t=m.getDeviceRegistrationFailMsg(e);_.message(t),_.open()})},dragEndDeviceEvt:function(e){var i=this,t=e.devices;i.loadingPanel.open(),u.patchDevices(t).done(function(){i.refreshDeviceData(!1).always(function(){})}).fail(function(e){i.loadingPanel.close();var t=m.getDeviceRegistrationFailMsg(e);_.message(t),_.open()})},setViewBtnEnabled:function(e,t){var i,a=this.viewModel.viewButtons,n=a.length;for(i=0;i<n;i++)if(a[i].viewName==e){a[i].set("disabled",!t);break}},getCurrentViewInfo:function(){var e=this.tabLayout.curInnerLayoutName,t={innerLayoutName:null,dataViewName:null,registrationStatus:null};if(t.innerLayoutName=e,t.dataViewName=this.deviceTabPanel.currentViewName,t.dataViewWidget=this.deviceTabPanel.currentWidget,"monitoring"==t.innerLayoutName)t.registrationStatus="Registered";else if("registration"==t.innerLayoutName){if("map"==t.dataViewName){var i=this.registrationMapList;t.registrationStatus=i?0===i.selectedIndex?"Registered":"NotRegistered":"Registered"}else if("list"==t.dataViewName){var a,n=this.viewModel.registrationStatusButtons,o=n.length;for(a=0;a<o&&!n[a].active;a++);0==a?t.registrationStatus="Registered":1==a?t.registrationStatus="NotRegistered":2==a&&(t.registrationStatus="Blocked")}}else"block"==t.innerLayoutName&&(t.registrationStatus="Blocked");return t},getFilterWidget:function(e){var t=this.getFilterViewModel(e);if(t){var i=t.type,a=t.id,n="";return"dropdownlist"==i?n="kendoDropDownList":"dropdowncheckbox"==i?n="kendoDropDownCheckBox":"button"==i?n="kendoButton":"combobox"==i&&(n="kendoCombobox"),$("#"+a).data(n)}return null},getLayoutViewModel:function(e){var t,i,a=this.innerLayouts,n=a.length;for(i=0;i<n;i++)if(e==(t=a[i]).layoutName)return t;return null},getFilterViewModel:function(e){var t=this.viewModel.filters;return this._getFilterOrAction(e,t)},getActionViewModel:function(e){var t=this.viewModel.actions;return this._getFilterOrAction(e,t)},_getFilterOrAction:function(e,t){var i,a=t.length;for(i=0;i<a;i++)if(t[i].name==e)return t[i];return null},_getFilteredObj:function(){var t,e=this,i=e.typeFilter&&e.typeFilter[0],a=e.statusFilter,n=e.modeFilter&&e.modeFilter[0],o=e.zoneFilter,s=(i=i&&i.filters&&i.filters[0]||i)?i.value:null,r=[],l=n||{},d=[],c=e.viewModel.searchFieldValue||null;return a.forEach(function(e){"none"!==(t=e.filters?e.filters[0].value:e.value)&&r.push(t)}),o.forEach(function(e){d.push("undefined"!=e.value?e.value:0)}),{type:s,statuses:r,mode:l,zones:d,name:c}},destroy:function(){this.zoneDataSource=new g.data.DataSource({data:[]}),clearInterval(this.refreshInterval),clearTimeout(this.refreshTimeout)}})}),define("asset/monitoring/controller/asset-controller",["asset/core","device/common/controller/base-controller","device/common/device-api","device/common/device-util","device/common/device-constants","device/common/device-template","asset/monitoring/asset-api","asset/monitoring/model/asset-model","asset/monitoring/model/asset-type-model","asset/monitoring/config/popup-config"],function(e,a,m,d,s,t,g,c,p,u){var f=window.kendo,n=window.MAIN_WINDOW,v=window.I18N,_=window.Util,T=u.messageDialog,r=u.confirmDialog,l=u.assetTypePopup,i={Asset:a.extend({initComponent:function(){var e=this.getLayoutViewModel("registration");e&&(this.registrationMapView=e.dataViews.map);var t=this.deviceTypeKey;this.detailPopup=u.getDetailPopup(t);var i=this.getRegisterMapListOptions();this.registrationMapList=this.registrationMapListElement.kendoDeviceTabGroupGrid(i).data("kendoDeviceTabGroupGrid"),(i=this.getMonitoringMapListOptions())&&(this.monitoringMapList=this.monitoringMapListElement.kendoDeviceTabGroupGrid(i).data("kendoDeviceTabGroupGrid"))},onRefreshData:function(){var e=this,t=e.getCurrentViewInfo(),i=t.innerLayoutName,a=t.dataViewWidget,n=t.dataViewName;e.isRefreshing||e.detailPopup&&e.detailPopup.isEditable||(e.loadingPanel.open(a.element),("monitoring"==i||"registration"==i&&"map"==n)&&e.refreshDeviceData(!0).always(function(){e.loadingPanel.close()}))},attachEvent:function(){var e=this;a.fn.attachEvent.call(e),e.monitoringMapList.bind("expand",e.expandRegistrationMapListTab.bind(e)),e.monitoringMapList.bind("change",e.onRegistrationMapListChangeSelection.bind(e)),e.registrationMapListElement.off("click"),e.getActionViewModel(s.ACTION_NAME.ASSET_TYPE).options.set("click",e.clickAssetTypeBtnEvt.bind(e)),l.bind("onDelete",e.deleteAssetTypePopupEvt.bind(e)),e.detailPopup.bind("onDelete",e.deleteDetailPopupEvt.bind(e))},clickRegisterBtnEvt:function(e){var t=this.getCurrentViewInfo(),i=t.registrationStatus,a=t.dataViewName,n=t.dataViewWidget,o=[];o="map"==a&&"NotRegistered"==i?this.registrationMapList.getSelectedData():n.getSelectedData(),this.openDetailPopup(o,"register",!0)},clickDeleteBtnEvt:function(e){var l=this,t=l.getCurrentViewInfo(),i=t.registrationStatus,a=t.dataViewName,n=t.dataViewWidget,d=t.innerLayoutName,o=e.results,c=e.sender,p=[];o?p=o:"map"==a&&"NotRegistered"==i?l.registrationMapList&&(p=l.registrationMapList.getSelectedData()):p=n.getSelectedData();var s=v.prop("FACILITY_DEVICE_DELETE_CONFIRM"),u=v.prop("SERVICE_ASSET_DELETE_DEVICE_RESULT");"monitoring"==d&&(s=v.prop("SERVICE_ASSET_DELETE_CONFIRM"),u=v.prop("SERVICE_ASSET_DELETE_RESULT")),r.message(s),r.setConfirmActions({yes:function(){l.loadingPanel.open();var e,t,i,a,n,o=[],s=[],r=p.length;for(i=0;i<r;i++)e=p[i],o.push(e.id),(t=e.devices)&&t[0]&&(t=t[0],s.push(t.dms_deivces_id));"monitoring"==d?(a=g.deleteAssets,n=o):"registration"==d&&(a=m.deleteDevices,n=s),a(n).always(function(){c&&c.close&&c.close(),l.refreshDeviceData(!1).always(function(){l.loadingPanel.close(),T.message(u),T.open()})})}}),r.open()},clickAssetTypeBtnEvt:function(e){var t=this;g.getAssetTypes().done(function(e){e=p.createAssetTypePopupModel(e),l.setDataSource(e),l.open(),l.grid.bind("change",t.changeAssetTypeListEvt.bind(t))}).fail(function(e){var t=_.parseFailResponse(e);T.message(t),T.open()})},changeAssetTypeListEvt:function(e){var t=e.item;if(t){var i,a=t.subAssetTypes,n=l.contentViewModel.subAssetTypes,o=a.length;for(i=0;i<o;i++)a[i].set("checked",t.selected),n&&n[i].set("checked",t.selected)}},deleteAssetTypePopupEvt:function(e){var t=this,i=e.results;if(i.length<1)return T.message(v.prop("SERVICE_ASSET_TYPE_DELETE_NO_SELECT")),void T.open();r.message(v.prop("SERVICE_ASSET_TYPE_DELETE_CONFIRM")),r.setConfirmActions({yes:function(){t.loadingPanel.open(l.element),g.patchAssetTypes(i).done(function(){var e=v.prop("SERVICE_ASSET_TYPE_DELETE_RESULT");T.message(e),T.open()}).fail(function(e){var t=_.parseFailResponse(e);T.message(t),T.open()}).always(function(){var e=p.createAssetTypePopupModel(i);l.setDataSource(e),t.loadingPanel.close()})}}),r.open()},deleteDetailPopupEvt:function(e){var t=e.results?e.results:[e.result];e.results=t,this.clickDeleteBtnEvt(e)},patchInDetailPopupEvt:function(e){var i=this,t=e.hideMessagePopup,a=e.sender,n=e.results?e.results:[e.result];if(n){var o,s=a.dialogType;i.loadingPanel.open(a.element),o="register"==s?g.postAssets:g.patchAssets;var r=c.getAssetDeviceInfo(n,s),l=[];l.push(o(n)),r.length&&l.push(m.patchDevices(r)),$.when.apply(this,l).done(function(){var e;a.success(),i.loadingPanel.close(),"register"==s?(e=v.prop("FACILITY_DEVICE_REGISTER_RESULT"),a.close(),T.message(e),T.open()):(e=v.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED"),T.message(e),t||T.open(a.element)),i.loadingPanel.open(),i.refreshDeviceData(!1).always(function(){i.loadingPanel.close()})}).fail(function(e){a.fail(),i.loadingPanel.close();var t=d.getDeviceRegistrationFailMsg(e);T.message(t),T.open(a.element)})}},clickRegisterInRegistration:function(e){a.fn.clickRegisterInRegistration.call(this),this.getActionViewModel(s.ACTION_NAME.REGISTER).set("text",s.TEXT.REGISTER)},attachFilterEvt:function(){var n=this;a.fn.attachFilterEvt.call(n),n.getFilterViewModel(s.FILTER_NAME.STATUS).options.set("select",function(e){var t=n.getCurrentViewInfo().innerLayoutName,i=n.statusFilter=[],a=e.dataItem.value;""!==a&&("monitoring"==t?i.push({field:"devices",operator:function(e,t){if(""==t)return!0;if(!e||!e.length)return"Normal"==t;var i,a=e.length;for(i=0;i<a;i++)if(e[i].dms_devices_representativeStatus==t)return!0},value:a}):i.push(d.filter0Depth("representativeStatus","eq",a))),n.applyCurrentFilter()}),n.getFilterViewModel(s.FILTER_NAME.ASSET_TYPE).options.set("select",function(e){var t=n.typeFilter=[],i=e.dataItem.id;""!==i&&t.push(d.filter0Depth("assets_types_id","eq",i)),n.applyCurrentFilter()}),n.getFilterViewModel(s.FILTER_NAME.TYPE).options.set("select",function(e){var t=n.modeFilter=[],i=e.dataItem.value;""!==i&&t.push(d.filter0Depth("mobilityType","eq",i)),n.applyCurrentFilter()})},openDetailPopup:function(e,t,i){var a,n,o=this,s=e.length,r=o.getCurrentViewInfo().innerLayoutName;if(t="registration"==r?"register":null,o.detailPopup.setDialogType(t),s){o.loadingPanel.open();var l=[];g.getAssetTypes().done(function(e){l=p.createAssetTypePopupModel(e)}).fail(function(e){var t=_.parseFailResponse(e);T.message(t),T.open()}).always(function(){for(u.setAssetTypes(l),n=[],a=0;a<s;a++)n.push(e[a].id);("monitoring"==r?g.getAssetWithMultipleID:m.getDeviceWithMultipleID)(n).done(function(e){"registration"==r&&(e=c.convertBeaconToAssetModel(e)),new f.data.DataSource({data:e,pageSize:50}).read(),o.detailPopup.setDataSource(e),o.detailPopup.open(t),i&&o.detailPopup.buttons[4].click()}).always(function(){o.loadingPanel.close()})})}},onMonitoringLayout:function(){var e=this;a.fn.onMonitoringLayout.call(e),e.monitoringMapList.hideTab(!0),e.getActionViewModel(s.ACTION_NAME.DELETE).options.set("invisible",!1),e.getFilterViewModel(s.FILTER_NAME.ASSET_TYPE).options.set("invisible",!1),e.getFilterViewModel(s.FILTER_NAME.TYPE).options.set("invisible",!1)},onRegistrationLayout:function(){var e=this,t=a.fn.onRegistrationLayout.call(e);return e.registrationMapList.hideTab(!1),e.getActionViewModel(s.ACTION_NAME.DELETE).options.set("invisible",!1),e.getFilterViewModel(s.FILTER_NAME.ASSET_TYPE).options.set("invisible",!0),e.getFilterViewModel(s.FILTER_NAME.TYPE).options.set("invisible",!0),t},onChangeDataView:function(e,t,i){a.fn.onChangeDataView.call(this,e,t,i),"map"==t&&("monitoring"==e?i.setOptions({isRegisterView:!1,canDragDeviceIcon:!1}):"registration"==e&&i.setOptions({isRegisterView:!0,canDragDeviceIcon:!1})),this.getActionViewModel(s.ACTION_NAME.REGISTER).set("text",s.TEXT.REGISTER)},setSelectedDataNum:function(e){a.fn.setSelectedDataNum.call(this,e),this.getActionViewModel(s.ACTION_NAME.ASSET_TYPE).options.set("disabled",!1)},onWidgetChangeRegistrationMapList:function(e,t,i){if("map"===e)if("monitoring"==t)this.monitoringMapList.selectByData(i);else if("registration"==t){this.registrationMapList.selectByData(i)}},selectAll:function(){var e,t=this,i=t.getCurrentViewInfo(),a=i.innerLayoutName,n=i.dataViewName,o=i.dataViewWidget;return e="registration"==a&&"map"==n&&t.registrationMapList&&t.registrationMapList.selectedIndex==s.REGISTRATION_STATUS_BUTTONS.UNREGISTER?(t.registrationMapList.selectAll(),t.registrationMapList.getSelectedData()):(o.selectAll(!0),t.registrationMapList&&t.registrationMapList.selectAll(),t.monitoringMapList&&t.monitoringMapList.selectAll(),o.getSelectedData()),t.setSelectedDataNum(e),e},getDeviceData:function(e){var t,i,a=e.viewName,n=e.widget,o=e.registrationStatus,s=e.page,r=e.size,l=e.isRefresh,d=e.thenCallbackFunc,c=this.getCurrentViewInfo().innerLayoutName;if(s=s||1,r=r||(l?n.dataSource.data().length:50),!l||!this._isScrolling&&0!=r)return("map"!=a||"map"==a&&"NotRegistered"==o)&&(t={typeQuery:{page:s,size:r},mappedTypeQuery:{page:s,size:r}}),i="registration"==c?m.getDeviceWithType("Beacon",[o],t):g.getAssets(),d&&i.then(d),i;var p=new $.Deferred;return p.resolve(),p.promise()},getStatisticData:function(t,e){var i=this,a=new $.Deferred;return t==n.FLOOR_NAV_BUILDING_TOTAL_ID||e===n.FLOOR_NAV_FLOOR_ALL_ID?g.getStatistic().done(function(e){i.deviceTabPanel.setStatisticDatasource(d.convertStatistic(t,e)),a.resolve()}).fail(function(){a.reject()}):a.resolve(),a.promise()},getRegisteredDeviceNum:function(){var t,i,e=this,a=[],n=e.getCurrentViewInfo().dataViewWidget.dataSource,o=e.getCurrentFilter();if($.isArray(o))a.push(m.getDeviceWithType("Beacon",["Registered"],{typeQuery:{page:1,size:5},mappedTypeQuery:{page:1,size:5}}).done(function(e){t=e.total}));else{var s=n.data(),r=new f.data.Query(s).filter(o).toArray();t=r.length}return a.push(m.getDeviceWithType("Beacon",["NotRegistered"],{typeQuery:{page:1,size:5},mappedTypeQuery:{page:1,size:5}}).done(function(e){i=e.total})),$.when.apply(this,a).always(function(){e.setRegisteredNum(t,i)})},getCurrentFilter:function(){var e=this,t=[],i=e.getCurrentViewInfo(),a=i.dataViewName,n=i.registrationStatus,o=i.innerLayoutName;if("registration"==o&&"list"==a&&"NotRegistered"==n)return[];t=d.getAccureFilter(t,e.typeFilter,e.statusFilter,e.zoneFilter,e.modeFilter);var s=e.viewModel.get("searchFieldValue");if(s&&("monitoring"==o?t.filters.push(d.filter0Depth("assets_types_name","contains",s)):"registration"==o&&t.filters.push(d.filter0Depth("name","contains",s))),0==t.filters.length&&(t=[]),"registration"==o){var r=d.filterHasListAttrItem("assets",!1);t.filters?t.filters.push(r):$.isArray(t)&&(t=r)}return t},_mapListAssetTabTemplate:function(e){return e.treeGroup?this._mapListGroupHeaderTemplate(e):t.assetMapListRegTemplate(e)},getTotalSize:function(){var e=this.getCurrentViewInfo(),t=e.innerLayoutName,i=e.dataViewName,a=e.dataViewWidget,n=e.registrationStatus;if("monitoring"!=t){if("map"==i){if("Registered"==n)return new f.data.Query(a.dataSource.data()).filter(d.filter0Depth("assets[0]","eq",void 0)).toArray().length;if(this.registrationMapList)return this.registrationMapList.tabViewModel[s.REGISTRATION_STATUS_BUTTONS.UNREGISTER].get("count")}else if("list"==i)return a.dataSource.pagingTotal}else if("map"==i)return a.dataSource.data().length;return a.dataSource.pagingTotal},getMonitoringMapListOptions:function(){var e=this;return{dataSource:[],hasNewDataSource:!1,hasSelectedModel:!0,type:"hybrid",filterTab:[{template:"<span data-bind='text: name'></span><span>(<span data-bind='text: count'></span>)</span>",listStyle:"treeList",listOptions:{column:{template:e._mapListAssetTabTemplate.bind(e),headerTemplate:n.getCurrentFloorName,field:"location.foundation_space_zones_id",groupHeaderTemplate:e._mapListGroupHeaderTemplate.bind(e)},group:[{field:"location.foundation_space_zones_id",aggregate:"count"}]}}],tabViewModel:[{name:v.prop("FACILITY_DEVICE_REGISTERED"),click:function(){},count:0}],activateTab:e.activateRegistrationMapListTab.bind(e)}},activateRegistrationMapListTab:function(e){a.fn.activateRegistrationMapListTab.call(this,e),this.getActionViewModel(s.ACTION_NAME.REGISTER).set("text",s.TEXT.REGISTER)}})};return{getAssetController:function(e){var t=i[e];return t||console.error("There is no controller for type : "+e),t}}}),define("asset/monitoring/monitoring",["asset/core","asset/monitoring/config/asset-config","device/common/device-api","device/common/device-util","asset/monitoring/controller/asset-controller","asset/monitoring/asset-api","asset/monitoring/model/asset-model","asset/monitoring/model/asset-type-model","device/common/device-constants"],function(e,t,i,a,n,o,s,r,l){"use strict";var d,c,p,u=$("#device-tab-panel"),m=window.CommonLoadingPanel,g=window.MAIN_WINDOW,f=window.Util,v=new m,_=$("<div/>"),T=function(){},E=function(e){v.close();var t=e.tabLayout.key,i=n.getAssetController(t);i&&(p=new i(e)),p.onFloorChanged(g.getCurrentFloor())},b=function(e){p&&p.destroy(e)},I=function(e){p&&p.onFloorChanged(e)};!function(){v.open(),c=_.kendoCommonDialog().data("kendoCommonDialog");var a=t.getTabConfigList();o.getAssetTypes().done(function(e){var t,i=a.length;for(t=0;t<i;t++)if("Asset"==a[t].key){a[t].viewModel.filters[l.ASSET_FILTER.TYPE].options.dataSource=e;break}}).fail(function(e){var t=f.parseFailResponse(e);c.message(t),c.open()}).always(function(){(d=u.kendoDeviceTabPanel({tabLayouts:a}).data("kendoDeviceTabPanel")).bind("activate",E),d.bind("select",T),d.bind("destroy",b),setTimeout(function(){e.on("onfloorchange",I)},500),d.selectTab(0)})}()});