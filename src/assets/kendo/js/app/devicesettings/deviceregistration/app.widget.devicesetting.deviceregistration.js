!function(c,A){"use strict";var M=c.kendo,u=M.ui.Widget,a=!1,t=u.extend({options:{name:"DeviceTabPanel",events:["beforeChangeInnerLayout","changeInnerLayout","changeDataLayout","select","destroy","activate"],template:"",firstActiveTabIdx:0,callbacks:{complete:null,error:null},tabLayout:[]},init:function(t,e){var i=this,a=c.CommonLoadingPanel;e=A.extend(!0,{},i.options,e),u.fn.init.call(i,t,e),e=i.options;var n=A(t);this.loading=new a(t);var o,s,d=e.tabLayouts,l=[],r=d.length;for(i.tabLayout||(i.tabLayout=[]),s=0;s<r;s++)(o={}).name=d[s].name,o.key=d[s].key,o.content=" ",l.push(o),i.tabLayout.push(o);i.tabStrip=n.kendoCommonTabStrip({dataTextField:"name",dataContentField:"content",dataSource:l}).data("kendoCommonTabStrip"),i.tabStrip.bind("select",i._tabSelectEvt.bind(i)),i.tabStrip.bind("activate",i._onContentLoad.bind(i))},_tabSelectEvt:function(t){var e=this,i=e.tabStrip.select(),a=A(i).index(),n=e.tabStrip.contentElement(a),o=t.item,s=A(o).index();i!==o&&a!==s&&-1!=a&&e._removeBeforeContent(i,n,a),e.trigger("tabSelect",t)},_removeBeforeContent:function(t,e,i){M.unbind(e,this.currentViewModel);var a=this.tabLayout[i];a.layout=null,a.router.destroy();var n,o,s,d,l=a.innerLayout;for(d=l.length-1;0<=d;d--){for(n in s=l[d].dataViews)(o=s[n])&&(o.widget&&o.widget.destroy(),o.widgetElem&&o.widgetElem.remove(),o.view&&o.view.destroy());l.pop()}a.innerLayout=null,this.actionWidgets.length,this.filterWidgets.length,this.currentViewModel=null,this.currentWidget=null,this.currentViewName=null,this.unbind("beforeChangeInnerLayout"),this.unbind("changeInnerLayout"),this.unbind("changeDataLayout");var r={destroyedTabElem:t=A(t),destroyedTabIndex:i,destroyedTabContent:e=A(e)};this.trigger("destroy",r),e.empty()},_onContentLoad:function(t){var e=this,i=t.item,a=A(i).index(),n=A(t.contentElement);n.html('<script id="device-panel-filters-template" type="text/x-kendo-template"><li data-bind="invisible : options.invisible, attr: { class: liClassName }">#if(type == "dropdownlist"){#<input id="#=id#" data-role="dropdownlist" data-option-label="#=options.optionLabel#" data-auto-bind="#=options.autoBind#" data-animation="#=options.animation#" data-auto-width="#=options.autoWidth#" data-text-field="#=options.dataTextField#" data-value-field="#=options.dataValueField#" data-bind="value : options.value, source: options.dataSource, invisible: options.invisible, disabled : options.disabled, events: { change: options.change, open: options.open, close: options.close, select : options.select}"/>#}else if(type == "dropdowncheckbox"){#<input id="#=id#" data-auto-bind="#=options.autoBind#" data-role="dropdowncheckbox" data-text-field="#=options.dataTextField#" data-value-field="#=options.dataValueField#" data-select-all-text="#=options.selectAllText#" data-empty-text="#=options.emptyText#" data-is-able-unselect-all="#=options.isAbleUnselectAll#" data-bind="source: options.dataSource, invisible: options.invisible, disabled : options.disabled, events: { change: options.change, open: options.open, close: options.close, select : options.select, selectionChanged : options.selectionChanged }"/>#}else if(type == "button"){#<button id="#=id#" data-role="button" data-bind="events:{ click : options.click }, disabled : options.disabled, invisible: options.invisible"><span data-bind="text: text"></span></button>#}else if(type=="combobox"){#<input id="#=id#" data-role="combobox" data-option-label="#=options.optionLabel#" data-auto-bind="#=options.autoBind#" data-animation="#=options.animation#" data-auto-width="#=options.autoWidth#" data-text-field="#=options.dataTextField#" data-value-field="#=options.dataValueField#" data-bind="source: options.dataSource, visible: options.isVisible, disabled : options.disabled, events: { change: options.change, open: options.open, close: options.close, select: options.select}"/>#}else if(type="template"){##=template##}#</li><\/script><script id="device-panel-layout-buttons-template" type="text/x-kendo-template"><li data-bind="invisible : invisible"><button type="button" data-bind="css:{active : active}, text : name, events:{click : click}"></button></li><\/script><script id="device-panel-view-buttons-template" type="text/x-kendo-template"><li><button type="button" data-bind="disabled : disabled, attr: { data-view : viewName, class: buttonClass }, css:{active : active}, events:{click:click}"></button></li><\/script><script id="device-panel-registration-status-buttons-template" type="text/x-kendo-template"><li data-bind="css:{on : active}"><button type="button" data-bind="events:{click : click}, disabled: disabled"><span data-bind="text: name"></span> (<span data-bind="text: count">0</span>)</button></li><\/script><div class="device-container"><div class="type-tab-area"><div class="left"><ul class="view-button device-panel-layout-buttons" data-template="device-panel-layout-buttons-template" data-bind="source: innerLayoutButtons"></ul></div><div class="right"><ul class="tab-view-list device-panel-view-buttons" data-template="device-panel-view-buttons-template" data-bind="source: viewButtons"></ul><div class="search-box" data-bind="invisible: hideSearch"><input data-bind="attr:{placeholder : searchFieldPlaceHolder}, enabled: enableSearch, value : searchFieldValue, events : { keydown : searchKeyDown }" type="text" class="k-textbox" placeholder="Enter search terms"><button class="search-btn ic ic-bt-input-search" data-bind="enabled: enableSearch, events : { click : searchClick }">Search</button></div></div></div><div class="tab-area-select" data-bind="invisible:hideSelectArea"><div class="left" data-bind="invisible:hideFilterArea"><div class="device-panel-layout-filters"><ul class="device-panel-layout-filters-list" data-template="device-panel-filters-template" data-bind="source:filters"></ul></div></div><div class="right" data-bind="invisible:hideActionArea"><ul class="device-panel-layout-actions-list" data-template="device-panel-filters-template" data-bind="source:actions"></ul></div></div><div class="device-content-wrapper" data-bind="css:{no-action-area:hideSelectArea}"><div class="device-registration-buttons-area" data-bind="invisible:hideRegisterArea"><div class="left"><ul class="view-button" data-template="device-panel-registration-status-buttons-template" data-bind="source:registrationStatusButtons"></ul></div></div><div class="device-panel-render-spa" data-bind="css:{no-register-area:hideRegisterArea}"><div class="device-panel-data-render-layout"><div class="control-panel" data-bind="invisible:hideRightPanel, css:{ no-map-panel : hideMapPanel}"><div class="device-control-panel" data-bind="invisible:hideControlPanel"></div><div class="map-panel" data-bind="invisible:hideMapPanel"><div class="device-monitoring-map-panel" data-bind="invisible:hideMonitoringMapPanel"></div><div class="device-registration-map-panel" data-bind="invisible:hideRegistrationMapPanel"></div></div><div class="device-light-control-panel" data-bind="invisible:hideLightControlPanel"><div class="group-control-dialog-control groupControl"><div class="controllerList noarr"><div class="horzline"></div><div class="typename" data-bind="text:lightPanel.lightingText"></div><div class="innerBox"><div class="innerSet"><button type="button" class="controlBtn k-button" data-bind="events:{click:lightPanel.power.click}, css:{selected:lightPanel.power.active}, invisible:lightPanel.power.invisible"><span class="icwrap"><i class="ic power"></i><span data-bind="visible:lightPanel.power.active">ON</span><span data-bind="visible:lightPanel.power.mixed">/ OFF</span><span data-bind="invisible:lightPanel.power.active">OFF</span></span></button><p class="bluetit" data-bind="invisible:lightPanel.dimmingLevel.invisible, text:lightPanel.brightnessText"></p><div class="tb slider" data-bind="invisible:lightPanel.dimmingLevel.invisible"><div class="tbc"><div class="customSlider"><input style="width:160px;" data-bind="value:lightPanel.dimmingLevel.value,events:{slide:lightPanel.dimmingLevel.slide}" data-role="slider" data-show-buttons="false" data-tooltip="{enabled:false, format:\'{0}\'}" data-tick-placement="none" data-min="0" data-max="100" data-small-step="1" data-large-step="1"/><span class="valTxt"><span data-bind="text:lightPanel.dimmingLevel.value"></span>%</span></div></div></div><div class="no-selected-light" data-bind="invisible:lightPanel.noSelected, text: lightPanel.noSelectedText"></div></div></div></div></div></div></div><div class="device-panel-data-render-view" data-bind="css:{no-control-panel:hideRightPanel, no-map-panel:hideMapPanel, no-control:hideControlPanel, no-light:hideLightControlPanel}"></div></div></div></div></div>');var o=e.options.tabLayouts[a],s=e.tabLayout[a],d=n.find(".device-container"),l=o.innerLayout;o.viewModel||(o.viewModel={}),s.innerLayout||(s.innerLayout=[]);var r=d.find(".device-panel-data-render-view");s.routeUrl=o.routeUrl,s.router=new M.Router,s.layout=new M.Layout("<div id='device-data-content' class='device-data-content'></div>"),s.router.bind("init",e._routerInit.bind(s,r)),s.router.bind("back",e._routerBack);var c,u,v,b,p,h,g,f,w,y,m,L,x,V=s.innerLayout,S=l.length;if(f=o.viewModel.viewButtons)for(x=f.length,m=0;m<x;m++)f[m].click=e._dataLayoutBtnEvt.bind(e);for((v=A.extend(!0,{},o.viewModel)).innerLayoutButtons||(v.innerLayoutButtons=[]),m=0;m<S;m++)for(L in c=V[m]={},g=v.innerLayoutButtons[m]={},u=l[m],g.index=c.index=m,g.name=c.name=u.name,g.active=c.active=u.active,g.disabled=c.disabled=u.disabled,g.invisible=c.invisible=u.invisible,g.layoutName=c.layoutName=u.layoutName,g.click=e._innerLayoutBtnEvt.bind(e),c.routeUrl=u.routeUrl,c.defaultView=u.defaultView,c.dataViews={},b=u.dataLayout){if(p=b[L],h=c.dataViews[L]={},p.widget)h.widgetElem=A("<div/>"),p.widgetOptions||(p.widgetOptions={}),w=new p.widget(h.widgetElem,p.widgetOptions),h.widget=w,h.view=new M.View(w.wrapper);else p.template?(h.template=p.template,h.view=new M.View(p.template)):h.view=new M.View(A("<div/>").text("There is no defined view."));y=h.routeUrl=o.routeUrl+u.routeUrl+p.routeUrl,s.router.route(y,e._routerEvt.bind(s,"#device-data-content",h.view))}var C=void 0!==o.firstActiveInnerLayoutIndex?o.firstActiveInnerLayoutIndex:0,k=V[C];e.currentViewModel=M.observable(v),M.bind(d,e.currentViewModel),e.currentViewModel.innerLayoutButtons[C].set("active",!0),s.curInnerLayoutIndex=C,s.curInnerLayoutName=k.layoutName,e._getCurrentFilters(d),e._getCurrentActions(d),e._getCurrentSearch(d),s.router.start();var T={};T.actions=e.actionWidgets,T.filters=e.filterWidgets,T.search=e.searchWidgets;var I={selectedTabIndex:a,contentElement:n,innerLayouts:V,tabLayout:s,firstActiveInnerLayout:k,viewModel:e.currentViewModel};e.trigger("activate",I)},_getCurrentSearch:function(t){var e=t.find(".search-box"),i=e.find(".k-textbox"),a=e.find(".search-btn"),n=[];return n.push(i),n.push(a),this.searchWidgets=n},_getCurrentFilters:function(t){var e=t.find(".device-panel-layout-filters-list"),n=[],o=this.currentViewModel.filters;return e.find(" > li").each(function(t){var e,i=A(this).find("#"+o[t].id),a=i.data("role");e="dropdownlist"==a?i.data("kendoDropDownList"):"dropdowncheckbox"==a?i.data("kendoDropDownCheckBox"):"button"==a?i.data("kendoButton"):"combobox"==a?i.data("kendoCombobox"):i,n.push(e)}),this.filterWidgets=n},_getCurrentActions:function(t){var e=t.find(".device-panel-layout-actions-list"),n=[],o=this.currentViewModel.actions;return e.find("li").each(function(t){var e,i=A(this).find("#"+o[t].id),a=i.data("role");e="dropdownlist"==a?i.data("kendoDropDownList"):"button"==a?i.data("kendoButton"):"combobox"==a?i.data("kendoCombobox"):i,n.push(e)}),this.actionWidgets=n},_getDefaultViewName:function(t){var e,i=t.length;for(e=0;e<i;e++)if(!t[e].disabled)return t[e].viewName},_routerInit:function(t){this.router.replace(this.routeUrl,!0),this.layout.render(t)},_routerBack:function(t){t.to&&2==t.to.split("/").length&&c.history.go(-1);c.history.go(0)},_routerEvt:function(t,e){this.layout.showIn(t,e)},_setViewModel:function(t){var e;for(e in t)this.currentViewModel.set(e,t[e])},_innerLayoutBtnEvt:function(t){if("BUTTON"==t.target.nodeName){var e=A(t.target),i=e.closest("li").index();if(e.hasClass("active"))return;var a=this.getActiveTabLayout().innerLayout[i],n=this.tabStrip.select().index(),o=this.tabStrip.contentElement(n),s=this._getCurrentFilters(A(o)),d=this._getCurrentActions(A(o)),l={viewModel:this.currentViewModel,innerLayout:a,actions:d,filters:s,index:i};if(this.trigger("beforeChangeInnerLayout",l))return;this.changeInnerLayout(i)}},_dataLayoutBtnEvt:function(t,e){if("BUTTON"==t.target.nodeName){a=!!t.originalEvent;var i=A(t.target);if(i.hasClass("active"))return;e=i.data("view")||e,this.changeDataLayout(e)}},clickViewButton:function(t){this.element.find(".device-panel-view-buttons").eq(t).click()},isOriginalClick:function(){return a},getActiveTabLayout:function(){var t=this.tabStrip.select().index();return this.tabLayout[t]},getActiveInnerLayout:function(){var t=this.getActiveTabLayout(),e=t.curInnerLayoutIndex;return t.innerLayout[e]},changeInnerLayout:function(t){var e,i,a,n=this.currentViewModel.innerLayoutButtons,o=n.length;if(isNaN(t))for(e=0;e<o;e++)(a=n[e]).layoutName!=t||a.disabled?a.set("active",!1):(t=e,(i=a).set("active",!0));else for(e=0;e<o;e++)a=n[e],e!=t||a.disabled?a.set("active",!1):(i=a).set("active",!0);if(i){var s=this.getActiveTabLayout(),d=s.innerLayout[t];s.curInnerLayoutIndex=t,s.curInnerLayoutName=d.layoutName;var l=this.tabStrip.select().index(),r=this.tabStrip.contentElement(l),c=this._getCurrentFilters(A(r)),u=this._getCurrentActions(A(r)),v={viewModel:this.currentViewModel,innerLayout:d,actions:u,filters:c,index:t};this.trigger("changeInnerLayout",v)}else console.error("there is no valid view button for "+t)},changeDataLayout:function(t){var e=this.getActiveTabLayout(),i=this.getActiveInnerLayout(),a=i.dataViews[t];if(!a){var n;for(n in console.info("view has "+i.defaultView+" not found in dataLayout options."),i.dataViews)if(i.dataViews[n]){a=i.dataViews[n],t=n;break}if(!a)return}var o,s,d,l=this.currentViewModel.viewButtons,r=l.length;for(o=0;o<r;o++)d=l[o],l[o].viewName!=t||l[o].disabled?d.set("active",!1):(s=d).set("active",!0);if(s){e.router.navigate(a.routeUrl);var c={innerLayout:i,widget:a.widget,view:a,viewName:t};this.currentViewName=t,this.currentWidget=a.widget,this.trigger("changeDataLayout",c),a.widget&&a.widget._setContentHeight&&a.widget._setContentHeight()}else console.error("there is no valid view button for "+t)},setDefaultView:function(t,e){this.getActiveTabLayout().innerLayout[t].defaultView=e},getPanelDom:function(){var t=this.tabStrip.select().index(),e=this.tabStrip.contentElement(t);return A(e).find(".control-panel")},getFilterWidgets:function(){return this.filterWidgets},getActionWidgets:function(){return this.actionWidgets},getViewWidgets:function(t){var e,i=this.getActiveTabLayout(),a=(t?i.innerLayout[t]:this.getActiveInnerLayout()).dataViews,n={};for(e in a)n[e]=a[e].widget;return n},getAllViewWidgets:function(){var t,e,i,a,n,o=[],s=this.getActiveTabLayout().innerLayout,d=s.length;for(t=0;t<d;t++){for(e in a={},(n=s[t]).dataViews)i=n.dataViews[e],a[e]=i.widget;o.push(a)}return o},getViewModel:function(){return this.currentViewModel},getViewRouter:function(){for(var t=this.currentViewModel.get("viewButtons"),e=t.length,i=0;i<e;i++)if(t[i].active)return i},setViewModel:function(t){var e;for(e in t)this.currentViewModel.set(e,t[e])},setViewButtons:function(t){var e,i=this.currentViewModel.get("viewButtons"),a=t.length;for(e=0;e<a;e++)i[e].set(t[e])},setEnableViewBtnList:function(){var t=this.currentViewModel.get("viewButtons");if(2===arguments.length)t[arguments[0]].set("disabled",arguments[1]);else if(1===arguments.length)for(var e=t.length,i=0;i<e;i++)t[i].set("disabled",arguments[0][i])},setEnableActions:function(){var t=this.currentViewModel.actions;if(2===arguments.length)t[arguments[0]].options.set("disabled",arguments[1]);else if(1===arguments.length)for(var e=t.length,i=0;i<e;i++)t[i].options.set("disabled",arguments[0])},setEnableActionsWithList:function(t){var e,i,a=this.currentViewModel.actions,n=t.length;for(e=0;e<n;e++)i=t[e],a[e].options.set("disabled",i)},setInvisibleZoneFilter:function(t){this.currentViewModel.filters[3].options.set("invisible",t)},setDisableZoneFilter:function(t){this.currentViewModel.filters[3].options.set("disabled",t)},selectTab:function(t){this.tabStrip.select(t)},setStatisticDatasource:function(t){var e=this.getActiveTabLayout();if(e){var i=e.innerLayout;if(i){var a,n,o,s,d=i.length;for(a=0;a<d;a++)(n=i[a].dataViews.statistic)&&(o=n.widget)&&o.setDataSource&&(s=new M.data.DataSource({data:t}),o.setDataSource(s))}else console.info("Current Tab is not initialized to set widget datasource in data views.")}else console.info("Current Tab is not initialized to set widget datasource in data views.")},setZoneDatasource:function(t,e){var i=this.getActiveTabLayout();if(i){var a=i.innerLayout;if(a){var n,o,s,d=a.length;for(n=0;n<d;n++)(o=a[n].dataViews.map)&&(s=o.widget)&&s.setZoneDataSource&&s.zoneDataSource&&(s.setFloor(e),s.setZoneDataSource(t))}else console.info("Current Tab is not initialized to set widget datasource in data views.")}else console.info("Current Tab is not initialized to set widget datasource in data views.")},removeItemAllDataSource:function(t,e){var i=this.getActiveTabLayout();if(i){var a=i.innerLayout;if(a){var n,o,s=a.length;if(void 0!==e)n=a[e],this.removeItemInnerLayout(t,n);else for(o=0;o<s;o++)n=a[o],this.removeItemInnerLayout(t,n)}else console.info("Current Tab is not initialized to set widget datasource in data views.")}else console.info("Current Tab is not initialized to set widget datasource in data views.")},removeItemInnerLayout:function(t,e){var i,a,n;for(i in e.dataViews)"statistic"!==i&&(a=e.dataViews[i].widget)&&a.dataSource&&(n=a.dataSource.get(t))&&a.dataSource.remove(n)},setViewWidgetDatasource:function(t,e,i){var a=this.getActiveTabLayout();if(a){var n=a.innerLayout;if(n){var o,s,d=n.length;if(void 0!==i)o=n[i],this.setInnerLayoutDataSource(t,e,o);else for(s=0;s<d;s++)o=n[s],this.setInnerLayoutDataSource(t,e,o)}else console.info("Current Tab is not initialized to set widget datasource in data views.")}else console.info("Current Tab is not initialized to set widget datasource in data views.")},setInnerLayoutDataSource:function(t,e,i){var a,n,o;for(a in i.dataViews)"statistic"!==a&&(n=i.dataViews[a].widget)&&n.setDataSource&&((o=new M.data.DataSource({data:t})).read(),e&&o.sort(e),n.setDataSource(o))}});M.ui.plugin(t)}(window,jQuery);