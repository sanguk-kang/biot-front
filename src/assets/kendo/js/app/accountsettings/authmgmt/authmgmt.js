define("accountsettings/authmgmt/config/authmgmt-vm",[],function(){"use strict";var e=window.kendo,o=window.I18N;return{AuthViewModel:e.observable({btnSave:{text:o.prop("COMMON_BTN_SAVE"),disabled:!0,click:function(){}}})}}),define("accountsettings/authmgmt/account-authmgmt",[],function(){var i,n,e,o,t,r,m,s,a,p,u,c,S,T,I=window.kendo,N=window.I18N,l=window.moment,d=window.Util,_=window.MAIN_WINDOW,E=new window.CommonLoadingPanel,g=["Dashboard","HMI","Device","Device-All","Device-AirConditioner.Indoor","Device-AirConditionerOutdoor","Device-Sensor.Temperature_Humidity","Device-Light","Device-Sensor.Motion","Device-ControlPoint","Device-Meter","Device-Gateway","Device-Beacon","Device-CCTV","Device-SmartPlug","Device-Etc","Operation","Operation-Alarm","Operation-Schedule","Operation-Rule","Operation-Group","History","History-Report","History-TrendLog","History-SystemLog","Energy","Energy-Summary","Energy-ConsumptionAndTarget","Energy-SamsungSAC","Asset"],O=["ControlAreaSettings","AccountSettings","DeviceSettings","EnergySettings","SystemSettings"],M={policy:{menus:[{resource:"Dashboard",permission:"None",display:!0},{resource:"HMI",permission:"None",display:!0},{resource:"Device",permission:"None",display:!0},{resource:"Device-All",permission:"None",display:!0},{resource:"Device-AirConditioner.Indoor",permission:"None",display:!0},{resource:"Device-AirConditionerOutdoor",permission:"None",display:!0},{resource:"Device-Sensor.Temperature_Humidity",permission:"None",display:!0},{resource:"Device-Light",permission:"None",display:!0},{resource:"Device-Sensor.Motion",permission:"None",display:!0},{resource:"Device-ControlPoint",permission:"None",display:!0},{resource:"Device-Meter",permission:"None",display:!0},{resource:"Device-Gateway",permission:"None",display:!0},{resource:"Device-Beacon",permission:"None",display:!0},{resource:"Device-CCTV",permission:"None",display:!0},{resource:"Device-SmartPlug",permission:"None",display:!0},{resource:"Device-Etc",permission:"None",display:!0},{resource:"Operation",permission:"None",display:!0},{resource:"Operation-Alarm",permission:"None",display:!0},{resource:"Operation-Schedule",permission:"None",display:!0},{resource:"Operation-Rule",permission:"None",display:!0},{resource:"Operation-Group",permission:"None",display:!0},{resource:"History",permission:"None",display:!0},{resource:"History-Report",permission:"None",display:!0},{resource:"History-TrendLog",permission:"None",display:!0},{resource:"History-SystemLog",permission:"None",display:!0},{resource:"Energy",permission:"None",display:!0},{resource:"Energy-Summary",permission:"None",display:!0},{resource:"Energy-ConsumptionAndTarget",permission:"None",display:!0},{resource:"Energy-SamsungSAC",permission:"None",display:!0},{resource:"Asset",permission:"None",display:!0}]}},G=N.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED"),C={Dashboard:N.prop("SETTINGS_MENUCONFIGURE_DASHBOARD"),Energy:N.prop("SETTINGS_MENUCONFIGURE_ENERGY"),"Energy-Summary":N.prop("SETTINGS_MENUCONFIGURE_SUMMARY"),"Energy-ConsumptionAndTarget":N.prop("SETTINGS_MENUCONFIGURE_CONSUMPTION"),"Energy-SamsungSAC":N.prop("SETTINGS_MENUCONFIGURE_SAC_MONITORING"),Target:N.prop("SETTINGS_MENUCONFIGURE_TARGET"),SacEnergyMonitoring:N.prop("SETTINGS_MENUCONFIGURE_SAC_ENERGY_MONITORING"),PowerDistribution:N.prop("SETTINGS_MENUCONFIGURE_POWER_DISTRIBUTION"),Facility:"Facility","Operation-Group":N.prop("SETTINGS_MENUCONFIGURE_GROUP"),"Operation-Schedule":N.prop("SETTINGS_MENUCONFIGURE_SCHEDULE"),"Operation-Rule":N.prop("SETTINGS_MENUCONFIGURE_RULE"),HMI:N.prop("SETTINGS_MENUCONFIGURE_HMI"),"History-TrendLog":N.prop("SETTINGS_MENUCONFIGURE_TREND_LOG"),Device:N.prop("SETTINGS_MENUCONFIGURE_DEVICE"),"Device-All":N.prop("COMMON_ALL"),"Device-AirConditioner.Indoor":N.prop("SETTINGS_MENUCONFIGURE_SAC_INDOOR"),"Device-AirConditionerOutdoor":N.prop("SETTINGS_MENUCONFIGURE_SAC_OUTDOOR"),"Device-Sensor.Temperature_Humidity":N.prop("SETTINGS_MENUCONFIGURE_TEMP_HUM"),"Device-Light":N.prop("SETTINGS_MENUCONFIGURE_LIGHT"),"Device-SmartPlug":N.prop("SETTINGS_MENUCONFIGURE_SMART_PLUG"),"Device-Sensor.Motion":N.prop("SETTINGS_MENUCONFIGURE_MOTION"),"Device-ControlPoint":N.prop("SETTINGS_MENUCONFIGURE_POINT"),"Device-Meter":N.prop("SETTINGS_MENUCONFIGURE_METER"),"Device-Etc":N.prop("SETTINGS_MENUCONFIGURE_ETC"),Space:"Space",Building:N.prop("SETTINGS_MENUCONFIGURE_BUILDING"),Membershp:"Membership",Tenant:N.prop("SETTINGS_MENUCONFIGURE_TENANT"),Manager:N.prop("SETTINGS_MENUCONFIGURE_MANAGER"),Authority:N.prop("SETTINGS_MENUCONFIGURE_AUTHORITY"),Notice:"Notice","Operation-Alarm":N.prop("SETTINGS_MENUCONFIGURE_ALARM"),"History-SystemLog":N.prop("SETTINGS_MENUCONFIGURE_SYSTEM_LOG"),Settings:"Settings",Common:N.prop("SETTINGS_MENUCONFIGURE_COMMON"),Display:N.prop("SETTINGS_MENUCONFIGURE_DISPLAY"),Data:N.prop("SETTINGS_MENUCONFIGURE_DATA"),SAC:N.prop("SETTINGS_MENUCONFIGURE_SAC"),BACnet:N.prop("SETTINGS_MENUCONFIGURE_BAC_NET"),Diagnosis:N.prop("SETTINGS_MENUCONFIGURE_DIAGNOSIS"),"Device-Gateway":N.prop("SETTINGS_MENUCONFIGURE_GATEWAY"),"Device-Beacon":N.prop("SETTINGS_MENUCONFIGURE_BEACON"),"Device-CCTV":N.prop("SETTINGS_MENUCONFIGURE_CCTV"),Asset:N.prop("SETTINGS_MENUCONFIGURE_ASSET"),OpenAPI:N.prop("SETTINGS_MENUCONFIGURE_OPEN_API"),MenuConfigure:N.prop("SETTINGS_MENUCONFIGURE_MENU_CONFIGURE"),Information:N.prop("SETTINGS_MENUCONFIGURE_INFORMATION"),VirtaulPoint:N.prop("SETTINGS_MENUCONFIGURE_VIRTUAL_POINT"),Algorithm:N.prop("SETTINGS_MENUCONFIGURE_ALGORITHM"),HistoryOfOperation:N.prop("SETTINGS_MENUCONFIGURE_HISTORY_OF_OPERATION"),DemandMonitoring:N.prop("SETTINGS_MENUCONFIGURE_DEMAND_MONITORING"),EnergyLossDetection:N.prop("SETTINGS_MENUCONFIGURE_ENERGY_LOSS_DETECTION"),Operation:N.prop("SETTINGS_MENUCONFIGURE_OPERATION"),History:N.prop("SETTINGS_MENUCONFIGURE_HISTORY"),ControlAreaSettings:N.prop("SETTINGS_MENUCONFIGURE_CONTROLAREA_SETTINGS"),AccountSettings:N.prop("SETTINGS_MENUCONFIGURE_ACCOUNT_SETTINGS"),DeviceSettings:N.prop("SETTINGS_MENUCONFIGURE_DEVICE_SETTINGS"),EnergySettings:N.prop("SETTINGS_MENUCONFIGURE_ENERGY_SETTINGS"),SystemSettings:N.prop("SETTINGS_MENUCONFIGURE_SYSTEM_SETTINGS"),"History-Report":N.prop("SETTINGS_MENUCONFIGURE_REPORT")},U=function(){e=$("#authmgmt-tab-strip"),o=e.find(".authmgmt-tab-list li").eq(0),n=$("<div class='auth-detail-dialog'/>"),t=$("#settings-common-menuconfig").find(".sac-menuconfig-container"),r=t.find("#menuconfig-contents-grid").empty(),u=$('<div id="manager-view-grid"/>').appendTo(r),m=t.find("#menuconfig-contents-checkbox"),s=t.find(".k-button[data-event=menuconfigsave]"),a=$("#authmgmt-account-message-popup")},h=function(){p=a.kendoCommonDialog().data("kendoCommonDialog")},y=function(){E.open(),$.ajax({url:"/ums/users?roles=Manager&registrationStatus=Approved&exposePolicy=true"}).done(function(e){c=u.kendoGrid({columns:[{field:"name",width:"120px",title:N.prop("SETTINGS_DEVICE_NAME")},{field:"id",width:"120px",title:"ID"},{template:function(e){return"<span class='grid-detail-btn' data-id='"+e.id+"' data-bind='events: { click: clickDetail }'></span>"},sortable:!1,field:"detailInfo",title:N.prop("COMMON_BTN_DETAIL"),width:"50px"}],width:490,height:"100%",dataSource:e,scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageable:!1,hasCheckedModel:!0,setCheckedAttribute:!0}).data("kendoGrid"),s.kendoButton({enable:!1}),f(),R()}).fail(function(e){p.message(d.parseFailResponse(e)),p.open()}).always(function(){E.close()})},f=function(){c.bind("checked",function(e){var o=c.getCheckedData();0===o.length&&s.data("kendoButton").enable(!1),o=0<o.length?o:void 0,R(o)}),u.on("click",".grid-detail-btn",function(e){var o;o=c.dataSource.get(e.target.dataset.id),i=n.kendoDetailDialog({title:N.prop("COMMON_MY_PROFILE"),dataSource:o,hasDelete:!1,height:600,width:652,headerTemplate:"<span class='cell' data-bind='text: id'></span> <span class='cell'>(<span data-bind='text: name'></span>)</span>",scheme:{id:"id",fields:{role:{type:"text",name:N.prop("COMMON_MANAGER_TYPE")},name:{type:"text",name:N.prop("COMMON_NAME"),editCss:{width:"100%"},hasInputRemoveBtn:!0,validator:{type:"name",required:!0}},id:{type:"text",name:N.prop("COMMON_ID")},mobilePhoneNumber:{type:"text",name:N.prop("COMMON_PHONE_NUM"),editCss:{width:"100%"},hasInputRemoveBtn:!0,validator:!0},email:{type:"email",name:N.prop("COMMON_EMAIL"),editCss:{width:"100%"},hasInputRemoveBtn:!0,template:"<a mailto:'#:email#'>#if(email){##:email##}else{#-#}#</a>",validator:!0},joinDate:{type:"datetime",name:N.prop("COMMON_MY_PROFILE_SIGNUP_DATE"),format:"YYYY/MM/DD hh:mm"},lastLogin:{type:"text",name:N.prop("COMMON_MY_PROFILE_LASTEST_SIGN_IN"),template:function(e){var o="-";e.lastLogin&&(o=l(e.lastLogin).format("YYYY/MM/DD hh:mm"));return o}},policy:{type:"text",name:N.prop("ACCOUNT_SETTING_MANAGE_BUILDING"),template:function(e){var o,i=e.policy,n=i&&i.foundation_space_buildings_ids||[],t=n.length||0,r=$("<ul/>").addClass("mgbuilding");if(0==t)return"-";for(o=0;o<t;o++)r.append($("<li/>").html(v(n[o])));return r}}}}}).data("kendoDetailDialog"),n.css("overflow","auto"),i.setActions(i.BTN.EDIT,{visible:!1}),i.open()})},R=function(e){var o,i,n,t,r,s,a,p,u,c=[],N={},l=_.getMenuConfig(),d={};if(void 0!==e){for(d={policy:{menus:[]}},o=0;o<g.length;o++)for(i=0;i<e[0].policy.menus.length;i++)g[o]===e[0].policy.menus[i].resource&&d.policy.menus.push($.extend(!0,{},e[0].policy.menus[i]));for(o=1;o<e.length;o++)for(i=0;i<d.policy.menus.length;i++)for(n=0;n<e[o].policy.menus.length;n++)d.policy.menus[i].resource!==e[o].policy.menus[n].resource||"Full"===d.policy.menus[i].permission&&"None"===e[o].policy.menus[n].permission&&(d.policy.menus[i].permission="None")}for(T=void 0===e?$.extend(!0,{},M):$.extend(!0,{},d),o=0;o<T.policy.menus.length;o++)if(s=(t=T.policy.menus[o]).resource,t.permission="Full"===t.permission,t.displayName=C[s],-1===s.indexOf("-")){if(t.mainEnabled=!0,t.subEnabled=!0,t.disabled=!(e&&0<e.length),!(a=l[s.toLowerCase()]))continue;t.display=!a.isHiddenMenu,c.push(t),t.mainMenuClick=function(e){var o=!this.permission;if(this.subMenus)for(var i=0;i<this.subMenus.length;i++)this.subMenus[i].set("permission",o)}}for(o=0;o<c.length;o++)for(N[c[o].resource]=o,i=0;i<T.policy.menus.length;i++)(t=T.policy.menus[i]).mainEnabled||(r=(p=t.resource.split("-"))[0],c[o].resource===r&&(void 0===c[o].subMenus&&(c[o].subMenus=[]),"Device"===r?(u=l[r.toLowerCase()].tabs.find(function(e){return e.name===p[1]}),t.display=u&&u.enabled||!1):(u=l[r.toLowerCase()].subMenu[p[1].toLowerCase()]||{},t.display=!u.isHiddenMenu),c[o].subMenus.push(t),t.subMenuClick=function(e){var o=N[this.resource.split("-")[0]],i=S.menuConfigData[o],n=!this.permission;(this.permission=n)?i.set("permission",n):i.set("permission",E(i))}));function E(e){for(var o=e.get("subMenus"),i=0;i<o.length;i++)if(o[i].permission)return!0;return!1}S=I.observable({menuConfigData:c}),I.bind(m,S)},D=function(){o.on("click",function(e){$(e.currentTarget).hasClass("k-state-active")||(r.empty(),u=$('<div id="manager-view-grid"/>').appendTo(r),y())}),m.on("click","input.k-checkbox",function(){var e=$(this),o=e.attr("id"),i=e.closest(".item").find("span.display"),n=e.closest(".sac-menuconfig-container").find(".k-button[data-event=menuconfigsave]");i.text(C[o]),c&&0<c.getCheckedData().length&&n.data("kendoButton").enable(!0)}),s.on("click",function(){var e,o,i,n=$(this),t=c.getCheckedData(),r=S.get("menuConfigData"),s=[],a=[];for(o=0;o<r.length;o++)if(s.push({resource:r[o].resource,permission:r[o].permission?"Full":"None"}),r[o].subMenus)for(e=r[o].subMenus,i=0;i<e.length;i++)s.push({resource:e[i].resource,permission:e[i].permission?"Full":"None"});for(o=0;o<O.length;o++)s.push({resource:O[o],permission:"None"});for(o=0;o<t.length;o++)a.push({id:t[o].id,policy:{menus:s}});E.open(),$.ajax({url:"/ums/users",method:"patch",data:a}).done(function(){for(p.message(G),n.data("kendoButton").enable(!1),o=0;o<t.length;o++)t[o].policy.menus=s}).fail(function(e){p.message(e.responseText)}).always(function(){p.open(),E.close()})})},v=function(i){var e=_.getCurrentBuildingList(),n="";return $.each(e,function(e,o){if(o.id===i)return n=o.name,!1}),n};return{init:function(){U(),h(),y(),D()}}}),define("accountsettings/authmgmt/building-authmgmt",["accountsettings/authmgmt/config/authmgmt-vm"],function(e){"use strict";var o,i,n,t,r,s,a,p,u=window.kendo,c=window.I18N,N=window.Util,l=window.MAIN_WINDOW,d=new window.CommonLoadingPanel,E=function(){n=$("#authmgmt-tab-strip"),t=n.find(".authmgmt-tab-list li").eq(1),a=$(".authmgmt-sheet-wrapper").empty(),s=$('<div class="authmgmt-sheet-body"/>').appendTo(a),p=$("#authmgmt-message-popup"),o=e.AuthViewModel,i=o.get("btnSave"),u.bind(n,o)},m=function(){l.disableFloorNav(!0),p=p.kendoCommonDialog().data("kendoCommonDialog")},S=function(){d.open(),T().done(function(e){var o=l.getCurrentBuildingList();e&&0===e.length?(p.message(c.prop("AUTHMGMT_NO_USER_PERMISSIONS")),p.open()):0===o.length?(p.message(c.prop("AUTHMGMT_NO_BUILDING_PERMISSIONS")),p.open()):(g(e,"name"),r=s.kendoSpreadsheet({sheetsbar:!1,toolbar:!1,actionbar:!1,columnWidth:200,rowHeight:46,headerWidth:200,headerHeight:46,isFixedCell:!0,defaultHeaderStyle:{fontSize:"14px"},sheets:[{columnHeaderList:o,rowHeaderList:e,booleanSheet:{dataSource:e,propertyKey:"policy.foundation_space_buildings_ids"}}]}).data("kendoSpreadsheet"),_())}).always(function(){i.set("disabled",!0),d.close()})},T=function(){return $.ajax({url:"/ums/users?roles=Manager&registrationStatus=Approved&exposePolicy=true"})},I=function(){t.on("click",function(e){$(e.currentTarget).hasClass("k-state-active")||(a.empty(),s=$('<div class="authmgmt-sheet-body"/>').appendTo(a),S())}),i.set("click",function(e){var o=r.getBooleanData(0);d.open(),$.ajax({url:"/ums/users",method:"patch",data:o}).done(function(){i.set("disabled",!0),p.message(c.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED"))}).fail(function(e){p.message(N.parseFailResponse(e))}).always(function(){p.open(),d.close()})})},_=function(){r.bind("select",function(e){i.set("disabled",!1)})},g=function(e,o){var i,n,t,r=e.length;for(i=0;i<r;i++)for(n=r-1;i<n;n--)e[n-1][o]>e[n][o]&&(t=e.splice(n,1),e.splice(n-1,0,t[0]))};return{init:function(){E(),m(),S(),I()}}}),define("accountsettings/authmgmt/authmgmt",["accountsettings/authmgmt/account-authmgmt","accountsettings/authmgmt/building-authmgmt"],function(e,o){"use strict";var i=$("#authmgmt-tab-strip"),n=i.find(".authmgmt-tab-list li"),t=0,r=[e,o];window.MAIN_WINDOW.disableFloorNav(!0);var s=function(){n.one("click",function(e){var o=$(e.currentTarget).index();r[o].init()})};i.kendoCommonTabStrip().data("kendoCommonTabStrip"),s(),n.eq(t).trigger("click")});