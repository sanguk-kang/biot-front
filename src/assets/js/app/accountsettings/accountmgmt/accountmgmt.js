define("accountsettings/accountmgmt/common/common",[],function(){var t=window.I18N,e=window.MAIN_WINDOW,n={COMMON_MANAGER:t.prop("COMMON_MANAGER"),COMMON_MANAGER_TYPE:t.prop("COMMON_MANAGER_TYPE"),COMMON_NAME:t.prop("COMMON_NAME"),COMMON_ID:t.prop("COMMON_ID"),COMMON_PHONE_NUM:t.prop("COMMON_PHONE_NUM"),COMMON_LASTEST_SIGN_IN:t.prop("COMMON_MY_PROFILE_LASTEST_SIGN_IN"),COMMON_DETAIL:t.prop("COMMON_BTN_DETAIL"),COMMON_EMAIL:t.prop("COMMON_EMAIL"),COMMON_SIGNUP_DATE:t.prop("COMMON_MY_PROFILE_SIGNUP_DATE"),COMMON_BTN_CLOSE:t.prop("COMMON_BTN_CLOSE"),COMMON_BTN_DELETE:t.prop("COMMON_BTN_DELETE"),COMMON_BTN_EDIT:t.prop("COMMON_BTN_EDIT"),COMMON_BTN_SAVE:t.prop("COMMON_BTN_SAVE"),COMMON_BTN_CANCEL:t.prop("COMMON_BTN_CANCEL"),COMMON_BTN_CHANGE_ALL:t.prop("COMMON_BTN_CHANGE_ALL"),COMMON_ENTER_SEARCH_TERMS:t.prop("COMMON_ENTER_SEARCH_TERMS"),COMMON_MY_PROFILE_CHANGE_PASSWORD_CAUTION:t.prop("COMMON_MY_PROFILE_CHANGE_PASSWORD_CAUTION"),COMMON_MESSAGE_NOTI_CHANGES_SAVED:t.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED"),MEMBERSHIP_MANAGER_TYPE:t.prop("MEMBERSHIP_MANAGER_TYPE"),MEMBERSHIP_MANAGER_TYPE_ALL:t.prop("MEMBERSHIP_MANAGER_TYPE_ALL"),MEMBERSHIP_MANAGER_TYPE_ADMINISTRATOR:t.prop("MEMBERSHIP_MANAGER_TYPE_ADMINISTRATOR"),MEMBERSHIP_MANAGER_TYPE_ASSISTANT_MANAGER:t.prop("MEMBERSHIP_MANAGER_TYPE_ASSISTANT_MANAGER"),MEMBERSHIP_MANAGER_TYPE_GENERAL_MANAGER:t.prop("MEMBERSHIP_MANAGER_TYPE_GENERAL_MANAGER"),MEMBERSHIP_MANAGER_TYPE_SENIOR_MANAGER:t.prop("MEMBERSHIP_MANAGER_TYPE_SENIOR_MANAGER"),MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED:t.prop("MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED"),MEMBERSHIP_MESSAGE_NOTI_SELCTED_MULTI_MEMBER:function(e){return t.prop("MEMBERSHIP_MESSAGE_NOTI_SELCTED_MULTI_MEMBER",e)},MEMBERSHIP_MESSAGE_CONFIRM_RESET_PASSSWORD:t.prop("MEMBERSHIP_MESSAGE_CONFIRM_RESET_PASSSWORD"),MEMBERSHIP_SELECTED_MEMBERS:t.prop("MEMBERSHIP_SELECTED_MEMBERS"),MEMBERSHIP_REQUEST_DATE:t.prop("MEMBERSHIP_REQUEST_DATE"),MEMBERSHIP_TELEPHONE:t.prop("COMMON_PHONE"),MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MEMBER:t.prop("MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MEMBER"),MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MULTI_MEMBER:function(e){return t.prop("MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MULTI_MEMBER",e)},MANAGER_MANAGER_RESET_PASSWORD:t.prop("MANAGER_MANAGER_RESET_PASSWORD"),MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MEMBER_APPLICATION:t.prop("MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MEMBER_APPLICATION"),MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MULTI_MEMBER_APPLICATION:function(e){return t.prop("MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MULTI_MEMBER_APPLICATION",e)},MEMBERSHIP_PENDING_APPROVAL:t.prop("MEMBERSHIP_PENDING_APPROVAL"),MEMBERSHIP_APPROVE:t.prop("MEMBERSHIP_APPROVE"),MEMBERSHIP_REJECT:t.prop("MEMBERSHIP_REJECT"),ACCOUNT_SETTING_MANAGE_BUILDING:t.prop("ACCOUNT_SETTING_MANAGE_BUILDING"),COMMON_FLOOR_NAV_TOTAL:t.prop("COMMON_FLOOR_NAV_TOTAL"),MEMBERSHIP_NEW_PASSWORD:t.prop("COMMON_MY_PROFILE_NEW_PASSWORD"),MEMBERSHIP_CHECK_NEW_PASSWORD:t.prop("MEMBERSHIP_CHECK_NEW_PASSWORD"),COMMON_CONFIRM_DIALOG_EDIT_CANEL:t.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL"),MEMBERSHIP_ADD_MANUALLY:t.prop("MEMBERSHIP_ADD_MANUALLY"),COMMON_PASSWORD:t.prop("COMMON_PASSWORD"),COMMON_NO_SELECT:t.prop("COMMON_NO_SELECT"),COMMON_REQUIRED_ITEM:t.prop("MEMBERSHIP_REQUIRED_ITEM"),MEMBERSHIP_MESSAGE_NOTI_USED_ID:t.prop("MEMBERSHIP_MESSAGE_NOTI_USED_ID"),MEMBERSHIP_MESSAGE_CONFIRM_SIGNUP_ADD_MEMBER:t.prop("MEMBERSHIP_MESSAGE_CONFIRM_SIGNUP_ADD_MEMBER"),MEMBERSHIP_LOCKED_ID:function(e){return t.prop("MEMBERSHIP_LOCKED_ID",e)},MEMBERSHIP_ALREADY_EXIST_ID:t.prop("MEMBERSHIP_ALREADY_EXIST_ID"),MEMBERSHIP_MAXIMUM_NUMBER:t.prop("MEMBERSHIP_MAXIMUM_NUMBER")};return{TEXT:n,MAPPING_COL_TEXT:{role:n.COMMON_MANAGER_TYPE,name:n.COMMON_NAME,id:n.COMMON_ID,mobilePhoneNumber:n.MEMBERSHIP_TELEPHONE,lastLogin:n.COMMON_LASTEST_SIGN_IN,joinDate:n.MEMBERSHIP_REQUEST_DATE},getCurrentBuildingList:function(){return e.getCurrentBuildingList()}}}),define("accountsettings/accountmgmt/common/widget",["accountsettings/accountmgmt/common/common"],function(s){var t,i,a,d,l,n=window.moment,r=s.TEXT,E=window.Util,o=$("#manager-popup"),c=$("#manager-signup-approve-popup"),e=$("#manager-dialog-message"),u=$("#manager-dialog-confirm"),M=[{text:"Admin",value:"Admin"},{text:"Manager",value:"Manager"}],p={title:r.COMMON_DETAIL,dataSource:[],hasDelete:!1,height:735,width:652,contentTemplate:"<div class='detail-dialog-content device-dialog-content'><div class='detail-dialog-header device-dialog-header'></div><div class='detail-dialog-detail-content'></div></div>",headerTemplate:"<span>"+r.MEMBERSHIP_SELECTED_MEMBERS+" : #:count#</span>",listTemplate:"<span>#:data.name# (#:data.id#)</span>",isCustomActions:!0};t={account:$.extend(!0,{},p,{buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2,SAVE:3,CANCEL:4},actions:[{text:r.COMMON_BTN_CLOSE,visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1)}},{text:r.COMMON_BTN_DELETE,visible:!0,action:function(e){var n=e.sender,i=n.dataSource.data(),a=i.length,o=new window.CommonLoadingPanel(n.element[0]);return 1===a?l.message(r.MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MEMBER):l.message(r.MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MULTI_MEMBER(a)),l.options.confirmActions.yes=function(){o.open();for(var e=[],t=0;t<a;t++)e.push($.ajax({method:"delete",url:"/ums/users/"+i[t].id}));$.when.apply(this,e).done(function(){n.isDeleted=!0,n.trigger("onClose"),n.close()}).always(function(){o.close()})}.bind(this),l.open(),!1}},{text:r.COMMON_BTN_EDIT,visible:!0,action:function(e){return e.sender.trigger("onEdit"),e.sender.setEditable(!0),e.sender.trigger("onEdited"),!1}},{text:r.COMMON_BTN_SAVE,visible:!1,disabled:!0,action:function(e){var t,n=e.sender.options.scheme.fields,i=e.sender.editFields;for(t in n)if(n[t].editable&&n[t].validator&&i[t].data("kendoCommonValidator")&&!i[t].data("kendoCommonValidator").validate())return!1;var a=e.sender.saveAll();return a&&e.sender.trigger("onSaved",{sender:e.sender,results:a,groupInfo:M}),!1}},{text:r.COMMON_BTN_CANCEL,visible:!1,action:function(e){return e.sender._cancelEvent({sender:e.sender},!1),!1}}],scheme:{id:"id",fields:{role:{type:"select",name:r.COMMON_MANAGER_TYPE,editable:!0,editCss:{width:"50%"},isEditAll:!0,editFieldName:"role",editTemplate:function(e,t){var n=t.dataSource;t.fields.role=e.role;for(var i=n.length=0;i<M.length;i++)n.push(M[i]);return"<input data-role='dropdownlist' data-animation='false' data-text-field='text' data-value-field='value' data-bind='value: fields.role, source: dataSource, events: {select: select}'/>"},editViewModel:{fields:{role:"Admin"},dataSource:[],select:function(e){var t=e.dataItem,n=i.element.find("input.account-building-list").data("kendoDropDownCheckBox");this.role=t.value,i.hasChanged=!0,i.enableSaveBtn(),n&&("Admin"===t.value?n.enable(!1):n.enable(!0))}}},name:{type:"text",name:r.COMMON_NAME,editCss:{width:"100%"},editable:!0,hasInputRemoveBtn:!0,validator:{type:"name",required:!0}},id:{type:"text",name:r.COMMON_ID,editable:!0,editTemplate:"<span style='line-height: 40px;'>#:id#</span><button class='k-button' style='float: right; width: 170px;' data-bind='events: {click: onClick}'>"+r.MANAGER_MANAGER_RESET_PASSWORD+"</button>",editViewModel:{onClick:function(e){var t=$("#manager-dialog-confirm").data("kendoCommonDialog"),n=new window.CommonLoadingPanel($("#manager-popup")),i=$(e.target.parentElement).find("span").text();t.message(r.MEMBERSHIP_MESSAGE_CONFIRM_RESET_PASSSWORD),t.options.confirmActions.yes=function(){n.open(),$.ajax({method:"post",url:"/ums/users/"+i+"/resetPassword"}).fail(function(e){var t=E.parseFailResponse(e);t.indexOf("is currently locked out for != -1")&&(t=window.I18N.prop("COMMON_SIGNIN_LOCKED",i)),d.message(t),d.open()}).always(function(){n.close()})},t.open()}}},mobilePhoneNumber:{type:"text",name:r.COMMON_PHONE_NUM,editCss:{width:"100%"},editable:!0,hasInputRemoveBtn:!0,validator:!0},email:{type:"email",name:r.COMMON_EMAIL,editCss:{width:"100%"},editable:!0,hasInputRemoveBtn:!0,validator:!0},joinDate:{type:"text",name:r.COMMON_SIGNUP_DATE,template:function(e){var t="-";return e.joinDate&&(t=n(e.joinDate).format("LLL").replace(/\./g,"/")),t}},lastLogin:{type:"text",name:r.COMMON_LASTEST_SIGN_IN,template:function(e){var t="-";return e.lastLogin&&(t=n(e.lastLogin).format("LLL").replace(/\./g,"/")),t}},policy:{type:"text",name:r.ACCOUNT_SETTING_MANAGE_BUILDING,editable:!0,editCss:{width:"50%"},template:function(e){var t,n,i=s.getCurrentBuildingList(),a=$("<ul/>"),o=e.policy&&e.policy.foundation_space_buildings_ids||[];if(0===o.length)return"-";for(t=0;t<i.length;t++)for(n=0;n<o.length;n++)i[t].id==o[n]&&a.append($("<li/>").text(i[t].name));return a},editFieldName:"policy",editTemplate:function(e,t){return t.id=e.id,"<input class='account-building-list' data-id='"+e.id+"'/>"},editViewModel:{fields:{policy:null},id:"",init:function(){}}}}}}),signup:$.extend(!0,{},p,{height:535,listTemplate:function(e){return"<span>"+e.name+" ("+e.id+')</span><input class="approve-manager-type-filter" data-id="'+e.id+'"/>'},buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2,SAVE:3,CANCEL:4},actions:[{text:r.COMMON_BTN_CLOSE,visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1)}},{text:r.MEMBERSHIP_REJECT,visible:!0,action:function(e){var n=e.sender,i=n.dataSource.data(),a=i.length,o=new window.CommonLoadingPanel(n.element[0]);return 1===a?l.message(r.MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MEMBER_APPLICATION):l.message(r.MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MULTI_MEMBER_APPLICATION(a)),l.options.confirmActions.yes=function(){o.open();for(var e=[],t=0;t<a;t++)e.push({id:i[t].id,registrationStatus:"Rejected"});$.ajax({url:"/ums/users",method:"PATCH",data:e}).done(function(){n.isDeleted=!0,n.trigger("onClose"),n.close()}).fail(function(e){d.message(E.parseFailResponse(e)),d.open()}).always(function(){o.close()})},l.open(),!1}},{text:r.MEMBERSHIP_APPROVE,visible:!0,action:function(e){return e.sender.trigger("onEdit"),e.sender.setEditable(!0),e.sender.enableSaveBtn(),e.sender.trigger("onEdited"),!1}},{text:r.COMMON_BTN_SAVE,visible:!1,disabled:!0,action:function(e){var t=e.sender.saveAll();return t&&(e.sender.trigger("onSaved",{sender:e.sender,results:t,groupInfo:M}),e.sender.setEditable(!1)),!1}},{text:r.COMMON_BTN_CANCEL,visible:!1,action:function(e){return e.sender._cancelEvent({sender:e.sender},!1),!1}}],scheme:{id:"id",fields:{joinDate:{type:"text",name:r.COMMON_SIGNUP_DATE,template:function(e){var t="-";return e.joinDate&&(t=n(e.joinDate).format("LLL").replace(/\./g,"/")),t}},name:{type:"text",name:r.COMMON_NAME},id:{type:"text",name:r.COMMON_ID},mobilePhoneNumber:{type:"text",name:r.COMMON_PHONE_NUM},email:{type:"email",name:r.COMMON_EMAIL},policy:{type:"text",name:r.ACCOUNT_SETTING_MANAGE_BUILDING,editable:!0,editCss:{width:"50%"},template:function(e){var t,n,i=s.getCurrentBuildingList(),a=$("<ul/>"),o=e.policy&&e.policy.foundation_space_buildings_ids||[];if(0===o.length)return"-";for(t=0;t<i.length;t++)for(n=0;n<o.length;n++)i[t].id==o[n]&&a.append($("<li/>").text(i[t].name));return a},editFieldName:"policy",editTemplate:function(e,t){return t.id=e.id,"<input class='account-building-list' data-id='"+e.id+"'/>"},editViewModel:{fields:{policy:null},id:"",init:function(){}}}}}}),addManually:$.extend(!0,{},p,{title:r.MEMBERSHIP_ADD_MANUALLY,height:630,contentTemplate:"<div class='detail-dialog-content device-dialog-content'><div class='signup-required'><span class='signup-required-mark'>*</span><span class='signup-required-text'>"+r.COMMON_REQUIRED_ITEM+"</span></div> <div class='detail-dialog-detail-content'></div></div>",listTemplate:function(){return""},buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2,SAVE:3,CANCEL:4},actions:[{text:r.COMMON_BTN_CLOSE,visible:!0,action:function(e){}},{text:r.MEMBERSHIP_REJECT,visible:!0,action:function(e){}},{text:r.MEMBERSHIP_APPROVE,visible:!0,action:function(e){}},{text:r.COMMON_BTN_SAVE,visible:!1,disabled:!0,action:function(e){var t=e.sender.saveAll();return t&&e.sender.trigger("onSaved",{sender:e.sender,results:t}),!1}},{text:r.COMMON_BTN_CANCEL,visible:!1,action:function(e){return l.message(r.COMMON_CONFIRM_DIALOG_EDIT_CANEL),l.options.confirmActions.yes=function(){a.dataSource.cancelChanges(),a.close()},l.open(),!1}}],scheme:{id:"id",fields:{role:{type:"select",name:r.COMMON_MANAGER_TYPE,editable:!0,editCss:{width:"50%"},isEditAll:!0,editFieldName:"role",editTemplate:function(e,t){for(var n=t.dataSource,i=n.length=0;i<M.length;i++)n.push(M[i]);return"<input data-role='dropdownlist' data-animation='false' data-text-field='text' data-value-field='value' data-bind='value: fields.role, source: dataSource, events: {select: select}'/>"},editViewModel:{fields:{role:"Manager"},dataSource:[],select:function(e){var t=e.dataItem;this.role=t.value;var n=a.element.find("input.account-building-list").data("kendoDropDownCheckBox");n&&("Admin"===t.value?n.enable(!1):n.enable(!0))}}},id:{type:"text",name:r.COMMON_ID,editable:!0,editFieldName:"id",editTemplate:function(){return'<input class="k-input approve-id" placeholder="'+r.COMMON_ID+'" data-key="id" required/><span class="signup-required-mark">*</span>'},editViewModel:{fields:{id:""},init:function(){c.find(".k-input.approve-id").kendoCommonValidator({type:"id"}),c.find(".k-input.approve-id").on("keyup",function(e){a.options.scheme.fields.id.editViewModel.fields.set("id",$(e.target).val())})}}},password:{type:"text",name:r.MEMBERSHIP_NEW_PASSWORD,editable:!0,editFieldName:"password",editTemplate:function(){return'<input type="password" id="approve-password" class="k-input approve-password" placeholder="'+r.COMMON_PASSWORD+'" data-key="password" required/><span class="signup-required-mark">*</span>'},editViewModel:{fields:{password:""},init:function(){c.find(".k-input.approve-password").kendoCommonValidator({type:"password",mixedPasswordCheck:!0}),c.find(".k-input.approve-password").on("keyup",function(e){a.options.scheme.fields.password.editViewModel.fields.set("password",$(e.target).val())})}}},passwordRetype:{type:"text",name:r.MEMBERSHIP_CHECK_NEW_PASSWORD,editable:!0,editTemplate:function(){return'<input type="password" class="k-input approve-password-retype" placeholder="'+r.MEMBERSHIP_CHECK_NEW_PASSWORD+'" data-key="passwordRetype" data-retype-for="approve-password" required/><span class="signup-required-mark">*</span>'},editViewModel:{fields:{passwordRetype:""},init:function(){c.find(".k-input.approve-password-retype").kendoCommonValidator({type:"passwordRetype",mixedPasswordCheck:!0})}}},name:{type:"text",name:r.COMMON_NAME,editable:!0,editFieldName:"name",editTemplate:function(){return'<input class="k-input approve-name" placeholder="'+r.COMMON_NAME+'" data-key="name" required/><span class="signup-required-mark">*</span>'},editViewModel:{fields:{name:""},init:function(){c.find(".k-input.approve-name").kendoCommonValidator({type:"name"}),c.find(".k-input.approve-name").on("keyup",function(e){a.options.scheme.fields.name.editViewModel.fields.set("name",$(e.target).val().trim())})}}},mobilePhoneNumber:{type:"text",name:r.COMMON_PHONE_NUM,editable:!0,editFieldName:"mobilePhoneNumber",editTemplate:function(){return'<input class="k-input approve-phone-number" placeholder="'+r.COMMON_PHONE_NUM+'" data-key="mobilePhoneNumber"/>'},editViewModel:{fields:{mobilePhoneNumber:""},init:function(){c.find(".k-input.approve-phone-number").kendoCommonValidator({type:"mobilePhoneNumber"}),c.find(".k-input.approve-phone-number").on("keyup",function(e){a.options.scheme.fields.mobilePhoneNumber.editViewModel.fields.set("mobilePhoneNumber",$(e.target).val())})}}},email:{type:"email",name:r.COMMON_EMAIL,editable:!0,editFieldName:"email",editTemplate:function(){return'<input class="k-input approve-email" placeholder="'+r.COMMON_EMAIL+'" data-key="email"/>'},editViewModel:{fields:{email:""},init:function(){c.find(".k-input.approve-email").kendoCommonValidator({type:"email"}),c.find(".k-input.approve-email").on("keyup",function(e){a.options.scheme.fields.email.editViewModel.fields.set("email",$(e.target).val())})}}},policy:{type:"text",name:r.ACCOUNT_SETTING_MANAGE_BUILDING,editable:!0,editCss:{width:"50%"},template:function(){return"-"},editFieldName:"policy",editTemplate:function(e,t){return t.id=e.id,"<input class='account-building-list' data-id='none'/>"},editViewModel:{fields:{policy:null},id:"",init:function(){}}}}}})},d=e.kendoCommonDialog({type:"message",height:252}).data("kendoCommonDialog"),l=u.kendoCommonDialog({type:"confirm",height:252,confirmActions:{yes:function(){},no:function(){}}}).data("kendoCommonDialog");return{groupInfo:M,managerDialogMessage:d,managerDialogConfirm:l,getDetailPopup:function(e){return"addManually"!=e?i=o.kendoDetailDialog(t[e]).data("kendoDetailDialog"):a=c.kendoDetailDialog(t[e]).data("kendoDetailDialog")}}}),define("accountsettings/accountmgmt/viewmodel/accountmgmt-vm",["accountsettings/accountmgmt/common/common","accountsettings/accountmgmt/common/widget"],function(e){var t=window.kendo,n=e.TEXT;return{MainViewModel:t.observable({categoryAccountBtn:{isSelected:!0},categorySignupBtn:{isSelected:!1},searchInput:{value:"",keyup:function(){}},searchRemoveBtn:{disabled:!1,isVisible:!1,click:function(){}},searchSearchBtn:{disabled:!1,isVisible:!0,click:function(){}},selectedMemberLabel:{text:n.MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED},account:{editBtn:{disabled:!0,isVisible:!0,click:function(){}},deleteBtn:{disabled:!0,isVisible:!0,click:function(){}},detailBtn:{disabled:!0,isVisible:!0,click:function(){}},filter:{type:"dropdownlist",id:"manager-type-list",disabled:!1,isVisible:!0,value:null,options:{optionLabel:n.MEMBERSHIP_MANAGER_TYPE_ALL,dataTextField:"text",dataValueField:"priority",animation:!1,dataSource:[],open:function(){},close:function(){},change:function(){},select:function(){}}},userDataSource:new t.data.DataSource({data:[]}),userColumns:[]},signup:{pendingNum:0,addBtn:{disabled:!1,isVisible:!0,click:function(){}},approveBtn:{disabled:!0,isVisible:!0,click:function(){}},rejectBtn:{disabled:!0,isVisible:!0,click:function(){}},detailBtn:{disabled:!0,isVisible:!0,click:function(){}},userDataSource:new t.data.DataSource({data:[]}),userColumns:[]}})}}),define("accountsettings/accountmgmt/accountmgmt",["accountsettings/accountmgmt/common/common","accountsettings/accountmgmt/common/widget","accountsettings/accountmgmt/viewmodel/accountmgmt-vm"],function(s,e,t){var n=window.kendo,u=window.Util,M=s.TEXT,a=s.MAPPING_COL_TEXT,o=window.moment,p=new window.CommonLoadingPanel;window.MAIN_WINDOW.disableFloorNav(!0);var r,d,l,E,c,i,_,m=t.MainViewModel,S={account:m.get("categoryAccountBtn"),signup:m.get("categorySignupBtn")},g=m.get("searchInput"),N=m.get("searchRemoveBtn"),f=m.get("searchSearchBtn"),O=m.get("selectedMemberLabel"),C=m.get("account"),A=C.get("editBtn"),I=C.get("deleteBtn"),R=C.get("detailBtn"),T=C.get("filter"),D=m.get("signup"),h=D.get("addBtn"),v=D.get("approveBtn"),b=D.get("rejectBtn"),P=D.get("detailBtn"),B=e.managerDialogConfirm,L=e.managerDialogMessage,y=$("#membership-tab"),w=$("#manager-categories"),k="account",G="signup",H=$(".manager-top-categories-search"),x=$(".manager-top-utilities"),V=$("#manager-grid"),F=$(".manager-search-sch-btn"),U=$(".manager-btn-detail"),W=$(".signup-btn-detail"),Y=$("#manager-popup"),j=$("#manager-signup-approve-popup"),J=e.groupInfo,q={role:"Manager",id:"",name:""},X=function(){l=k,K(),ee()},K=function(){n.bind(x,C),c=C.get("userDataSource"),i=c.data(),E&&(E.destroy(),V.empty()),E=V.kendoGrid({columns:le(),height:"calc(100% - 56px)",scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageagble:!1,hasCheckedModel:!0,setCheckedAttribute:!0}).data("kendoGrid"),r&&(r.destroy(),Y.empty()),r=e.getDetailPopup(l),C.get("filter").get("options").set("dataSource",J),oe(!0)},Q=function(){n.bind(x,D),c=D.get("userDataSource"),i=c.data(),E&&(E.destroy(),V.empty()),E=V.kendoGrid({columns:re(),height:"calc(100% - 56px)",scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageagble:!1,hasCheckedModel:!0,setCheckedAttribute:!0}).data("kendoGrid"),r&&(r.destroy(),Y.empty()),d&&(d.destroy(),j.empty()),r=e.getDetailPopup(l),d=e.getDetailPopup("addManually"),oe(!0)},z=function(){w.on("click",".manager-category",function(e){if(!$(this).hasClass("selected")){var t=$(this).data("category");"account"===t?(S.account.set("isSelected",!0),S.signup.set("isSelected",!1),X()):"signup"===t&&(S.signup.set("isSelected",!0),S.account.set("isSelected",!1),l=G,Q(),te()),ue(!0),O.set("text",M.MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED)}}),g.set("keyup",function(e){var t=e.key,n=e.target.value;"Enter"===t&&F.trigger("click"),n?N.set("isVisible",!0):N.set("isVisible",!1)}),f.set("click",function(e){Z()}),N.set("click",function(e){g.set("value",""),N.set("isVisible",!1)})},Z=function(){var e,t=g.value,n=c,i=_,a=[];n.filter({});for(var o=0;o<i.length;o++)i[o].field&&"checked"!==i[o].field&&a.push({field:i[o].field,operator:"contains",value:t});e={logic:"or",filters:a},l===k&&T.value?n.filter([e,{field:"role",operator:"eq",value:T.value}]):n.filter(e),n.sort([{field:"name",dir:"asc"}]),Me()},ee=function(){T.get("options").set("select",function(e){this.value=e.dataItem.value,Z()}),E.bind("checked",function(e){var t=this.getCheckedData().length;0<t?(A.get("disabled")&&ue(!1),O.set("text",M.MEMBERSHIP_MESSAGE_NOTI_SELCTED_MULTI_MEMBER(t))):0===t&&Me()}),V.on("click",".ic-info",function(e){var t=$(e.currentTarget),i=[];r.setDataSource(i),r.isChanged=!1,r.open(),p.open(Y),ae("users",{ids:E.dataSource.get(t.data("id")).id,exposePolicy:"true"}).done(function(e){for(var t=e.length,n=0;n<t;n++)i.push(e[n]);r.setDataSource(i)}).always(function(){p.close(Y)})}),A.set("click",function(e){U.trigger("click")}),I.set("click",function(e){var t=E.getCheckedData(),n=t.length;1===n?B.message(M.MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MEMBER):B.message(M.MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MULTI_MEMBER(n)),B.options.confirmActions.yes=function(){var e=!1;p.open(),$.when.apply(this,de(t)).done(function(){e=!0,Me(),oe()}).always(function(){e||p.close()})}.bind(this),B.open()}),R.set("click",function(n){var e=E.getCheckedData(),t=e.length,i="",a=[],o=0;for(o=0;o<t;o++)i+=e[o].id+",";r.setDataSource(a,!1),r.isChanged=!1,r.open(),p.open(Y),ae("users",{ids:i,exposePolicy:"true"}).done(function(e){var t=e.length;for(o=0;o<t;o++)a.push(e[o]);pe(a,["id","name","role"]),r.setDataSource(a,!1),1<t&&r.collapseRow(0),n.originalEvent||(r.trigger("onEdit"),r.setEditable(!0),r.trigger("onEdited"))}).always(function(){p.close(Y)})}),r.bind("onSaved",function(t){var e,n,i=[],a=t.results,o=t.sender.dataSource.data(),s=t.sender.dataSource._pristineData,d=o.length,l=[];p.open(Y);for(var r=0;r<d;r++){for(var E in!1,n=a[r].role,a[r])if(a[r][E]!=s[r][E]){if("policy"===E&&!ce(a[r][E]&&a[r][E].foundation_space_buildings_ids||[],s[r][E]&&s[r][E].foundation_space_buildings_ids||[]))if(a[r][E]&&a[r][E].foundation_space_buildings_ids){e=[];for(var c=0;c<a[r][E].foundation_space_buildings_ids.length;c++)e.push(a[r][E].foundation_space_buildings_ids[c]);a[r][E]={foundation_space_buildings_ids:e}}else a[r][E]={},a[r][E].foundation_space_buildings_ids=[];a[r][E]?"policy"!==E&&!0:"policy"===E?a[r][E]={foundation_space_buildings_ids:[]}:s[r][E]?!(a[r][E]=""):delete a[r][E]}else delete a[r][E];a[r].id=o[r].id,a[r].policy&&(delete a[r].policy.menus,"Admin"===n&&delete a[r].policy.foundation_space_buildings_ids),l.push(a[r])}i.push($.ajax({url:"/ums/users",method:"patch",data:l})),$.when.apply(t,i).done(function(){t.sender.success(),t.sender.setEditable(!1),t.sender.isChanged=!0,L.message(M.COMMON_MESSAGE_NOTI_CHANGES_SAVED)}).fail(function(e){t.sender.fail(),L.message(u.parseFailResponse(e))}).always(function(){L.open(),p.close(Y)})}),r.setCloseAction(function(e){this._cancelEvent&&this._cancelEvent({sender:this},!0),(e.isChanged||this.isChanged||e.isDeleted||this.isDeleted)&&(this.isChanged=!1,ue(!(this.isDeleted=!1)),O.set("text",M.MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED),p.open(),oe(!0))}),r.bind("onClose",function(e){e.sender.options.closeAction(this)}),r.bind("expand",function(e){var t=e.sender.getSelectedData();ne(t)}),r.bind("onEdited",function(e){var t=e.sender.getSelectedData();ne(t)})},te=function(){E.bind("checked",function(e){var t=this.getCheckedData().length;0<t?(A.get("disabled")&&ue(!1),O.set("text",M.MEMBERSHIP_MESSAGE_NOTI_SELCTED_MULTI_MEMBER(t))):0===t&&Me()}),V.on("click",".ic-info",function(e){var t=$(e.currentTarget),i=[];r.setDataSource(i),r.isChanged=!1,r.open(),p.open(Y),ae("users",{ids:E.dataSource.get(t.data("id")).id,exposePolicy:!0}).done(function(t){for(var e=t.length,n=0;n<e;n++)i.push(t[n]);r.setDataSource(i),r.enableSaveBtn(),$(".approve-manager-type-filter").each(function(n,e){$(e).kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:J,value:t[n].role}).data("kendoDropDownList").bind("select",function(e){r.dataSource.data()[n].role=e.dataItem.value;var t=r.element.find("input.account-building-list").data("kendoDropDownCheckBox");t&&("Admin"===e.dataItem.value?t.enable(!1):t.enable(!0))})})}).always(function(){p.close(Y)})}),v.set("click",function(e){W.trigger("click")}),b.set("click",function(e){var n=E.getCheckedData(),i=n.length;1===i?B.message(M.MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MEMBER_APPLICATION):B.message(M.MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MULTI_MEMBER_APPLICATION(i)),B.options.confirmActions.yes=function(){var e,t=[];for(e=0;e<i;e++)t.push({id:n[e].id,registrationStatus:"Rejected"});$.ajax({url:"/ums/users",method:"PATCH",data:t}).done(function(){oe(!0)}).fail(function(e){L.message(u.parseFailResponse(e)),L.open()}).always(function(){p.close()})},B.open()}),P.set("click",function(n){var e=E.getCheckedData(),t=e.length,i="",a=[],o=0;for(o=0;o<t;o++)i+=e[o].id+",";r.setDataSource(a,!1),r.isChanged=!1,r.open(),p.open(Y),ae("users",{ids:i,exposePolicy:!0}).done(function(t){var e=t.length;for(o=0;o<e;o++)a.push(t[o]);pe(a,["id","name","joinDate"]),r.setDataSource(a,!1),1<e&&r.collapseRow(0),n.originalEvent||(r.trigger("onEdit"),r.setEditable(!0),r.enableSaveBtn(),r.trigger("onEdited")),$(".approve-manager-type-filter").each(function(n,e){$(e).kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:J,value:t[n].role}).data("kendoDropDownList").bind("select",function(e){r.dataSource.data()[n].role=e.dataItem.value;var t=r.element.find("input.account-building-list").data("kendoDropDownCheckBox");t&&("Admin"===e.dataItem.value?t.enable(!1):t.enable(!0))})})}).always(function(){p.close(Y)})}),r.bind("onSaved",function(t){var e,n=t.results,i=t.sender.dataSource.data(),a=i.length,o=$("input.approve-manager-type-filter"),s=[];p.open(Y);for(var d=0;d<a;d++){if(e=[],n[d].registrationStatus="Approved",n[d].role=o.eq(d).data("kendoDropDownList").value(),n[d].policy&&n[d].policy.foundation_space_buildings_ids)for(var l=0;l<n[d].policy.foundation_space_buildings_ids.length;l++)e.push(n[d].policy.foundation_space_buildings_ids[l]);delete n[d].policy.menus,0<e.length&&"Admin"!==n[d].role?n[d].policy={foundation_space_buildings_ids:e}:delete n[d].policy.foundation_space_buildings_ids,n[d].id=i[d].id,s.push(n[d])}$.ajax({url:"/ums/users",method:"PATCH",data:s}).done(function(){t.sender.success(),t.sender.isChanged=!0,L.message(M.COMMON_MESSAGE_NOTI_CHANGES_SAVED),r.close(),oe(!0)}).fail(function(e){t.sender.fail(),L.message(u.parseFailResponse(e))}).always(function(){L.open(),p.close(Y)})}),r.setCloseAction(function(e){this._cancelEvent&&this._cancelEvent({sender:this},!0),(e.isChanged||this.isChanged||e.isDeleted||this.isDeleted)&&(this.isChanged=!1,ue(!(this.isDeleted=!1)),O.set("text",M.MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED),oe(!0))}),r.bind("onClose",function(e){e.sender.options.closeAction(this)}),r.bind("expand",function(e){var t=e.sender.getSelectedData();ne(t)}),r.bind("onEdited",function(e){var t=e.sender.getSelectedData();ne(t)}),h.set("click",function(e){d.setDataSource(q),d.open(),d.trigger("onEdit"),d.setEditable(!0),ne(q).selectAll(),d.enableSaveBtn(),d.trigger("onEdited")}),d.bind("onSaved",function(e){var t,i=e.results[0],n=e.sender.element.find(".common-validator"),a=e.sender.element.find("input.account-building-list").data("kendoDropDownCheckBox").value();for(a=""===a?[]:a.split(","),t=0;t<n.length;t++)if(!n.eq(t).data("kendoCommonValidator").validate())return;i.mobilePhoneNumber||delete i.mobilePhoneNumber,i.email||delete i.email,0===a.length||"Admin"===i.role?delete i.policy:!i.policy&&0<a.length&&(i.policy={foundation_space_buildings_ids:a}),delete i.passwordRetype,p.open(j),$.ajax({url:"/ums/users",method:"post",data:i}).done(function(){B.message(M.MEMBERSHIP_MESSAGE_CONFIRM_SIGNUP_ADD_MEMBER),B.setConfirmActions({yes:function(){d.success(),d.setDataSource(q),d.trigger("onEdit"),d.setEditable(!0),ne(q).selectAll(),d.enableSaveBtn(),d.trigger("onEdited")},no:function(){d.success(),d.close()}}),B.open()}).fail(function(e){var t,n=e.status;500===n?t=M.MEMBERSHIP_MESSAGE_NOTI_USED_ID:400===n?t=M.MEMBERSHIP_LOCKED_ID(i.id):e.responseJSON&&211301===e.responseJSON.code?t=M.MEMBERSHIP_ALREADY_EXIST_ID:e.responseJSON&&211303===e.responseJSON.code?(t=M.MEMBERSHIP_MAXIMUM_NUMBER,d.close()):t=u.parseFailResponse(e),L.message(t),L.open()}).always(function(){p.close(j)})})},ne=function(e){e.id=e.id||"none";var t=$('.account-building-list[data-id="'+e.id+'"]').kendoDropDownCheckBox({optionLabel:!1,dataTextField:"name",dataValueField:"id",isAbleUnselectAll:!0,showSelectAll:!0,selectAllText:M.COMMON_FLOOR_NAV_TOTAL,emptyText:M.COMMON_NO_SELECT,dataSource:s.getCurrentBuildingList(),selectionChanged:ie}).data("kendoDropDownCheckBox");if(t){var n,i=e.policy&&e.policy.foundation_space_buildings_ids||[],a=[],o=i.length;for(n=0;n<o;n++)a.push(i[n]);t.value(a),e&&"Admin"===e.role&&t.enable(!1)}return t},ie=function(e){var t=r.options.scheme.fields.policy.editViewModel;t instanceof n.Observable&&(t.fields.policy||t.fields.set("policy",{}),t.fields.policy.set("foundation_space_buildings_ids",e.newValue),r.enableSaveBtn())},ae=function(e,t){var n="/ums/"+e+"?";if(t)for(var i in t)n+=i+"="+t[i]+"&";return n=n.slice(0,-1),$.ajax({url:n})},oe=function(t){p.open(),l===k?ae("users",{roles:"Admin,Manager",registrationStatus:"Approved"}).done(function(e){t&&pe(e,["id","name","role"]),se(e)}).fail(function(e){L.message(u.parseFailResponse(e)),L.open()}).always(function(){p.close()}):l===G&&ae("users",{roles:"Admin,Manager",registrationStatus:"Pending"}).done(function(e){se(e),t&&pe(e,["id","name","joinDate"]),D.set("pendingNum",e.length)}).fail(function(e){L.message(u.parseFailResponse(e)),L.open()}).always(function(){p.close()})},se=function(e){for(var t=e.length,n=i.length=0;n<t;n++)i.push(e[n]);E.setDataSource(c)},de=function(e){for(var t=[],n=e.length,i=0;i<n;i++)t.push($.ajax({method:"delete",url:"/ums/users/"+e[i].id}));return t},le=function(){var e=Ee(["role","name","id","mobilePhoneNumber","lastLogin"]);return C.set("userColumns",e),_=C.get("userColumns"),e},re=function(){var e=Ee(["joinDate","name","id","mobilePhoneNumber"]);return D.set("userColumns",e),_=D.get("userColumns"),e},Ee=function(e){for(var t=[],n=null,i=0;i<e.length;i++)n={field:e[i],title:a[e[i]]},"mobilePhoneNumber"===e[i]?n.template=function(e){return e.mobilePhoneNumber?e.mobilePhoneNumber:"-"}:"lastLogin"===e[i]?n.template=function(e){var t="-";return e.lastLogin&&(t=o(e.lastLogin).format("LLL").replace(/\./g,"/")),t}:"joinDate"===e[i]&&(n.template=function(e){var t="-";return e.joinDate&&(t=o(e.joinDate).format("LLL").replace(/\./g,"/")),t}),t.push(n);return t.push({title:M.COMMON_DETAIL,template:"<span class='ic ic-info' data-id='#:data.id#'></span>",width:130}),t},ce=function(e,t){var n,i,a,o=e.length,s=t.length;if(o!=s)return!1;for(n=0;n<o;n++){for(a=!1,i=0;i<s;i++)e[n]!=t[i]||(a=!0);if(!a)return!1}return!0};function ue(e){l===k?(A.set("disabled",e),I.set("disabled",e),R.set("disabled",e)):l===G&&(v.set("disabled",e),b.set("disabled",e),P.set("disabled",e))}function Me(){E.uncheckAll(),ue(!0),O.set("text",M.MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED)}function pe(o,e){for(var t=0;t<e.length;t++)n(e[t]);function n(e){var t,n,i,a=o.length;for(t=0;t<a-1;t++)for(n=0;n<a-1-t;n++)o[n][e]>o[n+1][e]&&(i=o.splice(n,1),o.splice(n+1,0,i[0]))}}(function(){y.kendoCommonTabStrip(),n.bind(H,m)})(),z(),X()});