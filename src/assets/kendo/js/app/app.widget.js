!function(e){var r=e.kendo,i=r.ui.Tooltip,s=$.isPlainObject,l=r.isFunction,d="k-content-frame",c=r.template("<iframe frameborder='0' class='"+d+"' src='#= content.url #'>This page requires frames in order to show content</iframe>"),u=".kendoTooltip",p=r.isLocalUrl,n=$(document);var t=r.ui.Tooltip=i.extend({options:{wrapperCssClass:"common-tooltip-wrapper",cssClass:"common-tooltip"},init:function(e,t){i.fn.init.call(this,e,t)},_initPopup:function(){var e=this,t=e.options;i.fn._initPopup.call(e),e.popup.element.addClass(t.cssClass),e._addedWrapperClass=e._addWrapperClass.bind(this),e.popup.bind("activate",e._addedWrapperClass)},_addWrapperClass:function(e){var t=this,i=t.options;t.popup.wrapper.addClass(i.wrapperCssClass),t.popup.unbind("activate",t._addedWrapperClass)},_show:function(e){var t=this,i=t.target(),a="";t.popup||t._initPopup(),i&&i[0]!=e[0]&&(t.popup.close(),t.popup.element.kendoStop(!0,!0)),i&&i[0]==e[0]||(a=t._appendContent(e),t.popup.options.anchor=e),t.popup.one("deactivate",function(){!function(e){for(;e.length;)(i=(t=e).data(r.ns+"title"))&&(t.attr("title",i),t.removeData(r.ns+"title")),e=e.parent();var t,i}(e),e.removeAttr("aria-describedby"),this.element.removeAttr("id").attr("aria-hidden",!0),n.off("keydown"+u,t._documentKeyDownHandler)}),null!==a&&t.popup.open()},_appendContent:function(e){var t,i=this,a=i.options.content,n=i.content,o=i.options.iframe;if(s(a)&&a.url)"iframe"in i.options||(o=!p(a.url)),i.trigger("requestStart",{options:a,target:e}),o?(n.hide(),(t=n.find("."+d)[0])?t.src=a.url||t.src:n.html(c({content:a})),n.find("."+d).off("load"+u).on("load"+u,function(){i.trigger("contentLoad"),n.show()})):(n.empty(),r.ui.progress(n,!0),i._ajaxRequest(a));else if(a&&l(a)){if(null===(a=a({sender:this,target:e})))return a;n.html(a||"")}else n.html(a);i.angular("compile",function(){return{elements:n}})}});r.ui.plugin(t)}(window,jQuery),function(t,i){var a=t.kendo,n=a.ui.Tooltip,o=t.moment,r=t.Util,s=10,e=n.extend({options:{name:"MainNavTooltip",popupOptions:{position:"bottom right",origin:"top center"},popupCss:{"margin-top":20},template:null,view:null,data:{errorList:[],warningList:[]},events:{myProfile:null,signOut:null},viewModel:null},init:function(e,t){var i=this;n.fn.init.call(i,e,t),i.viewModel=a.observable({errorList:i.options.data.errorList,warningList:i.options.data.warningList})},_initPopup:function(){var e=this;n.fn._initPopup.call(e),this.popup.setOptions(e.options.popupOptions);var t=this.popup.element.find(".k-icon.k-i-close");0<t.length&&(t.removeClass("k-icon k-i-close"),t.addClass("ic ic-close")),this.popup.element.css(e.options.popupCss),this.popup.element.addClass("main-alarm-tooltip-widget"),this.popup.position(),this._attachEvent()},_attachEvent:function(){var e=t.MAIN_WINDOW;this.popup.element.on("click",".main-alarm-tooltip-item",function(){e.goToMenu("operation","alarm")})},_appendContent:function(e){var t=this;e=e||t.element,n.fn._appendContent.call(t,e);var i=t.content.find(".main-alarm-tooltip-list");0<i.length&&a.bind(i,t.viewModel),t.options.events.myProfile&&t.content.find(".main-user-profile").on("click",t.options.events.myProfile),t.options.events.signOut&&t.content.find(".main-user-signout").on("click",t.options.events.signOut)},updateListRemote:function(e){var t=this;return a.ui.progress(t.content,!0),i.ajax({url:e}).done(function(e){t.updateList(e)}).always(function(){a.ui.progress(t.content,!1)})},addError:function(e,t){var i=this.viewModel.get("originalErrorList");i.unshift(e),t&&i.shift();var a=i.slice(0,s);return this.viewModel.set("errorList",a),!0},removeError:function(e){var t,i=!1,a=this.viewModel.get("originalErrorList"),n=a.length;for(t=0;t<n;t++)if(e.code==a[t].code&&(e.deviceId==a[t].dms_devices_id||e.deviceId==a[t].deviceId)){a.splice(t,1),i=!0;break}var o=a.slice(0,s);return this.viewModel.set("errorList",o),i},addWarning:function(e,t){var i=this.viewModel.get("originalWarningList");i.unshift(e),t&&i.shift();var a=i.slice(0,s);return this.viewModel.set("warningList",a),!0},removeWarning:function(e){var t,i=!1,a=this.viewModel.get("originalWarningList"),n=a.length;for(t=0;t<n;t++)if(e.code==a[t].code&&(e.deviceId==a[t].dms_devices_id||e.deviceId==a[t].deviceId)){a.splice(t,1),i=!0;break}var o=a.slice(0,s);return this.viewModel.set("warningList",o),i},formatDate:function(e){var t,i,a=e.length;for(t=0;t<a;t++)i=e[t],this.setEventTime(i),this.setDescription(i)},setEventTime:function(e){e.eventTime&&(e.eventTime=o(e.eventTime).format("LLL"))},setDescription:function(e){e.name&&(e.name=r.getAlarmDescription(e.name))},setAlarmData:function(e){var t,i=e.length;for(t=0;t<i;t++)r.setAlarmData(e[t])},setErrorList:function(e){this.setAlarmData(e),this.viewModel.set("originalErrorList",e);var t=e.slice(0,s);this.viewModel.set("errorList",t)},getErrorList:function(){return this.viewModel.get("errorList")},setWarningList:function(e){this.setAlarmData(e),this.viewModel.set("originalWarningList",e);var t=e.slice(0,s);this.viewModel.set("warningList",t)},getWarningList:function(){return this.viewModel.get("warningList")},destroy:function(){n.fn.destroy.call(this)}});a.ui.plugin(e)}(window,jQuery),function(d){var e=d.kendo,a=d.Util,o=e.ui.Notification,t=o.extend({options:{name:"MainToast",autoHideAfter:5e3,position:{bottom:55,right:70},width:434},init:function(e,t){o.fn.init.call(this,e,t)},_showPopup:function(e,t){e.addClass("main-noti-toast-widget main-alarm-tooltip-widget"),o.fn._showPopup.call(this,e,t)}});e.ui.plugin(t);var i=d.Howl,n=a.addBuildDateQuery("../../src/main/resources/static-dev/sound/Alarm_Sound.mp3"),r=o.extend({options:{name:"RuleToast",autoHideAfter:0,width:800,height:300,hideOnClick:!1,button:!0,pinned:!0,animation:!1,events:["afterOpen","afterClose"]},init:function(e,t){var i=this;o.fn.init.call(i,e,t),i.overlay=null,i.isLastNoti=!1,i.isPlayedAlarmSound=!1,i.sound=null,i.notiList=[],i._currentContent=null,i._createOverlay(),i._initSound(),this.setOptions({show:i._onShow,hide:i._onHide})},_initSound:function(){this.sound=new i({src:[n],loop:!0})},_createOverlay:function(){var e=$("body"),t=$('<div class="main-noti-overlay"></div>');0<e.find(".main-noti-overlay").length||(e.append(t),this.overlay=e.find(".main-noti-overlay"))},_onShow:function(e){var t,i,a=e.element.parent(),n=a.width(),o=a.height(),r=$(d).width(),s=$(d).height();i=Math.floor(r/2-n/2),t=Math.floor(s/2-o/2),e.element.parent().css({top:t,left:i});var l=e.element.find(".main-alarm-tooltip-list");l.hasClass("critical")?e.element.attr("rule-type","critical"):l.hasClass("warning")&&e.element.attr("rule-type","warning")},_onHide:function(e){},show:function(e,t,i){this._currentContent=e,o.fn.show.call(this,e,t,i)},_showPopup:function(e,t){var i=a.getNewGUID();this._currentContent.alarmUuid=i,e.data("content",this._currentContent),e.addClass("main-noti-toast-rule-widget"),o.fn._showPopup.call(this,e,t),this.overlay.show(),this._playAlarmSound(),this.trigger("afterOpen",{isOpen:!0,data:this._currentContent})},_attachPopupEvents:function(e,t){var i,a=this,n=e.allowHideAfter,o=!isNaN(n)&&0<n,r="click",s=".kendoNotification";function l(e){e.on(r+s,function(){a._hidePopup(t)})}e.hideOnClick?t.bind("activate",function(){o?setTimeout(function(){l(t.element)},n):l(t.element)}):e.button&&(i=t.element.find(".ic.ic-close"),o?setTimeout(function(){l(i)},n):l(i))},_hidePopup:function(e,t){var i=e.element.data("content");this._countNotiWrapper(),this.isLastNoti&&this._onHideLastNoti(),o.fn._hidePopup.call(this,e,t),this.trigger("afterClose",{isOpen:!1,data:i})},_onHideLastNoti:function(){this.overlay.hide(),this._stopAlarmSound()},_playAlarmSound:function(){this.isPlayedAlarmSound||(this.isPlayedAlarmSound=!0,this.sound.play())},_stopAlarmSound:function(){this.isPlayedAlarmSound=!1,this.sound.stop()},_countNotiWrapper:function(){this.countNoti=this.getNotifications().length,1==this.countNoti?this.isLastNoti=!0:this.isLastNoti=!1},closePopup:function(e){if(e)for(var t=this.getNotifications(),i=null,a=null,n=0;n<t.length;n++)i=(a=$(t[n])).data("content"),e.code!=i.code||e.deviceId!=i.dms_devices_id&&e.deviceId!=i.deviceId||a.find(".ic.ic-close").click();else o.fn.hide.call(this)}});e.ui.plugin(r)}(window,jQuery),function(e,c){var u=e.kendo,t=u.ui,p=u.support,i=t.Popup,h=["font-size","font-family","font-stretch","font-style","font-weight","line-height"],f=c(document.documentElement),g=(c(e),p.transitions.css+"transform"),a=(c.extend,t.Popup=i.extend({options:{},open:function(e,t){var i,a,n=this,o={isFixed:!isNaN(parseInt(t,10)),x:e,y:t},r=n.element,s=n.options,l=c(s.anchor),d=r[0]&&r.hasClass("km-widget");if(!n.visible()){if(s.copyAnchorStyles&&(d&&"font-size"==h[0]&&h.shift(),r.css(u.getComputedStyles(l[0],h))),r.data("animating")||n._trigger("open"))return;n._activated=!1,s.modal||(f.unbind(n.downEvent,n._mousedownProxy).bind(n.downEvent,n._mousedownProxy),n._toggleResize(!1),n._toggleResize(!0)),n.wrapper=a=u.wrap(r,s.autosize).css({overflow:"hidden",display:"block",position:"absolute"}),p.mobileOS.android&&a.css(g,"translatez(0)"),a.css("position"),c(s.appendTo)[0]==document.body&&a.css("top","-10000px"),n.flipped=n._position(o),n.flipped?a.addClass("flipped"):a.removeClass("flipped"),i=n._openAnimation(),"body"!=s.anchor&&n._showDirClass(i),r.data("effects",i.effects).kendoStop(!0).kendoAnimate(i)}}}));u.ui.plugin(a)}(window,jQuery),function(c,E){"use strict";var T=c.kendo,u="k-state-selected",M="change",t="input,a,textarea,.k-multiselect-wrap,select,button,.k-button>span,.k-button>img,span.k-icon.k-i-arrow-60-down,span.k-icon.k-i-arrow-60-up,.ic.ic-info,.k-checkbox-label,.k-checkbox,.k-radio,.k-radio-label",n="aria-selected",i=T.support.browser.msie,a=T.ui.Selectable,e=a.extend({options:{name:"Selectable",hasDoubleClickEvt:!1},init:function(e,t){a.fn.init.call(this,e,t),this.userEvents.unbind("start"),this.userEvents.unbind("move"),this.userEvents.unbind("end"),this._pressedShiftKey=!1,this._pressedCtrlKey=!1},_tap:function(e){var t=this;t.options.hasDoubleClickEvt?(void 0===t._clicked&&(t._clicked=0),t._clicked++,1==t._clicked?t._dblclickTimer=setTimeout(function(){t._clicked=0,t._isDblClick=!1,t._tapAction(e)},200):(clearTimeout(t._dblclickTimer),t._isDblClick=!0,t._tapAction(e),t._clicked=0,t._isDblClick=!1)):t._tapAction(e)},_tapAction:function(e){var t,i=E(e.target),a=this,n=a.options.multiple,o=n&&e.event.shiftKey,r=e.event.which,s=e.event.button,l=a.options.isOnlySelection,d=a.options.useSingleSelection;this._pressedShiftKey=o,this._pressedCtrlKey=n&&e.event.ctrlKey,-1<c.navigator.appVersion.indexOf("Mac")&&(this._pressedCtrlKey=n&&e.event.metaKey),!a._isElement(i.closest(".k-selectable"))||r&&3==r||s&&2==s||this._allowSelection(e.event.target)&&((t=i.hasClass(u))&&l||(n||a.clear(),!d||o||this._pressedCtrlKey||a.clear(),i=i.add(a.relatedTarget(i)),o?a.selectRange(a._firstSelectee(),i):(t?(a._unselect(i),a._notify(M)):a.value(i),a._lastActive=a._downTarget=i)))},selectRange:function(e,t){var i,a,n,o,r,s,l,d,c,u=this,p=u.options,h=u.element.closest(".k-grid");if(!p.hasSelectedModel||p.enableShiftSelection||!(o=h.data("kendoTreeList")))if(u.clear(),1<u.element.length&&(n=u.options.continuousItems()),n&&n.length||(n=u.element.find(u.options.filter)),p.hasSelectedModel){o=h.data("kendoTreeList");var f=(h.data("kendoGrid")||o).dataSource,g=E(e).attr("data-uid"),m=E(t).attr("data-uid"),v=f.getByUid(g),_=f.getByUid(m);v||(d=E(e).attr("data-id"),v=f.get(d)),_||(c=E(t).attr("data-id"),_=f.get(c));var b=f.data(),C=new T.data.Query(b),k=f.filter(),w=f.sort();k&&(C=C.filter(k)),w&&(C=C.sort(w));var D,y=C.toArray(),I=y.length,S=!1;for(d=v.id||v.uid,c=_.id||_.uid,D=0;D<I;D++)(l=y[D].id||y[D].uid)==d&&(r=D),l==c&&(s=D),y[D].selected=!1;s<r&&(a=d,d=c,c=a,a=r,r=s,s=a);var x,A,O=n.length;for(D=0;D<I;D++){if(l=y[D].id||y[D].uid,S||l!=d||(S=!0),S)for(y[D].selected=!0,x=0;x<O;x++)if(l==((A=E(n[x])).attr("data-id")||A.attr("data-uid"))){u._selectElement(A);break}if(l==c)break}u._notify(M)}else{for(e=E.inArray(E(e)[0],n),(t=E.inArray(E(t)[0],n))<e&&(a=e,e=t,t=a),u.options.useAllItems||(t+=u.element.length-1),i=e;i<=t;i++)u._selectElement(n[i]);u._notify(M)}},_selectElement:function(e,t){var i=E(e),a=!t&&this._notify("select",{element:e});i.removeClass("k-state-selecting"),a||(i.addClass(u),this.options.aria&&i.attr(n,!0))},_allowSelection:function(e){return!E(e).is(t)||(this.userEvents.cancel(),this._downTarget=null,!1)},_unselect:function(e){return e.removeClass(u),this.options.aria&&e.attr(n,!1),e},_select:function(e){this._allowSelection(e.event.target)&&(i&&(!i||E(T._activeElement()).is(t))||e.preventDefault())}});e.parseOptions=function(e){var t="string"==typeof e&&e.toLowerCase();return{multiple:t&&-1<t.indexOf("multiple"),cell:t&&-1<t.indexOf("cell")}},T.ui.plugin(e)}(window,jQuery),function(n,O){var E=n.kendo,e=E.ui,t=e.TreeList,o=e.DataBoundWidget,r=O.extend,i=E.dom,s=i.element,a=i.text,l=i.html,d=E.data.TreeListDataSource,T=O.proxy,c=O.map,u="change",p="progress",M={wrapper:"k-treelist k-grid k-widget",header:"k-header",button:"k-button",alt:"k-alt",editCell:"k-edit-cell",group:"k-treelist-group",gridToolbar:"k-grid-toolbar",gridHeader:"k-grid-header",gridHeaderWrap:"k-grid-header-wrap",gridContent:"k-grid-content",gridContentWrap:"k-grid-content",gridFilter:"k-grid-filter",footerTemplate:"k-footer-template",loading:"k-i-loading",refresh:"k-i-reload",retry:"k-request-retry",selected:"k-state-selected",status:"k-status",link:"k-link",withIcon:"k-with-icon",filterable:"k-filterable",icon:"k-icon",iconFilter:"k-i-filter",iconCollapse:"k-i-collapse",iconExpand:"k-i-expand",iconHidden:"k-i-none",iconPlaceHolder:"k-icon k-i-none",input:"k-input",dropPositions:"k-i-insert-up k-i-insert-down k-i-plus k-i-insert-middle",dropTop:"k-i-insert-up",dropBottom:"k-i-insert-down",dropAdd:"k-i-plus",dropMiddle:"k-i-insert-middle",dropDenied:"k-i-cancel",dragStatus:"k-drag-status",dragClue:"k-drag-clue",dragClueText:"k-clue-text"};var h=e.TreeList=t.extend({options:{hasSelectedModel:!1,enableShiftSelection:!1,setSelectedAttribute:!1,hasCheckedModel:!1,setCheckedAttribute:!1,hasRadioModel:!1,checkedLimit:!1,selectedLimit:!1,isGroupListMode:!1,onceExpandParentLevel:null,hasDoubleClickEvt:!1,isOnlySelection:!1,isOnlyChildrenSelectable:!1,events:["checked","checkedLimit"]},_draggable:function(){var e=this.options.editable;e&&e.move&&(this._dragging=new E.ui.HierarchicalDragAndDrop(this.wrapper,{$angular:this.$angular,autoScroll:!0,filter:"tbody>tr",itemSelector:"tr",allowedContainers:this.wrapper,hintText:function(e){return e.children("td").map(function(){return O(this).text()}).toArray().join("<span class='k-header k-drag-separator' />")},contains:T(function(e,t){var i=this.dataItem(t),a=this.dataItem(e);return a==i||this.dataSource.contains(a,i)},this),itemFromTarget:function(e){var t=e.closest("tr");return{item:t,content:t}},dragstart:T(function(e){this.wrapper.addClass("k-treelist-dragging");var t=this.dataItem(e);return this.trigger("dragstart",{source:t})},this),drag:T(function(e){e.source=this.dataItem(e.source),this.trigger("drag",e)},this),drop:T(function(e){return e.source=this.dataItem(e.source),e.destination=this.dataItem(e.destination),this.wrapper.removeClass("k-treelist-dragging"),this.trigger("drop",e)},this),dragend:T(function(e){var t=this.dataItem(e.destination),i=this.dataItem(e.source);this.options.customDragEndEvent||i.set("parentId",t?t.id:null),e.source=i,e.destination=t,this.trigger("dragend",e)},this),reorderable:!1,dropHintContainer:function(e){return e.children("td:eq(1)")},dropPositionFrom:function(e){return 0<e.prevAll(".k-i-none").length?"after":"before"}}))},init:function(e,t){if(void 0===t.messages||void 0===t.messages.noRows){var i=n.I18N;t.messages||(t.messages={}),t.messages.noRows=i.prop("COMMON_NO_DATA_AVAILABLE_GRID")}if(this._createCheckedColumn(t),o.fn.init.call(this,e,t),this.options.isGroupListMode&&(this._currentExpandedModel={}),this._dataSource(this.options.dataSource),this._columns(),this._layout(),this._selectable(),this._sortable(),this._resizable(),this._filterable(),this._attachEvents(),this._toolbar(),this._scrollable(),this._reorderable(),this._columnMenu(),this._minScreenSupport(),this._draggable(),this.options.autoBind&&this.dataSource.fetch(),this._hasLockedColumns){var a=this;this.wrapper.addClass("k-grid-lockedcolumns"),this._resizeHandler=function(){a.resize()},O(n).on("resize.kendoTreeList",this._resizeHandler)}E.notify(this),this._createCheckedModel()},_columns:function(){var e=this.options.columns||[];this.columns=c(e,function(e){return r({encoded:!0},e="string"==typeof e?{field:e}:e)});var t=this._lockedColumns();0<t.length&&(this._hasLockedColumns=!0,this.columns=t.concat(this._nonLockedColumns())),this._ensureExpandableColumn(),this._columnTemplates(),this._columnAttributes()},_createCheckedColumn:function(e){if((e.hasCheckedModel||e.hasRadioModel)&&e.columns){var t,i,a,n=e.columns,o=!1;for(i=n.length,t=0;t<i;t++)if("checked"==(a=n[t]).field){o=!0;break}o?a=this._setCheckedModelColumn(a,e):(a=this._setCheckedModelColumn({},e),n.unshift(a))}},_createCheckedModel:function(e,t){var i=(t=this.options).hasCheckedModel,a=t.hasRadioModel,n=t.setCheckedAttribute,o=this.dataSource;if(i||a){this.checkedIds=[];var r,s=o.data();if(n)for(r=0;r<void 0;r++)s[r].checked=!1;this._attachCheckedModelEvt()}},_attachCheckedModelEvt:function(){var s=this,e=O(this.element);e.off("click"),e.on("click","tr:not(.k-treelist-group) .grid-checkbox-cell .k-checkbox",function(e){var t,i=O(this),a=s._findItemFromCheckbox(i),n=i.prop("checked"),o=s.options.checkedLimit;if(!1!==o&&0!=o&&n&&s.getCheckedData().length>=o)return!1;a.checked=n,a&&a.parent_id&&(t=s.dataSource.get(a.parent_id),s.setGroupCheckbox(t)),s.setHeaderCheckbox(),s.trigger("checked",{isHeader:!1,item:a,checkbox:i})}),e.on("click",".grid-checkbox-header .k-checkbox",function(e){var t=O(this),i=t.prop("checked"),a=s.options.checkedLimit;if(!1!==a&&0!=a&&i&&s.getCheckedData().length>=a)return!1;s.trigger("dataBinding"),i?s.checkAll(!0):s.uncheckAll(),s.trigger("checked",{isHeader:!0,item:null,checkbox:t})}),e.on("click","tr.k-treelist-group .grid-checkbox-cell .k-checkbox",function(e){var t,i=O(this),a=s._findItemFromCheckbox(i),n=i.prop("checked"),o=s.options.checkedLimit;if(!1!==o&&0!=o&&n&&s.getCheckedData().length>=o)return!1;a.checked=n,s.trigger("dataBinding"),t=n?s.checkGroup(!0,a,!0):s.checkGroup(!0,a,!1),t=new E.data.Query(t).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:n},{field:"hasChildren",operator:"eq",value:!1}]}),s.dataSource.fetch();var r={isGroupHeader:!0,parent:parent,item:t,checkbox:i,checked:n};s.trigger("dataBound",r),s.trigger("checked",r)}),this.bind("dataBound",function(e){this.setHeaderCheckbox()})},_findItemFromCheckbox:function(e){var t=this.dataSource,i=e.closest("tr").attr("data-id");return t.get(i)},_setCheckedModelColumn:function(e,t){return(e=e||{}).field||(e.field="checked"),e.width||(e.width=37),e.attributes||(e.attributes={class:"grid-checkbox-cell"}),e.template||(t.hasCheckedModel?e.template=this._checkedModelTemplate:t.hasRadioModel&&(e.template=this._radioModelTemplate)),e.headerAttributes||(e.headerAttributes={class:"grid-checkbox-header k-header"}),e.headerTemplate||(t.hasCheckedModel?e.headerTemplate=this._checkedModelHeaderTemplate:t.hasRadioModel&&(e.headerTemplate="")),void 0===e.sortable&&(e.sortable=!1),void 0===e.editable&&(e.editable=!1),e},_checkedModelTemplate:function(e){var t=e.id,i=e.uid;return'<input type="checkbox" id="check_'+t+"_"+i+'" class="k-checkbox" '+(e.checked?"checked":"")+'><label for="check_'+t+"_"+i+'" class="k-checkbox-label"></label>'},_checkedModelHeaderTemplate:function(){var e=E.guid();return'<input type="checkbox" id="check_header_'+e+'" class="k-checkbox"><label for="check_header_'+e+'" class="k-checkbox-label"></label>'},checkAll:function(e,t){var i=this.dataSource,a=i.data();if(e)if(i.pageSize()){var n=new E.data.Query(i.data()),o=i.filter();o&&(n=n.filter(o));var r=i.sort();r&&(n=n.sort(r)),a=n.toArray()}else a=i.flatView();var s=this.options.checkedLimit;!1!==s&&0!=s&&(t=s);var l,d=new E.data.Query(a).filter({field:"hasChildren",operator:"eq",value:!1}).toArray(),c=d.length,u=new E.data.Query(d).filter({field:"checked",operator:"eq",value:!0}).toArray();u.length&&t&&(t-=u.length);var p,h,f,g=(t=c<=t?c:t)||c,m=[];for(p=0;p<g;p++)(l=d[p]).checked=!0,-1==m.indexOf(l.parent_id)&&m.push(l.parent_id);for(g=m.length,p=0;p<g;p++)h=m[p],(f=i.get(h))&&this.setSubGroupCheckbox(f,!0);i.fetch()},checkByIds:function(e,t,i,a){var n=this.dataSource,o=n.data();if(a)if(n.pageSize()){var r=new E.data.Query(n.data()),s=n.filter();s&&(r=r.filter(s));var l=n.sort();l&&(r=r.sort(l)),o=r.toArray()}else o=n.flatView();var d=this.options.checkedLimit;!1!==d&&0!=d&&(i=d);var c,u=new E.data.Query(o).filter({field:"hasChildren",operator:"eq",value:!1}).toArray(),p=u.length,h=new E.data.Query(u).filter({field:"checked",operator:"eq",value:!0}).toArray();h.length&&i&&(i-=h.length);var f,g,m,v,_=(i=p<=i?p:i)||p,b=e.length,C=[];for(f=0;f<_;f++)for(c=u[f],g=0;g<b;g++)c.id==e[g]&&(c.checked=t,-1==C.indexOf(c.parent_id)&&C.push(c.parent_id));for(_=C.length,f=0;f<_;f++)m=C[f],(v=n.get(m))&&this.setSubGroupCheckbox(v,!0);n.fetch()},checkById:function(e,t){var i=this,a=i.dataSource,n=i.options.checkedLimit;if(!1!==n&&0!=n&&t&&i.getCheckedData().length>=n)return!1;var o,r=a.get(e);r.checked=t,i.element.find("tr[data-id='"+e+"'] .grid-checkbox-cell .k-checkbox").prop("checked",t),r&&r.parent_id&&(o=i.dataSource.get(r.parent_id),i.setGroupCheckbox(o)),i.setHeaderCheckbox()},checkByData:function(e,t){var i,a=this,n=e.id,o=a.options.checkedLimit;if(!1!==o&&0!=o&&t&&a.getCheckedData().length>=o)return!1;e.checked=t,this.element.find("tr[data-id='"+n+"'] .grid-checkbox-cell .k-checkbox").prop("checked",t),e&&e.parent_id&&(i=a.dataSource.get(e.parent_id),a.setGroupCheckbox(i)),a.setHeaderCheckbox()},uncheckAll:function(e){var t=this.dataSource,i=t.data();if(e)if(t.pageSize()){var a=new E.data.Query(t.data()),n=t.filter();n&&(a=a.filter(n));var o=t.sort();o&&(a=a.sort(o));var r=t.group();r&&(a=a.group(r)),i=a.toArray()}else i=t.flatView();var s,l=i.length;for(s=0;s<l;s++)i[s].hasCheckedChild&&(i[s].hasCheckedChild=!1),i[s].checked=!1;t.fetch()},isAllChecked:function(e){var t=this.dataSource,i=!0,a=t.data();if(e)if(t.pageSize()){var n=new E.data.Query(t.data()),o=t.filter();o&&(n=n.filter(o));var r=t.sort();r&&(n=n.sort(r));var s=t.group();s&&(n=n.group(s)),a=n.toArray()}else a=t.flatView();var l,d=a.length;if(0==d)return!1;var c=this.options.checkedLimit;if(!1!==c&&0!=c)this.getCheckedData().length<c&&(i=!1);else for(l=0;l<d;l++)if(!a[l].checked){i=!1;break}return i},setHeaderCheckbox:function(){var e=this.isAllChecked(!0),t=this.element.find(".grid-checkbox-header .k-checkbox");e?t.prop("checked",!0):t.prop("checked",!1)},setGroupCheckbox:function(e){this.setSubGroupCheckbox(e)},setSubGroupCheckbox:function(e,t){var i,a,n,o,r,s,l=this.dataSource,d=e.id,c=e.parent_id;a=(i=this.isCheckedAllGroup(e)).isCheckedAll,n=i.hasCheckedChild,e.checked=a,t||((o=this.getGroupCheckbox(d)).prop("checked",a),r=o.closest("tr"),n?r.addClass("has-checked-child"):r.removeClass("has-checked-child")),c&&(s=l.get(c),this.setSubGroupCheckbox(s,t))},getGroupCheckbox:function(e){return this.element.find("tr.k-treelist-group[data-id='"+e+"'] .grid-checkbox-cell .k-checkbox")},isCheckedAllGroup:function(e){var t,i=e.id,a=this.dataSource.flatView(),n=new E.data.Query(a).filter({field:"parent_id",operator:"eq",value:i}).toArray(),o=this.options.checkedLimit;!1!==o&&0!=o&&(t=o);var r,s=n.length,l=!0,d=!1,c=new E.data.Query(n).filter({field:"checked",operator:"eq",value:!0}).toArray(),u=new E.data.Query(n).filter({field:"hasCheckedChild",operator:"eq",value:!0}).toArray();return(0<(r=c.length)||0<u.length)&&(d=!0),t||r==s||(l=!1),t&&r<(s=t>=n.length?n.length:t)&&(l=!1),{isCheckedAll:l,hasCheckedChild:e.hasCheckedChild=d}},checkGroup:function(e,t,i,a){var n,o=t.id,r=this.dataSource;if(e)if(r.pageSize()){var s=new E.data.Query(r.data()),l=r.filter();l&&(s=s.filter(l));var d=r.sort();d&&(s=s.sort(d)),n=s.toArray()}else n=r.flatView();else n=r.data();var c=new E.data.Query(n).filter({logic:"and",filters:[{field:"parent_id",operator:"eq",value:o}]}).toArray(),u=this.options.checkedLimit;!1!==u&&0!=u&&(a=u);var p,h,f=[];if(a&&i&&a<=(f=new E.data.Query(n).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:i},{field:"hasChildren",operator:"eq",value:!1}]}).toArray()).length)return this.trigger("checkedLimit",{length:a}),[];if(a&&i){h=(a-=f.length)>=c.length?c.length:a;var g=c.length,m=0;for(p=0;p<g&&(c[p].hasChildren?(this.checkGroup(e,c[p],i,a),this.setSubGroupCheckbox(c[p],!0)):(c[p].checked=i,m++),!(h<=m));p++);0<m&&(t.hasCheckedChild=i,this.setSubGroupCheckbox(t,!0))}else{for(h=c.length,p=0;p<h;p++)c[p].hasChildren?(this.checkGroup(e,c[p],i,a),this.setSubGroupCheckbox(c[p],!0)):c[p].checked=i;t.hasCheckedChild=i,this.setSubGroupCheckbox(t,!0)}return n},hasSelectedChild:function(e){var t=this.dataSource.data();return 0<new E.data.Query(t).filter({logic:"and",filters:[{field:"parent_id",operator:"eq",value:e.id},{logic:"or",filters:[{field:"selected",operator:"eq",value:!0},{field:"hasCheckedChild",operator:"eq",value:!0}]}]}).toArray().length},updateParentSelected:function(e){var t,i=this.element,a=this.dataSource.parentNode(e);a&&(t=i.find("tr[data-id='"+a.id+"']"),this.hasSelectedChild(a)?(a.hasCheckedChild=!0,t.addClass("has-checked-child")):(a.hasCheckedChild=!1,t.removeClass("has-checked-child")),a.parent_id&&this.updateParentSelected(a))},_selectable:function(){var e,t,i=this.options.selectable,a=this.options.isOnlyChildrenSelectable,n=this.table,c=this;i&&(i=E.ui.Selectable.parseOptions(i),this._hasLockedColumns&&(n=n.add(this.lockedTable),t=i.multiple&&i.cell),e=">tbody>tr:not(.k-footer-template)"+(i.multiple||a?":not(.k-treelist-group)":""),i.cell&&(e+=">td"),this.selectable=new E.ui.Selectable(n,{filter:e,aria:!0,multiple:i.multiple,hasSelectedModel:c.options.hasSelectedModel,enableShiftSelection:c.options.enableShiftSelection,hasDoubleClickEvt:c.options.hasDoubleClickEvt,isOnlySelection:c.options.isOnlySelection,change:function(e){var t={};if(c.options.hasSelectedModel){var i,a=O(e.sender.userEvents.currentTarget),n=a.data("uid");if(n&&(i=c.dataSource.getByUid(n)),i){var o,r=a.hasClass("k-state-selected");if(r&&c.options.selectedLimit){var s=c.dataSource.data();if((o=new E.data.Query(s).filter({field:"selected",operator:"eq",value:!0}).toArray()).length>=c.options.selectedLimit)return(a=O(e.sender.userEvents.currentTarget)).removeClass("k-state-selected"),!1}if(!this.options.multiple){var l,d=(o=c.getSelectedData()).length;for(l=0;l<d;l++)o[l].selected=!1}i.selected=r,c.updateParentSelected(i),t.item=i}}t.isDoubleClick=this._isDblClick,c.trigger(u,t)},useAllItems:t,continuousItems:T(this._continuousItems,this,e,i.cell),relatedTarget:!i.cell&&this._hasLockedColumns?T(this._selectableTarget,this):void 0}))},_flushCache:function(){this._templateColumns().length&&(this._contentTree.render([]),this._hasLockedColumns&&this._lockedContentTree.render([]))},_render:function(e){e=e||{};var t,i=this.options.messages,a=this.options.hasSelectedModel,n=this.options.hasCheckedModel,o=this.dataSource.rootNodes(),r=E.attr("uid");t=a||n?[]:this.select().removeClass("k-state-selected").map(function(e,t){return O(t).attr(r)}),this._absoluteIndex=0,this._angularItems("cleanup"),this._angularFooters("cleanup"),this._flushCache(),e.error?this._showStatus(E.template("#: messages.requestFailed # <button class='#= buttonClass #'>#: messages.retry #</button>")({buttonClass:[M.button,M.retry].join(" "),messages:i})):o.length?(this._hideStatus(),this._contentTree.render(this._trs({columns:this._nonLockedColumns(),aggregates:e.aggregates,selected:t,data:o,visible:!0,level:0})),this._hasLockedColumns&&(this._absoluteIndex=0,this._lockedContentTree.render(this._trs({columns:this._lockedColumns(),aggregates:e.aggregates,selected:t,data:o,visible:!0,level:0})))):this._showStatus(E.htmlEncode(i.noRows)),this._touchScroller&&this._touchScroller.contentResized(),this._muteAngularRebind(function(){this._angularItems("compile"),this._angularFooters("compile")}),a||n||this.items().filter(function(){return 0<=O.inArray(O(this).attr(r),t)}).addClass("k-state-selected"),this._adjustRowsHeight()},_toggleChildren:function(e){var t=O(e.currentTarget),i=this.options,a=this.dataItem(t),n=a.expanded?"collapse":"expand";if(!this.trigger(n,{model:a})){var o=i.onceExpandParentLevel?i.onceExpandParentLevel:this.lastParentLevel;if(i.isGroupListMode&&a.level>=o){var r=this._currentExpandedModel,s=a.level;if(r[s]&&r[s]!==a){var l,d,c=this.dataSource;for(r[s].expanded=!1,d=r[s]=a,l=s-1;0<=l;l--)d=c.parentNode(d),r[l]!==d&&(r[l].expanded=!1,r[l]=d)}}this._toggle(a)}e.preventDefault()},_trs:function(e){var t,i,a,n,o,r,s,l,d,c,u,p,h,f,g,m=[],v=this.options,_=v.hasSelectedModel,b=v.hasCheckedModel,C=v.isGroupListMode,k=this._currentExpandedModel,w=v.onceExpandParentLevel?v.onceExpandParentLevel:this.lastParentLevel,D=e.level,y=e.data,I=this.dataSource,S=I.flatView(),x=I.aggregates()||{},A=e.columns;for(r=0,c=y.length;r<c;r++){if(a=[],n=(o=(t=y[r]).loaded()&&I.childNodes(t))&&o.length,(i={role:"row"})[E.attr("uid")]=t.uid,t.id&&(i["data-id"]=t.id),void 0!==t.level&&null!==t.level&&(i["data-level"]=t.level),t.parent_id&&(a.push("child"),0==r&&a.push("children-first-item"),r==c-1&&a.push("children-last-item")),n&&(i["aria-expanded"]=!!t.expanded,t.field&&(i["data-field"]=t.field),t.value&&(i["data-value"]=t.value),u=t.hasCheckedChild,(b||_)&&u&&a.push("has-checked-child"),g=t.aggregates,f=t.field,g&&g[f]&&g[f].count)){if(h=S.indexOf(t),l=S.length,d=0,-1!==h)for(s=h+1;s<l;s++)if(S[s].hasChildren){if(S[s].level==t.level)break}else d++;g[f].count=d}if(e.visible?(this._absoluteIndex%2!=0&&a.push(M.alt),this._absoluteIndex++):i.style={display:"none"},_?t.selected&&a.push("k-state-selected"):b?t.checked&&a.push("k-state-checked"):0<=O.inArray(t.uid,e.selected)&&a.push(M.selected),n&&a.push(M.group),t._edit&&a.push("k-grid-edit-row"),i.className=a.join(" "),m.push(this._tds({model:t,attr:i,level:D},A,T(this._td,this))),n){if(k&&(p=k[t.level]),C&&w<=t.level&&(!p||p.field!==t.field||p.value!==t.value))continue;m=m.concat(this._trs({columns:A,aggregates:x,selected:e.selected,visible:e.visible&&!!t.expanded,data:o,level:D+1}))}}return this._hasFooterTemplate()&&(i={className:M.footerTemplate,"data-parentId":t.parentId},e.visible||(i.style={display:"none"}),m.push(this._tds({model:x[t.parentId],attr:i,level:D},A,this._footerTd))),m},_td:function(e){var t,i=[],a=e.model,n=e.column,o={role:"gridcell",style:!0===n.hidden?{display:"none"}:{}};return a._edit&&n.field&&a.editable(n.field)?o[E.attr("container-for")]=n.field:(n.expandable&&(i=function(e){for(var t=[],i=e.className,a=0,n=e.level;a<n;a++)t.push(s("span",{className:i}));return t}({level:e.level,className:M.iconPlaceHolder}),t=[M.icon],a.hasChildren?t.push(a.expanded?M.iconCollapse:M.iconExpand):t.push(M.iconHidden),a._error?t.push(M.refresh):!a.loaded()&&a.expanded&&t.push(M.loading),i.push(s("span",{className:t.join(" ")})),o.style["white-space"]="nowrap"),n.attributes&&r(!0,o,n.attributes),n.command?i=a._edit?this._buildCommands(["update","canceledit"]):this._buildCommands(n.command):i.push(this._cellContent(n,a))),s("td",o,i)},_cellContent:function(e,t){var i;return e.template?i=e.template(t):e.field&&null!==(i=t.get(e.field))&&e.format&&(i=E.format(e.format,i)),null==i&&(i=""),e.template||!e.encoded?l(i):a(i)},setDataSource:function(e){this._dataSource(e),this._sortable(),this._filterable(),this._contentTree.render([]),this.options.autoBind&&this.dataSource.fetch()},_dataSource:function(e){var t=this.dataSource,i=this.options,a=i.isGroupListMode;if(e&&a&&e instanceof E.data.DataSource&&(e=this.createTreeListDataSource(e)),t&&(t.unbind(u,this._refreshHandler),t.unbind("error",this._errorHandler),t.unbind(p,this._progressHandler)),this._refreshHandler=T(this.refresh,this),this._errorHandler=T(this._error,this),this._progressHandler=T(this._progress,this),t=this.dataSource=d.create(e),a){var n=this._currentExpandedModel[this.lastParentLevel];n?this.expandModel(n):this.expandModel()}t.bind(u,this._refreshHandler),i.hasCheckedModel&&t.bind(u,this._updateCheckboxEvt),t.bind("error",this._errorHandler),t.bind(p,this._progressHandler),this._dataSourceFetchProxy=T(function(){this.dataSource.fetch()},this)},setColumnWidth:function(e,t){var i,a=this.options.columns,n=a.length;for(i=0;i<n&&a[i].field!=e;i++);var o=this.element.find(".k-grid-header table colgroup"),r=this.element.find(".k-grid-content table colgroup"),s=o.find("col").eq(i);s.css("width",t),(s=r.find("col").eq(i)).css("width",t)},_updateCheckboxEvt:function(e){var t,i,a,n=e.action,o=e.items,r=e.field;if("itemchange"==n&&"checked"==r){for(i=o.length,t=0;t<i;t++)(a=o[t]).hasChildren&&this.setGroupCheckbox(a);this.setHeaderCheckbox()}},createGroupToTreeDs:function(e,t,i,a,n,o){t=t||null,null==i&&(i=0);var r,s,l,d,c,u,p,h=e.length,f=[];for(r=0;r<h;r++)if((d={}).field=e[r].field,d.value=e[r].value,d.aggregates=e[r].aggregates,d.parent_id=t,d.parent_value=o,d.id=E.guid(),d.level=i,(!this.lastParentLevel||this.lastParentLevel<i)&&(this.lastParentLevel=i),d.treeGroup=!0,f.push(d),e[r].hasSubgroups)l=this.createGroupToTreeDs(e[r].items,d.id,i+1,a,n,d.value),f=f.concat(l);else for(u=(s=e[r].items).length,c=0;c<u;c++)(p=s[c]).level=i+1,p.parent_id=d.id,p.id||(p.id=E.guid()),p instanceof E.data.ObservableObject&&(p=p.toJSON()),f.push(p);return f},createTreeListDataSource:function(e){var t,i,a=e.data(),n=e.filter(),o=e.sort(),r=e.group();i=r&&0<r.length?(t=new E.data.Query(a),o&&(t=t.sort(o)),(t=t.group(r)).toArray()):[];var s=this.createGroupToTreeDs(i),l=new E.data.TreeListDataSource({data:s,schema:{model:{id:"id",parentId:"parent_id",fields:{parent_id:{type:"string",nullable:!0}}}}});return l.read(),n&&l.filter(n),l},expandModel:function(e){var t,i,a=this,n=this.dataSource,o=n.flatView(),r=o.length,s=a.lastParentLevel;if(e){for(t=0;t<r;t++)if(o[t].field==e.field&&o[t].value==e.value&&o[t].parent_value==e.parent_value)return null!==o[t].parent_id&&(i=n.get(o[t].parent_id),a.expandModel(i)),a._currentExpandedModel[o[t].level]=o[t],void(o[t].expanded=!0);a.expandModel(null)}else for(t=0;t<r;t++)if(o[t].field&&o[t].treeGroup&&o[t].level==s&&a.hasChildrenInView(o[t],n))return e=o[t],null!==(a._currentExpandedModel[o[t].level]=e).parent_id&&(i=n.get(e.parent_id),a.expandModel(i)),void(o[t].expanded=!0)},hasChildrenInView:function(e,t){if(!t.filter())return!0;var i,a,n=t.view(),o=n.length;for(i=0;i<o;i++)if(n[i]===e)return!((a=i+1)<o&&n[a]&&n[a].treeGroup);return!1},getSelectedData:function(){var e=this.dataSource.data();return new E.data.Query(e).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray()},getCheckedData:function(){var e=this.dataSource.data();return new E.data.Query(e).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:!0},{field:"hasChildren",operator:"eq",value:!1}]}).toArray()},getUncheckedData:function(){var e=this.dataSource.data();return new E.data.Query(e).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:!1},{field:"hasChildren",operator:"eq",value:!1}]}).toArray()},_setAllSelectedModel:function(e,t,i){var a,n,o=this.dataSource;if(t)if(o.pageSize()){var r=new E.data.Query(o.data()),s=o.filter();s&&(r=r.filter(s));var l=o.sort();l&&(r=r.sort(l));var d=o.group();d&&(r=r.group(d)),n=r.toArray()}else n=o.flatView();else n=o.data();var c,u=(i=i&&(i>=n.length?a.length:i))||n.length;for(c=0;c<u;c++)(a=n[c]).selected=e,(a.hasChildren||a.treeGroup)&&(a.hasCheckedChild=e);o.fetch()},selectAll:function(e,t){if(this.options.hasSelectedModel){var i=this.options.selectedLimit;!1!==i&&0!=i&&(t=i),this._setAllSelectedModel(!0,e,t)}},unselectAll:function(){this.clearSelection()},clearSelection:function(){this.selectable&&this.selectable.clear(),this.options.hasSelectedModel&&this._setAllSelectedModel(!1)},selectByData:function(e){var t,i,a,n=e.length,o=this.dataSource,r=this.options.hasSelectedModel;for(t=0;t<n;t++)i=e[t],(a=o.get(i.id))&&(r?(a.selected=!0,this.updateParentSelected(a)):this.element.find("tr[data-uid='"+a.uid+"']").addClass("k-state-selected"));r&&o.fetch()}});E.ui.plugin(h)}(window,jQuery),function(I,S){var x=I.kendo,e=x.ui,g=x.support.tbodyInnerHtml,o=e.Widget,n=x._outerHeight,s=x.keys,A=S.isPlainObject,O=S.extend,E=S.grep,p=S.isArray,d=S.inArray,m=S.proxy,h=Math,c=".kendoGrid",v="change",u="dataBound",l="k-state-selected",T="function",f="string",_=/(\}|\#)/gi,b=/#/gi,C=!1,t=x.support.browser,k=t.msie&&7==t.version,i=e.Grid;function M(e){var t,i,a,n={};for(i=0,a=e.length;i<a;i++)n[(t=e[i]).value]=t.text;return n}function w(e,t,i,a,n){return'<tr role="row" class="k-grouping-row" data-field="'+a+'" data-value="'+n+'" data-level="'+t+'">'+y(t)+'<td colspan="'+e+'" aria-expanded="true"><p class="k-reset"><a class="k-icon k-i-collapse" href="#" tabindex="-1"></a></p><div class="grid-group-row-wrapper">'+i+"</div></td></tr>"}function D(e){return'<tr role="row" class="k-grouping-row"><td colspan="'+e+'" aria-expanded="true"><p class="k-reset">&nbsp;</p></td></tr>'}function y(e){return new Array(e+1).join('<td class="k-group-cell">&nbsp;</td>')}function L(e){var t,i=" ";if(e){if(typeof e===f)return e;for(t in e)i+=t+'="'+e[t]+'"'}return i}function N(e){return E(e,function(e){var t=!e.hidden;return t&&e.columns&&(t=0<N(e.columns).length),t})}function F(e){return E(e,function(e){return e.locked&&0<N([e]).length})}function R(e){for(var t=[],i=0;i<e.length;i++)e[i].hidden||(e[i].columns?t=t.concat(R(e[i].columns)):t.push(e[i]));return t}var B=o.extend({init:function(e,t){var i=this;o.fn.init.call(i,e,t),i._refreshHandler=m(i.refresh,i),i.setDataSource(t.dataSource),i.wrap()},setDataSource:function(e){var t=this;t.dataSource&&t.dataSource.unbind(v,t._refreshHandler),t.dataSource=e,t.dataSource.bind(v,t._refreshHandler)},options:{name:"VirtualScrollable",itemHeight:S.noop,prefetch:!0,cardNum:null},destroy:function(){var e=this;o.fn.destroy.call(e),e.dataSource.unbind(v,e._refreshHandler),e.wrapper.add(e.verticalScrollbar).off(c),e.drag&&(e.drag.destroy(),e.drag=null),e.wrapper=e.element=e.verticalScrollbar=null,e._refreshHandler=null},wrap:function(){var t,i=this,e=x.support.scrollbar()+1,a=i.element;a.css({width:"auto",overflow:"hidden"}).css(C?"padding-left":"padding-right",e),i.content=a.children().first(),t=i.wrapper=i.content.wrap('<div class="k-virtual-scrollable-wrap"/>').parent().bind("DOMMouseScroll"+c+" mousewheel"+c,m(i._wheelScroll,i)),x.support.kineticScrollNeeded&&(i.drag=new x.UserEvents(i.wrapper,{global:!0,start:function(e){e.sender.capture()},move:function(e){i.verticalScrollbar.scrollTop(i.verticalScrollbar.scrollTop()-e.y.delta),t.scrollLeft(t.scrollLeft()-e.x.delta),e.preventDefault()}})),i.verticalScrollbar=S('<div class="k-scrollbar k-scrollbar-vertical" />').css({width:e}).appendTo(a).bind("scroll"+c,m(i._scroll,i))},_wheelScroll:function(e){if(!e.ctrlKey){var t=this.verticalScrollbar,i=t.scrollTop(),a=x.wheelDeltaY(e);!a||0<a&&0===i||a<0&&i+t[0].clientHeight==t[0].scrollHeight||(e.preventDefault(),this.verticalScrollbar.scrollTop(i+-a))}},_scroll:function(e){var t=this,i=!t.options.prefetch,a=e.currentTarget.scrollTop,n=t.dataSource,o=t.itemHeight,r=n.skip()||0,s=t._rangeStart||r,l=t.element.innerHeight(),d=!!(t._scrollbarTop&&t._scrollbarTop>a),c=h.max(h.floor(a/o),0),u=h.max(c+h.floor(l/o),0);t._scrollTop=a-s*o,t._scrollbarTop=a,t._scrolling=i,t._fetch(c,u,d)||(t.wrapper[0].scrollTop=t._scrollTop),i&&(t._scrollingTimeout&&clearTimeout(t._scrollingTimeout),t._scrollingTimeout=setTimeout(function(){t._scrolling=!1,t._page(t._rangeStart,t.dataSource.take())},100))},itemIndex:function(e){return(this._rangeStart||this.dataSource.skip()||0)+e},position:function(e){var t,i=this._rangeStart||this.dataSource.skip()||0,a=this.dataSource.pageSize();return a<(t=i<e?e-i+1:i-e-1)?a:t},scrollIntoView:function(e){var t=this.wrapper[0],i=t.clientHeight,a=this._scrollTop||t.scrollTop,n=e[0].offsetTop,o=e[0].offsetHeight;n<a?this.verticalScrollbar[0].scrollTop-=i/2:a+i<=n+o&&(this.verticalScrollbar[0].scrollTop+=i/2)},_fetch:function(e,t,i){var a=this,n=a.dataSource,o=a.itemHeight,r=n.take(),s=a._rangeStart||n.skip()||0,l=h.floor(e/r)*r,d=!1;return e<s?(d=!0,s=h.max(0,t-r),a._scrollTop=(e-s)*o,a._page(s,r)):s+r<=t&&!i?(d=!0,s=e,a._scrollTop=o,a._page(s,r)):!a._fetching&&a.options.prefetch&&(e<l+r-.33*r&&r<e&&n.prefetch(l-r,r,S.noop),l+.33*r<t&&n.prefetch(l+r,r,S.noop)),d},fetching:function(){return this._fetching},_page:function(e,t){var i=this,a=!i.options.prefetch,n=i.dataSource;clearTimeout(i._timeout),i._fetching=!0,i._rangeStart=e;var o=i.options.cardNum;if(o){var r=e%o;0<r&&(e=e-r+o)}n.inRange(e,t)?n.range(e,t):(a||x.ui.progress(i.wrapper.parent(),!0),i._timeout=setTimeout(function(){i._scrolling||(a&&x.ui.progress(i.wrapper.parent(),!0),n.range(e,t))},100))},repaintScrollbar:function(){var e,t,i,a=this,n="",o=a.dataSource,r=x.support.kineticScrollNeeded?0:x.support.scrollbar(),s=a.wrapper[0];i=a.itemHeight=a.options.itemHeight()||0;var l=s.scrollWidth>s.offsetWidth?r:0,d=o.total(),c=a.options.cardNum;c&&(d=d-d%c+c);for(e=d*i+l,t=0;t<h.floor(e/25e4);t++)n+='<div style="width:1px;height:250000px"></div>';e%25e4&&(n+='<div style="width:1px;height:'+e%25e4+'px"></div>'),a.verticalScrollbar.html(n),s.scrollTop=a._scrollTop},refresh:function(){var e=this,t=e.dataSource,i=e._rangeStart;x.ui.progress(e.wrapper.parent(),!1),clearTimeout(e._timeout),e.repaintScrollbar(),e.drag&&e.drag.cancel(),i&&!e._fetching&&(e._rangeStart=t.skip(),1===t.page()&&(e.verticalScrollbar[0].scrollTop=0)),e._fetching=!1}});x.ui.plugin(B);var a=e.Grid=i.extend({options:{hasSelectedModel:!1,setSelectedAttribute:!1,hasCheckedModel:!1,useSingleSelection:!1,setCheckedAttribute:!1,hasRadioModel:!1,checkedLimit:!1,selectedLimit:!1,cardTemplate:"",cardNum:6,cardHeight:211,hasDoubleClickEvt:!1,showGridHeader:!0,events:["checked","checkedLimit"]},init:function(e,t,i){var a=this;if((t=p(t)?{dataSource:t}:t).sortable&&(S.isPlainObject(t.sortable)?t.sortable.allowUnsort=!1:t.sortable={allowUnsort:!1}),void 0===t.noRecords){var n=I.I18N;t.noRecords={template:"<div class='no-records-text'>"+n.prop("COMMON_NO_DATA_AVAILABLE_GRID")+"</div>"}}this._createCheckedColumn(t),o.fn.init.call(a,e,t),i&&(a._events=i),"multiple row"!==a.options.selectable&&(a.options.useSingleSelection=!1),C=x.support.isRtl(e),a._element(),a._aria(),t.cardTemplate&&(a.options.columns=[{field:"card"}],this.element.addClass("card-grid")),a._columns(a.options.columns),a._dataSource(),a._tbody(),a._pageable(),a._thead(),a._groupable(),a._toolbar(),a._setContentHeight(),a._templates(),a._navigatable(),a._selectable(),a._clipboard(),a._details(),a._editable(),a._attachCustomCommandsEvent(),a._minScreenSupport(),a.options.autoBind?a.dataSource.fetch():(a._group=0<a._groups(),a._footer()),a.lockedContent&&(a.wrapper.addClass("k-grid-lockedcolumns"),a._resizeHandler=function(){a.resize()},S(I).on("resize"+c,a._resizeHandler)),x.notify(a),a._createSelectedModel(),a._createCheckedModel(),!t.cardTemplate&&a.options.showGridHeader||a.wrapper.find(".k-grid-header").hide(),t.scrollable&&t.scrollable.virtual&&(a.dataSource.options.serverPaging||(a.element.find(".k-scrollbar.k-scrollbar-vertical").on("scroll",function(e){var t=S(this);t.scrollTop()+t.innerHeight()+2>=this.scrollHeight&&a.dataSource&&a.dataSource.trigger("scrollend",{grid:a,scrollElem:t})}),a.bind("dataBinding",function(){a._beforeScrollTop=a.virtualScrollable.verticalScrollbar.scrollTop()}),a.bind("dataBound",function(){void 0!==a._beforeScrollTop&&a.virtualScrollable.verticalScrollbar.scrollTop(a._beforeScrollTop)}))),t.columnDropDownList&&this._attachDropDownEvt()},_attachDropDownEvt:function(){var v=this;v.element.on("click",".common-grid-dropdown",function(){var s=S(this);if(s.hasClass("k-state-borderdown"))return v.dropdownListUl.trigger("dropdownblur",{isFoce:!0}),!(v._dropdownblur=!0);var l=s.find(".k-dropdown-wrap");if(l.hasClass("k-state-disabled")||v._dropdownblur)return v._dropdownblur=!1;s.addClass("k-state-borderdown"),l.addClass("k-state-borderdown k-state-focus k-state-active");var e,t,i=s.data("field"),d=s.find("input"),a=d.attr("data-value"),n=v.columns,o=n.length;for(t=0;t<o;t++)if(n[t].field==i){e=n[t];break}if(e&&e.dropDownOptions){var c=e.dropDownOptions,r=s.outerWidth(),u=s.outerHeight(),p=s.offset(),h=u+p.top,f=p.left,g=function(e,t,i,a,n,o,r){var s;s=a?a-2:(a=202,200);var l="";void 0!==e.dropDownListCss&&null!==e.dropDownListCss&&(l=e.dropDownListCss);var d=10;d=S(I).height()<n+a?(n=r-a-d,""):"margin-top : "+d+"px;";var c='<div class="k-animation-container '+l+'" style="width: '+i+"px; height: "+a+"px; box-sizing: content-box; overflow: hidden; position: absolute; top: "+n+"px; z-index: 10002; left: "+o+"px; "+d+'"><div class="k-list-container k-popup k-group k-reset" data-role="popup" style="position: absolute;font-size: 16px;font-family: SamsungOneUI, sans-serif;font-stretch: normal;font-style: normal;font-weight: 600;line-height: normal;width: '+i+"px;min-width: "+i+"px;height: "+a+'px;display: block;"><div class="k-list-scroller" unselectable="on" style="height:'+s+'px;"><ul unselectable="on" class="k-list k-reset" tabindex="-1" aria-hidden="true" aria-live="off" data-role="staticlist" role="listbox">',u=e.dataSource;u instanceof x.data.DataSource&&(u=u.data());var p,h,f,g,m,v,_=e.dataTextField,b=e.dataValueField,C=u.length,k="",w=S("<ul/>");for(g=0;g<C;g++)m=S("<li/>").addClass("k-item"),f=u[g],b&&(p=f[b]),_&&(h=f[_]),v={tabindex:"-1",role:"option",unselectable:"on","aria-selected":!1,"data-value":p},p==t&&(v["aria-selected"]=!0,m.addClass("k-state-selected k-state-focused")),m.attr(v),m.text(h),w.append(m);var D=0==C?"":"display:none;",y=I.I18N;return c+(k+=w.html()+'</ul></div><div class="k-nodata" style="'+D+'"><div>'+y.prop("COMMON_NO_CONTENT_LIST")+"</div></div></div></div>")}(c,a,r,null,h,f,p.top);v.dropdownListContainer=S(g).appendTo("body"),v.dropdownListUl=v.dropdownListContainer.find(".k-list-scroller > ul"),v.dropdownListUl.focus();function m(e,t){if(e.target){var i=S(e.target);if(0<v.dropdownListContainer.has(i).length){if(void 0!==e.which&&1!=e.which)return!1;if(i.hasClass("k-item")){var a=i.text(),n=i.attr("data-value");d.attr("data-value",n),s.find("span.k-input").text(a);var o=s.closest("tr").data("uid"),r=v.dataSource.getByUid(o);c.change&&c.change({item:r,value:n,text:a})}else if(!t)return!1}else if(0<s.has(i).length)return S(s).trigger("click"),!1}return s.removeClass("k-state-borderdown"),l.removeClass("k-state-borderdown k-state-focus k-state-active"),S("body").off("mousedown",v._dropDownListBlurEvt),v.dropdownListUl.off("dropdownblur",v._dropDownListBlurEvt),v.dropdownListContainer.remove(),v.dropdownListContainer=null,!1}S("body").on("mousedown",m),v.dropdownListUl.on("dropdownblur",m)}})},filterForSearch:function(e){var t=e;this.searchFilter=t,this.isSearching=!0,this.dataSource.filter(t),this.isSearching=!1,this.searchFilter=null},refresh:function(e){var t,i=this,a=i.dataSource.view(),n=i.options.navigatable,o=S(i.current()),r=!1,s=(i.dataSource.group()||[]).length,l=s+R(N(i.columns)).length;this.selectedIds&&(this.selectedIds.length=0),e&&"itemchange"===e.action&&i.editable||(e&&"remove"===e.action&&i.editable&&i.editable.options.model&&-1<d(i.editable.options.model,e.items)&&i.editable.options.model.unbind(v,i._modelChangeHandler),e=e||{},i.trigger("dataBinding",{action:e.action||"rebind",index:e.index,items:e.items})||(i._angularItems("cleanup"),n&&(i._isActiveInTable()||i._editContainer&&i._editContainer.data("kendoWindow"))&&(r=o.is("th"),t=Math.max(i.cellIndex(o),0)),i._destroyEditable(),i._progress(!1),i._hideResizeHandle(),i._data=[],i.columns.length||(i._autoColumns(i._firstDataItem(a[0],s)),l=s+i.columns.length),i._group=0<s||i._group,i._group&&(i._templates(),i._updateCols(),i._updateLockedCols(),i._updateHeader(s),i._group=0<s),i._renderContent(a,l,s),i._renderLockedContent(a,l,s),i._footer(),i._renderNoRecordsContent(),i._setContentHeight(),i._setContentWidth(i.content&&i.content.scrollLeft()),i.lockedTable&&(i.options.scrollable.virtual?i.content.find(">.k-virtual-scrollable-wrap").trigger("scroll"):i.touchScroller?i.touchScroller.movable.trigger("change"):(i.wrapper.one("scroll",function(e){e.stopPropagation()}),i.content.trigger("scroll"))),i._restoreCurrent(t,r),i.touchScroller&&i.touchScroller.contentResized(),i.selectable&&i.selectable.resetTouchEvents(),i._muteAngularRebind(function(){i._angularItems("compile")}),i.trigger(u)))},_createSelectedModel:function(){var e=this.options,t=e.hasSelectedModel,i=e.setSelectedAttribute,a=this.dataSource;if(t){this.selectedIds=[];var n,o=a.data();if(i)for(n=0;n<void 0;n++)o[n].selected=!1}},_createCheckedColumn:function(e){if((e.hasCheckedModel||e.hasRadioModel)&&e.columns){var t,i,a,n=e.columns,o=!1;for(i=n.length,t=0;t<i;t++)if("checked"==(a=n[t]).field){o=!0;break}o?a=this._setCheckedModelColumn(a,e):(a=this._setCheckedModelColumn({},e),n.unshift(a))}},_createCheckedModel:function(e,t){var i=(t=this.options).hasCheckedModel,a=t.hasRadioModel,n=t.setCheckedAttribute,o=this.dataSource;if(i||a){this.checkedIds=[];var r,s=o.data();if(n)for(r=0;r<void 0;r++)s[r].checked=!1;this.groupCheckBox||(this.groupCheckBox={}),this._attachCheckedModelEvt()}},_attachCheckedModelEvt:function(){var l=this,e=S(this.element);e.off("click"),e.on("click",".grid-checkbox-cell .k-checkbox",function(e){var t=S(this),i=l._findItemFromCheckbox(t),a=t.prop("checked"),n=l.options.checkedLimit;if(!1!==n&&0!=n&&a&&l.getCheckedData().length>=n)return!1;i.checked=a,l.setGroupCheckbox(),l.setHeaderCheckbox(),l.trigger("checked",{isHeader:!1,item:i,checkbox:t})}),e.on("click",".grid-checkbox-cell .k-radio, .grid-checkbox-cell .k-radio-label",function(e){var t=S(this),i=l._findItemFromCheckbox(t),a=t.prop("checked");i.checked=a,l.setRadioBtn(i),l.trigger("checked",{isHeader:!1,isRadio:!0,item:i,checkbox:t})}),e.on("click",".grid-checkbox-header .k-checkbox",function(e){var t=S(this),i=t.prop("checked"),a=l.options.checkedLimit;if(!1!==a&&0!=a&&i&&l.getCheckedData().length>=a)return!1;l.trigger("dataBinding"),i?l.checkAll(!0):l.uncheckAll(),l.trigger("checked",{isHeader:!0,item:null,checkbox:t})}),e.on("click",".grid-group-row .grid-group-row-checkbox",function(e){var t,i=S(this),a=i.prop("checked"),n=l.options.checkedLimit;if(!1!==n&&0!=n&&a&&l.getCheckedData().length>=n)return!1;var o=i.data("field"),r=i.data("value");l.trigger("dataBinding"),t=a?l.checkGroup(!0,o,r,!0):l.checkGroup(!0,o,r,!1),l.setHeaderCheckbox();var s={isGroupHeader:!0,field:o,value:r,item:t,checkbox:i,checked:a};l.trigger("dataBound",s),l.trigger("checked",s)}),this.bind("dataBound",function(e){this.setHeaderCheckbox(),this.setGroupCheckbox(),this.syncExpandedGroupRow()})},syncExpandedGroupRow:function(){if(this.groupCollapse){var e,t,i,a=this.groupCollapse;for(e in a)for(t in a[e])a[e][t]||(i=this.element.find("tr[data-field='"+e+"'][data-value='"+t+"']"),this.collapseGroup(i))}},setRadioBtn:function(e){var t,i=this.dataSource.data(),a=i.length;for(t=0;t<a;t++)if(i[t]!==e&&i[t].checked){i[t].checked=!1,this.element.find("tbody tr[data-uid='"+i[t].uid+"']").find(".grid-checkbox-cell .k-radio").prop("checked",!1);break}},setGroupCheckbox:function(){if(0<this.dataSource.group().length){var e=this.dataSource.view();this.setSubGroupCheckbox(e)}},setSubGroupCheckbox:function(e){var t,i,a=e,n=a.length;for(t=0;t<n;t++)a[t].hasSubgroups&&a[t].items&&0<a[t].items.length&&this.setSubGroupCheckbox(a[t].items),i=this.isCheckedAllGroup(a[t].field,a[t].value),this.getGroupCheckbox(a[t].field,a[t].value).prop("checked",i)},getGroupCheckbox:function(e,t){return this.element.find(".grid-group-row .grid-group-row-checkbox[data-field='"+e+"'][data-value='"+t+"']")},isCheckedAllGroup:function(e,t){this.groupCheckBox[e]||(this.groupCheckBox[e]={});var i,a=this.dataSource.flatView(),n=new x.data.Query(a).filter({logic:"and",filters:[{field:e,operator:"eq",value:t}]}).toArray(),o=this.options.checkedLimit;!1!==o&&0!=o&&(i=o);var r,s=n.length,l=0,d=!0;for(r=0;r<s;r++){if(!i&&!n[r].checked){d=!1;break}i&&n[r].checked&&l++}return i&&l<(s=i>=n.length?n.length:i)&&(d=!1),this.groupCheckBox[e][t]=d},checkGroup:function(e,t,i,a,n){this.groupCheckBox[t]||(this.groupCheckBox[t]={}),"undefined"===i&&(i=void 0),this.groupCheckBox[t][i]=a;var o,r=this.dataSource;if(e)if(r.pageSize()){var s=new x.data.Query(r.data()),l=r.filter();l&&(s=s.filter(l));var d=r.sort();d&&(s=s.sort(d));var c=r.group();c&&(s=s.group(c)),o=s.toArray()}else o=r.flatView();else o=r.data();var u=new x.data.Query(o).filter({logic:"and",filters:[{field:t,operator:"eq",value:i}]}).toArray(),p=this.options.checkedLimit;!1!==p&&0!=p&&(n=p);var h,f,g=[];if(n&&a&&n<=(g=new x.data.Query(o).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:a}]}).toArray()).length)return this.trigger("checkedLimit",{length:n}),[];if(n&&a){f=(n-=g.length)>=u.length?u.length:n;var m=u.length,v=0;for(h=0;h<m&&(u[h].checked||(u[h].checked=a,v++),!(f<=v));h++);}else for(f=u.length,h=0;h<f;h++)u[h].checked=a;return r.fetch(),new x.data.Query(u).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:a}]}).toArray()},getCheckedData:function(){var e=this.dataSource.data();return new x.data.Query(e).filter({logic:"and",filters:[{field:"checked",operator:"eq",value:!0}]}).toArray()},getSelectedData:function(e){var t=this.dataSource,i=e?t.flatView():t.data();return new x.data.Query(i).filter({logic:"and",filters:[{field:"selected",operator:"eq",value:!0}]}).toArray()},setHeaderCheckbox:function(){var e=this.isAllChecked(!0),t=this.element.find(".grid-checkbox-header .k-checkbox");e?t.prop("checked",!0):t.prop("checked",!1)},isAllChecked:function(e){var t=this.dataSource,i=!0,a=t.data();if(e)if(t.pageSize()){var n=new x.data.Query(t.data()),o=t.filter();o&&(n=n.filter(o));var r=t.sort();r&&(n=n.sort(r));var s=t.group();s&&(n=n.group(s)),a=n.toArray()}else a=t.flatView();var l,d=a.length;if(0==d)return!1;for(l=0;l<d;l++)if(!a[l].checked){i=!1;break}return i},checkAll:function(e,t){var i=this.dataSource,a=i.data();if(e)if(i.pageSize()){var n=new x.data.Query(i.data()),o=i.filter();o&&(n=n.filter(o));var r=i.sort();r&&(n=n.sort(r));var s=i.group();s&&(n=n.group(s)),a=n.toArray()}else a=i.flatView();var l=this.options.checkedLimit;!1!==l&&0!=l&&(t=l);var d,c=(t=t>=a.length?a.length:t)||a.length;for(d=0;d<c;d++)a[d].checked=!0;i.fetch()},uncheckAll:function(e){var t=this.dataSource,i=t.data();if(e)if(t.pageSize()){var a=new x.data.Query(t.data()),n=t.filter();n&&(a=a.filter(n));var o=t.sort();o&&(a=a.sort(o));var r=t.group();r&&(a=a.group(r)),i=a.toArray()}else i=t.flatView();var s,l=i.length;for(s=0;s<l;s++)i[s].checked=!1;t.fetch()},checkById:function(e,t){var i=this,a=i.dataSource,n=i.options.checkedLimit;if(!1!==n&&0!=n&&t&&i.getCheckedData().length>=n)return!1;a.get(e).checked=t,i.element.find("tr[data-id='"+e+"'] .grid-checkbox-cell .k-checkbox").prop("checked",t),i.setGroupCheckbox(),i.setHeaderCheckbox()},_findItemFromCheckbox:function(e){var t=this.dataSource,i=e.closest("tr").data("uid"),a=t.getByUid(i);if(!a){var n=e.data("id");a=t.get(n)}return a},_setCheckedModelColumn:function(e,t){return(e=e||{}).field||(e.field="checked"),e.width||(e.width=37),e.attributes||(e.attributes={class:"grid-checkbox-cell"}),e.template||(t.hasCheckedModel?e.template=this._checkedModelTemplate:t.hasRadioModel&&(e.template=this._radioModelTemplate)),e.headerAttributes||(e.headerAttributes={class:"grid-checkbox-header"}),e.headerTemplate||(t.hasCheckedModel?e.headerTemplate=this._checkedModelHeaderTemplate:t.hasRadioModel&&(e.headerTemplate="")),void 0===e.sortable&&(e.sortable=!1),void 0===e.editable&&(e.editable=!1),e},_radioModelTemplate:function(e){var t=e.uid;return'<input type="radio" id="check_'+t+'" class="k-radio" '+(e.checked?"checked":"")+'><label for="check_'+t+'" class="k-radio-label"></label>'},_checkedModelTemplate:function(e){var t=e.uid;return'<input type="checkbox" id="check_'+t+'" class="k-checkbox" '+(e.checked?"checked":"")+'><label for="check_'+t+'" class="k-checkbox-label"></label>'},_checkedModelHeaderTemplate:function(){var e=x.guid();return'<input type="checkbox" id="check_header_'+e+'" class="k-checkbox"><label for="check_header_'+e+'" class="k-checkbox-label"></label>'},_checkedModelGroupTemplate:function(){},_renderContent:function(e,t,i){var a,n,o,r,s,l,d,c,u=this,p="",h=null!==u.lockedContent&&void 0!==u.lockedContent,f={rowTemplate:u.rowTemplate,altRowTemplate:u.altRowTemplate,groupFooterTemplate:u.groupFooterTemplate};if(t=h?t-R(F(u.columns)).length:t,0<i)for(t=h?t-i:t,u.detailTemplate&&t++,u.groupFooterTemplate&&(u._groupAggregatesDefaultObject=u.dataSource.aggregates()),a=0,n=e.length;a<n;a++)p+=u._groupRowHtml(e[a],t,0,h?D:w,f,h);else p+=u._rowsHtml(e,f);u.tbody=(o=u.tbody,r=u.table,s=p,l=this.options.$angular,c=o,l&&o.empty(),g?o[0].innerHTML=s:((d=document.createElement("div")).innerHTML="<table><tbody>"+s+"</tbody></table>",o=d.firstChild.firstChild,r[0].replaceChild(o,c[0]),o=S(o)),o)},_rowsHtml:function(e,r){var t,i,a=this,n="",o=r.rowTemplate,s=r.altRowTemplate,l=a.options.cardTemplate;if(a.isSearching){var d,c,u,p=a.searchFilter;S.isArray(p)?d=p:S.isArray(p.filters)&&(d=p.filters);var h,f,g={};for(u=d.length,c=0;c<u;c++)(f=d[c].value)&&(h=d[c].field,g[h]=f);function m(e){return"<span class=search-highlight>"+e+"</span>"}o=function(e){var t,i,a,n;for(t in e=e instanceof x.data.ObservableObject?e.toJSON():S.extend({},e),e=new x.data.ObservableObject(e),g)(i=e.get(t))&&(a=g[t],n=new RegExp(a,"gi"),e[t]=i.replace(n,m));var o=r.rowTemplate(e);return o=o.replace(/&lt;/g,"<").replace(/&gt;/g,">")},s=function(e){var t,i,a,n;for(t in e=e instanceof x.data.ObservableObject?e.toJSON():S.extend({},e),e=new x.data.ObservableObject(e),g)(i=e.get(t))&&(a=g[t],n=new RegExp(a,"gi"),e[t]=i.replace(n,m));var o=r.altRowTemplate(e);return o=o.replace(/&lt;/g,"<").replace(/&gt;/g,">")}}var v=a.options.hasSelectedModel,_=a.options.hasCheckedModel;if((v||_)&&(o=function(e){var t=r.rowTemplate(e);return void 0!==e.id&&(t=(t=S(t).attr("data-id",e.id))[0].outerHTML),t},s=function(e){var t=r.altRowTemplate(e);return void 0!==e.id&&(t=(t=S(t).attr("data-id",e.id))[0].outerHTML),t}),l)for(t=0,i=e.length;t<i;t++)n+=l(e[t]),a._data.push(e[t]);else for(t=0,i=e.length;t<i;t++)n+=t%2?s(e[t]):o(e[t]),a._data.push(e[t]);return n},_tmpl:function(e,t,i,a){var n,o,r=this,s=O({},x.Template,r.options.templateSettings),l=t.length,d={storage:{},count:0},c=r._hasDetails(),u=[],p=r._groups(),h=r.options.navigatable,f=r.options.hasSelectedModel;if(!e){for(e="<tr",i&&u.push("k-alt"),c&&u.push("k-master-row"),f&&u.push('#if(typeof selected !== "undefined" && selected == true){# k-state-selected #}#'),u.length&&(e+=' class="'+u.join(" ")+'"'),l&&(e+=" "+x.attr("uid")+'="#='+x.expr("uid",s.paramName)+'#"'),e+=" role='row'>",0<p&&!a&&(e+=y(p)),c&&(e+='<td class="k-hierarchy-cell"><a class="k-icon k-i-expand" href="\\#" tabindex="-1"></a></td>'),n=0;n<l;n++)e+="<td"+L((o=t[n]).attributes),h&&(e+=" aria-describedby='"+o.headerAttributes.id+"'"),e+=" role='gridcell'>",e+=r._cellTmpl(o,d),e+="</td>";e+="</tr>"}return e=x.template(e,s),0<d.count?m(e,d.storage):e},_cellTmpl:function(e,t){var i,a,n=O({},x.Template,this.options.templateSettings),o=e.template,r=n.paramName,s=e.field,l="",d=e.format,c=typeof o,u=e.values;if(e.command){if(p(e.command)){for(i=0,a=e.command.length;i<a;i++)e.command[i].visible?l+=x.format("#= {0}(data)? '{1}':'' #",e.command[i].visible,this._createButton(e.command[i]).replace(b,"\\#")):l+=this._createButton(e.command[i]).replace(b,"\\#");return l}return this._createButton(e.command).replace(b,"\\#")}return c==T?(t.storage["tmpl"+t.count]=o,l+="#=this.tmpl"+t.count+"("+r+")#",t.count++):c===f?l+=o:u&&u.length&&A(u[0])&&"value"in u[0]&&s?(l+="#var v ="+x.stringify(M(u)).replace(b,"\\#")+"#",l+="#var f = v[",n.useWithBlock||(l+=r+"."),l+=s+"]#",l+="${f != null ? f : ''}"):(l+=e.encoded?"#:":"#=",d&&(l+='kendo.format("'+d.replace(_,"\\$1")+'",'),l+=s?(s=x.expr(s,r))+"==null?'':"+s:"''",d&&(l+=")"),l+="#"),l},_groupRowHtml:function(e,t,i,a,n,o){var r,s,l,d,c,u,p,h=this.options.hasCheckedModel,f="",g=e.field,m=E(function e(t){for(var i=[],a=0;a<t.length;a++)t[a].columns?i=i.concat(e(t[a].columns)):i.push(t[a]);return i}(this.columns),function(e){return e.field==g})[0]||{},v=m.groupHeaderTemplate,_=(m.title||g)+": "+(l=e.value,d=m.format,u=m.encoded,p=null!=(p=(c=m.values)&&c.length&&A(c[0])&&"value"in c[0]?M(c)[l]:l)?p:"",d?x.format(d,p):!1===u?p:x.htmlEncode(p)),b=this._groupAggregatesDefaultObject||{},C=O({},b,e.aggregates),k=O({},{field:e.field,value:e.value,aggregates:C},e.aggregates[e.field]),w=n.groupFooterTemplate,D=e.items;if(!v&&h&&(v=function(e){var t=e.field,i=e.value;return'<div class="grid-group-row"><input type="checkbox" id="check_'+t+"_"+i+'" data-field="'+t+'" data-value="'+i+'" class="k-checkbox grid-group-row-checkbox"><label for="check_'+t+"_"+i+'" class="k-checkbox-label grid-group-row-checkbox-label"></label><span class="grid-group-row-text">'+i+"</span></div>"}),v&&(_=typeof v==T?v(k):x.template(v)(k)),f+=a(t,i,_,e.field,e.value),e.hasSubgroups)for(r=0,s=D.length;r<s;r++)f+=this._groupRowHtml(D[r],o?t:t-1,i+1,a,n,o);else f+=this._rowsHtml(D,n);if(w){var y={};for(var I in C)y[I]=O({},C[I],{group:{field:e.field,value:e.value}});f+=w(y)}return f},_selectable:function(){var a,o,g=this,e=[],r=g._isLocked(),t=g.options.selectable;if(t){g.selectable&&g.selectable.destroy(),t=x.ui.Selectable.parseOptions(t),a=t.multiple,o=t.cell,g._hasDetails()&&(e[e.length]=".k-detail-row"),(g.options.groupable||g._hasFooters())&&(e[e.length]=".k-grouping-row,.k-group-footer"),""!==(e=e.join(","))&&(e=":not("+e+")");var n=g.table;r&&(n=n.add(g.lockedTable));var i=">"+(o?"tbody>tr:not(.k-grouping-row):not(.k-detail-row):not(.k-group-footer) > td:not(.k-group-cell):not(.k-hierarchy-cell)":"tbody>tr"+e);g.options.cardTemplate&&(i+=",.card-item,.engCardWrap"),g.selectable=new x.ui.Selectable(n,{filter:i,aria:!0,multiple:a,hasSelectedModel:g.options.hasSelectedModel,hasDoubleClickEvt:g.options.hasDoubleClickEvt,useSingleSelection:g.options.useSingleSelection,change:function(e){var t={};if(g.options.hasSelectedModel){var i,a=S(e.sender.userEvents.currentTarget),n=a.data("uid");if(n&&(i=g.dataSource.getByUid(n)),i){var o,r=a.hasClass("k-state-selected"),s=e.sender._pressedShiftKey,l=e.sender._pressedCtrlKey,d=s||l,c=g.options.useSingleSelection,u=g.getSelectedData().length;if(!this.options.multiple||!d&&c){var p,h=(o=g.getSelectedData()).length;for(p=0;p<h;p++)o[p].selected=!1}if(c)1<u&&!l&&(r=!0,a.addClass("k-state-selected"));if(i.selected=r)g.selectedIds.push(i.id);else{var f=g.selectedIds.indexOf(i.id);g.selectedIds.splice(f,1)}t.item=i}}t.isDoubleClick=this._isDblClick,g.trigger(v,t)},useAllItems:r&&a&&o,relatedTarget:function(e){if(!o&&r){for(var t,i=S(),a=0,n=e.length;a<n;a++)t=g._relatedRow(e[a]),d(t[0],e)<0&&(i=i.add(t));return i}},continuousItems:function(){return g._continuousItems(i,o)}}),g.options.navigatable&&n.on("keydown"+c,function(e){var t=g.current(),i=e.target;if(e.keyCode===s.SPACEBAR&&-1<S.inArray(i,n)&&!t.is(".k-edit-cell,.k-header")&&t.parent().is(":not(.k-grouping-row,.k-detail-row,.k-group-footer)")){if(e.preventDefault(),e.stopPropagation(),t=o?t:t.parent(),r&&!o&&(t=t.add(g._relatedRow(t))),a)if(e.ctrlKey){if(t.hasClass(l))return t.removeClass(l),console.info(t),void g.trigger(v)}else g.selectable.clear();else g.selectable.clear();g.selectable.value(t)}})}},collapseGroup:function(e){e=S(e),this.groupCollapse||(this.groupCollapse={});var t=e.data("field"),i=e.data("value");this.groupCollapse[t]||(this.groupCollapse[t]={}),this.groupCollapse[t][i]=!1;var a,n,o,r,s,l=this.options.groupable.showFooter?0:1,d=S();this._isLocked()&&(e.closest("div").hasClass("k-grid-content-locked")?d=this.tbody.children("tr:eq("+e.index()+")").nextAll("tr"):(d=e.nextAll("tr"),e=this.lockedTable.find(">tbody>tr:eq("+e.index()+")"))),a=e.find(".k-group-cell").length,e.find(".k-i-collapse").addClass("k-i-expand").removeClass("k-i-collapse"),e.find("td[aria-expanded='true']:first").attr("aria-expanded",!1);var c=[];for(o=0,r=(e=e.nextAll("tr")).length;o<r&&(n=(s=e.eq(o)).find(".k-group-cell").length,s.hasClass("k-grouping-row")?l++:s.hasClass("k-group-footer")&&l--,!(n<=a||s.hasClass("k-group-footer")&&l<0));o++)d.length&&c.push(d[o]),c.push(s[0]);S(c).hide()},expandGroup:function(e){e=S(e),this.groupCollapse||(this.groupCollapse={});var t=e.data("field"),i=e.data("value");this.groupCollapse[t]||(this.groupCollapse[t]={}),this.groupCollapse[t][i]=!0;var a,n,o,r,s,l=this.options.groupable.showFooter,d=S(),c=[],u=1;for(this._isLocked()&&(e.closest("div").hasClass("k-grid-content-locked")?d=this.tbody.children("tr:eq("+e.index()+")").nextAll("tr"):(d=e.nextAll("tr"),e=this.lockedTable.find(">tbody>tr:eq("+e.index()+")"))),a=e.find(".k-group-cell").length,e.find(".k-i-expand").addClass("k-i-collapse").removeClass("k-i-expand"),e.find("td[aria-expanded='false']:first").attr("aria-expanded",!0),r=0,s=(e=e.nextAll("tr")).length;r<s&&!((o=(n=e.eq(r)).find(".k-group-cell").length)<=a);r++)o!=a+1||n.hasClass("k-detail-row")||(n.show(),d.eq(r).show(),n.hasClass("k-grouping-row")&&n.find(".k-icon").hasClass("k-i-collapse")&&this.expandGroup(n),n.hasClass("k-master-row")&&n.find(".k-icon").hasClass("k-i-collapse")&&(n.next().show(),d.eq(r+1).show())),n.hasClass("k-grouping-row")&&(l&&c.push(n.is(":visible")),u++),n.hasClass("k-group-footer")&&(l&&n.toggle(c.pop()),1==u?(n.show(),d.eq(r).show()):u--)},setDataSource:function(e){var t,i,a,n=this,o=n.options.scrollable,r=n.options.hasSelectedModel,s=n.options.hasCheckedModel;if(t=e instanceof x.data.DataSource?e.data():e,this.selectedIds=[],0<t.length){if(r&&void 0===t[0].selected)for(a=t.length,i=0;i<a;i++)t[i].selected=!1;if(s&&void 0===t[0].checked)for(a=t.length,i=0;i<a;i++)t[i].checked=!1}n.options.dataSource=e,n.dropdownListUl&&n.dropdownListUl.trigger("dropdownblur",{isForce:!0}),n._dataSource(),n._pageable(),n._thead(),o&&(o.virtual?n.content.find(">.k-virtual-scrollable-wrap").scrollLeft(0):n.content.scrollLeft(0)),n.options.groupable&&n._groupable(),n.virtualScrollable&&n.virtualScrollable.setDataSource(n.options.dataSource),n.options.navigatable&&n._navigatable(),n.options.selectable&&n._selectable(),n.options.autoBind&&e.fetch(),n.virtualScrollable&&void 0!==n._beforeScrollTop&&n.virtualScrollable.verticalScrollbar.scrollTop(n._beforeScrollTop)},_setAllSelectedModel:function(e,t,i){var a,n,o=this.dataSource;if(t)if(o.pageSize()){var r=new x.data.Query(o.data()),s=o.filter();s&&(r=r.filter(s));var l=o.sort();l&&(r=r.sort(l));var d=o.group();d&&(r=r.group(d)),n=r.toArray()}else n=o.flatView();else n=o.data();var c,u=(i=i&&(i>=n.length?a.length:i))||n.length;for(e||(this.selectedIds.length=0),c=0;c<u;c++)((a=n[c]).selected=e)&&this.selectedIds.push(a.id);o.fetch()},clearSelection:function(){this.selectable&&this.selectable.clear(),this.options.hasSelectedModel&&this._setAllSelectedModel(!1),this.trigger(v)},selectAll:function(e,t){if(this.options.hasSelectedModel){var i=this.options.selectedLimit;!1!==i&&0!=i&&(t=i),this._setAllSelectedModel(!0,e,t)}this.trigger(v)},unselectAll:function(){this.clearSelection()},selectByIds:function(e){var t,i=e.length;for(t=0;t<i;t++){if(this.selectedIds)if(-1==this.selectedIds.indexOf(e[t]))this.selectedIds.push(e[t]),this.dataSource.get(e[t]).selected=!0}this.dataSource.fetch()},unselectByIds:function(e){var t,i=e.length;for(t=0;t<i;t++){if(this.selectedIds){var a=this.selectedIds.indexOf(a[t]);this.selectedIds.splice(a,1)}this.dataSource.get(e[t]).selected=!1}this.dataSource.fetch()},selectById:function(e){this.selectedIds&&this.selectedIds.push(e);var t=this.dataSource.get(e);t.selected=!0,this.element.find("tr[data-uid='"+t.uid+"']").addClass("k-state-selected")},selectByData:function(e){var t,i,a,n=e.length,o=this.dataSource,r=this.options.hasSelectedModel;for(t=0;t<n;t++)i=e[t],(a=o.get(i.id))&&(r?a.selected=!0:this.element.find("tr[data-uid='"+a.uid+"']").addClass("k-state-selected"));r&&o.fetch()},deselectById:function(e){if(this.selectedIds){var t=this.selectedIds.indexOf(e);this.selectedIds.splice(t,1)}var i=this.dataSource.get(e);i.selected=!1,this.element.find("tr[data-uid='"+i.uid+"']").removeClass("k-state-selected")},getSelectedIds:function(){return this.selectedIds},getSelectedList:function(){if(!this.options.hasSelectedModel)return console.error("Selected Model Options is false"),[];var e,t,i,a=this.dataSource,n=[],o=this.selectedIds,r=o.length;for(i=0;i<r;i++)e=o[i],t=a.get(e),n.push(t);return n},_averageRowHeight:function(){var e=this,t=e._items(e.tbody).length,i=e._rowHeight;if(0===t)return i;if(this.options.cardTemplate)return this.options.cardHeight/this.options.cardNum;e._rowHeight||(e._rowHeight=i=n(e.table)/t,e._sum=i,e._measures=1);var a=n(e.table)/t;return i!==a?(e._measures++,e._sum+=a,e._rowHeight=e._sum/e._measures,a):i},_scrollable:function(){var e,t,i=this,a=i.options,n=a.scrollable,o=!0!==n&&n.virtual&&!i.virtualScrollable,r=!x.support.kineticScrollNeeded||o?x.support.scrollbar():0;if(n){(e=i.wrapper.children(".k-grid-header"))[0]||(e=S('<div class="k-grid-header" />').insertBefore(i.table)),e.css(C?"padding-left":"padding-right",n.virtual?r+1:r),t=S('<table role="grid" />'),k&&t.attr("cellspacing",0),t.width(i.table[0].style.width),t.append(i.thead),e.empty().append(S('<div class="k-grid-header-wrap k-auto-scrollable" />').append(t)),i.content=i.table.parent(),i.content.is(".k-virtual-scrollable-wrap, .km-scroll-container")&&(i.content=i.content.parent()),i.content.is(".k-grid-content, .k-virtual-scrollable-wrap")||(i.content=i.table.wrap('<div class="k-grid-content k-auto-scrollable" />').parent());var s=null;a.cardTemplate&&(s=a.cardNum),o&&(i.virtualScrollable=new B(i.content,{dataSource:i.dataSource,itemHeight:function(){return i._averageRowHeight()},cardNum:s})),i.scrollables=e.children(".k-grid-header-wrap").add(i.content);var l=i.wrapper.find(".k-grid-footer");if(l.length&&(i.scrollables=i.scrollables.add(l.children(".k-grid-footer-wrap"))),n.virtual)i.content.find(">.k-virtual-scrollable-wrap").unbind("scroll"+c).bind("scroll"+c,function(){i.scrollables.scrollLeft(this.scrollLeft),i.lockedContent&&(i.lockedContent[0].scrollTop=this.scrollTop)});else{i.content.unbind("scroll"+c).bind("scroll"+c,function(e){i.scrollables.not(e.currentTarget).scrollLeft(this.scrollLeft),i.lockedContent&&e.currentTarget==i.content[0]&&(i.lockedContent[0].scrollTop=this.scrollTop)});var d=i.content.data("kendoTouchScroller");d&&d.destroy(),(d=x.touchScroller(i.content))&&d.movable&&((i.touchScroller=d).movable.bind("change",function(e){i.scrollables.scrollLeft(-e.sender.x),i.lockedContent&&i.lockedContent.scrollTop(-e.sender.y)}),i.one(u,function(e){e.sender.wrapper.addClass("k-grid-backface")}))}}}});x.ui.plugin(a)}(window,jQuery),function(a,r){var i=a.kendo,e=i.ui,n=e.DropDownList,s=i.data.ObservableObject,l=".kendoDropDownList",d="disabled",c="readonly",u="k-state-default",p="k-state-disabled",h="aria-disabled",f="mouseenter"+l+" mouseleave"+l,g="tabindex",m=r.proxy,t=e.DropDownList=n.extend({options:{popupClass:null,animation:!1,hasKeyDownEvent:!1,hasKeyPressEvent:!1},init:function(e,t){if(t&&!t.noDataTemplate){var i=a.I18N;t.noDataTemplate=i.prop("COMMON_NO_CONTENT_LIST")}n.fn.init.call(this,e,t)},_popupOpen:function(){var e=this.popup;e.wrapper=i.wrap(e.element);var t=this.options.popupClass;t&&e.wrapper.addClass(t),e.element.closest(".km-root")[0]&&(e.wrapper.addClass("km-popup km-widget"),this.wrapper.addClass("km-widget"))},text:function(e){var t,i=this,a=i.options.ignoreCase;if(void 0===(e=null===e?"":e))return i._textAccessor();"string"==typeof e?(t=a?e.toLowerCase():e,i._select(function(e){return e=i._text(e),a&&(e=(e+"").toLowerCase()),e===t}).done(function(){i._textAccessor(i.dataItem()||e)})):i._textAccessor(e)},_textAccessor:function(e){var t=null,i=this.valueTemplate,a=this._optionLabelText(),n=this.span;if(void 0===e)return n.text();r.isPlainObject(e)||e instanceof s?t=e:a&&a===e&&(t=this.options.optionLabel),t=t||this._assignInstance(e,this._accessor()),this.hasOptionLabel()&&(t!==a&&this._text(t)!==a||(i=this.optionLabelTemplate,"string"!=typeof this.options.optionLabel||this.options.optionLabelTemplate||(t=a)));function o(){return{elements:n.get(),data:[{dataItem:t}]}}this.angular("cleanup",o);try{n.html(i(t))}catch(e){n.html("")}this.angular("compile",o)},open:function(e){var t=this;t.popup.visible()||(t.listView.bound()&&"accept"!==t._state?t._allowOpening()&&(t.popup.one("activate",t._focusInputHandler),t.popup.open(),e&&t.popup.wrapper.offset(e),t._resizeFilterInput(),t._focusItem()):(t._open=!0,t._state="rebind",t.filterInput&&(t.filterInput.val(""),t._prev=""),t.filterInput&&1!==t.options.minLength?(t.refresh(),t.popup.one("activate",t._focusInputHandler),t.popup.open(),e&&t.popup.wrapper.offset(e),t._resizeFilterInput()):t._filterSource()))},_editable:function(e){var t=this,i=t.element,a=e.disable,n=e.readonly,o=t.wrapper.add(t.filterInput).off(l),r=t._inputWrapper.off(f);n||a?a?(o.removeAttr(g),r.addClass(p).removeClass(u)):(r.addClass(u).removeClass(p),o.on("focusin"+l,m(t._focusinHandler,t)).on("focusout"+l,m(t._focusoutHandler,t))):(i.removeAttr(d).removeAttr(c),r.addClass(u).removeClass(p).on(f,t._toggleHover),o.attr(g,o.data(g)).attr(h,!1).on("focusin"+l,m(t._focusinHandler,t)).on("focusout"+l,m(t._focusoutHandler,t)).on("mousedown"+l,m(t._wrapperMousedown,t)).on("paste"+l,m(t._filterPaste,t)),t.options.hasKeyDownEvent&&o.on("keydown"+l,m(t._keydown,t)),t.wrapper.on("click"+l,m(t._wrapperClick,t)),!t.filterInput&&t.options.hasKeyPressEvent&&o.on("keypress"+l,m(t._keypress,t))),i.attr(d,a).attr(c,n),o.attr(h,a)}});i.ui.plugin(t)}(window,jQuery),function(e,t){"use strict";function i(e){e=e||t("body"),this.target=e,this.isOpened=!1}i.prototype.open=function(e){e=e||(this.target?this.target:t("body")),this.isOpened&&this.close(),this.element=t("<div/>").addClass("common-loading-panel-mask"),this.loadingImage=t("<div/>").addClass("common-loading-panel-image"),this.loadingColor=t("<div/>").addClass("common-loading-panel-color"),this.element.append(this.loadingImage).append(this.loadingColor),this.element.appendTo(e),this.isOpened=!0},i.prototype.close=function(){this.element&&this.element.remove(),this.isOpened=!1},e.CommonLoadingPanel=i,define("widget/common-loading-panel",function(){return i})}(window,jQuery),function(m,v){"use strict";var _=m.kendo,e=_.ui,d=v.trim,b=v.extend,C=_._outerHeight,s=e.Widget,c=/^(a|div)$/i,l=".kendoTabStrip",k="k-link",u="k-image",p="k-first",w="contentUrl",h="k-state-disabled",D="k-state-default",y="k-state-active",I="k-state-hover",S="k-tab-on-top",f=".k-item:not(."+h+")";var t=_.ui.TabStrip,i=t.extend({options:{name:"CommonTabStrip",animation:!1,isTopMenu:!0,useScrollButton:!0,isPreventKeyDown:!0},init:function(e,t){var i,a=this;v(this.element).addClass("common-tab-strip"),s.fn.init.call(a,e,t);var n=this.element.find(".k-state-active");1<n.length&&(n.removeClass("k-state-active"),n.eq(0).addClass("k-state-active")),a._animations(a.options),t=a.options,a._contentUrls=t.contentUrls||[],a._wrapper(),a._isRtl=_.support.isRtl(a.wrapper),a._tabindex(),a._updateClasses(),a._dataSource(),t.dataSource&&a.dataSource.fetch(),a._tabPosition(),a._scrollable(),a._contentUrls.length?a.wrapper.find(".k-tabstrip-items > .k-item").each(function(e,t){var i=a._contentUrls[e];"string"==typeof i&&v(t).find(">."+k).data(w,i)}):a._contentUrls.length=a.tabGroup.find("li.k-item").length,a.wrapper.on("mouseenter"+l+" mouseleave"+l,".k-tabstrip-items > .k-item:not(.k-state-disabled):not(.k-state-active)",a._toggleHover).on("focus"+l,v.proxy(a._active,a)).on("blur"+l,function(){a._current(null)}),a._keyDownProxy=v.proxy(a._keydown,a),t.navigatable&&a.wrapper.on("keydown"+l,a._keyDownProxy),a.options.value&&(i=a.options.value),a.wrapper.children(".k-tabstrip-items").on("click"+l,".k-state-disabled .k-link",!1).on("click"+l," > "+f,function(e){var t=a.wrapper[0];if(t!==document.activeElement)if(_.support.browser.msie)try{t.setActive()}catch(e){t.focus()}else t.focus();a._click(v(e.currentTarget))&&e.preventDefault()});var o=a.tabGroup.children("li."+y),r=a.contentHolder(o.index());o[0]&&0<r.length&&0===r[0].childNodes.length&&a.activateTab(o.eq(0)),a.element.attr("role","tablist"),a.element[0].id&&(a._ariaId=a.element[0].id+"_ts_active"),a.value(i),_.notify(a),v(a.element).closest(".k-tabstrip-wrapper").addClass("common-tab-strip-wrapper"),a.options.isTopMenu&&(a.scrollbar={},a._initScrollbar(),a.element.is(":visible")||a.scrollWrap.hide())},_keydown:function(e){this.options.isPreventKeyDown||t.fn._keydown.call(this,e)},activateTab:function(e){if(!this.tabGroup.children("[data-animating]").length){e=this.tabGroup.find(e);var t=this,i=t.options.animation,a=i.open,n=b({},i.close),o=n&&"effects"in n,r=e.parent().children(),s=r.filter("."+y),l=r.index(e);n=b(o?n:b({reverse:!0},a),{hide:!0}),_.size(a.effects)?(s.kendoRemoveClass(y,{duration:n.duration}),e.kendoRemoveClass(I,{duration:n.duration})):(s.removeClass(y),e.removeClass(I));var d=t.contentAnimators;if(t.inRequest&&(t.xhr.abort(),t.inRequest=!1),0===d.length)return t.tabGroup.find("."+S).removeClass(S),e.addClass(S).css("z-index"),e.addClass(y),t._current(e),t.trigger("change"),t._scrollableModeActive&&t._scrollTabsToItem(e),!1;var c=d.filter("."+y),u=t.contentHolder(l),p=u.closest(".k-content");if(t.tabsHeight=C(t.tabGroup)+parseInt(t.wrapper.css("border-top-width"),10)+parseInt(t.wrapper.css("border-bottom-width"),10),t._sizeScrollWrap(c),0===u.length)return c.removeClass(y).attr("aria-hidden",!0).kendoStop(!0,!0).kendoAnimate(n),!1;e.attr("data-animating",!0);var h=!(!e.children("."+k).data(w)&&!t._contentUrls[l])&&u.is(":empty"),f=function(){t.tabGroup.find("."+S).removeClass(S),e.addClass(S).css("z-index"),_.size(a.effects)?(s.kendoAddClass(D,{duration:a.duration}),e.kendoAddClass(y,{duration:a.duration})):(s.addClass(D),e.addClass(y)),s.removeAttr("aria-selected"),e.attr("aria-selected",!0),t._current(e),t._sizeScrollWrap(p),p.addClass(y).removeAttr("aria-hidden").kendoStop(!0,!0).attr("aria-expanded",!0).kendoAnimate(b({init:function(){t.trigger("show",{item:e[0],contentElement:u[0]}),_.resize(u)}},a,{complete:function(){e.removeAttr("data-animating"),t.trigger("activate",{item:e[0],contentElement:u[0]}),_.resize(u),t.scrollWrap.css("height","").css("height")}}))},g=function(){h?(e.removeAttr("data-animating"),t.ajaxRequest(e,u,function(){e.attr("data-animating",!0),f(),t.trigger("change")})):(f(),t.trigger("change")),t._scrollableModeActive&&t._scrollTabsToItem(e)};return c.removeClass(y),c.attr("aria-hidden",!0),c.attr("aria-expanded",!1),c.length?c.kendoStop(!0,!0).kendoAnimate(b({complete:g},n)):g(),!0}},contentElement:function(e){if(!isNaN(e-0)){var t=this.contentElements&&this.contentElements[0]&&!_.kineticScrollNeeded?this.contentElements:this.contentAnimators,i=this.tabGroup.children(),a=v(i[e]).attr("aria-controls"),n=v(i[e]).data("key");if(t){var o,r;if(n)for(o=0,r=t.length;o<r;o++)if(t.eq(o).data("for")==n)return t[o];for(o=0,r=t.length;o<r;o++)if(t.eq(o).closest(".k-content")[0].id==a)return t[o]}}},_updateClasses:function(){var e,t,i,a=this;a.wrapper.addClass("k-widget k-header k-tabstrip"),a.tabGroup=a.wrapper.children("ul").addClass("k-tabstrip-items k-reset"),a.tabGroup[0]||(a.tabGroup=v("<ul class='k-tabstrip-items k-reset'/>").appendTo(a.wrapper)),(e=a.tabGroup.find("li").addClass("k-item")).length&&(i=0<=(t=e.filter("."+y).index())?t:void 0,a.tabGroup.contents().filter(function(){return 3==this.nodeType&&!d(this.nodeValue)}).remove()),0<=t&&e.eq(t).addClass(S),a.contentElements=a.wrapper.children("div"),a.contentElements.addClass("k-content");var n,o,r,s=e.eq(i).data("key"),l=!1;s&&a.contentElements.each(function(){var e=v(this);if(e.data("for")==s)return e.addClass(y).css({display:"block"}),!(l=!0)}),l||a.contentElements.eq(i).addClass(y).css({display:"block"}),e.length&&((r=e).children("img").addClass(u),r.children("a").addClass(k).children("img").addClass(u),r.filter(":not([disabled]):not([class*=k-state-disabled])").addClass(D),r.filter("li[disabled]").addClass(h).removeAttr("disabled"),r.filter(":not([class*=k-state])").children("a").filter(":focus").parent().addClass(y+" "+S),r.attr("role","tab"),r.filter("."+y).attr("aria-selected",!0),r.each(function(){var e=v(this);e.children("."+k).length||e.contents().filter(function(){return!(this.nodeName.match(c)||3==this.nodeType&&!d(this.nodeValue))}).wrapAll("<span UNSELECTABLE='on' class='k-link'/>")}),n=a.tabGroup,(o=n.children(".k-item")).filter(".k-first:not(:first-child)").removeClass(p),o.filter(".k-last:not(:last-child)").removeClass("k-last"),o.filter(":first-child").addClass(p),o.filter(":last-child").addClass("k-last"),a._updateContentElements(!0))},_initScrollbar:function(){console.info("::INIT_SCROLLBAR");var e=this,t=v("body"),i=v("#main-header").find(".main-top-nav"),a=e.scrollWrap,n=e.tabGroup,o=n.find("li"),r=v("#main-sidebar-menu").find(".btn-util"),s=v('<div class="common-tab-strip-scrollbar"><span class="k-button common-tab-strip-scrollbar-btn left"><</span><span class="k-button common-tab-strip-scrollbar-btn right">></span></div>'),l=null,d=null,c=e._setScrollbarBtnPosition.bind(e),u=e._setStateScrollbar.bind(e),p=e._setMinWidth.bind(e),h=e._changeEnableScrollbarBtn.bind(e),f=e._setScrollbarAreaWidth.bind(e),g=e._setMainHeaderMinWidthWithoutScroll.bind(e);e.options.useScrollButton||n.closest(".common-tab-strip-wrapper").addClass("no-scroll-btn"),0<e.element.find(".common-tab-scroll-wrapper").length||(n.addClass("top-tab-menu"),n.closest(".common-tab-strip-wrapper").addClass("top-tab-menu-wrapper"),n.wrap('<span class="common-tab-scroll-wrapper"></span>'),e.wrapper.find(".common-tab-scroll-wrapper").show(),e.scrollbar.scrollArea=e.element.find(".common-tab-scroll-wrapper"),e.scrollbar.gnb=i,e.hasScrollBtn=!1,1<o.length&&(e.hasScrollBtn=!0),e.hasScrollBtn?(e.hasScrollBtn=!0,e.options.useScrollButton&&t.append(s),l=s.find(".common-tab-strip-scrollbar-btn.left").kendoButton().data("kendoButton"),d=s.find(".common-tab-strip-scrollbar-btn.right").kendoButton().data("kendoButton"),e.scrollbar.scrollBtnBox=s,e.scrollbar.leftBtn=l,e.scrollbar.rightBtn=d,e.scrollbar.isShow=!1,e.scrollbar.firstItem=e.scrollbar.scrollArea.find("li.k-item").eq(0),c(),u(),h(),e._setMinWidth(),v(m).resize(function(){"none"!=a.css("display")&&(console.info("::RESIZE_SCROLL"),u(),h(),c())}),r.on("click",".btn",function(){"none"!=a.css("display")&&(u(),p(),f(),c(),h())}),e._attachEventOnScrollBtn()):("none"!=e.element.css("display")&&g(),r.on("click",".btn",function(){g()})))},_setMainHeaderMinWidthWithoutScroll:function(){if(!this.hasScrollBtn){var e=this.tabGroup,t=e.find("li"),i=this.scrollbar.gnb,a=e.offset().left+e.width()+i.outerWidth(),n=t.eq(0).width();"none"!==this.scrollWrap.css("display")&&(v("#main-header").css("min-width",a),this.scrollbar.scrollArea.css("min-width",n))}},_setScrollbarAreaWidth:function(){var e=this.scrollbar.scrollArea,t=e.offset().left,i=this.scrollbar.scrollBtnBox.offset().left;e.css("width",i-t),e.css("width","")},_setMinWidth:function(){if(this.hasScrollBtn){var e=this.scrollbar.firstItem.width(),t=v("#main-sidebar").width(),i=this.scrollbar.scrollBtnBox.width();v("#main-header").css("min-width",e+t+240+i),this.scrollbar.scrollArea.css("min-width",e)}},_getScrollbarPosition:function(){var e=this.scrollbar.gnb;return{posX:e.offset().left-50,posY:e.offset().top}},_setScrollbarBtnPosition:function(){var e=this._getScrollbarPosition();this.scrollbar.scrollBtnBox.css({top:e.posY,left:e.posX})},_attachEventOnScrollBtn:function(){var e=this.scrollbar.scrollBtnBox,i=this.tabGroup,a=this._changeEnableScrollbarBtn.bind(this);e.on("click",".common-tab-strip-scrollbar-btn",function(){var e=v(this),t=Number(i.css("left").replace("px",""));e.hasClass("k-state-disabled")||(e.hasClass("left")?t+=100:t-=100,i.animate({left:""+t},80,function(){a()}))})},_setStateScrollbar:function(){var e=this.scrollbar.scrollArea,t=this.tabGroup,i=this.scrollbar.scrollBtnBox;e.width()<=t.width()?(this.scrollbar.isShow=!0,i.show()):(this.scrollbar.isShow=!1,t.css("left",0),i.hide())},_changeEnableScrollbarBtn:function(){var e=this.tabGroup,t=this.scrollbar,i=t.scrollBtnBox,a=t.leftBtn,n=t.rightBtn,o=Number(e.css("left").replace("px","")),r=e.width()+e.offset().left,s=i.offset().left;a.enable(!0),n.enable(!0),0<=o&&a.enable(!1),r<=s&&n.enable(!1)},show:function(){this.scrollWrap.show(),this.element.css("display","block"),this._setMainHeaderMinWidthWithoutScroll(),this._setMinWidth()},hide:function(){this.scrollWrap.hide(),this.element.css("display","none")},disableTab:function(e,t){var i=this,a=i.tabGroup.children(),n=a.eq(e);if(!(n.length<1)){var o=a.length,r=i.tabGroup.find(".k-state-active").index();t?(r==e&&(r==o-1&&i._activateTabAfterDisable(a,0),i._activateTabAfterDisable(a,r+1)||i._activateTabAfterDisable(a,0)),i.disable(n)):i.enable(n)}},activateTabFromIndex:function(e){var t=this.tabGroup.children().eq(e);t.length<1||this.activateTab(t)},getActivatedTabIndex:function(){var e=this.tabGroup.find(".k-state-active");return 0<e.length?e.index():-1},_activateTabAfterDisable:function(e,t){for(var i,a=e.length,n=!1,o=t;o<a;o++)if(!(i=v(e[o])).hasClass("k-state-disabled")){this.activateTab(i),n=!0;break}return n},destroy:function(){t.fn.destroy.call(this)}});_.ui.plugin(i)}(window,jQuery),function(m,E){"use strict";var T=m.kendo,e=T.template,f=E.proxy,S=m.Util,u=T.keys,g={wrapper:e("<div class='k-widget k-dialog k-window' role='dialog' />"),action:e("<button type='button' class='k-button# if (data.primary) { # k-primary# } role='button' #'></button>"),titlebar:e("<div class='k-window-titlebar k-dialog-titlebar k-header'><span class='k-window-title k-dialog-title'>#= title #</span></div>"),close:e("<a role='button' href='\\#' class='k-button-bare k-dialog-action k-dialog-close' title='#= messages.close #' aria-label='#= messages.close #' tabindex='-1'><span class='k-icon k-i-close'></span></a>"),actionbar:e("<div class='k-dialog-buttongroup k-dialog-button-layout-#= buttonLayout #' role='toolbar' />"),overlay:"<div class='k-overlay' />",alertWrapper:e("<div class='k-widget k-dialog k-window' role='alertdialog' />"),alert:"<div />",confirm:"<div />",prompt:"<div />",promptInputContainer:"<div class='k-prompt-container'><input type='text' class='k-textbox' /></div>"},v=T.ui.Dialog,t=v.extend({options:{name:"CommonDialog",type:"message",animation:!1,closable:!1,visible:!1,timeout:5e3,saveOnlyVisibleField:!1,replaceNewLine:!0,enableSaveBtnOnInputChange:!0,invalidScrollFieldClass:".detail-dialog-content-field-item",invalidScrollWrapperClass:".detail-dialog-detail-content",invalidScrollFieldListClass:".detail-dialog-detail-content-field-list",message:"",templates:{contBox:"<div class='pop-confirm-contbox'></div>",imgBox:"<div class='pop-confirm-imgbox'><span class='pop-confirm-img'></span></div>",detailBox:"<div class='pop-confirm-detailbox'></div>"},width:"560px",height:"250px",title:"COMMON_DIALOG_NOTIFICATION",confirmActions:{yes:null,no:null},closeAction:null,typeActions:{message:[{text:"COMMON_DIALOG_BUTTON_OK",action:function(e){e.sender.close()}}],confirm:[{text:"COMMON_DIALOG_BUTTON_NO",action:function(e){e.sender.close()}},{text:"COMMON_DIALOG_BUTTON_YES",action:function(e){e.sender.close()}}]}},init:function(e,t){var i,a,n,o=this,r=m.I18N,s=o.options.title;"COMMON_DIALOG_NOTIFICATION"==s&&(o.options.title=r.prop(s));var l=o.options.typeActions,d=l.message[0].text;"COMMON_DIALOG_BUTTON_OK"==d&&(l.message[0].text=r.prop(d)),"COMMON_DIALOG_BUTTON_NO"==(d=l.confirm[0].text)&&(l.confirm[0].text=r.prop(d)),"COMMON_DIALOG_BUTTON_YES"==(d=l.confirm[1].text)&&(l.confirm[1].text=r.prop(d)),t=E.extend({},o.options,t);var c=E(t.templates.contBox),u=E(t.templates.detailBox);c.append(u),!t.message&&""!=t.message||(t.replaceNewLine&&t.message&&(t.message=t.message.replace(/\n/g,"<br />")),i=E("<p/>").addClass("pop-confirm-message").html(t.message),u.append(i)),t.content&&u.html(t.content);var p=E(e).children();0<p.length&&c.append(p),t.content=c,n=t.type,(!t.actions||t.actions.length<1)&&(t.actions=t.typeActions[n]),a=t.confirmActions,"confirm"==n&&(a.yes&&E.isFunction(a.yes)?t.actions[1].action=function(e){var t=e.sender.options,i=!0;if(t.confirmActions&&t.confirmActions.yes&&(i=t.confirmActions.yes.call(this,e)),!1===i)return!1;e.sender.close()}:a.yes=t.actions[1].action,a.no&&E.isFunction(a.no)?t.actions[0].action=function(e){var t=e.sender.options,i=!0;if(t.confirmActions&&t.confirmActions.no&&(i=t.confirmActions.no.call(this,e)),!1===i)return!1;e.sender.close()}:a.no=t.actions[0].action),v.fn.init.call(o,e,t);var h=E(o.wrapper);h.addClass("pop-confirm"),h.find(".k-dialog-title").text(o.options.title);var f=E("<span class='pop-confirm-btn-close ic ic-close'></span>");h.append(f),this.closeBtn=f,t.closeAction?f.on("click",t.closeAction.bind(o,{sender:o})):"confirm"==n?f.on("click",t.actions[0].action.bind(o,{sender:o})):f.on("click",this.closeBtnEvt.bind(o,{sender:o})),o.messageBox=E(o.element).find(".pop-confirm-message"),o.messageBox.css("margin-left","4px"),o.wrapper.on("keydown",o._keyHandler.bind(o))},_keyHandler:function(e){var t=this,i=e.keyCode,a=t.options;i==u.ESC?t.closeBtn.trigger("click"):i==u.ENTER&&("confirm"==a.type?t.options.actions[1].action.call(t,{sender:t}):"message"==a.type&&t.options.actions[0].action.call(t,{sender:t}))},open:function(){v.fn.open.call(this);var e=this.options;if("message"==e.type&&e.timeout){var t=this;t.timeout=setTimeout(function(){t.close()},e.timeout)}},close:function(){v.fn.close.call(this),this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},_createActionbar:function(e){var t="stretched"===this.options.buttonLayout,i=t?"stretched":"normal",a=E(g.actionbar({buttonLayout:i}));this._addButtons(a),t&&this._normalizeButtonSize(a),e.append(a)},_addButtons:function(e){var t,i,a,n,o=this,r=o.options,s=f(o._actionClick,o),l=f(o._actionKeyHandler,o),d=o.options.actions,c=d.length,u=100/c;o.buttons=[];for(var p=0;p<c;p++)if(t=d[p]){a=t.disabled,n=t.visible,i=o._mergeTextWithOptions(t);var h=E(g.action(t)).autoApplyNS("kendoWindow").html(i).appendTo(e).data("action",t.action).on("click",s).on("keydown",l).prop("disabled",a);o.buttons.push(h),!0===n?h.show():!1===n&&h.hide(),"stretched"===r.buttonLayout&&h.css("width",u+"%")}else o.buttons.push(null)},message:function(e){return this.options.replaceNewLine&&e&&(e=e.replace(/\n/g,"<br />")),this.messageBox.html(e)},setActions:function(e,t){var i;(i=this.buttons[e])?(t.action&&i.data("action",t.action),t.text&&i.text(this._mergeTextWithOptions(t)),!0===t.visible?i.show():!1===t.visible&&i.hide(),void 0!==t.disabled&&i.prop("disabled",t.disabled)):console.info("there is no button for index "+e)},setConfirmActions:function(e){"confirm"==this.options.type?E.extend(this.options.confirmActions,e):console.error("this is not confirm type popup.")},setCloseAction:function(e){var t=this.options;t.closeAction=e;var i=t.type;this.closeBtn.off(),e?this.closeBtn.on("click",t.closeAction.bind(this,{sender:this})):"confirm"==i?this.closeBtn.on("click",t.actions[0].action.bind(this,{sender:this})):this.closeBtn.on("click",this.closeBtnEvt.bind(this,{sender:this}))},closeBtnEvt:function(){this.close()},destroy:function(){v.fn.destroy.call(this)}});T.ui.plugin(t);var x=m.moment,n=T.ui.CommonDialog;t=n.extend({options:{name:"DetailDialog",type:"single",listTemplate:"",hasDetail:!0,NotAllowedBlankFields:["mobilePhoneNumber","email"],timeout:0,dataSource:[],contentViewModel:null,buttonsIndex:{SAVE:0,EDIT:1,CANCEL:2,DELETE:3,CLOSE:4},initialCollapse:!0,parseSaveData:null,setAdditionalDetailData:null,events:["onSave","onSaved","onEdit","onEdited","onClose","onClosed","onDelete","onDeleted","onCancel","onCanceled","onRegister","onDeregister","onDelete","onBlock","onChangeButtons","onChecked","beforeSetDetailData","afterSetDetailData","collapse","expand"]},init:function(e,t){var i=this;t.buttonsIndex&&(i.options.buttonsIndex=E.extend({},t.buttonsIndex)),this._createDefaultActions(t),n.fn.init.call(i,e,t),this.BTN=E.extend({},i.options.buttonsIndex),this._createDataSource(i.options.dataSource);var a=i.element.find(".detail-dialog-content");0<a.length?(i.content(a),i._createContent()):i.content(i._createContent()),i.confirmDialog=E("<div/>").kendoCommonDialog({type:"confirm"}).data("kendoCommonDialog"),i.msgDialog=E("<div/>").kendoCommonDialog().data("kendoCommonDialog"),i.setCloseAction(function(){i._cancelEvent({sender:i},!0)})},_keyHandler:function(e){var t=this,i=e.keyCode,a=t.options,n=t.buttons;if(i==u.ESC)return t.closeBtn.trigger("click"),!1;if(i==u.ENTER){var o=t.BTN.SAVE,r=n[o],s=a.actions[o]?a.actions[o]:{},l=r?r.is(":visible"):s.visible,d=r?r.data("action"):s.action,c=t.buttons[o].prop("disabled");return void 0!==o&&d&&!c&&l&&d.call(t,{sender:t}),!1}},_defaultCancelEvent:function(e){e.sender.trigger("onCancel"),e.sender.cancel(),e.sender.isEditable&&e.sender.setEditable(!1),e.sender.hideInvalidMessage(),e.sender.hideRemoveBtn(),e.sender.trigger("onCanceled")},_cancelEvent:function(e,t){var i=m.I18N;if(e.sender.hasChanged)e.sender.confirmDialog.message(i.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL")),e.sender.confirmDialog.setConfirmActions({yes:function(){e.sender._defaultCancelEvent(e),t&&(e.sender.close(),e.sender.trigger("onClosed"))}}),e.sender.confirmDialog.open();else{try{e.sender._defaultCancelEvent(e)}catch(e){console.error("Common Detail Dialog default cancel event exception")}t&&(e.sender.close(),e.sender.trigger("onClosed"))}return!1},_createDefaultActions:function(e){var t=m.I18N,i=[{text:t.prop("COMMON_BTN_SAVE"),visible:!1,disabled:!0,action:function(e){e.sender.trigger("onSave");var t=e.sender.save();return t&&(e.sender.trigger("onSaved",{sender:e.sender,result:t}),e.sender.setEditable(!1)),!1}},{text:t.prop("COMMON_BTN_EDIT"),action:function(e){return e.sender.trigger("onEdit"),e.sender.setEditable(!0),e.sender.trigger("onEdited"),!1}},{text:t.prop("COMMON_BTN_CANCEL"),visible:!1,action:this._cancelEvent},{text:t.prop("COMMON_BTN_DELETE"),action:function(e){var t=e.sender.getSelectedData();return e.sender.trigger("onDelete",t),!1}},{text:t.prop("COMMON_BTN_CLOSE"),visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1),e.sender.trigger("onClosed")}}];if(0==e.hasDelete&&(i[3]=null),e.actions)if(e.isCustomActions)i=e.actions;else{var a,n=e.actions.length;for(a=0;a<n;a++)i.push(e.actions[a])}this.options.actions=e.actions=i},_createContent:function(){var a=this,e=a.options.contentTemplate;e&&a.element.html(e);var t,i,n,o,r,s=a.element.find(".detail-dialog-content");t=0<s.length?s:E("<div/>").addClass("detail-dialog-content"),this.contentElem=t;var l,d,c=this.options.isOnlyMulti;if(this.selectedIndex=0,this.virtualization=!1,this.dataSource.total()<=1&&!c){this.contentElem.removeClass("multi"),this.grid&&(this.gridElem.remove(),this.grid=null,this.gridElem=null),a._renderHeaderTemplate(),o=this.detailHeaderElem,a._createSingleDetailContentTemplate(),r=this.detailContent,t.has(o).length<1&&t.append(o),t.has(r).length<1&&t.append(r);var u=this.options.setAdditionalDetailData,p=[];if(u&&E.isFunction(u)){var h=this.getSelectedData();if(h){var f=u.call(this,h);f.promise&&p.push(f)}}E.when.apply(this,p).always(function(){a._setSingleDetailData()})}else{this.contentElem.addClass("multi");var g,m,v=a.options.groupListOptions,_=this.dataSource,b=a.element.find(".detail-dialog-header");if(v){var C=E("<div/>").addClass("detail-dialog-group-list");(i=a.options.headerTemplate)&&(i=(i=T.template(i))({count:a.dataSource.total()}),b.html(i)),this.detailHeader=b,v.height="calc(100% - 60px)",this.groupList=C.kendoDeviceTabGroupGrid(v).data("kendoDeviceTabGroupGrid"),l=(l=_.data()).toJSON(),(d=new T.data.DataSource({data:l,pageSize:_.pageSize()})).read(),this.groupList.setDataSource(d),t.append(C)}else{var k=E("<div/>").addClass("detail-dialog-grid");g=a.options.hasDetail;var w,D=a.options.gridOptions;D?(w=D.columns,D.scrollable&&D.scrollable.virtual&&(this.contentElem.addClass("virtualization"),this.virtualization=!0)):D={},i=a.options.headerTemplate,n=a.options.listTemplate,i=(i=T.template(i))({count:a.dataSource.total()}),this.gridElem=k,l=(l=_.data()).toJSON(),m=_.pageSize();var y={dataSource:d=new T.data.DataSource({data:l,pageSize:m}),height:"100%",selectable:"row",scrollable:!0,sortable:!1,filterable:!1,pageable:!1,dataBinding:function(e){a.detailContent&&a.detailContent.is(":visible")&&(this.hasDetailContent=!0,a.detailContent.detach())},dataBound:function(e){if(this.hasDetailContent){var t=this.dataSource.at(a.selectedIndex),i=this.element.find("tr[data-uid='"+t.uid+"']");i.length&&(i.after(a.detailContent),this.hasDetailContent=!1,a.isCollapse&&i.addClass("k-state-selected"))}}};if(w&&0<w.length){this.contentElem.addClass("multi-column");var I,S=w[w.length-1];this.lastColumnTempl||(I=S.template,this.lastColumnTempl=I),(I=this.lastColumnTempl)&&(S.template=a._addCollapseInTemplate(I)),b.html(i),this.detailHeader=b,y.height="calc(100% - 60px)"}else w=[],n=a._addCollapseInTemplate(n),w.push({headerTemplate:i,template:n}),y.columns=w,b.hide();E.extend(y,D),this.grid=k.kendoGrid(y).data("kendoGrid");var x=l.length;if(0<x){if(this.virtualization&&m){var A=k.find(".k-scrollbar.k-scrollbar-vertical");x<m?A.hide():A.show()}this.options.initialCollapse&&(this.grid.select("tr:first-child"),this.collapseRow(0,null,null,0))}t.append(k),this._attachCheckedEvt()}var O=a.options.headerViewModel;g?this._attachCollapseEvt():O&&(this.headerViewModel=T.observable(O),this.detailHeader&&(this._unbindDetailContent(this.detailHeader),T.bind(this.detailHeader,this.headerViewModel)))}return this._attachChangeEvt(),t},_addCollapseInTemplate:function(i){var a=this.options.hasDetail;return E.isFunction(i)?function(e){var t=i(e);return t="<div class='detail-dialog-header detail-multi-dialog-header'>"+t+(a?"<i class='detail-dialog-multi-header-collapse'></i>":"")+"</div>"}:i="<div class='detail-dialog-header detail-multi-dialog-header'>"+i+(a?"<i class='detail-dialog-multi-header-collapse'></i>":"")+"</div>"},_attachCheckedEvt:function(){var t=this;t.grid.bind("checked",function(e){t.trigger("onChecked",e)})},_attachCollapseEvt:function(){var r=this;this.grid.bind("change",function(e){var t,i,a=this.select();if(!(0<a.length))return r.detailContent.slideUp(300),void(r.isCollapse=!1);var n=this.options.selectable;if(n=-1!=n.indexOf("multiple")){if(i=e.item){if(!i.selected)return r.detailContent.slideUp(300),void(r.isCollapse=!1);E(a).each(function(){if(E(this).data("uid")==i.uid)return t=this,!1})}}else t=a[0],i=this.dataItem(t);console.info(i);var o=this.dataSource.indexOf(i);console.info(o),r.collapseRow(o,i,t)})},collapseRow:function(e,t,i,a){if(this.options.hasDetail){if(t=t||this.grid.dataSource.at(e),!i){var n=t.uid;i=this.grid.element.find("tr[data-uid='"+n+"']")}if(t){this.isEditable&&this.save(!0);var o=this.detailContent;o&&(this._unbindDetailContent(o),o.is(":visible")?(this.trigger("collapse"),o.slideUp(300,function(){o.remove()}),this.isCollapse=!1):o.remove()),this.selectedIndex=e,this._createSingleDetailContentTemplate();var r=this.options.setAdditionalDetailData,s=[];if(r&&E.isFunction(r)){var l=this.getSelectedData();if(l){var d=r.call(this,l);d.promise&&s.push(d)}}var c=this;E.when.apply(this,s).always(function(){c._setSingleDetailData(!0),c.detailContent.hide(),c.isEditable&&c.setContentEditable(c.isEditable),0<E(i).length&&(c.updateDetailContentWidth(),E(i).after(c.detailContent),void 0!==a?c.detailContent.slideDown(a):c.detailContent.slideDown(300),c.isCollapse=!0,c.trigger("expand"))})}}},_getDetailContentWidth:function(){var e=0;return this.grid&&(e=E(this.grid.element).width(),this.grid.options.scrollable&&this.grid.options.scrollable.virtual&&(e-=16)),0==e&&(e=this.contentElem.width()),e},_unbindDetailContent:function(e){T.unbind(e)},_unbindFields:function(){var e,t=this.editFields;if(t)for(e in t)T.unbind(t[e]);if(t=this.displayFields)for(e in t)T.unbind(t[e])},_renderHeaderTemplate:function(){var e,t,i=this.options.headerTemplate,a=this.options.listTemplate,n=this.dataSource.total(),o=this.selectedIndex,r=this.dataSource.at(o);n<=1&&a&&(i=a),e=0<(t=this.element.find(".detail-dialog-header")).length?t:E("<div/>").addClass("detail-dialog-header");var s="";i&&(E.isFunction(i)?r&&(s=i(r),e.html(s)):(r&&(s=(s=T.template(i))(r)),e.html(s)),this.detailHeaderElem=e,this.detailHeaderHtml=e.get(0).outerHTML)},_renderListTemplate:function(){var e,t,i=this.options.listTemplate,a=this.selectedIndex,n=this.dataSource.at(a),o="";e=E("<div/>").addClass("detail-dialog-multi-header"),t=E("<i/>").addClass("detail-dialog-multi-header-collapse"),i&&(E.isFunction(i)?n&&(o=i(n),e.html(o),e.append(t)):(n&&(o=(o=T.template(i))(n)),e.html(o),e.append(t)),this.detailListHeaderElem=e,this.detailListHeaderHtml=e.get(0).outerHTML)},_createDataSource:function(e){var t,i,a=this.options.virtualization,n=m.GlobalSettings;if(this.updatedItems=[],e instanceof T.data.DataSource){var o=e.data();t=e.pageSize(),i=this._createScheme(),this.options.dataSource=new T.data.DataSource({data:o,pageSize:t,schema:i})}else E.isArray(e)||(e=[e]),t=n.getPageSize()?n.getPageSize():20,t=a?t:void 0,console.info(e),i=this._createScheme(),this.options.dataSource=new T.data.DataSource({data:e,pageSize:t,schema:i});this.dataSource=this.options.dataSource,this.dataSource.read()},_createScheme:function(){var e=this.options.scheme;if(e){var t={model:{}},i=t.model;i.id=e.id,i.fields={};var a,n,o,r,s=e.fields;for(a in s)o=(n=s[a]).type,r=n.name,o="email"==o?"string":"datetime"==o?"date":"object",i.fields[a]={type:o,name:r};return t}},setDataSource:function(e){this._createDataSource(e),this.detailContent||this._createSingleDetailContentTemplate();var t=this.element.find(".detail-dialog-content");0<t.length?(this.content(t),this._createContent()):this.content(this._createContent())},_createSingleDetailContentTemplate:function(){if(this.options.hasDetail){var e,t=this.element.find(".detail-dialog-detail-content"),i=this.dataSource.total();e=0<t.length&&i<2?t:E("<div/>").addClass("detail-dialog-detail-content");var a=this.options.detailContentTemplate;a&&e.html(a);var n,o,r=e.find(".detail-dialog-detail-content-field-list"),s=!1;0<r.length?(s=!0,(n=r).empty()):n=E("<ul/>").addClass("detail-dialog-detail-content-field-list");var l=this.options.scheme;if(l){var d,c=l.fields;this.displayFields={},this.editFields={};var u,p,h,f,g=l.groupName;for(o in c)d=this._createFieldElem(o,c[o]),c[o]&&c[o].groupName&&g?(p=g[u=c[o].groupName],(h=n.find(".detail-dialog-detail-content-group[data-name='"+u+"']")).length<1&&((h=E("<div/>").addClass("detail-dialog-detail-content-group")).attr("data-name",u),f=p.template?p.template:E("<div/>").addClass("group-name").html(u),h.html(f)),h.append(d),n.append(h)):n.append(d),c.hidden&&(d.hide(),d.addClass("hide"))}s||e.append(n),this.detailContent=e}else this.detailContent=E("<div/>")},_createRemoveBtnIcon:function(){return E("<i/>").addClass("ic ic-bt-input-remove")},_attachChangeEvt:function(){var u=this;this.contentElem.on("keyup",".detail-dialog-detail-content input",function(e){var t=E(this);if(u.options.enableSaveBtnOnInputChange){var i=t.closest("[data-role='commonvalidator']");if(u.hasChanged=!0,0<i.length)if((i=i.data("kendoCommonValidator")).validate())t.closest(u.options.invalidScrollFieldListClass).find("input.k-invalid").length<1&&u.enableSaveBtn();else u.disableSaveBtn();else u.enableSaveBtn()}var a=t.siblings(".ic-bt-input-remove");0<a.length&&(E(this).val()?a.is(":visible")||a.show():a.hide())}),this.contentElem.on("click",".detail-dialog-detail-content .ic.ic-bt-input-remove",function(e){var t=E(this),i=t.siblings("input");i.val(""),i.data("kendoCommonValidator")&&i.data("kendoCommonValidator").validate(),t.hide(),u.options.enableSaveBtnOnInputChange&&(u.hasChanged=!0,u.enableSaveBtn())}),this.contentElem.on("click",".detail-dialog-detail-content .edit-all-btn",function(e){var t=E(this).closest(".detail-dialog-content-field-item").data("key"),i=u.saveSingleField(t);if(i){var a,n,o=u.getSelectedData(),r=u.options.scheme.fields,s=i[t];r[t]&&r[t].customFieldKey?(n=r[t].customFieldKey,E.isFunction(n)&&o&&(n=n(o,i)),s=o.get(n)):r[t]&&r[t].editFieldName&&r[t].editFieldName!=t&&(a=r[t].editFieldName,E.isFunction(a)&&o&&(a=a(o)),s=(s=i[t=a])||o.get(t));var l,d=u.dataSource.data(),c=d.length;for(l=0;l<c;l++)d[l]!==o&&(d[l].set(t,s),n&&d[l].set(n,s));u.options.enableSaveBtnOnInputChange&&(u.hasChanged=!0,u.enableSaveBtn())}})},enableSaveBtn:function(e){var t=this.BTN,i=this.options.enableSaveBtnCondition;this.buttons[t.SAVE].prop("disabled")&&(i&&E.isFunction(i)?i.call(this)&&this.setActions(t.SAVE,{disabled:!1}):this.setActions(t.SAVE,{disabled:!1}))},disableSaveBtn:function(e){var t=this.BTN,i=this.options.disableSaveBtnCondition;this.buttons[t.SAVE].prop("disabled")||(i&&E.isFunction(i)?i.call(this)&&this.setActions(t.SAVE,{disabled:!0}):this.setActions(t.SAVE,{disabled:!0}))},updateDisplayValue:function(){this._setSingleDetailData()},_setSingleDetailData:function(e){var t=this.options.contentViewModel,i=this.options.headerViewModel,a={};t=t&&E.extend(a,t);var n=this.selectedIndex,o=this.dataSource.at(n);this.trigger("beforeSetDetailData",{item:o}),o&&(a=E.extend(a,o));var r=this.dataSource?this.dataSource.total():0;a=T.observable(a),this.contentViewModel=a,!i||e&&this.headerViewModel||(this.headerViewModel=T.observable(i)),1<r?(this._unbindDetailContent(this.detailContent),T.bind(this.detailContent,a),this.detailHeader&&(this._unbindDetailContent(this.detailHeader),T.bind(this.detailHeader,this.headerViewModel))):(this._unbindDetailContent(this.contentElem),this._unbindFields(),T.bind(this.contentElem,a));var s=this.options.scheme;if(o&&s){var l,d,c,u=s.fields,p=this.options.selectedDetailFilter;for(l in p&&E.isFunction(p)&&(c=p(o)),u)d=this.displayFields[l],c&&-1!=c.indexOf(l)?d.closest(".detail-dialog-content-field-item").hide():this.setDisplayFieldValue(l,u[l],o);var h=s.groupName;if(p=this.options.selectedDetailFilter,h&&c)for(l in h)-1!=c.indexOf(l)&&this.detailContent.find(".detail-dialog-detail-content-group[data-name='"+l+"']").hide();this._bindDisplayViewModel()}this.trigger("afterSetDetailData")},updateDisplayField:function(e){var t=this.options.scheme.fields,i=this.getSelectedData();this.setDisplayFieldValue(e,t[e],i)},setDisplayFieldValue:function(e,t,i){var a=this.displayFields[e];if(a){var n,o,r,s=t.type,l=t.template,d=t.format,c=t.gridOptions,u=t.viewModel,p=t.fieldName,h=t.widgetDisplaySetter,f=i[e],g=[],m={};if(f=f||"-",l&&"grid"!=s){if(E.isFunction(l)?a.html(l(i)):(o=T.template(l),a.html(o(i))),u&&u.fields){var v=u.fields;if(p&&(E.isFunction(p)&&i&&(p=p(i)),f=i.get(p)),v instanceof T.data.ObservableObject&&(v=v.toJSON()),f){if((E.isArray(f)||f instanceof T.data.ObservableArray)&&(f=f[0]),f)if(p)if(E.isPlainObject(f)||f instanceof T.data.ObservableObject)for(n in v)u.fields[n]=f[n];else u.fields[p]=f;else if(E.isPlainObject(f)||f instanceof T.data.ObservableObject)for(n in v)u.fields[n]=f[n];else u.fields[e]=f}else for(n in v)u.fields[n]&&i[n]&&(u.fields[n]=i[n])}u&&u.init&&E.isFunction(u.init)&&u.init()}else if("email"==s||"text"==s||"select"==s)a.text(f);else if("datetime"==s){var _=x(f);d&&(f=_.format(d)),a.text(f)}else if("number"==s)a.text(f);else if("object"!=s)if("grid"==s){var b;if(t.gridOptions&&(m=t.gridOptions,r=t.gridOptions.group,b=t.gridOptions.filter),t.gridDataSource&&(E.isFunction(t.gridDataSource)?g=t.gridDataSource(i):E.isArray(t.gridDataSource)&&(g=t.gridDataSource)),g&&g.length<1&&l)return void(E.isFunction(l)?a.html(l(i)):(o=T.template(l),a.html(o(i))));(g=new T.data.DataSource({data:g})).read(),m.dataSource=g;var C,k,w=a.data("kendoGrid");w&&(w.wrapper&&(C=(k=w.wrapper).parent(".detail-dialog-content-field-value"),a.appendTo(C)),w.destroy(),k&&k.remove()),a.empty(),a.kendoGrid(m),g=a.data("kendoGrid").dataSource,r&&g.group(r),b&&g.group(b),c.hideHeader&&a.find(".k-grid-header").hide()}else if(s&&s.fn&&s.fn.options&&s.fn.options.name){var D,y=s,I="kendo"+y.fn.options.name;if(t.widgetOptions&&(m=E.extend(m,t.widgetOptions),r=t.widgetOptions.group,D=t.widgetOptions.filter),t.widgetDataSource&&(E.isFunction(t.widgetDataSource)?g=t.widgetDataSource(i):E.isArray(t.widgetDataSource)&&(g=t.widgetDataSource)),g&&g.length<1&&l)return void(E.isFunction(l)?a.html(l(i)):(o=T.template(l),a.html(o(i))));(g=new T.data.DataSource({data:g})).read(),m.dataSource=g;var S=a.data(I);S&&S.destroy(),a.empty(),g=(S=new y(a,m)).dataSource,!y.fn.options.group&&r&&g.group(r),!y.fn.options.filter&&D&&g.group(D),!y.fn.options.hideHeader&&m.hideHeader&&a.find(".k-grid-header").hide(),h&&E.isFunction(h)&&h.call(t,{sender:this,widget:S,data:i})}}},updateEditField:function(e){var t=this.options.scheme.fields,i=this.getSelectedData();this.setEditableFieldValue(e,t[e],i)},setEditableFieldValue:function(e,t,i){var a=this.editFields[e];if(a){var n,o=t.type,r=t.validator,s=t.editTemplate,l=t.editViewModel,d=t.editFieldName,c=t.getEditableData,u=t.widgetEditSetter,p=i[e];if(c&&E.isFunction(c)&&(p=c(i)),s){if(E.isFunction(s))a.html(s(i,l));else{var h=T.template(s);a.html(h(i))}if(l.fields){var f=l.fields;if(d&&(E.isFunction(d)&&i&&(d=d(i)),p=i.get(d)),f instanceof T.data.ObservableObject&&(f=f.toJSON()),null!=p){if((E.isArray(p)||p instanceof T.data.ObservableArray)&&(p=p[0]),null!=p)if(d)if(E.isPlainObject(p)||p instanceof T.data.ObservableObject)for(n in f)l.fields[n]=p[n];else l.fields[d]=p;else if(E.isPlainObject(p)||p instanceof T.data.ObservableObject)for(n in f)l.fields[n]=p[n];else l.fields[e]=p}else for(n in f)l.fields[n]&&i[n]?l.fields[n]=i[n]:i[n]||(l.fields[n]=null)}l.init&&E.isFunction(l.init)&&l.init()}else if("email"==o||"text"==o)r?a.data("kendoCommonValidator").element.val(p):a.val(p);else if("select"==o)a.data("kendoDropDownList").value(p);else if("date"==o)a.data("kendoCommonDatePicker").value(p);else if("number"==o)a.data("kendoNumericTextBox").value(p);else if("object"!=o&&o&&o.fn.options&&o.fn.options.name){var g="kendo"+o.fn.options.name,m=a.data(g);m.value?m.value(p):u&&E.isFunction(u)?u.call(t,{sender:this,widget:m,data:i}):console.info("this widget instance "+g+" has no set value function.")}}},getEditableFieldValue:function(e,t){var i=this.editFields[e];if(i){var a=t.type,n=t.validator,o=t.editTemplate,r=t.editViewModel,s=t.customFieldKey,l=t.widgetEditGetter,d=t.editFieldGetter,c=null;if(o){if(r&&r.fields){var u,p={},h=r.fields;for(u in h instanceof T.data.ObservableObject&&(h=h.toJSON()),h)void 0!==(c=h[u])&&(s?p=c:p[u]=c);c=p}}else if(d&&E.isFunction(d))c=d(t);else if("email"==a||"text"==a)c=n?i.data("kendoCommonValidator").element.val():i.val();else if("select"==a)c=i.data("kendoDropDownList").value();else if("datetime"!=a)if("number"==a)c=i.data("kendoNumericTextBox").value();else if(a&&a.fn&&a.fn.options&&a.fn.options.name){var f="kendo"+a.fn.options.name,g=i.data(f);g.value?c=g.value():l&&E.isFunction(l)?c=l.call(t,{sender:this,widget:g}):console.info("this widget instance "+f+" has no get value function.")}return"array"==a&&(c=[c]),c}},setEditableValue:function(e){var t=this.options.scheme;if(t){var i,a=t.fields;for(i in a)this.setEditableFieldValue(i,a[i],e)}},setEditable:function(e){this.hasChanged=!1,this.isEditable=e,this.setContentEditable(e),this.setBtnEditable(e),e&&this.contentElem.find("input.k-input").eq(0).focus()},setDialogType:function(e){this.dialogType=e,this.options.onTypeChange&&E.isFunction(this.options.onTypeChange)&&this.options.onTypeChange({sender:this,type:e})},setContentEditable:function(e){var t;e?(this.contentElem.addClass("edit-mode"),t=this.getSelectedData(),this.setEditableValue(t),this._bindEditableViewModel()):(this.updateFieldVisible(),this.contentElem.removeClass("edit-mode"))},updateFieldVisible:function(){var e=this.options.scheme,t=this.getSelectedData();if(e){var i,a,n,o,r=e.fields,s=this.options.selectedDetailFilter;for(i in s&&E.isFunction(s)&&(a=s(t)),r)o=(n=this.displayFields[i].closest(".detail-dialog-content-field-item")).is(":visible"),a&&-1!=a.indexOf(i)?n.hide():o||n.show()}},setBtnEditable:function(e){var t=this.BTN;this.setActions(t.SAVE,{visible:e,disabled:!0}),this.setActions(t.CANCEL,{visible:e}),this.setActions(t.EDIT,{visible:!e}),this.setActions(t.DELETE,{visible:!e}),this.setActions(t.CLOSE,{visible:!e})},saveSingleField:function(e){var t,i,a,n,o,r,s,l,d=this.editFields,c=this.options.scheme,u=this.options.NotAllowedBlankFields,p=this.options.saveOnlyVisibleField,h=c.fields,f=h[e].validationRule,g=!0,m={},v=this.selectedIndex;if(i=this.dataSource.at(v),l=h[e].editable,E.isFunction(l)&&(l=l(i)),!l&&!d[e])return!1;if(!l&&d[e]&&!d[e].isForceEditable)return!1;if(p&&d[e]&&!d[e].is(":visible"))return!1;if(d[e].data("kendoCommonValidator")&&(g=d[e].data("kendoCommonValidator").validate()),f&&(g=f(h[e],d[e])),g){t=this.getEditableFieldValue(e,h[e]);var _=0;if(n=h[e].editFieldName)if(E.isFunction(n)&&i&&(n=n(i)),"object"==h[e].type)if(m[n]||(-1!=(o=n.indexOf("["))?(r=n.substring(0,o),_=n.substring(o+1,o+2),m[r]||(m[r]=[],m[r].push({}))):m[n]={}),-1!=o)for(a in t)m[r][_][a]=t[a];else for(a in t)m[n][a]=t[a];else{for(a in t)m[n]=t[a];t=m[n]}(s=h[e].customFieldName)?(E.isFunction(s)&&(s=s(i)),S.setter(m,s,t)):null!=t&&(-1==u.indexOf(e)?m[e]=t:""===t&&t!=i[e]?m[e]=t:""!==t&&(m[e]=t))}return!!g&&(t=m[e],i.set(e,t),this.options.parseSaveData&&(m=this.options.parseSaveData(i,m)),m)},save:function(e,t){var i,a,n,o,r,s,l,d,c,u,p,h,f,g,m=this.editFields,v=this.options,_=v.scheme,b=v.NotAllowedBlankFields,C=v.saveOnlyVisibleField,k=_.fields,w=!0,D={},y=this.selectedIndex;for(i in o=this.dataSource.at(y),D.id=o.id,k)if(u=k[i].editable,E.isFunction(u)&&(u=u(o)),(u||m[i])&&(u||!m[i]||m[i].isForceEditable)&&(!C||!m[i]||m[i].is(":visible"))){if(k[i].validator&&m[i]&&m[i].data("kendoCommonValidator")&&(w=m[i].data("kendoCommonValidator").validate()),k[i].validationRule&&(w=k[i].validationRule(k[i],m[i])),!w&&!t){a=m[i];break}if(n=this.getEditableFieldValue(i,k[i]),s=k[i].editFieldName){E.isFunction(s)&&o&&(s=s(o));var I=0;if("object"==k[i].type)if(D[s]||(-1!=(l=s.indexOf("["))?(I=s.substring(l+1,l+2),D[d=s.substring(0,l)]||(D[d]=[],D[d].push({}))):D[s]={}),-1!=l)for(r in n)D[d][I][r]=n[r];else for(r in n)D[s][r]=n[r];else for(r in n)D[s]=n[r]}else(c=k[i].customFieldName)?(E.isFunction(c)&&(c=c(o)),S.setter(D,c,n)):null!=n&&(-1==b.indexOf(i)?D[i]=n:""===n&&n!=o[i]?D[i]=n:""!==n&&(D[i]=n))}if(!w&&!t)return!e&&a&&this.detailContent&&this.scrollToField(a),!1;for(i in D)if(n=D[i],"meters"!=i&&"users"!=i&&"devices"!=i)t||o.set(i,D[i]);else for(h=n.length,p=0;p<h;p++)for(d in f=n[p],(g=o.get(i+"["+p+"]"))||((g=o.get(i))||(g=[],t||o.set(i,g)),g={},t||o.set(i+"["+p+"]",g),g=o.get(i+"["+p+"]")),f)t||g.set(d,f[d]);return this.options.parseSaveData&&(D=this.options.parseSaveData(o,D)),D},scrollToField:function(e){var t=this.options,i=t.invalidScrollFieldClass,a=t.invalidScrollWrapperClass,n=t.invalidScrollFieldListClass;if((e=e.closest(i)).is(":visible")){var o=e.closest(a),r=e.closest(n),s=e.position();if(0<r.length){var l=r.offset();s.top=s.top-l.top}o.scrollTop(s.top)}},saveAll:function(e,t){var i;this.save(),i=t?this.dataSource.updated():this.dataSource.data();var a,n,o,r,s,l,d,c,u,p,h,f,g=this.options.scheme,m=this.options.saveOnlyVisibleField,v=g.fields,_=i.length,b=this.editFields,C=[];for(o=0;o<_;o++){for(n in s=i[o],r={},v)if(f=v[n].editable,E.isFunction(f)&&(f=f(s)),(f||b[n])&&(f||!b[n]||b[n].isForceEditable)&&(!m||!b[n]||b[n].is(":visible")))if((a=v[n])&&a.editFieldName){p=a.editFieldName,E.isFunction(p)&&s&&(p=p(s));var k=0;if(-1!=(l=p.indexOf("["))){if(d=p.substring(0,l),k=p.substring(l+1,l+2),r[d]||(r[d]=[],r[d].push({})),a.editViewModel&&a.editViewModel.fields)for(c in(u=a.editViewModel.fields)instanceof T.data.ObservableObject&&(u=u.toJSON()),u)s[d]&&s[d][k]&&(r[d][k][c]=s[d][k][c])}else r[p]=s[p]}else a&&a.customFieldName?(h=a.customFieldName,E.isFunction(h)&&(h=h(s)),S.setter(r,h,S.getter(s,h))):r[n]=s[n];if(r.id=s.id,e)for(n in e)r[n]=e[n];C.push(r)}return this.options.parseSaveData&&(C=this.options.parseSaveData(i,C)),C},cancel:function(){this.cancelDataSource(),this.grid&&this.updateDisplayValue()},success:function(){if(this.updateDisplayValue(),this.grid){var e=this.dataSource.data();e=e.toJSON();var t=new T.data.DataSource({data:e});this.grid.setDataSource(t)}this.dataSource&&this.dataSource.data(this.dataSource.data())},fail:function(){this.cancel()},updateDataSource:function(e){var t,i,a=this.contentElem.data("id"),n=this.dataSource.get(a);for(t in e)(i=e[t])&&n.set(t,i);this.updateDisplayValue()},cancelDataSource:function(){this.dataSource.cancelChanges()},hideRemoveBtn:function(){this.detailContent.find(".ic.ic-bt-input-remove").hide()},hideInvalidMessage:function(){var e,t=this.editFields;for(e in t)t[e].data("kendoCommonValidator")&&t[e].data("kendoCommonValidator").hideMessages()},open:function(e){this.dataSource&&0==this.dataSource.total()&&this.setDataSource(this.dataSource),this.setDialogType(e);var t=n.fn.open.call(this);return this.updateDetailContentWidth(),this.virtualization&&this.grid&&this.grid.dataSource.fetch(),t},updateDetailContentWidth:function(){this.grid&&this.detailContent&&this.detailContent.width(this._getDetailContentWidth())},getSelectedData:function(){var e=this.selectedIndex;return this.dataSource.at(e)},_processTemplate:function(){},_createContentList:function(){},_bindDisplayViewModel:function(){var e,t=this.options.scheme.fields;for(e in t)this._bindDisplayViewModelField(e,t[e])},_bindDisplayViewModelField:function(e,t){var i=t.viewModel,a=this.displayFields[e];a&&i&&(i=t.viewModel=T.observable(i),T.bind(a,i),this.displayFields[e].viewModel=i)},_bindEditableViewModel:function(){var e=this.options.scheme;if(e){var t,i=e.fields;for(t in i)this._bindEditableViewModelField(t,i[t])}},_bindEditableViewModelField:function(e,t){var i=t.editViewModel,a=this.editFields[e];a&&i&&(i=t.editViewModel=T.observable(i),T.bind(a,i),this.editFields[e].viewModel=i)},_createFieldElem:function(e,t){var i,a=t.type,n=t.editable,o=t.template,r=t.valueFieldDisplayType,s=this.getSelectedData();E.isFunction(n)&&(n=!!s&&n(s));var l=t.type;a&&a.fn&&a.fn.options&&a.fn.options.name&&(l=l.fn.options.name);var d=E("<li/>").addClass("detail-dialog-content-field-item").attr({"data-type":l,"data-editable":n,"data-key":e});(i=E("<div/>").addClass("detail-dialog-content-field-name")).html(t.name),i.appendTo(d);var c=E("<div/>").addClass("detail-dialog-content-field-value");"row"==r&&c.addClass("row");var u=E("<span/>").addClass("display");return o&&u.addClass("detail-dialog-content-field-template"),u.appendTo(c),this.displayFields[e]=u,n&&this.createEditableFieldElem(c,e,t),c.appendTo(d),d},createEditableFieldElem:function(e,t,i){var a=i.type,n=i.validator,o=i.numeric,r=i.dropdown,s=i.editTemplate,l=i.editCss,d=i.hasInputRemoveBtn,c=i.datepicker,u=i.isEditAll,p=i.widgetOptions;l=l||{};var h,f=E("<span/>").addClass("editable");if(s?h=E("<span/>").addClass("detail-dialog-content-field-template").appendTo(f).css(l):"email"==a?h=E("<input/>").attr({type:"email"}).addClass("k-input").appendTo(f).css(l):"text"==a?h=E("<input/>").attr({type:"text"}).addClass("k-input").appendTo(f).css(l):"select"==a?(h=E("<select/>").appendTo(f).css(l),r?(r.animation=!1,h.kendoDropDownList(r)):h.kendoDropDownList({animation:!1}),h.kendoDropDownList.bind("change",this.enableSaveBtn.bind(this))):"date"==a?(h=E("<input/>").appendTo(f).css(l),c?h.kendoCommonDatePicker(c):h.kendoCommonDatePicker()):"number"==a&&(h=E("<input/>").appendTo(f).css(l),o?h.kendoNumericTextBox(o):h.kendoNumericTextBox({spinner:!1})),"email"!=a&&"text"!=a||!n||(E.isPlainObject(n)?h.kendoCommonValidator(n):h.kendoCommonValidator({type:t})),"email"!=a&&"text"!=a||d&&(this._createRemoveBtnIcon().appendTo(f),h.addClass("has-remove-btn")),a&&a.fn&&a.fn.options&&a.fn.options.name){new a(h=E("<div/>").addClass("detail-dialog-content-field-widget").appendTo(f).css(l),p)}if(this.editFields[t]=h,f.appendTo(e),u){f.addClass("has-edit-all-btn");var g=m.I18N;E("<button/>").addClass("k-button edit-all-btn editable").text(g.prop("COMMON_BTN_CHANGE_ALL")).appendTo(e)}},setEditableFieldElem:function(e,t){var i=this,a=i.displayFields[e];if(a){var n=a.closest(".detail-dialog-content-field-value");if(0!=n.length){var o=n.closest(".detail-dialog-content-field-item");if(t){if(o.attr("data-editable",!0),o.show(),i.editFields[e])return;var r=this.options.scheme.fields;i.createEditableFieldElem(n,e,r[e]),i.editFields[e].isForceEditable=!0;var s=this.getSelectedData();i.setEditableFieldValue(e,r[e],s),i._bindEditableViewModelField(e,r[e])}else{if(o.attr("data-editable",!1),o.hide(),!i.editFields[e])return;T.unbind(i.editFields[e]),i.editFields[e].closest("span.editable").remove(),delete i.editFields[e]}}}}}),T.ui.plugin(t)}(window,window.kendo.jQuery),function(f,v){"use strict";var i=/^[A-Za-z0-9_.]+$/,a=/^(?=.*[a-zA-Z])(?=.*\d)(?=.*[`~!@#$%^&*()_\-=+])[a-zA-Z\d`~!@#$%^&*()_\-=+]{8,20}$/,n=/^[A-Za-z0-9`~!@#$%^&*()_\-=+]+$/,o=/^(?=.{4,25}$)(?:(?:\(?(?:00|\+)([1-4]\d\d|[1-9]\d?)\)?)?[\-\.\ \\\/]?)?((?:\(?\d{1,}\)?[\-\.\ \\\/]?){0,})(?:[\-\.\ \\\/]?[\-\.\ \\\/]?(\d+))?$/,r=/^[0-9-(+)\s]+$/,s=/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/,l=/^[A-Za-z0-9_.@+-]+$/,d=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,c=/^[A-Za-z0-9.-]+$/,u=/^(0|[1-9][0-9]*)$/,p=/^[-+]?[0-9]+(\.[0-9]{1,2})?$/,h=/^(?=.{4,255}$)([\p{L}_\-\s0-9\.]+)\.key$/,g=/^(E2C56DB5\-DFFB\-).*$/,m=/^[A-Fa-f0-9-]+$/,_=/^(?=.{1,255}$)([\._\-\s0-9a-zA-Z\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]+)$/,b=/^#([A-Fa-f0-9]{6}$)/,C=":input:not(:button,[type=submit],[type=reset],[disabled],[readonly])",k="k-invalid-msg";function w(e){var t=e.data("kendoCommonValidator");return t=t||e.closest("[data-role='commonvalidator']").data("kendoCommonValidator")}var D=f.kendo,y=D.ui.Validator,e=y.extend({options:{name:"CommonValidator",required:!1,type:null,minLength:null,maxLength:null,min:null,max:null,passwordRetypeFor:null,oldPassword:null,mixedPasswordCheck:!0,isKeyUpValidation:!0,scrollWrapperClass:null,builtInMinMax:{id:{min:5,max:16},password:{min:8,max:20},passwordRetype:{min:8,max:20},name:{min:1,max:30},hmiGraphicName:{min:1,max:50},hmiLibraryName:{min:1,max:30},mobilePhoneNumber:{min:4,max:25},email:{min:5,max:253},networkId:{min:1,max:32},description:{max:300},organization:{min:1,max:30}},builtInRules:{minLength:function(e){var t=w(e).options.minLength;if(t){var i=e.val();if(""!==i&&i.length<t)return!1}return!0},maxLength:function(e){var t=w(e).options.maxLength;if(t){var i=e.val();if(""!==i&&i.length>t)return!1}return!0}},builtInMessages:{minLength:function(){var e=this.options.minLength;return f.I18N.prop("COMMON_CANNOT_INPUT_LESS",e)},maxLength:function(){var e=this.options.maxLength;return f.I18N.prop("COMMON_CANNOT_INPUT_MORE",e)}},builtInOptions:{id:{messages:{capslock:"COMMON_CAPS_LOCK_ON",invalidCharacter:"COMMON_INVALID_CHARACTER",required:"COMMON_REQUIRED_ID",alreadyUse:"COMMON_EXIST_ID"},rules:{invalidCharacter:function(e){var t=e.val();return!t||t.match(i)}}},password:{messages:{capslock:"COMMON_CAPS_LOCK_ON",invalidCharacter:"COMMON_INVALID_CHARACTER",required:"COMMON_REQUIRED_PASSWORD",incorrect:"COMMON_INCORRECT_PASSWORD",incorrectBoth:"COMMON_INCORRECT_USERNAME_AND_PASSWORD",pwMixedCharacter:"COMMON_MUST_MIXED_PASSWORD",sameOldPassword:"COMMON_SAME_OLD_PASSWORD"},rules:{invalidCharacter:function(e){var t=e.val();return!t||t.match(n)},pwMixedCharacter:function(e){var t=e.val();return!t||t.match(a)},sameOldPassword:function(e){var t=e.val(),i=w(e).options.oldPassword;return!i||!(i.val()==t)}}},name:{messages:{required:"COMMON_REQUIRED_INFORMATION"}},name_16:{messages:{required:"COMMON_REQUIRED_INFORMATION",under16:"COMMON_NOT_LENGTH_16"},rules:{under16:function(e){return!(16<e.val().length)}}},hmiGraphicName:{messages:{required:"COMMON_REQUIRED_INFORMATION",invalidCharacter:"COMMON_INVALID_CHARACTER"},rules:{invalidCharacter:function(e){var t=e.val();return!t||t.match(_)}}},hmiLibraryName:{messages:{required:"COMMON_REQUIRED_INFORMATION",invalidCharacter:"COMMON_INVALID_CHARACTER"},rules:{invalidCharacter:function(e){var t=e.val();return!t||t.match(_)}}},hexColor:{messages:{invalidColor:"COMMON_INVALID_COLOR"},rules:{invalidColor:function(e){var t=e.val();return!t||t.match(b)}}},description:{messages:{required:"COMMON_REQUIRED_INFORMATION"}},mobilePhoneNumber:{messages:{invalidCharacter:"COMMON_INVALID_CHARACTER",invalidPhone:"COMMON_INVALID_PHONE_NUMBER"},rules:{invalidCharacter:function(e){var t=e.val();return!t||t.match(r)},invalidPhone:function(e){var t=e.val();return!t||t.match(o)}}},email:{messages:{email:"COMMON_INVALID_EMAIL_ADDRESS",invalidCharacter:"COMMON_INVALID_CHARACTER"},rules:{email:function(e){var t=e.val();return!t||t.match(s)},invalidCharacter:function(e){var t=e.val();return!t||t.match(l)}}},passwordRetype:{messages:{required:"COMMON_REQUIRED_INFORMATION",notMatched:"COMMON_NOT_MATCHED_PASSWORD",invalidCharacter:"COMMON_INVALID_CHARACTER",pwMixedCharacter:"COMMON_MUST_MIXED_PASSWORD"},rules:{notMatched:function(e){return e.val()==w(e).options.passwordRetypeFor.val()},invalidCharacter:function(e){var t=e.val();return!t||t.match(n)},pwMixedCharacter:function(e){var t=e.val();return!t||t.match(a)}}},ipAddress:{messages:{required:"COMMON_REQUIRED_INFORMATION",invalidIpAddress:"COMMON_INVALID_CHARACTER"},rules:{invalidIpAddress:function(e){var t=e.val();return!t||t.match(d)}}},networkId:{messages:{required:"COMMON_REQUIRED_INFORMATION",invalidNetworkId:"COMMON_INVALID_CHARACTER"},rules:{invalidNetworkId:function(e){var t=e.val();return!t||t.match(c)}}},onlyNumber:{messages:{required:"COMMON_REQUIRED_INFORMATION",invalidNumber:"COMMON_INVALID_VALUE"},rules:{invalidNumber:function(e){var t=e.val();return!t||t.match(u)}}},numeric:{messages:{required:"COMMON_REQUIRED_INFORMATION",numeric:"COMMON_INVALID_VALUE",min:function(e){var t=w(e).options.min;return f.I18N.prop("COMMON_INVALID_MIN",t)},max:function(e){var t=w(e).options.max;return f.I18N.prop("COMMON_INVALID_MAX",t)}},rules:{numeric:function(e){var t=e.val();return!t||t.match(u)},min:function(e){var t=w(e).options.min;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!((i=Number(i))<t)},max:function(e){var t=w(e).options.max;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!(t<(i=Number(i)))}}},hmiValueMinMax:{messages:{required:"COMMON_REQUIRED_INFORMATION",decimal:"COMMON_INVALID_VALUE",min:function(e){var t=w(e).options.min;return f.I18N.prop("COMMON_INVALID_MIN",t)},max:function(e){var t=w(e).options.max;return f.I18N.prop("COMMON_INVALID_MAX",t)},minField:function(e){var t=f.I18N,i="numerictextbox"==e.attr("data-role"),a=e.hasClass("k-formatted-value"),n=".value .k-input";(i||a)&&(n=".value .k-input[data-role='numerictextbox']");var o=e.closest(".hmi-binding-property-inner-wrapper").find(".hmi-binding-property-category[data-key='minMax']").find("ul.category-items").find("li.property[data-key='minValue']").find(n).val();return t.prop("COMMON_INVALID_MIN",o)},maxField:function(e){var t=f.I18N,i="numerictextbox"==e.attr("data-role"),a=e.hasClass("k-formatted-value"),n=".value .k-input";(i||a)&&(n=".value .k-input[data-role='numerictextbox']");var o=e.closest(".hmi-binding-property-inner-wrapper").find(".hmi-binding-property-category[data-key='minMax']").find("ul.category-items").find("li.property[data-key='maxValue']").find(n).val();return t.prop("COMMON_INVALID_MAX",o)}},rules:{decimal:function(e){var t=e.val();return!t||t.match(p)},min:function(e){var t=this.options.min;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!((i=Number(i))<t)},max:function(e){var t=this.options.max;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!(t<(i=Number(i)))},minField:function(e){var t=e.val(),i="numerictextbox"==e.attr("data-role"),a=e.hasClass("k-formatted-value"),n=".value .k-input";(i||a)&&(n=".value .k-input[data-role='numerictextbox']");var o=e.closest(".hmi-binding-property-inner-wrapper").find(".hmi-binding-property-category[data-key='minMax']").find("ul.category-items").find("li.property[data-key='minValue']").find(n);if(o.prop("disabled"))return!0;var r=o.val();return null==r||(null==t||-1!=t.indexOf(" ")||!((t=Number(t))<r))},maxField:function(e){var t=e.val(),i="numerictextbox"==e.attr("data-role"),a=e.hasClass("k-formatted-value"),n=".value .k-input";(i||a)&&(n=".value .k-input[data-role='numerictextbox']");var o=e.closest(".hmi-binding-property-inner-wrapper").find(".hmi-binding-property-category[data-key='minMax']").find("ul.category-items").find("li.property[data-key='maxValue']").find(n);if(o.prop("disabled"))return!0;var r=o.val();return null==r||(null==t||-1!=t.indexOf(" ")||!(r<(t=Number(t))))}}},hmiMinMax:{messages:{required:"COMMON_REQUIRED_INFORMATION",decimal:"COMMON_INVALID_VALUE",min:function(e){var t=w(e).options.min;return f.I18N.prop("COMMON_INVALID_MIN",t)},max:function(e){var t=w(e).options.max;return f.I18N.prop("COMMON_INVALID_MAX",t)},minField:function(e){var t=f.I18N,i="numerictextbox"==e.attr("data-role"),a=e.hasClass("k-formatted-value"),n=".value .k-input";(i||a)&&(n=".value .k-input[data-role='numerictextbox']");var o=e.closest("li.property").closest("ul.category-items").find("li.property[data-key='minValue']").find(n).val();return t.prop("COMMON_INVALID_MIN",o)},maxField:function(e){var t=f.I18N,i="numerictextbox"==e.attr("data-role"),a=e.hasClass("k-formatted-value"),n=".value .k-input";(i||a)&&(n=".value .k-input[data-role='numerictextbox']");var o=e.closest("li.property").closest("ul.category-items").find("li.property[data-key='maxValue']").find(n).val();return t.prop("COMMON_INVALID_MAX",o)},sameMinMax:"HMI_EQUAL_MIN_MAX_MSG"},rules:{decimal:function(e){var t=e.val();return!t||t.match(p)},min:function(e){var t=this.options.min;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!((i=Number(i))<t)},max:function(e){var t=this.options.max;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!(t<(i=Number(i)))},minField:function(e){var t=e.val(),i="numerictextbox"==e.attr("data-role"),a=e.hasClass("k-formatted-value"),n=e.closest("li.property"),o=n.closest("ul.category-items");if(!("minValue"==n.data("key"))){var r=".value .k-input";(i||a)&&(r=".value .k-input[data-role='numerictextbox']");var s=o.find("li.property[data-key='minValue']").find(r).val();if(null==s)return!0;if(null==t||-1!=t.indexOf(" "))return!0;if((t=Number(t))<s)return!1}return!0},maxField:function(e){var t=e.val(),i="numerictextbox"==e.attr("data-role"),a=e.hasClass("k-formatted-value"),n=e.closest("li.property"),o=n.closest("ul.category-items");if("minValue"==n.data("key")){var r=".value .k-input";(i||a)&&(r=".value .k-input[data-role='numerictextbox']");var s=o.find("li.property[data-key='maxValue']").find(r).val();if(null==s)return!0;if(null==t||-1!=t.indexOf(" "))return!0;if(s<(t=Number(t)))return!1}return!0},sameMinMax:function(e){var t=e.val(),i="numerictextbox"==e.attr("data-role"),a=e.hasClass("k-formatted-value"),n=e.closest("li.property"),o=n.closest("ul.category-items"),r=".value .k-input";return(i||a)&&(r=".value .k-input[data-role='numerictextbox']"),t!=("minValue"==n.data("key")?o.find("li.property[data-key='maxValue']"):o.find("li.property[data-key='minValue']")).find(r).val()}}},hmiTotalMinMax:{messages:{required:"COMMON_REQUIRED_INFORMATION",decimal:"COMMON_INVALID_VALUE",min:function(e){var t=w(e).options.min;return f.I18N.prop("COMMON_INVALID_MIN",t)},max:function(e){var t=w(e).options.max;return f.I18N.prop("COMMON_INVALID_MAX",t)},rowMin:function(e){var t=e.closest(".hmi-library-palette-dialog").find(".k-input.min.total").val();return f.I18N.prop("HMI_LIBRARY_MULTI_MIN",t)},rowMax:function(e){var t=e.closest(".hmi-library-palette-dialog").find(".k-input.max.total").val();return f.I18N.prop("HMI_LIBRARY_MULTI_MAX",t)}},rules:{decimal:function(e){var t=e.val();return!t||t.match(p)},min:function(e){var t=this.options.min;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!((i=Number(i))<t)},max:function(e){var t=this.options.max;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!(t<(i=Number(i)))},rowMin:function(e){if(e.hasClass("max")){var t=e.closest(".hmi-library-palette-dialog").find(".k-input.min.total").val();if(null==t)return!0;var i=e.val();if(null==i||-1!=i.indexOf(" "))return!0;if((i=Number(i))<t)return!1}return!0},rowMax:function(e){if(e.hasClass("min")){var t=e.closest(".hmi-library-palette-dialog").find(".k-input.max.total").val();if(null==t)return!0;var i=e.val();if(null==i||-1!=i.indexOf(" "))return!0;if(t<(i=Number(i)))return!1}return!0}}},hmiImageListMinMax:{messages:{required:"COMMON_REQUIRED_INFORMATION",numeric:"COMMON_INVALID_VALUE",min:function(e){var t=e.closest(".hmi-library-palette-dialog").find(".k-input.min.total").val();return f.I18N.prop("HMI_LIBRARY_MULTI_MIN",t)},max:function(e){var t=e.closest(".hmi-library-palette-dialog").find(".k-input.max.total").val();return f.I18N.prop("HMI_LIBRARY_MULTI_MAX",t)},rowMin:function(e){var t=e.closest("td").find(".k-input.min").val();return f.I18N.prop("HMI_LIBRARY_MULTI_MIN",t)},rowMax:function(e){var t=e.closest("td").find(".k-input.max").val();return f.I18N.prop("HMI_LIBRARY_MULTI_MAX",t)},range:"HMI_LIBRARY_MULTI_OVERLAP"},rules:{decimal:function(e){var t=e.val();return!t||t.match(p)},min:function(e){var t=e.closest(".hmi-library-palette-dialog").find(".k-input.min.total").val();if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!((i=Number(i))<t)},max:function(e){var t=e.closest(".hmi-library-palette-dialog").find(".k-input.max.total").val();if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!(t<(i=Number(i)))},rowMin:function(e){var t;if(e.hasClass("max")){if(null==(t=e.val())||-1!=t.indexOf(" "))return!0;if((t=Number(t))<e.closest("td").find(".k-input.min").val())return!1}return!0},rowMax:function(e){var t;if(e.hasClass("min")){if(null==(t=e.val())||-1!=t.indexOf(" "))return!0;if(t=Number(t),e.closest("td").find(".k-input.max").val()<t)return!1}return!0},range:function(e){var s=e.val();if(null==s||-1!=s.indexOf(" "))return!0;s=Number(s);var l=e.data("id"),t=e.closest(".image-list").find("tbody > tr"),d=!0;return t.each(function(e,t){var i=v(t),a=i.find(".list-range-validator.min .k-input");if(a.data("id")==l)return!0;var n=i.find(".list-range-validator.max .k-input"),o=a.val(),r=n.val();return o<=s&&s<=r?d=!1:void 0}),d}}},hmiOptionValues:{messages:{required:"COMMON_REQUIRED_INFORMATION",decimal:"COMMON_INVALID_VALUE",min:function(e){var t=w(e).options.min;return f.I18N.prop("COMMON_INVALID_MIN",t)},max:function(e){var t=w(e).options.max;return f.I18N.prop("COMMON_INVALID_MAX",t)},sameValue:"HMI_OPTION_VALUES_DUPLICATE"},rules:{decimal:function(e){var t=e.val();return!t||t.match(p)},min:function(e){var t=this.options.min;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!((i=Number(i))<t)},max:function(e){var t=this.options.max;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!(t<(i=Number(i)))},sameValue:function(e){var t="numerictextbox"==e.attr("data-role"),i=e.hasClass("k-formatted-value"),a=e.val();if(null==a||-1!=a.indexOf(" "))return!0;a=Number(a);var n=e.closest(".hmi-binding-option-values"),o=e.closest(".hmi-binding-option-value-item").get(0),r=".value .k-input";(t||i)&&(r=".value .k-input[data-role='numerictextbox']");var s=n.find(".hmi-binding-option-value-item"),l=!1;return s.each(function(e,t){if(o===t)return!0;var i=v(t).find(".hmi-binding-option-value-item-value "+r).val();return a==i?!(l=!0):void 0}),!l}}},decimal:{messages:{required:"COMMON_REQUIRED_INFORMATION",decimal:"COMMON_INVALID_VALUE",min:function(e){var t=w(e).options.min;return f.I18N.prop("COMMON_INVALID_MIN",t)},max:function(e){var t=w(e).options.max;return f.I18N.prop("COMMON_INVALID_MAX",t)}},rules:{decimal:function(e){var t=e.val();return!t||t.match(p)},min:function(e){var t=this.options.min;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!((i=Number(i))<t)},max:function(e){var t=this.options.max;if(null==t)return!0;var i=e.val();return null==i||-1!=i.indexOf(" ")||!(t<(i=Number(i)))}}},licenseFileName:{messages:{invalidName:"LICENSE_MESSAGE_SELECTED_FILE_NAME_INVALID"},rules:{invalidName:function(e){var t=e.val();return!t||t.match(h)}}},uuid:{messages:{invalidName:"COMMON_INVALID_UUID",notMatched:"COMMON_NOT_HEX_UUID",notLength36:"COMMON_NOT_LENGTH_36"},rules:{invalidName:function(e){var t=e.val();return!t||t.match(g)},notMatched:function(e){var t=e.val();return!t||t.match(m)},notLength36:function(e){var t=e.val();return!t||36==t.length}}},uuid_min:{messages:{notMatched:"COMMON_NOT_HEX_UUID",notLength36:"COMMON_NOT_LENGTH_36"},rules:{notMatched:function(e){var t=e.val();return!t||t.match(m)},notLength36:function(e){var t=e.val();return!t||36==t.length}}}}},init:function(e,t){var i,a,n,o=this,r=v(e);(t=t||{}).minLength||(t.minLength=r.data("min-length")),t.maxLength||(t.maxLength=r.data("max-length")),o._setDefaultMinMaxLength(t);var s=f.I18N;if(t.messages||(t.messages={}),t.rules||(t.rules={}),t.minLength&&(t.messages.minLength=o.options.builtInMessages.minLength.bind(this)),t.maxLength&&(t.messages.maxLength=o.options.builtInMessages.maxLength.bind(this)),t.rules.minLength||(t.rules.minLength=o.options.builtInRules.minLength),t.rules.maxLength||(t.rules.maxLength=o.options.builtInRules.maxLength),i=o.options.builtInOptions,"passwordRetype"==(a=t.type)&&(t.passwordRetypeFor&&(t.passwordRetypeFor=v(t.passwordRetypeFor)),n="#"+r.data("retype-for"),t.passwordRetypeFor||(t.passwordRetypeFor=v(n)),t.passwordRetypeFor&&0!=t.passwordRetypeFor.length||console.error("there is no target password field for this password retype field.")),"password"==a){var l=r.data("oldPassword");l&&(n="#"+l,t.oldPassword=v(n))}if(o._attachEvt(r,a),a&&i[a]){var d,c,u,p=i[a].messages,h=i[a].rules;for(d in p)if((c=p[d])&&!t.messages[d]&&("string"==typeof c?t.messages[d]=s.prop(c):v.isFunction(c)&&(t.messages[d]=c.bind(this))),h){if(u=h[d],"pwMixedCharacter"==d&&0==t.mixedPasswordCheck)continue;u&&!t.rules[d]&&(t.rules[d]=u)}}t.required&&(t.messages.required||(t.messages.required=s.prop("COMMON_REQUIRED_INFORMATION")),r.prop("required",!0)),t=v.extend({},o.options,t),y.fn.init.call(this,e,t),r.addClass("common-validator")},_attachEvt:function(e,t){"id"==t||"password"==t||"email"==t||"passwordRetype"==t?e.on("keydown",this._blockSpaceEvt):"name"!=t&&"description"!=t&&"mobilePhoneNumber"!=t||e.on("change",this._trimOnChange),this.options.isKeyUpValidation&&e.on("keyup",this._keyupEvt)},_trimOnChange:function(e){var t=v(this).val();v(this).val(v.trim(t))},_keyupEvt:function(e){var t=v(this).data("kendoCommonValidator");t&&t.validate()},_blockSpaceEvtFirstAndLast:function(e){if(32==e.keyCode){if(0==this.selectionEnd&&0==this.selectionStart)return!1;var t=v(this).val();if(t.length==this.selectionEnd&&t.length==this.selectionStart)return!1}},_blockSpaceEvt:function(e){if(32==e.keyCode)return!1},_setDefaultMinMaxLength:function(e){var t;t=this.options.builtInMinMax[e.type],!e.minLength&&t&&(e.minLength=t.min),!e.maxLength&&t&&(e.maxLength=t.max)},validate:function(e,t,i){var a,n,o,r=!1,s=this.value();if(this._errors={},this.element.is(C))r=this.validateInput(this.element,e,t);else{var l=!1;for(n=0,o=(a=this.element.find(this._inputSelector)).length;n<o;n++)this.validateInput(a.eq(n),e,t)||(l=!0);r=!l}return i||this.trigger("validate",{valid:r}),s!==r&&this.trigger("change"),r},validateInput:function(e,t,i){e=v(e),this._isValidated=!0;var a,n,o=this,r=o.options,s=o._errorTemplate,l=o._checkValidity(e,t,i),d=l.valid,c=e.attr("name")||"",u=o._findMessageContainer(c).add(e.next(".k-invalid-msg").filter(function(){var e=v(this);return!e.filter("["+D.attr("for")+"]").length||e.attr(D.attr("for"))===c})).hide(),p=!e.attr("aria-invalid");if(e.removeAttr("aria-invalid"),d)delete o._errors[c];else{a=o._extractMessage(e,l.key),o._errors[c]=a;var h=(n=s({message:a.replace(/&amp/g,"&amp;").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")}),v.parseHTML?v(v.parseHTML(n)):v(n)),f=u.attr("id");if(o._decorateMessageContainer(h,c),f&&h.attr("id",f),u.replaceWith(h).length||(e.hasClass("k-formatted-value")?h.insertAfter(e.siblings("[data-role='numerictextbox']")):h.insertAfter(e)),h.show(),e.attr("aria-invalid",!0),e.is(":focus")&&r.scrollWrapperClass){var g=h.offset(),m=v("."+r.scrollWrapperClass);m.scrollTop()<g.top&&m.scrollTop(g.top)}}return p!==d&&this.trigger("validateInput",{valid:d,input:e}),e.toggleClass("k-invalid",!d),e.toggleClass("k-valid",d),d},_checkValidity:function(e,t,i){var a,n=this.options.rules;if(t){if(i)return{valid:!1,key:t};if(!(a=n[t]))return{valid:!0};if(!a.call(this,e))return{valid:!1,key:t}}else for(a in n)if(!n[a].call(this,e))return{valid:!1,key:a};return{valid:!0}},hideMessages:function(e){var t="."+k,i=this.element;e||(i.is(C)?i.removeClass("k-invalid"):i.find(".k-invalid").removeClass("k-invalid")),i.is(C)?i.next(t).hide():i.find(t).hide()},_extractMessage:function(e,t){var i=this.options.messages[t],a=e.attr("name");return i=D.isFunction(i)?i(e):i,D.format(e.attr(D.attr(t+"-msg"))||e.attr("validationMessage")||i||e.attr("title")||"",a,e.attr(t)||e.attr(D.attr(t)))}});D.ui.plugin(e)}(window,jQuery),function(F,S){var C=F.kendo,e=C.ui.Widget,Q=F.Util,i=F.GlobalSettings,X=F.L,a=X.LineUtil.isFlat||X.LineUtil._flat||X.Polyline._flat,r="http://www.w3.org/2000/svg",o=1100,s=766;function n(e){var t,i=e._map.widget,a=[i.colorPickerControl,i.layerControl,i.legendControl],n=a.length;for(t=0;t<n;t++)e!==a[t]&&void 0!==a[t]&&a[t].setActive(!1)}X.LineUtil.isPointInLine=function(e,t,i){var a=e.x,n=e.y,o=t.x,r=t.y,s=i.x;return(i.y-r)/(s-o)*(a-o)==n-r},X.Control.BaseControl=X.Control.extend({options:{position:"topright",className:"",title:"",visible:!0,enabled:!0,active:!1},initialize:function(e){X.Util.setOptions(this,e)},onAdd:function(e){var t=this;t.wrapper||(t.wrapper=e.widget?e.widget.element:S(e.getContainer()));var i=t.options,a=i.className,n=i.title;return t.element=S("<a class='k-button common-map-view-control "+a+"' role='button'title='"+n+"'><i class='ic'></i></a>"),t.element.on("click",t.click.bind(t)),t._updateControlState(),this.element.get(0)},_updateControlState:function(){var e=this,t=e.options,i=t.visible,a=t.enabled,n=t.active;i?e.element.show():e.element.hide(),a?(e.element.prop("disabled",!1),e.element.removeClass("disabled")):(e.element.prop("disabled",!0),e.element.addClass("disabled")),n?e.element.addClass("active"):e.element.removeClass("active")},click:function(e){return!!this.options.enabled},onRemove:function(){X.Control.prototype.onRemove.call(this)},active:function(e){this.options.active=e,this._updateControlState()},disable:function(){this.options.enabled=!1,this._updateControlState()},enable:function(){this.options.enabled=!0,this._updateControlState()},hide:function(){this.options.visible=!1,this._updateControlState()},show:function(){this.options.visible=!0,this._updateControlState()},setActive:function(e){this.options.active=e,this._updateControlState()}}),X.Control.ExtendZoom=X.Control.Zoom.extend({options:{position:"topright"},initialize:function(e){var t=F.I18N;this.options.zoomInTitle=t.prop("COMMON_ZOOM_IN"),this.options.zoomOutTitle=t.prop("COMMON_ZOOM_OUT"),X.Control.BaseControl.prototype.initialize.call(this,e)},onAdd:function(e){var t,i=S("<div/>").get(0),a=this.options;t="k-button common-map-view-control common-map-view-zoom";var n=S("<i/>").addClass("ic").get(0).outerHTML;return this._zoomInButton=this._createButton(n,a.zoomInTitle,t+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n,a.zoomOutTitle,t+"-out",i,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),i},_updateDisabled:function(){var e=this._map,t="disabled";X.DomUtil.removeClass(this._zoomInButton,t),X.DomUtil.removeClass(this._zoomOutButton,t),!this._disabled&&e._zoom!==e.getMinZoom()||X.DomUtil.addClass(this._zoomOutButton,t),!this._disabled&&e._zoom!==e.getMaxZoom()||X.DomUtil.addClass(this._zoomInButton,t)},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(2.5*this._map.options.zoomDelta)},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(2.5*this._map.options.zoomDelta)}}),X.control.extendZoom=function(e){return new X.Control.ExtendZoom(e)},X.Control.FullScreen=X.Control.BaseControl.extend({options:{className:"common-map-view-full-screen",title:"Full Screen"},initialize:function(e){var t=F.I18N;this.options.title=t.prop("COMMON_FULL_SCREEN"),X.Control.BaseControl.prototype.initialize.call(this,e)},click:function(e){if(X.Control.BaseControl.prototype.click.call(this,e)){var t=this.options,i=t.active;return i?this.wrapper.removeClass("common-full-screen"):this.wrapper.addClass("common-full-screen"),this._map.invalidateSize(),t.active=!i,this._updateControlState(),!1}}}),X.control.fullScreen=function(e){return new X.Control.FullScreen(e)},X.Control.Legend=X.Control.BaseControl.extend({options:{className:"common-map-view-legend",title:"Legend",types:[],legendOnOffTypes:["Light","SmartPlug","ControlPoint"],legendBoxOptions:{visible:!1}},initialize:function(e){var t=F.I18N;this.options.title=t.prop("COMMON_LEGEND"),X.Control.BaseControl.prototype.initialize.call(this,e)},onAdd:function(e){var t=this.options.legendBoxOptions,i=F.I18N;return t.baseLegendTemplate='<li><i class="disc g"></i><span>'+i.prop("FACILITY_DEVICE_STATUS_NORMAL")+'</span></li><li><i class="disc r"></i><span>'+i.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</span></li><li><i class="disc y"></i><span>'+i.prop("FACILITY_DEVICE_STATUS_WARNING")+"</span></li>",t.legendTemplate='<li><i class="disc g"></i><span>'+i.prop("FACILITY_DEVICE_STATUS_NORMAL_ON")+'</span></li><li><i class="disc m"></i><span>'+i.prop("FACILITY_DEVICE_STATUS_NORMAL_OFF")+'</span></li><li><i class="disc r"></i><span>'+i.prop("FACILITY_DEVICE_STATUS_CRITICAL")+'</span></li><li><i class="disc y"></i><span>'+i.prop("FACILITY_DEVICE_STATUS_WARNING")+"</span></li>",t.legendBeaconTemplate='<li><i class="disc gr"></i><span>'+i.prop("FACILITY_DEVICE_BEACON_TYPE_FIXED")+'</span></li><li><i class="disc measured gr"></i><span>'+i.prop("FACILITY_DEVICE_BEACON_TYPE_MOVABLE")+"</span></li>",t.legendIndoorTemplate='<li><i class="ic ic-peak"></i><span>'+i.prop("FACILITY_INDOOR_STATUS_PEAK")+'</span></li><li><i class="ic ic-deforest"><span></i>'+i.prop("FACILITY_INDOOR_STATUS_DEFROST")+'</span></li><li><i class="ic ic-filter"><span></i>'+i.prop("FACILITY_INDOOR_STATUS_FILTER_WARNING")+'</span></li><li><i class="ic ic-rc-disable"></i><span>'+i.prop("FACILITY_INDOOR_STATUS_RC_OFF")+'</span></li><li><i class="ic ic-rock"></i><span>'+i.prop("FACILITY_INDOOR_STATUS_OPERATION_LIMIT")+'</span></li><li><i class="ic ic-thurmo"></i><span>'+i.prop("FACILITY_INDOOR_TEMPERATURE_LIMIT")+'</span></li><li><i class="ic ic-schedule"></i><span>'+i.prop("FACILITY_DEVICE_SAC_INDOOR_SCHEDULE")+'</span></li><li><i class="ic ic-spi"></i><span>'+i.prop("FACILITY_INDOOR_CONTROL_SPI")+'</span></li><li><i class="ic ic-antifreeze"></i><span>'+i.prop("FACILITY_INDOOR_STATUS_FREEZE_PROTECTION")+"</span></li>",this.legendElement=S("<div class='common-map-view-legend-box leaflet-control'/>"),this._updateLegendBoxState(),X.Control.BaseControl.prototype.onAdd.call(this,e)},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),i=this.getPosition(),a=e._controlCorners[i],n=this.legendElement.get(0);return X.DomUtil.addClass(t,"leaflet-control"),-1!==i.indexOf("bottom")?(a.insertBefore(t,a.firstChild),a.insertBefore(n,a.firstChild)):(a.appendChild(t),a.appendChild(n)),this},_updateLegendBoxState:function(){var e,t,i=this.options,a=i.legendBoxOptions,n=i.types,o=i.legendOnOffTypes,r=n.length,s="",l="",d="";for(t=0;t<r;t++)(e=n[t])&&(-1===o.indexOf(e)||s?-1!==e.indexOf("AirConditioner")?(s=s||a.legendTemplate,l=a.legendIndoorTemplate):-1!==e.indexOf("Beacon")&&(d=a.legendBeaconTemplate):s=a.legendTemplate);var c="<ul>"+(s=s||a.baseLegendTemplate)+d+l+"</ul>";this.legendElement.html(c),a.visible?this.legendElement.show():this.legendElement.hide()},click:function(e){if(X.Control.BaseControl.prototype.click.call(this,e)){var t=this.options.active;return this.setActive(!t),!1}},setActive:function(e){var t=this,i=t.options.legendBoxOptions;if(e){n(t);var a=t.element.position();i.visible=!0,t.legendElement.css({top:a.top})}else i.visible=!1;X.Control.BaseControl.prototype.setActive.call(this,e),t._updateLegendBoxState()}}),X.control.legend=function(e){return new X.Control.Legend(e)},X.Control.DefaultZoom=X.Control.BaseControl.extend({options:{title:"Default Zoom",className:"common-map-view-default-zoom"},initialize:function(e){var t=F.I18N;this.options.title=t.prop("COMMON_DEFAULT_VIEW"),X.Control.BaseControl.prototype.initialize.call(this,e)},click:function(e){if(X.Control.BaseControl.prototype.click.call(this,e))return this._map.widget.moveCenterView(),!1}}),X.control.defaultZoom=function(e){return new X.Control.DefaultZoom(e)},X.Control.ColorPicker=X.Control.BaseControl.extend({options:{title:"Color Picker",className:"common-map-view-color-picker",enabled:!1,visible:!1,activeClass:".common-map-view"},initialize:function(e){var t=F.I18N;this.options.title=t.prop("COMMON_COLOR_PICKER"),X.Control.BaseControl.prototype.initialize.call(this,e)},onAdd:function(e){var t=this;return this.colorPicker=S("<div class='common-map-view-color-picker-element'/>").kendoCommonColorPicker({activeSelector:this.options.activeClass}).data("kendoCommonColorPicker"),this.colorPicker.wrapper.addClass("leaflet-control"),this.colorPicker.bind("change",this.changeColorEvt.bind(this)),this.colorPicker.bind("close",function(){t.setActive(!1)}),X.Control.BaseControl.prototype.onAdd.call(this,e)},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),i=this.getPosition(),a=e._controlCorners[i],n=this.colorPicker.wrapper.get(0);return X.DomUtil.addClass(t,"leaflet-control"),-1!==i.indexOf("bottom")?(a.insertBefore(t,a.firstChild),a.insertBefore(n,a.firstChild)):(a.appendChild(t),a.appendChild(n)),this},click:function(e){if(X.Control.BaseControl.prototype.click.call(this,e)){var t=this.options.active;return this.setActive(!t),!1}},setActive:function(e){var t=this;if(e){n(t);var i=t.element.position();t.colorPicker.position({top:i.top}),t.colorPicker.open()}else t.colorPicker.isOpened()&&t.colorPicker.close();X.Control.BaseControl.prototype.setActive.call(this,e)},changeColorEvt:function(e){var t=this._map.widget,i=e.value,a=t._editableZonePolygon;if(a){var n={color:i,fillColor:i},o=a.zone;if(t._addChangedData(t._changedZones,o,"backgroundColor"),o.backgroundColor=i,a.setStyle(n),a.zoneNameMarker){var r=S(a.zoneNameMarker._icon);r=r.find(".common-map-view-zone-name-text");var s=t._getZoneNameTextColor(i);r.css({"background-color":i,color:s})}a.editor.setMarkersColor(i)}}}),X.control.colorPicker=function(e){return new X.Control.ColorPicker(e)},X.Control.Layer=X.Control.BaseControl.extend({options:{title:"Layers",className:"common-map-view-layer",showZoneNameCheckbox:!0,showDeviceInfoCheckbox:!0,showDeviceNameCheckbox:!0,showRegisteredGateway:!1,layerBoxOptions:{visible:!1}},initialize:function(e){var t=F.I18N;this.options.title=t.prop("COMMON_LAYERS"),X.Control.BaseControl.prototype.initialize.call(this,e)},onAdd:function(e){var t=this,i=this.options,a=i.showRegisteredGateway,n=i.showDeviceInfoCheckbox,o=i.showDeviceNameCheckbox,r=i.showZoneNameCheckbox,s=i.layerBoxOptions;t._uid=C.guid();var l=F.localStorage;s.checkedRegisteredGateway=l.getItem("checkedRegsiteredGateway"),s.checkedRegisteredGateway="true"==s.checkedRegisteredGateway,s.clickRegisteredGateway=t._clickRegisteredGatewayChkboxEvt.bind(t),s.checkedDeviceInfo=l.getItem("checkedDeviceInfo"),s.checkedDeviceInfo="false"!=s.checkedDeviceInfo,s.clickDeviceInfo=t._clickDeviceInfoChkboxEvt.bind(t),s.checkedDeviceName=l.getItem("checkedDeviceName"),s.checkedDeviceName="false"!=s.checkedDeviceName,s.clickDeviceName=t._clickDeviceNameChkboxEvt.bind(t),s.checkedZoneName=l.getItem("checkedZoneName"),s.checkedZoneName="false"!=s.checkedZoneName,s.clickZoneName=t._clickZoneNameChkboxEvt.bind(t),t.layerElement=S("<div class='common-map-view-layer-box leaflet-control'></div>");var d,c,u,p,h=S("<ul/>"),f=F.I18N;return a&&(p=f.prop("FACILITY_REGISTERD_GATEWAY"),d="common-map-view-registered-gateway-"+t._uid,c=S("<input/>").attr({type:"checkbox",id:d}).addClass("k-checkbox"),u=S("<label/>").attr({for:d}).addClass("common-map-view-registered-gateway-label k-checkbox-label").text(p),S("<li/>").append(c).append(u).appendTo(h),t.registeredGatewayCheckbox=c,t.registeredGatewayCheckbox.on("click",s.clickRegisteredGateway)),n&&(p=f.prop("COMMON_DISPLAY_DEVICE_INFORMATION"),t._uid=C.guid(),d="common-map-view-device-info-"+t._uid,c=S("<input/>").attr({type:"checkbox",id:d}).addClass("k-checkbox"),u=S("<label/>").attr({for:d}).addClass("common-map-view-device-info-label k-checkbox-label").text(p),S("<li/>").append(c).append(u).appendTo(h),t.deviceInfoCheckbox=c,t.deviceInfoCheckbox.on("click",s.clickDeviceInfo)),o&&(p=f.prop("COMMON_DISPLAY_DEVICE_NAME"),t._uid=C.guid(),d="common-map-view-device-name-"+t._uid,c=S("<input/>").attr({type:"checkbox",id:d}).addClass("k-checkbox"),u=S("<label/>").attr({for:d}).addClass("common-map-view-device-info-label k-checkbox-label").text(p),S("<li/>").append(c).append(u).appendTo(h),t.deviceNameCheckbox=c,t.deviceNameCheckbox.on("click",s.clickDeviceName)),r&&(p=f.prop("COMMON_DISPLAY_ZONE_NAME"),t._uid=C.guid(),d="common-map-view-zone-name-"+t._uid,c=S("<input/>").attr({type:"checkbox",id:d}).addClass("k-checkbox"),u=S("<label/>").attr({for:d}).addClass("common-map-view-device-info-label k-checkbox-label").text(p),S("<li/>").append(c).append(u).appendTo(h),t.zoneNameCheckbox=c,t.zoneNameCheckbox.on("click",s.clickZoneName)),t.layerElement.append(h),t._updateLayerBoxState(),X.Control.BaseControl.prototype.onAdd.call(t,e)},_updateLayerBoxState:function(){var e=this,t=e.options.layerBoxOptions,i=t.visible,a=t.checkedRegisteredGateway,n=t.checkedDeviceInfo,o=t.checkedDeviceName,r=t.checkedZoneName;i?e.layerElement.show():e.layerElement.hide(),e.registeredGatewayCheckbox&&e.registeredGatewayCheckbox.prop("checked",a),e.deviceInfoCheckbox&&e.deviceInfoCheckbox.prop("checked",n),e.deviceNameCheckbox&&e.deviceNameCheckbox.prop("checked",o),e.zoneNameCheckbox&&e.zoneNameCheckbox.prop("checked",r)},onRemove:function(){C.unbind(this.layerElement),this.layerElement.remove(),this.layerElement=null,X.Control.BaseControl.prototype.onRemove.call(this)},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),i=this.getPosition(),a=e._controlCorners[i],n=this.layerElement.get(0);return X.DomUtil.addClass(t,"leaflet-control"),-1!==i.indexOf("bottom")?(a.insertBefore(t,a.firstChild),a.insertBefore(n,a.firstChild)):(a.appendChild(t),a.appendChild(n)),this},click:function(e){var t=this.options.active;return this.setActive(!t),!1},setActive:function(e){var t=this,i=t.options.layerBoxOptions;if(e){n(t);var a=t.element.position();t.layerElement.css({top:a.top}),i.visible=!0}else i.visible=!1;X.Control.BaseControl.prototype.setActive.call(this,e),t._updateLayerBoxState()},_clickDeviceInfoChkboxEvt:function(e){var t=this._map.widget.element,i=this.options.layerBoxOptions,a=this.deviceInfoCheckbox,n=".device-info-text .text";i.checkedDeviceInfo=a.prop("checked"),F.localStorage.setItem("checkedDeviceInfo",i.checkedDeviceInfo),i.checkedDeviceInfo?t.find(n).show():t.find(n).hide()},_clickDeviceNameChkboxEvt:function(e){var t=this._map.widget.element,i=this.options.layerBoxOptions,a=this.deviceNameCheckbox,n=".device-info-text .name";i.checkedDeviceName=a.prop("checked"),F.localStorage.setItem("checkedDeviceName",i.checkedDeviceName),i.checkedDeviceName?t.find(n).show():t.find(n).hide()},_clickZoneNameChkboxEvt:function(e){var t=this._map.widget.element,i=this.zoneNameCheckbox,a=".common-map-view-zone-name",n=this.options.layerBoxOptions;n.checkedZoneName=i.prop("checked"),F.localStorage.setItem("checkedZoneName",n.checkedZoneName),n.checkedZoneName?t.find(a).show():t.find(a).hide()},_clickRegisteredGatewayChkboxEvt:function(e){var t=this._map.widget,i=this.registeredGatewayCheckbox,a=this.options.layerBoxOptions;a.checkedRegisteredGateway=i.prop("checked"),F.localStorage.setItem("checkedRegisteredGateway",a.checkedRegisteredGateway),a.checkedRegisteredGateway?t._showRegisteredGateway():t._removeRegisteredGateway()}}),X.control.layer=function(e){return new X.Control.Layer(e)},X.RestrictDraggable=X.Draggable.extend({_onMove:function(e){if(!e._simulated&&this._enabled)if(e.touches&&1<e.touches.length)this._moved=!0;else{var t=e.touches&&1===e.touches.length?e.touches[0]:e,i=t.clientX,a=t.clientY,n=this.options.restrict;"vertical"==n?a=this._startPoint.y:"horizontal"==n&&(i=this._startPoint.x);var o=new X.Point(i,a).subtract(this._startPoint);(o.x||o.y)&&(Math.abs(o.x)+Math.abs(o.y)<this.options.clickTolerance||(X.DomEvent.preventDefault(e),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=X.DomUtil.getPosition(this._element).subtract(o),X.DomUtil.addClass(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,F.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),X.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(o),this._moving=!0,X.Util.cancelAnimFrame(this._animRequest),this._lastEvent=e,this._animRequest=X.Util.requestAnimFrame(this._updatePosition,this,!0)))}}}),X.Handler.RestrictMarkerDrag=X.Handler.extend({options:{restrict:null},initialize:function(e,t){X.Util.setOptions(this,t),this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new X.RestrictDraggable(e,e,!0,this.options)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),X.DomUtil.addClass(e,"leaflet-marker-draggable leaflet-marker-resizable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&X.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,i=t._map,a=this._marker.options.autoPanSpeed,n=this._marker.options.autoPanPadding,o=X.DomUtil.getPosition(t._icon),r=i.getPixelBounds(),s=i.getPixelOrigin(),l=X.bounds(r.min._subtract(s).add(n),r.max._subtract(s).subtract(n));if(!l.contains(o)){var d=X.point((Math.max(l.max.x,o.x)-l.max.x)/(r.max.x-l.max.x)-(Math.min(l.min.x,o.x)-l.min.x)/(r.min.x-l.min.x),(Math.max(l.max.y,o.y)-l.max.y)/(r.max.y-l.max.y)-(Math.min(l.min.y,o.y)-l.min.y)/(r.min.y-l.min.y)).multiplyBy(a);i.panBy(d,{animate:!1}),this._draggable._newPos._add(d),this._draggable._startPos._add(d),X.DomUtil.setPosition(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=X.DomUtil.requestAnimFrame(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(X.Util.cancelAnimFrame(this._panRequest),this._panRequest=X.Util.requestAnimFrame(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,i=t._shadow,a=X.DomUtil.getPosition(t._icon),n=t._map.layerPointToLatLng(a);i&&X.DomUtil.setPosition(i,a),t._latlng=n,e.latlng=n,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){X.Util.cancelAnimFrame(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),X.Editable.VertexIcon=X.DivIcon.extend({options:{iconSize:new X.Point(8,8)},createIcon:function(e){var t=X.DivIcon.prototype.createIcon.call(this,e),i=this.options.color;return i&&(t.style.backgroundColor=i),this._div=t},setColor:function(e){e&&(this._div.style.backgroundColor=e)}}),X.Editable.ResizeIcon=X.DivIcon.extend({options:{iconSize:new X.Point(10,10)},createIcon:function(e){var t=X.DivIcon.prototype.createIcon.call(this,e),i=this.options.color;return i&&(t.style.backgroundColor=i),this._div=t},setColor:function(e){e&&(this._div.style.backgroundColor=e)}}),X.Editable.VertexMarkerClass=X.Editable.VertexMarker.extend({initialize:function(e,t,i,a){this.latlng=e,this.latlngs=t,this.editor=i,X.Marker.prototype.initialize.call(this,e,a),a.isAddingMarker&&(this.options.className+=" add-vertex-icon"),this.options.icon=this.editor.tools.createResizeIcon({className:this.options.className,color:this.options.color}),(this.latlng.__vertex=this).editor.editLayer.addLayer(this),this.setZIndexOffset(i.tools._lastZIndex+1),this._point=this._map.latLngToLayerPoint(e),this._scaleOrigin=null,this._scale=X.point(1,1),this._initialDist=0,this._initialDistX=0,this._initialDistY=0,this._matrix=new X.Matrix(1,0,0,1,0,0),this._projectedMatrix=new X.Matrix(1,0,0,1,0,0)},onAdd:function(e){if(X.Marker.prototype.onAdd.call(this,e),this.options.isAddingMarker)return X.Marker.prototype.onAdd.call(this,e),void X.DomEvent.on(this._icon,"mousedown touchstart",this.onMouseDown,this);this.on("drag",this.onDrag),this.on("dragstart",this.onDragStart),this.on("dragend",this.onDragEnd),this.on("mouseup",this.onMouseup),this.on("click",this.onClick),this.on("contextmenu",this.onContextMenu),this.on("mousedown touchstart",this.onMouseDown),this.addMiddleMarkers()},onRemove:function(e){if(this.options.isAddingMarker)return X.DomEvent.off(this._icon,"mousedown touchstart",this.onMouseDown,this),void X.Marker.prototype.onRemove.call(this,e);this.middleMarker&&this.middleMarker.delete(),delete this.latlng.__vertex,this.off("drag",this.onDrag),this.off("dragstart",this.onDragStart),this.off("dragend",this.onDragEnd),this.off("mouseup",this.onMouseup),this.off("click",this.onClick),this.off("contextmenu",this.onContextMenu),this.off("mousedown touchstart",this.onMouseDown),X.Marker.prototype.onRemove.call(this,e)},onDrag:function(e){(e.vertex=this).editor.onVertexMarkerDrag(e);var t=X.DomUtil.getPosition(this._icon),i=this._map.layerPointToLatLng(t);this.latlng.update(i),this._latlng=this.latlng,this.editor.refresh(),this.middleMarker&&this.middleMarker.updateLatLng();var a=this.getNext();a&&a.middleMarker&&a.middleMarker.updateLatLng()},onDragStart:function(e){(e.vertex=this).editor._addingMarker&&this.editor._addingMarker.hide(),this.editor.onVertexMarkerDragStart(e)},onDragEnd:function(e){(e.vertex=this).editor.onVertexMarkerDragEnd(e)},onClick:function(e){(e.vertex=this).editor.onVertexMarkerClick(e)},onMouseup:function(e){X.DomEvent.stop(e),(e.vertex=this).editor.map.fire("mouseup",e)},onContextMenu:function(e){(e.vertex=this).editor.onVertexMarkerContextMenu(e)},onMouseDown:function(e){if(e.vertex=this,e.vertex.options.isAddingMarker){var t=X.DomUtil.getPosition(this._icon);if(e={originalEvent:e,latlng:this.editor.map.layerPointToLatLng(t)},0===this.options.opacity)return;if(X.Editable.makeCancellable(e),this.editor.onVertexMarkerMouseDown(e),e._cancelled)return;this.latlngs.splice(this.addingMarkerIndex(),0,e.latlng),this.editor.refresh();var i=this.editor.addVertexMarker(e.latlng,this.latlngs);this.editor.onNewVertex(i),X.Draggable._dragging=!1,i.dragging._draggable._onDown(e.originalEvent),this.addingMarkerDelete(),this.editor.addVertexMarker(this.latlngs[0],this.latlngs,!0),e.target=this.editor.feature,this.editor.map.widget._dragEndZoneEvt(e)}},addingMarkerDelete:function(){this.editor.editLayer.removeLayer(this)},addingMarkerIndex:function(){return this.latlngs.indexOf(this.right.latlng)},show:function(){this._icon&&(this._icon.style.display="block"),this.setOpacity(1)},hide:function(){this._icon&&(this._icon.style.display="none"),this.setOpacity(0)}}),X.Editable.ResizeMarkerClass=X.Editable.VertexMarkerClass.extend({options:{draggable:!0,className:"leaflet-div-icon leaflet-vertex-icon leaflet-vertex-resize-icon",restrict:"vertical"},_initInteraction:function(){if(this.options.interactive&&(X.DomUtil.addClass(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),X.Handler.RestrictMarkerDrag)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new X.Handler.RestrictMarkerDrag(this,{restrict:this.options.restrict}),e&&this.dragging.enable()}},_applyTransform:function(e){this.editor.feature._transform(e._matrix)},_cachePoints:function(){for(var e,t=this.editor._resizeMarkers,i=0,a=t.length;i<a;i++)(e=t[i])._initialPoint=e._point.clone()},onDragStart:function(e){e.vertex=this;var t=e.target;this.editor._activeMarker=this.editor._resizeMarkers[t.options.index],this.editor._originMarker=this.editor._resizeMarkers[(t.options.index+2)%4];var i=this.editor._activeMarker,a=this.editor._originMarker;this._scaleOrigin=a.getLatLng(),this._initialMatrix=this._matrix.clone(),this._cachePoints(),this._initialDist=a._point.distanceTo(i._point),this._initialDistX=a._point.x-i._point.x,this._initialDistY=a._point.y-i._point.y,this.editor.hideEditMarkers(),this.editor.onVertexMarkerDragStart(e)},onDrag:function(e){(e.vertex=this).editor.onResizeMarkerDrag(e);var t=X.DomUtil.getPosition(this._icon);this._point=t;var i,a,n=this.editor._originMarker._point;i=0==this._initialDistX?1:(n.x-t.x)/this._initialDistX,a=0==this._initialDistY?1:(n.y-t.y)/this._initialDistY,this._scale=new X.Point(i,a),this._matrix=this._initialMatrix.clone().scale(this._scale,n),this._update()},onDragEnd:function(e){(e.vertex=this)._apply(),this.editor.refreshVertexMarkers(),this.editor.showEditMarkers(),this.editor.onVertexMarkerDragEnd(e),this.editor._activeMarker=null,this.editor._originMarker=null},_update:function(){for(var e,t,i,a=this._matrix,n=this.editor._resizeMarkers,o=this.editor._activeMarker,r=this.editor._originMarker,s=o.options.index,l=r.options.index,d=0,c=n.length;d<c;d++)(t=(e=n[d]).options.index)!=s&&t!=l&&(e._point=a.transform(e._initialPoint),i=this._map.layerPointToLatLng(e._point),e.latlng.update(i),e._latlng=i,e.update());a=a.clone().flip(),this._applyTransform(a)},_apply:function(){var e=this._map;this._transformGeometries();for(var t,i,a=this.editor._resizeMarkers,n=0,o=a.length;n<o;n++)i=a[n],t=e.layerPointToLatLng(i._point),i.latlng.update(t),i._latlng=t,delete i._initialPoint;this._matrix=X.matrix(1,0,0,1,0,0),this._scale=X.point(1,1),this._angle=0},_transformGeometries:function(){this.editor.feature._transform(null),this._transformPoints(this.editor.feature)},_transformPoint:function(e,t,i,a){return i.unproject(t.transform(i.project(e,a)),a)},_transformPoints:function(e,t,i,a,n){var o,r,s=e._map,l=s.getMaxZoom()||this.options.maxZoom,d=this._projectedMatrix=this._getProjectedMatrix(t,i,a,n);if(e._point)e._latlng=this._transformPoint(e._latlng,d,s,l);else if(e._rings||e._parts){var c=e._rings,u=e._latlngs;for(e._bounds=new X.LatLngBounds,X.Util.isArray(u[0])||(u=[u]),o=0,r=c.length;o<r;o++)for(var p=0,h=c[o].length;p<h;p++)u[o][p].update(this._transformPoint(u[o][p],d,s,l)),e._bounds.extend(u[o][p])}e._reset()},_getProjectedMatrix:function(e,t,i,a){var n,o=this._map,r=o.getMaxZoom()||this.options.maxZoom,s=X.matrix(1,0,0,1,0,0);return e=e||this._angle||0,1===(t=t||this._scale||X.point(1,1)).x&&1===t.y||(a=a||this._scaleOrigin,n=o.project(a,r),s=s._add(X.matrix(1,0,0,1,n.x,n.y))._add(X.matrix(t.x,0,0,t.y,0,0))._add(X.matrix(1,0,0,1,-n.x,-n.y))),e&&(i=i||this._rotationOrigin,n=o.project(i,r),s=s.rotate(e,n).flip()),s}}),X.PathTransform.IconHandle=X.Marker.extend({options:{className:"leaflet-path-transform-handler"},initialize:function(e,t){var i=t.index,a=X.PathTransform.Handle.CursorsByType[i]+"-"+i;this.options.icon=X.divIcon({iconAnchor:[[15,0],[15,12],[0,12],[0,0]][i],className:"common-map-view-zone-resizer-icon "+a}),X.Marker.prototype.initialize.call(this,e,t)},onAdd:function(e){X.Marker.prototype.onAdd.call(this,e),this._icon&&this.options.setCursor&&(this._icon.style.cursor=X.PathTransform.Handle.CursorsByType[this.options.index])},bringToFront:function(){}}),X.Handler.PathTransform.prototype.options.handleClass=X.PathTransform.IconHandle,X.PathTransform.Handle.ExtendedCursorsByType=["ew-resize","ns-resize","ew-resize","ns-resize"],X.PathTransform.HVResizeHandle=X.Marker.extend({options:{className:"leaflet-path-transform-handler"},initialize:function(e,t){var i=t.index,a=X.PathTransform.Handle.ExtendedCursorsByType[i]+"-"+i,n="vertical";i%2==0&&(n="horizontal"),t=S.extend(t,{resizeDirection:n}),this.options.icon=X.divIcon({iconAnchor:[[12,10],[10,12],[0,10],[10,0]][i],iconSize:[[12,20],[20,12],[12,20],[20,12]][i],className:"common-map-view-zone-resizer-icon hv-resizer "+a}),X.Marker.prototype.initialize.call(this,e,t)},onAdd:function(e){X.Marker.prototype.onAdd.call(this,e),this._icon&&this.options.setCursor&&(this._icon.style.cursor=X.PathTransform.Handle.ExtendedCursorsByType[this.options.index])},bringToFront:function(){}}),X.Handler.ExtendedPathTransform=X.Handler.PathTransform.extend({_createHandlers:function(){var e=this._map;if(this._handlersGroup=this._handlersGroup||(new X.LayerGroup).addTo(e),this._rect=this._rect||this._getBoundingPolygon().addTo(this._handlersGroup),this._rect.options.pane="tooltipPane",this.options.scaling){this._handlers=[];var t,i,a,n,o,r,s,l,d=this._rect._latlngs[0],c=this.options.edgesCount;for(i=0;i<c;i++)(t=this._createHandler(d[i],2*i,i,!1)).addTo(this._handlersGroup),this._handlers.push(t);for(i=0;i<c;i++)c<=(n=i+1)&&(n=0),o=d[i],s=(r=d[n]).lat==o.lat?r.lat:(r.lat+o.lat)/2,l=r.lng==o.lng?r.lng:(r.lng+o.lng)/2,a=X.latLng(s,l),(t=this._createHandler(a,2*i,i,!0)).addTo(this._handlersGroup),this._handlers.push(t)}this.options.rotation&&this._createRotationHandlers()},_createHandler:function(e,t,i,a){var n=new(a?X.PathTransform.HVResizeHandle:this.options.handleClass)(e,X.Util.extend({},this.options.handlerOptions,{className:"leaflet-drag-transform-marker drag-marker--"+i+" drag-marker--"+t,index:i,type:t,isHVResize:a,zIndexOffset:1e3}));return n.on("mousedown",this._onScaleStart,this),n},_onScaleStart:function(e){var t=e.target;this._map.dragging.disable(),(this._activeMarker=t).options.isHVResize?this._originMarker=this._handlers[(t.options.index+2)%4+4]:this._originMarker=this._handlers[(t.options.index+2)%4],this._scaleOrigin=this._originMarker.getLatLng(),this._initialMatrix=this._matrix.clone(),this._cachePoints(),this._map.on("mousemove",this._onScale,this).on("mouseup",this._onScaleEnd,this),this._initialDist=this._originMarker._point.distanceTo(this._activeMarker._point),this._initialDistX=this._originMarker._point.x-this._activeMarker._point.x,this._initialDistY=this._originMarker._point.y-this._activeMarker._point.y,this._path.fire("transformstart",{layer:this._path}).fire("scalestart",{layer:this._path,scale:X.point(1,1)}),this._handleLine&&this._map.removeLayer(this._handleLine),this._rotationMarker&&this._map.removeLayer(this._rotationMarker)},_onScale:function(e){var t,i,a=this._originMarker._point;"vertical"==this._activeMarker.options.resizeDirection?(t=1,i=(a.y-e.layerPoint.y)/this._initialDistY):"horizontal"==this._activeMarker.options.resizeDirection?(i=1,t=(a.x-e.layerPoint.x)/this._initialDistX):i=this.options.uniformScaling?t=a.distanceTo(e.layerPoint)/this._initialDist:(t=(a.x-e.layerPoint.x)/this._initialDistX,(a.y-e.layerPoint.y)/this._initialDistY),this._scale=new X.Point(t,i),this._matrix=this._initialMatrix.clone().scale(this._scale,a),this._update(),this._path.fire("scale",{layer:this._path,scale:this._scale.clone()})}}),X.Path.addInitHook(function(){this.options.transform&&(this.transform=new X.Handler.ExtendedPathTransform(this,this.options.transform))}),X.Editable.ZoneEditorClass=X.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:3,addHooks:function(){return X.Editable.BaseEditor.prototype.addHooks.call(this),this.feature&&this.initVertexMarkers(),this.feature.transform&&this._initResizeMarkers(),this},initVertexMarkers:function(e){if(this.enabled())if(e=e||this.getLatLngs(),a(e))this.addVertexMarkers(e);else for(var t=0;t<e.length;t++)this.initVertexMarkers(e[t])},setMarkersColor:function(e){var t,i,a=this._editMarkers.length;for(i=0;i<a;i++)(t=this._editMarkers[i])._icon&&(t._icon.style.backgroundColor=e);for(a=this._resizeMarkers.length,i=0;i<a;i++)(t=this._resizeMarkers[i])._icon&&(t._icon.style.backgroundColor=e);this._addingMarker&&this._addingMarker._icon&&(this._addingMarker._icon.style.backgroundColor=e)},addVertexMarkers:function(e){this._editMarkers=[],this._resizeMarkers=[];for(var t=0;t<e.length;t++)this.addVertexMarker(e[t],e);this.addVertexMarker(e[0],e,!0)},addVertexMarker:function(e,t,i){var a=new this.tools.options.vertexMarkerClass(e,t,this,{color:this.feature.zone.backgroundColor,isAddingMarker:i,zIndexOffset:1e3,pane:"tooltipPane"});return i?(this._addingMarker=a,this._addingMarker.hide()):this._editMarkers.push(a),a},addResizeMarker:function(e,t,i){var a={restrict:"vertical"};4!=i&&14!=i||(a.restrict="horizontal"),a.index=i%4;var n=this.tools.options.resizeMarkerClass,o=this.feature.zone;a.color=o.backgroundColor;var r=new n(e,t,this,a);return this._resizeMarkers.push(r),r},_reApplyVerteMarkers:function(){var e,t,i=this.feature.getLatLngs(),a=this._editMarkers,n=this._resizeMarkers;if(i[0]&&i[0][0]&&!i[0][0].__vertex){var o,r,s;for(i=i[0],t=a.length,e=0;e<t;e++)((o=i[(r=a[e]).options.index]).__vertex=r).latlng=o,r.latlngs=[i];for(t=n.length,e=0;e<t;e++)((o=i[(s=n[e]).options.index]).__vertex=s).latlng=o,s.latlngs=[i]}},_refreshVertexMarkers:function(){var e,t=this._editMarkers,i=this._resizeMarkers,a=t.length;for(e=0;e<a;e++)t[e].update();for(a=i.length,e=0;e<a;e++)i[e].update()},hideEditMarkers:function(){for(var e=this._editMarkers,t=0;t<e.length;t++)e[t].setOpacity(0)},showEditMarkers:function(){for(var e=this._editMarkers,t=0;t<e.length;t++)e[t].setOpacity(1)},getLatLngs:function(){return this.feature.getLatLngs()},_initResizeMarkers:function(){var e=this.feature;e.off("scalestart"),e.off("scale"),e.off("scaleend"),e.on("scalestart",this.onScaleStart.bind(this)),e.on("scale",this.onScale.bind(this)),e.on("scaleend",this.onScaleEnd.bind(this))},onScaleStart:function(e){this.editLayer.clearLayers(),e.target=this.feature,e.isMarkerDrag=!0,this.map.widget._dragStartZoneEvt(e)},onScale:function(e){},onScaleEnd:function(e){this.initVertexMarkers(),e.target=this.feature,e.isMarkerDrag=!0,this.map.widget._dragEndZoneEvt(e)},onResizeMarkerDrag:function(e){this.onMove(e),this.feature._bounds&&this.extendBounds(e),this.fireAndForward("editable:vertex:drag",e)},getDefaultLatLngs:function(){return this.feature._latlngs.length||this.feature._latlngs.push([]),this.feature._latlngs[0]},onVertexDeleted:function(e){var t;for(t=this._editMarkers-1;0<=t;t--)this._editMarkers[t]===e.vertex&&this._editMarkers.splice(t,1);this.fireAndForward("editable:vertex:deleted",e)},onVertexRawMarkerClick:function(e){this.fireAndForward("editable:vertex:rawclick",e),e._cancelled},onVertexMarkerCtrlClick:function(e){this.fireAndForward("editable:vertex:ctrlclick",e)},onVertexMarkerShiftClick:function(e){this.fireAndForward("editable:vertex:shiftclick",e),this.vertexCanBeDeleted(e.vertex)&&(this.feature.editor._addingMarker.hide(),e.vertex.delete(),this.feature.transform._path._bounds._northEast=null,this.feature.transform._path._bounds._southWest=null,this.feature.transform.reset(),e.target=e.target.editor.feature,this.map.widget._dragEndZoneEvt(e))},onDragEnd:function(e){this.initVertexMarkers(),X.Editable.BaseEditor.prototype.onDragEnd.call(this,e)},onVertexMarkerDragStart:function(e){e.target=this.feature,e.isMarkerDrag=!0,this.map.widget._dragStartZoneEvt(e),this.fireAndForward("editable:vertex:dragstart",e)},onVertexMarkerDrag:function(e){this.onMove(e),this.feature._bounds&&this.extendBounds(e),this.fireAndForward("editable:vertex:drag",e)},onVertexMarkerDragEnd:function(e){e.target=this.feature,e.isMarkerDrag=!0,this.map.widget._dragEndZoneEvt(e),this.feature._bounds&&this.extendBounds(e),this.feature.transform&&this.feature.transform.reset(),this.map.widget._dragEndZoneEvt(e),this.fireAndForward("editable:vertex:dragend",e)},extendBounds:function(e){var t,i=this.feature.getLatLngs(),a=(i=i[0]).length;for(this.feature._bounds=X.latLngBounds(),t=0;t<a;t++)this.feature._bounds.extend(i[t]);this.feature._bounds.extend(e.vertex.latlng)},onEnable:function(){var e=this.feature.getElement();this._onMouseMove=this.onMouseMove.bind(this),this._onMouseOut=this.onMouseOut.bind(this),S(e).on("mousemove",this._onMouseMove),S(e).on("mouseout",this._onMouseOut),this.fireAndForward("editable:enable")},onDisable:function(){var e=this.feature.getElement();S(e).off("mousemove",this._onMouseMove),S(e).off("mouseout",this._onMouseOut),this._onMouseMove=null,this.fireAndForward("editable:disable")},_getVertexBoundsFromMarker:function(e,t){var i=this.feature.editor.map,a=i.getZoom(),n=i.unproject(t,a),o=n.lat/2,r=n.lng/2,s=X.latLng(e.lat+o,e.lng-r),l=X.latLng(e.lat-o,e.lng+r);return X.latLngBounds(s,l)},onMouseOut:function(e){var t=this.feature,i=t.editor,a=i.map.widget;t._isDragging||i._addingMarker&&(a._isMouseOutZone=!0,a._mouseOutZoneAddingMarker=i._addingMarker)},onMouseMove:function(e){var t=this.feature,i=t.editor,a=i.map,n=a.widget;if(!t._isDragging){var o,r,s,l,d,c,u,p=a.mouseEventToLatLng(e),h=i._addingMarker.options.icon.options.iconSize,f=this._getVertexBoundsFromMarker(p,h),g=this.getLatLngs(),m=(g=g[0]).length;for(o=0;o<m;o++){if(r=g[o],s=o==m-1?g[0]:g[o+1],l=this._getVertexBoundsFromMarker(r,h),d=this._getVertexBoundsFromMarker(s,h),f.intersects(l)||f.intersects(d)){c=!1;break}if(0<(u=n.isIntersectLineRectangle(r,s,f)).length){i._addingMarker.left=r.__vertex,i._addingMarker.right=s.__vertex,c=!0;break}c=!1}c?(2==u.length&&(r=u[0],s=u[1],p.lat=(r.lat+s.lat)/2,p.lng=(r.lng+s.lng)/2),i._addingMarker.show()):i._addingMarker.hide(),i._addingMarker.setLatLng(p)}}}),X.ZoneEditable=X.Editable.extend({createVertexIcon:function(e){return e.color=e.color?e.color:"rgb(0, 129, 198)",new X.Editable.VertexIcon(e)},createResizeIcon:function(e){return e.color=e.color?e.color:"rgb(0, 129, 198)",new X.Editable.ResizeIcon(e)}});var K=function(e,t,i,a,n){var o="<div class='device-info-text device-id-"+e+"'>";return o+="<div class='text'>",null!=a&&(o+="<span class='tem color'>"+a+"</span>"),null!=n&&(o+="/ <span class='tem'>"+n+"</span>"),o+="</div><div class='name' "+(i?"asset":"")+">"+t+"</div>",o+="</div>"},t=e.extend({events:["change","dragstart","dragend","drop","movestart","moveend"],options:{name:"CommonMapView",dataSource:[],zoneDataSource:[],heatMapDataSource:[],hasSelectedModel:!0,deviceIconSize:34,measuredDeviceIconSize:[34,41.5],deviceIconRadius:2.125,width:"100%",height:"100%",floor:null,mapImageWidth:null,mapImageHeight:null,mapImageUrl:null,mapImage:null,isRegisterView:!1,isForcedShowDevice:!1,isDetailPopupView:!1,canDragDeviceIcon:null,showRegisteredGateway:!1,showDeviceText:!0,showDeviceValue:null,showDeviceNameCheckbox:!0,showDeviceInfoCheckbox:!0,showZoneNameCheckbox:!0,isMonitoringFloorImage:!0,temperatureUnit:null,heatMapOptions:null,hasFullScreenControl:!0,hasLegendControl:!0,hasZoomControl:!0,hasDefaultZoomControl:!0,hasColorPickerControl:!0,hasLayerControl:!0,zoneColorOptions:{NotSelected:{color:"rgb(0,129,198)",weight:2,opacity:1,lineJoin:"bevel",fillColor:"rgb(0, 129, 198)",fillOpacity:"0.1",fillRule:"nonzero",className:"common-map-view-zone"},Selected:{color:"rgb(0,129,198)",weight:2,opacity:1,lineJoin:"bevel",fillColor:"rgb(0, 129, 198)",fillOpacity:"0.35",fillRule:"nonzero",className:"common-map-view-zone selected"}},zoneNameOptions:{className:"common-map-view-zone-name",iconAnchor:[10,20]},deviceStrokeColorOptions:{Selected:{color:"rgb(0,129,198)",weight:10,opacity:.4},NotSelected:{color:"rgb(0,0,0)",weight:0,opacity:.4}},deviceColorOptions:{"Normal.On":"rgb(26,160,90)","Normal.Off":"rgb(69,69,69)","Alarm.Warning":"rgb(255,164,31)","Alarm.Critical":"rgb(239,43,43)",Selected:"rgb(0, 129, 198)",NotSelected:"rgb(178, 178, 178)"},movableBeaconColorOptions:{"Normal.On":"url(#beacon-normal-on)","Alarm.Warning":"url(#beacon-alarm-warning)","Alarm.Critical":"url(#beacon-alarm-critical)",Selected:"url(#beacon-selected)",NotSelected:"url(#beacon-notselected)"},deviceTypeImageName:{Outdoor:"ic-sacoutdoor30",Indoor:"ic-sacindoor30",Meter:"ic-meter30",Motion:"ic-motion30",Gateway:"ic-gateway30",Beacon:"ic-ble30",CCTV:"ic-cctv30",Asset:"ic-meter30",Light:"ic-light30",Temp:"ic-temp30",AI:"ic-dvc-ai",AO:"ic-dvc-ao",AV:"ic-dvc-av",DI:"ic-dvc-di",DO:"ic-dvc-do",DV:"ic-dvc-dv",SmartPlug:"ic-power30"},deviceModeImageName:{Cool:"ic-cool",Auto:"ic-auto",Heat:"ic-heat",Dry:"ic-dry",Fan:"ic-fan",Off:"ic-attention",CoolStorage:"ic-coolwater",HotWater:"ic-hotwater",HeatExchange:"ic-heat-ex",ByPass:"ic-heat-bypass",Sleep:"ic-heat-sleep",Eco:"ic-dhw-eco",Standard:"ic-dhw-standard",Power:"ic-dhw-power",Force:"ic-dhw-force"},assetTypeImageName:{computer:"ic-computation30",computation:"ic-computation30",office:"ic-office30",medical:"ic-medical30",power:"ic-power30",firefighting:"ic-firefighting30",security:"ic-security30",network:"ic-network30",hvac:"ic-hvac30",etc:"ic-etc30"},beaconImageName:{"Normal.On":"drop-green","Alarm.Warning":"drop-yellow","Alarm.Critical":"drop-red",Selected:"drop-blue",NotSelected:"drop-gray"},DEFAULT_WIDTH_SIZE:o,DEFAULT_HEIGHT_SIZE:s},init:function(e,t){S(e).data("kendoCommonMapView")&&S(e).data("kendoCommonMapView").destroy(),C.ui.Widget.fn.init.call(this,e,t),this._initOptions(),this._initSvgElements(),this._initLeaflet(),this._initLeafletControls(),this._setMapImage(),this._createDataSource(),this._attachEventHandler(),this._renderZones(),this._renderDevices()},_initOptions:function(){var e=this.options;if(null===e.showDeviceValue&&(e.isRegisterView?e.showDeviceValue=!1:e.showDeviceValue=!0),null===e.canDragDeviceIcon&&(e.isRegisterView?e.canDragDeviceIcon=!0:e.canDragDeviceIcon=!1),e.canDragDeviceIcon&&(e.isMonitoringFloorImage=!1),!e.temperatureUnit){var t=i.getTemperature();e.temperatureUnit="Fahrenheit"===t.unit?Q.CHAR.Fahrenheit:Q.CHAR.Celsius}},_initLeaflet:function(){var e=this,t=this.element;t.addClass("common-map-view"),e.map&&e.map.destroy(),e.map=X.map(t.get(0),{minZoom:.6,maxZoom:3,boxZoom:!1,zoom:1,crs:X.CRS.Simple,scrollWheelZoom:!0,zoomAnimation:!0,fadeAnimation:!0,markerZoomAnimation:!0,doubleClickZoom:!1,zoomControl:!1,zoomDelta:.2,zoomSnap:0,editToolsClass:X.ZoneEditable,editable:!0,editOptions:{skipMiddleMarkers:!0,polygonEditorClass:X.Editable.ZoneEditorClass,resizeMarkerClass:X.Editable.ResizeMarkerClass,vertexMarkerClass:X.Editable.VertexMarkerClass}}),e.map.widget=e},_initLeafletControls:function(){var e=this,t=e.options,i=e.map,a=t.hasZoomControl,n=t.hasFullScreenControl,o=t.hasLegendControl,r=t.hasDefaultZoomControl,s=t.hasColorPickerControl,l=t.hasLayerControl,d=t.showRegisteredGateway,c=t.showDeviceInfoCheckbox,u=t.showDeviceNameCheckbox,p=t.showZoneNameCheckbox;n&&(e.fullScreenControl=X.control.fullScreen(),e.fullScreenControl.addTo(i)),o&&(e.legendControl=X.control.legend(),e.legendControl.addTo(i)),a&&(e.zoomControl=X.control.extendZoom(),e.zoomControl.addTo(i)),r&&(e.defaultZoomControl=X.control.defaultZoom(),e.defaultZoomControl.addTo(i)),s&&(e.colorPickerControl=X.control.colorPicker(),e.colorPickerControl.addTo(i)),l&&(e.layerControl=X.control.layer({showRegisteredGateway:d,showDeviceInfoCheckbox:c,showDeviceNameCheckbox:u,showZoneNameCheckbox:p}),e.layerControl.addTo(i))},_initSvgElements:function(){var e=this;e.wrapper=e.element,e.svgElem=S(document.createElementNS(r,"svg"));var t=S(document.createElementNS(r,"defs"));e.svgDefsElem=t,e.svgElem.append(t),e.svgElem.prependTo(e.element),e._createMovableDeviceImageFilter()},_createMovableDeviceImageFilter:function(){var e,t,i,a,n=this.options,o=this.options.beaconImageName;for(e in o)a=o[e],i=document.createElementNS(r,"pattern"),e=e.replace(".","-").toLowerCase(),i.setAttribute("id","beacon-"+e),i.setAttribute("width","100%"),i.setAttribute("height","100%"),(t=document.createElementNS(r,"image")).setAttribute("x",0),t.setAttribute("y",0),t.setAttribute("width",n.deviceIconSize),t.setAttribute("height",n.deviceIconSize),t.setAttribute("href",Q.addBuildDateQuery("../../src/main/resources/static-dev/images/icon/"+a+".png")),S(i).append(t).appendTo(this.svgDefsElem)},_createDataSource:function(){var e=this.options,t=e.zoneDataSource,i=e.dataSource,a=e.heatMapDataSource;this._createZoneDataSource(t),this._createDeviceDataSource(i),this._createHeatMapDataSource(a)},_createZoneDataSource:function(e){var t;(e=e||[])instanceof C.data.DataSource?this.zoneDataSource=e:((t=new C.data.DataSource({data:e})).read(),this.zoneDataSource=t),this.zoneDataSource.bind("change",this._changeZoneDataSourceEvt.bind(this))},_createDeviceDataSource:function(e){var t;(e=e||[])instanceof C.data.DataSource?this.dataSource=e:((t=new C.data.DataSource({data:e})).read(),this.dataSource=t),this.dataSource.bind("change",this._changeDataSourceEvt.bind(this))},_createHeatMapDataSource:function(e){var t;(e=e||[])instanceof C.data.DataSource?this.heatMapDataSource=e:((t=new C.data.DataSource({data:e})).read(),this.heatMapDataSource=t),this.dataSource.bind("change",this._changeHeatMapDataSourceEvt.bind(this))},_attachEventHandler:function(){var e=this,t=e._clickZoneEvt.bind(e);e.element.on("click",".common-map-view-zone",t);var i=e._clickZoneNameEvt.bind(e);e.element.on("click",".common-map-view-zone-name",i);var a=e._clickDeviceEvt.bind(e);e.element.on("click",".common-map-view-device-icon",a),e.element.on("click",".common-map-view-device-text",a);var n=e._mouseMoveMapEvt.bind(e);e.map.on("mousemove",n),e._resizeSidebarEvt=e._resizeMainSidebarEvt.bind(e),S(F).on("changeSidebarState",e._resizeSidebarEvt)},_resizeMainSidebarEvt:function(){this._invalidateMapSize()},_mouseMoveMapEvt:function(e){var t=this;if(t._isEditableZone&&t._isMouseOutZone){var i=e.latlng,a=t._mouseOutZoneAddingMarker.editor,n=a.feature;if(n._isDragging)return;if(!n.editor)return;var o=t._mouseOutZoneAddingMarker.getLatLng(),r=t._mouseOutZoneAddingMarker.options.icon.options.iconSize;a._getVertexBoundsFromMarker(o,r).contains(i)||(t._isMouseOutZone=!1,t._mouseOutZoneAddingMarker.hide(),t._mouseOutZoneAddingMarker=null)}},_changeDataSourceEvt:function(e){var t,i,a=this,n=e.items;if("itemchange"==e.action)for(i=n.length,t=0;t<i;t++)a.updateDeviceIcon(n[t]);else if("add"==e.action)for(i=n.length,t=0;t<i;t++)a.renderDevice(n[t]);else if("remove"==e.action)for(i=n.length,t=0;t<i;t++)a.removeDevice(n[t]);else a._isCancelChanges?a.setDataSource(n):n&&a._renderDevices()},updateDeviceIcon:function(e){var t,i,a,n,o,r,s=this.deviceLayerGroup.getLayers();for(i=s.length,t=0;t<i;t++)(r=s[t])instanceof X.Marker&&r.device.id==e.id&&(a=r._zIndex,n=r.infoMarker._zIndex,this._removeDeviceIcon(r),(o=this.renderDevice(e)).setZIndexOffset(a),o.infoMarker.setZIndexOffset(n))},_changeZoneDataSourceEvt:function(e){var t,i,a=this,n=e.items,o=e.sender;if("itemchange"==e.action){for(i=n.length,e.field&&(a._isMissingZone=!0),t=0;t<i;t++)a._addChangedData(a._changedZones,n[t],e.field),a.updateZonePolygon(n[t]);e.field&&(a._isMissingZone=!1)}else if("add"==e.action)for(i=n.length,t=0;t<i;t++)n[t]._isNew=!0,a._addChangedData(a._changedZones,n[t]),a.renderZone(n[t]);else if("remove"==e.action)for(i=n.length,t=0;t<i;t++)a._addChangedData(a._changedZones,n[t],null,!0),a.removeZone(n[t]);else a._isCancelChanges?a.setZoneDataSource(n):o.filter()&&a._renderZones()},updateZonePolygon:function(e){var t,i,a,n=this.zoneLayerGroup.getLayers();for(i=n.length,t=0;t<i;t++)(a=n[t])instanceof X.Polygon&&a.zone.id==e.id&&(this._removeZonePolygon(a),this.renderZone(e))},_changeHeatMapDataSourceEvt:function(e){var t,i,a=e.items;if("itemchange"==e.action)for(i=a.length,t=0;t<i;t++);else if("add"==e.action)for(i=a.length,t=0;t<i;t++);else if("remove"==e.action)for(i=a.length,t=0;t<i;t++);this._renderHeatMap()},_setMapImage:function(){var e=this,t=this.options,i=t.floor;i&&(t.mapImageUrl=i.imageUrl,t.mapImageWidth=i.imageWidth,t.mapImageHeight=i.imageHeight),e._setMapViewSize(),e._updateMaxBounds(),e._imagePosX=0,e._imagePosY=0,e.imageOverlay&&(e.imageOverlay.remove(),e.imageOverlay=null),e.options.mapImageUrl&&e._renderImage(),e.moveCenterView()},_invalidateMapSize:function(){this.map.invalidateSize(!1)},invalidateSize:function(e){return this.map.invalidateSize(e)},_updateMaxMapSize:function(e,t){var i=this,a=this.options,n=i.maxWidth,o=i.maxHeight;e+=57,t+=38+a.deviceIconSize/2,n<e&&(i.maxWidth=e),o<t&&(i.maxHeight=t),i._updateMaxBounds()},_setMapViewSize:function(){var e=this,t=this.options,i=t.mapImageUrl,a=e.getWidth(),n=e.getHeight();e.element.css("width",a),e.element.css("height",n),t.isDetailPopupView?(e.mapViewWidth=o,e.mapViewHeight=s):(e.mapViewWidth=e.getWidth(!0),e.mapViewHeight=e.getHeight(!0)),i?(t.mapImageWidth<=e.mapViewWidth?e.maxWidth=e.mapViewWidth<o?o:e.mapViewWidth:e.maxWidth=t.mapImageWidth,t.mapImageHeight<=e.mapViewHeight?e.maxHeight=e.mapViewHeight<s?s:e.mapViewHeight:e.maxHeight=t.mapImageHeight):(t.mapImageWidth=null,t.mapImageHeight=null,e.maxWidth=e.mapViewWidth<o?o:e.mapViewWidth,e.maxHeight=e.mapViewHeight<s?s:e.mapViewHeight)},_updateMaxBounds:function(){var e=this,t=e.map.unproject([0,e.maxHeight],1),i=e.map.unproject([e.maxWidth,0],1),a=new X.LatLngBounds(t,i);e.map.setMaxBounds(a)},getWidth:function(e){var t=this.options.width;return e?this.getPercentSize(t,"width"):null===t?o:t},getHeight:function(e){var t=this.options.height;return e?this.getPercentSize(t,"height"):null===t?s:t},getPercentSize:function(e,t){var i,a=this.element;return"string"==typeof e?-1!==e.indexOf("%")&&(i=a.parent(),e=("width"==t?i.width():i.height())*((e=Number(e.replace("%","")))/100)):null===e&&(e="width"==t?o:s),e},_renderHeatMap:function(){var e=this,t=e.options,i=e.map,a=t.heatMapOptions;if(a){S.isEmptyObject(a)&&(a={radius:15,blur:20}),e.heatMapLayer&&(e.heatMapLayer.remove(),e.heatMapLayer=null);var n,o,r,s=this.heatMapDataSource.data(),l=s.length,d=[],c=i.getZoom();for(n=0;n<l;n++)o=s[n],r=e.map.unproject([o[0],o[1]],c),r=void 0!==o[2]?[r.lat,r.lng,o[2]]:[r.lat,r.lng],d.push(r);e.heatMapLayer=X.heatLayer(d,a),e.heatMapLayerGroup&&(e.heatMapLayerGroup.remove(),e.heatMapLayerGroup=null),e.heatMapLayerGroup=X.layerGroup(),e.heatMapLayerGroup.setZIndex(5),e.heatMapLayer.addTo(e.heatMapLayerGroup),e.heatMapLayerGroup.addTo(i)}},_renderImage:function(){var e=this,t=this.options,i=this.map,a=t.mapImageWidth?t.mapImageWidth:0,n=t.mapImageHeight?t.mapImageHeight:0,o=e.mapViewWidth,r=e.mapViewHeight,s=0,l=0;t.isMonitoringFloorImage&&(s=a<o?o/2-a/2:0,l=n<r?r/2-n/2:0),e._imagePosX=s,e._imagePosY=l;var d=e.map.unproject([s,n+l],1),c=e.map.unproject([a+s,l],1),u=new X.LatLngBounds(d,c);e.imageOverlay=X.imageOverlay(t.mapImageUrl,u),e.imageLayerGroup&&(e.imageLayerGroup.remove(),e.imageLayerGroup=null),e.imageLayerGroup=X.layerGroup(),e.imageLayerGroup.setZIndex(1),e.imageOverlay.addTo(e.imageLayerGroup),e.imageLayerGroup.addTo(i),e._invalidateMapSize()},_renderZones:function(){var e,t,i=this,a=this.zoneDataSource,n=this.map;if(a instanceof C.data.DataSource){t=a.data();var o=a.filter(),r=a.sort();t=new C.data.Query(t),r&&(t=t.sort(r)),o&&(t=t.filter(o)),t=t.toArray()}else t=a;var s,l=t.length;for(i.zoneLayerGroup&&(i.zoneLayerGroup.remove(),i.zoneLayerGroup=null),i.zoneLayerGroup=X.layerGroup(),s=0;s<l;s++)e=t[s],i.renderZone(e);i.zoneLayerGroup.setZIndex(2),i.zoneLayerGroup.addTo(n),i._invalidateMapSize()},renderZone:function(e){var t,i,a,n,o,r=this;e.name||(e.name=r._getDefaultZoneName()),n=(a=((t=e.geometry)&&(i=t.coordinates)&&i[0]||(i=r._getDefaultZonePolygonCoordinate(),e.geometry={type:"Polygon",coordinates:i}),r._createZone(e))).zonePolygon,o=a.zoneNameMarker,n&&((n.zone=e).nameDisplayCoordinate||(e.nameDisplayCoordinate=o._originalCoordinates),r._isMissingZone&&r._assignZonePolygonToDeviceIcon(n))},_createZone:function(e){var t,i=this,a=i.options.zoneColorOptions,n=e.id,o=e.name,r=e.geometry.coordinates,s=e.nameDisplayCoordinate,l=e.backgroundColor?e.backgroundColor:a.Selected.color,d=i.map,c=i._createZonePolygon(e);if(c._originalCoordinates=r,c.addTo(i.zoneLayerGroup),!s){var u=c.getBounds(),p=d.project(u.getCenter(),1);s=[p.x-41,p.y+4]}return(t=i._createZoneNameMarker(n,o,s,l)).zonePolygon=c,t._originalCoordinates=s,t.addTo(i.zoneLayerGroup),c.zoneNameMarker=t,{zonePolygon:c,zoneNameMarker:t}},_getDefaultZoneName:function(){var e,t,i,a,n=this.zoneDataSource.data(),o=n.length,r=0;for(a=0;a<o;a++)(i=n[a].name)&&-1!=i.indexOf("New Zone")&&(t=(e=i.split(" "))[e.length-1],t=Number(t),!isNaN(t)&&r<t&&(r=t));return"New Zone "+(r+1)},_getDefaultZonePolygonCoordinate:function(){var e=this.map,t=e.getCenter(),i=e.project(t,1),a=i.y-68,n=i.x+100,o=i.x-100,r=i.y+68,s=[[o,a],[n,a],[n,r],[o,r]];return s.push(s[0]),[s]},_createZonePolygon:function(e){var t=e.id,i=e.geometry.coordinates,a=e.selected,n=e.backgroundColor;this._applyImagePositionToCoordinate(i);var o=this._unprojectCoordinatesForRender(i);Q.removeSameLastPoint(o);var r=X.latLngBounds(o),s=i[0],l=Q.getCentroid(s.slice(0,s.length-1)),d=r.getCenter(),c=this.options,u=[o],p=S.extend(!0,{},c.zoneColorOptions.NotSelected);a&&(p=S.extend(p,c.zoneColorOptions.Selected)),p.color=n||p.color,p.fillColor=n||p.fillColor;var h=" zone-id-"+t;p.className+=h,p.transform=!0,p.draggable=!0,this._isEditableZone&&(p.pane="tooltipPane");var f=X.polygon(u,p);return f.dragging.disable(),f.centerCoordinate=d,f.originalCenterCoordinate=l,f},_createZoneNameMarker:function(e,t,i,a){var n=this,o=n.options,r=i[0]+n._imagePosX,s=i[1]+n._imagePosY,l=n.map.unproject([r,s],1),d=S.extend(!0,{},o.zoneNameOptions);d.html=n._getZoneNameMarkerHtml(a,t);var c=" zone-id-"+e;d.className+=c;var u,p=X.divIcon(d);return u=n._isEditableZone?{icon:p,zIndexOffset:1e3,pane:"tooltipPane"}:{icon:p,zIndexOffset:-2e3},X.marker(l,u)},_getZoneNameTextColor:function(e){var t,i,a,n,o,r="#000";return(t=e,i=C.parseColor(t),a=i.r,n=i.g,o=i.b,Math.sqrt(a*a*.241+n*n*.691+o*o*.068))<=129&&(r="#fff"),r},_getZoneNameMarkerHtml:function(e,t){return"<div class='common-map-view-zone-name-text' style='color : "+this._getZoneNameTextColor(e)+"; background-color: "+e+";'>"+t+"</div>"},_showRegisteredGateway:function(){var e=F.MAIN_WINDOW,t=e.getCurrentFloor(),i=t.floor.id,a=t.building.id,n=F.CommonLoadingPanel;n=new n;var o=this,r="?types=Gateway&registrationStatuses=Registered";a!=e.FLOOR_NAV_BUILDING_TOTAL_ID&&i!=e.FLOOR_NAV_FLOOR_ALL_ID&&(r+="&foundation_space_buildings_id="+a,r+="&foundation_space_floors_id="+i,n.open(o.element),S.ajax({url:"/dms/devices"+r}).done(function(e){o._removeRegisteredGateway();var t=new C.data.DataSource({data:e});t.read(),o._renderDevices(t,!0)}).fail(function(e){}).always(function(){n.close()}))},_removeRegisteredGateway:function(){var e,t,i=this.deviceLayerGroup.getLayers(),a=i.length;for(t=0;t<a;t++)(e=i[t]).isOnlyShow&&"Gateway"==e.device.type&&this._removeDeviceIcon(e)},_clickZoneNameEvt:function(e){var t=this;setTimeout(function(){t._editableZoneNameMarker||t._clickZoneEvt(e)},250)},_clickZoneEvt:function(e){var t,i=this;if(!i._editableZoneNameMarker)if(i._isZoneDraggingEnd)i._isZoneDraggingEnd=!1;else{var a=e.currentTarget,n=i.getDataIdFromElement(a,"zone");if(i._isEditableZone){var o=(t=i.selectZone(n,!0)).getElement(),r=!S(o).hasClass("editable");i.clearEditableZone(),r?i._editableZone(t,r):t=i.selectZone(n,!1)}else t=i.selectZone(n);i._updateColorPickerState()}},editableZone:function(e,t){var i=this;if(i._isEditableZone){var a=i.selectZone(e,!0);i.clearEditableZone(),i._editableZone(a,t),i._updateColorPickerState()}},_updateColorPickerState:function(){var e=this;if(e.colorPickerControl)if(e._editableZonePolygon){e.colorPickerControl.enable();var t=e.colorPickerControl.colorPicker,i=e.options,a=e._editableZonePolygon.zone,n=a.backgroundColor?a.backgroundColor:i.zoneColorOptions.Selected.fillColor;t.value(n,!0)}else e.colorPickerControl.active(!1),e.colorPickerControl.disable(),e.colorPickerControl.colorPicker.close()},selectZone:function(e,t){var i=this,a=i.getZonePolygon(e);if(a||console.error("there is no zone id is "+e),void 0===t){var n=a.getElement();t=!S(n).hasClass("selected")}if(i._selectZonePolygon(a,t)){var o,r,s,l,d=a.zone,c=i.dataSource.data(),u=(o=new C.data.Query(c).filter({field:"locations",operator:i._zoneFilter,value:e}).toArray()).length;for(r=0;r<u;r++)l=o[r],(s=i.getDeviceIcon(l.id))&&!i._isEditableZone&&i._selectDeviceIcon(s,t,!0);i.trigger("change",{devices:o,zones:[d]})}return a},_selectZonePolygon:function(e,t){var i={},a=this.options,n=e.getElement().classList,o=this.options.isRegisterView,r=e.zone,s=r.backgroundColor,l=this.deviceLayerGroup.getLayers();if(r.selected!==t&&(o||0!=l.length)){if(r.selected=t){if((i=S.extend(i,a.zoneColorOptions.Selected)).color=s||i.color,i.fillColor=s||i.fillColor,n.contains("selected"))return;n.add("selected")}else{if((i=S.extend(i,a.zoneColorOptions.NotSelected)).color=s||i.color,i.fillColor=s||i.fillColor,!n.contains("selected"))return;n.remove("selected"),e===this._editableZonePolygon&&this._editableZone(e,!1)}return e.setStyle(i),e}},_editableZone:function(e,t){var i=this,a=e.zoneNameMarker,n=e.getElement().classList,o=a.getElement().classList;if(t){if(n.contains("editable"))return;n.add("editable"),o.add("editable"),e.setStyle({opacity:1}),i.map.on("contextmenu",function(e){return X.DomEvent.stop(e),!1}),e.dragging.enable(),a.dragging.enable(),a.on("dragstart",i._dragStartZoneNameEvt.bind(i)),a.on("dragend",i._dragEndZoneNameEvt.bind(i)),a.on("dblclick",i._dbClickZoneNameEvt.bind(i)),e.transform.disable(),e.transform.enable({rotation:!1,scaling:!0}),e.enableEdit(),e.on("dragstart",i._dragStartZoneEvt.bind(i)),e.on("drag",i._dragZoneEvt.bind(i)),e.on("dragend",i._dragEndZoneEvt.bind(i)),i._editableZonePolygon=e}else{if(!n.contains("editable"))return;n.remove("editable"),o.remove("editable"),e.setStyle({opacity:.3}),i.map.off("contextmenu"),e.dragging.disable(),a.dragging.disable(),e.transform.disable(),e.disableEdit(),a.off("dragstart"),a.off("dragend"),a.off("dblclick"),e.off("dragstart"),e.off("drag"),e.off("dragend"),i._editableZonePolygon=null}},_dragStartZoneEvt:function(e){var t=e.target;t._isDragging=!0,t._beforeDragLatlngs=[];var i,a=t.getLatLngs()[0],n=a.length;for(i=0;i<n;i++)t._beforeDragLatlngs.push(a[i].clone());var o=t.zoneNameMarker;o._beforeDragLatlng=o.getLatLng()},_dragZoneEvt:function(e){var t=this.map,i=e.target,a=X.point(e.clientX,e.clientY),n=X.point(a.subtract(i.dragging._clientStartPoint));i.dragging._clientStartPoint=a;var o=t.getZoom(),r=t.unproject(n,o),s=r.lat,l=r.lng,d=i.zoneNameMarker,c=d.getLatLng(),u=X.latLng(c.lat+s,c.lng+l);d.setLatLng(u)},_dragEndZoneEvt:function(e){var t,i,a,n,o,r,s=this,l=e.target,d=l.zoneNameMarker,c=s.getMaxBounds(),u=c.getNorth(),p=c.getWest(),h=c.getEast(),f=c.getSouth();if(s._isZoneDraggingEnd=void 0===e.isMarkerDrag,i=(t=l.getBounds()).getNorth(),a=t.getEast(),n=t.getWest(),o=t.getSouth(),u<i||n<p||o<f||h<a)l.setLatLngs(l._beforeDragLatlngs),d.setLatLng(d._beforeDragLatlng),l.editor.editLayer.clearLayers(),l.editor.initVertexMarkers(),l.transform.disable(),l.transform.enable({rotation:!1,scaling:!0}),l.enableEdit();else{var g=l.getLatLngs(),m=l.getBounds();l.originalCenterCoordinate=Q.getCentroid(s._projectCoordinatesForModel(g)),l.centerCoordinate=m.getCenter(),s._removeZoneIdInDevices(l,!1);var v,_,b,C,k=l.zone,w=k.id,D=s.deviceLayerGroup.getLayers(),y=D.length;for(r=0;r<y;r++)(_=D[r])instanceof X.Marker&&s.isLayerInPolygon(_,l)&&!_.isMeasured&&(C="locations[0]",(b=(v=_.device).locations?v.locations[0]:null)&&(s._addChangedData(s._changedDevices,v,[C+".foundation_space_zones_id",C+".id"]),b.foundation_space_zones_id=w));s._addChangedData(s._changedZones,k,["geometry.coordinates","geometry.type"]);var I=k.geometry;I.coordinates=s._projectCoordinatesForModel(l.getLatLngs()),I.coordinates[0].push(I.coordinates[0][0]),s.trigger("dragend",{zones:[k]})}s._checkZoneNameMarkerBounds(d),delete l._draggingLatLng,l._isDragging=!1},_removeZoneIdInDevices:function(e,t){var i,a,n,o,r=this,s=e.zone.id,l=r.dataSource.data(),d=new C.data.Query(l).filter({field:"locations",operator:r._zoneFilter,value:s}).toArray(),c=d.length;for(o=0;o<c;o++)a=d[o],(i=r.getDeviceIcon(a.id))&&(n=r.isLayerInPolygon(i,e),i&&n==t&&(r._selectDeviceIcon(i,!1),a.locations&&a.locations[0]&&(r._addChangedData(r._changedDevices,a,["locations[0].foundation_space_zones_id","locations[0].id"]),a.locations[0].foundation_space_zones_id=0)))},_addChangedData:function(e,t,i,a){if(e){var n,o=e.get(t.id);if(e._changedFields||(e._changedFields={}),e._changedFields[t.id]||(e._changedFields[t.id]=[]),i)if(n=e._changedFields[t.id],"string"==typeof i&&-1===n.indexOf(i))n.push(i);else if(S.isArray(i)){var r,s=i.length;for(r=0;r<s;r++)-1===n.indexOf(i[r])&&n.push(i[r])}a&&delete e._changedFields[t.id],o||e.add(t.toJSON())}},_dbClickZoneNameEvt:function(e){var t=this,i=e.target,a=i.zonePolygon.zone,n=S(i.getElement());n.html("");var o,r=a.backgroundColor?a.backgroundColor:t.options.zoneColorOptions.Selected.color,s=t._getZoneNameTextColor(r),l=S("<input type='text' class='common-map-view-zone-name-editable common-map-view-zone-name-text' maxlength='30'/>").val(a.name).css({"background-color":r,color:s});n.append(l),t._editableZoneNameMarker=i,l.on("blur",t._blurZoneNameInputEvt.bind(t)),l.on("input",function(){var e,t=(e=this,0==S(n).find("span").length&&(o=S("<span>").hide().appendTo(n)),(o=S(n).find("span").eq(0)).text(S(e).val()),o.width());S(this).css({width:t})}).trigger("input"),l.focus(),X.DomEvent.stop(e)},_blurZoneNameInputEvt:function(e){var t=this,i=t._editableZoneNameMarker,a=S(i.getElement()),n=S(e.target),o=n.val(),r=i.zonePolygon.zone,s=r.backgroundColor?r.backgroundColor:t.options.zoneColorOptions.Selected.color;n.remove(),o&&o!==r.name&&(o=o.substring(0,30),t._addChangedData(t._changedZones,r,"name"),r.name=o,t.trigger("change",{zones:[r]})),a.html(t._getZoneNameMarkerHtml(s,r.name)),t._editableZoneNameMarker=null},_dragStartZoneNameEvt:function(e){var t=e.target;t._beforeDragLatlng=t.getLatLng()},_dragEndZoneNameEvt:function(e){var t=e.target;this._isZoneDraggingEnd=!0,this._checkZoneNameMarkerBounds(t)},_checkZoneNameMarkerBounds:function(e){var t=this,i=t.getMaxBounds(),a=i.getNorth(),n=i.getWest(),o=i.getEast(),r=i.getSouth(),s=t._getMarkerBounds(e),l=s.getNorth(),d=s.getEast(),c=s.getWest(),u=s.getSouth();if(a<l||c<n||u<r||o<d)e.setLatLng(e._beforeDragLatlng),t._isZoneDraggingEnd&&(t._isZoneDraggingEnd=!1);else{var p=e.zonePolygon.zone;t._addChangedData(t._changedZones,p,"nameDisplayCoordinate");var h=t.map.project(e.getLatLng(),1);p.nameDisplayCoordinate=[h.x,h.y]}},_clickDeviceEvt:function(e){var t=this;if(t._isDraggingEnd)t._isDraggingEnd=!1;else{var i=e.currentTarget,a=t.getDataIdFromElement(i,"device");t._isEditableZone||t.selectDevice(a,null,!0)}},selectDevice:function(e,t,i){var a,n=this,o=n.getDeviceIcon(e);if(!o)return console.info("there is no rendered device icon id is "+e+" in map view. but data will be changed if data and isSelect parameter exist."),void((a=n.dataSource.get(e))&&null!=t&&(a.selected=t));if(a=o.device,null==t){var r=o.getElement();t=!S(r).hasClass("selected")}n._selectDeviceIcon(o,t);var s={devices:[a]},l=o.zonePolygon;(l=l&&(n.isAllSelectedDevicesInZone(l.zone.id)?n._selectZonePolygon(l,!0):n._selectZonePolygon(l,!1)))&&(s.zones=[l.zone]),i&&n.trigger("change",s)},_selectDeviceIcon:function(e,t){var i=e.getElement().classList,a=this.options,n=a.beaconImageName,o=e.device;if(e.isOnlyShow||o.selected!==t){var r=e.measuredDeviceIcon;r&&this._selectDeviceIcon(r,t),o.selected=t;var s,l,d,c=Q.getPositionType(o);if(t){if(i.contains("selected"))return;i.add("selected"),a.isRegisterView&&"Movable"==c&&(s=this._getIconUrl(n.Selected))}else{if(!i.contains("selected"))return;i.remove("selected"),a.isRegisterView&&"Movable"==c&&(s=this._getIconUrl(n.NotSelected))}s&&((d=(l=e.options.icon).options).shadowUrl=s,t?d.className+=" selected":d.className=d.className.replace("selected",""),l=X.icon(d),e.setIcon(l))}},_zoneFilter:function(e,t){if(e&&e.length)return e[0].foundation_space_zones_id==t||void 0},isAllSelectedDevicesInZone:function(e){var t,i=this.dataSource.data(),a=new C.data.Query(i).filter({field:"locations",operator:this._zoneFilter,value:e}).toArray(),n=a.length;if(n<1)return!1;for(t=0;t<n;t++)if(!a[t].selected)return!1;return!0},_zoomEndResizeElementEvt:function(){var e,t,i,a,n,o,r=this.map,s=this.element,l=this.options,d=r.getZoom(),c=s.find(".common-map-view-zone-name"),u=s.find(".common-map-view-device-text"),p=u.find(".device-info-text"),h=s.find(".common-map-view-device-icon");e=16,t=l.deviceIconSize,i=14,a=6,n=114,1<d?(e*=o=.2*(d-.6),t*=o,a=a*o+((i*=o)-14),n*=o):d<1&&(e/=o=.2*(3-d),t/=o,a=a/o-(14-(i/=o)),n/=o),this.svgDefsElem.find("pattern image").attr({width:t,height:t}),c.css({"margin-top":-e,"font-size":e}),h.css({"margin-left":-t/2,"margin-top":-t/2,width:t,height:t}),u.css({"margin-top":a}),p.css({"font-size":i,width:n})},_renderDevices:function(e,t){var i,a,n=this,o=e||this.dataSource,r=this.map,s=this.options;if(n._isMissingZone=!1,o instanceof C.data.DataSource){a=o.data();var l=o.filter(),d=o.sort();a=new C.data.Query(a),d&&(a=a.sort(d)),l&&(a=a.filter(l)),a=a.toArray()}else a=o;t||(n.deviceLayerGroup&&(n.deviceLayerGroup.remove(),n.deviceLayerGroup=null),n.deviceInfoLayerGroup&&(n.deviceInfoLayerGroup.remove(),n.deviceInfoLayerGroup=null)),t||(n.deviceLayerGroup=X.layerGroup(),n.deviceInfoLayerGroup=X.layerGroup()),n.deviceMaxX=0,n.deviceMaxY=0;var c,u=a.length;for(c=0;c<u;c++)i=a[c],n.renderDevice(i,t);n._updateMaxMapSize(n.deviceMaxX,n.deviceMaxY),n.deviceLayerGroup.setZIndex(3),n.deviceInfoLayerGroup.setZIndex(4);var p,h=n.zoneLayerGroup.getLayers();for(u=h.length,c=0;c<u;c++)(p=h[c])instanceof X.Polygon&&(n.isAllSelectedDevicesInZone(p.zone.id)?n._selectZonePolygon(p,!0):n._selectZonePolygon(p,!1));if(n.deviceLayerGroup.addTo(r),n.deviceInfoLayerGroup.addTo(r),s.hasLayerControl&&(n.layerControl.setActive(!1),s.showDeviceInfoCheckbox&&n.layerControl._clickDeviceInfoChkboxEvt(),s.showDeviceNameCheckbox&&n.layerControl._clickDeviceNameChkboxEvt(),s.showZoneNameCheckbox&&n.layerControl._clickZoneNameChkboxEvt(),!t&&s.showRegisteredGateway&&n.layerControl._clickRegisteredGatewayChkboxEvt()),s.hasLegendControl){n.legendControl.setActive(!1);var f=new C.data.Query(a).group({field:"type"}).toArray(),g=[];for(u=f.length,c=0;c<u;c++)g.push(f[c].value);for(u=(f=new C.data.Query(a).group({field:"mappedType"}).toArray()).length,c=0;c<u;c++)g.push(f[c].value);X.Util.setOptions(n.legendControl,{types:g})}if(s.isForcedShowDevice&&1==a.length){var m=n.deviceLayerGroup.getLayers();m[0]&&n.map.setView(m[0].getLatLng())}n._invalidateMapSize()},renderDevice:function(e,t){var i,a,n,o,r,s,l,d=this,c=d.options.isForcedShowDevice,u=d.deviceMaxX,p=d.deviceMaxY;if(("NotRegistered"!=e.registrationStatus||c)&&(i=d._getDeviceCoordinate(e)))return r=i.zonePolygon,u<(a=i.coordinate)[0]&&(d.deviceMaxX=a[0]),p<a[1]&&(d.deviceMaxY=a[1]),n=d.createDeviceIcon(e,a,r,!1,t),s=e.type,l=void 0!==e.assets_types_id,("Beacon"==s||l)&&("Fixed"==Q.getPositionType(e)||l)&&Q.getBeaconLocation(e,"Measured").geometry&&(i=d._getDeviceCoordinate(e,!0))&&(a=i.coordinate,r=i.zonePolygon,o=d.createDeviceIcon(e,a,r,!0,!0),n.measuredDeviceIcon=o),n},_assignZonePolygonToDeviceIcon:function(e){var t,i,a,n,o=this.deviceLayerGroup.getLayers(),r=o.length,s=e.zone,l=s.id;for(n=0;n<r;n++)t=(a=o[n]).device,(i=a.isMeasured?Q.getBeaconLocation(t,"Measured"):t.locations?t.locations[0]:null)&&i.foundation_space_zones_id==l?a.zonePolygon=e:!a.isMeasured&&s._isNew&&this.isLayerInPolygon(a,e)&&(a.zonePolygon=e,this._addChangedData(this._changedDevices,t,["locations[0].foundation_space_zones_id","locations[0].id"]),i.foundation_space_zones_id=l)},createDeviceIcon:function(e,t,i,a,n){var o=this._createDeviceIconMarker(e,t,a,n);return o.isMeasured=a,o.isOnlyShow=n,o.zonePolygon=i,o.addTo(this.deviceLayerGroup),o.infoMarker.addTo(this.deviceInfoLayerGroup),o},_getDeviceDisplayName:function(e){var t=void 0!==e.assets_types_id?e.assets_types_name:e.name;return e.subAssetType&&(t+=" / "+e.subAssetType),t},_getDeviceDisplayValue:function(e){var t=F.I18N,i=this.options,a=i.showDeviceValue,n=i.temperatureUnit,o=null,r=null,s="",l=e.type,d=e.temperatures,c=e.modes,u=e.mappedType;if(l&&a){if(-1!=l.indexOf("AirConditioner")){if(d&&0<d.length){if(o=(d=d[0]).current?d.current.toFixed(1):"-",r=d.desired?d.desired.toFixed(1):"-",c){var p=S.grep(c,function(e){return"AirConditioner.Indoor.General"==e.id&&"Fan"==e.mode});p&&p.length&&(r="-")}s=n}}else if(-1!=l.indexOf("ControlPoint")){var h=e.controlPoint;h&&void 0!==h.value&&u&&(o=h.value,s=-1!=u.indexOf("Temperature")?(d&&0<d.length&&(o=(d=d[0]).current?d.current.toFixed(1):"-"),n):"Meter.Gas"==u?Q.CHAR.Gas:"Meter.WattHour"==u?Q.CHAR.WattHour:"Meter.Water"==u?Q.CHAR.Water:-1==u.indexOf("Light")||-1==l.indexOf("AI")&&-1==l.indexOf("AO")?-1!=u.indexOf("Humidity")?Q.CHAR.Humidity:(-1!=u.indexOf("Motion")&&e.presences&&e.presences[0]&&(o=(o=e.presences[0].detected)?t.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"):t.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE")),""):(o=e.lights&&e.lights[0]&&e.lights[0].dimmingLevel?e.lights[0].dimmingLevel:o,Q.CHAR.Humidity))}else if("Meter.Gas"==l&&e.meters&&e.meters[0])o=e.meters[0].reading,s=Q.CHAR.Gas;else if("Meter.WattHour"==l&&e.meters&&e.meters[0])o=e.meters[0].reading,s=Q.CHAR.WattHour;else if("Meter.Water"==l&&e.meters&&e.meters[0])o=e.meters[0].reading,s=Q.CHAR.Water;else if(-1!=l.indexOf("Humidity")&&e.humidities&&e.humidities[0])o=e.humidities[0].current,s=Q.CHAR.Humidity;else if(-1!=l.indexOf("Light")&&e.lights&&e.lights[0])o=e.lights[0].dimmingLevel,s=Q.CHAR.Humidity;else if(-1!=l.indexOf("Motion")&&e.presences&&e.presences[0]){var f=e.presences;o=f&&f[0]?(o=(f=f[0]).detected)?t.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_PRESENCE"):t.prop("FACILITY_DEVICE_MOTION_SENSOR_PRESENCE_ABSENCE"):"-",s=""}null!=o&&(o=Q.convertNumberFormat(o),o+=s),null!=r&&(r=Q.convertNumberFormat(r),r+=s)}return{current:o,desired:r}},_getDeviceCoordinate:function(e,t){var i,a,n,o,r,s,l=this.options,d=F.MAIN_WINDOW,c=l.floor?l.floor:d.getCurrentFloor().floor,u=e.locations,p=e.type,h=void 0!==e.assets_types_id?e.location:null,f=l.isForcedShowDevice,g=c.id;if(u&&0<u.length||h?(i=h&&!t?"Movable"==e.mobilityType?(a=(u=Q.getBeaconLocation(e,"Measured")).geometry,n=u.foundation_space_zones_id,u.foundation_space_floors_id):(a=h.geometry,n=h.foundation_space_zones_id,h.foundation_space_floors_id):p&&"Beacon"==p||void 0!==e.assets_types_id?(n=(a=t?(u=Q.getBeaconLocation(e,"Measured")).geometry:(s=Q.getPositionType(e),(u=Q.getBeaconTypeLocation(e,s)).geometry),u.foundation_space_zones_id),u.foundation_space_floors_id):(a=u[0].geometry,n=u[0].foundation_space_zones_id,u[0].foundation_space_floors_id),n&&(o=this.getZonePolygon(n)),a?(r=a.coordinates)||(r=[],r=o?o.originalCenterCoordinate:this._getCenterCoordinate()):r=o?o.originalCenterCoordinate:this._getCenterCoordinate()):r=this._getCenterCoordinate(),n&&!o)if(f)r=this._getCenterCoordinate();else if(g!=i||this._isMissingZone){if(g!=i)return null}else this._isMissingZone=!0;return{coordinate:r,zonePolygon:o}},_createDeviceIconMarker:function(e,t,i,a){var n,o,r,s,l,d,c,u,p=this,h=p.options,f=e.type,g=e.modes,m=e.operations,v=e.nameDisplayCoordinate,_=h.deviceModeImageName,b=h.deviceTypeImageName,C=h.assetTypeImageName,k=h.isRegisterView,w=h.deviceIconSize,D=h.measuredDeviceIconSize,y=h.beaconImageName,I=h.showDeviceValue,S=h.showDeviceText,x=h.canDragDeviceIcon,A=void 0!==e.assets_types_id,O=e.id,E=Q.getPositionType(e),T=Q.getStatus(e),M=e.selected,L=p._getDeviceDisplayName(e),N=p._getDeviceDisplayValue(e),F=N.current,R=N.desired;c=t instanceof X.LatLng?t:(l=t[0]+p._imagePosX,d=t[1]+p._imagePosY,p.map.unproject([l,d],1)),u=v?(l=v[0]+p._imagePosX,d=v[1]+p._imagePosY,p.map.unproject([l,d],1)):c;var B,P="device-id-"+O;M&&(P+=" selected"),B=i?(P+=" measured",.5):1,"Movable"==E?(P+=" movable",k?s=M?p._getIconUrl(y.Selected):p._getIconUrl(y.NotSelected):T&&(s=p._getIconUrl(y[T]))):k?P+=" registered":T&&(P+=" "+(T=T.toLowerCase().replace(/\./gi,"-"))),g&&g[0]&&!k?(n=Q.getDisplayMode(g,m))&&_[n]&&(r=p._getIconUrl(_[n])):(k||A||!k&&-1===f.indexOf("AirConditioner."))&&(n=Q.getDisplayClassType(e),(o=A?C[n]?C[n]:C.etc:b[n])&&(r=p._getIconUrl(o))),r=r||p._getIconUrl();var G=[w/2,w/2],V=[G[0],G[1]+3],H=X.icon({iconUrl:r,iconSize:[w,w],iconAnchor:G,shadowUrl:s,shadowAnchor:V,shadowSize:D,className:"common-map-view-device-icon "+P}),z=!i&&!a&&x,W=i?-10:3,U=i?-10:4,Z="";I?Z=K(O,L,A,F,R):S&&(Z=K(O,L,A));var Y=X.marker(c,{icon:H,draggable:z,zIndexOffset:W}),j=X.divIcon({html:Z,className:"common-map-view-device-text "+P,iconAnchor:[60,-w/2+3]}),q=X.marker(u,{icon:j,draggable:z,zIndexOffset:U,opacity:B});return Y.device=e,(Y.infoMarker=q).deviceIconMarker=Y,x&&(Y.on("dragstart",p._dragStartDeviceIconMarkerEvt.bind(p)),Y.on("drag",p._dragDeviceIconMarkerEvt.bind(p)),Y.on("dragend",p._dragEndDeviceIconMarkerEvt.bind(p)),q.on("dragstart",p._dragStartDeviceInfoEvt.bind(p)),q.on("dragend",p._dragEndDeviceInfoEvt.bind(p))),Y},_dragStartDeviceIconMarkerEvt:function(e){var t,i=e.target,a=i.infoMarker,n=i.getElement();n.classList.contains("selected")||(t=this.getDataIdFromElement(n,"device"),this.selectDevice(t,!0,!0)),i._beforeDragLatlng=i.getLatLng(),a._beforeDragLatlng=a.getLatLng(),this._selectedLayersBeforeDrag=[];var o,r,s=this.deviceLayerGroup.getLayers(),l=s.length;for(r=0;r<l;r++)(o=s[r])instanceof X.Marker&&o.getElement().classList.contains("selected")&&!o.isOnlyShow&&(o._beforeDragLatlng=o.getLatLng(),o.infoMarker._beforeDragLatlng=o.infoMarker.getLatLng(),this._selectedLayersBeforeDrag.push(o))},_dragEndDeviceIconMarkerEvt:function(e){var t,i,a,n,o,r,s,l,d,c,u,p,h,f,g,m,v,_=this,b=e.target,C=_.map,k=F.MAIN_WINDOW,w=k.getCurrentFloor().building.name,D=k.getCurrentFloorName(),y=_._selectedLayersBeforeDrag,I=_.zoneLayerGroup.getLayers(),S=_.getMaxBounds(),x=y.length,A=I.length,O=S.getNorth(),E=S.getWest(),T=S.getEast(),M=S.getSouth(),L=[];for(_._isDraggingEnd=!0,r=0;r<x;r++)if(a=(i=y[r]).infoMarker,f=(h=i.device).locations,m=h.nameDisplayCoordinate,f&&f[0]?f[0].geometry||(f[0].geometry={type:"Point",coordinates:[]}):(h.locations=[{id:"Fixed",geometry:{type:"Point",coordinates:[]}}],f=h.locations),i instanceof X.Marker)if(n=i.getLatLng(),d=(l=_._getDeviceIconMarkerBounds(n)).north,u=l.east,c=l.west,p=l.south,O<d||c<E||p<M||T<u)i.setLatLng(i._beforeDragLatlng),a.setLatLng(i._beforeDragLatlng),_._isDraggingEnd&&i===b&&(_._isDraggingEnd=!1);else{for(v={id:h.id,locations:[{id:"Fixed",geometry:{type:"Point"}}]},f=f[0],g=v.locations[0],s=0;s<A;s++)(o=I[s])instanceof X.Polygon&&_.isLayerInPolygon(i,o)&&(f.foundation_space_zones_id=g.foundation_space_zones_id=o.zone.id,t=o.zone.name);n=i.getLatLng(),n=C.project(n,1),f.description=w+", "+D,g.foundation_space_zones_id?f.description+=","+t:f.foundation_space_zones_id=g.foundation_space_zones_id=0,f.geometry.coordinates=g.geometry.coordinates=[n.x,n.y],m||(h.nameDisplayCoordinate=f.geometry.coordinates),_._checkDeviceInfoMarkerBounds(a)&&(v.nameDisplayCoordinate=h.nameDisplayCoordinate),L.push(v)}delete b._draggingLatLng,_._selectedLayersBeforeDrag.length=0,_._selectedLayersBeforeDrag=null,_.trigger("dragend",{devices:L})},_dragDeviceIconMarkerEvt:function(e){var t,i,a=e.target,n=e.latlng,o=e.oldLatLng;a.setLatLng(e.latlng),a._draggingLatLng?(t=n.lat-a._draggingLatLng.lat,i=n.lng-a._draggingLatLng.lng,a._draggingLatLng=n):(t=(a._draggingLatLng=n).lat-o.lat,i=n.lng-o.lng);var r,s,l,d=this._selectedLayersBeforeDrag;r=a.infoMarker.getLatLng(),s=X.latLng(r.lat+t,r.lng+i),a.infoMarker.setLatLng(s);var c,u=d.length;for(c=0;c<u;c++)(l=d[c])instanceof X.Marker&&l!==a&&(r=l.getLatLng(),s=X.latLng(r.lat+t,r.lng+i),l.setLatLng(s),r=l.infoMarker.getLatLng(),s=X.latLng(r.lat+t,r.lng+i),l.infoMarker.setLatLng(s))},_dragStartDeviceInfoEvt:function(e){var t=e.target;t._beforeDragLatlng=t.getLatLng()},_dragEndDeviceInfoEvt:function(e){var t,i,a=e.target;this._isDraggingEnd=!0,this._checkDeviceInfoMarkerBounds(a)&&(i={id:(t=a.deviceIconMarker.device).id,nameDisplayCoordinate:t.nameDisplayCoordinate},this.trigger("dragend",{devices:[i]}))},_checkDeviceInfoMarkerBounds:function(e){var t=this.getMaxBounds(),i=t.getNorth(),a=t.getWest(),n=t.getEast(),o=t.getSouth(),r=this._getMarkerBounds(e),s=r.getNorth(),l=r.getEast(),d=r.getWest(),c=r.getSouth();if(i<s||d<a||c<o||n<l)return e.setLatLng(e._beforeDragLatlng),this._isDraggingEnd&&(this._isDraggingEnd=!1),!1;var u=e.deviceIconMarker.device,p=this.map.project(e.getLatLng(),1);return u.nameDisplayCoordinate=[p.x,p.y],!0},isLayerInPolygon:function(e,t){var i=t.getLatLngs();i=i[0];for(var a=e instanceof X.Layer?e.getLatLng():e,n=a.lat,o=a.lng,r=!1,s=0,l=i.length-1;s<i.length;l=s++){var d=i[s].lat,c=i[s].lng,u=i[l].lat,p=i[l].lng;o<c!=o<p&&n<(u-d)*(o-c)/(p-c)+d&&(r=!r)}return r},getDataIdFromElement:function(e,t){var i,a=e.classList,n=a.length;for(t=t||"device",t+="-id-",i=0;i<n;i++)if(-1!=a[i].indexOf(t))return a[i].replace(t,"");return null},_getIconUrl:function(e){return Q.addBuildDateQuery("../../src/main/resources/static-dev/images/icon/"+e+".png")},_getDeviceIconMarkerBounds:function(e){var t,i,a=this.map,n=this.options.deviceIconSize,o=a.getZoom(),r=n/2,s=a.project(e,o);t=s.x-r,i=s.y;var l=a.unproject([t,i],o);t=s.x+r,i=s.y;var d=a.unproject([t,i],o);t=s.x,i=s.y-r;var c=a.unproject([t,i],o);t=s.x,i=s.y+r;var u=a.unproject([t,i],o);return{west:l.lng,east:d.lng,north:c.lat,south:u.lat}},_getMarkerBounds:function(e){var t=this.map,i=e.getLatLng(),a=t.project(i,t.getZoom()),n=e.getElement(),o=n.offsetWidth,r=n.offsetHeight,s=[a.x,a.y+r],l=[a.x+o,a.y];return s=t.unproject(s,t.getZoom()),l=t.unproject(l,t.getZoom()),X.latLngBounds(s,l)},_createDeviceCircle:function(e,t,i){var a,n=this.options,o=n.deviceIconRadius,r=n.movableBeaconColorOptions,s=n.showDeviceValue,l=n.showDeviceText,d=n.isRegisterView,c=e.id,u=Q.getPositionType(e),p=Q.getStatus(e),h=e.selected,f=void 0!==e.assets_types_id,g=this._getDeviceDisplayName(e),m=this._getDeviceDisplayValue(e),v=m.current,_=m.desired,b="device-id-"+c,C=this.map.getZoom();a=t instanceof X.LatLng?t:this.map.unproject([t[0],t[1]],C);var k,w=i?.5:1,D={radius:o,fillOpacity:w,className:"common-map-view-device-circle "+b,interactive:!0};h?S.extend(D,n.deviceStrokeColorOptions.Selected):S.extend(D,n.deviceStrokeColorOptions.NotSelected),d?k=h?"Movable"==u?n.movableBeaconColorOptions.Selected:n.deviceColorOptions.Selected:"Movable"==u?n.movableBeaconColorOptions.NotSelected:n.deviceColorOptions.NotSelected:p&&(k="Movable"==u?r[p]?r[p]:r["Normal.On"]:n.deviceColorOptions[p]?n.deviceColorOptions[p]:n.deviceColorOptions["Normal.On"]),D.fillColor=k;var y="";s?y=K(c,g,f,v,_):l&&(y=K(c,g,f));var I=X.circle(a,D);return I.bindTooltip(y,{direction:"bottom",permanent:!0,offset:[0,8],interactive:!0,className:"common-map-view-device-text "+b,opacity:w}),I.device=e,I},removeDevice:function(e){var t=this.getDeviceIcon(e.id);return t&&this._removeDeviceIcon(t),!1},_removeDeviceIcon:function(e){this.deviceLayerGroup.removeLayer(e),e.infoMarker&&(this.deviceInfoLayerGroup.removeLayer(e.infoMarker),e.infoMarker.remove()),e.measuredDeviceIcon&&(this.deviceLayerGroup.removeLayer(e.measuredDeviceIcon),e.measuredDeviceIcon.remove()),e.remove()},removeZone:function(e){var t=e.id,i=this.getZonePolygon(t);return i&&(this._removeZoneIdInDevices(i,!0),this._removeZonePolygon(i)),!1},_removeZonePolygon:function(e){e.transform&&e.transform.disable(),this.zoneLayerGroup.removeLayer(e),e.zoneNameMarker&&(this.zoneLayerGroup.removeLayer(e.zoneNameMarker),e.zoneNameMarker.remove()),e.remove()},getDeviceIcon:function(e){var t,i,a=this.deviceLayerGroup.getLayers(),n=a.length;for(i=0;i<n;i++)if((t=a[i])instanceof X.Marker&&t.device.id==e)return t;return null},getZonePolygon:function(e){var t,i,a=this.zoneLayerGroup.getLayers(),n=a.length;for(i=0;i<n;i++)if((t=a[i])instanceof X.Polygon&&t.zone.id==e)return t;return null},_getCenterInMapView:function(){return[this.maxWidth/2,this.maxHeight/2]},_getCenterCoordinate:function(){var e=this._getCenterInMapView();return e[0]=e[0]-this._imagePosX,e[1]=e[1]-this._imagePosY,e},moveCenterView:function(){var e=this._getCenterInMapView();e=this.map.unproject(e,1),this.map.setView(e,1)},_applyImagePositionToCoordinate:function(e){var t,i,a=(e=e[0]).length;for(i=0;i<a;i++)(t=e[i])[0]=t[0]+this._imagePosX,t[1]=t[1]+this._imagePosY},_unprojectCoordinatesForRender:function(e){var t,i,a,n=this.map,o=[],r=(e=e[0]).length;for(a=0;a<r;a++)i=e[a],t=n.unproject(i,1),o.push(t);return o},_projectCoordinatesForModel:function(e){var t,i,a,n=this.map,o=[],r=(e=e[0]).length;for(a=0;a<r;a++)i=e[a],t=n.project(i,1),o.push([t.x,t.y]);return[o]},deviceDragDrop:function(e){var M=this,t=M.element;M.element.data("uiDraggable")&&M.element.data("uiDraggable").destroy();if(e=e||{},S.extend({deviceIconElem:null,selectedRows:null,selectedData:null},e),e.selectedRows&&e.deviceIconElem&&e.selectedData){var i=e.deviceIconElem,L=e.selectedRows,N=e.selectedData,a=i.clone();a.css("margin",0),a=a.get(0).outerHTML,S(L).draggable({revert:function(e){var t=S(this);return t.hasClass("is-revert")?(t.removeClass("is-revert"),!0):!e},appendTo:"body",containment:"#main-contents",revertDuration:200,helper:"clone",zIndex:100,cursor:"move",start:function(e,t){t.helper.html(a)}}),t.droppable({drop:function(e,t){var i=t.offset.top,a=t.offset.left,n=M.element.offset(),o=M.map.getPixelBounds().min,r=n.top,s=n.left,l=o.x,d=o.y,c=M.map.getZoom(),u=a-(s-l)+M.options.deviceIconSize/2,p=i-(r-d)+M.options.deviceIconSize/2,h=M.map.unproject([u,p],c);if(!M.getMaxBounds().contains(h))return t.draggable.addClass("is-revert"),!1;var f,g,m,v,_=M.createDeviceIcon(N[0],h),b=M.zoneLayerGroup.getLayers(),C=b.length;for(g=0;g<C;g++)if((f=b[g])instanceof X.Polygon&&M.isLayerInPolygon(_,f)){m=f.zone.id,v=f.zone.name;break}var k=F.MAIN_WINDOW,w=k.getCurrentFloor(),D=w.building.id,y=w.building.name,I=w.floor.id,S=k.getCurrentFloorName(),x=M.map.project(h,1);u=x.x,p=x.y;var A=[{id:"Fixed"}];A[0].foundation_space_buildings_id=D,A[0].foundation_space_floors_id=I,A[0].geometry={type:"Point",coordinates:[u,p]},A[0].description=y+", "+S,A[0].foundation_space_zones_id=m||0,v&&(A[0].description+=", "+v),C=N.length;var O,E=[];for(g=0;g<C;g++)O=N[g],E.push({id:O.id,locations:A,registrationStatus:"Registered"});var T={devices:E,selectedData:N,selectedRows:L,deviceIcon:_};M.trigger("drop",T)}})}else console.error("Common Map View needs deviceIconElem, selectedRows, selectedData options for drag & drop")},getMaxBounds:function(e){e=e||1;var t=this.map.unproject([0,this.maxHeight],e),i=this.map.unproject([this.maxWidth,0],e);return new X.LatLngBounds(t,i)},setFloor:function(e){this.options.floor=e,this._setMapImage()},setDataSource:function(e){self._isDraggingEnd=!1,this.options.dataSource=e,this._createDeviceDataSource(e),this._renderDevices()},setZoneDataSource:function(e){self._isZoneDraggingEnd=!1,this.setEditableZone(!1),this.options.zoneDataSource=e,this._createZoneDataSource(e),this._renderZones()},setHeatMapDataSource:function(e){this.options.heatMapDataSource=e,this._createHeatMapDataSource(e),this._renderHeatMap()},getSelectedData:function(){var e,t=[];return this.dataSource&&(e=this.dataSource.data(),t=(t=new C.data.Query(e).filter({field:"selected",operator:"eq",value:!0})).toArray()),t},getSelectedZone:function(){var e,t=[];return this.zoneDataSource&&(e=this.zoneDataSource.data(),t=(t=new C.data.Query(e).filter({field:"selected",operator:"eq",value:!0})).toArray()),t},getUpdatedZones:function(){var e,t,i,a,n,o,r,s,l,d,c,u,p=[],h=[],f=[],g=this._changedZones?this._changedZones:new C.data.DataSource({data:[]}),m=this.zoneDataSource,v=g.data(),_=v.length,b=F.MAIN_WINDOW;for(o=0;o<_;o++)if(t=(i=v[o]).id,e=m.get(t))if(e._isNew)delete(e=e.toJSON())._isNew,c=(d=b.getCurrentFloor()).floor.id,u=d.building.id,e.foundation_space_buildings_id=u,e.foundation_space_floors_id=c,h.push(e);else{for(s=(n=g._changedFields[t]).length,l={id:t},r=0;r<s;r++)a=n[r],Q.setter(l,a,e.get(a));f.push(l)}else i._isNew||(e=i.toJSON(),p.push({id:t}));return{deleted:p,created:h,updated:f}},getUpdatedDevices:function(){var e,t,i,a,n,o,r,s,l=[],d=this._changedDevices?this._changedDevices:new C.data.DataSource({data:[]}),c=d.data(),u=this.dataSource,p=c.length;for(o=0;o<p;o++)if(t=c[o].id,e=u.get(t)){for(s=(a=d._changedFields[t]).length,n={id:t},r=0;r<s;r++)i=a[r],Q.setter(n,i,e.get(i));l.push(n)}return{updated:l}},selectAll:function(){this._selectAll(!0)},unselectAll:function(){this._selectAll(!1)},_selectAll:function(e){var t,i,a,n=this.deviceLayerGroup.getLayers(),o=this.zoneLayerGroup.getLayers(),r=n.length;for(a=0;a<r;a++)(i=n[a])instanceof X.Marker&&this._selectDeviceIcon(i,e);for(r=o.length,a=0;a<r;a++)(t=o[a])instanceof X.Polygon&&this._selectZonePolygon(t,e)},clearEditableZone:function(){var e,t,i,a=this.zoneLayerGroup.getLayers(),n=a.length;for(t=0;t<n;t++)i=(e=a[t]).getElement().classList,e instanceof X.Polygon&&i.contains("editable")&&this._editableZone(e,!1)},setEditableZone:function(e){var t=this;t._isEditableZone=e,t._changedDevices||(t._changedDevices=new C.data.DataSource({data:[]})),t._changedZones||(t._changedZones=new C.data.DataSource({data:[]})),t.unselectAll(),t.clearEditableZone(),t._renderZones(),t.colorPickerControl&&(e?t.colorPickerControl.show():(t.colorPickerControl.hide(),t.colorPickerControl.active(!1),t.colorPickerControl.disable(),t.colorPickerControl.colorPicker.close(),t.clearEditableZone(),t._changedDevices=null,t._changedZones=null))},cancel:function(){var e=this;e._isEditableZone&&(e._isCancelChanges=!0,e.unselectAll(),e._cancelChangesInDataSource(e._changedZones,e.zoneDataSource),e._cancelChangesInDataSource(e._changedDevices,e.dataSource),e.zoneDataSource.cancelChanges(),e.dataSource.cancelChanges(),e._isCancelChanges=!1)},_cancelChangesInDataSource:function(e,t){var i,a,n,o,r,s,l,d,c=e.data(),u=c.length;for(s=0;s<u;s++)if(i=(n=c[s]).id,a=t.get(i))for(d=(r=e._changedFields[i]).length,l=0;l<d;l++)o=r[l],Q.setter(a,o,n.get(o))},isIntersectZonePolygons:function(){var e,t,i,a,n=this.zoneLayerGroup.getLayers(),o=n.length,r=!1;for(i=0;i<o;i++)if((e=n[i])instanceof X.Polygon)for(a=i+1;a<o;a++)if((t=n[a])instanceof X.Polygon&&this.isIntersectPolygon(e,t))return r=!0;return r},getCenterZoneId:function(){var e=this._getCenterCoordinate();e=this.map.unproject(e,1);var t,i,a=this.zoneLayerGroup.getLayers(),n=a.length;for(i=0;i<n;i++)if((t=a[i])instanceof X.Polygon&&this.isLayerInPolygon(e,t))return t.zone.id;return null},getCenter:function(){return this._getCenterInMapView()},isIntersectPolygon:function(e,t){for(var i=e.getLatLngs()[0],a=t.getLatLngs()[0],n=i.length,o=0;o<n;o++){var r=i[o],s=i[(o+1)%n];if(this.isIntersectLinePolygon(r,s,a))return!0}return!1},isIntersectLinePolygon:function(e,t,i){for(var a=i.length,n=0;n<a;n++){var o=i[n],r=i[(n+1)%a];if(this.isIntersectLine(e,t,o,r))return!0}return!1},isIntersectLine:function(e,t,i,a,n){var o=(a.lng-i.lng)*(e.lat-i.lat)-(a.lat-i.lat)*(e.lng-i.lng),r=(t.lng-e.lng)*(e.lat-i.lat)-(t.lat-e.lat)*(e.lng-i.lng),s=(a.lat-i.lat)*(t.lng-e.lng)-(a.lng-i.lng)*(t.lat-e.lat),l=[];if(0!=s){var d=o/s,c=r/s;if(0<=d&&d<=1&&0<=c&&c<=1)return l.push(X.latLng(e.lat+d*(t.lat-e.lat),e.lng+d*(t.lng-e.lng))),l}else if(n)return 0==o||0==r?"coincident":"parallel";return!1},isIntersectLineRectangle:function(e,t,i){var a=i.getNorthWest(),n=i.getSouthEast(),o=i.getNorthEast(),r=i.getSouthWest(),s=[],l=this.isIntersectLine(a,o,e,t);l=l||[];var d=this.isIntersectLine(o,n,e,t);d=d||[];var c=this.isIntersectLine(n,r,e,t);c=c||[];var u=this.isIntersectLine(r,a,e,t);return u=u||[],s=s.concat(l).concat(d).concat(c).concat(u)},setOptions:function(e){1==e.canDragDeviceIcon?e.isMonitoringFloorImage=!1:0==e.canDragDeviceIcon&&(e.isMonitoringFloorImage=!0),C.ui.Widget.fn.setOptions.call(this,e)},destroy:function(){S(F).off("changeSidebarState",this._resizeSidebarEvt),this._resizeSidebarEvt=null,this.map.remove(),this.dataSource=new C.data.DataSource({data:[]}),this.zoneDataSource=new C.data.DataSource({data:[]}),this.heatMapDataSource=new C.data.DataSource({data:[]}),C.ui.Widget.fn.destroy.call(this)}});C.ui.plugin(t)}(window,jQuery),function(e,m){"use strict";var g=e.kendo,s=g.ui.Widget,t=s.extend({options:{name:"DeviceTabGroupGrid",hasNewDataSource:!0,hasSelectedModel:!1,setSelectedAttribute:!1,height:"100%"},events:["onselect","change","onDetail","beforeActiveTab","activateTab"],init:function(e,t){t=m.extend({},this.options,t),s.fn.init.call(this,e,t);var i,a=this.options.dataSource;if(a instanceof g.data.DataSource?this._createDataSource(a):(this.options.dataSource=new g.data.DataSource({data:this.options.dataSource}),this.dataSource=a=this.options.dataSource),this.tabContainer=m("<div/>").addClass("map-panel-list-tabs-container"),this._createTabElem(),this.tabContainer.html(this.tabListElem),this.listContainer=m("<div/>").addClass("map-panel-list-container"),this._createList(),"hybrid"==t.type){var n,o=this.tabGrids.length;for(n=0;n<o;n++)i=this.tabGrids[n],this.listContainer.append(i.element)}else i=this.grid,this.listContainer.append(i.element);this._attachTabClickEvt(),this._attachSelectEvt(),this._attachDetailEvt();var r=this.options.hideTab;this.hideTab(r),this.selectTab(0,!1,!0),this.element.append(this.tabContainer),this.element.append(this.listContainer)},selectTab:function(e,t,i){if(e!=this.selectedIndex||t){var a=this.tabListElem.find("li:eq("+e+")");a.siblings(".map-panel-list-tab").removeClass("active"),a.addClass("active");var n,o=this.options.filterTab[e],r=o.listOptions,s=r.filter,l=r.group,d=r.sort,c=o.hideHeader;if(s=s||(this.dataSource.filter()?this.dataSource.filter():[]),l=l||(this.dataSource.group()?this.dataSource.group():[]),d=d||(this.dataSource.sort()?this.dataSource.sort():[]),"hybrid"==this.options.type){if(void 0===this.selectedIndex){var u,p=this.tabGrids.length;for(u=0;u<p;u++)this.tabGrids[u].element.hide()}else(n=this.tabGrids[this.selectedIndex]).element.hide();(n=this.tabGrids[e]).element.show(),"treeList"!=o.listStyle&&n.dataSource.group(l),n.dataSource.filter(s),n.dataSource.sort(d),n.showColumn(0),this.dataSource=n.dataSource}else void 0!==this.selectedIndex&&this.grid.hideColumn(this.selectedIndex),this.dataSource.filter(s),this.dataSource.group(l),this.dataSource.sort(d),this.grid.showColumn(e);this.hideHeader(e,c),this.selectedIndex=e,this.updateHeaderTemplate(),i||this.trigger("activateTab",{index:e})}},applyTreeFilter:function(e,t,i){if(0<t.length||t.filters&&0<t.filters.length){var a={logic:"or",filters:[{field:"treeGroup",operator:"eq",value:!0},{field:"isDummy",operator:"eq",value:!0}]};a.filters.push(t),i&&a.filters.push(i),e.filter(a)}},hideTab:function(e){e?(this.tabContainer.hide(),this.listContainer.addClass("no-tab")):(this.tabContainer.show(),this.listContainer.removeClass("no-tab"))},hideHeader:function(e,t){var i,a,n;a="hybrid"==this.options.type?((n=this.tabGrids[e]).element.find(".k-grid-header"),i=n.element.find(".k-grid-header"),n.element.find(".k-grid-content")):(i=this.grid.element.find(".k-grid-header"),this.grid.element.find(".k-grid-content")),t?(i.hide(),a.addClass("no-header")):(i.show(),a.removeClass("no-header"))},_createTabElem:function(){this.tabListElem=m("<ul/>").addClass("map-panel-list-tabs");var e,t,i,a,n,o=this.options.filterTab,r=this.options.tabViewModel?this.options.tabViewModel:[];if(this.tabViewModel=r||[],o)for(t=o.length,e=0;e<t;e++)i=o[e],a=r[e],n=m("<li data-bind='events:{ click : click }'/>").addClass("map-panel-list-tab"),i.template&&n.append(this._renderTemplate(i.template)),a&&(a=r[e]=g.observable(a),g.bind(n,a)),i.hidden||this.tabListElem.append(n);return this.tabListElem},_createList:function(){var e,t,i,a,n=this.options.filterTab,o=[],r=this.options.hasSelectedModel,s=this.options.setSelectedAttribute,l=this.options.selectable,d=this.options.type,c=this.options.height,u="multiple row";void 0!==l&&(u=l);var p,h={columns:o,hasSelectedModel:r,setSelectedAttribute:s,dataSource:this.dataSource,height:c,selectable:u,scrollable:!0,sortable:!1,filterable:!1,pageable:!1};if("hybrid"==d){if(n)for(t=n.length,this.tabGrids||(this.tabGrids=[]),e=0;e<t;e++)if(o=[],(a=(i=n[e]).listOptions.column)&&(m.isArray(a)?o=o.concat(a):o.push(a)),p=i.widgetOptions?m.extend({},h,i.widgetOptions,{columns:o}):m.extend({},h,{columns:o}),"treeList"==i.listStyle){var f=this.createTreeListDataSource(this.dataSource,i);p.dataSource=f,p.isGroupListMode=!0;var g=m("<div/>").kendoTreeList(p).data("kendoTreeList");g.element.addClass("device-tab-group-grid-tree-list"),this.tabGrids.push(g)}else this.tabGrids.push(m("<div/>").kendoGrid(p).data("kendoGrid"))}else if(n){for(t=n.length,e=0;e<t;e++)(a=(i=n[e]).listOptions.column)&&(a.hidden=!0,o.push(a));h.columns=o,u="multiple row",void 0!==l&&(u=l),i.widgetOptions&&(h=m.extend({},h,i.widgetOptions)),this.grid=m("<div/>").kendoGrid(h).data("kendoGrid")}},_attachTabClickEvt:function(){var t=this;this.tabContainer.on("click",".map-panel-list-tab",function(){var e=m(this).index();t.selectTab(e)})},_attachSelectEvt:function(){var t=this;if("hybrid"==this.options.type){var e,i=this.tabGrids.length;for(e=0;e<i;e++)this.tabGrids[e].bind("change",function(e){t.trigger("change",e)}),this.tabGrids[e].bind("expand",function(e){t.trigger("expand",e)})}else this.grid.bind("change",function(e){t.trigger("change",e)})},_attachDetailEvt:function(){var i=this;"hybrid"==this.options.type?this.element.on("click",".device-map-panel-list-item .ic.ic-info",function(){var e=m(this).data("id"),t=i.tabGrids[i.selectedIndex].dataSource.get(e);i.trigger("onDetail",{item:t})}):this.grid.element.on("click",".device-map-panel-list-item .ic.ic-info",function(){var e=m(this).closest("tr").data("uid"),t=i.dataSource.getByUid(e);i.trigger("onDetail",{item:t})})},select:function(e){return("hybrid"==this.options.type?this.tabGrids[this.selectedIndex]:this.grid).select(e)},selectByData:function(e){("hybrid"==this.options.type?this.tabGrids[this.selectedIndex]:this.grid).selectByData(e)},selectAll:function(){var e;if(e="hybrid"==this.options.type?this.tabGrids[this.selectedIndex]:this.grid,this.options.hasSelectedModel){var t=e.dataSource,i=t.data(),a=t.filter(),n=new g.data.Query(i);a&&(n=n.filter(a));var o,r=n.toArray(),s=r.length;for(o=0;o<s;o++)r[o].hasChildren||r[o].treeGroup?r[o].hasCheckedChild=!0:r[o].selected=!0;t.fetch()}else e.element.find("tr").addClass("k-state-selected")},unselectAll:function(){var e;if(e="hybrid"==this.options.type?this.tabGrids[this.selectedIndex]:this.grid,this.options.hasSelectedModel){var t,i=e.dataSource,a=i.data(),n=a.length;for(t=0;t<n;t++)a[t].hasChildren||a[t].treeGroup?a[t].hasCheckedChild=!1:a[t].selected=!1;i.fetch()}e.element.find("tr").removeClass("k-state-selected")},dataItem:function(e){return("hybrid"==this.options.type?this.tabGrids[this.selectedIndex]:this.grid).dataItem(e)},_renderTemplate:function(e,t){if(m.isFunction(e))return e(t);var i=g.template(e);return i=i(t=t||{})},_createDataSource:function(e){var t,i,a,n=this.options.hasNewDataSource,o=this.options.hasSelectedModel;if(n?(t=(t=e.data()).toJSON(),this.dataSource=this.options.dataSource=new g.data.DataSource({data:t})):this.dataSource=e,o)for(a=(t=this.dataSource.data()).length,i=0;i<a;i++)void 0===t[i].selected&&(t[i].selected=!1)},createGroupToTreeDs:function(e,t,i,a,n,o){t=t||null,null==i&&(i=0);var r,s,l,d,c,u,p,h=e.length,f=[];for(r=0;r<h;r++)if((d={}).field=e[r].field,d.value=e[r].value,d.aggregates=e[r].aggregates,d.parent_id=t,d.parent_value=o,d.id=g.guid(),d.level=i,(!this.lastLevel||this.lastLevel<i)&&(this.lastLevel=i),d.treeGroup=!0,f.push(d),e[r].hasSubgroups)l=this.createGroupToTreeDs(e[r].items,d.id,i+1,a,n,d.value),f=f.concat(l);else{if(a){f.push({name:"-",id:g.guid(),parent_id:d.id,isDummy:!0,parent_value:d.value});continue}if(n&&(n.field!=d.field||n.value!=d.value)){f.push({name:"-",id:g.guid(),parent_id:d.id,isDummy:!0,parent_value:d.value});continue}for(u=(s=e[r].items).length,c=0;c<u;c++)(p=s[c]).parent_id=d.id,p instanceof g.data.ObservableObject&&(p=p.toJSON()),f.push(p)}return f},createTreeListDataSource:function(e,t,i,a){var n=(t=t||this.options.filterTab[this.selectedIndex]).listOptions,o=n.group,r=e.data(),s=n.filter;s=s||e.filter();var l=n.sort;l=l||e.sort();var d=new g.data.Query(r);s&&(d=d.filter(s)),l&&(d=d.sort(l)),o&&(d=d.group(o));var c=d.toArray(),u=this.createGroupToTreeDs(c,null,null,i,a,null);return new g.data.TreeListDataSource({data:u,schema:{model:{id:"id",parentId:"parent_id",fields:{parent_id:{type:"string",nullable:!0}}}}})},setDataSourceExpand:function(e,t,i){},expandFromModel:function(e,t){var i,a,n=this.selectedIndex,o=this.tabGrids[n],r=o.dataSource,s=r.data(),l=s.length;if(e){for(i=0;i<l;i++)if(s[i].field==e.field&&s[i].value==e.value&&s[i].parent_value==e.parent_value)return null!==s[i].parent_id&&(a=r.get(s[i].parent_id),this.expandFromModel(a)),void(t?o.trigger("expand",{sender:this,model:s[i]}):s[i].expanded=!0);this.expandFromModel(null,!0)}else for(i=0;i<l;i++)if(s[i].field&&s[i].treeGroup&&s[i].level==this.lastLevel)return e=s[i],null!==(this.expandModel[n]=e).parent_id&&(a=r.get(e.parent_id),this.expandFromModel(a)),void(t?o.trigger("expand",{sender:this,model:e}):s[i].expanded=!0)},setDataSource:function(e,t,i,a){var n,o,r;if("hybrid"==this.options.type){var s=this.selectedIndex;if((r=0)<(o=(n=this.tabGrids[s]).element.find(".k-grid-content.k-auto-scrollable")).length&&(r=o.scrollTop()),this._createDataSource(e),n instanceof g.ui.TreeList){var l=this.options.filterTab[s].listOptions;if(l){var d=l.group;d&&this.dataSource.group(d)}var c=e.filter(),u=e.sort();c&&this.dataSource.filter(c),u&&this.dataSource.sort(u),n.setDataSource(this.dataSource)}else n.setDataSource(this.dataSource);t||this.selectTab(this.selectedIndex,!0,i),o.scrollTop(r)}else(r=0)<(o=this.grid.element.find(".k-grid-content.k-auto-scrollable")).length&&(r=o.scrollTop()),this.grid.hideColumn(this.selectedIndex),this._createDataSource(e),this.grid.setDataSource(this.dataSource),t||this.selectTab(this.selectedIndex,!0,i),this.grid.showColumn(this.selectedIndex),o.scrollTop(r)},updateHeaderTemplate:function(){var e,t,i,a=this.options,n=a.filterTab;if("hybrid"==a.type){e=this.tabGrids[this.selectedIndex].element.find(".k-grid-header thead");var o=(t=n[this.selectedIndex].listOptions).column;o.headerTemplate&&(i=this._renderTemplate(o.headerTemplate),e.find("th[role='columnheader']").html(i))}else{e=this.grid.element.find(".k-grid-header thead");var r,s,l=n.length;for(r=0;r<l;r++)(t=n[r].listOptions)&&t.column&&(s=t.column.headerTemplate)&&(i=this._renderTemplate(s),e.find("th[role='columnheader'][data-index='"+r+"']").html(i))}},updateFilter:function(e,t){var i,a;this.options.filterTab[e].listOptions.filter=t,"hybrid"==this.options.type?(a=(i=this.tabGrids[e]).dataSource).filter(t):(i=this.grid,a=this.dataSource,i.hideColumn(this.selectedIndex),a.filter(t),i.showColumn(this.selectedIndex))},selectedDataSource:function(){var i=this.dataSource,a=[];return this.element.find(".map-panel-list-item.selected").each(function(){var e=m(this).data("uid"),t=i.getByUid(e);t&&a.push(t)}),a},removeItemById:function(e){var t=this.dataSource,i=t.get(e);i&&(this.element.find(".map-panel-list-item[data-uid='"+i.uid+"']").remove(),t.remove(i))},removeItemByElem:function(e){var t=this.dataSource,i=e.data("uid"),a=t.getByUid(i);a&&(this.element.find(".map-panel-list-item[data-uid='"+i+"']").remove(),t.remove(a))},_listToggleEvt:function(e){var t=m(this).closest(".map-panel-list-item").find("ul");0<t.length&&((t=t.eq(0)).hasClass("active")?(t.slideUp(300),t.removeClass("active"),m(this).removeClass("active")):(t.slideDown(300),t.addClass("active"),m(this).addClass("active")))},_listItemSelectEvt:function(e){var t=m(this);0<t.find(".ic-list-control-arrow").length||(t.hasClass("selected")?t.removeClass("selected"):t.addClass("selected"))},_initElement:function(){this.element.addClass("map-panel-device-list"),this.listTabs=m("<div/>").addClass("map-panel-device-list-tabs"),this.tabList=m("<div/>").addClass("map-panel-device-tab-list").appendTo(this.listTabs);var e,t,i,a,n=this.options.filterTab,o=n.length;for(a=0;a<o;a++)e=n[a],i=m("<li/>").addClass("map-panel-device-tab"),(t=m("<button/>").attr("data-field",e.field)).addClass("map-panel-device-tab-button").append(e.template),t.appendTo(i),i.appendTo(this.tabList);this.listTabs.appendTo(this.element)},_recursiveListView:function(e,t){var i,a=e.length;t=t||0;var n,o,r,s,l,d,c=m("<ul/>").addClass("map-panel-list depth-"+t);for(i=0;i<a;i++)s=(d=e[i]).field,r=m("<li/>").addClass("map-panel-list-item depth-"+t+" "+s),s?(o=this.options.groupTemplate[s],l=this._renderTemplate(o,d)):(l=this._renderTemplate(this.options.itemTemplate,d),r.addClass("map-panel-list-edge-item"),r.attr("data-uid",d.uid)),r.append(l),d.items&&(n=this._recursiveListView(d.items,t+1),r.append(n)),c.append(r);return c},getSelectedData:function(){var e,t=this.selectedIndex;if(e="hybrid"==this.options.type?this.tabGrids[t]:this.grid,this.originalDataSource){var i=this.originalDataSource.data(),a=new g.data.Query(i).filter({field:"selected",operator:"eq",value:!0});return a=a.toArray()}return e.getSelectedData()}});g.ui.plugin(t)}(window,jQuery);var util=window.Util;!function(){var i,e=window.kendo.ui,a=e.Widget,t=a.extend({options:{name:"ConfirmPopup",title:"Notification",closable:!0,content:"Popup Content...",actions:[{text:"",action:null},{text:"",action:null}]},init:function(e,t){a.fn.init.call(this,e,t),i=this.element,t=this.options,this._createTemplate(t),i.closest(".k-dialog").addClass("pop-confirm")},_createTemplate:function(){},showWindow:function(){i.data("kendoDialog").open()}});e.plugin(t)}(jQuery),function(v,_){var e=window.kendo.ui,i=e.Window,t=i.extend({options:{name:"PopupSingleWindow",title:"Detail",width:"652px",height:"770px",resizable:!1,draggable:!1,data:null,model:null,modal:!0,animation:!1,visible:!1,myWindow:null,myOptions:null,myData:null,myTmpl:null,curIndex:null,eventFactory:{},templates:{dataName:"<span class='detail-name' data-role='name'></span>",dataValue:"<span class='detail-value' data-role='value'></span>"}},init:function(e,t){i.fn.init.call(this,e,t),this.options.myWindow=this.element,this.options.myOptions=this.options,this.options.myData=this.options.myOptions.data,this.options.myTmpl=this.options.myOptions.templates,this.options.eventFactory=this.options.myOptions.eventFactory,this.options.myWindow.css({display:"block"}),this.options.myWindow.closest(".k-window").addClass("popup-window"),this.bindDefauleEvent(),this._initDom()},_initDom:function(){var e,t,i,a=this.options.myWindow.find("[data-name]");for(i=0;i<a.length;i++){var n=v(a[i]);0==n.find("[data-role=name]").length&&0==n.find("[data-role=value]").length&&(e=v(this.options.myTmpl.dataName),t=v(this.options.myTmpl.dataValue),n.prepend(t).prepend(e),n.addClass("popup-detail-row"))}var o,r=this.options.myWindow.find("button");for(i=0;i<r.length;i++)(o=v(r[i])).addClass("popup-btn"),o.kendoButton();var s=this.options.myWindow.find("input");for(i=0;i<s.length;i++)(o=v(s[i])).addClass("popup-input").addClass("k-input");this.options.myWindow.closest(".popup-window").find(".k-window-actions").css("visibility","hidden");var l=v("<span class='pop-window-btn-close ic ic-close'></span>");this.options.myWindow.closest(".k-window").find(".k-window-titlebar").append(l),this.options.myWindow.closest(".k-window").find(".k-window-titlebar").find(".pop-window-btn-close").on("click",function(e){var t=v(e.target);t.closest(".popup-window-single").removeClass("popup-editmode"),t.closest(".popup-window").find("[data-role=popupsinglewindow]").data("kendoPopupSingleWindow").close()})},bindDefauleEvent:function(){function e(e){var t=v(e.target);t.closest(".popup-window-single").removeClass("popup-editmode"),t.closest("[data-role=popupsinglewindow]").data("kendoPopupSingleWindow").close()}var t=".popup-window-single [data-event=close]",i=v(t);0!==i.length&&(i.on("click",e),this.options.eventFactory.singleWindowClose={selector:t,callback:e})},addEventToFactory:function(e,t,i){var a;a=v(e);for(var n=0;n<a.length;n++){v(a[n]).on("click",i)}this.options.eventFactory[t]={selector:e,callback:i}},bindEvent:function(){var e,t;for(var i in this.options.eventFactory){e=this.options.eventFactory[i].selector,t=this.options.eventFactory[i].callback;for(var a=v(e),n=0;n<a.length;n++){v(a[n]).on("click",t)}}},bindData:function(e,t){this.options.myData=e,this.options.curIndex=t;var i,a,n,o,r=this.options.myWindow.find("[data-name]");for(e=e[t],n=0;n<r.length;n++)i=(o=v(r[n])).find("[data-role=name]"),a=o.find("[data-role=value]"),i.text(this.options.model.fields[o.attr("data-name")].name),void 0===e[o.attr("data-name")]?a.text("-"):a.text(e[o.attr("data-name")]);var s=v(".popup-window-single").find(".box-detail").find(".popup-input");for(n=0;n<s.length;n++)(o=v(s[n])).keyup(function(){v(".popup-window-single").find("[data-event=save]").data("kendoButton").enable(!0)})},bindHistoryData:function(e){var t,i,a,n=window.I18N,o={"b.IoT":n.prop("FACILITY_HISTORY_QUADURON"),Others:n.prop("FACILITY_HISTORY_OTHERS")},r={Manual:n.prop("FACILITY_HISTORY_MANUAL"),Rule:n.prop("FACILITY_HISTORY_RULE"),Schedule:n.prop("FACILITY_HISTORY_SCHEDULE")},s=this.options.myWindow.find("li[data-name]");s.css({overflow:"hidden"});for(var l=0;l<s.length;l++){var d=v(s[l]);if(t=d.find("[data-role=name]"),i=d.find("[data-role=value]"),t.text(this.options.model.fields[d.attr("data-name")].name),void 0===e[d.attr("data-name")])i.text("-");else if("attributes"==d.attr("data-name")){var c,u,p=e.attributes,h="";if(a="",p)for(var f=0;f<p.length;f++){for(var g=p[f],m=(c=g.key.split("-")).length-1;0<=m;m--)h+=c[m];1<c.length&&(h=(h=c[c.length-2]+"_"+c[c.length-1]).replace(/-|\./g,"_")),-1<(h=h.toUpperCase()).indexOf("DIMMINGLEVEL")&&(h="DIMMINGLEVEL"),u=g.value,a+="<div>"+_.getHistoryOperation(h)+" / "+(-1!=h.indexOf("VALUE")||-1!=h.indexOf("DESIRED")||-1!=h.indexOf("LEVEL")?_.getHistoryOperationValue("FACILITY_HISTORY_OPERATION_"+h+"_VALUE",u.toUpperCase()):(-1!=u.indexOf("~")&&(u=u.replace("~","_")),_.getHistoryOperationValue("FACILITY_HISTORY_OPERATION_"+h+"_"+u.toUpperCase())))+"</div>"}else a="<div>-</div>";i.html(a)}else"systemOrigin"==d.attr("data-name")?(a=(a=o[e[d.attr("data-name")]])||n.prop("FACILITY_HISTORY_OTHERS"),i.text(a)):"serviceOrigin"==d.attr("data-name")?(a=(a=r[e[d.attr("data-name")]])||n.prop("FACILITY_HISTORY_OTHERS"),i.text(a)):i.text(e[d.attr("data-name")])}},bindZoneData:function(e,t){this.options.myData=e,this.options.curIndex=t;var i,a,n=this.options.myWindow.find("[data-name]");e=e[t];function o(e){var t,i,a,n,o;return i=(t=e.split("T"))[0],a=t[1],n=i.split("-"),o=a.split("."),{date:[n[0],n[1],n[2]],time:[o[0]]}}var r,s;for(r=0;r<n.length;r++){if(i=(s=v(n[r])).find("[data-role=name]"),a=s.find("[data-role=value]"),i.text(this.options.model.fields[s.attr("data-name")].name),void 0===e[s.attr("data-name")]?a.text("-"):a.text(e[s.attr("data-name")]),"createdDate"==s.attr("data-name"))if(e.created){var l=o(e.created.date);a.text(l.date[0]+"/"+l.date[1]+"/"+l.date[2]+" "+l.time[0])}else a.text("-");if("foundation_space_floors_type"==s.attr("data-name")){var d=a.closest("li").find('[data-name="foundation_space_floors_name"] .detail-value');e.foundation_space_floors_type&&"None"!==e.foundation_space_floors_type?"B"==e.foundation_space_floors_type?(a.text(d.text()),d.text(e.foundation_space_buildings_name+" - "+e.foundation_space_floors_type)):(a.text(e.foundation_space_floors_type),d.text(e.foundation_space_buildings_name+" - "+e.foundation_space_floors_name)):(a.text(e.foundation_space_buildings_name+" - "+e.foundation_space_floors_name),d.text(""))}if("createdUms_users_name"==s.attr("data-name")&&(e.created?a.text(e.created.ums_users_name):a.text("-")),"updatedDate"==s.attr("data-name"))if(e.updated){var c=o(e.updated.date);a.text(c.date[0]+"/"+c.date[1]+"/"+c.date[2]+" "+c.time[0])}else a.text("-");"updatedUms_users_name"==s.attr("data-name")&&(e.updated?a.text(e.updated.ums_users_name):a.text("-"))}var u=v(".popup-window-single").find(".box-detail").find(".popup-input");for(r=0;r<u.length;r++)(s=v(u[r])).keyup(function(){v(".popup-window-single").find("[data-event=save]").data("kendoButton").enable(!0)})},bindSummaryData:function(e,t){this.options.myData=e,this.options.curIndex=t;var i,a,n,o=this.options.myWindow.find("[data-name]"),r=window.I18N;e=e[t];for(var s=0;s<o.length;s++)if(i=(n=v(o[s])).find("[data-role=name]"),a=n.find("[data-role=value]"),this.options.model.fields[n.attr("data-name")]&&(i.text(this.options.model.fields[n.attr("data-name")].name),"location"==n.attr("data-name")&&i.text(r.prop("ENERGY_LOCATION")),"Algorithm"==n.attr("data-name")&&i.text(r.prop("ENERGY_ALGORITHM"))),void 0===e[n.attr("data-name")]?a.text("-"):a.text(e[n.attr("data-name")]),"Algorithm"==n.attr("data-name"))if(e.algorithm){for(var l,d=e.algorithm,c="",u="",p=0;p<d.length;p++)0<p&&(u=" , "),"OptimalStart"==d[p]&&(l=r.prop("ENERGY_OPTIMAL_START")),"Comfort"==d[p]&&(l=r.prop("ENERGY_COMFORT")),"PRC"==d[p]&&(l=r.prop("ENERGY_PRC")),c=c+u+l;a.text(c)}else a.text("-")},bindDeviceData:function(e,t){for(var i,a,n,o,r=(this.options.myData=e)[this.options.curIndex=t],s=this.options.myWindow.find("[data-name]"),l=0,d=s.length;l<d;l++){i=(n=v(s[l])).find("[data-role=name]"),a=n.find("[data-role=value]"),o=this.options.model.fields[n.attr("data-name")].name,i.text(o);var c=r[n.attr("data-name")];if(c&&c.length)if("Location"===o){var u=c[0];c="",u.foundation_space_buildings_id&&(c+=u.foundation_space_buildings_id+" "),u.foundation_space_floors_id&&(c+=u.foundation_space_floors_id+" "),u.foundation_space_zones_id&&(c+=u.foundation_space_zones_id),a.text(c)}else"Status"===o?(c=0<=c.indexOf("Critical")?"Critical":c.replace(".","(")+")",a.text(c)):"Group"===o?a.text("-"):a.text(c);else a.text("-")}},updateData:function(){for(var e=this.options.myWindow.find(".popup-detail-row"),t=0;t<e.length;t++){var i=v(e[t]),a=i.attr("data-name");this.options.myData[this.options.curIndex][a]=i.find(".detail-value").text()}return this.options.myData},openWindowPopup:function(){this.element.data("kendoPopupSingleWindow").center().open()}});e.plugin(t)}(jQuery,util),function(f){var e=window.kendo.ui,o=e.Window,t=o.extend({options:{name:"PopupMultipleWindow",title:"Detail",width:"760px",height:"770px",modal:!0,model:null,data:null,resizable:!1,draggable:!1,myWindow:null,myOptions:null,myData:null,myTmpl:null,myModel:null,curIndex:void 0,curData:null,selected:[],eventFactory:{},self:null,animation:!1,visible:!1,templates:{dataName:"<span class='detail-name' data-role='name'></span>",dataValue:"<span class='detail-value' data-role='value'></span>",panelItem:"<li class='panel-item'></li>",panelItemHeader:"<span class='k-link k-header'></span>",panelSubItem:"<div class='panel-subitem'></div>"}},init:function(e,t){o.fn.init.call(this,e,t),this.options.myWindow=this.element,this.options.myOptions=this.options,this.options.myData=this.options.myOptions.data,this.options.myTmpl=this.options.myOptions.templates,this.options.myModel=this.options.myOptions.model,(this.options.self=this).options.myWindow.css({display:"block"}),this.options.myWindow.closest(".k-window").addClass("popup-window");for(var i=this.options.myWindow.find("button"),a=0;a<i.length;a++){var n=f(i[a]);n.addClass("popup-btn"),n.kendoButton()}this._initDom()},_initDom:function(){var e,t,i,a,n=this.options.myWindow.find("[data-name]");for(i=0;i<n.length;i++){var o=f(n[i]);!1===o.hasClass("ic")&&0==o.find("[data-role=name]").length&&0==o.find("[data-role=value]").length&&(e=f(this.options.myTmpl.dataName),t=f(this.options.myTmpl.dataValue),o.prepend(t).prepend(e),o.addClass("popup-detail-row"))}var r=this.options.myWindow.find("button");for(i=0;i<r.length;i++)(a=f(r[i])).kendoButton(),"save"===a.attr("data-event")&&a.data("kendoButton").enable(!1);var s=this.options.myWindow.find("input");for(i=0;i<s.length;i++)(a=f(s[i])).addClass("popup-input"),a.addClass("k-input").kendoMaskedTextBox();if(this.bindDefauleEvent(),this.options.myWindow.find(".popup-footer").find("[editmode=show]").hide(),0===this.options.myWindow.closest(".k-window").find(".k-window-titlebar").find(".pop-window-btn-close").length){this.options.myWindow.closest(".popup-window").find(".k-window-actions").css("visibility","hidden");var l=f("<span class='pop-window-btn-close ic ic-close'></span>");this.options.myWindow.closest(".k-window").find(".k-window-titlebar").append(l),this.options.myWindow.closest(".k-window").find(".k-window-titlebar").find(".pop-window-btn-close").on("click",function(e){var t=f(e.target);t.closest(".popup-window-multiple").find("panel-item").removeClass("popup-editmode"),t.closest(".popup-window").find("[data-role=popupmultiplewindow]").data("kendoPopupMultipleWindow").close()})}this.options.myWindow.find("[data-role=template]").hide()},createPanelBar:function(e){var t,i,s=this,a=this.options.myWindow.find("[data-role=count]"),n=this.options.myWindow.find(".popup-panel");this.options.myWindow.find(".popup-panel").unbind("click"),n.find(".panel-item").remove();var o,r,l,d=this.options.myWindow.find("[data-role=template]");for(a.text(e.length),o=0;o<e.length;o++){if(this.options.myModel.fields.hasOwnProperty("ums_groups_name"))l="<span class='panel-item-num'>"+(o+1)+"</span><span class='panel-item-member'>"+e[o].name+" ("+e[o].id+")</span>";else if(this.options.myModel.fields.hasOwnProperty("type"))"Alarm"===this.options.myModel.fields.popupType&&(l="<span class='panel-item-num'>"+(o+1)+"</span><span class='panel-item-name'></span><span class='panel-item-information'>"+e[o].name+"</span>");else{var c=e[o].status;c="err"===c?"Critical":"Normal ("+c+")",l="<span class='panel-item-num'>"+(o+1)+"</span><span class='"+e[o].deviceMode+" detail'></span><span class='panel-item-member'>"+e[o].deviceName+"</span><span class='panel-item-temp'>"+c+"</span>"}r=f(d.prop("outerHTML")),t=f(this.options.myTmpl.panelItem),i=f(this.options.myTmpl.panelItemHeader),n.append(t),t.append(i),i.append(f(l)),t.append(r)}for(this.options.myWindow.find(".popup-panel").kendoPanelBar({expandMode:"single",data:e,select:function(e){var t=f(e.item),i=t.closest("[data-role=panelbar]").find(".panel-item"),a=i.index(e.item);if(s.options.curIndex=a,t.is(".k-state-active")){var n=this;window.setTimeout(function(){n.collapse(e.item)},1)}for(var o=0;o<i.length;o++){var r=i.eq(o).find(".pop-panel-item-arrow");o==a?r.toggleClass("ic-list-control-up"):r.removeClass("ic-list-control-up")}}}),o=0;o<e.length;o++)this.bindData(o,e[o]);this.bindEvent();var u=f("<span class='pop-panel-item-arrow ic ic-list-control-down'></span>");this.options.myWindow.find(".popup-panel").find(".panel-item").find(".k-icon").hide(),this.options.myWindow.find(".popup-panel").find(".panel-item").find(".k-header").append(u)},getCurrentPanelIndex:function(){return void 0===this.options.curIndex?0:this.options.curIndex},bindDefauleEvent:function(){function e(e){var t=f(e.target),i=t.closest(".popup-window");t.closest(".popup-window-multiple").find(".panel-item").removeClass("popup-editmode"),i.find(".popup-footer").find("[editmode=hide]").show(),i.find(".popup-footer").find("[editmode=show]").hide(),t.closest("[data-role=popupmultiplewindow]").data("kendoPopupMultipleWindow").close()}var t=".popup-window-multiple [data-event=close]";f(t).on("click",e),this.options.eventFactory.multipleWindowClose={selector:t,callback:e}},addEventToFactory:function(e,t,i){var a;a=f(e);for(var n=0;n<a.length;n++){f(a[n]).on("click",i)}this.options.eventFactory[t]={selector:e,callback:i}},bindEvent:function(){var e,t,i,a=this.options.self;for(var n in this.options.eventFactory){e=this.options.eventFactory[n].selector,t=this.options.eventFactory[n].callback;var o=f(e);if(0===o.parent(".popup-footer").length)for(i=0;i<o.length;i++)f(o[i]).on("click",t)}var r=this.options.myWindow.find(".popup-input");for(i=0;i<r.length;i++)f(r[i]).keyup(function(){a.options.myWindow.find("[data-event=save]").data("kendoButton").enable(!0)})},bindData:function(e,t){for(var i,a,n,o=f(this.options.myWindow.find(".panel-item")[e]).find("[data-name]"),r=0;r<o.length;r++)i=(n=f(o[r])).find("[data-role=name]"),a=n.find("[data-role=value]"),i.text(this.options.model.fields[n.attr("data-name")].name),void 0===t[n.attr("data-name")]?a.text("-"):a.text(t[n.attr("data-name")])},updateData:function(){for(var e=0;e<this.options.selected.length;e++)for(var t=f(this.options.myWindow.find(".panel-item")[e]).find(".popup-detail-row"),i=0;i<t.length;i++){var a=f(t[i]),n=a.attr("data-name");this.options.curData[e][n]=a.find(".detail-value").text()}return this.options.curData},openWindowPopup:function(e,t){var i=[];this.options.selected=t;for(var a=0;a<this.options.selected.length;a++)i.push(e[this.options.selected[a]]);this.options.curData=i,this.createPanelBar(i),this.options.myWindow.data("kendoPopupMultipleWindow").center().open()},bindDeviceData:function(e,t){for(var i,a,n,o,r=f(this.options.myWindow.find(".panel-item")[e]).find("[data-name]"),s=0,l=r.length;s<l;s++){a=(i=f(r[s])).find("[data-role=name]"),n=i.find("[data-role=value]"),o=this.options.model.fields[i.attr("data-name")].name,a.text(this.options.model.fields[i.attr("data-name")].name);var d=t[i.attr("data-name")];if(d&&d.length)if("Location"===o){var c=d[0];d="",c.foundation_space_buildings_id&&(d+=c.foundation_space_buildings_id+" "),c.foundation_space_floors_id&&(d+=c.foundation_space_floors_id+" "),c.foundation_space_zones_id&&(d+=c.foundation_space_zones_id),n.text(d)}else"Status"===o?(d=0<=d.indexOf("Critical")?"Critical":d.replace(".","(")+")",n.text(d)):"Group"===o?n.text("-"):n.text(d);else n.text("-")}},createDevicePanelBar:function(e){var t,i,n=this,a=this.options.myWindow.find("[data-role=count]"),o=this.options.myWindow.find(".popup-panel"),r=window.Util;this.options.myWindow.find(".popup-panel").unbind("click"),o.find(".panel-item").remove();var s,l,d,c=this.options.myWindow.find("[data-role=template]");for(a.text(e.length),s=0;s<e.length;s++){var u=r.getStatus(e[s]);u=0<=u.indexOf("Critical")?"Critical":u.replace(".","(")+")";var p=e[s].modes;d="<span class='panel-item-num'>"+(s+1)+"</span><span class='"+(p=p&&p.length?p[0].mode:"detail-img Auto on")+" detail'></span><span class='panel-item-member'>"+e[s].name+"</span><span class='panel-item-temp'>"+u+"</span>",l=f(c.prop("outerHTML")),t=f(this.options.myTmpl.panelItem),i=f(this.options.myTmpl.panelItemHeader),o.append(t),t.append(i),i.append(f(d)),t.append(l)}for(this.options.myWindow.find(".popup-panel").kendoPanelBar({expandMode:"single",data:e,select:function(e){var t=f(e.item),i=t.closest("[data-role=panelbar]").find(".panel-item").index(e.item);if(n.options.curIndex=i,t.is(".k-state-active")){var a=this;window.setTimeout(function(){a.collapse(e.item)},1)}t.find(".pop-panel-item-arrow").toggleClass("ic-list-control-up")}}),s=0;s<e.length;s++)this.bindDeviceData(s,e[s]);this.bindEvent();var h=f("<span class='pop-panel-item-arrow ic ic-list-control-down'></span>");this.options.myWindow.find(".popup-panel").find(".panel-item").find(".k-icon").hide(),this.options.myWindow.find(".popup-panel").find(".panel-item").find(".k-header").append(h)},openWindowDevicePopup:function(e,t){var i=[];this.options.selected=t;for(var a=0;a<this.options.selected.length;a++)i.push(e[this.options.selected[a]]);this.options.curData=i,this.createDevicePanelBar(i),this.options.myWindow.data("kendoPopupMultipleWindow").center().open()}});e.plugin(t)}(jQuery),function(e,u){var p=e.kendo,h=p.ui.NumericTextBox,a="k-i-arrow-60-down",n="k-i-arrow-60-up",o="k-state-selected",s="k-state-disabled",t=h.extend({options:{name:"CustomNumericBox",format:"#.0",index:-1,step:1,viewModel:null,placeholder:"-",enable:!1,oriEnable:!1,oriValue:"",blockKeyEvent:!0,numericTitle:null,unit:"\u2103",showValueWhenDisabled:!1,downArrowText:"",upArrowText:""},init:function(e,t){var a=this;h.fn.init.call(a,e,t);var i=a.wrapper,n=a.element,o=i.find(".k-numeric-wrap").parent();o.addClass("control-numeric-bound");var r=n.attr("title");if(t.numericTitle?r=t.numericTitle:t.numericTitle=r,r&&o.append("<span class='control-numeric-name'>"+r+"</span>"),o.append("<span class='control-numeric-unit'>"+t.unit+"</span>"),this.options.blockKeyEvent)a.element.on("focus",function(e){return u(this).blur(),!1}),a.element.addClass("block-key-event"),a.element.off("focusout.kendoNumericTextBox");else{var s,l=a.options.min<0;s=l?/^[0-9]+$/:/^[0-9-]+$/;var d=0;a.options.decimals&&(s=l?/^[0-9.-]+$/:/^[0-9.]+$/,d=p.toString(0,"n"+a.options.decimals));var c=a.value();a.beforeValue=null!=c?c:d,a.element.on("keyup",function(e){var t=a.element.val();if(""!=t&&!t.match(s)){var i=a.beforeValue;a.element.val(i),a.element.blur()}}),a.element.on("change",function(e){a.beforeValue=a.element.val()})}},_spin:function(e,t){var i=this;if(!i.element.prop("disabled")){var a=i.value();h.fn._spin.call(i,e,t);var n=i.value();if(n!==a){var o=i._upArrow,r=i._downArrow;a<n?(n==i.max()&&i._setUpbind(o,!1),r.hasClass(s)&&i._setDownbind(r,!0)):n<a&&(n==i.min()&&i._setDownbind(r,!1),o.hasClass(s)&&i._setUpbind(o,!0)),i._focusout(),i.trigger("change"),i.options.oriValue=n}}},_setUpbind:function(e,t){var i=this;i._upArrowEventHandler.unbind("press"),t?(e.removeClass(s),i._upArrowEventHandler.bind("press",function(e){e.preventDefault(),i._spin(1),i._upArrow.addClass(o)})):e.addClass(s)},_setDownbind:function(e,t){var i=this;i._downArrowEventHandler.unbind("press"),t?(e.removeClass(s),i._downArrowEventHandler.bind("press",function(e){e.preventDefault(),i._spin(-1),i._downArrow.addClass(o)})):e.addClass(s)},_arrows:function(){var e=this.wrapper;h.fn._arrows.call(this);var t=e.find("."+a);0<t.length&&(t.removeClass(a),t.addClass("c-i-arrow-60 down"));var i=e.find("."+n);0<i.length&&(i.removeClass(n),i.addClass("c-i-arrow-60 up"))},_input:function(){var e=this.wrapper;h.fn._input.call(this);var t=e.find(".k-select");0<t.length&&t.addClass("control-custom-box")},_wrapper:function(){h.fn._wrapper.call(this),this.wrapper.find(".k-numeric-wrap").addClass("control-custom-wrap")},min:function(e){return h.fn.min.call(this,e)},max:function(e){return h.fn.max.call(this,e)},value:function(e){var t=this;if(e){var i=t._upArrow,a=t._downArrow;t._setUpbind(i,!0),t._setDownbind(a,!0),e>=t.max()?(t._setUpbind(i,!1),e=t.max()):e<=t.min()&&(t._setDownbind(a,!1),e=t.min()),t.options.oriValue=e,t.options.showValueWhenDisabled||t.options.enable||(e="")}return h.fn.value.call(t,e)},enable:function(e){h.fn.enable.call(this,e),(this.options.enable=e)?this.value(this.options.oriValue):this.options.showValueWhenDisabled||this.value("")},oriEnable:function(e){if(void 0===e)return this.options.oriEnable;this.options.oriEnable=e},destroy:function(){h.fn.destroy.call(this)}});p.ui.plugin(t)}(window,jQuery),function(n,i){"use strict";var a=".CustomRadioButtonGroup",e=i.ui.Widget.extend({options:{dataSource:null,id:"",value:"",groupName:"",icon:null,text:"",index:-1,name:"CustomRadioButtonGroup",orientation:"horizontal",oriEnables:[],checkedValue:""},events:["change","dataBound"],dataSource:null,init:function(e,t){i.ui.Widget.fn.init.call(this,e,t),this._dataSource(),this.dataSource.fetch(),this.element.on("click"+a,".c-radio-label",{sender:this},this._onRadioButtonSelected)},destroy:function(){n(this.element).off(a),i.ui.Widget.fn.destroy.call(this)},_dataSource:function(){var e=this.options.dataSource;e=n.isArray(e)?{data:e}:e,this.dataSource&&this._refreshHandler?this.dataSource.unbind("change",this._refreshHandler):this._refreshHandler=n.proxy(this.refresh,this),this.dataSource=i.data.DataSource.create(e).bind("change",this._refreshHandler)},_template:function(){var e,t=this.options;return e=t.icon&&t.icon.length?i.format("<div class='buttonbound' data-bind='invisible: {0} #:{1}#' style='width : #: {5} #%' > <div class='background' data-uid='#: uid #'> <input id='#: {1} #' type='radio' name='{0}' value='#: {2} #' class='c-radio' disabled/><div class='colorbox c-radio-label' data-value='#: {2} #'><label class='icon #: {3} #' for ='{1}'></label></div></div><p>#:{4}#</p></div>",t.groupName,t.id,t.value,t.icon,t.text,this.iconWidth):i.format("<div class='buttonbound' data-bind='invisible: {0} #:{1}#' > <div class='background' data-uid='#: uid #'> <input id='#: {1} #' type='radio' name='{0}' value='#: {2} #' class='c-radio' disabled/><button class='colorbox c-radio-label' data-value='#: {2} #'>#:{3}#</button></div></div>",t.groupName,t.id,t.value,t.text),i.template(e)},_onRadioButtonSelected:function(e){var t=n(this),i=e.data.sender;if(!t.prev(".c-radio")[0].disabled){i.element.find(".c-radio").prop("checked",!1),t.prev(".c-radio").prop("checked",!0);var a=i.dataItem();i.oldDataItem!==a&&e.originalEvent&&i.trigger("change",{dataItem:a}),i.oldDataItem=a,i.options.checkedValue=a.value}},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.dataSource.fetch()},refresh:function(e){var t=e.items.length;this.iconWidth=100/t;var i=this._template();this.element.empty(),this.element.append("<div class='buttonset'><div class='buttonrow'></div></div");for(var a=this.element.find(".buttonrow"),n=0;n<t;n++)a.append(i(e.items[n]));this.trigger("dataBound")},clear:function(){this.oldDataItem=void 0,this.element.find(i.format("input[name='{0}']",this.options.groupName)).attr("checked",!1)},dataItem:function(){var e=this.element.find(".c-radio:checked").closest(".background").attr("data-uid");return this.dataSource.getByUid(e)},enable:function(){2===arguments.length?(arguments[1]||this.element.find(i.format("input[id='{0}']",arguments[0])).attr("checked",!1),this.element.find(i.format(".c-radio[id='{0}']",arguments[0])).attr("disabled",!arguments[1])):1===arguments.length&&(arguments[0]||this.clear(),this.element.find(".c-radio").prop("disabled",!arguments[0]))},id:function(){var e=this.options;if(1===arguments.length)return e.groupName+e.dataSource[arguments[0]].id},oriEnable:function(){if(2===arguments.length)this.options.oriEnables[arguments[0]]=arguments[1];else{if(1===arguments.length)return this.options.oriEnables[arguments[0]];this.options.oriEnables=[]}},count:function(){return this.options.dataSource.length},text:function(){if(0===arguments.length)return this.element.find(".c-radio:checked").attr("data-text");this.element.find(i.format(".c-radio-label[data-text='{0}']",arguments[0])).click()},value:function(){if(0===arguments.length)return this.element.find(".c-radio:checked").attr("value");this.options.checkedValue=arguments[0],this.element.find(i.format(".c-radio-label[data-value='{0}']",arguments[0])).click()},index:function(){}});i.ui.plugin(e)}(window.kendo.jQuery,window.kendo),function(a){"use strict";var e=a.ui.Button.extend({options:{name:"CustomControlButton",oriEnable:!1,index:-1,isCheckMode:!0,isChangeText:!0},events:["change"],_click:function(e){var t,i;a.ui.Button.fn._click.call(this),this.options.isCheckMode&&(t=(i=this.select())?"On":"Off"),this.trigger("change",{state:t,isSelected:i})},select:function(e){var t,i=this.wrapper;t="ON"===(e=e||(i.hasClass("selected")?"OFF":"ON"))?(this.options.isCheckMode&&i.addClass("selected"),!0):(i.removeClass("selected"),!1);var a=i.children()[0];return this.options.isChangeText&&(a&&"SPAN"===a.nodeName?a.innerHTML="<i class='icon power'></i>"+e:i.text(e)),t},enable:function(e){void 0===e?this.select("ON/OFF"):e||this.wrapper.removeClass("selected"),a.ui.Button.fn.enable.call(this,e)},isSelected:function(){return!!this.wrapper.hasClass("selected")},oriEnable:function(e){if(void 0===e)return this.options.oriEnable;this.options.oriEnable=e},destroy:function(){a.ui.Button.fn.destroy.call(this)}});a.ui.plugin(e)}((window.kendo.jQuery,window.kendo)),function(g){var o=window.kendo,m=o.ui,i=m.DropDownList,r="selectionChanged",v="k-state-selected",s="custom-multiselect-check-item",a="custom-multiselect-selectAll-item",l="custom-multiselect-summary-empty",e=i.extend({init:function(e,t){t&&t.virtual?t.template=this.virtualCheckedTemplate.bind(this):t.template=o.template(o.format('<input type="checkbox" name="#= {1} #" value="#= {0} #" class="custom-multiselect-check-item + k-checkbox" /><label class="k-checkbox-label"></label><span data-value="#= {0} #">#= {1} #</span>',t.dataValueField,t.dataTextField)),i.fn.init.call(this,e,t),this.options.showSelectAll&&(this._oldValue=g.map(["0"],function(e){return e.toString()})),1==this.options.applyBox&&this._createApplyBox()},options:{name:"DropDownCheckBox",index:-1,dataSource:[],showSelectAll:!0,preSummaryCount:0,emptyText:"Please Select Item",selectionChanged:null,selectAllText:"All",applyBox:!1,restrictionNum:null,selectedText:null,cancelOption:!1,hasCheckedModel:!1,changedArgsForApplyBox:{},isAbleUnselectAll:!1},virtualCheckedTemplate:function(e){var t,i,a=this.options;t=a.dataValueField?e[a.dataValueField]:e,i=a.dataTextField?e[a.dataTextField]:e;var n=e.checked?"checked":"";return'<input type="checkbox" name="'+i+'" value="'+t+'" class="'+s+'" '+n+'/><span class="dropdown-checkbox '+n+'" data-value="'+t+'">'+i+"</span>"},events:[r],refresh:function(){i.fn.refresh.call(this),this._updateSummary(),g(this.popup.element).addClass("custom-multiselect-popup")},current:function(){return this._current},setDataSource:function(e){i.fn.setDataSource.call(this,e),this.refresh()},open:function(){this._removeSelectAllItem(),this._addSelectAllItem(),i.fn.open.call(this),this.popup.one("close",g.proxy(this._onPopupClosed,this));var e=this.dataSource.data().length,t=this.ul;0===e?t&&this.ul.closest(".k-list-container").find(".control-dropdown-checkbox-apply-box").css("bottom",0):t&&this.ul.closest(".k-list-container").find(".control-dropdown-checkbox-apply-box").css("bottom","auto")},_listBound:function(){i.fn._listBound.call(this),this.options.virtual||this.selectAll()},_onPopupClosed:function(){this._removeSelectAllItem(),this._current=null,this.options.isAbleUnselectAll||0!=this.getSelectedItems().length||this.selectAll(),this._raiseSelectionChanged()},_raiseSelectionChanged:function(){var e,t=this.dataSource.data().length,i=this.value(),a=g.map((0<i.length?i.split(","):[]).sort(),function(e){return e});e=this._oldValue?g.map((this._oldValue||[]).sort(),function(e){return e.toString()}):this._oldValue,this._oldValue=g.map(a,function(e){return e.toString()}),t||(this._oldValue=g.map(["0"],function(e){return e.toString()}));var n={newValue:a,oldValue:e,count:t};e?!0==(0==g(e).not(a).length&&0==g(a).not(e).length)||this.options.applyBox||this.trigger(r,n):0<i.length&&!this.options.applyBox?this.trigger(r,n):this.options.isAbleUnselectAll&&this.trigger(r,n)},_addSelectAllItem:function(){if(this.options.showSelectAll){var e=this.ul.children("li:first"),t=this.options.selectAllText;this.options.virtual?e.length<=0?this.selectAllListItem=g('<li tabindex="-1" role="option" unselectable="on" class="k-virtual-item k-item '+a+'" data-uid='+o.guid()+"></li>").appendTo(this.ul):this.selectAllListItem=g('<li tabindex="-1" role="option" unselectable="on" class="k-virtual-item k-item '+a+'" data-uid='+o.guid()+"></li>").insertBefore(e):e.length<=0?this.selectAllListItem=g('<li tabindex="-1" role="option" unselectable="on" class="k-item '+a+'" data-uid='+o.guid()+"></li>").appendTo(this.ul):this.selectAllListItem=g('<li tabindex="-1" role="option" unselectable="on" class="k-item '+a+'" data-uid='+o.guid()+"></li>").insertBefore(e);var i={};i[this.options.dataValueField]="*",i[this.options.dataTextField]=t,this.selectAllListItem.html(this.options.template(i)),this._updateSelectAllItem()}},_removeSelectAllItem:function(){this.selectAllListItem&&this.selectAllListItem.remove(),this.selectAllListItem=null},_focus:function(e){if(this.options.applyBox){if(this.popup.visible())return void this.close()}else{if(this.popup.visible()&&e&&this.trigger("select",{item:e}))return void this.close();this.select(e)}},_blur:function(){1!=this.options.applyBox&&this._change(),this.close()},selectAll:function(e){if(this.options.virtual){var t,i,a=(t=e||this._getAllValueData()).length;for(i=0;i<a;i++)t[i].checked=!0;this.dataSource.fetch(),this._updateSummary(),this._removeSelectAllItem(),this._addSelectAllItem(),this._updateSelectAllItem()}else{var n=this._getUnselectedListItems();this._selectItems(n)}},unselectAll:function(){if(this.options.virtual){var e,t=this._getAllValueData(),i=t.length;for(e=0;e<i;e++)t[e].checked=!1;this.dataSource.fetch(),this._updateSummary(),this._removeSelectAllItem(),this._addSelectAllItem(),this._updateSelectAllItem()}else{var a=this._getSelectedListItems();this._selectItems(a)}this._oldValue=void 0,this.options.emptyText&&this._textAccessor(this.options.emptyText)},_selectItems:function(e){var i=this;g.each(e,function(e,t){i._select(g(t))})},_select:function(e){var a,n,t,i,o,r=this,s=new g.Deferred,l=r.options;if(e=r._get(e),l.virtual&&e&&e[0]){var d=this.dataSource,c=e.attr("data-uid"),u=d.getByUid(c);if(u){var p=e.find("span");i=e.find("input[type='checkbox']"),u.checked?(o=!1,p.removeClass("checked")):(o=!0,p.addClass("checked")),u.checked=o,i.prop("checked",o),this._open&&(r._current(e),r._highlightCurrent()),a=[],n=[],r._updateSummary(),r._updateSelectAllItem(),t=d.indexOf(u),r._accessor(a,t)}else this.selectAllListItem&&e[0]===this.selectAllListItem[0]?(i=e.find("input[type='checkbox']"),(o=!this._isSelectAll)?this.selectAll():this.unselectAll()):s.fail()}else if(e&&e[0]){if(-1<(t=m.List.inArray(e[0],r.ul[0]))){e.hasClass(v)?(e.removeClass(v),r._uncheckItem(e),this.selectAllListItem&&e[0]===this.selectAllListItem[0]&&this.unselectAll()):(e.addClass(v),r._checkItem(e),this.selectAllListItem&&e[0]===this.selectAllListItem[0]&&this.selectAll()),this._open&&(r._current(e),r._highlightCurrent());var h=this._getSelectedListItems(),f=this._getUnselectedListItems();r.options.restrictionNum&&(h.length>=r.options.restrictionNum?(f.addClass("k-state-disabled").removeClass("k-state-selected"),f.find("input").attr("disabled",!0)):(f.removeClass("k-state-disabled"),f.find("input").attr("disabled",!1))),a=[],n=[],g.each(h,function(e,t){var i=g(t).children("span").first();a.push(i.attr("data-value")),n.push(i.text())}),r._updateSummary(n),r._updateSelectAllItem(),r._accessor(a,t)}r.trigger("updatedText")}else s.fail();return s.promise()},_getAllValueListItems:function(){return this.selectAllListItem?this.ul.children("li").not(this.selectAllListItem[0]):this.ul.children("li")},_getAllValueData:function(){var e=this.dataSource,t=e.data(),i=e.filter(),a=new o.data.Query(t);return i&&(a=a.filter(i)),a.toArray()},_getSelectedListItems:function(){return this._getAllValueListItems().filter("."+v)},_getCheckedListItems:function(){return this.getCheckedData()},_getUnselectedListItems:function(){return this._getAllValueListItems().filter(":not(."+v+")")},_getUncheckedListItems:function(){return this.getCheckedData(!1)},_getSelectedItemsText:function(){var a=[],e=this._getSelectedListItems();return g.each(e,function(e,t){var i=g(t).children("span").first();a.push(i.text())}),a},_getCheckedItemsText:function(){var a=[],e=this.getCheckedData(),n=this.options.dataTextField;return g.each(e,function(e,t){var i=t[n]?t[n]:t;a.push(i)}),a},_updateSelectAllItem:function(){if(this.selectAllListItem)if(this.options.virtual){var e=this._getAllValueData(),t=this.getCheckedData();e.length==t.length?(this._checkItem(this.selectAllListItem),this._isSelectAll=!0):(this._uncheckItem(this.selectAllListItem),this._isSelectAll=!1)}else this._getAllValueListItems().length==this._getSelectedListItems().length?(this._checkItem(this.selectAllListItem),this.selectAllListItem.addClass(v)):(this._uncheckItem(this.selectAllListItem),this.selectAllListItem.removeClass(v))},_updateSummary:function(e){var t,i=this.options,a=i.selectAllText,n=window.I18N,o=(e=e||(i.virtual?this._getCheckedItemsText():this._getSelectedItemsText())).length;if(0==o)return this._inputWrapper.addClass(l),void(this.dataSource.data().length?this._textAccessor(this.options.emptyText):this._textAccessor(this.options.selectAllText));if(this._inputWrapper.removeClass(l),i.virtual){var r=this._getAllValueData();o<=this.options.preSummaryCount?this._textAccessor(e.join(", ")):o==r.length?"ellipsis"==this.options.selectedText?(t="",t=1<o?(10<e[0].length?e[0].substring(0,11)+"...":e[0])+" (+"+String(o-1)+")":e[0],this._textAccessor(t)):this._textAccessor(a):o==r.length?this._textAccessor(a):"ellipsis"==this.options.selectedText?(t="",t=1<o?(10<e[0].length?e[0].substring(0,11)+"...":e[0])+" (+"+String(o-1)+")":e[0],this._textAccessor(t)):this._textAccessor(n.prop("COMMON_SELECTED_FILTER",o))}else o<=this.options.preSummaryCount?this._textAccessor(e.join(", ")):o==this.dataSource.data().length?"ellipsis"==this.options.selectedText?(t="",t=1<o?(10<e[0].length?e[0].substring(0,11)+"...":e[0])+" (+"+String(o-1)+")":e[0],this._textAccessor(t)):this._textAccessor(a):o==this.listView.dataSource._view.length?this._textAccessor(a):"ellipsis"==this.options.selectedText?(t="",t=1<o?(10<e[0].length?e[0].substring(0,11)+"...":e[0])+" (+"+String(o-1)+")":e[0],this._textAccessor(t)):this._textAccessor(n.prop("COMMON_SELECTED_FILTER",o))},_checkItem:function(e){e&&(e.children("input").prop("checked",!0),this.options.virtual&&e.find("span").addClass("checked"))},_uncheckItem:function(e){e&&(e.children("input").removeAttr("checked"),this.options.virtual&&e.find("span").removeClass("checked"))},_isItemChecked:function(e){return 0<e.children("input:checked").length},getSelectedItems:function(){return this._getSelectedListItems()},_createApplyBox:function(){var e=window.I18N,d=this,t=d.element,i=t.data("kendoDropDownCheckBox").list,a=g("<div class='control-dropdown-checkbox-apply-box'></div>"),n=g("<button class='k-button control-dropdown-checkbox-btn-apply' data-event='diagnosisgrouplistapply'>"+e.prop("COMMON_BTN_APPLY")+"</button>"),o=g("<button class='k-button control-dropdown-checkbox-btn-cancel' data-event='grouplistcancel'>"+e.prop("COMMON_BTN_CANCEL")+"</button>");i.append(a),a.append(o).append(n),a.on("click",".k-button[data-event=diagnosisgrouplistapply]",function(e){var t=d.value(),i={newValue:g.map((0<t.length?t.split(","):[]).sort(),function(e){return e})};if(d.trigger(r,i),d.popup.visible())return d.close(),d._change(),void d.close()}),a.on("click",".k-button[data-event=grouplistcancel]",function(e){if(d.options.virtual){if(d.options.cancelOption)if(d._oldValue){var t=d.getOldCheckedData(d._oldValue);d.unselectAll(),d.selectAll(t)}else d.options.isAbleUnselectAll||d.selectAll()}else{var i,a=d.dataSource.data(),n=[],o=g("#"+d.element[0].id+"-list").find(".k-list li");if(d.options.cancelOption)if(d._oldValue){for(var r=0;r<d._oldValue.length;r++)for(var s=0;s<a.length;s++)a[s].id==d._oldValue[r]&&(i=d.options.showSelectAll?s+1:s,n.push(i));d.unselectAll();for(var l=0;l<n.length;l++)d._selectItems(o.eq(n[l]))}else d.options.isAbleUnselectAll||d.selectAll()}d.popup.visible()&&d.close()}),a.css({position:"absolute",left:"-1px",width:t.data("kendoDropDownCheckBox").wrapper.width()-2,background:"#fff",textAlign:"center",border:"1px solid #e1e1e1",borderTop:"none",paddingBottom:"5px"}),i.hover(function(e){a.css({border:"1px solid #0081c6","border-top":"none"})},function(e){a.css({border:"1px solid #e1e1e1",borderTop:"none"})})},value:function(a){var n=this,e=[],t=n.options;if(void 0===a){if(t.virtual){var i=this.getCheckedData(),o=t.dataValueField;return g.map(i,function(e){return e[o]?e[o]:e}).join()}var r=this._getSelectedListItems();return g.map(r,function(e){return g(e).children("span").first().attr("data-value")}).join()}if(g.isArray(a)?(e=a,this._oldValue=a):(e.push(a),this._oldValue=e),t.virtual){this.unselectAll();var s=[];g.each(e,function(e,t){if(null!==t&&(t=t.toString()),n._selectedValue=t,a||n.options.optionLabel&&!n.element[0].disabled&&""===a){var i=n.findItemFromDataSource(t);i&&s.push(i)}}),n.selectAll(s)}else g(n.ul[0]).children("li").removeClass(v),g("input",n.ul[0]).removeAttr("checked"),g.each(e,function(e,t){var i;if(null!==t&&(t=t.toString()),n._selectedValue=t,a||n.options.optionLabel&&!n.element[0].disabled&&""===a)for(i=0;i<n._getAllValueListItems().length;i++)if(g(n._getAllValueListItems()[i]).find("span").data("value")==t){n.select(n._getAllValueListItems().eq(i));break}}),n._updateSummary()},getCheckedData:function(e){void 0===e&&(e=!0);var t=this.dataSource,i=t.data(),a=t.filter(),n=new o.data.Query(i);return a&&(n=n.filter(a)),(n=n.filter({field:"checked",operator:"eq",value:e})).toArray()},getOldCheckedData:function(e){var t,i,a,n,o=this.options.dataValueField,r=this.dataSource.data(),s=e.length,l=r.length,d=[];for(t=0;t<s;t++)for(n=e[t],i=0;i<l;i++)a=r[i],n==(o?a[o]:a)&&d.push(a);return d},findItemFromDataSource:function(e){var t,i,a=this.options.dataValueField,n=this.dataSource.data(),o=n.length;for(i=0;i<o;i++)if(t=n[i],(a?t[a]:t)==e)return t;return null}});m.plugin(e)}(jQuery),function(pe){var D,m,v,he,fe,_=window.kendo,e=_.ui,b=e.Widget,y={},C=[],k=[],I=[],ge=["MIN","MAX","SET"],t=b.extend({options:{name:"ControlTab",dataSource:null,groupMode:!1},events:["change","expand"],init:function(e,t){b.fn.init.call(this,e,t);var i,a={indoor:(D=window.I18N).prop("FACILITY_INDOOR"),indoorMode:D.prop("FACILITY_INDOOR_MODE"),chillerMode:D.prop("FACILITY_INDOOR_CHILLER_MODE"),temperature:D.prop("COMMON_TEMPERATURE"),fanSpeed:D.prop("FACILITY_INDOOR_CONTROL_FANSPEED"),windDirection:D.prop("FACILITY_INDOOR_CONTROL_WIND_DIRECTION"),operationLimit:D.prop("FACILITY_INDOOR_STATUS_OPERATION_LIMIT"),indoorTempLimit:D.prop("FACILITY_INDOOR_TEMPERATURE_LIMIT"),heatUpperLimit:D.prop("FACILITY_INDOOR_STATUS_HEAT_UPPER_LIMIT"),coolLowerLimit:D.prop("FACILITY_INDOOR_STATUS_COOL_LOWER_LIMIT"),waterOutTempLimit:D.prop("FACILITY_INDOOR_WATER_OUT_TEMPERATURE_LIMIT"),dischargeTempControl:D.prop("FACILITY_INDOOR_CONTROL_DISCHARGE_TEMP_CONTROL"),windFree:D.prop("FACILITY_INDOOR_CONTROL_WIND_FREE"),operationPattern:D.prop("FACILITY_INDOOR_CONTROL_CHILLER_OPERATION_PATTERN"),optimumWaterTempControl:D.prop("FACILITY_INDOOR_CONTROL_CHILLER_OPTIMUM_WATER_TEMPERATURE_CONTROL"),quiteMode:D.prop("FACILITY_INDOOR_CONTROL_CHILLER_QUIET_MODE"),snowProtection:D.prop("FACILITY_INDOOR_CONTROL_CHILLER_SNOW_PROTECTION"),demandSetting:D.prop("FACILITY_INDOOR_CONTROL_CHILLER_DEMAND_SETTING"),demand:D.prop("FACILITY_INDOOR_CONTROL_CHILLER_DEMAND"),ventilator:D.prop("FACILITY_DEVICE_TYPE_VENTILATOR"),ventilatorMode:D.prop("FACILITY_INDOOR_CONTROL_VENTILATOR_MODE"),ventilatorFanSpeed:D.prop("FACILITY_INDOOR_CONTROL_VENTILATOR_FAN_SPEED"),dhw:D.prop("FACILITY_DEVICE_TYPE_DHW"),dhwTemp:D.prop("FACILITY_INDOOR_DHW_TEMPERATURE"),dhwOperationMode:D.prop("FACILITY_INDOOR_DHW_OPERATION_MODE"),dhwUpperTempLimit:D.prop("FACILITY_INDOOR_DHW_UPPER_TEMPERATURE_LIMIT"),upperLimit:D.prop("FACILITY_INDOOR_CONTROL_UPPER_LIMIT"),options:D.prop("FACILITY_INDOOR_OPTIONS"),remoteControl:D.prop("FACILITY_INDOOR_REMOTE_CONTROL"),filterRest:D.prop("FACILITY_INDOOR_CONTROL_FILTER_RESET"),spiSetting:D.prop("FACILITY_INDOOR_CONTROL_SPI_SETTING"),none:D.prop("FACILITY_INDOOR_CONTROL_NONE"),waterOut:D.prop("FACILITY_INDOOR_WATER_OUT"),discharge:D.prop("FACILITY_INDOOR_CONTROL_DISCHARGE"),setTemp:D.prop("FACILITY_INDOOR_SET")},n=this,o=window.GlobalSettings.getTemperature(),r=o.increment;i="Celsius"===o.unit?"\u2103":"\u2109";var s=_.template('<div class="container" style="height:100%;"><ul id="panelbar" style="height:100%" class="indoor-control-panel control"><li id="item1">#=indoor#<div class="innerBox" style="height: 490px; overflow: scroll;"><div data-bind="invisible:btnPower0"><button id="btnPower0" class="colorbox" disabled><span class="icwrap"><i class="icon power"></i>ON/OFF</span></button></div><div class="indoor-mode-title" data-bind="invisible:rgIndoorMode"><p class="bluetit">#=indoorMode#</p><div id="rgIndoorMode" class="radiogroup"></div></div><div class="chiller-mode-title" data-bind="invisible:rgChillerMode"><p class="bluetit">#=chillerMode#</p><div id="rgChillerMode" class="radiogroup"></div></div><div class="indoor-temperature-title" data-bind="invisible:isIndoorTemperature()"><p class="bluetit">#=temperature#</p><input id="inpTemperature0" title="#=setTemp#" data-bind="invisible:inpTemperature0" disabled/><div class="blank10" data-bind="invisible:isInpTemperature1()"></div><input id="inpTemperature1" title="#=waterOut#" data-bind="invisible:isInpTemperature1()" disabled/><div class="blank10" data-bind="invisible:isInpTemperature2()"></div><input id="inpTemperature2" title="#=discharge#" data-bind="invisible:isInpTemperature2()" disabled/></div><div data-bind="invisible:isRgIndoorFanSpeed()"><p class="bluetit">#=fanSpeed#</p><div id="rgIndoorFanSpeed" class="radiogroup"></div></div><div data-bind="invisible:isWindDirection()"><p class="bluetit">#=windDirection#</p><div id="rgIndoorWindDirection0" class="radiogroup"></div><div id="rgIndoorWindDirection1" class="radiogroup"></div></div><div data-bind="invisible:isRgIndoorOperationLimit()"><p class="bluetit">#=operationLimit#</p><div id="rgIndoorOperationLimit" class="radiogroup"></div></div><div class="numeric" data-bind="invisible:isIndoorTempLimit()"><p class="bluetit">#=indoorTempLimit#</p><div class="tb" data-bind="invisible:btnTempLimit1"><button id="btnTempLimit1" class="bound btncontrol" disabled>#=heatUpperLimit#</button><input id="inpTempLimit1" disabled /></div><div style="margin-top: 10px;" class="tb" data-bind="invisible:btnTempLimit0"><button id="btnTempLimit0" class="bound btncontrol" disabled>#=coolLowerLimit#</button><input id="inpTempLimit0" disabled/></div></div><div class="numeric" data-bind="invisible:isIndoorWaterOutTempLimit()"><p class="bluetit">#=waterOutTempLimit#</p><div class="tb" data-bind="invisible:btnTempLimit3"><button id="btnTempLimit3" class="bound btncontrol" disabled>#=heatUpperLimit#</button><input id="inpTempLimit3" disabled/></div><div class="tb" style="margin-top: 10px;" data-bind="invisible:btnTempLimit2"><button id="btnTempLimit2" class="bound btncontrol" disabled>#=coolLowerLimit#</button><input id="inpTempLimit2" disabled/></div></div><div data-bind="invisible:isBtnDischarge()"><p class="bluetit">#=dischargeTempControl#</p><button id="btnDischarge" class="colorbox">ON/OFF</button></div><div data-bind="invisible:isBtnOption3()"><p class="bluetit">#=windFree#</p><button id="btnOption3" class="colorbox" disabled>ON/OFF</button></div><div data-bind="invisible:isRgIndoorChillerMcc()"><p class="bluetit">#=operationPattern#</p><div id="rgIndoorChillerMcc" class="radiogroup"></div></div><div data-bind="invisible:isBtnChiller0()"><p class="bluetit">#=optimumWaterTempControl#</p><button id="btnChiller0" class="colorbox" disabled>#=none#</button></div><div data-bind="invisible:isBtnChiller1()"><p class="bluetit">#=quiteMode#</p><button id="btnChiller1" class="colorbox" disabled>ON/OFF</button></div><div data-bind="invisible:isBtnChiller2()"><p class="bluetit">#=snowProtection#</p><button id="btnChiller2" class="colorbox" disabled>ON/OFF</button></div><div class="numeric" data-bind="invisible:isBtnChiller3()"><p class="bluetit">#=demandSetting#</p><div class="tb"><button id="btnChiller3" class="bound btncontrol" disabled>ON/OFF</button><input id="inpDemand" min="50" max="100" disabled /></div></div></div></li><li id="item2">#=ventilator#<div class="innerBox" style="height: 490px;" ><div data-bind="invisible:btnPower1"><button id="btnPower1" class="colorbox" disabled><span class="icwrap"><i class="icon power"></i>ON/OFF</span></button></div><div data-bind="invisible:rgVentilatorMode"><p class="bluetit">#=ventilatorMode#</p><div id="rgVentilatorMode" class="radiogroup"></div></div><div data-bind="invisible:isRgVentilatorFanSpeed()"><p class="bluetit">#=ventilatorFanSpeed#</p><div id="rgVentilatorFanSpeed" class="radiogroup"></div></div></div></li><li id="item3">#=dhw#<div class="innerBox" style="height: 490px;" data-bind="invisible:hideDHW"><div data-bind="invisible:btnPower2"><button id="btnPower2" class="colorbox"><span class="icwrap"><i class="icon power"></i>ON/OFF</span></button></div><div data-bind="invisible:inpTemperature3"><p class="bluetit">#dhwTemp#</p><input id="inpTemperature3" title="#=setTemp#" disabled/></div><div data-bind="invisible:rgDhwOperationMode"><p class="bluetit">#=dhwOperationMode#</p><div id="rgDhwOperationMode" class="radiogroup"></div></div><div data-bind="invisible:isBtnTempLimit4()"><p class="bluetit">#=dhwUpperTempLimit#</p><div class="numeric"><div class="tb"><button id="btnTempLimit4" class="bound btncontrol" disabled>#=upperLimit#</button><input id="inpTempLimit4" disabled /></div></div></div></div></li><li id="item4">#=options#<div class="innerBox" style="height: 490px;"><div data-bind="invisible:rgOptionRemote"><p class="bluetit">#remoteControl#</p><div id="rgOptionRemote" class="radiogroup"></div></div><div data-bind="invisible:isBtnOption1()"><p class="bluetit">#=filterRest#</p><button id="btnOption1" class="colorbox" disabled>#=filterRest#</button></div><div data-bind="invisible:isBtnOption2()"><p class="bluetit">#=spiSetting#</p><button id="btnOption2" class="colorbox" disabled>ON/OFF</button></div></div></li></ul></div>');s=s(a),pe(e).html(s);var l,d,c,u=[],p=[],h=[],f="single";for(n.options.groupMode&&(f="multiple"),n.panelBar=m=pe("#panelbar").kendoPanelBar({expandMode:f,select:function(e){if(!n.options.groupMode&&pe(e.item).is(".k-state-active")){var t=this;window.setTimeout(function(){t.collapse(e.item)},1)}},collapse:function(e){n.options.groupMode&&e.preventDefault();var t=pe(e.item).index();e.index=t;var i=n.getExpandedData();i[t]&&(i[t].expanded=!1),e.expandedData=i,n.trigger("collapse",e)},expand:function(e){var t=pe(e.item).index();e.index=t;var i=n.getExpandedData();i[t]&&(i[t].expanded=!0),e.expandedData=i,n.trigger("expand",e)},activate:function(e){var t=this.element.find("li.k-item.k-state-highlight.k-state-active");if(!(t.length<1)){var i=t.height()-t.find(".k-link.k-header").outerHeight(),a=t.find(".innerBox");a.height(i),a.css("overflow-y","auto"),a.css("overflow-x","hidden")}}}).data("kendoPanelBar"),n.options.groupMode&&(m.element.addClass("group"),m.expand(pe('[id^="item"]'),!1)),n._initRadioGroup(),l=0;l<3;l++)d=pe("#btnPower"+l),u[l]=d.kendoCustomControlButton({index:l,change:function(e){var t=this.options.index;1===t&&u[0].enable("On"===e.state),n.trigger("change",{item:{value:e.state},index:"0",subIndex:t})}}).data("kendoCustomControlButton");for(l=0;l<4;l++)d=pe("#btnChiller"+l),h[l]=0===l?d.kendoCustomControlButton({index:l,change:function(e){n._enableByChillerWater(e.state),n.trigger("change",{item:{value:e.state},index:"12",subIndex:this.options.index})}}).data("kendoCustomControlButton"):3===l?d.kendoCustomControlButton({index:l,change:function(e){v.enable(e.isSelected),n.trigger("change",{item:{value:e.state},index:"12",subIndex:this.options.index})}}).data("kendoCustomControlButton"):d.kendoCustomControlButton({index:l,change:function(e){n.trigger("change",{item:{value:e.state},index:"12",subIndex:this.options.index})}}).data("kendoCustomControlButton");for(l=0;l<4;l++)d=pe("#inpTemperature"+l),c=r,3===l&&(c=1),C[l]=d.kendoCustomNumericBox({index:l,unit:i,step:c,spin:function(e){var t,i=this.options.index;2===i&&(t=y[1].value()),n.trigger("change",{item:{value:this.value()},index:"15",subIndex:i,mode:t})}}).data("kendoCustomNumericBox");for(l=0;l<5;l++){d=pe("#inpTempLimit"+l),c=r,4===l&&(c=1),k[l]=d.kendoCustomNumericBox({index:l,unit:i,step:c,spin:function(e){var t=this.options.index,i=this.value();n._setByTemperatureLimit(t,i),n.trigger("change",{item:{value:i},index:"14",subIndex:t})}}).data("kendoCustomNumericBox");var g=pe("#btnTempLimit"+l);p[l]=g.kendoCustomControlButton({index:l,isChangeText:!1,change:function(e){var t,i=e.isSelected,a=this.options.index;k[a].enable(i),i&&(t=k[a].value()),n._setByTemperatureLimit(a,t),n.trigger("change",{item:{value:i},index:"5",subIndex:a})}}).data("kendoCustomControlButton")}for(p[5]=pe("#btnDischarge").kendoCustomControlButton({index:4,change:function(e){var t=y[3],i=e.isSelected,a=y[1].value();!i||"Heat"!==a&&"Cool"!==a?t[2].enable(!1):t[2].enable(t[2].oriEnable()),n.trigger("change",{item:{value:i},index:"15",subIndex:this.options.index})}}).data("kendoCustomControlButton"),l=1;l<4;l++)d=pe("#btnOption"+l),I[l]=1===l?d.kendoCustomControlButton({index:l,isCheckMode:!1,change:function(e){n.trigger("change",{item:{value:!0},index:"6",subIndex:this.options.index})}}).data("kendoCustomControlButton"):3===l?d.kendoCustomControlButton({index:l,change:function(e){n._enableByOptionWindFree(e.state),n.trigger("change",{item:{value:e.state},index:"6",subIndex:this.options.index})}}).data("kendoCustomControlButton"):d.kendoCustomControlButton({index:l,change:function(e){n.trigger("change",{item:{value:e.state},index:"6",subIndex:this.options.index})}}).data("kendoCustomControlButton");y[0]=u,y[3]=C,y[5]=p,y[12]=h,y[6]=I,v=pe("#inpDemand").kendoCustomNumericBox({step:5,unit:"%",format:"#",spin:function(e){n.trigger("change",{item:{value:this.value()},index:"17"})}}).data("kendoCustomNumericBox"),n.options.groupMode||m.collapse(),n.viewModel=_.observable({isWindDirection:function(){return!!n.options.groupMode||this.get("rgIndoorWindDirection0")&&this.get("rgIndoorWindDirection1")},isInpTemperature1:function(){return!!n.options.groupMode||this.get("inpTemperature1")},isInpTemperature2:function(){return!!n.options.groupMode||this.get("inpTemperature2")},isIndoorTemperature:function(){return n.options.groupMode?this.get("inpTemperature1")&&this.get("inpTemperature2"):this.get("inpTemperature0")&&this.get("inpTemperature1")&&this.get("inpTemperature2")},isIndoorTempLimit:function(){return!!n.options.groupMode||this.get("btnTempLimit0")&&this.get("btnTempLimit1")},isIndoorWaterOutTempLimit:function(){return!!n.options.groupMode||this.get("btnTempLimit2")&&this.get("btnTempLimit3")},isRgIndoorFanSpeed:function(){return!!n.options.groupMode||this.get("rgIndoorFanSpeed")},isRgIndoorOperationLimit:function(){return!!n.options.groupMode||this.get("rgIndoorOperationLimit")},isRgIndoorChillerMcc:function(){return!!n.options.groupMode||this.get("rgIndoorChillerMcc")},isBtnDischarge:function(){return!!n.options.groupMode||this.get("btnDischarge")},isBtnChiller0:function(){return!!n.options.groupMode||this.get("btnChiller0")},isBtnChiller1:function(){return!!n.options.groupMode||this.get("btnChiller1")},isBtnChiller2:function(){return!!n.options.groupMode||this.get("btnChiller2")},isBtnChiller3:function(){return!!n.options.groupMode||this.get("btnChiller3")},isBtnOption1:function(){return!!n.options.groupMode||this.get("btnOption1")},isBtnOption2:function(){return!!n.options.groupMode||this.get("btnOption2")},isBtnOption3:function(){return!!n.options.groupMode||this.get("btnOption3")},isRgVentilatorFanSpeed:function(){return!!n.options.groupMode||this.get("rgVentilatorFanSpeed")},isBtnTempLimit4:function(){return!!n.options.groupMode||this.get("btnTempLimit4")}}),_.bind(pe("#panelbar"),n.viewModel)},_setByTemperatureLimit:function(e,t){var i,a,n,o,r,s,l=y[1].value();4===e?(s=(r=y[o=3])[o].value(),t||void 0===he.DHW||(t=he.DHW.MAX),void 0!==fe.DHW&&(fe.DHW.MAX=t),r[o].max(t),r[o].value(s)):(0===e?(o=0,i="Room",a="Cool",n="MIN"):1===e?(o=0,i="Room",a="Heat",n="MAX"):2===e?(o=1,i="WaterOut",a="Cool",n="MIN"):3===e&&(o=1,i="WaterOut",a="Heat",n="MAX"),t=t||he[i][a][n],fe[i][a][n]=t,l===a&&(s=(r=y[3])[o].value(),"MIN"===n?r[o].min(t):r[o].max(t),r[o].value(s)))},_initRadioGroup:function(){var i=this,e=[{id:0,value:"Auto",icon:"ic-auto-g",text:D.prop("FACILITY_INDOOR_MODE_AUTO")},{id:1,value:"Cool",icon:"ic-cool-g",text:D.prop("FACILITY_INDOOR_MODE_COOL")},{id:2,value:"Heat",icon:"ic-heat-g",text:D.prop("FACILITY_INDOOR_MODE_HEAT")},{id:3,value:"Dry",icon:"ic-dry-g",text:D.prop("FACILITY_INDOOR_MODE_DRY")},{id:4,value:"Fan",icon:"ic-fan-g",text:D.prop("FACILITY_INDOOR_MODE_FAN")}],t=[{id:0,value:"CoolStorage",icon:"ic-coolwater-g ",text:D.prop("FACILITY_INDOOR_MODE_COOLST")},{id:1,value:"HeatStorage",icon:"ic-hotwater-g",text:D.prop("FACILITY_INDOOR_MODE_HOTWATER")}],a=[{id:0,value:"Auto",icon:"ic-fan-auto-g",text:D.prop("FACILITY_CONTROL_INDOOR_FAN_SPEED_AUTO")},{id:1,value:"Low",icon:"ic-fan-low-g",text:D.prop("FACILITY_CONTROL_INDOOR_FAN_SPEED_LOW")},{id:2,value:"Mid",icon:"ic-fan-mid-g",text:D.prop("FACILITY_CONTROL_INDOOR_FAN_SPEED_MID")},{id:3,value:"High",icon:"ic-fan-high-g",text:D.prop("FACILITY_CONTROL_INDOOR_FAN_SPEED_HIGH")},{id:4,value:"Turbo",icon:"ic-fan-turbo-g",text:D.prop("FACILITY_CONTROL_INDOOR_FAN_SPEED_TURBO")}],n=[{id:0,value:"UpDown",icon:"ic-wind-vertical-g",text:D.prop("FACILITY_CONTROL_INDOOR_WIND_DIRECTION_VERTICAL")},{id:1,value:"LeftRight",icon:"ic-wind-horizon-g",text:D.prop("FACILITY_CONTROL_INDOOR_WIND_DIRECTION_HORIZONTAL")},{id:2,value:"All",icon:"ic-wind-all-g",text:D.prop("FACILITY_CONTROL_INDOOR_WIND_DIRECTION_ALL")},{id:3,value:"Fix",icon:"ic-wind-fix-g",text:D.prop("FACILITY_CONTROL_INDOOR_WIND_DIRECTION_FIX")}],o=[{id:0,value:"Spot",icon:"ic-wind-spot-g",text:D.prop("FACILITY_CONTROL_INDOOR_WIND_DIRECTION_SPOT")},{id:1,value:"Mid",icon:"ic-wind-mid-g",text:D.prop("FACILITY_CONTROL_INDOOR_WIND_DIRECTION_MID")},{id:2,value:"Wide",icon:"ic-wind-wide-g",text:D.prop("FACILITY_CONTROL_INDOOR_WIND_DIRECTION_WIDE")},{id:3,value:"Swing",icon:"ic-wind-swing-g",text:D.prop("FACILITY_CONTROL_INDOOR_WIND_DIRECTION_SWING")}],r=[{id:0,value:"CoolOnly",icon:"ic-cool-g",text:D.prop("FACILITY_INDOOR_MODE_COOLONLY")},{id:1,value:"HeatOnly",icon:"ic-heat-g",text:D.prop("FACILITY_INDOOR_MODE_HEATONLY")},{id:2,value:"NoLimit",icon:"ic-nolimit-g",text:D.prop("FACILITY_INDOOR_MODE_NOLIMIT")}],s=[{id:0,value:"Standard",icon:"ic-pattern-all-g",text:D.prop("FACILITY_CONTROL_INDOOR_CHILLER_MCC_STANDARD")},{id:1,value:"Rotation",icon:"ic-pattern-rotate-g",text:D.prop("FACILITY_INDOOR_MODE_ROTATION")},{id:2,value:"Efficiency",icon:"ic-pattern-eff-g",text:D.prop("FACILITY_INDOOR_MODE_EFFICIENCY")}],l=[{id:0,value:"Auto",icon:"ic-heat-auto-g",text:D.prop("FACILITY_INDOOR_MODE_AUTO")},{id:1,value:"HeatExchange",icon:"ic-heat-ex-g",text:D.prop("FACILITY_INDOOR_MODE_HEATEX")},{id:2,value:"ByPass",icon:"ic-heat-bypass-g",text:D.prop("FACILITY_INDOOR_MODE_BYPASS")},{id:3,value:"Sleep",icon:"ic-heat-sleep-g",text:D.prop("FACILITY_INDOOR_MODE_SLEEP")}],d=[{id:0,value:"Mid",icon:"ic-fan-mid-g",text:D.prop("FACILITY_INDOOR_CONTROL_LOW_MID")},{id:1,value:"High",icon:"ic-fan-high-g",text:D.prop("FACILITY_CONTROL_VENTILATOR_FAN_SPEED_HIGH")},{id:2,value:"Turbo",icon:"ic-fan-turbo-g",text:D.prop("FACILITY_CONTROL_VENTILATOR_FAN_SPEED_TURBO")}],c=[{id:0,value:"Eco",icon:"ic-dhw-eco-g",text:D.prop("FACILITY_INDOOR_MODE_ECO")},{id:1,value:"Standard",icon:"ic-dhw-standard-g",text:D.prop("FACILITY_INDOOR_MODE_STANDARD")},{id:2,value:"Power",icon:"ic-dhw-power-g",text:D.prop("FACILITY_INDOOR_MODE_POWER")},{id:3,value:"Force",icon:"ic-dhw-force-g",text:D.prop("FACILITY_INDOOR_MODE_FORCE")}],u=[{id:0,value:"Allowed",text:D.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_PERMIT")},{id:1,value:"NotAllowed",text:D.prop("FACILITY_CONTROL_OPTION_REMOTE_CONTROL_PROHIBIT")}],p=pe("#rgIndoorMode").kendoCustomRadioButtonGroup({dataSource:e,groupName:"rgIndoorMode",id:"id",value:"value",icon:"icon",text:"text",index:"1",change:function(e){h.clear();var t=e.dataItem.value;i._enableByIndoorMode(t,!0),i._changeRadioGroupEvent(e)}}).data("kendoCustomRadioButtonGroup"),h=pe("#rgChillerMode").kendoCustomRadioButtonGroup({dataSource:t,groupName:"rgChillerMode",id:"id",value:"value",icon:"icon",text:"text",index:"16",change:function(e){p.clear();var t=e.dataItem.value;i._enableByIndoorMode(t),i._changeRadioGroupEvent(e)}}).data("kendoCustomRadioButtonGroup"),f=pe("#rgIndoorFanSpeed").kendoCustomRadioButtonGroup({dataSource:a,groupName:"rgIndoorFanSpeed",id:"id",value:"value",icon:"icon",text:"text",index:"2",change:function(e){i._changeRadioGroupEvent(e)}}).data("kendoCustomRadioButtonGroup"),g=pe("#rgIndoorOperationLimit").kendoCustomRadioButtonGroup({dataSource:r,groupName:"rgIndoorOperationLimit",id:"id",value:"value",icon:"icon",text:"text",index:"4",change:function(e){var t=e.dataItem.value;i._enableByLimit(t,!0),i._changeRadioGroupEvent(e)}}).data("kendoCustomRadioButtonGroup"),m=pe("#rgIndoorWindDirection0").kendoCustomRadioButtonGroup({dataSource:n,groupName:"rgIndoorWindDirection0",id:"id",value:"value",icon:"icon",text:"text",index:"7",change:function(e){i._changeRadioGroupEvent(e)}}).data("kendoCustomRadioButtonGroup"),v=pe("#rgIndoorWindDirection1").kendoCustomRadioButtonGroup({dataSource:o,groupName:"rgIndoorWindDirection1",id:"id",value:"value",icon:"icon",text:"text",index:"8",change:function(e){i._changeRadioGroupEvent(e)}}).data("kendoCustomRadioButtonGroup"),_=pe("#rgVentilatorMode").kendoCustomRadioButtonGroup({dataSource:l,groupName:"rgVentilatorMode",id:"id",value:"value",icon:"icon",text:"text",index:"9",change:function(e){i._enableByVentilatorMode(e.dataItem.value,!0),i._changeRadioGroupEvent(e)}}).data("kendoCustomRadioButtonGroup"),b=pe("#rgVentilatorFanSpeed").kendoCustomRadioButtonGroup({dataSource:d,groupName:"rgVentilatorFanSpeed",id:"id",value:"value",icon:"icon",text:"text",index:"10",change:function(e){i._changeRadioGroupEvent(e)}}).data("kendoCustomRadioButtonGroup"),C=pe("#rgDhwOperationMode").kendoCustomRadioButtonGroup({dataSource:c,groupName:"rgDhwOperationMode",id:"id",value:"value",icon:"icon",text:"text",index:"11",change:function(e){i._changeRadioGroupEvent(e)}}).data("kendoCustomRadioButtonGroup"),k=pe("#rgIndoorChillerMcc").kendoCustomRadioButtonGroup({dataSource:s,groupName:"rgIndoorChillerMcc",id:"id",value:"value",icon:"icon",text:"text",index:"13",change:function(e){i._changeRadioGroupEvent(e)}}).data("kendoCustomRadioButtonGroup"),w=pe("#rgOptionRemote").kendoCustomRadioButtonGroup({dataSource:u,groupName:"rgOptionRemote",id:"id",value:"value",text:"text",change:function(e){i.trigger("change",{item:e.dataItem,index:"6",subIndex:0})}}).data("kendoCustomRadioButtonGroup");y[1]=p,y[16]=h,y[2]=f,y[4]=g,y[7]=m,y[8]=v,y[9]=_,y[10]=b,y[11]=C,y[13]=k,I[0]=w},_enableByOptionWindFree:function(e){var t,i,a,n=["2","7","8"],o=n.length;if("on"===e.toLowerCase())for(t=0;t<o;t++)(a=y[n[t]]).enable(!1);else for(t=0;t<o;t++){var r=(a=y[n[t]]).count();for(i=0;i<r;i++)a.enable(i,a.oriEnable(i)),a.value(a.options.checkedValue)}},_enableByChillerWater:function(e){var t=y[3],i=!0;"on"===e.toLowerCase()&&(i=!1),t[0].enable(i&&t[0].oriEnable)},_enableByLimit:function(e){var t,i,a,n=y[1],o=n.value(),r=n.count(),s=[];for(t=0;t<r;t++)s[t]=!0;if("CoolOnly"===e)i="Auto",a="Heat",s[0]=s[2]=!1;else if("HeatOnly"===e&&(i="Auto",a="Cool",s[0]=s[1]=s[3]=!1,o===i||o===a||"Dry"===o))for(t=0;t<r&&(!s[t]||!n.oriEnable(t));t++);for(t=0;t<r;t++)n.enable(t,s[t]&&n.oriEnable(t))},_enableByIndoorMode:function(e){var t,i,a=y[2],n=y[3],o=I[3],r=[],s=a.count(),l=!0,d=!0;for(t=0;t<s;t++)r[t]=!0;if("Auto"===e||"Dry"===e){for(t=1;t<s;t++)r[t]=!1;this.viewModel.get("inpTemperature1")||"Auto"!==e||(l=!1),d=!1}else if("Fan"===e){for(r[0]=!1,t=1;t<s&&!a.oriEnable(t);t++);d=l=!1}for("Auto"===e||"Heat"===e?(o.enable(!1),this._enableByOptionWindFree("off")):o.enable(o.oriEnable),"CoolStorage"!==e&&"HeatStorage"!==e||(l=!0,"HeatStorage"===e&&(e="HotWater")),l&&n[0].oriEnable()&&(i=fe.Room[e])&&(n[0].min(i.MIN),n[0].max(i.MAX),n[0].value(i.SET)),n[0].enable(l&&n[0].oriEnable()),l&&n[1].oriEnable()&&((i=fe.WaterOut[e])?(n[1].min(i.MIN),n[1].max(i.MAX),i.SET||(i.SET=n[1].value()),n[1].value(i.SET)):l=!1),n[1].enable(l&&n[1].oriEnable()),(d=d&&y[5][5].isSelected())&&n[2].oriEnable()&&(i=fe.Discharge[e])&&(n[2].min(i.MIN),n[2].max(i.MAX),n[2].value(i.SET)),n[2].enable(d&&n[2].oriEnable()),t=0;t<s;t++)a.enable(t,r[t]&&a.oriEnable(t))},_enableByVentilatorMode:function(e){var t,i=y[10],a=[],n=i.count();for(t=0;t<n;t++)a[t]=!0;if("Sleep"===e)for(t=1;t<n;t++)a[t]=!1;for(t=0;t<n;t++)i.enable(t,a[t]&&i.oriEnable(t))},_changeRadioGroupEvent:function(e){var t=e.dataItem,i=e.sender.options.index;this.trigger("change",{item:t,index:i})},_calcEachData:function(e,t){for(var i=t.length,a=0;a<i;a++)if(void 0===e[a])e[a]=t[a];else{if(void 0===t[a])continue;e[a]!=t[a]&&(e[a]="")}},_calcMinMaxData:function(e,t,i,a){for(var n,o=0;o<ge.length;o++){var r=e[ge[o]],s=t[ge[o]];if(r=r||[],s){n=s.length;for(var l=0;l<n;l++)if(void 0===r[l]){if(void 0===s[l]){r[l]=s[l];continue}r[l]=parseFloat(s[l])}else{if(void 0===s[l])continue;0==o?r[l]>s[l]&&(r[l]=s[l]):1==o?r[l]<s[l]&&(r[l]=s[l]):a?r[l]=this._accureAverage(s[l],r[l],++i[l]):0==l||2==l?r[l]>s[l]&&(r[l]=s[l]):r[l]<s[l]&&(r[l]=s[l])}e[ge[o]]=r}}},_calcAvgData:function(e,t,i){return void 0===t?e:(void 0===e&&(e=t),1<i[0]?100:t)},_accureAverage:function(e,t,i){return(e+i*t)/(i+1)},parseEnableData:function(){var e=[],t=this.options.dataSource;if(t){var i,a=t.length;for(i=0;i<14;i++)e.push(0);for(i=0;i<a;i++){var n=t[i];if(n.airConditioner){var o=n.airConditioner.panelConfigurationInformation;if(o)for(var r=0;r<14;r++)e[r]|=parseInt(o[r],16)}}this._enableUI(e)}},parseData:function(){var e,t,i=this,a=[],n=[],o=[],r=[],s=[],l=[],d=[],c=[],u={},p={},h=[];for(t=0;t<14;t++)a.push(0);var f=i.options.dataSource,g=f.length,m=1===g,v=[0,0,0,0],_=[0,0,0,0,0],b=[0];for(fe={},t=0;t<g;t++){var C=f[t],k=C.airConditioner.installationInformation;if(k){var w,D,y,I=C.operations,S=[];if(I)w=pe.grep(I,function(e){return"AirConditioner.Indoor.General"==e.id}),D=pe.grep(I,function(e){return"AirConditioner.Indoor.Ventilator"==e.id}),y=pe.grep(I,function(e){return"AirConditioner.Indoor.DHW"==e.id}),S=[w[0]?w[0].power:void 0,D[0]?D[0].power:void 0,y[0]?y[0].power:void 0];var x,A=C.modes,O=[];if(A){w=pe.grep(A,function(e){return"AirConditioner.Indoor.General"==e.id}),D=pe.grep(A,function(e){return"AirConditioner.Indoor.Ventilator"==e.id}),y=pe.grep(A,function(e){return"AirConditioner.Indoor.DHW"==e.id});var E=pe.grep(A,function(e){return"AirConditioner.Indoor.ModeLimit"==e.id});O=[x=w[0]?w[0].mode:void 0,D[0]?D[0].mode:void 0,y[0]?y[0].mode:void 0,E[0]?E[0].mode:void 0]}var T=C.winds,M=[],L=[];if(T){var N=pe.grep(T,function(e){return"AirConditioner.Indoor.General.Speed"==e.id}),F=pe.grep(T,function(e){return"AirConditioner.Indoor.Ventilator.Speed"==e.id}),R=pe.grep(T,function(e){return"AirConditioner.Indoor.General.Direction"==e.id});M=[N[0]?N[0].wind:void 0,F[0]?F[0].wind:void 0],L=[R[0]?R[0].wind:void 0]}var B,P,G=C.airConditioner,V=[],H=[];if(G){V=[G.filterResetRequired,G.spi,G.stillAir];var z=G.chiller;P=[],z&&(P=[z.mccMode,z.waterLaw,z.quiet,z.forcedFan,z.demand],(H=[z.demandLevel])&&0<=H&&b[0]++),B=G.temperatureReference}var W,U=C.configuration;U&&(W=[U.remoteControl]);var Z=C.temperatures,Y={},j=[],q={};if(Z&&Z.length){var Q=[];Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.Room.Cool.Limit"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.Room.Heat.Limit"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.WaterOutlet.Cool.Limit"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.WaterOutlet.Heat.Limit"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.DHW.Limit"==e.id}));var X,K,$,J,ee,te,ie,ae=ge[0],ne=ge[1],oe=ge[2],re=Q.length;for(X=0;X<re;X++)K=Q[X][0],Y[ae]||(Y[ae]=[]),Y[ne]||(Y[ne]=[]),Y[oe]||(Y[oe]=[]),K?(Y[ae][X]=K.minimum,Y[ne][X]=K.maximum,Y[oe][X]=K.desired,j.push(K.enabled)):(Y[ae][X]=K,Y[ne][X]=K,Y[oe][X]=K,j.push(K));if(fe.Room||(fe.Room={}),fe.WaterOut||(fe.WaterOut={}),fe.Discharge||(fe.Discharge={}),q[ae]||(q[ae]=[]),q[ne]||(q[ne]=[]),q[oe]||(q[oe]=[]),K=void 0,B&&"Indoor"===B)if((K=pe.grep(Z,function(e){return"AirConditioner.Indoor.Room"==e.id}))&&K.length){for($=K[0].desired,(Q=[]).push(pe.grep(Z,function(e){return"AirConditioner.Indoor.Room.Auto"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.Room.Cool"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.Room.Heat"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.Room.Dry"==e.id})),re=Q.length,X=0;X<re;X++){switch(ie=Q[X][0],X){case 0:te="Auto";break;case 1:te="Cool";break;case 2:te="Heat";break;case 3:te="Dry";break;default:te="Default"}ie&&(J=ie.minimum,ee=ie.maximum,fe.Room[te]||(fe.Room[te]={}),fe.Room[te][ae]=J,fe.Room[te][ne]=ee)}var se=fe.Room[x];se?(q[ae][0]=se[ae],q[ne][0]=se[ne],q[oe][0]=$):q[ae][0]=q[ne][0]=q[oe][0]=se}else $=K;if(K=void 0,B&&"WaterOutlet"===B)if((K=pe.grep(Z,function(e){return"AirConditioner.Indoor.WaterOutlet"==e.id}))&&K.length){for($=K[0].desired,(Q=[]).push(pe.grep(Z,function(e){return"AirConditioner.Indoor.WaterOutlet.Auto"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.WaterOutlet.Cool"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.WaterOutlet.Heat"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.WaterOutlet.Dry"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.WaterOutlet.CoolStorage"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.WaterOutlet.HeatStorage"==e.id})),re=Q.length,X=0;X<re;X++){switch(ie=Q[X][0],X){case 0:te="Auto";break;case 1:te="Cool";break;case 2:te="Heat";break;case 3:te="Dry";break;case 4:te="CoolStorage";break;case 5:te="HotWater";break;default:te="Default"}ie&&(J=ie.minimum,ee=ie.maximum,fe.WaterOut[te]||(fe.WaterOut[te]={}),fe.WaterOut[te][ae]=J,fe.WaterOut[te][ne]=ee)}var le=fe.WaterOut[x];le?(q[ae][1]=le[ae],q[ne][1]=le[ne],q[oe][1]=$):q[ae][1]=q[ne][1]=q[oe][1]=void 0}else q[ae][1]=q[ne][1]=q[oe][1]=void 0;(Q=[]).push(pe.grep(Z,function(e){return"AirConditioner.Indoor.DischargeAir.Cool"==e.id})),Q.push(pe.grep(Z,function(e){return"AirConditioner.Indoor.DischargeAir.Heat"==e.id})),re=Q.length;var de=!1;for(X=0;X<re;X++)if(ie=Q[X][0]){switch(de=!0,X){case 0:te="Cool";break;case 1:te="Heat";break;default:te="Default"}J=ie.minimum,ee=ie.maximum,fe.Discharge[te]||(fe.Discharge[te]={}),fe.Discharge[te][ae]=J,fe.Discharge[te][ne]=ee,fe.Discharge[te][oe]=ie.desired}var ce=fe.Discharge[x];ce&&de?(q[ae][2]=ce[ae],q[ne][2]=ce[ne],q[oe][2]=ce[oe]):q[ae][2]=q[ne][2]=q[oe][2]=void 0,(K=pe.grep(Z,function(e){return"AirConditioner.Indoor.DischargeAir"==e.id}))&&K.length?(K=K[0],j.push(K.enabled)):j.push(K),(K=pe.grep(Z,function(e){return"AirConditioner.Indoor.DHW"==e.id}))&&K.length?(K=K[0],q[ae][3]=K.minimum,q[ne][3]=K.maximum,q[oe][3]=K.desired,fe.DHW||(fe.DHW={}),fe.DHW[ae]=K.minimum,fe.DHW[ne]=K.maximum):q[ae][3]=q[ne][3]=q[oe][3]=void 0,he=pe.extend(!0,{},fe)}for(var ue=0;ue<14;ue++)a[ue]|=parseInt(k[ue],16);i._calcEachData(n,S),i._calcEachData(o,O),i._calcEachData(r,M),i._calcEachData(s,L),i._calcEachData(l,V),i._calcEachData(d,W),i._calcEachData(c,P),i._calcMinMaxData(u,Y,_,m),i._calcEachData(h,j),i._calcMinMaxData(p,q,v,!0),e=i._calcAvgData(e,H[0],b)}}i._switchUI(a),i._setTempDigitUI(p,m),i._setPowerUI(n),i._setModeUI(o),i._setFanSpeedUI(r),i._setAirConditionUI(s),i._setOptionUI(l),i._setRemoteControlUI(d),i._setChillerUI(c,b),i._setDemandLevel(e),i._setTempLimitDigitUI(u,m),i._setTempLimitEnableUI(h)},_setDemandLevel:function(e){e?e<=v.max()&&e>=v.min()&&v.value(e):v.value("")},_setTempLimitEnableUI:function(e){var t,i,a=e.length,n=y[5];if(a)for(i=0;i<a;i++){t=n[i];var o=n[i].options.enable,r="ON/OFF";!0===e[i]?o?(r="ON",k[i]&&(k[i].enable(!0),this._setByTemperatureLimit(i,k[i].value()))):r="OFF":!1===e[i]&&(r="OFF",k[i]&&k[i].enable(!1)),t.select(r)}else for(i=0;i<=5;i++)(t=n[i]).select("ON/OFF"),i<5&&k[i].enable(!1)},_setTempDigitUI:function(e,t){var i,a;for(a=0;a<ge.length;a++){var n=e[ge[a]];if(n){var o=n.length;if(o)for(i=0;i<o;i++){var r=C[i],s=n[i];0==a?r.min(s):1==a?r.max(s):(t||(s=Math.round(s)),r.value(s))}}else for(i=0;i<4;i++)C[i].value("")}},_setTempLimitDigitUI:function(e,t){for(var i=0;i<ge.length;i++){var a=e[ge[i]];if(a){var n=a.length;if(n)for(var o=0;o<n;o++){var r;r=k[o];var s=a[o];0==i?r.min(s):1==i?r.max(s):(t||(s=Math.round(s)),r.value(s))}}}},_setChillerUI:function(e,t){var i,a=e.length,n=y[12];if(a){var o,r=y[13];for(i=0;i<a;i++)if(0==i){if(r.clear(),!(o=e[i]).length)continue;r.value(o)}else{var s=e[i];o=s&&s.length?s.toUpperCase():"ON/OFF",n[i-1].select(o),i==a-1&&(1<t[0]?v.enable("OFF"!=o):v.enable("ON"==o))}}else for(a=n.length,i=0;i<a;i++)n[i].select("ON/OFF")},_setOptionUI:function(e){var t,i=e.length,a=y[6];if(i)for(t=0;t<i;t++){var n,o=t+1,r=e[t];"string"==typeof r&&(r="On"===r||"Off"!==r&&void 0),n=1==o?D.prop("FACILITY_INDOOR_CONTROL_FILTER_RESET"):!0===r?"ON":!1===r?"OFF":"ON/OFF",a[o].select&&a[o].select(n)}else for(t=1;t<4;t++)a[t].select&&a[t].select("ON/OFF")},_setRemoteControlUI:function(e){var t=e.length,i=y[6][0];if(t){i.clear();var a=e[0];a&&a.length&&i.value(a)}else i.clear()},_setAirConditionUI:function(e){for(var t=e[0],i="7";i<="8";i++){var a=y[i];a.clear(),t&&a.value(t)}},_setFanSpeedUI:function(e){for(var t=["2","10"],i=e.length,a=0;a<i;a++){var n=y[t[a]];n.clear();var o=e[a];o&&o.length&&n.value(o)}},_setModeUI:function(e){for(var t=["1","9","11","4"],i=e.length,a=0;a<i;a++){var n,o=t[a];0===a&&(n=y[16]).clear(),(n=y[o]).clear();var r=e[a];r&&r.length&&("CoolStorage"!==r&&"HeatStorage"!==r&&"HotWater"!==r||(n=y[16],"HotWater"===r&&(r="HeatStorage")),1===a&&"Normal"===r&&(r="ByPass"),n.value(r))}},_setPowerUI:function(e){var t,i=e.length,a=y[0],n=m.element.children().filter(".k-state-active");if(i){var o,r=n.index();for(t=0;t<i;t++){var s,l=e[t];void 0!==l?(0!==t&&1!==t||(o=m.wrapper.children()[t]),s=l&&l.length?l.toUpperCase():"ON/OFF",a[t].options.enable&&a[t].select(s)):r!==t||this.options.groupMode||(m.collapse(n),r=-1)}o&&-1===r&&!this.options.groupMode&&m.expand(o)}else{for(t=0;t<3;t++)a[t].select("ON/OFF");this.options.groupMode||m.collapse(n)}},_switchUI:function(e){var t,i,a,n,o=this;for(i=0,n=e.length;i<n;i++)if(y.hasOwnProperty(i+"")){var r,s,l=y[i+""],d=o.convertBase.dec2bin(e[i]);s=l.length?(r=l.length,!1):(r=l.count(),l.oriEnable(),!0);var c,u=[];1===i&&(r+=(c=y[16]).count());var p,h=0;for(a=0;a<r;a++){var f=d[d.length-a-1];t=!(!f||"1"!=f),1===i&&5<=a?u.push(t):5===i&&5===a||(s?(l.oriEnable(a,t),o.viewModel.set(l.id(a),!t),t||h++):((p=l[a]).oriEnable&&p.oriEnable(t),o.viewModel.set(p.element.attr("id"),!t)))}if(3===i&&(p=y[5][5],8<=d.length?(p.oriEnable&&p.oriEnable(!0),o.viewModel.set(p.element.attr("id"),!1)):o.viewModel.set(p.element.attr("id"),!0)),1===i&&c){var g=0;t=void 0;var m=c.count();for(a=0;a<m;a++)t=u[a],c.oriEnable(a,t),o.viewModel.set(c.id(a),!t),t||g++;g===m?o.viewModel.set(c.element.attr("id"),!0):o.viewModel.set(c.element.attr("id"),!1)}if(s){var v=l.element;1==i&&(r=l.count()),h===r?(o.viewModel.set(v.attr("id"),!0),v.css("display","none")):(o.viewModel.set(v.attr("id"),!1),v.css("display","inline-block"))}}},_enableUI:function(e){var t,i,a,n;for(i=0,n=e.length;i<n;i++)if(y.hasOwnProperty(i+"")){var o,r,s=y[i+""],l=this.convertBase.dec2bin(e[i]);r=s.length?(o=s.length,!1):(o=s.count(),!0);var d,c=[];for(1===i&&(o+=(d=y[16]).count()),a=0;a<o;a++){var u=l[l.length-a-1];if(t=!(!u||"1"!=u),1===i&&5<=a)c.push(t);else if(5!==i||5!==a)if(r)s.enable(a,t),s.options.checkedValue&&s.value(s.options.checkedValue);else{var p=s[a];5===i&&5===a&&this.viewModel.get("inpTemperature1")&&(t=!0),p.enable(t)}}if(3===i){var h=y[5][5];8<=l.length?h.enable(!0):h.enable(!1)}if(1===i&&d){var f=d.count();for(a=0;a<f;a++)t=c[a],d.enable(a,t)}}},convertBase:(i.bin2dec=i(2,10),i.bin2hex=i(2,16),i.dec2bin=i(10,2),i.dec2hex=i(10,16),i.hex2bin=i(16,2),i.hex2dec=i(16,10),i),setDataSource:function(e,t){this.options.dataSource=e,this.parseEnableData(),t||this.parseData()},getExpandedData:function(){var e=this.panelBar.element,a=[];return e.find("> li.k-item").each(function(e,t){var i=pe(t).attr("aria-expanded");i="true"==i,a.push({expanded:i})}),a},setExpandedData:function(e){var t,i,a,n=this.panelBar.element,o=e.length;for(t=0;t<o;t++)if(null!=(i=e[t].expanded)&&(a=n.find("> li.k-item:eq("+t+")"),i))return void this.panelBar.expand(a,!0)}});function i(t,i){return function(e){return parseInt(e,t).toString(i)}}e.plugin(t)}(jQuery),function(u){var p=window.kendo,n=p.ui,a=n.Widget,h=p.parseDate,o=p.keys,s=".kendoDatePicker",l="click"+s,d="k-state-default",c="k-state-disabled",f="aria-disabled",g="readonly",r="k-state-selected",m="mousedown"+s,v="aria-expanded",_="aria-hidden",b=p.calendar,C=b.isInRange,k=b.restrictValue,w=b.isEqualDatePart,D=u.extend,y=u.proxy,I=Date,i=window.moment;function S(e){var t=e.parseFormats,i=e.format;b.normalize(e),(t=u.isArray(t)?t:[t]).length||t.push("yyyy-MM-dd"),-1===u.inArray(i,t)&&t.splice(0,0,e.format),e.parseFormats=t}function x(e){e.preventDefault()}function A(e){var t,i=u("body").find(".datepicker-widget-window"),a=u("<div />").attr(_,"true").addClass("k-calendar-container");this.options=e=e||{},(t=e.id)&&(t+="_dateview",a.attr("id",t),this._dateViewID=t),this.popup=new n.Popup(a,D(e.popup,e,{name:"Popup",isRtl:p.support.isRtl(e.anchor)})),this.div=a,this.value(e.value),i.append(u(this.popup.element[0]))}A.prototype={_calendar:function(){var e,t=this,i=t.calendar,a=t.options;i||(e=u("<div />").attr("id",p.guid()).appendTo(t.popup.element).on(m,x).on(l,"td:has(.k-link)",y(t._click,t)),t.calendar=i=new n.Calendar(e),t._setOptions(a),p.calendar.makeUnselectable(i.element),i.navigate(t._value||t._current,a.start),t.value(t._value))},_setOptions:function(e){this.calendar.setOptions({focusOnNav:!1,change:e.change,culture:e.culture,dates:e.dates,depth:e.depth,footer:e.footer,format:e.format,max:e.max,min:e.min,month:e.month,weekNumber:e.weekNumber,start:e.start,disableDates:e.disableDates})},setOptions:function(e){var t=this.options,i=e.disableDates;i&&(e.disableDates=b.disabled(i)),this.options=D(t,e,{change:t.change,close:t.close,open:t.open}),this.calendar&&this._setOptions(this.options)},destroy:function(){this.popup.destroy()},open:function(e){this._calendar(),this.options.open()},close:function(e){var t=this.popup.element.closest(".datepicker-widget-window").data("kendoWindow");(t=t||e).close()},min:function(e){this._option("min",e)},max:function(e){this._option("max",e)},toggle:function(e){e.data("kendoWindow").options.visible&&(e.find(".k-calendar-container").hide(),this.close(),e.data("kendoWindow").close()),this.open()},move:function(e){e.preventDefault();var t=e.keyCode,i=this.calendar,a=e.ctrlKey&&t==o.DOWN||t==o.ENTER,n=!1;if(e.altKey)t==o.DOWN?(this.open(),e.preventDefault(),n=!0):t==o.UP&&(this.close(),e.preventDefault(),n=!0);else if(this.popup.visible()){if(t==o.ESC||a&&i._cell.hasClass(r))return this.close(),e.preventDefault(),!0;this._current=i._move(e),n=!0}return n},current:function(e){this._current=e,this.calendar._focus(e)},value:function(e){var t=this.calendar,i=this.options,a=i.disableDates;a&&a(e)&&(e=null),this._value=e,this._current=new I(+k(e,i.min,i.max)),t&&t.value(e)},_click:function(e){var t=this.popup.element.closest(".datepicker-widget-window");t&&t.data("closeable",!1),e.currentTarget.className.indexOf(r)},_option:function(e,t){var i=this.calendar;this.options[e]=t,i&&i[e](t)}},A.normalize=S,p.DateView=A;var O,e=n.DatePicker.extend({options:{name:"CommonDatePicker",format:"yyyy-MM-dd",animation:!1,footer:!1,readonly:!0,isStart:!1,isEnd:!1,value:new Date,okCallBack:function(){},buttons:"<div class='popup-footer'>\n<button data-event='ok' class='date'>OK</button>\n</div>"},init:function(l,e){var t=window.I18N;O=null;var d=this;this.selectedDate=null,a.fn.init.call(d,l,e),l=d.element,(e=d.options).disableDates=p.calendar.disabled(e.disableDates),e.min=h(l.attr("min"))||h(e.min),e.max=h(l.attr("max"))||h(e.max),S(e),d._initialOptions=D({},e),d._wrapper();var i=u("body").find(".datepicker-widget-window"),c=i.find(".k-calendar-container");0<i.length?(this.popupWindow=i,this.popupWindow.data("targetElem",null)):(this.popupWindow=u("<div/>").addClass("datepicker-widget-window").kendoWindow({title:"<span>"+t.prop("COMMON_DATE_PICKER")+"</span>",animation:!1,resizable:!1,draggable:!1,width:"275px",height:"340px"}),this.popupWindow.closest(".k-window").addClass("popup-date-picker"),this.popupWindow.closest(".k-window").find(".k-window-titlebar").append("<div class='embossBar'></div>"),this.popupWindow.append(this.options.buttons),this.popupWindow.closest(".k-window").find(".k-window-titlebar").find("a[role=button]").hide(),this.popupWindow.closest(".k-window").find(".k-window-titlebar").find(".k-window-actions").append("<span class='ic ic-close'><span/>"),u("body").on("click",function(e){var t=u(e.target),i=d.popupWindow.data("kendoWindow"),a=d.popupWindow.data("closeable");if(!t.is("span.ic.ic-bt-input-calendar")&&i.options.visible&&0==t.closest(".popup-date-picker").length){if(t.is(i.wrapper)||!a)return void d.popupWindow.data("closeable",!0);i.close()}}),this.popupWindow.data("dateView",d.dateView)),d.dateView=new A(D({},e,{id:l.attr("id"),anchor:d.wrapper,change:function(){d.selectedDate=this.value()},close:function(e){d.trigger("close")?e.preventDefault():(l.attr(v,!1),c.attr(_,!0))},open:function(e){var t,i=d.options;if(d.trigger("open"))e.preventDefault();else{var a=d.popupWindow.data("targetElem").closest(".k-datepicker"),n=d.popupWindow.closest(".k-window"),o=n.find(".k-animation-container");d.element.val()!==d._oldText&&(t=h(d.popupWindow.data("targetElem").val(),i.parseFormats,i.culture),d.dateView[t?"current":"value"](t)),l.attr(v,!0),c.attr(_,!1),d._updateARIA(t),d.value(new Date(d.popupWindow.data("targetElem").val())),d.popupWindow.data("kendoWindow").open(),n.css({top:a.offset().top,left:a.offset().left+a.width()+30});for(var r=0;r<o.length;r++){var s=o.eq(r);"block"==s.css("display")&&s.css("display","none")}u(d.dateView.div[0]).closest(".k-animation-container").css({overflow:"visible",display:"block",position:"relative",top:0,left:0}),u(d.dateView.div[0]).css({display:"block",transform:"none"})}}})),this.div=d.dateView.div,d._icon(),d.element.closest(".k-datepicker").addClass("k-input").find("span.k-select").find("span").removeClass("k-icon k-i-calendar").addClass("ic ic-bt-input-calendar"),d.element.keydown(function(e){return!1}),d.element.attr(g,!0);try{l[0].setAttribute("type","text")}catch(e){l[0].type="text"}l.addClass("k-input").attr({role:"combobox","aria-expanded":!1,"aria-owns":d.dateView._dateViewID}),d._reset(),d._template(),l.is("[disabled]")||u(d.element).parents("fieldset").is(":disabled")?d.enable(!1):d.readonly(l.is("[readonly]")),d._old=d._update(e.value||d.element.val()),d._oldText=l.val(),p.notify(d)},enable:function(e){void 0===e&&(e=!0),this._editable({readonly:!0,disable:!(e||e)})},_editable:function(e){var t=this,i=t._dateIcon.off(s),a=t.element.off(s),n=t._inputWrapper.off(s),o=e.readonly,r=e.disable;o||r?(n.addClass(r?c:d).removeClass(r?d:c),a.attr("disabled",r).attr(g,o).attr(f,r),r||i.on(l,y(t._click,t)).on(m,x)):(n.addClass(d).removeClass(c).on("mouseenter.kendoDatePicker mouseleave.kendoDatePicker",t._toggleHover),a.removeAttr("disabled").removeAttr(g).attr(f,!1).on("keydown"+s,y(t._keydown,t)).on("focusout"+s,y(t._blur,t)).on("focus"+s,function(){t._inputWrapper.addClass("k-state-focused")}),i.on(l,y(t._click,t)).on(m,x))},_click:function(e){var t=window.I18N,i=u(e.target),a=this;O=i.closest(".k-picker-wrap").find("input[data-role=commondatepicker]"),this.popupWindow.data("targetElem",O),this.popupWindow.data("targetDateView",O.data("kendoCommonDatePicker").dateView),this.dateView=this.popupWindow.data("targetDateView"),this.popupWindow.closest(".k-window").on("click",".k-window-titlebar .k-window-actions",function(){a.dateView.close(a.popupWindow.data("kendoWindow")),a.dateView.popup.close(),a.popupWindow.data("kendoWindow").close()}),this.popupWindow.on("mousedown",".popup-footer button[data-event=ok]",function(e){e.preventDefault()}),this.popupWindow.off("click",".popup-footer button[data-event=ok]"),this.popupWindow.on("click",".popup-footer button[data-event=ok]",function(e){var t;t=void 0===a.selectedDate?a.value():a.selectedDate,a.options.isStart?t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0):a.options.isEnd&&(t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59)),a._change(t),O.data("kendoCommonDatePicker")._callback(),a.dateView.close(),a.dateView.popup.close(),a.popupWindow.data("kendoWindow").close()}),this.popupWindow.find(".popup-footer button[data-event=ok]").text(t.prop("COMMON_BTN_OK")),a.dateView.toggle(this.popupWindow),a._initDate()},_initDate:function(){var e=this.getDate();this.setDate(e)},_update:function(e){var t,i=this.options,a=i.min,n=i.max,o=this._value,r=h(e,i.parseFormats,i.culture),s=null===r&&null===o||r instanceof Date&&o instanceof Date,l=this.element;return i.disableDates(r)&&(r=null,this._old||this.element.val()||(e=null)),+r==+o&&s?(t=p.toString(r,i.format,i.culture))!==e&&l.val(null===r?e:t):(null!==r&&w(r,a)?r=k(r,a,n):C(r,a,n)||(r=null),this._value=r,this.selectedDate=r,this.dateView.value(r),l.val(p.toString(r||e,i.format,i.culture)),this._updateARIA(r)),r},_change:function(e){var t,i=this,a=i.element.val();e=i._update(e);var n=(t=!p.calendar.isEqualDate(i._old,e))&&!i._typing,o=a!==i.element.val();(n||o)&&i.element.trigger("change"),t&&(i._old=e,i._oldText=i.element.val(),i.trigger("change")),i._typing=!1},_callback:function(){this.options.okCallBack()},setDate:function(e){this._change(e)},getDate:function(){var e=this.value();return this.options.isStart?e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0):this.options.isEnd&&(e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59)),this.convertDateFormatForURL(e)},convertDateFormat:function(e){return i(e).format("L").replace(/\./g,"-")},convertDateFormatForURL:function(e){var t=i(e).format("YYYY-MM-DDTHH:mm:ss");return t+="+09:00"},destroy:function(){p.ui.DatePicker.fn.destroy.call(this)}});n.plugin(e)}(jQuery),function(f){var k=window.kendo,o=k.keys,c=k.parseDate,u=k._extractFormat,n=k.support,r=n.browser,s=k.ui,p=s.Widget,l=".kendoTimePicker",w=6e4,D=864e5,d="k-state-default",h="aria-disabled",i="k-state-selected",a="aria-selected",g="aria-expanded",m="aria-hidden",v="aria-activedescendant",_="click"+l,b="k-state-disabled",C="mousedown"+l,y=f.isArray,I=f.extend,S=f.proxy,x=Date,A=new x;function O(e){e.preventDefault()}A=new x(A.getFullYear(),A.getMonth(),A.getDate(),0,0,0);function E(e){var t=this,i=e.id,a=f("body").find(".timepicker-widget-window"),n=window.GlobalSettings.getTimeDisplay(),o=window.I18N,r=o.prop("SETTINGS_TIME_AM"),s=o.prop("SETTINGS_TIME_PM");t.options=e,t._dates=[],t.popupWindow=a,"24Hour"==n?t.hourData=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"]:"12Hour"==n&&(t.hourData=["00","01","02","03","04","05","06","07","08","09","10","11"],t.ampmData=[r,s]),t.minuteData=[];for(var l=0;l<60;l++){var d;d=l<10?"0"+l:""+l,t.minuteData.push(d)}t.ampmElem=f("<input class='amapm'/>"),t.hourElem=f("<input class='hour'/>"),t.minuteElem=f("<input class='minute'/>"),t.ul=f("<div class='timepicker-container'></div>"),t.list=t.ul.append(t.ampmElem).append(t.hourElem).append(" : ").append(t.minuteElem),i&&(t._timeViewID=i+"_timeview",t._optionID=i+"_option_selected",t.ul.attr("id",t._timeViewID)),t._popup(a),t._heightHandler=S(t._height,t),t.template=k.template('<li tabindex="-1" role="option" class="k-item" unselectable="on">#=data#</li>',{useWithBlock:!1})}function T(e,t,i){var a,n=e.getTimezoneOffset();e.setTime(e.getTime()+t),i||(a=e.getTimezoneOffset()-n,e.setTime(e.getTime()+a*w))}function M(e){return 60*e.getHours()*w+e.getMinutes()*w+1e3*e.getSeconds()+e.getMilliseconds()}function L(e,t,i){var a,n=M(t),o=M(i);return!e||n==o||((a=M(e))<n&&(a+=D),o<n&&(o+=D),n<=a&&a<=o)}E.prototype={current:function(e){var t=this.options.active;if(void 0===e)return this._current;this._current&&this._current.removeClass(i).removeAttr(a).removeAttr("id"),e&&(e=f(e).addClass(i).attr("id",this._optionID).attr(a,!0),this.scroll(e[0])),this._current=e,t&&t(e)},close:function(){},destroy:function(){this.ul.off(l),this.list.off(l),this.popup.destroy()},open:function(){this.ul[0].firstChild||this.bind(),this.popup.open(),this._current&&this.scroll(this._current[0])},dataBind:function(e){for(var t,i=this.options,a=i.format,n=k.toString,o=this.template,r=e.length,s=0,l="";s<r;s++)L(t=e[s],i.min,i.max)&&(l+=o(n(t,a,i.culture)));this._html(l)},refresh:function(){var e,t,i,a,n,o,r=this.options,s=r.format,l=(a=new x,n=new x(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0),o=new x(a.getFullYear(),a.getMonth(),a.getDate(),12,0,0),-1*(n.getTimezoneOffset()-o.getTimezoneOffset())),d=l<0,c=r.min,u=r.max,p=M(c),h=M(u),f=r.interval*w,g=k.toString,m=this.template,v=new x(+c),_=v.getDate(),b=0,C="";for(i=d?(D+l*w)/f:D/f,p!=h&&(h<p&&(h+=D),i=(h-p)/f+1),t=parseInt(i,10);b<i;b++)b&&T(v,f,d),h&&t==b&&(e=M(v),_<v.getDate()&&(e+=D),h<e&&(v=new x(+u))),this._dates.push(M(v)),C+=m(g(v,s,r.culture));this._html(C)},bind:function(){var e=this.options.dates;e&&e[0]?this.dataBind(e):this.refresh()},_html:function(e){this.ul[0].innerHTML=e,this.popup.unbind("open",this._heightHandler),this.popup.one("open",this._heightHandler),this.current(null),this.select(this._value)},scroll:function(e){if(e){var t=this.list[0],i=e.offsetTop,a=e.offsetHeight,n=t.scrollTop,o=t.clientHeight,r=i+a;i<n?n=i:n+o<r&&(n=r-o),t.scrollTop=n}},select:function(t){var e,i=this.options,a=this._current;t instanceof Date&&(t=k.toString(t,i.format,i.culture)),"string"==typeof t&&(t=a&&a.text()===t?a:(t=f.grep(this.ul[0].childNodes,function(e){return(e.textContent||e.innerText)==t}))[0]?t:null),e=this._distinctSelection(t),this.current(e)},_distinctSelection:function(e){var t,i;return e&&1<e.length&&(t=M(this._value),i=f.inArray(t,this._dates),e=this.ul.children()[i]),e},setOptions:function(e){var t=this.options;e.min=c(e.min),e.max=c(e.max),this.options=I(t,e,{active:t.active,change:t.change,close:t.close,open:t.open}),this.bind()},toggle:function(e){e.data("kendoWindow").options.visible&&(e.find(".k-animation-container").hide(),this.close()),this.open()},value:function(e){this._value=e,this.ul[0].firstChild&&this.select(e)},_click:function(e){var t=f(e.currentTarget),i=t.text(),a=this.options.dates;a&&0<a.length&&(i=a[t.index()]),e.isDefaultPrevented()||(this.select(t),this.options.change(i,!0),this.close())},_height:function(){var e=this.list,t=e.parent(".k-animation-container"),i=this.options.height;this.ul[0].children.length&&e.add(t).show().height(this.ul[0].scrollHeight>i?i:"auto").hide()},_parse:function(e){var t=this.options,i=this._value||A;return e instanceof x?e:e=(e=c(e,t.parseFormats,t.culture))&&new x(i.getFullYear(),i.getMonth(),i.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())},_adjustListWidth:function(){var e,t,i=this.list,a=i[0].style.width,n=this.options.anchor,o=k._outerWidth;!i.data("width")&&a||(t=(e=window.getComputedStyle?window.getComputedStyle(n[0],null):0)?parseFloat(e.width):o(n),e&&(r.mozilla||r.msie)&&(t+=parseFloat(e.paddingLeft)+parseFloat(e.paddingRight)+parseFloat(e.borderLeftWidth)+parseFloat(e.borderRightWidth)),a=t-(o(i)-i.width()),i.css({fontFamily:n.css("font-family"),width:a}).data("width",a))},_popup:function(e){var t=this.list,i=this.options,a=i.anchor;this.popup=new s.Popup(t,I(i.popup,{anchor:a,open:i.open,close:i.close,animation:i.animation,isRtl:n.isRtl(i.anchor)})),e.append(this.popup.element)},move:function(e){var t=e.keyCode,i=this.ul[0],a=this._current,n=t===o.DOWN;if(t===o.UP||n){if(e.altKey)return void this.toggle(n);(a=n?a?a[0].nextSibling:i.firstChild:a?a[0].previousSibling:i.lastChild)&&this.select(a),this.options.change(this._current.text()),e.preventDefault()}else t!==o.ENTER&&t!==o.TAB&&t!==o.ESC||(e.preventDefault(),a&&this.options.change(a.text(),!0),this.close())}},E.getMilliseconds=M,k.TimeView=E;var N,e=s.TimePicker.extend({options:{name:"CommonTimePicker",format:"HH:mm",value:new Date,readonly:!0,animation:!1,addTwentyFour:!1,buttons:"<div class='popup-footer'>\n<button data-event='ok' class='time'>Ok</button>\n<button data-event='cancel' class='time'>Cancel</button>\n</div>"},init:function(i,e){var t=window.I18N;N=null;var a,n,o,r=window.GlobalSettings.getTimeDisplay(),s=this;p.fn.init.call(s,i,e),i=s.element,(e=s.options).min=c(i.attr("min"))||c(e.min),e.max=c(i.attr("max"))||c(e.max),o=(n=e).parseFormats,n.format=u(n.format||k.getCulture(n.culture).calendars.standard.patterns.t),(o=y(o)?o:[o]).splice(0,0,n.format),n.parseFormats=o,s._initialOptions=I({},e),s._wrapper();var l=f("body").find(".timepicker-widget-window"),d=l.find(".timepicker-container");s.element.closest(".k-widget").addClass("common-time-picker"),0<l.length?(this.popupWindow=l,s.timeView=this.popupWindow.data("timeView"),a=s.timeView,this.popupWindow.data("targetElem",null)):(this.popupWindow=f("<div/>").addClass("timepicker-widget-window").kendoWindow({title:"<span>"+t.prop("COMMON_TIME_PICKER")+"</span>",animation:!1,resizable:!1,draggable:!1,width:"500px",height:"200px",close:function(){s.timeView.close(),s.timeView.popup.close()}}),this.popupWindow.append(this.options.buttons),this.popupWindow.closest(".k-window").addClass("popup-time-picker"),this.popupWindow.closest(".k-window").find(".k-window-titlebar").append("<div class='embossBar'></div>"),this.popupWindow.closest(".k-window").find(".k-window-titlebar").find("a[role=button]").hide(),this.popupWindow.closest(".k-window").find(".k-window-titlebar").find(".k-window-actions").append("<span class='ic ic-close'><span/>"),this.popupWindow.data("timeView",s.timeView),f("body").on("click",function(e){var t=f(e.target),i=s.popupWindow.data("kendoWindow");if(!t.is("span.ic-bt-input-clock")&&i.options.visible&&0==t.closest(".popup-time-picker").length){if(t.is(i.wrapper))return;i.close()}})),s.timeView=new E(I({},e,{id:i.attr("id"),anchor:s.wrapper,format:e.format,change:function(e,t){t?s._change(e):i.val(e)},open:function(e){s.timeView._adjustListWidth(),s.trigger("open")?e.preventDefault():(i.attr(g,!0),d.attr(m,!1))},close:function(e){s.trigger("close")?e.preventDefault():(i.attr(g,!1),e.preventDefault(),d.attr(m,!0))},active:function(e){i.removeAttr(v),e&&i.attr(v,a._optionID)}})),a=s.timeView,this.ul=s.timeView.ul,s.options.addTwentyFour&&a.hourData.push(24),a.hourElem.kendoDropDownList({dataSource:a.hourData,value:s.timeView.hourData[s.timeView.options.value.getHours()],height:100}),a.minuteElem.kendoDropDownList({dataSource:a.minuteData,value:s.timeView.minuteData[s.timeView.options.value.getMinutes()],height:100}),"24Hour"==r?(s.options.format="HH:mm",a.ampmElem.hide()):"12Hour"==r&&(s.options.format="tt hh:mm",a.ampmElem.show(),a.ampmElem.kendoDropDownList({dataSource:s.timeView.ampmData}),a.hourElem.data("kendoDropDownList").wrapper.css({width:"120px"}),a.minuteElem.data("kendoDropDownList").wrapper.css({width:"120px"}),a.ampmElem.data("kendoDropDownList").wrapper.css({width:"100px","margin-right":"10px"})),s.element.closest(".k-timepicker").addClass("k-input"),s.element.keydown(function(e){return!1}),s._icon(),s.element.attr("readonly",!0),s.element.closest(".k-timepicker").find("span.k-select").find("span").removeClass("k-icon k-i-clock").addClass("ic ic-bt-input-clock"),s._reset();try{i[0].setAttribute("type","text")}catch(e){i[0].type="text"}i.addClass("k-input").attr({role:"combobox","aria-expanded":!1,"aria-owns":a._timeViewID}),i.is("[disabled]")||f(s.element).parents("fieldset").is(":disabled")?s.enable(!1):s.readonly(i.is("[readonly]")),s._old=s._update(e.value||s.element.val()),s._oldText=i.val(),k.notify(s)},_editable:function(e){var t=this,i=e.disable,a=e.readonly,n=t._arrow.off(l),o=t.element.off(l),r=t._inputWrapper.off(l);a||i?(r.addClass(i?b:d).removeClass(i?d:b),o.attr("disabled",i).attr("readonly",a).attr(h,i),i||n.on(_,S(t._click,t)).on(C,O)):(r.addClass(d).removeClass(b).on("mouseenter.kendoTimePicker mouseleave.kendoTimePicker",t._toggleHover),o.removeAttr("disabled").removeAttr("readonly").attr(h,!1).on("keydown"+l,S(t._keydown,t)).on("focusout"+l,S(t._blur,t)).on("focus"+l,function(){t._inputWrapper.addClass("k-state-focused")}),n.on(_,S(t._click,t)).on(C,O))},enable:function(e){void 0===e&&(e=!0),this._editable({readonly:!0,disable:!(e||e)})},_click:function(e){var o,r,s,t,i=window.I18N,l=i.prop("SETTINGS_TIME_PM"),d=this,a=window.GlobalSettings.getTimeDisplay(),n=f(e.target),c=d.timeView.hourData,u=d.timeView.minuteData,p=d.popupWindow.closest(".k-window");function h(){d.timeView.close(),d.timeView.popup.close()}N=n.closest(".k-picker-wrap").find("input[data-role=commontimepicker]"),d.popupWindow.data("targetElem",N),t=d.popupWindow.data("targetElem").closest(".k-timepicker"),o=N.data("kendoCommonTimePicker").value().getHours(),r=N.data("kendoCommonTimePicker").value().getMinutes(),"12Hour"==a&&(12<=(o=N.data("kendoCommonTimePicker").value().getHours())&&(o%=12),s=d._getAmPm(N.data("kendoCommonTimePicker").value()),d.timeView.ampmElem.data("kendoDropDownList")&&d.timeView.ampmElem.data("kendoDropDownList").value(s)),d.timeView.hourElem.data("kendoDropDownList").value(c[o]),d.timeView.minuteElem.data("kendoDropDownList").value(u[r]),this.popupWindow.closest(".k-window").off("click",".k-window-titlebar .k-window-actions"),this.popupWindow.off("click",".popup-footer button[data-event=ok]"),this.popupWindow.off("click",".popup-footer button[data-event=cancel]"),this.popupWindow.closest(".k-window").on("click",".k-window-titlebar .k-window-actions",function(){h(),d.popupWindow.data("kendoWindow").close()}),this.popupWindow.on("click",".popup-footer button[data-event=ok]",function(e){var t,i=window.GlobalSettings.getTimeDisplay(),a=new Date,n=d.element.data("kendoCommonTimePicker");o=d.timeView.hourElem.data("kendoDropDownList").value(),r=d.timeView.minuteElem.data("kendoDropDownList").value(),"24Hour"==i?t=new Date(a.getFullYear(),a.getMonth(),a.getDate(),o,r):"12Hour"==i&&((s=d.timeView.ampmElem.data("kendoDropDownList").value())==l&&(o=1*o+12),t=new Date(a.getFullYear(),a.getMonth(),a.getDate(),o,r)),n.value(t),n.trigger("change"),h(),d.popupWindow.data("kendoWindow").close()}),this.popupWindow.on("click",".popup-footer button[data-event=cancel]",function(e){h(),d.popupWindow.data("kendoWindow").close()}),this.popupWindow.find("button[data-event=ok]").text(i.prop("COMMON_BTN_OK")),this.popupWindow.find("button[data-event=cancel]").text(i.prop("COMMON_BTN_CANCEL")),d.popupWindow.data("kendoWindow").open(),f("body").height()<t.offset().top+t.height()+p.height()&&f("body").width()<p.offset().left+p.width()?p.css({top:t.offset().top-p.height()-t.height()-35,left:t.offset().left+t.width()-p.width()}):f("body").height()<t.offset().top+t.height()+p.height()?p.css({top:t.offset().top-p.height()-t.height()-35,left:t.offset().left}):f("body").width()<t.offset().left+p.width()?p.css({top:t.offset().top+t.height()+15,left:t.offset().left+t.width()-p.width()+20}):p.css({top:t.offset().top+t.height()+15,left:t.offset().left}),d.timeView.toggle(this.popupWindow)},_update:function(e){var t=this.options,i=this.timeView,a=i._parse(e),n=this.element;return L(a,t.min,t.max)||(a=null),this._value=a,n.val(k.toString(a||e,t.format,t.culture)),i.value(a),a},_getAmPm:function(e){var t,i,a=window.I18N,n=a.prop("SETTINGS_TIME_AM"),o=a.prop("SETTINGS_TIME_PM");return(i=e.getHours())<=11&&0<=i?t=n:12<=i&&i<=23&&(t=o,12<i&&(i-=12)),t},showInvalidMesage:function(e){var t=this.wrapper,i=t.next(),a='<span class="k-widget k-tooltip k-tooltip-validation k-invalid-msg common-time-picker-invalid-msg" data-for="" role="alert">'+e+"</span>";t.addClass("k-invalid"),e&&(i.hasClass("common-time-picker-invalid-msg")&&i.remove(),t.after(f(a)))},hideMessage:function(){var e=this.wrapper,t=e.next();e.removeClass("k-invalid"),t.hasClass("common-time-picker-invalid-msg")&&e.next().remove()},destroy:function(){k.ui.TimePicker.fn.destroy.call(this)}});s.plugin(e)}(jQuery),function(u,p){var d=u.kendo,c=u.localStorage,a="common-colorpicker-cell-transparent",h="transparent",r="use-transparent-color",f="colorPicker_recentPalette",s="k-state-disabled",l=".kendoNumericTextBox",g="mouseenter"+l+" mouseleave.kendoNumericTextBox",m="k-state-default",v="k-state-selected",_="aria-disabled",b="k-i-arrow-60-down",C="k-i-arrow-60-up",n="background-color",k=p.proxy,o=d.Color;function w(e,t){return'<span unselectable="on" class="k-link k-link-'+e+'" aria-label="'+t+'" title="'+t+'"><span unselectable="on" class="k-icon '+("k-i-arrow-"+("increase"===e?"60-up":"60-down"))+'"></span></span>'}var i=d.ui.ColorPalette,e=i.extend({options:{name:"CustomedColorPickerPalette",opacity:!1},init:function(e,t){i.fn.init.call(this,e,t)},_template:d.template('<table class="k-palette k-reset testttest" role="presentation"><tr role="row"># for (var i = 0; i < colors.length; ++i) { ## var selected = colors[i].equals(value); ## if (i && i % columns == 0) { # </tr><tr role="row"> # } #<td role="gridcell test" unselectable="on" style="background-color:#= colors[i].toCssRgba() #"#= selected ? " aria-selected=true" : "" # #=(id && i === 0) ? "id=\\""+id+"\\" " : "" # class="k-item#= selected ? " k-state-selected" : "" #" aria-label="#= colors[i].toCssRgba() #"></td># } #</tr></table>')});d.ui.plugin(e);var D=d.ui.FlatColorPicker,t=D.extend({options:{name:"CustomFlatColorPicker"},init:function(e,t){D.fn.init.call(this,e,t)},_updateUI:function(e,t){var i=this._hsvRect;e&&(this._colorAsText.removeClass("k-state-error"),this._selectedColor.css(n,e.toDisplay()),t||this._colorAsText.val(e.toCss()),this._triggerSelect(e),e=e.toHSV(),this._hsvHandle.css({left:e.s*i.width()+"px",top:(1-e.v)*i.height()+"px"}),this._hueElements.css(n,o.fromHSV(e.h,1,1,1).toCss()),this._hueSlider.value(e.h),this._opacitySlider&&this._opacitySlider.value(100*e.a))}});d.ui.plugin(t);var y=d.ui.NumericTextBox,I=d.ui.CustomNumericBox,S=I.extend({options:{name:"CustomColorPickerNumericBox",events:["spinstart","spinend"]},init:function(e,t){I.fn.init.call(this,e,t),this._spinStartValue=100},_editable:function(e){var t=this,i=t.element,a=e.disable,n=e.readonly,o=t._text.add(i),r=t._inputWrapper.off(g);t._toggleText(!0),t._upArrowEventHandler.unbind("press"),t._downArrowEventHandler.unbind("press"),i.off("keydown"+l).off("keypress"+l).off("paste"+l),n||a?(r.addClass(a?s:m).removeClass(a?m:s),o.attr("disabled",a).attr("readonly",n).attr(_,a)):(r.addClass(m).removeClass(s).on(g,t._toggleHover),o.removeAttr("disabled").removeAttr("readonly").attr(_,!1),t._upArrowEventHandler.bind("press",function(e){e.preventDefault(),t._upArrow.hasClass(v)||(t._spinStartValue=t.value(),t.trigger("spinstart")),t.trigger("spinstart"),t._spin(1),t._upArrow.addClass(v)}),t._downArrowEventHandler.bind("press",function(e){e.preventDefault(),t._downArrow.hasClass(v)||(t._spinStartValue=t.value(),t.trigger("spinstart")),t._spin(-1),t._downArrow.addClass(v)}),t.element.on("keydown"+l,k(t._keydown,t)).on("keypress"+l,k(t._keypress,t)).on("paste"+l,k(t._paste,t)))},_arrows:function(){function e(e){var t=s._spinStartValue,i=s.min(),a=s.max(),n=!0,o=e.target;clearTimeout(s._spinning),r.removeClass(v),o.is(r.eq(0))?n=i<=t&&100!==t:o.is(r.eq(1))&&(n=t<=a&&0!==t),n&&(s._spinStartValue=s.value(),s.trigger("spinend"))}var r,t=this.wrapper,s=this,i=s.options,a=i.spinners,n=s.element;(r=n.siblings(".k-icon"))[0]||(r=p(w("increase",i.upArrowText)+w("decrease",i.downArrowText)).insertAfter(n)).wrapAll('<span class="k-select"/>'),a||(r.parent().toggle(a),s._inputWrapper.addClass("k-expand-padding")),s._upArrow=r.eq(0),s._upArrowEventHandler=new d.UserEvents(s._upArrow,{release:e}),s._downArrow=r.eq(1),s._downArrowEventHandler=new d.UserEvents(s._downArrow,{release:e});var o=t.find("."+b);0<o.length&&(o.removeClass(b),o.addClass("c-i-arrow-60 down"));var l=t.find("."+C);0<l.length&&(l.removeClass(C),l.addClass("c-i-arrow-60 up"))},value:function(e){var t=this;if(void 0!==e){var i=t._upArrow,a=t._downArrow;t._setUpbind(i,!0),t._setDownbind(a,!0),e>=t.max()?(t._setUpbind(i,!1),e=t.max()):e<=t.min()&&(t._setDownbind(a,!1),e=t.min()),t.options.oriValue=e,t.options.showValueWhenDisabled||t.options.enable||(e=""),t._spinStartValue=e}return y.fn.value.call(t,e)},_setUpbind:function(e,t){var i=this;i._upArrowEventHandler.unbind("press"),t?(e.removeClass(s),i._upArrowEventHandler.bind("press",function(e){e.preventDefault(),i._upArrow.hasClass(v)||i.trigger("spinstart"),i._spin(1),i._upArrow.addClass(v)})):e.addClass(s)},_setDownbind:function(e,t){var i=this;i._downArrowEventHandler.unbind("press"),t?(e.removeClass(s),i._downArrowEventHandler.bind("press",function(e){e.preventDefault(),i._downArrow.hasClass(v)||i.trigger("spinstart"),i._spin(-1),i._downArrow.addClass(v)})):e.addClass(s)},_spin:function(e,t){var i=this;if(!i.element.prop("disabled")){var a=i.value();y.fn._spin.call(i,e,t);var n=i.value();if(n!==a){var o=i._upArrow,r=i._downArrow;a<n?(n==i.max()&&i._setUpbind(o,!1),r.hasClass(s)&&i._setDownbind(r,!0)):n<a&&(n==i.min()&&i._setDownbind(r,!1),o.hasClass(s)&&i._setUpbind(o,!0)),i._focusout(),i.trigger("change"),i.options.oriValue=n}}}});d.ui.plugin(S);var x=d.ui.Dialog,A=x.extend({options:{name:"CommonColorPicker",width:278,height:380,title:!1,animation:!1,draggable:!1,resizable:!1,visible:!1,modal:!1,opacity:!1,activeSelector:null,actions:[{text:"Cancel",action:null},{text:"Ok",action:null}],events:["change","select","cancelChanged","open"],palette:{recent:[],default:["#4c8158","#28b061","#21a388","#70c789","#83cfba","#344b60","#285681","#4484c5","#3599d6","#69bbd0","#c53b2d","#eb4e3e","#e30613","#ce67a7","#80669c","#815433","#d08653","#e98022","#f89f1f","#f1c812","#000000","#848484","#dbdbdb","#ffffff",null],transparent:["#4c8158","#28b061","#21a388","#70c789","#83cfba","#344b60","#285681","#4484c5","#3599d6","#69bbd0","#c53b2d","#eb4e3e","#e30613","#ce67a7","#80669c","#815433","#d08653","#e98022","#f89f1f","#f1c812","#000000","#848484","#dbdbdb","#ffffff","#ffffff"]},columns:{recent:5,default:5},content:"<div class='wrapper'><div class='inner'><div class='container recent'><div class='content recent'><div class='title'>Recent Colors</div><div class='item'><div class='inner'><div class='common-recent-palette'></div></div></div></div></div><div class='common-color-picker-tab container picker common-tab-strip'><ul><li class='k-state-active' tab-name='default'>Default Color</li><li tab-name='custom'>Custom Color</li></ul><div class='content default'><div class='item'><div class='inner'><div class='common-default-palette'></div></div></div></div><div class='content custom'><div class='item'><div class='inner'><div class='common-custom-picker'></div></div></div></div></div></div></div>",tileSize:{width:35,height:34},position:null,value:null,hasTransparent:!1,_doChangeRecentPalette:!1},init:function(e,t){var i,a=this;if(a._selectedColor="#000",a._originColor=null,a._isCentered=!0,a._isOpened=!1,a._isClosed=!0,a._isBindedCloseEvt=!1,a._activeTab=null,a._recentPaletteColorArr=[],a._transparentItemInDefaultPalette=null,a._recentSelectedId=null,a._defaultSelectedId=null,a._opacityInputElem=null,a._isSpinningOnOpacityNumeric=null,a._initActions(),a.options.opacity&&(a.options.height=489),x.fn.init.call(a,e,t),a._position=(i=a.wrapper,{top:p("body").height()/2-i.height()/2,left:p("body").width()/2-i.width()/2}),a.options.position&&(a._position=p.extend(a._position,a.options.position)),a.options.palette){var n=a.options.palette;for(var o in n)a.options.palette[o]=n[o]}a.options.opacity&&a.wrapper.addClass("use-opacity"),a._hasTransparent=a.options.hasTransparent,a._hasTransparent&&a.wrapper.addClass(r),a._activeSelector=a.options.activeSelector,a._initDOM(),a._initComponent(),a._attachCustomPaletteMouseEvent()},_initDOM:function(){var e=this.wrapper;e.attr("tabindex",-1).addClass("common-color-picker");e.find(".k-dialog-action.k-dialog-close").append("<span class='ic ic-close'><span>"),e.find(".k-dialog-buttongroup").hide()},_isInit:function(){return 0<p(".common-color-picker").length},_setDialogHeight:function(){if(this.options.opacity){var e=this.wrapper;0===this.tab.getActivatedTabIndex()?e.css("height",380):e.css("height",489)}},_initComponent:function(){this._createRecentPalette(),this._createDefaultPalette(),this._createCustomPicker(),this._bindChangeEvt(),this._createTab(),this.recentPalette.wrapper.find(".k-palette").find("td.k-item").append('<span class="selected-cell"></span>'),this.defaultPalette.wrapper.find(".k-palette").find("td.k-item").append('<span class="selected-cell"></span>')},_createRecentPalette:function(){var e=u.I18N,t=this.wrapper,i=this.options,a=i.palette,n=i.tileSize,o=t.find(".common-recent-palette"),r=c.getItem(f),s=null;t.find(".content.recent").find(".title").text(e.prop("COMMON_COLOR_PICKER_RECENT_COLOR")),a.recent.length<1&&(a.recent=null!==r?JSON.parse(r):[]),this.recentPalette=o.kendoCustomedColorPickerPalette({opacity:this.options.opacity,tileSize:n,palette:a.recent,columns:i.columns.recent,value:null}).data("kendoCustomedColorPickerPalette"),s=this.recentPalette.element.find(".k-palette").find("td.k-item[role=gridcell]");for(var l=0;l<a.recent.length;l++)a.recent[l]==h&&this._convertTransparentCell(s.eq(l));this._recentSelectedId=this.recentPalette._selectedID,this._recentPaletteColorArr=a.recent},_createDefaultPalette:function(){var e=this,t=e.wrapper,i=e.options,a=i.palette.default,n=a.length,o=i.tileSize,r=i.value,s=t.find(".common-default-palette");e._hasTransparent&&(n=(a=i.palette.transparent).length),e.defaultPalette=s.kendoColorPalette({tileSize:o,palette:a,columns:i.columns.default,value:r}).data("kendoColorPalette"),e._defaultSelectedId=e.defaultPalette._selectedID,e._hasTransparent&&(e._transparentItemInDefaultPalette=e.defaultPalette.element.find("table.k-palette").find("[role=gridcell]").eq(n-1),e._convertTransparentCell(e._transparentItemInDefaultPalette))},_createCustomPicker:function(){var e=this,t=e.wrapper,i=e.options.value,a=t.find(".common-custom-picker"),n=e.options.opacity;if(e.customPicker=a.kendoCustomFlatColorPicker({preview:!0,value:i,opacity:n,change:function(e){e.sender.element.find(".k-selected-color").removeClass("selected-color-transparent")}}).data("kendoCustomFlatColorPicker"),n){var o=e.customPicker.wrapper.find(".k-widget.k-transparency-slider"),r=u.I18N.prop("COMMON_OPACITY"),s=p('<div class="opacity-control-title">'+r+"</div>"),l=p('<div class="opacity-control-wrapper"><input class="k-input" /></div>');s.insertBefore(o),e.customPicker.element.append(l),e._opacityInputElem=e.customPicker.element.find(".opacity-control-wrapper .k-input"),e._opacityInputElem.data("kendoCustomColorPickerNumericBox")||e._opacityInputElem.kendoCustomColorPickerNumericBox({unit:"%",placeholder:"",format:"#",enable:!0,blockKeyEvent:!1,value:100,step:1,min:0,max:100})}var d=e.customPicker.element.find(".k-selected-color"),c=p('<span class="ic ic-transparent-big"></span>');d.find(".ic.ic-transparent-big").length<1&&d.append(c)},_createTab:function(){var i=this,a=u.I18N,e=i.wrapper.find(".common-color-picker-tab");e.find("li[tab-name=default]").text(a.prop("COMMON_COLOR_PICKER_DEFAULT_COLOR")),e.find("li[tab-name=custom]").text(a.prop("COMMON_COLOR_PICKER_CUSTOM_COLOR")),i.tab=e.kendoCommonTabStrip({isTopMenu:!1,activate:function(e){var t=e.sender;i._activeTab=t.select(),"custom"==i._activeTab.attr("tab-name")&&(i.customPicker.value(i._selectedColor),i._selectedColor==h?(i.customPicker._colorAsText.val(a.prop("COMMON_COLOR_PICKER_NO_FILL")),i.customPicker.element.find(".k-selected-color").addClass("selected-color-transparent")):i.customPicker.element.find(".k-selected-color").removeClass("selected-color-transparent")),i._setDialogHeight()}}).data("kendoCommonTabStrip")},_refreshRecentPalette:function(e){var t,i,a=this,n=a.options,o=a.recentPalette,r=o.element,s=a.options.columns.recent,l=null;if(e&&e!=h)a._recentPaletteColorArr.length==s&&a._recentPaletteColorArr.splice(s-1,1),a._recentPaletteColorArr.unshift(e),c.setItem(f,JSON.stringify(a._recentPaletteColorArr)),a._recentPaletteColorArr=JSON.parse(c.getItem(f));else if(a._recentPaletteColorArr=JSON.parse(c.getItem(f)),a._recentPaletteColorArr){if(!a._hasTransparent)for(i=0;i<a._recentPaletteColorArr.length;i++)a._recentPaletteColorArr[i]==h&&(a._recentPaletteColorArr[i]=n.palette.default[n.palette.default.length-1])}else a._recentPaletteColorArr=[];for(r.empty(),o.destroy(),a.recentPalette=r.kendoCustomedColorPickerPalette({opacity:a.options.opacity,tileSize:n.tileSize,palette:a._recentPaletteColorArr,columns:n.columns.recent,value:a._selectedColor}).data("kendoCustomedColorPickerPalette"),l=a.recentPalette.element.find(".k-palette").find("td.k-item[role=gridcell]"),i=0;i<a._recentPaletteColorArr.length;i++)a._recentPaletteColorArr[i]==h&&a._convertTransparentCell(l.eq(i));t=a._setRecentPaletteChangeEvt.bind(a),a.recentPalette.bind("change",t),a.recentPalette.value(null)},_bindChangeEvt:function(){var e=this,t=e._setRecentPaletteChangeEvt.bind(e),i=e._setDefaultPaletteChangeEvt.bind(e),a=e._setCustomPickerChangeEvt.bind(e);if(this.recentPalette.bind("change",t),this.defaultPalette.bind("change",i),this.customPicker.bind("change",a),e.options.opacity&&e._opacityInputElem){var n=e._opacityInputElem.data("kendoCustomColorPickerNumericBox");n.unbind("change",e._onChangeOpacityNumeric.bind(e)),n.bind("change",e._onChangeOpacityNumeric.bind(e)),n.bind("spinstart",function(){e._isSpinningOnOpacityNumeric=!0}),n.bind("spinend",function(){e._isSpinningOnOpacityNumeric=!1,n.trigger("change")})}},_getConvertedRGBCss:function(e){var t=e;return this.options.opacity?(""!==t&&null!=t||(t=null),d.parseColor(t).toCssRgba()):e},_setRecentPaletteChangeEvt:function(e){var t=this,i=p("#"+e.sender._selectedID);i.length<0&&(i=e.sender.element.find("td[aria-selected=true]")),t._selectedColor=e.value,i.hasClass(a)&&(t._selectedColor=h),t.defaultPalette.value(null),t.customPicker.value(t._selectedColor),t._setOpacityNumericValue(),t._isOpened&&t.trigger("change",{value:t._getConvertedRGBCss(t._selectedColor)})},_setDefaultPaletteChangeEvt:function(e){var t=this;t._transparentItemInDefaultPalette=e.sender.element.find("td[aria-selected=true]"),t._selectedColor=e.value,t._transparentItemInDefaultPalette.hasClass(a)&&(t._selectedColor=h),t.customPicker.value(t._selectedColor),t._isOpened&&!t._doChangeRecentPalette&&(t._refreshRecentPalette(t._selectedColor),t._createRecentPaletteGrid(),t.trigger("change",{value:t._getConvertedRGBCss(t._selectedColor)})),t.recentPalette.value(null),t._setOpacityNumericValue()},_setCustomPickerChangeEvt:function(e){this._selectedColor=e.value,this.recentPalette.value(null),this.defaultPalette.value(e.value),this.options.opacity&&this._setOpacityNumericValue(),this._isOpened&&this.trigger("change",{value:this._getConvertedRGBCss(this._selectedColor)})},_onChangeOpacityNumeric:function(e){this.options.opacity&&(this._isSpinningOnOpacityNumeric||this._setColorPickerValueByOpacityNumeric())},_setColorPickerValueByOpacityNumeric:function(){if(this.options.opacity){var e,t=this._opacityInputElem.data("kendoCustomColorPickerNumericBox"),i=this.value(),a=d.parseColor(i),n=t.value();a.a=n/100,e=a.toCssRgba(),this.customPicker.value(e),this._refreshRecentPalette(e),this._createRecentPaletteGrid(),this._setCustomPickerChangeEvt({value:e})}},_setOpacityNumericValue:function(){if(this.options.opacity){var e=this._opacityInputElem.data("kendoCustomColorPickerNumericBox"),t=this._selectedColor,i=d.parseColor(t),a=Number(i.a);e.value(100*a)}},_convertTransparentCell:function(e){e.addClass(a).css("background-color","transparent").attr("aria-label","#ffffff00")},_initActions:function(){var t=this,e=t.options;e.actions[0].action=function(e){t.trigger("cancelChanged")},e.actions[1].action=function(e){console.info(e),t._refreshRecentPalette(e.sender._selectedColor),t.trigger("select",{value:e.sender._selectedColor})}},_attachCustomPaletteMouseEvent:function(){var i=this,e=this.customPicker.wrapper,t=e.find(".k-hsv-rectangle"),a=e.find(".k-slider-track"),n=a.find(".k-draghandle");t.on("mouseup",function(e){var t=i._selectedColor;i._refreshRecentPalette(t),i._createRecentPaletteGrid()}),t.on("mousedown",function(e){e.stopPropagation()}),t.on("pointerdown",function(e){e.stopPropagation()}),n.on("mouseup",function(e){var t=i._selectedColor;i._refreshRecentPalette(t),i._createRecentPaletteGrid()}),a.on("mousedown",function(e){e.stopPropagation()}),a.on("pointerdown",function(e){e.stopPropagation()})},_attachClosePopupEvent:function(){this._closePopupEvent=this._closePopup.bind(this),p(document).off("click",this._closePopupEvent),p(document).on("click",this._closePopupEvent)},_dettachClosePopupEvent:function(){p(document).off("click",this._closePopupEvent)},_closePopup:function(e){var t=p(e.target),i=0<t.closest(".common-color-picker").length,a=null;if(a=!!this._activeSelector&&0<t.closest(this._activeSelector).length,this._isOpened&&!i){if(a)return;this.close()}},_createRecentPaletteGrid:function(){var e=this.recentPalette,t=this._recentPaletteColorArr,i=e.element.find(".selected-cell");0<t.length&&(0<i.length&&i.remove(),e.element.find(".k-palette").find("td.k-item").append('<span class="selected-cell"></span>'))},position:function(e){if(!e)return this._isCentered=!0,this._position;this._isCentered=!1,this._position=p.extend(this._position,e),this.wrapper.css(this._position)},value:function(e,t){var i=this;if(!e||void 0===e)return i._getConvertedRGBCss(i._selectedColor);i._doChangeRecentPalette=t,i._selectedColor=e,i.recentPalette.trigger("change",{value:e}),i.defaultPalette.trigger("change",{value:e}),i.customPicker.trigger("change",{value:e}),this.options.hasTransparent&&"transparent"==e&&i.defaultPalette.element.find(".k-item").eq(i.options.palette.transparent.length-1).addClass("k-state-selected"),i._doChangeRecentPalette=!1},isOpened:function(){return this._isOpened},setOriginValue:function(e){this._originColor=e},open:function(){var e;this._attachClosePopupEvent(),this._isOpened=!0,this._isClosed=!1,this._originColor=this._selectedColor,x.fn.open.call(this),this.options.hasTransparent?this.wrapper.addClass(r):this.wrapper.removeClass(r),this.position(this._position),this._refreshRecentPalette(),this._createRecentPaletteGrid(),this.customPicker.value(this._selectedColor),e=this.tab.element.find("li[tab-name=default]"),this.tab.activateTab(e),this._setDialogHeight()},close:function(){this._isOpened=!1,this._isClosed=!0,x.fn.close.call(this),this._dettachClosePopupEvent()},destroy:function(){this._dettachClosePopupEvent(),x.fn.destroy.call(this)}});d.ui.plugin(A)}(window,window.kendo.jQuery),function(e,n){var o=e.kendo,i=o.ui.Widget,r=["width","dataSource","columns","height","hasCheckedModel","isGroupListMode"],t=i.extend({options:{name:"CommonGroupList",width:null,height:373,columns:null,data:[],group:[],filter:null,showFields:[],hideAllColumns:!0,groupHeaderTemplate:null,showEditListHeader:!0,hasCheckedModel:!0,isGroupListMode:!0,checkedLimit:!1,headerTitleText:{assigned:"Selected Item",deassigned:"Unselected Item"},onceExpandParentLevel:1,showNormalMode:!0,events:["change"]},init:function(e,t){i.fn.init.call(this,e,t),this.options.columns||(this.options.columns=[]),this._gridOptions=this._createGridOpts(this.options),this.wrapper=this.element,this.dataSource=null,this._data=this.options.data,this._old=[],this.columns=this.options.columns,this._group=this.options.group,this._filter={},this.normalGroupList=null,this.assignedGroupList=null,this.deAssignedGroupList=null,this._assignedDataSource=null,this._deAssignedDataSource=null,this._hideAllCollumns=this.options.hideAllColumns,this._showEditListHeader=this.options.showEditListHeader,this._buttons=[],this._showNormalMode=this.options.showNormalMode,this._parseDataSource(),this._initDOM(),this._initComponent(),this._attachEvent()},_createGridOpts:function(e){var t,i={},a="";for(t=0;t<r.length;t++)"dataSource"!=(a=r[t])&&(i[a]=e[a]);return i},_parseDataSource:function(){for(var e=this._data,t=this._group,i=[],a=[],n=0;n<e.length;n++)e[n].hasOwnProperty("assigned")||(e[n].assigned=!1),e[n].assigned?i.push(e[n]):a.push(e[n]),e[n].checked=!1;this._assignedDataSource instanceof o.data.ObservableObject?this._assignedDataSource.data(i):(this._assignedDataSource=new o.data.DataSource({data:i}),this._assignedDataSource.group(t)),this._deAssignedDataSource instanceof o.data.ObservableObject?this._deAssignedDataSource.data(a):(this._deAssignedDataSource=new o.data.DataSource({data:a}),this._deAssignedDataSource.group(t))},_initDOM:function(){var e=this.options,t={};this.element.append(n("<div class='container'><div class='contents normal hide-header'><div class='group-list'></div></div><div class='contents edit'><div class='content unselected'><div class='inner'><div class='group-list'></div></div></div><div class='content btn-group'><div class='inner'><div><button class='k-button assign' data-event='assign'>\u25b6</button></div><div><button class='k-button deassign' data-event='deassign'>\u25c0</button></div></div></div><div class='content selected'><div class='inner'><div class='group-list'></div></div></div></div></div>")),this.wrapper.addClass("common-group-list"),t.height=e.height,e.width&&(t.width=e.width),this.wrapper.css(t)},_initComponent:function(){this._initNormalGroupList(),this._initSelectedGroupList(),this._initUnSelectedGroupList(),this._initButton()},_initNormalGroupList:function(){var e=this.wrapper.find(".contents.normal"),t=e.find(".group-list"),i={};this._hideAllCollumns?e.addClass("hide-header"):e.removeClass("hide-header"),t.empty(),i={width:this.options.width,height:this.options.height,hasCheckedModel:!1,isGroupListMode:!0,columns:this.options.columns},null!==this.options.onceExpandParentLevel&&(i.onceExpandParentLevel=this.options.onceExpandParentLevel),this.normalGroupList=t.kendoTreeList(i).data("kendoTreeList"),this.normalGroupList.setDataSource(this._assignedDataSource)},_initSelectedGroupList:function(){var e=this.wrapper.find(".contents.edit"),t=this.wrapper.find(".content.selected").find(".group-list"),i={};this._showEditListHeader?e.removeClass("hide-header"):e.addClass("hide-header"),t.empty(),i={height:this.options.height,hasCheckedModel:!0,isGroupListMode:!0,checkedLimit:this.options.checkedLimit,columns:this.options.columns},null!==this.options.onceExpandParentLevel&&(i.onceExpandParentLevel=this.options.onceExpandParentLevel),this.assignedGroupList=t.kendoTreeList(i).data("kendoTreeList"),this.assignedGroupList.setDataSource(this._assignedDataSource),this._setMainDataSource()},_initUnSelectedGroupList:function(){var e=this.wrapper.find(".content.unselected").find(".group-list"),t={};e.empty(),t={height:this.options.height,hasCheckedModel:!0,isGroupListMode:!0,checkedLimit:this.options.checkedLimit,columns:this.options.columns},null!==this.options.onceExpandParentLevel&&(t.onceExpandParentLevel=this.options.onceExpandParentLevel),this.deAssignedGroupList=e.kendoTreeList(t).data("kendoTreeList"),this.deAssignedGroupList.setDataSource(this._deAssignedDataSource)},_initButton:function(){var e=this.wrapper,t=e.find(".k-button.deassign").kendoButton(),i=e.find(".k-button.assign").kendoButton();this._buttons=[i,t]},_setMainDataSource:function(){this.dataSource=this.assignedGroupList.dataSource},setButtonState:function(e,t){if(void 0!==t)this._buttons[t].data("kendoButton").enable(e);else for(var i=0;i<this._buttons.length;i++)this._buttons[i].data("kendoButton").enable(e)},_attachEvent:function(){var e=this.wrapper,t=e.find(".k-button.deassign"),i=e.find(".k-button.assign");t.on("click",this._deAssignItems.bind(this)),i.on("click",this._assignItems.bind(this))},_setDefaultButtonState:function(){var e=this.getDeAssignedItems().length,t=this.getAssignedItems().length,i=this._buttons[0].data("kendoButton"),a=this._buttons[1].data("kendoButton");i.enable(!(0==e)),a.enable(!(0==t))},_deAssignItems:function(){console.time("dataChange");this.assignedGroupList.dataSource.data().length;var e=this.assignedGroupList.getCheckedData(),t=this.assignedGroupList.getUncheckedData(),i=null,a=0;for(a=0;a<e.length;a++)e[a].assigned=!1;i=e,0<this._deAssignedDataSource.data().length&&(i=n.merge(this._deAssignedDataSource.data(),e)),this._deAssignedDataSource.data(i),this._assignedDataSource.data(t),this.normalGroupList.setDataSource(this._assignedDataSource),this.assignedGroupList.setDataSource(this._assignedDataSource),this.deAssignedGroupList.setDataSource(this._deAssignedDataSource),this._setDefaultButtonState(),this.trigger("change",{assignedItems:this.getAssignedItems(),deassignedItems:this.getDeAssignedItems()}),this.uncheckAll()},_assignItems:function(){console.time("dataChange");this.deAssignedGroupList.dataSource.data().length;var e=this.deAssignedGroupList.getCheckedData(),t=this.deAssignedGroupList.getUncheckedData(),i=null,a=0;for(a=0;a<e.length;a++)e[a].assigned=!0;i=e,0<this._assignedDataSource.data().length&&(i=n.merge(this._assignedDataSource.data(),e)),this._assignedDataSource.data(i),this._deAssignedDataSource.data(t),this.normalGroupList.setDataSource(this._assignedDataSource),this.assignedGroupList.setDataSource(this._assignedDataSource),this.deAssignedGroupList.setDataSource(this._deAssignedDataSource),this._setDefaultButtonState(),this.trigger("change",{assignedItems:this.getAssignedItems(),deassignedItems:this.getDeAssignedItems()}),this.uncheckAll()},uncheckAll:function(){this.assignedGroupList.uncheckAll(),this.deAssignedGroupList.uncheckAll()},uncheckAllAssignList:function(){this.assignedGroupList.uncheckAll()},uncheckAllDeAssignList:function(){this.deAssignedGroupList.uncheckAll()},_getAggregateOption:function(){for(var e,t=this._group,i=[],a=0;a<t.length;a++)e=t[a],i.push({field:e.field,aggregate:"count"});return i},_getGroupOption:function(){for(var e,t=[],i=this._group,a=0;a<i.length;a++)e=i[a],t.push({field:e.field,aggregates:[{field:e.field,aggregate:"count"}]});return t},_createOldData:function(e){return JSON.parse(JSON.stringify(e.data()))},_createNewDataSource:function(e,t){var i=new o.data.DataSource({data:e,group:this._group});return i.filter(this._filter[t]),i},_changeDataSources:function(){this.assignedGroupList.setDataSource(this._assignedDataSource),this.deAssignedGroupList.setDataSource(this._deAssignedDataSource)},_renewDataSources:function(){this._showNormalMode&&this.normalGroupList.setDataSource(this._assignedDataSource),this.assignedGroupList.setDataSource(this._assignedDataSource),this.deAssignedGroupList.setDataSource(this._deAssignedDataSource)},data:function(e){if(!e)return this._data;this._data=e,console.time("PARSE: "),this._parseDataSource(),console.timeEnd("PARSE: "),console.time("TreeList"),this._renewDataSources(),console.timeEnd("TreeList"),this._setDefaultButtonState()},setDataSource:function(e,t){e=e||[],t=t||[],this._data=e,this._group=t,this._parseDataSource(),this._renewDataSources(),this._setDefaultButtonState()},showEditMode:function(){this.wrapper.addClass("edit-mode")},hideEditMode:function(e,t){e?("cancelChanged"==t?this.normalGroupList.setDataSource(this._old):this.normalGroupList.setDataSource(this._assignedDataSource),this.wrapper.removeClass("edit-mode")):(this._old=this._assignedDataSource,this.wrapper.addClass("edit-mode"))},setOptions:function(e){this.normalGroupList.setOptions(e),this.assignedGroupList.setOptions(e),this.deAssignedGroupList.setOptions(e)},hideAllColumns:function(e){if(e!=this._hideAllCollumns){var t=this.wrapper.find(".contents.normal"),i=this.normalGroupList;this._hideAllCollumns=e,(this.options.hideAllColumns=e)?t.addClass("hide-header"):t.removeClass("hide-header"),i.destroy(),this._initNormalGroupList()}},showHeader:function(e){if(e!=this._showEditListHeader){var t=this.wrapper.find(".contents.edit");this._showEditListHeader=e,(this.options.showEditListHeader=e)?t.removeClass("hide-header"):t.addClass("hide-header")}},getAssignedItems:function(){var e,t=this.assignedGroupList.dataSource.data(),i=[];t=new o.data.Query(t).filter({logic:"and",filters:[{field:"hasChildren",operator:"eq",value:!1}]}).toArray();for(var a=0;a<t.length;a++)(e=t[a]).assigned&&i.push(e);return i},getDeAssignedItems:function(){var e,t=this.deAssignedGroupList.dataSource.data(),i=[];t=new o.data.Query(t).filter({logic:"and",filters:[{field:"hasChildren",operator:"eq",value:!1}]}).toArray();for(var a=0;a<t.length;a++)(e=t[a]).assigned||i.push(e);return i},group:function(e){if(!e)return this._group;this._group=e,this.normalGroupList.destroy(),this.assignedGroupList.destroy(),this.deAssignedGroupList.destroy(),this._parseDataSource(),this._initNormalGroupList(),this._initSelectedGroupList(),this._initUnSelectedGroupList()}});o.ui.plugin(t)}(window,window.kendo.jQuery),function(y,I){var s=y.kendo,e=s.dataviz.ui,i=e.Chart,t=e.Chart=i.extend({options:{selectionTooltip:{isVisible:!1,width:200,seriesKeysForRowName:["name"],rowGroupNames:[],rowTemplate:null,top:300,margin:15}},init:function(e,t){i.fn.init.call(this,e,t),this.options.selectionTooltip.isVisible&&(this._initSelectionDOM(),this._attachSelectionEvt())},_attachSelectionEvt:function(){var a=this;a.bind("seriesClick",a._handleSeriesClickEvt),a.element.on("mousemove",a._handlePlotAreaMoveEvt.bind(a)),a.element.on("mouseleave",function(e){var t=a.findPaneByIndex(0);void 0!==t.visual.children[0]._geometry&&t.visual.removeAt(0),a._hideSelectionTooltip(),a._currentSelectionCategorySlotIndex=null}),I(a._selectionTooltipElem).on("mousemove",function(e){var t=e.clientX-a.wrapper.offset().left,i=a._plotArea.axisX._ticks.majorTicks;i[a._currentSelectionCategorySlotIndex]<t&&t<=i[a._currentSelectionCategorySlotIndex+1]||a._hideSelectionTooltip()})},_initSelectionDOM:function(){this._selectionTooltipElem=I("<div></div>").addClass("common-chart-selection-tooltip"),this._selectionTooltipInnerElem=I("<div></div>").addClass("common-chart-selection-tooltip-inner"),this.element.append(this._selectionTooltipElem.append(this._selectionTooltipInnerElem))},_handlePlotAreaMoveEvt:function(e){var t,i=e.originalEvent.layerX,a=this._plotArea.axisX._ticks.majorTicks,n=this._plotArea.backgroundBox(),o=a.length-1;if("path"===I(e.originalEvent.target)[0].nodeName.toLowerCase())for(t=0;t<o;t++)if(a[t]<i&&i<=a[t+1]){if(null!==this._currentSelectionCategorySlotIndex&&this._currentSelectionCategorySlotIndex==t)return;this._renderSelectionHighlighting(t,n),this._renderSelectionTooltip(t,e.clientX),this._currentSelectionCategorySlotIndex=t}},_handleSeriesClickEvt:function(e){var t,i=e.series,a=this._generateRowNameBySeriesKeys(i),n=this._selectionTooltipElem.find(".common-chart-selection-tooltip-row"),o=n.filter(function(e,t){return I(t).data("name")==a});for(t=0;t<n.length;t++)I(n[t]).css({"font-weight":"normal"});I(o).css({"font-weight":"bold"})},_renderSelectionHighlighting:function(e,t){var i=this._plotArea.axisX._ticks.majorTicks,a=i[e+1]-i[e]-3,n=t.height(),o=this.findPaneByIndex(0),r=new s.drawing.Rect(new s.geometry.Rect([i[e]+2,t.y1],[a,n]),{fill:{color:"white"},stroke:{color:"#0081c6",width:1}});void 0!==o.visual.children[0]._geometry&&o.visual.removeAt(0),o.visual.insert(0,r)},_renderSelectionTooltip:function(e,t){var i,a,n,o,r,s,l,d=this,c=y.I18N,u=d._plotArea.axisX._ticks.majorTicks,p=d.options.selectionTooltip.rowTemplate,h=d.options.selectionTooltip.rowGroupNames.slice(0),f=d._hasParentElemScroll()?d.wrapper.parent():d.wrapper,g=f.offset().left+f.width()/2,m=d.options.selectionTooltip.width,v=0,_=d.options.selectionTooltip.top,b=d.options.selectionTooltip.margin,C=[],k=[],w=d.options.series,D=w.length;for(p=p||function(e){return{groupName:"",content:"<span>"+e.name+": "+e.data+"</span>",priority:0}},v=t<g?u[e+1]+b:u[e]-m-b,s=0;s<D;s++)void 0!==w[s].name&&void 0!==w[s].data[e]&&null!==w[s].data[e]&&(r=w[s].data[e],null!==(i=p({series:w[s],data:r,categorySlotIndex:e}))&&(i.name=d._generateRowNameBySeriesKeys(w[s]),C.push(i),0!=_&&(_-=15)));for(h.unshift(""),s=0;s<h.length;s++)0<(a={name:h[s],rows:C.filter(function(e){return e.groupName==h[s]})}).rows.length&&k.push(a);for(d._selectionTooltipInnerElem.empty(),s=0;s<k.length;s++){for(o=I("<div></div>").addClass("common-chart-selection-tooltip-row-group").append(I("<div/>").addClass("common-chart-selection-tooltip-row-group-name").text(k[s].name)),k[s].rows.sort(function(e,t){return t.priority-e.priority}),l=0;l<k[s].rows.length;l++)n=I("<div></div>").addClass("common-chart-selection-tooltip-row").data("name",k[s].rows[l].name).html(k[s].rows[l].content),o.append(n);d._selectionTooltipInnerElem.append(o)}0==d._selectionTooltipInnerElem.children().length&&d._selectionTooltipInnerElem.append(I("<div></div>").addClass("common-chart-selection-tooltip-row-group").html("<span>"+c.prop("COMMON_CHART_SELECTION_TOOLTIP_NO_DATA_TO_DSIPLAY")+"</span>")),d._selectionTooltipElem.css({top:_,left:v,width:m,display:"block"})},_hasParentElemScroll:function(){return this.wrapper.width()>this.wrapper.parent().width()},_hideSelectionTooltip:function(){this._selectionTooltipElem.css({display:"none"})},_showSelectionTooltip:function(){this._selectionTooltipElem.css({display:"block"})},_generateRowNameBySeriesKeys:function(e){var t,i="",a=this.options.selectionTooltip.seriesKeysForRowName;for(t=0;t<a.length;t++)i+=e[a[t]];return i},_currentSelectionCategorySlotIndex:null,_selectionTooltipElem:null,_selectionTooltipInnerElem:null});s.ui.plugin(t)}(window,jQuery),function(e,c){"use strict";var u=e.kendo,t=u.ui,p=c.extend,i=t.Notification,s="k-notification",h=".kendoNotification",a=i.extend({options:{name:"CommonToastPopup",position:{pinned:!1,bottom:50},templates:[{type:"normal",template:"<span class='content'>#=content#</span>"}],autoHideAfter:3e3,target:"body",copyAnchorStyles:!1,hideBeforeShow:!0},_showPopup:function(e,t){var i,a,n=this,o=c(t.target),r=t.copyAnchorStyles,s=t.autoHideAfter,l=t.position.left,d=t.position.top;a=c("."+n._guid+":not(.k-hiding)").last(),i=new u.ui.Popup(e,{anchor:a[0]?a:document.body,copyAnchorStyles:r,appendTo:o,origin:n._popupOrigin,position:n._popupPosition,animation:t.animation,modal:!0,collision:"",isRtl:n._isRtl,close:function(){n._triggerHide(this.element)},deactivate:function(e){e.sender.element.off(h),e.sender.element.find(".k-notification-wrap .k-i-close").off(h),e.sender.destroy()}}),n._attachPopupEvents(t,i),null===l&&(l=(o.width()-e.innerWidth())/2),a[0]?null===d&&(d=a[0].offsetTop-e.innerHeight()):null===d&&(d=o.height()-e.innerHeight()-t.position.bottom),i.open(l,d),i.wrapper.addClass(n._guid).css(p({margin:0,zIndex:10050},n._popupPaddings)),t.position.pinned?(i.wrapper.css("position","fixed"),a[0]&&n._togglePin(i.wrapper,!0)):a[0]||n._togglePin(i.wrapper,!1),0<s&&setTimeout(function(){n._hidePopup(i)},s)},show:function(e,t,i){var a,n,o=this.options,r=c('<div class="k-widget k-notification common-toast-popup"></div>');return o.hideBeforeShow&&this.hide(),t=t||"normal",null!=e&&""!==e&&(u.isFunction(e)&&(e=e()),n={typeIcon:t,content:""},a=c.isPlainObject(e)?p(n,e):p(n,{content:e}),r.addClass(s+"-"+t).toggleClass(s+"-button",o.button).attr("data-role","alert").css({width:o.width,height:o.height}).append(this._getCompiled(t,i)(a)),this.angular("compile",function(){return{elements:r,data:[{dataItem:a}]}}),c(o.appendTo)[0]?this._showStatic(r,o):this._showPopup(r,o),this.trigger("show",{element:r})),this}});t.plugin(a)}(window,jQuery),function(g,m){function r(e){var t,i,a=o.length;for(t=0;t<a;t++)if(-1!=(i=o[t]).indexOf(e))return i}function i(e){if(!e)return[];var t,i,a,n=[],o=e.length;for(a=0;a<o;a++)(t=e[a]).locations&&!t.locations[0]&&(t.locations[0]={}),t.selected=!1,i=v.getDetailDisplayType(t.mappedType||t.type,!0),i=r(i),t.displayType=i,t=new d(t),n.push(t);return n}function n(e){return e||[]}function s(e){var t=c(e);return-1!=t.indexOf("&")&&(t+="&"),t+="registrationStatuses=Registered&",t+="attributes=id,name,type,mappedType,registrationStatus,locations,groups&",t+="types="+l.join(","),m.ajax({url:"/dms/devices"+t}).then(i)}var w=g.kendo,e=w.ui,a=e.DetailDialog,v=g.Util,u={field:"view",operator:"eq",value:!1},D={field:"view",operator:"eq",value:!0},y={field:"name",dir:"asc",compare:function(e,t){return e.name.localeCompare(t.name,"en",{numeric:!0})}},o=[],l=["AirConditioner.*","ControlPoint.AO","ControlPoint.DO","Beacon","Gateway","Light","CCTV"],d=w.data.Model.define({id:"id",fields:{alarms:{type:"object",editType:null},networks:{type:"object"},parentId:{type:"string"},winds:{type:"object"},registrationStatus:{type:"string",options:[{text:"NotRegistered",value:"0"},{text:"Registered",value:"1"},{text:"Deleted",value:"1"}]},name:{type:"string"},information:{type:"object"},subordinateIds:{type:"object"},operations:{type:"object"},mappedType:{type:"string",options:[{text:"ControlPoint",value:"0"},{text:"Light",value:"1"},{text:"Meter.WattHour",value:"2"},{text:"Sensor.Humidity",value:"3"},{text:"Sensor.Motion",value:"4"},{text:"Sensor.Temperature",value:"5"}]},representativeStatus:{type:"string",options:[{text:"Normal.On",value:"0"},{text:"Normal.Off",value:"1"},{text:"Alarm.Critical",value:"2"},{text:"Alarm.Warning",value:"3"},{text:"Alarm.NetworkError",value:"4"},{text:"Disconnected",value:"5"},{text:"LowBattery",value:"6"},{text:"OutOfBounds",value:"7"}]},modes:{type:"object"},controlPoint:{type:"object"},groups:{type:"object"},configuration:{type:"object"},light:{type:"object"},type:{type:"string"},id:{type:"string"},schedules:{type:"object"},description:{type:"string"},locations:{type:"object"},airConditioner:{type:"object"},temperatures:{type:"object"}}}),c=function(e,t,i,a){var n=g.MAIN_WINDOW,o="?";if(e){var r=e.building.id,s=e.floor.id,l=e.zone.id;a?r&&r!=n.FLOOR_NAV_BUILDING_TOTAL_ID&&s&&s==n.FLOOR_NAV_FLOOR_ALL_ID&&(o+="foundation_space_buildings_id="+r+"&"):r&&r!=n.FLOOR_NAV_BUILDING_TOTAL_ID&&(o+="foundation_space_buildings_id="+r+"&"),t||s&&s!=n.FLOOR_NAV_FLOOR_ALL_ID&&(o+="foundation_space_floors_id="+s+"&"),l&&"none"!==l&&"all"!==l&&(o+="foundation_space_zones_id="+l+"&"),"none"===l&&(o+="foundation_space_zones_id=0&")}return i&&0<i.length&&(o+="attributes="+i.join(",")),o};function p(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return!0;return!1}var t=e.DetailDialog.extend({options:{name:"CommonDeviceSelecter",height:830,width:1176,title:"",type:"single",timeout:0,events:["onSave","onSaved","onClose","onClosed"],contentViewModel:null},init:function(e,t){var i=this;i._initOptions(),i._setLoadingPanel(),t=m.extend({},i.options,t),a.fn.init.call(i,e,t),i.msgDialog=null,i.selectableGrid=null,i.selectedGrid=null,i.selectableGroupGrid=null,i.selectedGroupGrid=null,i.selectIds=[],i.data=null,i.viewModel=null,i.confirmDialog,i.beforeScroll={all:{selected:0,selectable:0},group:{selected:0,selectable:0}},i._Filter=[u],i._setSetting(),i._parseDataSource(),i._attchEvent(),t.selectIds&&i.selectIds},_setLoadingPanel:function(){var e=new g.CommonLoadingPanel,t=this;this.Loading={open:function(){e.open(t.wrapper)},close:function(){e.close(t.wrapper)}}},_Loading:function(){return this.Loading},_setViewData:function(){var e,t,i=this,a=[];a.push((t=c(e,null,null,!0),m.ajax({url:"/dms/groups"+t}).then(n))),a.push(s()),m.when.apply(self,a).fail(function(){}).always(function(e,t){t=i._sortDevcieData(t),e=i._sortGroupData(e),i._parsingTotalDeviceData(t),i._parsingTotalGroupData(e),i._parsingGroupData(e,t),i._parsingTotalDeviceData(t),i._parsingGridData(t),i._setGridDataSoruce(),i.Loading.close(),i.trigger("onLoad")})},_sortDevcieData:function(e){return e.sort(function(e,t){return e.name.localeCompare(t.name,"en",{numeric:!0})})},_sortGroupData:function(e){return e.sort(function(e,t){return e.name.localeCompare(t.name,"en",{numeric:!0})})},_parsingTotalOrigineData:function(e){for(var t,i=[],a=0,n=e.length;a<n;a++)i[(t=e[a]).id]=t;this.contentViewModel.totalOriginData=i},_parsingTotalGroupData:function(e){for(var t,i={},a=0,n=e.length;a<n;a++)i[(t=e[a]).id]={index:a,devicesIds:t.dms_devices_ids};this.contentViewModel.totalGroupData=i},_parsingGroupData:function(e){for(var t,i,a=e.length-1;0<=a;a--){for(var n=(t=e[a]).dms_devices_ids.length-1;0<=n;n--)i=t.dms_devices_ids[n],this.contentViewModel.totalDeviceData[i]||t.dms_devices_ids.splice(n,1);0===t.dms_devices_ids.length&&e.splice(a,1)}this.contentViewModel.set("groupData",e),this._setGroupGridDataSoruce()},_parsingGridData:function(e){this.contentViewModel.set("deviceData",e)},_parsingTotalDeviceData:function(e,t){for(var i={},a=0,n=e.length;a<n;a++)i[e[a].id]={index:a};t||(this.contentViewModel.totalDeviceData=m.extend(!0,{},i)),this.contentViewModel.totalSelectableDeviceDate=i},_setSetting:function(){o=function(){var e,t,i,a=g.GlobalSettings.getDeviceTypeOrdering(),n=[],o=a.length;for(i=0;i<o;i++)e=a[i],t=v.getDetailDisplayType(e,!0),n.push(i+"_"+t),"Sensor.Temperature_Humidity"==e&&(n.push(i+"_"+v.getDetailDisplayType("Sensor.Temperature",!0)),n.push(i+"_"+v.getDetailDisplayType("Sensor.Humidity",!0)));return n}()},_initOptions:function(){var e=g.I18N,t=this,i="<div class='device-selecter-wrapper'><div class='sect selectable'><div class='selectable-header device-selecter-header'><span>"+e.prop("FACILITY_SCHEDULE_DEVICE")+"</span></div><div class='selectable-content'><div class='selectable-top-tab'><ul class='selecter-tab-inner'><li data-bind='css:{selected: isAllSelected}, click: clickdAllDevice' ><span class='k-link'>"+e.prop("COMMON_ALL")+"</span> <span>( <span data-bind='text: selectableCount.all'></span><span>"+e.prop("FACILITY_SCHEDULE_COUNT")+"</span> )</span></li><li data-bind='css:{selected: isGroupSelected}, click: clickGroup'><span class='k-link'>"+e.prop("FACILITY_GROUP_GROUP")+"</span> <span>( <span data-bind='text: selectableCount.group'></span><span>"+e.prop("FACILITY_SCHEDULE_COUNT")+"</span> )</span></li></ul></div><div class='search-filter-wrap'><div class='search-box'><input type='text' class='k-textbox' data-bind='value: search.value }' placeholder='"+e.prop("FACILITY_DEVICE_SEARCH_PLACEHOLDER")+"'><span class='search-rmv-btn ic ic-bt-input-remove' data-bind='events: {click: search.removeBtn.click}, visible: search.removeBtn.isVisible'></span><button class='search-btn ic ic-bt-input-search' data-bind='events: { click: search.click }' >"+e.prop("COMMON_BTN_SEARCH")+"</button></div></div><div class='all-device' data-bind='visible: isVisible'><div class='sort-filter-wrap'><input id='device-selecter-sort-building' class='sort-item building' data-role='dropdownlist' data-text-field='name' data-value-field='id' data-option-label='"+e.prop("FACILITY_SCHEDULE_BUILDING")+"'  data-bind='value: building.value, source: building.dataSource, enabled: building.enabled, events: { cascade: building.events.cascade }' ></input ><input id='device-selecter-sort-floor' class='sort-item floor' data-role='dropdownlist' data-text-field='name' data-value-field='id' data-option-label='"+e.prop("FACILITY_DEVICE_ENERGY_METER_FLOOR")+"'  data-bind='value: floor.value, source: floor.dataSource, enabled: floor.enabled, events: { cascade: floor.events.cascade }' ></input ><input id='device-selecter-sort-zone' class='sort-item zone' data-role='dropdownlist' data-text-field='name' data-value-field='id' data-option-label='"+e.prop("COMMON_ZONE")+"'  data-bind='value: zone.value, source: zone.dataSource, enabled: zone.enabled, events: { cascade: zone.events.cascade }' ></input ><input id='device-selecter-sort-type' class='sort-item type' data-role='dropdowncheckbox' data-text-field='text' data-value-field='value' data-option-label='false' data-select-all-text='"+e.prop("FACILITY_SCHEDULE_DEVICE_TYPE_ALL")+"'  data-bind='source: type.dataSource, enabled: type.enabled, events: { updatedText: type.events.updatedText, selectionChanged: type.events.selectionChanged }' ></input ><input id='device-selecter-sort-id' class='sort-item id' data-role='dropdownlist' data-text-field='displayType' data-value-field='type' data-option-label='"+e.prop("FACILITY_SCHEDULE_DEVICE_SUB_TYPE")+"'  data-bind='value: id.value, source: id.dataSource, enabled: id.enabled, events: { change: id.events.change }' ></input ></div><div class='selectable-grid all'></div></div><div class='group-device' data-bind='invisible: isVisible'><div class='sort-filter-wrap'><ul class='radio-list'><li><input type='radio' name='radio-list' id='group-all' value='all' class='k-radio' data-bind='checked: groupRadio.selectedGroupType, events: { change: groupRadio.onChange }'><label class='k-radio-label' for='group-all'>"+e.prop("COMMON_ALL")+"</label></li><li class='general'><input type='radio' name='radio-list' id='group-general' value='General' class='k-radio' data-bind='checked: groupRadio.selectedGroupType, events: { change: groupRadio.onChange }'><label class='k-radio-label' for='group-general'>"+e.prop("COMMON_GENERAL")+"</label></li><li><input type='radio' name='radio-list' id='group-energy-distribution' value='energyDistribution' class='k-radio' data-bind='checked: groupRadio.selectedGroupType, events: { change: groupRadio.onChange }'><label class='k-radio-label' for='group-energy-distribution'>"+e.prop("ENERGY_ENERGY_DISTRIBUTION")+"</label></li></ul></div><div class='selectable-grid group'></div></div></div><div class='grid-selected-count' data-bind='visible: isVisible'><span data-bind='visible: selectableItemVisible.all'> <span data-bind='text: selectableItemCount.all'></span>"+e.prop("FACILITY_SCHEDULE_SELECTED_COUNT")+" </span></div><div class='grid-selected-count' data-bind='invisible: isVisible'><span data-bind='visible: selectableItemVisible.group'> <span data-bind='text: selectableItemCount.group'></span>"+e.prop("FACILITY_SCHEDULE_SELECTED_COUNT")+"</span></div></div><div class='sect buttons'><button type='button' class='k-button select' data-bind='click: btn.clickSelectBtn'><i class='ic-arrow' />\u25b6</button><button type='button' class='k-button deselect' data-bind='click: btn.clickDeSelectBtn'><i class='ic-arrow' />\u25c0</button></div><div class='sect selected'><div class='selected-header device-selecter-header'><span>"+e.prop("FACILITY_DEVICE_SELECTER_TITLE")+"</span><span class='selected-device-count' data-bind='text: selectedDeviceCount'></span></div><div class='selected-content'><div class='selected-top-tab'><ul class='selecter-tab-inner'><li data-bind='css:{selected: isAllSelected}, click: clickdAllDevice'><span class='k-link'>"+e.prop("COMMON_ALL")+"</span> <span>( <span data-bind='text: selectedCount.all'></span><span>"+e.prop("FACILITY_SCHEDULE_COUNT")+"</span> )</span></li><li data-bind='css:{selected: isGroupSelected}, click: clickGroup'><span class='k-link'>"+e.prop("FACILITY_GROUP_GROUP")+"</span> <span>( <span data-bind='text: selectedCount.group'></span><span>"+e.prop("FACILITY_SCHEDULE_COUNT")+"</span> )</span></li></ul></div><div class='all-device' data-bind='visible: isVisible'><div class='selected-grid all'></div></div><div class='group-device' data-bind='invisible: isVisible'><div class='selected-grid group'></div></div></div><div class='grid-selected-count' data-bind='visible: isVisible'><span data-bind='visible: selectedItemVisible.all'> <span data-bind='text: selectedItemCount.all'></span>"+e.prop("FACILITY_SCHEDULE_SELECTED_COUNT")+" </span></div><div class='grid-selected-count' data-bind='invisible: isVisible'><span data-bind='visible: selectedItemVisible.group'> <span data-bind='text: selectedItemCount.group'></span>"+e.prop("FACILITY_SCHEDULE_SELECTED_COUNT")+" </span></div></div></div>",a=[{text:e.prop("COMMON_BTN_CLOSE"),visible:!0,disabled:!1,action:function(e){e.sender.trigger("onClose")}},{text:e.prop("COMMON_BTN_SAVE"),visible:!0,disabled:!1,action:t._onSave.bind(t)},{text:e.prop("COMMON_BTN_EDIT"),visible:!1,disabled:!1,action:function(e){}}],n=i,o=v.getControllableDeviceTypeDataSource(),r=w.observable({totalDeviceData:{},totalGroupData:{},totalSelectableDeviceDate:{},deviceData:null,groupData:null,zoneDeviceData:[],selectableCount:{all:0,group:0},selectedCount:{all:0,group:0},selectableItemVisible:{all:0,group:0},selectedItemVisible:{all:0,group:0},selectableItemCount:{all:0,group:0},selectedItemCount:{all:0,group:0},search:{value:"",click:t._onSearchKeyword.bind(t),removeBtn:{click:t._onRemoveKeyword.bind(t),isVisible:!1}},floorData:{building:{id:""},floor:{id:""},zone:{id:""}},building:{index:0,value:null,dataSource:[],enabled:!0,events:{change:function(){},cascade:t.buildingChange}},floor:{index:0,value:null,dataSource:[],enabled:!1,events:{change:function(){},cascade:t.floorChange}},zone:{index:0,value:null,dataSource:[],enabled:!1,events:{change:function(){},cascade:t.zoneChange}},type:{index:0,value:null,dataSource:o,enabled:!0,events:{change:function(){},updatedText:t._updatedText,selectionChanged:t.typeChange,setGridFiler:t._setGridFilter.bind(t),subTypeFilter:t._subTypeFilter.bind(t)}},id:{index:0,value:{type:null},dataSource:[],enabled:!1,events:{change:t.subTypeChange,cascade:t.subTypeChange}},btn:{clickSelectBtn:t._clickSelectBtn.bind(t),clickDeSelectBtn:t._clickDeSelectBtn.bind(t)},isAllSelected:!0,isGroupSelected:!1,isVisible:!0,clickdAllDevice:t._onClickAllDeviceTab.bind(t),clickGroup:t._onClickGroupTab.bind(t),selectedDeviceCount:e.prop("FACILITY_SCHEDULE_CREATE_SELECTED_DEVICE",0),groupRadio:{selectedGroupType:"all",onChange:t._onChangeGroupType.bind(t)},events:{setGridFiler:t._setGridFilter.bind(t),Loading:t._Loading.bind(t)}});t.options.title=e.prop("FACILITY_SCHEDULE_SELECT_DEVICE"),t.options.actions=a,t.options.buttonsIndex={CLOSE:0,EDIT:2,CANCEL:3,SAVE:1,REGISTER:4,DEREGISTER:5,DELETE:6},t.options.isCustomActions=!0,t.options.detailContentTemplate=n,t.options.contentViewModel=r,t.options.onTypeChange=t._onTypeChangeEvt.bind(t)},_parseDataSource:function(){},_reset:function(){var e,t,i=this.contentViewModel,a=["building","floor","zone"];for(e=0;e<a.length;e++)i[t=a[e]].set("value",null),i[t].set("dataSource",[]),i[t].set("enabled","building"===t);i.type.set("value",null),i.id.set("value",{type:null}),i.id.set("dataSource",[]),i.id.set("enabled",!1),i.groupRadio.set("selectedGroupType","all");var n=["selectableItemVisible","selectedItemVisible","selectableItemCount","selectedItemCount"];for(e=0;e<n.length;e++)i[t=n[e]].set("all",0),i[t].set("group",0)},_onSave:function(e){this.trigger("onSave",{sender:e.sender,result:this._selectedDeviceData()})},_onClickAllDeviceTab:function(e){var t=this.contentViewModel;this.beforeScroll.group.selectable=this.selectableGroupGrid.wrapper.find(".k-scrollbar").scrollTop(),this.beforeScroll.group.selected=this.selectedGroupGrid.wrapper.find(".k-scrollbar").scrollTop(),t.set("isVisible",!0),t.set("isAllSelected",!0),t.set("isGroupSelected",!1),this.selectableGrid.virtualScrollable.repaintScrollbar(),this.selectedGrid.virtualScrollable.repaintScrollbar(),this.selectableGrid.wrapper.find(".k-scrollbar").scrollTop(this.beforeScroll.all.selectable),this.selectedGrid.wrapper.find(".k-scrollbar").scrollTop(this.beforeScroll.all.selected),this._gridSetScrollTop(!0)},_onClickGroupTab:function(e){var t=this.contentViewModel;this.beforeScroll.all.selectable=this.selectableGrid.wrapper.find(".k-scrollbar").scrollTop(),this.beforeScroll.all.selected=this.selectedGrid.wrapper.find(".k-scrollbar").scrollTop(),t.set("isVisible",!1),t.set("isAllSelected",!1),t.set("isGroupSelected",!0),this.selectableGroupGrid.virtualScrollable.repaintScrollbar(),this.selectedGroupGrid.virtualScrollable.repaintScrollbar(),this.selectableGroupGrid.wrapper.find(".k-scrollbar").scrollTop(this.beforeScroll.group.selectable),this.selectedGroupGrid.wrapper.find(".k-scrollbar").scrollTop(this.beforeScroll.group.selected),this._gridSetScrollTop(!0)},_sortSelectedDeviceView:function(e,t){return e.view-t.view},_sortSelectedDeviceLength:function(e,t){return t.devicesIds.length-e.devicesIds.length},_syncDeviceList:function(e,t,i,a,n,o){var r,s,l,d,c,u,p,h=e.sort(function(e,t){return e.view-t.view});for(s=0,d=h.length;s<d;s++)for(c=(r=h[s]).devicesIds,u=r.view,p=c.length,l=0;l<p;l++)i[c[l]]&&a[i[c[l]].index]&&(a[i[c[l]].index].view=u),n[c[l]]&&o[n[c[l]].index]&&(o[n[c[l]].index].view=u)},_syncSelectDeviceList:function(e,t,i,a){var n,o,r,s,l,d,c,u,p=0,h=[];for(r=0,l=e.length;r<l;r++){for(p=0,o=e[r],n=t[r],u=(d=o.devicesIds).length,s=0;s<u;s++)i[d[s]]&&a[i[d[s]].index]&&a[i[d[s]].index].view&&p++;(c=p===u)!==n.view&&h.push(d),o.view=c,n.view=c}return h},_changeGroupSyncDevice:function(e,t,i,a,n,o){var r,s,l,d,c,u=!o;for(r=0,s=e.length;r<s;r++)for(d=(l=e[r]).length,c=0;c<d;c++)t[l[c]]&&i[t[l[c]].index]&&(i[t[l[c]].index].view=u),a[l[c]]&&n[a[l[c]].index]&&(n[a[l[c]].index].view=u)},_syncDevice:function(e,t){var i=this.selectedGrid,a=this.selectableGroupGrid,n=this.selectedGroupGrid,o=a.dataSource.data().map(function(e){return e}).sort(this._sortSelectedDevice).sort(this._sortSelectedDeviceLength),r=n.dataSource.data().map(function(e){return e}).sort(this._sortSelectedDevice).sort(this._sortSelectedDeviceLength),s=this.contentViewModel.get("deviceData"),l=i.dataSource.data(),d=this.contentViewModel.totalDeviceData,c=this.contentViewModel.totalSelectableDeviceDate;e||this._syncDeviceList(r,o,c,s,d,l,t),this.selectableGrid.dataSource.page(this.selectableGrid.dataSource.page()),this.selectedGrid.dataSource.page(this.selectedGrid.dataSource.page()),this.selectableGroupGrid.dataSource.page(this.selectableGroupGrid.dataSource.page()),this.selectedGroupGrid.dataSource.page(this.selectedGroupGrid.dataSource.page()),this.selectableGrid.dataSource.filter(this.selectableGrid.dataSource.filter()),this.selectedGrid.dataSource.filter(this.selectedGrid.dataSource.filter()),this.selectableGroupGrid.dataSource.filter(this.selectableGroupGrid.dataSource.filter()),this.selectedGroupGrid.dataSource.filter(this.selectedGroupGrid.dataSource.filter()),this.selectableGroupGrid.dataSource.sort(y),this.selectedGroupGrid.dataSource.sort(y),this._setGridFilter(!0)},_onChangeGroupType:function(e){var t=this.contentViewModel.groupRadio.get("selectedGroupType"),i=[u];"all"!==t&&i.push({field:"type",operator:"eq",value:t}),this.selectableGroupGrid.dataSource.filter(i)},_gridSetScrollTop:function(e){e?(this.selectableGrid.virtualScrollable.verticalScrollbar.trigger("scroll"),this.selectedGrid.virtualScrollable.verticalScrollbar.trigger("scroll"),this.selectableGroupGrid.virtualScrollable.verticalScrollbar.trigger("scroll"),this.selectedGroupGrid.virtualScrollable.verticalScrollbar.trigger("scroll")):(this.selectableGrid.dataSource.page(1),this.selectedGrid.dataSource.page(1),this.selectableGrid.wrapper.find(".k-scrollbar").scrollTop(0),this.selectedGrid.wrapper.find(".k-scrollbar").scrollTop(0))},_changeAllGridDataSet:function(){var e=this.selectableGrid.getSelectedData().filter(function(e){return!e.view}).length,t=this.selectedGrid.getSelectedData().filter(function(e){return e.view}).length;this.contentViewModel.selectableItemVisible.set("all",0<e),this.contentViewModel.selectedItemVisible.set("all",0<t),this.contentViewModel.selectableItemCount.set("all",e),this.contentViewModel.selectedItemCount.set("all",t)},_changeGroupGridDataSet:function(){var e=this.selectableGroupGrid.getSelectedData().length,t=this.selectedGroupGrid.getSelectedData().length;this.contentViewModel.selectableItemVisible.set("group",0<e),this.contentViewModel.selectedItemVisible.set("group",0<t),this.contentViewModel.selectableItemCount.set("group",e),this.contentViewModel.selectedItemCount.set("group",t)},_attchGridEvent:function(){var t=this;t.selectableGrid.bind("change",function(e){t._changeAllGridDataSet()}),t.selectedGrid.bind("change",function(e){t._changeAllGridDataSet()}),t.selectableGroupGrid.bind("change",function(e){t._changeGroupGridDataSet()}),t.selectedGroupGrid.bind("change",function(e){t._changeGroupGridDataSet()})},_initComponent:function(){var e=g.MAIN_WINDOW.getCurrentBuildingList();this.contentViewModel.building.set("dataSource",e),this.Loading.open(),this._initSelectableGrid(),this._initSelectedGrid(),this._initGroupGrid(),this._attchGridEvent(),this._setViewData(),g.selectableGrid=this.selectableGrid,g.selectedGrid=this.selectedGrid},_setSearchFilter:function(e,t){for(var i=0,a=e.filters.length;i<a;i++)e.filters[i].search&&e.filters.splice(i,1);var n=this.contentViewModel.search.get("value");if(""===n)return e;var o={logic:"or",filters:[],search:!0};return o.filters.push({field:"name",operator:function(e){return-1!==e.indexOf(n)},value:n}),t&&o.filters.push({field:"id",operator:function(e){return-1!==e.indexOf(n)},value:n}),e.filters.push(o),e},_onSearchKeyword:function(){var e=this.contentViewModel.get("isVisible"),t=e?this.selectableGrid:this.selectableGroupGrid;t.dataSource.filter(this._setSearchFilter(t.dataSource.filter(),e))},_onRemoveKeyword:function(){this.contentViewModel.search.set("value","")},_setSelectGridDataSoruce:function(e,t,i,a){var n,o,r,s=t?this.selectableGrid:this.selectableGroupGrid,l=t?this.selectedGrid:this.selectedGroupGrid,d=s.dataSource.data(),c=l.dataSource.data(),u=e?c:d,p=e?d:c;o=t?(n=e?this.contentViewModel.totalSelectableDeviceDate:this.contentViewModel.totalDeviceData,e?this.contentViewModel.totalDeviceData:this.contentViewModel.totalSelectableDeviceDate):(n=this.contentViewModel.totalGroupData,this.contentViewModel.totalGroupData),a&&(n[a]&&(r=p[n[a].index]),r&&(r.view=!e),o[a]&&(r=u[o[a].index]),r&&(r.view=!e),s.clearSelection(),l.clearSelection());for(var h=0,f=u.length;h<f;h++)u[h].selected&&(u[h].view=!e,r=null,n[u[h].id]&&(r=p[n[u[h].id].index]),r&&(r.view=!e));var g=s.dataSource.filter(),m=s.dataSource.page(),v=new w.data.DataSource({pageSize:8,data:d,filter:g,sort:y});v.read();var _=l.dataSource.page(),b=new w.data.DataSource({pageSize:10,data:c,filter:D,sort:y});if(b.read(),s.setDataSource(v),l.setDataSource(b),i){var C=s.dataSource.totalPages(),k=l.dataSource.totalPages();m=C<m?C:m,_=k<_?k:_,s.dataSource.page(m),l.dataSource.page(_)}s.clearSelection(),l.clearSelection(),this._setGridFilter(!0)},_clickSelectBtn:function(){var e=this.contentViewModel.get("isVisible");this._setSelectGridDataSoruce(!1,e,!0)},_clickDeSelectBtn:function(){var e=this.contentViewModel.get("isVisible");this._setSelectGridDataSoruce(!0,e,!0)},_setGridFilter:function(e){var t=[u];this._setTypeFilter(t),this._setSubTypeFilter(t),this.getLoactionFilter(t);var i,a,n,o=this.contentViewModel.get("deviceData"),r=this.contentViewModel.totalDeviceData,s=this.selectedGrid.dataSource.data(),l=[];if(o){a=o.length;for(var d=0;d<a;d++)r[(i=o[d]).id]&&(n=s[r[i.id].index]),i.view=!!n&&n.view,l[d]={id:i.id,name:i.name,locations:i.locations,type:i.type,mappedType:i.mappedType,view:i.view};var c=new w.data.DataSource({pageSize:8,data:l,filter:t});this.selectableGrid.setDataSource(c),this._gridSetScrollTop(e),this._parsingTotalDeviceData(o,!0),this.Loading.close()}},_setTypeFilter:function(e){var t=this.contentViewModel.type.get("value");if(t){var i,a,n,o={logic:"or",filters:[]};if(0<(t=t.newValue).length)for(n=t.length,a=0;a<n;a++)(i=t[a])&&("ControlPoint"!=i&&o.filters.push({field:"type",operator:"contains",value:i}),o.filters.push({field:"mappedType",operator:"contains",value:i}));e.push(o)}},_setSubTypeFilter:function(e){var t,i,a={logic:"and",filters:[]},n=this.contentViewModel.id.get("value");if((n=n.type)&&"All"!=n){var o=n.split(",");if(1<o.length){i=o.length;var r={logic:"or",filters:[]};for(t=0;t<i;t++)r.filters.push({field:"type",operator:"eq",value:o[t]});a.filters.push(r)}else a.filters.push({field:"type",operator:"eq",value:n});e.push(a)}},getLoactionFilter:function(e){var t,n,i,o,a=this.contentViewModel.get("floorData").zone,r=a.id;a&&"all"!=r&&("none"===r&&(r=0),e.push((t="locations",n="foundation_space_zones_id","vAuto"===(i=a.id)&&(o="AirConditioner.Indoor.Ventilator",i="Auto"),{field:t,operator:function(e,t){if(""==t)return!0;if(e&&e.length){var i,a=e.length;if("undefined"==t){for(i=0;i<a;i++)if(void 0===e[i][n])return!0}else for(i=0;i<a;i++)if(e[i][n]==t)return!o||o===e[i].id||void 0}},value:i})))},_setGridDataSoruce:function(){var e,t,i=this.contentViewModel.get("deviceData"),a=[],n=[];t=i.length;for(var o=0;o<t;o++)(e=i[o])&&(a.push({id:e.id,name:e.name,locations:e.locations,mappedType:e.mappedType,type:e.type,view:!1}),n.push({id:e.id,name:e.name,locations:e.locations,mappedType:e.mappedType,type:e.type,view:!1}));if(0<this.selectIds.length)for(var r=this.selectIds,s=this.contentViewModel.totalDeviceData,l=this.contentViewModel.totalSelectableDeviceDate,d=0,c=r.length;d<c;d++)l[r[d]]&&(a[l[r[d]].index].view=!0),s[r[d]]&&(n[s[r[d]].index].view=!0);var u=new w.data.DataSource({pageSize:8,data:a,filter:{field:"view",operator:"eq",value:!1}});this.selectableGrid.setDataSource(u);var p=new w.data.DataSource({pageSize:10,data:n,filter:D});this.selectedGrid.setDataSource(p)},_setGroupGridDataSoruce:function(){var e,t,i=this.contentViewModel.get("groupData"),a=[],n=[];t=i.length;for(var o=0;o<t;o++)e=i[o],a[o]={id:e.id,name:e.name,type:e.type,devicesIds:e.dms_devices_ids,view:!1},n[o]={id:e.id,name:e.name,type:e.type,devicesIds:e.dms_devices_ids,view:!1};var r=new w.data.DataSource({pageSize:8,data:a,filter:u,sort:y});this.selectableGroupGrid.setDataSource(r);var s=new w.data.DataSource({pageSize:10,data:n,filter:D,sort:y});this.selectedGroupGrid.setDataSource(s)},_initGroupGrid:function(){var e,t=this;this.contentViewModel.set("isVisible",!1),this.contentViewModel.set("isVisible",!1),e=this.wrapper.find(".selectable-grid.group"),this.selectableGroupGrid=e.kendoGrid({dataSource:[],columns:[{field:"id",title:"id",template:"<div>#: data.name # </div>"}],height:484,scrollable:{virtual:!0},groupable:!1,sortable:!0,filterable:!1,pageable:!1,useSingleSelection:!0,selectable:"multiple row",hasSelectedModel:!0,setSelectedAttribute:!0,noRecords:{template:"<div></div>"}}).data("kendoGrid"),e=this.wrapper.find(".selected-grid.group"),this.selectedGroupGrid=e.kendoGrid({dataSource:[],columns:[{field:"id",title:"id",template:"<div>#: data.name # </div>"}],height:576,scrollable:{virtual:!0},groupable:!1,sortable:!0,filterable:!1,pageable:!1,useSingleSelection:!0,selectable:"multiple row",hasSelectedModel:!0,setSelectedAttribute:!0,noRecords:{template:"<div></div>"}}).data("kendoGrid"),this.selectedGroupGrid.bind("dataBound",function(e){t._countSelectedDevcie()}),this.contentViewModel.set("isVisible",!0),this.contentViewModel.set("isVisible",!0)},_initSelectableGrid:function(){var e=this.wrapper.find(".selectable-grid.all");this.selectableGrid=e.kendoGrid({dataSource:[],columns:[{field:"device",title:"Device",template:"<div class='name'>#: data.name # </div><div class='id'>#: data.id#</div>"}],height:484,scrollable:{virtual:!0},groupable:!1,sortable:!0,filterable:!1,pageable:!1,useSingleSelection:!0,selectable:"multiple row",hasSelectedModel:!0,setSelectedAttribute:!0,noRecords:{template:"<div></div>"}}).data("kendoGrid")},_initSelectedGrid:function(){var t=this,e=this.wrapper.find(".selected-grid.all");this.selectedGrid=e.kendoGrid({dataSource:[],columns:[{field:"id",title:"ID",template:"<div class='name'>#: data.name # </div><div class='id'>#: data.id#</div>"}],height:576,scrollable:{virtual:!0},groupable:!1,sortable:!0,filterable:!1,pageable:!1,useSingleSelection:!0,selectable:"multiple row",hasSelectedModel:!0,setSelectedAttribute:!0,noRecords:{template:"<div></div>"}}).data("kendoGrid"),this.selectedGrid.bind("dataBound",function(e){t._countSelectedDevcie()})},_selectedDeviceData:function(){var e=[],t=this.selectedGrid.dataSource.data(),i=new w.data.Query(t).filter({logic:"and",filters:[{field:"view",operator:"eq",value:!0}]}).toArray();this.contentViewModel.selectableCount.set("all",t.length-i.length),this.contentViewModel.selectedCount.set("all",i.length),e=i;var a={},n=[],o=this.contentViewModel.deviceData,r=this.contentViewModel.totalDeviceData;t=this.selectedGroupGrid.dataSource.data(),n=new w.data.Query(t).filter({logic:"and",filters:[{field:"view",operator:"eq",value:!0}]}).toArray();for(var s=0;s<n.length;s++)n[s].devicesIds.forEach(function(e){r[e].index&&(a[e]=o[r[e].index])});for(var l in a)e.push(a[l]);return this.contentViewModel.selectableCount.set("group",t.length-n.length),this.contentViewModel.selectedCount.set("group",n.length),function(e,t){for(var i=[],a=[],n=0;n<e.length;n++){var o=e[n];p(i,o[t])||(a.push(o),i.push(o[t]))}return a}(e,"id")},_countSelectedDevcie:function(){var e=this._selectedDeviceData();this.contentViewModel.set("selectedDeviceCount",g.I18N.prop("FACILITY_SCHEDULE_CREATE_SELECTED_DEVICE",e.length))},_attchEvent:function(){var i=this,a=this.contentViewModel;m(i.wrapper).keydown(function(e){if(i.selectableGrid&&(e.ctrlKey&&65===e.keyCode)){var t=a.get("isVisible")?i.selectableGrid:i.selectableGroupGrid;t.dataSource.data().reduce(function(e,t){return!!e&&!!t.selected},!0)?t.clearSelection():t.selectAll(!0)}}),i.wrapper.on("keyup",function(e){if(13===e.keyCode){var t=i.wrapper.find(".search-box input").val();a.search.set("value",t),a.search.click()}}),m(i.wrapper).on("dblclick",".selectable-grid.all tr",function(e){var t=m(e.currentTarget).data("id");i._setSelectGridDataSoruce(!1,!0,!0,t)}),m(i.wrapper).on("dblclick",".selected-grid.all tr",function(e){var t=m(e.currentTarget).data("id");i._setSelectGridDataSoruce(!0,!0,!0,t)}),m(i.wrapper).on("dblclick",".selectable-grid.group tr",function(e){var t=m(e.currentTarget).data("id");i._setSelectGridDataSoruce(!1,!1,!0,t)}),m(i.wrapper).on("dblclick",".selected-grid.group tr",function(e){var t=m(e.currentTarget).data("id");i._setSelectGridDataSoruce(!0,!1,!0,t)}),m(i.wrapper).on("input",".search-box input",function(e){a.search.removeBtn.set("isVisible",0<this.value.length)})},_onTypeChangeEvt:function(){},buildingChange:function(e){var i,a=e.sender.value(),n=this;""===a&&(a=0,n.floor.set("enabled",!1),n.zone.set("enabled",!1),n.floor.set("value",""),n.zone.set("value","")),!a&&0!==a||(n.floorData.building.id=a,n.floorData.floor.set("id",""),n.floorData.zone.set("id",""),n.type.events.selectionChanged.call(this),m.ajax({url:"/foundation/space/floors?foundation_space_buildings_id="+a}).done(function(e){e.sort(function(e,t){return e.sortOrder-t.sortOrder}),i=e.length;for(var t=0;t<i;t++)e[t].name=v.getFloorName(e[t]);n.floor.set("dataSource",e),n.floor.set("enabled",0!==a)}).fail(function(){}).always(function(){}))},floorChange:function(t){var i=g.I18N,e=t.sender.value(),a=this;e?(a.floorData.floor.id=e,a.floorData.zone.set("id",""),a.type.events.selectionChanged.call(this),m.ajax({url:"/foundation/space/zones?foundation_space_floors_id="+e}).done(function(e){e.sort(function(e,t){return e.sortOrder-t.sortOrder}),e&&m.isArray&&(e.unshift({name:i.prop("FACILITY_DEVICE_FILTER_SELECT_EMPTY_ZONE"),id:"none"}),e.unshift({name:i.prop("FACILITY_DEVICE_ALL_ZONE"),id:"all"})),function(e,t){var i=this,a=i.building.get("value");a instanceof w.data.ObservableObject&&(a=a.id);var n=i.floor.get("value");n instanceof w.data.ObservableObject&&(n=n.id);var o=i.zone.get("value");o instanceof w.data.ObservableObject&&(o=o.id);var r=i.type.get("value");r instanceof w.data.ObservableObject&&(r=r.type);var s=i.building.enabled,l=i.floor.enabled,d=i.zone.enabled,c=i.type.enabled,u=i.id.enabled;s&&l&&d&&c&&u&&""!==a&&null!=a&&""!==n&&null!=n&&""!==o&&null!=o&&""!==r&&null!=r||(i.zone.set("dataSource",t),i.zone.set("enabled",!0))}.bind(a)(t,e)}).fail(function(){}).always(function(){})):(a.zone.set("enabled",!1),a.zone.set("value",""))},zoneChange:function(e){var t=e.sender.value();t&&(this.floorData.zone.id=t,this.type.set("enabled",!0),this.type.events.selectionChanged.call(this))},_updatedText:function(e){var t=e.sender,i=t.getSelectedItems(),a=t.element.parent().find(".k-dropdown-wrap .k-input");0===i.length?a.text(t.options.selectAllText):1===i.length&&a.text(i[0].innerText)},typeChange:function(e){this.events.Loading().open();var d=this,c=e;c&&(d.type.value=c),d.type.events.subTypeFilter(c);var t=d.get("floorData"),i=d.floorData.building.get("id"),a=d.floorData.floor.get("id"),n=d.floorData.zone.get("id");a instanceof w.data.ObservableObject&&(n=n.id);var o=[],u=[],p=[];o.push(s(t).done(function(e){u=e})),m.when.apply(d,o).fail(function(){}).always(function(){var e,t,i,a,n,o,r=!1;for(i=u.length,a=p.length,e=0;e<a;e++){for(o=p[e],r=!1,t=0;t<i;t++)if(n=u[t],o.id==n.id){r=!0;break}r||u.push(o)}u=u.sort(function(e,t){return e.name.localeCompare(t.name,"en",{numeric:!0})}),d.set("deviceData",u),d.id.set("enabled",!!c),d.type.events.setGridFiler();var s=d.type.get("value"),l=!1;s&&1===s.newValue.length&&(l="AirConditioner."==s.newValue[0]||"ControlPoint"==s.newValue[0]),d.id.set("enabled",l)})},subTypeChange:function(e){var t=e.sender.value();t&&(this.id.value.type=t,this.type.events.setGridFiler())},_subTypeFilter:function(e){if(e){function t(){o.set("enabled",!1),s.setOptions({optionLabel:a.prop("FACILITY_SCHEDULE_DEVICE_SUB_TYPE")}),o.set("dataSource",[]),o.set("value",{type:null})}var i,a=g.I18N,n=this.contentViewModel,o=n.get("id"),r={AirConditioner:a.prop("FACILITY_DEVICE_TYPE_SAC_INDOOR"),AirConditionerOutdoor:a.prop("FACILITY_DEVICE_TYPE_SAC_OUTDOOR"),ControlPoint:a.prop("FACILITY_DEVICE_TYPE_POINT"),Meter:a.prop("FACILITY_DEVICE_TYPE_ENERGY_METER"),Beacon:a.prop("FACILITY_DEVICE_TYPE_BLE_BEACON"),"IoT Gateway":a.prop("FACILITY_DEVICE_TYPE_IOT_GATEWAY"),Light:a.prop("FACILITY_DEVICE_TYPE_LIGHT"),CCTV:a.prop("FACILITY_DEVICE_TYPE_CCTV"),Printer:a.prop("FACILITY_DEVICE_TYPE_PRINTER")},s=this.wrapper.find("input.sort-item.id").data("kendoDropDownList"),l=n.get("type").dataSource.length,d=e.newValue.length;if(d==l.length)t(),e="All";else if(1<d||0===d)t();else{i=(i=e.newValue[0]).replace(".","");var c,u,p=v.getDeviceTypeList(i,!0);if("ControlPoint"==i){for(c=(u=p.length)-1;0<=c;c--)"AV"==p[c].displayType?p.splice(c,1):"DV"==p[c].displayType&&p.splice(c,1);p.reverse()}if("AirConditioner"==i)for(u=p.length,p=m.extend(!0,[],p),c=u-1;0<=c;c--)"AirConditioner.SFCU"==p[c].type&&p.splice(c,1),"AirConditioner.FCU"==p[c].type&&(p[c].type="AirConditioner.FCU,AirConditioner.SFCU");if(1==p.length&&p[0].type==i||p.length<1)t();else{var h=r[i],f=a.prop("COMMON_ALL")+" "+h+" "+a.prop("FACILITY_DEVICE_TYPE");t(),o.set("enabled",!0),s.setOptions({optionLabel:{displayType:f,type:"All"}}),o.set("dataSource",p)}}}},open:function(){a.fn.open.call(this),this._initComponent()},close:function(){this.contentViewModel.search.set("value",""),this._reset(),a.fn.close.call(this)},selectByIds:function(e){this.selectIds=e,this.selectedGrid&&0<this.selectedGrid.dataSource.data().length&&this._setGridDataSoruce()}});e.plugin(t)}(window,jQuery),function(e){var t=e.kendo,i=t.ui,a=i.NumericTextBox,n=i.NumericTextBox=a.extend({options:{},_adjust:function(e){var t=this.options,i=t.min,a=t.max;return null===e||(null!==i&&e<i?e=i:null!==a&&a<e&&(e=a),this._downArrow.removeClass("disabled"),this._upArrow.removeClass("disabled"),null!==i&&e<=i&&this._downArrow.addClass("disabled"),null!==a&&a<=e&&this._upArrow.addClass("disabled")),e}});t.ui.plugin(n)}(window,jQuery);