define("asset/assetuser/common/common",[],function(){var t=window.I18N,e={COMMON_MANAGER:t.prop("COMMON_MANAGER"),COMMON_MANAGER_TYPE:t.prop("COMMON_MANAGER_TYPE"),COMMON_NAME:t.prop("COMMON_NAME"),COMMON_ID:t.prop("COMMON_ID"),COMMON_PHONE_NUM:t.prop("COMMON_PHONE_NUM"),COMMON_LASTEST_SIGN_IN:t.prop("COMMON_MY_PROFILE_LASTEST_SIGN_IN"),COMMON_DETAIL:t.prop("COMMON_BTN_DETAIL"),COMMON_EMAIL:t.prop("COMMON_EMAIL"),COMMON_SIGNUP_DATE:t.prop("COMMON_MY_PROFILE_SIGNUP_DATE"),COMMON_BTN_CLOSE:t.prop("COMMON_BTN_CLOSE"),COMMON_BTN_DELETE:t.prop("COMMON_BTN_DELETE"),COMMON_BTN_EDIT:t.prop("COMMON_BTN_EDIT"),COMMON_BTN_SAVE:t.prop("COMMON_BTN_SAVE"),COMMON_BTN_CANCEL:t.prop("COMMON_BTN_CANCEL"),COMMON_BTN_CHANGE_ALL:t.prop("COMMON_BTN_CHANGE_ALL"),COMMON_ENTER_SEARCH_TERMS:t.prop("COMMON_ENTER_SEARCH_TERMS"),COMMON_MY_PROFILE_CHANGE_PASSWORD_CAUTION:t.prop("COMMON_MY_PROFILE_CHANGE_PASSWORD_CAUTION"),COMMON_MESSAGE_NOTI_CHANGES_SAVED:t.prop("COMMON_MESSAGE_NOTI_CHANGES_SAVED"),MEMBERSHIP_MANAGER_TYPE:t.prop("MEMBERSHIP_MANAGER_TYPE"),MEMBERSHIP_MANAGER_TYPE_ALL:t.prop("MEMBERSHIP_MANAGER_TYPE_ALL"),MEMBERSHIP_MANAGER_TYPE_ADMINISTRATOR:t.prop("MEMBERSHIP_MANAGER_TYPE_ADMINISTRATOR"),MEMBERSHIP_MANAGER_TYPE_ASSISTANT_MANAGER:t.prop("MEMBERSHIP_MANAGER_TYPE_ASSISTANT_MANAGER"),MEMBERSHIP_MANAGER_TYPE_GENERAL_MANAGER:t.prop("MEMBERSHIP_MANAGER_TYPE_GENERAL_MANAGER"),MEMBERSHIP_MANAGER_TYPE_SENIOR_MANAGER:t.prop("MEMBERSHIP_MANAGER_TYPE_SENIOR_MANAGER"),MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED:t.prop("MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED"),MEMBERSHIP_MESSAGE_NOTI_SELCTED_MULTI_MEMBER:function(e){return t.prop("MEMBERSHIP_MESSAGE_NOTI_SELCTED_MULTI_MEMBER",e)},MEMBERSHIP_MESSAGE_CONFIRM_RESET_PASSSWORD:t.prop("MEMBERSHIP_MESSAGE_CONFIRM_RESET_PASSSWORD"),MEMBERSHIP_SELECTED_MEMBERS:t.prop("MEMBERSHIP_SELECTED_MEMBERS"),MEMBERSHIP_REQUEST_DATE:t.prop("MEMBERSHIP_REQUEST_DATE"),MEMBERSHIP_TELEPHONE:t.prop("COMMON_PHONE"),MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MEMBER:t.prop("MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MEMBER"),MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MULTI_MEMBER:function(e){return t.prop("MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MULTI_MEMBER",e)},MANAGER_MANAGER_RESET_PASSWORD:t.prop("MANAGER_MANAGER_RESET_PASSWORD"),MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MEMBER_APPLICATION:t.prop("MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MEMBER_APPLICATION"),MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MULTI_MEMBER_APPLICATION:function(e){return t.prop("MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MULTI_MEMBER_APPLICATION",e)},MEMBERSHIP_PENDING_APPROVAL:t.prop("MEMBERSHIP_PENDING_APPROVAL"),MEMBERSHIP_APPROVE:t.prop("MEMBERSHIP_APPROVE"),MEMBERSHIP_REJECT:t.prop("MEMBERSHIP_REJECT"),ACCOUNT_SETTING_MANAGE_BUILDING:t.prop("ACCOUNT_SETTING_MANAGE_BUILDING"),COMMON_FLOOR_NAV_TOTAL:t.prop("COMMON_FLOOR_NAV_TOTAL"),MEMBERSHIP_NEW_PASSWORD:t.prop("COMMON_MY_PROFILE_NEW_PASSWORD"),MEMBERSHIP_CHECK_NEW_PASSWORD:t.prop("MEMBERSHIP_CHECK_NEW_PASSWORD"),COMMON_CONFIRM_DIALOG_EDIT_CANEL:t.prop("COMMON_CONFIRM_DIALOG_EDIT_CANEL"),MEMBERSHIP_ADD_MANUALLY:t.prop("MEMBERSHIP_ADD_MANUALLY"),COMMON_PASSWORD:t.prop("COMMON_PASSWORD"),COMMON_NO_SELECT:t.prop("COMMON_NO_SELECT"),COMMON_REQUIRED_ITEM:t.prop("MEMBERSHIP_REQUIRED_ITEM"),MEMBERSHIP_MESSAGE_NOTI_USED_ID:t.prop("MEMBERSHIP_MESSAGE_NOTI_USED_ID"),MEMBERSHIP_MESSAGE_CONFIRM_SIGNUP_ADD_MEMBER:t.prop("MEMBERSHIP_MESSAGE_CONFIRM_SIGNUP_ADD_MEMBER"),MEMBERSHIP_NICKNAME:t.prop("MEMBERSHIP_NICKNAME"),MEMBERSHIP_ORGANIZATION:t.prop("MEMBERSHIP_ORGANIZATION"),MEMBERSHIP_EMPLOYEE_ID_NUM:t.prop("MEMBERSHIP_EMPLOYEE_ID_NUM"),MEMBERSHIP_POSITION:t.prop("MEMBERSHIP_POSITION"),MEMBERSHIP_RESPONSIBILITIES:t.prop("MEMBERSHIP_RESPONSIBILITIES"),COMMON_INVALID_VALUE:t.prop("COMMON_INVALID_VALUE")};return{TEXT:e,MAPPING_COL_TEXT:{role:e.COMMON_MANAGER_TYPE,name:e.COMMON_NAME,id:e.COMMON_ID,mobilePhoneNumber:e.MEMBERSHIP_TELEPHONE,lastLogin:e.COMMON_LASTEST_SIGN_IN,joinDate:e.MEMBERSHIP_REQUEST_DATE}}}),define("asset/assetuser/common/widget",["asset/assetuser/common/common"],function(e){var t,n,i,s,E,a=window.moment,r=e.TEXT,d=window.Util,o=$("#assetuser-popup"),l=$("#assetuser-signup-approve-popup"),M=$("#assetuser-dialog-message"),p=$("#assetuser-dialog-confirm"),_={title:r.COMMON_DETAIL,dataSource:[],hasDelete:!1,height:735,width:652,contentTemplate:"<div class='detail-dialog-content device-dialog-content'><div class='detail-dialog-header device-dialog-header'></div><div class='detail-dialog-detail-content'></div></div>",headerTemplate:"<span>"+r.MEMBERSHIP_SELECTED_MEMBERS+" : #:count#</span>",listTemplate:"<span>#:data.name# (#:data.id#)</span>",isCustomActions:!0};t={account:$.extend(!0,{},_,{buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2,SAVE:3,CANCEL:4},actions:[{text:r.COMMON_BTN_CLOSE,visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1)}},{text:r.COMMON_BTN_DELETE,visible:!0,action:function(e){var n=e.sender,i=n.dataSource.data(),a=i.length,o=new window.CommonLoadingPanel(n.element[0]);return 1===a?E.message(r.MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MEMBER):E.message(r.MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MULTI_MEMBER(a)),E.options.confirmActions.yes=function(){o.open();for(var e=[],t=0;t<a;t++)e.push($.ajax({method:"delete",url:"/ums/users/"+i[t].id}));$.when.apply(this,e).done(function(){n.isDeleted=!0,n.trigger("onClose"),n.close()}).always(function(){o.close()})}.bind(this),E.open(),!1}},{text:r.COMMON_BTN_EDIT,visible:!0,action:function(e){return e.sender.trigger("onEdit"),e.sender.setEditable(!0),e.sender.trigger("onEdited"),!1}},{text:r.COMMON_BTN_SAVE,visible:!1,disabled:!0,action:function(e){var t,n=e.sender.options.scheme.fields,i=e.sender.editFields;for(t in n)if(n[t].editable&&n[t].validator&&i[t].data("kendoCommonValidator")&&!i[t].data("kendoCommonValidator").validate())return!1;var a=e.sender.saveAll();return a&&e.sender.trigger("onSaved",{sender:e.sender,results:a}),!1}},{text:r.COMMON_BTN_CANCEL,visible:!1,action:function(e){return e.sender._cancelEvent({sender:e.sender},!1),!1}}],scheme:{id:"id",fields:{role:{type:"text",name:r.COMMON_MANAGER_TYPE},name:{type:"text",name:r.COMMON_NAME,editCss:{width:"100%"},editable:!0,hasInputRemoveBtn:!0,validator:{type:"name",required:!0}},id:{type:"text",name:r.COMMON_ID,editable:!0,editTemplate:"<span style='line-height: 40px;'>#:id#</span><button class='k-button' style='float: right; width: 170px;' data-bind='events: {click: onClick}'>"+r.MANAGER_MANAGER_RESET_PASSWORD+"</button>",editViewModel:{onClick:function(e){var t=$("#assetuser-dialog-confirm").data("kendoCommonDialog"),n=new window.CommonLoadingPanel($("#assetuser-popup")),i=$(e.target.parentElement).find("span").text();t.message(r.MEMBERSHIP_MESSAGE_CONFIRM_RESET_PASSSWORD),t.options.confirmActions.yes=function(){n.open(),$.ajax({method:"patch",url:"/ums/users/"+i,data:JSON.stringify({password:"@abc12345!"})}).fail(function(e){s.message(d.parseFailResponse(e)),s.open()}).always(function(){n.close()})},t.open()}}},nickname:{type:"text",name:r.MEMBERSHIP_NICKNAME,template:function(e){return e.nickname?e.nickname:"-"},editCss:{width:"100%"},editable:!0,validator:{type:"name"}},organization:{type:"text",name:r.MEMBERSHIP_ORGANIZATION,template:function(e){return e.organization?e.organization:"-"},editCss:{width:"100%"},editable:!0,isEditAll:!0,validator:{type:"name"}},employeeId:{type:"text",name:r.MEMBERSHIP_EMPLOYEE_ID_NUM,template:function(e){return e.employeeId?e.employeeId:"-"},editCss:{width:"100%"},editable:!0,validator:{messages:{incorrectValue:r.COMMON_INVALID_VALUE},rules:{incorrectValue:function(e){var t=e.val();return!t||t.match(/^(?=.{2,20}$)[a-zA-Z0-9_.]+$/)}}}},position:{type:"text",name:r.MEMBERSHIP_POSITION,template:function(e){return e.position?e.position:"-"},editCss:{width:"100%"},editable:!0,isEditAll:!0,validator:{type:"name"}},responsibility:{type:"text",name:r.MEMBERSHIP_RESPONSIBILITIES,template:function(e){return e.responsibility?e.responsibility:"-"},editCss:{width:"100%"},editable:!0,isEditAll:!0,validator:{type:"name"}},mobilePhoneNumber:{type:"text",name:r.COMMON_PHONE_NUM,editCss:{width:"100%"},editable:!0,hasInputRemoveBtn:!0,validator:!0},email:{type:"email",name:r.COMMON_EMAIL,editCss:{width:"100%"},editable:!0,hasInputRemoveBtn:!0,validator:!0},joinDate:{type:"text",name:r.COMMON_SIGNUP_DATE,template:function(e){var t="-";return e.joinDate&&(t=a(e.joinDate).format("LLL").replace(/\./g,"/")),t}},lastLogin:{type:"text",name:r.COMMON_LASTEST_SIGN_IN,template:function(e){var t="-";return e.lastLogin&&(t=a(e.lastLogin).format("LLL").replace(/\./g,"/")),t}}}}}),signup:$.extend(!0,{},_,{height:535,buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2,SAVE:3,CANCEL:4},actions:[{text:r.COMMON_BTN_CLOSE,visible:!0,action:function(e){e.sender.trigger("onClose"),e.sender.isEditable&&e.sender.setEditable(!1)}},{text:r.MEMBERSHIP_REJECT,visible:!0,action:function(e){var n=e.sender,i=n.dataSource.data(),a=i.length,o=new window.CommonLoadingPanel(n.element[0]);return 1===a?E.message(r.MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MEMBER_APPLICATION):E.message(r.MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MULTI_MEMBER_APPLICATION(a)),E.options.confirmActions.yes=function(){o.open();for(var e=[],t=0;t<a;t++)e.push($.ajax({url:"/ums/users/"+i[t].id,method:"patch",data:{registrationStatus:"Rejected"}}));$.when.apply(this,e).done(function(){n.isDeleted=!0,n.trigger("onClose"),n.close()}).fail(function(e){s.message(d.parseFailResponse(e)),s.open()}).always(function(){o.close()})}.bind(this),E.open(),!1}},{text:r.MEMBERSHIP_APPROVE,visible:!0,action:function(e){return e.sender.trigger("onEdit"),e.sender.setEditable(!0),e.sender.enableSaveBtn(),e.sender.trigger("onEdited"),!1}},{text:r.COMMON_BTN_SAVE,visible:!1,disabled:!0,action:function(e){var t=e.sender.saveAll();return t&&(e.sender.trigger("onSaved",{sender:e.sender,results:t}),e.sender.setEditable(!1)),!1}},{text:r.COMMON_BTN_CANCEL,visible:!1,action:function(e){return e.sender._cancelEvent({sender:e.sender},!1),!1}}],scheme:{id:"id",fields:{joinDate:{type:"text",name:r.COMMON_SIGNUP_DATE,template:function(e){var t="-";return e.joinDate&&(t=a(e.joinDate).format("LLL").replace(/\./g,"/")),t}},name:{type:"text",name:r.COMMON_NAME},id:{type:"text",name:r.COMMON_ID},mobilePhoneNumber:{type:"text",name:r.COMMON_PHONE_NUM},email:{type:"email",name:r.COMMON_EMAIL}}}}),addManually:$.extend(!0,{},_,{title:r.MEMBERSHIP_ADD_MANUALLY,height:630,contentTemplate:"<div class='detail-dialog-content device-dialog-content'><div class='detail-dialog-header device-dialog-header'></div><div class='signup-required'><span class='signup-required-mark'>*</span><span class='signup-required-text'>"+r.COMMON_REQUIRED_ITEM+"</span></div> <div class='detail-dialog-detail-content'></div></div>",listTemplate:function(){return""},buttonsIndex:{CLOSE:0,DELETE:1,EDIT:2,SAVE:3,CANCEL:4},actions:[{text:r.COMMON_BTN_CLOSE,visible:!0,action:function(e){}},{text:r.MEMBERSHIP_REJECT,visible:!0,action:function(e){}},{text:r.MEMBERSHIP_APPROVE,visible:!0,action:function(e){}},{text:r.COMMON_BTN_SAVE,visible:!1,disabled:!0,action:function(e){var t=e.sender.saveAll();return t&&e.sender.trigger("onSaved",{sender:e.sender,results:t}),!1}},{text:r.COMMON_BTN_CANCEL,visible:!1,action:function(e){return E.message(r.COMMON_CONFIRM_DIALOG_EDIT_CANEL),E.options.confirmActions.yes=function(){i.dataSource.cancelChanges(),i.close()},E.open(),!1}}],scheme:{id:"id",fields:{id:{type:"text",name:r.COMMON_ID,editable:!0,editFieldName:"id",editTemplate:function(){return'<input class="k-input approve-id" placeholder="'+r.COMMON_ID+'" data-key="id" required/><span class="signup-required-mark">*</span>'},editViewModel:{fields:{id:""},init:function(){l.find(".k-input.approve-id").kendoCommonValidator({type:"id"}),l.find(".k-input.approve-id").on("keyup",function(e){i.options.scheme.fields.id.editViewModel.fields.set("id",$(e.target).val())})}}},password:{type:"text",name:r.MEMBERSHIP_NEW_PASSWORD,editable:!0,editFieldName:"password",editTemplate:function(){return'<input type="password" id="approve-password" class="k-input approve-password" placeholder="'+r.COMMON_PASSWORD+'" data-key="password" required/><span class="signup-required-mark">*</span>'},editViewModel:{fields:{password:""},init:function(){l.find(".k-input.approve-password").kendoCommonValidator({type:"password",mixedPasswordCheck:!0}),l.find(".k-input.approve-password").on("keyup",function(e){i.options.scheme.fields.password.editViewModel.fields.set("password",$(e.target).val())})}}},passwordRetype:{type:"text",name:r.MEMBERSHIP_CHECK_NEW_PASSWORD,editable:!0,editTemplate:function(){return'<input type="password" class="k-input approve-password-retype" placeholder="'+r.MEMBERSHIP_CHECK_NEW_PASSWORD+'" data-key="passwordRetype" data-retype-for="approve-password" required/><span class="signup-required-mark">*</span>'},editViewModel:{fields:{passwordRetype:""},init:function(){l.find(".k-input.approve-password-retype").kendoCommonValidator({type:"passwordRetype",mixedPasswordCheck:!0})}}},name:{type:"text",name:r.COMMON_NAME,editable:!0,editFieldName:"name",editTemplate:function(){return'<input class="k-input approve-name" placeholder="'+r.COMMON_NAME+'" data-key="name" required/><span class="signup-required-mark">*</span>'},editViewModel:{fields:{name:""},init:function(){l.find(".k-input.approve-name").kendoCommonValidator({type:"name"}),l.find(".k-input.approve-name").on("keyup",function(e){i.options.scheme.fields.name.editViewModel.fields.set("name",$(e.target).val())})}}},nickname:{type:"text",name:r.MEMBERSHIP_NICKNAME,editable:!0,editFieldName:"nickname",editTemplate:function(){return'<input class="k-input approve-nickname" placeholder="'+r.MEMBERSHIP_NICKNAME+'" data-key="nickname"/>'},editViewModel:{fields:{nickname:""},init:function(){l.find(".k-input.approve-nickname").kendoCommonValidator({type:"name"}),l.find(".k-input.approve-nickname").on("keyup",function(e){i.options.scheme.fields.nickname.editViewModel.fields.set("nickname",$(e.target).val())})}}},organization:{type:"text",name:r.MEMBERSHIP_ORGANIZATION,editable:!0,editFieldName:"organization",editTemplate:function(){return'<input class="k-input approve-organization" placeholder="'+r.MEMBERSHIP_ORGANIZATION+'" data-key="organization"/>'},editViewModel:{fields:{organization:""},init:function(){l.find(".k-input.approve-organization").kendoCommonValidator({type:"name"}),l.find(".k-input.approve-organization").on("keyup",function(e){i.options.scheme.fields.organization.editViewModel.fields.set("organization",$(e.target).val())})}}},employeeId:{type:"text",name:r.MEMBERSHIP_EMPLOYEE_ID_NUM,editable:!0,editFieldName:"employeeId",editTemplate:function(){return'<input class="k-input approve-employee-id" placeholder="'+r.MEMBERSHIP_EMPLOYEE_ID_NUM+'" data-key="employeeId"/>'},editViewModel:{fields:{employeeId:""},init:function(){l.find(".k-input.approve-employee-id").kendoCommonValidator({messages:{incorrectValue:r.COMMON_INVALID_VALUE},rules:{incorrectValue:function(e){var t=e.val();return!t||t.match(/^(?=.{2,20}$)[a-zA-Z0-9_.]+$/)}}}),l.find(".k-input.approve-employee-id").on("keyup",function(e){i.options.scheme.fields.employeeId.editViewModel.fields.set("employeeId",$(e.target).val())})}}},position:{type:"text",name:r.MEMBERSHIP_POSITION,editable:!0,editFieldName:"position",editTemplate:function(){return'<input class="k-input approve-position" placeholder="'+r.MEMBERSHIP_POSITION+'" data-key="position"/>'},editViewModel:{fields:{position:""},init:function(){l.find(".k-input.approve-position").kendoCommonValidator({type:"name"}),l.find(".k-input.approve-position").on("keyup",function(e){i.options.scheme.fields.position.editViewModel.fields.set("position",$(e.target).val())})}}},responsibility:{type:"text",name:r.MEMBERSHIP_RESPONSIBILITIES,editable:!0,editFieldName:"responsibility",editTemplate:function(){return'<input class="k-input approve-responsibility" placeholder="'+r.MEMBERSHIP_RESPONSIBILITIES+'" data-key="responsibility"/>'},editViewModel:{fields:{responsibility:""},init:function(){l.find(".k-input.approve-responsibility").kendoCommonValidator({type:"name"}),l.find(".k-input.approve-responsibility").on("keyup",function(e){i.options.scheme.fields.responsibility.editViewModel.fields.set("responsibility",$(e.target).val())})}}},mobilePhoneNumber:{type:"text",name:r.COMMON_PHONE_NUM,editable:!0,editFieldName:"mobilePhoneNumber",editTemplate:function(){return'<input class="k-input approve-phone-number" placeholder="'+r.COMMON_PHONE_NUM+'" data-key="mobilePhoneNumber"/>'},editViewModel:{fields:{mobilePhoneNumber:""},init:function(){l.find(".k-input.approve-phone-number").kendoCommonValidator({type:"mobilePhoneNumber"}),l.find(".k-input.approve-phone-number").on("keyup",function(e){i.options.scheme.fields.mobilePhoneNumber.editViewModel.fields.set("mobilePhoneNumber",$(e.target).val())})}}},email:{type:"email",name:r.COMMON_EMAIL,editable:!0,editFieldName:"email",editTemplate:function(){return'<input class="k-input approve-email" placeholder="'+r.COMMON_EMAIL+'" data-key="email"/>'},editViewModel:{fields:{email:""},init:function(){l.find(".k-input.approve-email").kendoCommonValidator({type:"email"}),l.find(".k-input.approve-email").on("keyup",function(e){i.options.scheme.fields.email.editViewModel.fields.set("email",$(e.target).val())})}}}}}})},s=M.kendoCommonDialog({type:"message",height:252}).data("kendoCommonDialog"),E=p.kendoCommonDialog({type:"confirm",height:252,confirmActions:{yes:function(){},no:function(){}}}).data("kendoCommonDialog");return{managerDialogMessage:s,managerDialogConfirm:E,getDetailPopup:function(e){return"addManually"!=e?(n=o.kendoDetailDialog(t[e]).data("kendoDetailDialog"),o.css("overflow","auto"),n):(i=l.kendoDetailDialog(t[e]).data("kendoDetailDialog"),l.css("overflow","auto"),i)}}}),define("asset/assetuser/viewmodel/assetuser-vm",["asset/assetuser/common/common","asset/assetuser/common/widget"],function(e){var t=window.kendo,n=e.TEXT;return{MainViewModel:t.observable({categoryAccountBtn:{isSelected:!0},categorySignupBtn:{isSelected:!1},searchInput:{value:"",keyup:function(){}},searchRemoveBtn:{disabled:!1,isVisible:!1,click:function(){}},searchSearchBtn:{disabled:!1,isVisible:!0,click:function(){}},selectedMemberLabel:{text:n.MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED},tenant:{editBtn:{disabled:!0,isVisible:!0,click:function(){}},deleteBtn:{disabled:!0,isVisible:!0,click:function(){}},detailBtn:{disabled:!0,isVisible:!0,click:function(){}},userDataSource:new t.data.DataSource({data:[]}),userColumns:[]},signup:{pendingNum:0,addBtn:{disabled:!1,isVisible:!0,click:function(){}},approveBtn:{disabled:!0,isVisible:!0,click:function(){}},rejectBtn:{disabled:!0,isVisible:!0,click:function(){}},detailBtn:{disabled:!0,isVisible:!0,click:function(){}},userDataSource:new t.data.DataSource({data:[]}),userColumns:[]}})}}),define("asset/assetuser/assetuser",["asset/assetuser/common/common","asset/assetuser/common/widget","asset/assetuser/viewmodel/assetuser-vm"],function(e,t,n){var i=window.kendo,c=window.Util,u=e.TEXT,a=e.MAPPING_COL_TEXT,o=window.moment,S=new window.CommonLoadingPanel;window.MAIN_WINDOW.disableFloorNav(!0);var s,E,r,d,l,M,p,_=n.MainViewModel,N={account:_.get("categoryAccountBtn"),signup:_.get("categorySignupBtn")},m=_.get("searchInput"),O=_.get("searchRemoveBtn"),I=_.get("searchSearchBtn"),C=_.get("selectedMemberLabel"),f=_.get("tenant"),A=f.get("editBtn"),R=f.get("deleteBtn"),g=f.get("detailBtn"),T=_.get("signup"),P=T.get("addBtn"),h=T.get("approveBtn"),D=T.get("rejectBtn"),v=T.get("detailBtn"),B=t.managerDialogConfirm,L=t.managerDialogMessage,b=$("#assetuser-tab"),y=$("#assetuser-categories"),k="account",H="signup",w=$(".assetuser-top-categories-search"),G=$(".assetuser-top-utilities"),V=$("#assetuser-grid"),x=$(".assetuser-search-sch-btn"),U=$(".assetuser-btn-detail"),F=$(".signup-btn-detail"),Y=$("#assetuser-popup"),W=$("#assetuser-signup-approve-popup"),j={id:"",name:""},z=["id","role","name","nickname","organization","employeeId","position","responsibility","mobilePhoneNumber","email","lastEntry","joinDate"],q="Tenant",J=function(){r=k,K(),X()},K=function(){i.bind(G,f),l=f.get("userDataSource"),M=l.data(),d&&(d.destroy(),V.empty()),d=V.kendoGrid({columns:oe(),height:"calc(100% - 56px)",scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageagble:!1,hasCheckedModel:!0,setCheckedAttribute:!0}).data("kendoGrid"),s&&(s.destroy(),Y.empty()),s=t.getDetailPopup(r),ne(!0)},Z=function(){i.bind(G,T),l=T.get("userDataSource"),M=l.data(),d&&(d.destroy(),V.empty()),d=V.kendoGrid({columns:se(),height:"calc(100% - 56px)",scrollable:!0,groupable:!1,sortable:!0,filterable:!1,pageagble:!1,hasCheckedModel:!0,setCheckedAttribute:!0}).data("kendoGrid"),s&&(s.destroy(),Y.empty()),E&&(E.destroy(),W.empty()),s=t.getDetailPopup(r),E=t.getDetailPopup("addManually"),ne(!0)},Q=function(){y.on("click",".assetuser-category",function(e){if(!$(this).hasClass("selected")){var t=$(this).data("category");"account"===t?(N.account.set("isSelected",!0),N.signup.set("isSelected",!1),J()):"signup"===t&&(N.signup.set("isSelected",!0),N.account.set("isSelected",!1),r=H,Z(),ee())}}),m.set("keyup",function(e){var t=e.key,n=e.target.value;"Enter"===t&&x.trigger("click"),n?O.set("isVisible",!0):O.set("isVisible",!1)}),I.set("click",function(e){var t=this.searchInput.value,n=l,i=p,a=[];n.filter({});for(var o=0;o<i.length;o++)i[o].field&&"checked"!==i[o].field&&a.push({field:i[o].field,operator:"contains",value:t});n.filter({logic:"or",filters:a}),n.sort([{field:"name",dir:"asc"}])}),O.set("click",function(e){m.set("value",""),O.set("isVisible",!1)})},X=function(){d.bind("checked",function(e){var t=this.getCheckedData().length;0<t?(A.get("disabled")&&re(!1),C.set("text",u.MEMBERSHIP_MESSAGE_NOTI_SELCTED_MULTI_MEMBER(t))):0===t&&de()}),V.on("click",".ic-info",function(e){var t=$(e.currentTarget),i=[];s.setDataSource(i),s.isChanged=!1,s.open(),S.open(Y),te("users",{ids:d.dataSource.get(t.data("id")).id}).done(function(e){for(var t=e.length,n=0;n<t;n++)i.push(e[n]);s.setDataSource(i)}).always(function(){S.close(Y)})}),A.set("click",function(e){U.trigger("click")}),R.set("click",function(e){var t=d.getCheckedData(),n=t.length;1===n?B.message(u.MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MEMBER):B.message(u.MEMBERSHIP_MESSAGE_CONFIRM_DELETE_SELECTED_MULTI_MEMBER(n)),B.options.confirmActions.yes=function(){var e=!1;S.open(),$.when.apply(this,ae(t)).done(function(){e=!0,de(),ne()}).always(function(){e||S.close()})}.bind(this),B.open()}),g.set("click",function(n){var e=d.getCheckedData(),t=e.length,i="",a=[],o=0;for(o=0;o<t;o++)i+=e[o].id+",";s.setDataSource(a,!1),s.isChanged=!1,s.open(),S.open(Y),te("users",{ids:i}).done(function(e){var t=e.length;for(o=0;o<t;o++)a.push(e[o]);s.setDataSource(a,!1),1<t&&s.collapseRow(0),n.originalEvent||(s.trigger("onEdit"),s.setEditable(!0),s.trigger("onEdited"))}).always(function(){S.close(Y)})}),s.bind("onSaved",function(n){var e,t,i,a,o=[],s=n.results,E=n.sender.dataSource.data(),r=n.sender.dataSource._pristineData,d=E.length;S.open(Y);for(var l=0;l<d;l++){for(var M in i=t=!1,s[l])s[l][M]!=r[l][M]?s[l][M]?t=!0:r[l][M]?i=!(s[l][M]=null):delete s[l][M]:delete s[l][M];if(i){for(var p in e={},s[l]=$.extend(!0,E[l],s[l]),s[l]){a=!1;for(var _=0;_<z.length;_++)z[_]!=p||(a=!0);a&&(e[p]=s[l][p]||null)}o.push($.ajax({method:"put",url:"/ums/users/"+E[l].id,data:e}))}else t&&o.push($.ajax({method:"patch",url:"/ums/users/"+E[l].id,data:s[l]}))}$.when.apply(n,o).done(function(){var e=n.sender.dataSource._pristineData;n.sender.success();for(var t=0;t<e.length;t++)e[t]=$.extend(!0,e[t],s[t]);n.sender.setEditable(!1),n.sender.setDataSource(e),n.sender.isChanged=!0,L.message(u.COMMON_MESSAGE_NOTI_CHANGES_SAVED)}).fail(function(e){n.sender.fail(),L.message(c.parseFailResponse(e))}).always(function(){L.open(),S.close(Y)})}),s.setCloseAction(function(e){this._cancelEvent&&this._cancelEvent({sender:this},!0),(e.isChanged||this.isChanged||e.isDeleted||this.isDeleted)&&(this.isChanged=!1,re(!(this.isDeleted=!1)),C.set("text",u.MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED),S.open(),ne(!0))}),s.bind("onClose",function(e){e.sender.options.closeAction(this)})},ee=function(){d.bind("checked",function(e){var t=this.getCheckedData().length;0<t?(A.get("disabled")&&re(!1),C.set("text",u.MEMBERSHIP_MESSAGE_NOTI_SELCTED_MULTI_MEMBER(t))):0===t&&de()}),V.on("click",".ic-info",function(e){var t=$(e.currentTarget),i=[];s.setDataSource(i),s.isChanged=!1,s.open(),S.open(Y),te("users",{ids:d.dataSource.get(t.data("id")).id}).done(function(e){for(var t=e.length,n=0;n<t;n++)i.push(e[n]);s.setDataSource(i),s.enableSaveBtn()}).always(function(){S.close(Y)})}),h.set("click",function(e){F.trigger("click")}),D.set("click",function(e){var n=this,i=d.getCheckedData(),a=i.length;1===a?B.message(u.MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MEMBER_APPLICATION):B.message(u.MEMBERSHIP_MESSAGE_CONFIRM_REJECT_SELECTED_MULTI_MEMBER_APPLICATION(a)),B.options.confirmActions.yes=function(){var e,t=[];for(e=0;e<a;e++)t.push($.ajax({url:"/ums/users/"+i[e].id,method:"PATCH",data:{registrationStatus:"Rejected"}}));S.open(),$.when.apply(n,t).done(function(){ne(!0)}).fail(function(e){L.message(c.parseFailResponse(e)),L.open()}).always(function(){S.close()})},B.open()}),v.set("click",function(n){var e=d.getCheckedData(),t=e.length,i="",a=[],o=0;for(o=0;o<t;o++)i+=e[o].id+",";s.setDataSource(a,!1),s.isChanged=!1,s.open(),S.open(Y),te("users",{ids:i}).done(function(e){var t=e.length;for(o=0;o<t;o++)a.push(e[o]);s.setDataSource(a,!1),1<t&&s.collapseRow(0),n.originalEvent||(s.trigger("onEdit"),s.setEditable(!0),s.enableSaveBtn(),s.trigger("onEdited"))}).always(function(){S.close(Y)})}),s.bind("onSaved",function(t){var e=[],n=t.results,i=t.sender.dataSource.data(),a=i.length;S.open(Y);for(var o=0;o<a;o++)n[o].registrationStatus="Approved",delete n[o].id,e.push($.ajax({method:"patch",url:"/ums/users/"+i[o].id,data:n[o]}));$.when.apply(t,e).done(function(){t.sender.success(),t.sender.isChanged=!0,L.message(u.COMMON_MESSAGE_NOTI_CHANGES_SAVED),s.close(),ne(!0)}).fail(function(e){t.sender.fail(),L.message(c.parseFailResponse(e))}).always(function(){L.open(),S.close(Y)})}),s.setCloseAction(function(e){this._cancelEvent&&this._cancelEvent({sender:this},!0),(e.isChanged||this.isChanged||e.isDeleted||this.isDeleted)&&(this.isChanged=!1,re(!(this.isDeleted=!1)),C.set("text",u.MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED),ne(!0))}),s.bind("onClose",function(e){e.sender.options.closeAction(this)}),P.set("click",function(e){E.setDataSource(j),E.open(),E.trigger("onEdit"),E.setEditable(!0),E.enableSaveBtn(),E.trigger("onEdited")}),E.bind("onSaved",function(e){var t,n,i=e.results[0],a=e.sender.element.find(".common-validator");for(t=0;t<a.length;t++)if(!a.eq(t).data("kendoCommonValidator").validate())return;for(n in i)i[n]||delete i[n];delete i.passwordRetype,i.role=q,S.open(W),$.ajax({url:"/ums/users",method:"post",data:i}).done(function(){B.message(u.MEMBERSHIP_MESSAGE_CONFIRM_SIGNUP_ADD_MEMBER),B.setConfirmActions({yes:function(){E.success(),E.setDataSource(j),E.trigger("onEdit"),E.setEditable(!0),E.enableSaveBtn(),E.trigger("onEdited")},no:function(){E.success(),E.close()}}),B.open()}).fail(function(e){var t=500===e.status?u.MEMBERSHIP_MESSAGE_NOTI_USED_ID:c.parseFailResponse(e);L.message(t),L.open()}).always(function(){S.close(W)})})},te=function(e,t){var n="/ums/"+e+"?";if(t)for(var i in t)n+=i+"="+t[i]+"&";return n=n.slice(0,-1),$.ajax({url:n})},ne=function(t){S.open(),C.set("text",u.MEMBERSHIP_MESSAGE_NOTI_SELCTED_MULTI_MEMBER(0)),r===k?te("users",{roles:q,registrationStatus:"Approved"}).done(function(e){ie(e),t&&l.sort([{field:"name",dir:"asc"}])}).fail(function(e){L.message(c.parseFailResponse(e)),L.open()}).always(function(){S.close()}):r===H&&te("users",{roles:q,registrationStatus:"Pending"}).done(function(e){ie(e),t&&l.sort([{field:"name",dir:"asc"}]),T.set("pendingNum",e.length)}).fail(function(e){L.message(c.parseFailResponse(e)),L.open()}).always(function(){S.close()})},ie=function(e){for(var t=e.length,n=M.length=0;n<t;n++)M.push(e[n]);d.setDataSource(l)},ae=function(e){for(var t=[],n=e.length,i=0;i<n;i++)t.push($.ajax({method:"delete",url:"/ums/users/"+e[i].id}));return t},oe=function(){var e=Ee(["name","id","mobilePhoneNumber","lastLogin"]);return f.set("userColumns",e),p=f.get("userColumns"),e},se=function(){var e=Ee(["joinDate","name","id","mobilePhoneNumber"]);return T.set("userColumns",e),p=T.get("userColumns"),e},Ee=function(e){for(var t=[],n=null,i=0;i<e.length;i++)n={field:e[i],title:a[e[i]]},"mobilePhoneNumber"===e[i]?n.template=function(e){return e.mobilePhoneNumber?e.mobilePhoneNumber:"-"}:"lastLogin"===e[i]?n.template=function(e){var t="-";return e.lastLogin&&(t=o(e.lastLogin).format("LLL").replace(/\./g,"/")),t}:"joinDate"===e[i]&&(n.template=function(e){var t="-";return e.joinDate&&(t=o(e.joinDate).format("LLL").replace(/\./g,"/")),t}),t.push(n);return t.push({title:u.COMMON_DETAIL,template:"<span class='ic ic-info' data-id='#:data.id#'></span>",width:130}),t};function re(e){r===k?(A.set("disabled",e),R.set("disabled",e),g.set("disabled",e)):r===H&&(h.set("disabled",e),D.set("disabled",e),v.set("disabled",e))}function de(){d.uncheckAll(),re(!0),C.set("text",u.MEMBERSHIP_MESSAGE_NOTI_NO_MEMBER_SELECTED)}(function(){b.kendoCommonTabStrip(),i.bind(w,_)})(),Q(),J()});